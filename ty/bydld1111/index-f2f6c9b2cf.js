!function(){"use strict";function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function C(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=z(n);return e=i?(e=z(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!=typeof e&&"function"!=typeof e?u(t):e}}function r(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=z(e)););return e}function G(e,t,n){return(G="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){e=r(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(n):t.value}})(e,t,n||e)}function o(e,t,n,i){return(o="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,i){var a,e=r(e,t);if(e){if((a=Object.getOwnPropertyDescriptor(e,t)).set)return a.set.call(i,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(i,t)){if(!a.writable)return!1;a.value=n,Object.defineProperty(i,t,a)}else n=n,(t=t)in(i=i)?Object.defineProperty(i,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[t]=n;return!0})(e,t,n,i)}function s(e,t,n,i,a){if(!o(e,t,n,i||e)&&a)throw new Error("failed to set property");return n}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function c(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,t=function(){};return{s:t,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){o=!0,a=e},f:function(){try{r||null==n.return||n.return()}finally{if(o)throw a}}}}var M=function(){function t(){S(this,t)}return C(t,null,[{key:"regClass",value:function(e){t.__classMap[e.name]=e}}]),t}();M.Laya=null,M.Timer=null,M.WorkerLoader=null,M.Dragging=null,M.GraphicsBounds=null,M.Sprite=null,M.TextRender=null,M.TextAtlas=null,M.timer=null,M.systemTimer=null,M.startTimer=null,M.updateTimer=null,M.lateTimer=null,M.physicsTimer=null,M.stage=null,M.Loader=null,M.loader=null,M.TTFLoader=null,M.SoundManager=null,M.WebAudioSound=null,M.AudioSound=null,M.ShaderCompile=null,M.ClassUtils=null,M.SceneUtils=null,M.Context=null,M.Render=null,M.MouseManager=null,M.Text=null,M.Browser=null,M.WebGL=null,M.Pool=null,M.Utils=null,M.Graphics=null,M.Submit=null,M.Stage=null,M.Resource=null,M.__classMap={};var g=function(){function i(){S(this,i)}return C(i,null,[{key:"getPoolBySign",value:function(e){return i._poolDic[e]||(i._poolDic[e]=[])}},{key:"clearBySign",value:function(e){i._poolDic[e]&&(i._poolDic[e].length=0)}},{key:"recover",value:function(e,t){t[i.POOLSIGN]||(t[i.POOLSIGN]=!0,i.getPoolBySign(e).push(t))}},{key:"recoverByClass",value:function(e){var t;!e||(t=e.__className||e.constructor._$gid)&&i.recover(t,e)}},{key:"_getClassSign",value:function(e){var t=e.__className||e._$gid;return t||(e._$gid=t=i._CLSID+"",i._CLSID++),t}},{key:"createByClass",value:function(e){return i.getItemByClass(i._getClassSign(e),e)}},{key:"getItemByClass",value:function(e,t){if(!i._poolDic[e])return new t;var n,e=i.getPoolBySign(e);return e.length?(n=e.pop())[i.POOLSIGN]=!1:n=new t,n}},{key:"getItemByCreateFun",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=i.getPoolBySign(e),n=e.length?e.pop():t.call(n);return n[i.POOLSIGN]=!1,n}},{key:"getItem",value:function(e){e=i.getPoolBySign(e),e=e.length?e.pop():null;return e&&(e[i.POOLSIGN]=!1),e}}]),i}();g._CLSID=0,g.POOLSIGN="__InPool",g._poolDic={};var p=function(){function n(){S(this,n)}return C(n,[{key:"recover",value:function(){g.recover("AlphaCmd",this)}},{key:"run",value:function(e,t,n){e.alpha(this.alpha)}},{key:"cmdID",get:function(){return n.ID}}],[{key:"create",value:function(e){var t=g.getItemByClass("AlphaCmd",n);return t.alpha=e,t}}]),n}();p.ID="Alpha";var m=function(){function l(){S(this,l)}return C(l,[{key:"recover",value:function(){this.fillColor=null,this.lineColor=null,g.recover("DrawCircleCmd",this)}},{key:"run",value:function(e,t,n){e._drawCircle(this.x+t,this.y+n,this.radius,this.fillColor,this.lineColor,this.lineWidth,this.vid)}},{key:"cmdID",get:function(){return l.ID}}],[{key:"create",value:function(e,t,n,i,a,r,o){var s=g.getItemByClass("DrawCircleCmd",l);return s.x=e,s.y=t,s.radius=n,s.fillColor=i,s.lineColor=a,s.lineWidth=r,s.vid=o,s}}]),l}();m.ID="DrawCircle";var w=function(){function o(){S(this,o)}return C(o,[{key:"recover",value:function(){this.points=null,this.lineColor=null,g.recover("DrawCurvesCmd",this)}},{key:"run",value:function(e,t,n){this.points&&e.drawCurves(this.x+t,this.y+n,this.points,this.lineColor,this.lineWidth)}},{key:"cmdID",get:function(){return o.ID}}],[{key:"create",value:function(e,t,n,i,a){var r=g.getItemByClass("DrawCurvesCmd",o);return r.x=e,r.y=t,r.points=n,r.lineColor=i,r.lineWidth=a,r}}]),o}();w.ID="DrawCurves";var x=function(){function o(){S(this,o)}return C(o,[{key:"recover",value:function(){this.texture&&this.texture._removeReference(),this.texture=null,g.recover("DrawImageCmd",this)}},{key:"run",value:function(e,t,n){this.texture&&e.drawTexture(this.texture,this.x+t,this.y+n,this.width,this.height)}},{key:"cmdID",get:function(){return o.ID}}],[{key:"create",value:function(e,t,n,i,a){var r=g.getItemByClass("DrawImageCmd",o);return(r.texture=e)._addReference(),r.x=t,r.y=n,r.width=i,r.height=a,r}}]),o}();x.ID="DrawImage";var k=function(){function l(){S(this,l)}return C(l,[{key:"recover",value:function(){g.recover("DrawLineCmd",this)}},{key:"run",value:function(e,t,n){e._drawLine(t,n,this.fromX,this.fromY,this.toX,this.toY,this.lineColor,this.lineWidth,this.vid)}},{key:"cmdID",get:function(){return l.ID}}],[{key:"create",value:function(e,t,n,i,a,r,o){var s=g.getItemByClass("DrawLineCmd",l);return s.fromX=e,s.fromY=t,s.toX=n,s.toY=i,s.lineColor=a,s.lineWidth=r,s.vid=o,s}}]),l}();k.ID="DrawLine";var E=function(){function s(){S(this,s)}return C(s,[{key:"recover",value:function(){this.points=null,this.lineColor=null,g.recover("DrawLinesCmd",this)}},{key:"run",value:function(e,t,n){this.points&&e._drawLines(this.x+t,this.y+n,this.points,this.lineColor,this.lineWidth,this.vid)}},{key:"cmdID",get:function(){return s.ID}}],[{key:"create",value:function(e,t,n,i,a,r){var o=g.getItemByClass("DrawLinesCmd",s);return o.x=e,o.y=t,o.points=n,o.lineColor=i,o.lineWidth=a,o.vid=r,o}}]),s}();E.ID="DrawLines";var I=function(){function o(){S(this,o)}return C(o,[{key:"recover",value:function(){this.paths=null,this.brush=null,this.pen=null,g.recover("DrawPathCmd",this)}},{key:"run",value:function(e,t,n){this.paths&&e._drawPath(this.x+t,this.y+n,this.paths,this.brush,this.pen)}},{key:"cmdID",get:function(){return o.ID}}],[{key:"create",value:function(e,t,n,i,a){var r=g.getItemByClass("DrawPathCmd",o);return r.x=e,r.y=t,r.paths=n,r.brush=i,r.pen=a,r}}]),o}();I.ID="DrawPath";var N=function(){function u(){S(this,u)}return C(u,[{key:"recover",value:function(){this.fillColor=null,this.lineColor=null,g.recover("DrawPieCmd",this)}},{key:"run",value:function(e,t,n){e._drawPie(this.x+t,this.y+n,this.radius,this._startAngle,this._endAngle,this.fillColor,this.lineColor,this.lineWidth,this.vid)}},{key:"cmdID",get:function(){return u.ID}},{key:"startAngle",get:function(){return 180*this._startAngle/Math.PI},set:function(e){this._startAngle=e*Math.PI/180}},{key:"endAngle",get:function(){return 180*this._endAngle/Math.PI},set:function(e){this._endAngle=e*Math.PI/180}}],[{key:"create",value:function(e,t,n,i,a,r,o,s,l){var h=g.getItemByClass("DrawPieCmd",u);return h.x=e,h.y=t,h.radius=n,h._startAngle=i,h._endAngle=a,h.fillColor=r,h.lineColor=o,h.lineWidth=s,h.vid=l,h}}]),u}();N.ID="DrawPie";var R=function(){function h(){S(this,h)}return C(h,[{key:"recover",value:function(){this.points=null,this.fillColor=null,this.lineColor=null,g.recover("DrawPolyCmd",this)}},{key:"run",value:function(e,t,n){this.points&&e._drawPoly(this.x+t,this.y+n,this.points,this.fillColor,this.lineColor,this.lineWidth,this.isConvexPolygon,this.vid)}},{key:"cmdID",get:function(){return h.ID}}],[{key:"create",value:function(e,t,n,i,a,r,o,s){var l=g.getItemByClass("DrawPolyCmd",h);return l.x=e,l.y=t,l.points=n,l.fillColor=i,l.lineColor=a,l.lineWidth=r,l.isConvexPolygon=o,l.vid=s,l}}]),h}();R.ID="DrawPoly";var A=function(){function l(){S(this,l)}return C(l,[{key:"recover",value:function(){this.fillColor=null,this.lineColor=null,g.recover("DrawRectCmd",this)}},{key:"run",value:function(e,t,n){e.drawRect(this.x+t,this.y+n,this.width,this.height,this.fillColor,this.lineColor,this.lineWidth)}},{key:"cmdID",get:function(){return l.ID}}],[{key:"create",value:function(e,t,n,i,a,r,o){var s=g.getItemByClass("DrawRectCmd",l);return s.x=e,s.y=t,s.width=n,s.height=i,s.fillColor=a,s.lineColor=r,s.lineWidth=o,s}}]),l}();A.ID="DrawRect";var D=function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;if(S(this,s),this._bTransform=!1,null!=s._createFun)return s._createFun(e,t,n,i,a,r,o);this.a=e,this.b=t,this.c=n,this.d=i,this.tx=a,this.ty=r,this._checkTransform()}return C(s,[{key:"identity",value:function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this._bTransform=!1,this}},{key:"_checkTransform",value:function(){return this._bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d}},{key:"setTranslate",value:function(e,t){return this.tx=e,this.ty=t,this}},{key:"translate",value:function(e,t){return this.tx+=e,this.ty+=t,this}},{key:"scale",value:function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this._bTransform=!0,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.a,a=this.c,e=this.tx;return this.a=i*t-this.b*n,this.b=i*n+this.b*t,this.c=a*t-this.d*n,this.d=a*n+this.d*t,this.tx=e*t-this.ty*n,this.ty=e*n+this.ty*t,this._bTransform=!0,this}},{key:"skew",value:function(e,t){var n=Math.tan(e),i=Math.tan(t),e=this.a,t=this.b;return this.a+=i*this.c,this.b+=i*this.d,this.c+=n*e,this.d+=n*t,this}},{key:"invertTransformPoint",value:function(e){var t=this.a,n=this.b,i=this.c,a=this.d,r=this.tx,o=t*a-n*i,s=a/o,l=-n/o,h=-i/o,u=t/o,a=(i*this.ty-a*r)/o,o=-(t*this.ty-n*r)/o;return e.setTo(s*e.x+h*e.y+a,l*e.x+u*e.y+o)}},{key:"transformPoint",value:function(e){return e.setTo(this.a*e.x+this.c*e.y+this.tx,this.b*e.x+this.d*e.y+this.ty)}},{key:"transformPointN",value:function(e){return e.setTo(this.a*e.x+this.c*e.y,this.b*e.x+this.d*e.y)}},{key:"getScaleX",value:function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)}},{key:"getScaleY",value:function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)}},{key:"invert",value:function(){var e=this.a,t=this.b,n=this.c,i=this.d,a=this.tx,r=e*i-t*n;return this.a=i/r,this.b=-t/r,this.c=-n/r,this.d=e/r,this.tx=(n*this.ty-i*a)/r,this.ty=-(e*this.ty-t*a)/r,this}},{key:"setTo",value:function(e,t,n,i,a,r){return this.a=e,this.b=t,this.c=n,this.d=i,this.tx=a,this.ty=r,this}},{key:"concat",value:function(e){var t=this.a,n=this.c,i=this.tx;return this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d,this.tx=i*e.a+this.ty*e.c+e.tx,this.ty=i*e.b+this.ty*e.d+e.ty,this}},{key:"scaleEx",value:function(e,t){var n=this.a,i=this.b,a=this.c,r=this.d;0!==i||0!==a?(this.a=e*n,this.b=e*i,this.c=t*a):(this.a=e*n,this.b=0*r,this.c=0*n),this.d=t*r,this._bTransform=!0}},{key:"rotateEx",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.a,a=this.b,r=this.c,e=this.d;0!==a||0!==r?(this.a=t*i+n*r,this.b=t*a+n*e,this.c=-n*i+t*r,this.d=-n*a+t*e):(this.a=t*i,this.b=n*e,this.c=-n*i,this.d=t*e),this._bTransform=!0}},{key:"clone",value:function(){var e=s.create();return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e._bTransform=this._bTransform,e}},{key:"copyTo",value:function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e._bTransform=this._bTransform,e}},{key:"toString",value:function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty}},{key:"destroy",value:function(){this.recover()}},{key:"recover",value:function(){g.recover("Matrix",this.identity())}}],[{key:"mul",value:function(e,t,n){var i=e.a,a=e.b,r=e.c,o=e.d,s=e.tx,l=e.ty,h=t.a,u=t.b,d=t.c,c=t.d,e=t.tx,t=t.ty;return 0!==u||0!==d?(n.a=i*h+a*d,n.b=i*u+a*c,n.c=r*h+o*d,n.d=r*u+o*c,n.tx=h*s+d*l+e,n.ty=u*s+c*l+t):(n.a=i*h,n.b=a*c,n.c=r*h,n.d=o*c,n.tx=h*s+e,n.ty=c*l+t),n}},{key:"mul16",value:function(e,t,n){var i=e.a,a=e.b,r=e.c,o=e.d,s=e.tx,l=e.ty,h=t.a,u=t.b,d=t.c,c=t.d,e=t.tx,t=t.ty;return 0!==u||0!==d?(n[0]=i*h+a*d,n[1]=i*u+a*c,n[4]=r*h+o*d,n[5]=r*u+o*c,n[12]=h*s+d*l+e,n[13]=u*s+c*l+t):(n[0]=i*h,n[1]=a*c,n[4]=r*h,n[5]=o*c,n[12]=h*s+e,n[13]=c*l+t),n}},{key:"create",value:function(){return g.getItemByClass("Matrix",s)}}]),s}();D.EMPTY=new D,D.TEMP=new D,D._createFun=null;var L=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;S(this,n),this.x=e,this.y=t}return C(n,[{key:"setTo",value:function(e,t){return this.x=e,this.y=t,this}},{key:"reset",value:function(){return this.x=this.y=0,this}},{key:"recover",value:function(){g.recover("Point",this.reset())}},{key:"distance",value:function(e,t){return Math.sqrt((this.x-e)*(this.x-e)+(this.y-t)*(this.y-t))}},{key:"toString",value:function(){return this.x+","+this.y}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);0<e&&(e=1/e,this.x*=e,this.y*=e)}},{key:"copy",value:function(e){return this.setTo(e.x,e.y)}}],[{key:"create",value:function(){return g.getItemByClass("Point",n)}}]),n}();L.TEMP=new L,L.EMPTY=new L;var O=function(){function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;S(this,h),this.x=e,this.y=t,this.width=n,this.height=i}return C(h,[{key:"setTo",value:function(e,t,n,i){return this.x=e,this.y=t,this.width=n,this.height=i,this}},{key:"reset",value:function(){return this.x=this.y=this.width=this.height=0,this}},{key:"recover",value:function(){this!=h.TEMP&&this!=h.EMPTY?g.recover("Rectangle",this.reset()):console.log("recover Temp or Empty:",this)}},{key:"copyFrom",value:function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}},{key:"contains",value:function(e,t){return!(this.width<=0||this.height<=0)&&(e>=this.x&&e<this.right&&t>=this.y&&t<this.bottom)}},{key:"intersects",value:function(e){return!(e.x>this.x+this.width||e.x+e.width<this.x||e.y>this.y+this.height||e.y+e.height<this.y)}},{key:"intersection",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return this.intersects(e)?((t=t||new h).x=Math.max(this.x,e.x),t.y=Math.max(this.y,e.y),t.width=Math.min(this.right,e.right)-t.x,t.height=Math.min(this.bottom,e.bottom)-t.y,t):null}},{key:"union",value:function(e){var t=(t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||new h;return this.clone(t),e.width<=0||e.height<=0?t:(t.addPoint(e.x,e.y),t.addPoint(e.right,e.bottom),this)}},{key:"clone",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return(e=e||new h).x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}},{key:"toString",value:function(){return this.x+","+this.y+","+this.width+","+this.height}},{key:"equals",value:function(e){return!(!e||e.x!==this.x||e.y!==this.y||e.width!==this.width||e.height!==this.height)}},{key:"addPoint",value:function(e,t){return this.x>e&&(this.width+=this.x-e,this.x=e),this.y>t&&(this.height+=this.y-t,this.y=t),this.width<e-this.x&&(this.width=e-this.x),this.height<t-this.y&&(this.height=t-this.y),this}},{key:"_getBoundPoints",value:function(){var e=h._temB;return(e.length=0)==this.width||0==this.height||e.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),e}},{key:"isEmpty",value:function(){return this.width<=0||this.height<=0}},{key:"right",get:function(){return this.x+this.width}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"create",value:function(){return g.getItemByClass("Rectangle",h)}},{key:"_getBoundPointS",value:function(e,t,n,i){var a=h._temA;return(a.length=0)==n||0==i||a.push(e,t,e+n,t,e,t+i,e+n,t+i),a}},{key:"_getWrapRec",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!e||e.length<1)return(t||h.TEMP).setTo(0,0,0,0);t=t||h.create();for(var n,i,a=e.length,r=L.TEMP,o=n=99999,s=i=-o,l=0;l<a;l+=2)r.x=e[l],r.y=e[l+1],o=o<r.x?o:r.x,n=n<r.y?n:r.y,s=s>r.x?s:r.x,i=i>r.y?i:r.y;return t.setTo(o,n,s-o,i-n)}}]),h}();O.EMPTY=new O,O.TEMP=new O,O._temB=[],O._temA=[];var P=function e(){S(this,e)};P.ARRAY_BUFFER_TYPE_DATA=0,P.ARRAY_BUFFER_TYPE_CMD=1,P.ARRAY_BUFFER_REF_REFERENCE=0,P.ARRAY_BUFFER_REF_COPY=1,P.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,P.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1;var y=function(){function r(){S(this,r)}return C(r,null,[{key:"__init__",value:function(){var e=P.instance;r._depthFunc=e.LESS,r._blendEquation=e.FUNC_ADD,r._blendEquationRGB=e.FUNC_ADD,r._blendEquationAlpha=e.FUNC_ADD,r._sFactor=e.ONE,r._dFactor=e.ZERO,r._sFactorAlpha=e.ONE,r._dFactorAlpha=e.ZERO,r._activedTextureID=e.TEXTURE0,r._glTextureIDs=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7]}},{key:"useProgram",value:function(e,t){return r._useProgram!==t&&(e.useProgram(t),r._useProgram=t,!0)}},{key:"setDepthTest",value:function(e,t){t!==r._depthTest&&((r._depthTest=t)?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST))}},{key:"setDepthMask",value:function(e,t){t!==r._depthMask&&(r._depthMask=t,e.depthMask(t))}},{key:"setDepthFunc",value:function(e,t){t!==r._depthFunc&&(r._depthFunc=t,e.depthFunc(t))}},{key:"setBlend",value:function(e,t){t!==r._blend&&((r._blend=t)?e.enable(e.BLEND):e.disable(e.BLEND))}},{key:"setBlendEquation",value:function(e,t){t!==r._blendEquation&&(r._blendEquation=t,r._blendEquationRGB=r._blendEquationAlpha=null,e.blendEquation(t))}},{key:"setBlendEquationSeparate",value:function(e,t,n){t===r._blendEquationRGB&&n===r._blendEquationAlpha||(r._blendEquationRGB=t,r._blendEquationAlpha=n,r._blendEquation=null,e.blendEquationSeparate(t,n))}},{key:"setBlendFunc",value:function(e,t,n){t===r._sFactor&&n===r._dFactor||(r._sFactor=t,r._dFactor=n,r._sFactorRGB=null,r._dFactorRGB=null,r._sFactorAlpha=null,r._dFactorAlpha=null,e.blendFunc(t,n))}},{key:"setBlendFuncSeperate",value:function(e,t,n,i,a){t===r._sFactorRGB&&n===r._dFactorRGB&&i===r._sFactorAlpha&&a===r._dFactorAlpha||(r._sFactorRGB=t,r._dFactorRGB=n,r._sFactorAlpha=i,r._dFactorAlpha=a,r._sFactor=null,r._dFactor=null,e.blendFuncSeparate(t,n,i,a))}},{key:"setCullFace",value:function(e,t){t!==r._cullFace&&((r._cullFace=t)?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE))}},{key:"setFrontFace",value:function(e,t){t!==r._frontFace&&(r._frontFace=t,e.frontFace(t))}},{key:"activeTexture",value:function(e,t){r._activedTextureID!==t&&(e.activeTexture(t),r._activedTextureID=t)}},{key:"bindTexture",value:function(e,t,n){r._activeTextures[r._activedTextureID-e.TEXTURE0]!==n&&(e.bindTexture(t,n),r._activeTextures[r._activedTextureID-e.TEXTURE0]=n)}},{key:"__init_native",value:function(){var e;M.Render.supportWebGLPlusRendering&&((e=r).activeTexture=e.activeTextureForNative,e.bindTexture=e.bindTextureForNative)}},{key:"useProgramForNative",value:function(e,t){return e.useProgram(t),!0}},{key:"setDepthTestForNative",value:function(e,t){t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)}},{key:"setDepthMaskForNative",value:function(e,t){e.depthMask(t)}},{key:"setDepthFuncForNative",value:function(e,t){e.depthFunc(t)}},{key:"setBlendForNative",value:function(e,t){t?e.enable(e.BLEND):e.disable(e.BLEND)}},{key:"setBlendFuncForNative",value:function(e,t,n){e.blendFunc(t,n)}},{key:"setCullFaceForNative",value:function(e,t){t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE)}},{key:"setFrontFaceForNative",value:function(e,t){e.frontFace(t)}},{key:"activeTextureForNative",value:function(e,t){e.activeTexture(t)}},{key:"bindTextureForNative",value:function(e,t,n){e.bindTexture(t,n)}},{key:"bindVertexArrayForNative",value:function(e,t){e.bindVertexArray(t)}}]),r}();y._activeTextures=new Array(8),y._useProgram=null,y._depthTest=!0,y._depthMask=!0,y._blend=!1,y._cullFace=!1,y.mainContext=null;var F=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];S(this,a),this.once=!1,this._id=0,this.setTo(e,t,n,i)}return C(a,[{key:"setTo",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return this._id=a._gid++,this.caller=e,this.method=t,this.args=n,this.once=i,this}},{key:"run",value:function(){if(null==this.method)return null;var e=this._id,t=this.method.apply(this.caller,this.args);return this._id===e&&this.once&&this.recover(),t}},{key:"runWith",value:function(e){if(null==this.method)return null;var t=this._id,e=null==e?this.method.apply(this.caller,this.args):this.args||e.unshift?this.args?this.method.apply(this.caller,this.args.concat(e)):this.method.apply(this.caller,e):this.method.call(this.caller,e);return this._id===t&&this.once&&this.recover(),e}},{key:"clear",value:function(){return this.caller=null,this.method=null,this.args=null,this}},{key:"recover",value:function(){0<this._id&&(this._id=0,a._pool.push(this.clear()))}}],[{key:"create",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return a._pool.length?a._pool.pop().setTo(e,t,n,i):new a(e,t,n,i)}}]),a}();F._pool=[],F._gid=1;var d=function(){function t(){S(this,t)}return C(t,[{key:"hasListener",value:function(e){return!!(this._events&&this._events[e])}},{key:"event",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!this._events||!this._events[e])return!1;var n=this._events[e];if(n.run)n.once&&delete this._events[e],null!=t?n.runWith(t):n.run();else{for(var i=0,a=n.length;i<a;i++){var r=n[i];r&&(null!=t?r.runWith(t):r.run()),r&&!r.once||(n.splice(i,1),i--,a--)}0===n.length&&this._events&&delete this._events[e]}return!0}},{key:"on",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return this._createListener(e,t,n,i,!1)}},{key:"once",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return this._createListener(e,t,n,i,!0)}},{key:"_createListener",value:function(e,t,n,i,a){5<arguments.length&&void 0!==arguments[5]&&!arguments[5]||this.off(e,t,n,a);i=_.create(t||this,n,i,a);this._events||(this._events={});a=this._events;return a[e]?a[e].run?a[e]=[a[e],i]:a[e].push(i):a[e]=i,this}},{key:"off",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(!this._events||!this._events[e])return this;var a=this._events[e];if(null!=a)if(a.run)t&&a.caller!==t||null!=n&&a.method!==n||i&&!a.once||(delete this._events[e],a.recover());else{for(var r=0,o=0,s=a.length;o<s;o++){var l=a[o];l?!l||t&&l.caller!==t||null!=n&&l.method!==n||i&&!l.once||(r++,a[o]=null,l.recover()):r++}r===s&&delete this._events[e]}return this}},{key:"offAll",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=this._events;if(!t)return this;if(e)this._recoverHandlers(t[e]),delete t[e];else{for(var n in t)this._recoverHandlers(t[n]);this._events=null}return this}},{key:"offAllCaller",value:function(e){if(e&&this._events)for(var t in this._events)this.off(t,e,null);return this}},{key:"_recoverHandlers",value:function(e){if(e)if(e.run)e.recover();else for(var t=e.length-1;-1<t;t--)e[t]&&(e[t].recover(),e[t]=null)}},{key:"isMouseEvent",value:function(e){return t.MOUSE_EVENTS[e]||!1}}]),t}();d.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0};var _=function(){T(r,F);var a=b(r);function r(e,t,n,i){return S(this,r),a.call(this,e,t,n,i)}return C(r,[{key:"recover",value:function(){0<this._id&&(this._id=0,r._pool.push(this.clear()))}}],[{key:"create",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return r._pool.length?r._pool.pop().setTo(e,t,n,i):new r(e,t,n,i)}}]),r}();_._pool=[];var B=function(){function a(e){S(this,a),this._url=a.formatURL(e),this._path=a.getPath(e)}return C(a,[{key:"url",get:function(){return this._url}},{key:"path",get:function(){return this._path}}],[{key:"formatURL",value:function(e){if(!e)return"null path";if(0<e.indexOf(":"))return e;if(0<(e=null!=a.customFormat?a.customFormat(e):e).indexOf(":"))return e;var t=e.charAt(0);if("."===t)return a._formatRelativePath(a._basePath+e);if("~"===t)return a.rootPath+e.substring(1);if("d"===t){if(0===e.indexOf("data:image"))return e}else if("/"===t)return e;return a._basePath+e}},{key:"_formatRelativePath",value:function(e){for(var t=e.split("/"),n=0,i=t.length;n<i;n++)".."==t[n]&&(t.splice(n-1,2),n-=2);return t.join("/")}},{key:"getPath",value:function(e){var t=e.lastIndexOf("/");return 0<t?e.substr(0,t+1):""}},{key:"getFileName",value:function(e){var t=e.lastIndexOf("/");return 0<t?e.substr(t+1):e}},{key:"getAdptedFilePath",value:function(e){if(!a.exportSceneToJson||!e)return e;for(var t,n=a._adpteTypeList.length,i=0;i<n;i++)t=a._adpteTypeList[i],e=e.replace(t[0],t[1]);return e}},{key:"basePath",set:function(e){a._basePath=M.Laya._getUrlPath(),a._basePath=a.formatURL(e)},get:function(){return a._basePath}}]),a}();B.version={},B.exportSceneToJson=!1,B._basePath="",B.rootPath="",B.customFormat=function(e){var t=B.version[e];return!window.conch&&t&&(e+="?v="+t),e},B._adpteTypeList=[[".scene3d",".json"],[".scene",".json"],[".taa",".json"],[".prefab",".json"]];var V=function(){T(n,d);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._id=0,e._url=null,e._cpuMemory=0,e._gpuMemory=0,e._destroyed=!1,e._referenceCount=0,e.lock=!1,e.name=null,e._id=++n._uniqueIDCounter,e._destroyed=!1,e._referenceCount=0,n._idResourcesMap[e.id]=u(e),e.lock=!1,e}return C(n,[{key:"_setCPUMemory",value:function(e){var t=e-this._cpuMemory;this._cpuMemory=e,n._addCPUMemory(t)}},{key:"_setGPUMemory",value:function(e){var t=e-this._gpuMemory;this._gpuMemory=e,n._addGPUMemory(t)}},{key:"_setCreateURL",value:function(e){var t;e=B.formatURL(e),this._url!==e&&(this._url&&((t=n._urlResourcesMap[this._url]).splice(t.indexOf(this),1),0===t.length&&delete n._urlResourcesMap[this._url]),e&&((t=n._urlResourcesMap[e])||(n._urlResourcesMap[e]=t=[]),t.push(this)),this._url=e)}},{key:"_addReference",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this._referenceCount+=e}},{key:"_removeReference",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this._referenceCount-=e}},{key:"_clearReference",value:function(){this._referenceCount=0}},{key:"_recoverResource",value:function(){}},{key:"_disposeResource",value:function(){}},{key:"_activeResource",value:function(){}},{key:"destroy",value:function(){var e;this._destroyed||(this._destroyed=!0,this.lock=!1,this._disposeResource(),delete n._idResourcesMap[this.id],this._url&&((e=n._urlResourcesMap[this._url])&&(e.splice(e.indexOf(this),1),0===e.length&&delete n._urlResourcesMap[this._url]),M.Loader.loadedMap[this._url]==this&&delete M.Loader.loadedMap[this._url]))}},{key:"id",get:function(){return this._id}},{key:"url",get:function(){return this._url}},{key:"cpuMemory",get:function(){return this._cpuMemory}},{key:"gpuMemory",get:function(){return this._gpuMemory}},{key:"destroyed",get:function(){return this._destroyed}},{key:"referenceCount",get:function(){return this._referenceCount}}],[{key:"_addCPUMemory",value:function(e){n._cpuMemory+=e}},{key:"_addGPUMemory",value:function(e){n._gpuMemory+=e}},{key:"_addMemory",value:function(e,t){n._cpuMemory+=e,n._gpuMemory+=t}},{key:"getResourceByID",value:function(e){return n._idResourcesMap[e]}},{key:"getResourceByURL",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return n._urlResourcesMap[e][t]}},{key:"destroyUnusedResources",value:function(){for(var e in n._idResourcesMap){var t=n._idResourcesMap[e];t.lock||0!==t._referenceCount||t.destroy()}}},{key:"cpuMemory",get:function(){return n._cpuMemory}},{key:"gpuMemory",get:function(){return n._gpuMemory}}]),n}();V._uniqueIDCounter=0,V._idResourcesMap={},V._urlResourcesMap={},V._cpuMemory=0,V._gpuMemory=0;var f,v=function(){T(n,V);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._width=-1,e._height=-1,e}return C(n,[{key:"_getSource",value:function(){throw"Bitmap: must override it."}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}},{key:"height",get:function(){return this._height},set:function(e){this._height=e}}]),n}();(cn=f=f||{})[cn.R8G8B8=0]="R8G8B8",cn[cn.R8G8B8A8=1]="R8G8B8A8",cn[cn.Alpha8=2]="Alpha8",cn[cn.DXT1=3]="DXT1",cn[cn.DXT5=4]="DXT5",cn[cn.ETC1RGB=5]="ETC1RGB",cn[cn.PVRTCRGB_2BPPV=9]="PVRTCRGB_2BPPV",cn[cn.PVRTCRGBA_2BPPV=10]="PVRTCRGBA_2BPPV",cn[cn.PVRTCRGB_4BPPV=11]="PVRTCRGB_4BPPV",cn[cn.PVRTCRGBA_4BPPV=12]="PVRTCRGBA_4BPPV",cn[cn.R32G32B32A32=15]="R32G32B32A32";var U=function(){T(a,v);var i=b(a);function a(e,t){var n;return S(this,a),(n=i.call(this))._wrapModeU=a.WARPMODE_REPEAT,n._wrapModeV=a.WARPMODE_REPEAT,n._filterMode=a.FILTERMODE_BILINEAR,n._readyed=!1,n._width=-1,n._height=-1,n._format=e,n._mipmap=t,n._anisoLevel=1,n._glTexture=P.instance.createTexture(),n}return C(a,[{key:"_getFormatByteCount",value:function(){switch(this._format){case f.R8G8B8:return 3;case f.R8G8B8A8:return 4;case f.Alpha8:return 1;case f.R32G32B32A32:return 4;default:throw"Texture2D: unknown format."}}},{key:"_isPot",value:function(e){return 0==(e&e-1)}},{key:"_getGLFormat",value:function(){var e,t=P.instance,n=P.layaGPUInstance;switch(this._format){case f.R8G8B8:e=t.RGB;break;case f.R8G8B8A8:e=t.RGBA;break;case f.Alpha8:e=t.ALPHA;break;case f.R32G32B32A32:e=t.RGBA;break;case f.DXT1:if(!n._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";e=n._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case f.DXT5:if(!n._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";e=n._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case f.ETC1RGB:if(!n._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";e=n._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case f.PVRTCRGB_2BPPV:if(!n._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";e=n._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case f.PVRTCRGBA_2BPPV:if(!n._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";e=n._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case f.PVRTCRGB_4BPPV:if(!n._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";e=n._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case f.PVRTCRGBA_4BPPV:if(!n._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";e=n._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return e}},{key:"_setFilterMode",value:function(e){var t=P.instance;switch(y.bindTexture(t,this._glTextureType,this._glTexture),e){case a.FILTERMODE_POINT:this._mipmap?t.texParameteri(this._glTextureType,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(this._glTextureType,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(this._glTextureType,t.TEXTURE_MAG_FILTER,t.NEAREST);break;case a.FILTERMODE_BILINEAR:this._mipmap?t.texParameteri(this._glTextureType,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(this._glTextureType,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(this._glTextureType,t.TEXTURE_MAG_FILTER,t.LINEAR);break;case a.FILTERMODE_TRILINEAR:this._mipmap?t.texParameteri(this._glTextureType,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR):t.texParameteri(this._glTextureType,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(this._glTextureType,t.TEXTURE_MAG_FILTER,t.LINEAR);break;default:throw new Error("BaseTexture:unknown filterMode value.")}}},{key:"_setWarpMode",value:function(e,t){var n=P.instance;if(y.bindTexture(n,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(t){case a.WARPMODE_REPEAT:n.texParameteri(this._glTextureType,e,n.REPEAT);break;case a.WARPMODE_CLAMP:n.texParameteri(this._glTextureType,e,n.CLAMP_TO_EDGE)}else n.texParameteri(this._glTextureType,e,n.CLAMP_TO_EDGE)}},{key:"_setAnisotropy",value:function(e){var t,n=P.layaGPUInstance._extTextureFilterAnisotropic;n&&(e=Math.max(e,1),t=P.instance,y.bindTexture(t,this._glTextureType,this._glTexture),e=Math.min(t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT),e),t.texParameterf(this._glTextureType,n.TEXTURE_MAX_ANISOTROPY_EXT,e))}},{key:"_disposeResource",value:function(){this._glTexture&&(P.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))}},{key:"_getSource",value:function(){return this._readyed?this._glTexture:null}},{key:"generateMipmap",value:function(){this._isPot(this.width)&&this._isPot(this.height)&&P.instance.generateMipmap(this._glTextureType)}},{key:"mipmap",get:function(){return this._mipmap}},{key:"format",get:function(){return this._format}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){this._wrapModeU!==e&&(this._wrapModeU=e,-1!==this._width&&this._setWarpMode(P.instance.TEXTURE_WRAP_S,e))}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){this._wrapModeV!==e&&(this._wrapModeV=e,-1!==this._height&&this._setWarpMode(P.instance.TEXTURE_WRAP_T,e))}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,-1!==this._width&&-1!==this._height&&this._setFilterMode(e))}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){e!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,e)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(e))}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"defaulteTexture",get:function(){throw"BaseTexture:must override it."}}]),a}();U.WARPMODE_REPEAT=0,U.WARPMODE_CLAMP=1,U.FILTERMODE_POINT=0,U.FILTERMODE_BILINEAR=1,U.FILTERMODE_TRILINEAR=2,U.FORMAT_R8G8B8=0,U.FORMAT_R8G8B8A8=1,U.FORMAT_ALPHA8=2,U.FORMAT_DXT1=3,U.FORMAT_DXT5=4,U.FORMAT_ETC1RGB=5,U.FORMAT_PVRTCRGB_2BPPV=9,U.FORMAT_PVRTCRGBA_2BPPV=10,U.FORMAT_PVRTCRGB_4BPPV=11,U.FORMAT_PVRTCRGBA_4BPPV=12,U.RENDERTEXTURE_FORMAT_RGBA_HALF_FLOAT=14,U.FORMAT_R32G32B32A32=15,U.FORMAT_DEPTH_16=0,U.FORMAT_STENCIL_8=1,U.FORMAT_DEPTHSTENCIL_16_8=2,U.FORMAT_DEPTHSTENCIL_NONE=3;var X=function(){T(l,U);var s=b(l);function l(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:f.R8G8B8A8,a=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],r=4<arguments.length&&void 0!==arguments[4]&&arguments[4];S(this,l),e=s.call(this,i,a);a=P.instance;if(e._glTextureType=a.TEXTURE_2D,e._width=t,e._height=n,e._canRead=r,e._setWarpMode(a.TEXTURE_WRAP_S,e._wrapModeU),e._setWarpMode(a.TEXTURE_WRAP_T,e._wrapModeV),e._setFilterMode(e._filterMode),e._setAnisotropy(e._anisoLevel),e._mipmap){e._mipmapCount=Math.max(Math.ceil(Math.log2(t))+1,Math.ceil(Math.log2(n))+1);for(var o=0;o<e._mipmapCount;o++)e._setPixels(null,o,Math.max(t>>o,1),Math.max(n>>o,1));e._setGPUMemory(t*n*4*(1+1/3))}else e._mipmapCount=1,e._setPixels(null,0,t,n),e._setGPUMemory(t*n*4);return e}return C(l,[{key:"_setPixels",value:function(e,t,n,i){var a=P.instance,r=this._glTextureType,o=this._getGLFormat();switch(y.bindTexture(a,r,this._glTexture),this.format){case f.R8G8B8:a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(r,t,o,n,i,0,o,a.UNSIGNED_BYTE,e),a.pixelStorei(a.UNPACK_ALIGNMENT,4);break;case f.R32G32B32A32:P.layaGPUInstance._isWebGL2?a.texImage2D(r,t,a.RGBA32F,n,i,0,o,a.FLOAT,e):a.texImage2D(r,t,a.RGBA,n,i,0,o,a.FLOAT,e);break;default:a.texImage2D(r,t,o,n,i,0,o,a.UNSIGNED_BYTE,e)}}},{key:"_calcualatesCompressedDataSize",value:function(e,t,n){switch(e){case f.DXT1:case f.ETC1RGB:return(t+3>>2)*(n+3>>2)*8;case f.DXT5:return(t+3>>2)*(n+3>>2)*16;case f.PVRTCRGB_4BPPV:case f.PVRTCRGBA_4BPPV:return Math.floor((Math.max(t,8)*Math.max(n,8)*4+7)/8);case f.PVRTCRGB_2BPPV:case f.PVRTCRGBA_2BPPV:return Math.floor((Math.max(t,16)*Math.max(n,8)*2+7)/8);default:return 0}}},{key:"_pharseDDS",value:function(e){var t=new Int32Array(e,0,31);if(542327876!=t[0])throw"Invalid magic number in DDS header";if(!(4&t[20]))throw"Unsupported format, must contain a FourCC code";var n=t[21];switch(this._format){case f.DXT1:if(827611204!==n)throw"the FourCC code is not same with texture format.";break;case f.DXT5:if(894720068!==n)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var i=1;if(131072&t[2]){if(i=Math.max(1,t[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var a=t[4],r=t[3];this._width=a,this._height=r;t=t[1]+4;this._upLoadCompressedTexImage2D(e,a,r,i,t,0)}},{key:"_pharseKTX",value:function(e){var t=new Uint8Array(e,0,12);if(171!=t[0]||75!=t[1]||84!=t[2]||88!=t[3]||32!=t[4]||49!=t[5]||49!=t[6]||187!=t[7]||13!=t[8]||10!=t[9]||26!=t[10]||10!=t[11])throw"Invalid fileIdentifier in KTX header";var n=new Int32Array(t.buffer,t.length,13),i=n[4];if(i!==P.layaGPUInstance._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL)throw"unknown texture format.";this._format=f.ETC1RGB;var a=n[11],t=n[6],i=n[7];this._width=t,this._height=i;n=64+n[12];this._upLoadCompressedTexImage2D(e,t,i,a,n,4)}},{key:"_pharsePVR",value:function(e){var t=new Int32Array(e,0,13);if(55727696!=t[0])throw"Invalid magic number in PVR header";switch(t[2]){case 0:this._format=f.PVRTCRGB_2BPPV;break;case 2:this._format=f.PVRTCRGB_4BPPV;break;case 1:this._format=f.PVRTCRGBA_2BPPV;break;case 3:this._format=f.PVRTCRGBA_4BPPV;break;default:throw"Texture2D:unknown PVR format."}var n=t[11],i=t[7],a=t[6];this._width=i,this._height=a;t=t[12]+52;this._upLoadCompressedTexImage2D(e,i,a,n,t,0)}},{key:"_upLoadCompressedTexImage2D",value:function(e,t,n,i,a,r){var o=P.instance,s=this._glTextureType;y.bindTexture(o,s,this._glTexture);for(var l=this._getGLFormat(),h=a,u=0;u<i;u++){h+=r;var d=this._calcualatesCompressedDataSize(this._format,t,n),c=new Uint8Array(e,h,d);o.compressedTexImage2D(s,u,l,t,n,0,c),t=Math.max(t>>1,1),n=Math.max(n>>1,1),h+=d}this._setGPUMemory(h),this._readyed=!0,this._activeResource()}},{key:"loadImageSource",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=P.instance,i=e.width,a=e.height;this._width=i,this._height=a,this._isPot(i)&&this._isPot(a)||(this._mipmap=!1),this._setWarpMode(n.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(n.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),y.bindTexture(n,this._glTextureType,this._glTexture);var r=this._getGLFormat();M.Render.isConchApp?(e.setPremultiplyAlpha&&e.setPremultiplyAlpha(t),n.texImage2D(this._glTextureType,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)):(t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n.texImage2D(this._glTextureType,0,r,r,n.UNSIGNED_BYTE,e),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),this._mipmap?(n.generateMipmap(this._glTextureType),this._setGPUMemory(i*a*4*(1+1/3))):this._setGPUMemory(i*a*4),this._canRead&&(M.Render.isConchApp?this._pixels=new Uint8Array(e._nativeObj.getImageData(0,0,i,a)):(M.Browser.canvas.size(i,a),M.Browser.canvas.clear(),M.Browser.context.drawImage(e,0,0,i,a),this._pixels=new Uint8Array(M.Browser.context.getImageData(0,0,i,a).data.buffer))),this._readyed=!0,this._activeResource()}},{key:"setPixels",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!e)throw"Texture2D:pixels can't be null.";var n=Math.max(this._width>>t,1),i=Math.max(this._height>>t,1),a=n*i*this._getFormatByteCount();if(e.length<a)throw"Texture2D:pixels length should at least "+a+".";this._setPixels(e,t,n,i),this._canRead&&(this._pixels=e),this._readyed=!0,this._activeResource()}},{key:"setSubPixels",value:function(e,t,n,i,a){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;if(!a)throw"Texture2D:pixels can't be null.";var o=P.instance,s=this._glTextureType;y.bindTexture(o,s,this._glTexture);var l=this._getGLFormat();switch(this.format){case f.R8G8B8:o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.texSubImage2D(s,r,e,t,n,i,l,o.UNSIGNED_BYTE,a),o.pixelStorei(o.UNPACK_ALIGNMENT,4);break;case f.R32G32B32A32:o.texSubImage2D(s,r,e,t,n,i,l,o.FLOAT,a);break;default:o.texSubImage2D(s,r,e,t,n,i,l,o.UNSIGNED_BYTE,a)}this._readyed=!0,this._activeResource()}},{key:"setCompressData",value:function(e){switch(this._format){case f.DXT1:case f.DXT5:this._pharseDDS(e);break;case f.ETC1RGB:this._pharseKTX(e);break;case f.PVRTCRGB_2BPPV:case f.PVRTCRGBA_2BPPV:case f.PVRTCRGB_4BPPV:case f.PVRTCRGBA_4BPPV:this._pharsePVR(e);break;default:throw"Texture2D:unkonwn format."}}},{key:"_recoverResource",value:function(){}},{key:"getPixels",value:function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")}},{key:"defaulteTexture",get:function(){return l.grayTexture}}],[{key:"__init__",value:function(){var e=new Uint8Array(3);e[0]=128,e[1]=128,e[2]=128,(l.grayTexture=new l(1,1,f.R8G8B8,!1,!1)).setPixels(e),l.grayTexture.lock=!0,e[0]=255,e[1]=255,e[2]=255,(l.whiteTexture=new l(1,1,f.R8G8B8,!1,!1)).setPixels(e),l.whiteTexture.lock=!0,e[0]=0,e[1]=0,e[2]=0,(l.blackTexture=new l(1,1,f.R8G8B8,!1,!1)).setPixels(e),l.blackTexture.lock=!0}},{key:"_parse",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=n?new l(n[0],n[1],n[2],n[3],n[4]):new l(0,0);switch(t&&(i.wrapModeU=t.wrapModeU,i.wrapModeV=t.wrapModeV,i.filterMode=t.filterMode,i.anisoLevel=t.anisoLevel),i._format){case f.R8G8B8:case f.R8G8B8A8:i.loadImageSource(e);break;case f.DXT1:case f.DXT5:case f.ETC1RGB:case f.PVRTCRGB_2BPPV:case f.PVRTCRGBA_2BPPV:case f.PVRTCRGB_4BPPV:case f.PVRTCRGBA_4BPPV:i.setCompressData(e);break;default:throw"Texture2D:unkonwn format."}return i}},{key:"load",value:function(e,t){M.loader.create(e,t,null,M.Loader.TEXTURE2D)}}]),l}();X.TEXTURE2D="TEXTURE2D",X.grayTexture=null,X.whiteTexture=null,X.blackTexture=null;var H,Y,W=function(){T(t,V);var e=b(t);function t(){return S(this,t),e.call(this)}return t}(),j=function(){function i(){S(this,i)}return C(i,null,[{key:"mat2MatArray",value:function(e,t){var n=e,e=t;return e[0]=n.a,e[1]=n.b,e[2]=i.EMPTYMAT4_ARRAY[2],e[3]=i.EMPTYMAT4_ARRAY[3],e[4]=n.c,e[5]=n.d,e[6]=i.EMPTYMAT4_ARRAY[6],e[7]=i.EMPTYMAT4_ARRAY[7],e[8]=i.EMPTYMAT4_ARRAY[8],e[9]=i.EMPTYMAT4_ARRAY[9],e[10]=i.EMPTYMAT4_ARRAY[10],e[11]=i.EMPTYMAT4_ARRAY[11],e[12]=n.tx,e[13]=n.ty,e[14]=i.EMPTYMAT4_ARRAY[14],e[15]=i.EMPTYMAT4_ARRAY[15],t}},{key:"restoreTempArray",value:function(){i.TEMPMAT4_ARRAY[0]=1,i.TEMPMAT4_ARRAY[1]=0,i.TEMPMAT4_ARRAY[4]=0,i.TEMPMAT4_ARRAY[5]=1,i.TEMPMAT4_ARRAY[12]=0,i.TEMPMAT4_ARRAY[13]=0}},{key:"clear",value:function(){i.worldScissorTest=!1,i.worldAlpha=1}}]),i}();j._MAXSIZE=99999999,j.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],j.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],j.worldMatrix4=j.TEMPMAT4_ARRAY,j.worldMatrix=new D,j.matWVP=null,j.worldAlpha=1,j.worldScissorTest=!1,j.width=0,j.height=0,(mn=H=H||{})[mn.R8G8B8=0]="R8G8B8",mn[mn.R8G8B8A8=1]="R8G8B8A8",mn[mn.Alpha8=2]="Alpha8",mn[mn.R16G16B16A16=14]="R16G16B16A16",(En=Y=Y||{})[En.DEPTH_16=0]="DEPTH_16",En[En.STENCIL_8=1]="STENCIL_8",En[En.DEPTHSTENCIL_16_8=2]="DEPTHSTENCIL_16_8",En[En.DEPTHSTENCIL_NONE=3]="DEPTHSTENCIL_NONE";var q=function(){T(r,U);var a=b(r);function r(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:H.R8G8B8,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Y.DEPTH_16;return S(this,r),(n=a.call(this,n,!1))._mgrKey=0,n._glTextureType=P.instance.TEXTURE_2D,n._width=e,n._height=t,n._depthStencilFormat=i,n._create(e,t),n.lock=!0,n}return C(r,[{key:"getIsReady",value:function(){return!0}},{key:"_create",value:function(e,t){var n=P.instance;this._frameBuffer=n.createFramebuffer(),y.bindTexture(n,this._glTextureType,this._glTexture);var i=this._getGLFormat();if(n.texImage2D(this._glTextureType,0,i,e,t,0,i,n.UNSIGNED_BYTE,null),this._setGPUMemory(e*t*4),n.bindFramebuffer(n.FRAMEBUFFER,this._frameBuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this._glTexture,0),this._depthStencilFormat!==Y.DEPTHSTENCIL_NONE)switch(this._depthStencilBuffer=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this._depthStencilBuffer),this._depthStencilFormat){case Y.DEPTH_16:n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this._depthStencilBuffer);break;case Y.STENCIL_8:n.renderbufferStorage(n.RENDERBUFFER,n.STENCIL_INDEX8,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,this._depthStencilBuffer);break;case Y.DEPTHSTENCIL_16_8:n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this._depthStencilBuffer)}n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindRenderbuffer(n.RENDERBUFFER,null),this._setWarpMode(n.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(n.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()}},{key:"generateMipmap",value:function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,P.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))}},{key:"start",value:function(){var e=P.instance;P.instance.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),this._lastRT=r._currentActive,(r._currentActive=this)._readyed=!0,e.viewport(0,0,this._width,this._height),this._lastWidth=j.width,this._lastHeight=j.height,j.width=this._width,j.height=this._height,W.activeShader=null}},{key:"end",value:function(){var e=P.instance;e.bindFramebuffer(e.FRAMEBUFFER,null),r._currentActive=null,this._readyed=!0}},{key:"restore",value:function(){var e=P.instance;this._lastRT!=r._currentActive&&(P.instance.bindFramebuffer(e.FRAMEBUFFER,this._lastRT?this._lastRT._frameBuffer:null),r._currentActive=this._lastRT),this._readyed=!0,e.viewport(0,0,this._lastWidth,this._lastHeight),j.width=this._lastWidth,j.height=this._lastHeight,W.activeShader=null}},{key:"clear",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=P.instance;a.clearColor(e,t,n,i);var r=a.COLOR_BUFFER_BIT;switch(this._depthStencilFormat){case a.DEPTH_COMPONENT16:r|=a.DEPTH_BUFFER_BIT;break;case a.STENCIL_INDEX8:r|=a.STENCIL_BUFFER_BIT;break;case a.DEPTH_STENCIL:r|=a.DEPTH_BUFFER_BIT,r|=a.STENCIL_BUFFER_BIT}a.clear(r)}},{key:"getData",value:function(e,t,n,i){if(M.Render.isConchApp&&2==window.conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var a=P.instance;if(a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer),!(a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE))return a.bindFramebuffer(a.FRAMEBUFFER,null),null;var r=new Uint8Array(this._width*this._height*4),o=this._getGLFormat();return a.readPixels(e,t,n,i,o,a.UNSIGNED_BYTE,r),a.bindFramebuffer(a.FRAMEBUFFER,null),r}},{key:"getDataAsync",value:function(e,t,n,i,a){var r=P.instance;r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),r.readPixelsAsync(e,t,n,i,r.RGBA,r.UNSIGNED_BYTE,function(e){a(new Uint8Array(e))}),r.bindFramebuffer(r.FRAMEBUFFER,null)}},{key:"recycle",value:function(){}},{key:"_disposeResource",value:function(){var e;this._frameBuffer&&((e=P.instance).deleteTexture(this._glTexture),e.deleteFramebuffer(this._frameBuffer),e.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0))}},{key:"depthStencilFormat",get:function(){return this._depthStencilFormat}},{key:"defaulteTexture",get:function(){return X.grayTexture}},{key:"sourceWidth",get:function(){return this._width}},{key:"sourceHeight",get:function(){return this._height}},{key:"offsetX",get:function(){return 0}},{key:"offsetY",get:function(){return 0}}],[{key:"pushRT",value:function(){r.rtStack.push({rt:r._currentActive,w:j.width,h:j.height})}},{key:"popRT",value:function(){var e=P.instance,t=r.rtStack.pop();t&&(r._currentActive!=t.rt&&(P.instance.bindFramebuffer(e.FRAMEBUFFER,t.rt?t.rt._frameBuffer:null),r._currentActive=t.rt),e.viewport(0,0,t.w,t.h),j.width=t.w,j.height=t.h)}},{key:"currentActive",get:function(){return r._currentActive}}]),r}();q.rtStack=[],q.defuv=[0,0,1,0,1,1,0,1],q.flipyuv=[0,1,1,1,1,0,0,0];var Z=function(){function e(){S(this,e)}return C(e,null,[{key:"getRT",value:function(e,t){return t|=0,1e4<=(e|=0)&&console.error("getRT error! w too big"),new q(e,t,H.R8G8B8A8,-1)}},{key:"releaseRT",value:function(e){e._disposeResource()}}]),e}();Z.dict={};var K=function(){function t(){S(this,t)}return C(t,null,[{key:"_init_",value:function(e){t.fns=[t.BlendNormal,t.BlendAdd,t.BlendMultiply,t.BlendScreen,t.BlendOverlay,t.BlendLight,t.BlendMask,t.BlendDestinationOut],t.targetFns=[t.BlendNormalTarget,t.BlendAddTarget,t.BlendMultiplyTarget,t.BlendScreenTarget,t.BlendOverlayTarget,t.BlendLightTarget,t.BlendMask,t.BlendDestinationOut]}},{key:"BlendNormal",value:function(e){y.setBlendFunc(e,e.ONE,e.ONE_MINUS_SRC_ALPHA)}},{key:"BlendAdd",value:function(e){y.setBlendFunc(e,e.ONE,e.DST_ALPHA)}},{key:"BlendMultiply",value:function(e){y.setBlendFunc(e,e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA)}},{key:"BlendScreen",value:function(e){y.setBlendFunc(e,e.ONE,e.ONE)}},{key:"BlendOverlay",value:function(e){y.setBlendFunc(e,e.ONE,e.ONE_MINUS_SRC_COLOR)}},{key:"BlendLight",value:function(e){y.setBlendFunc(e,e.ONE,e.ONE)}},{key:"BlendNormalTarget",value:function(e){y.setBlendFunc(e,e.ONE,e.ONE_MINUS_SRC_ALPHA)}},{key:"BlendAddTarget",value:function(e){y.setBlendFunc(e,e.ONE,e.DST_ALPHA)}},{key:"BlendMultiplyTarget",value:function(e){y.setBlendFunc(e,e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA)}},{key:"BlendScreenTarget",value:function(e){y.setBlendFunc(e,e.ONE,e.ONE)}},{key:"BlendOverlayTarget",value:function(e){y.setBlendFunc(e,e.ONE,e.ONE_MINUS_SRC_COLOR)}},{key:"BlendLightTarget",value:function(e){y.setBlendFunc(e,e.ONE,e.ONE)}},{key:"BlendMask",value:function(e){y.setBlendFunc(e,e.ZERO,e.SRC_ALPHA)}},{key:"BlendDestinationOut",value:function(e){y.setBlendFunc(e,e.ZERO,e.ZERO)}}]),t}();K.activeBlendFunction=null,K.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],K.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},K.NORMAL="normal",K.ADD="add",K.MULTIPLY="multiply",K.SCREEN="screen",K.OVERLAY="overlay",K.LIGHT="light",K.MASK="mask",K.DESTINATIONOUT="destination-out",K.LIGHTER="lighter",K.fns=[],K.targetFns=[];var t=function(){function i(e,t,n){S(this,i),this._value=0,this._name2int=e,this._int2name=t,this._int2nameMap=n}return C(i,[{key:"add",value:function(e){return this._value|="string"==typeof e?this._name2int[e]:e,this._value}},{key:"addInt",value:function(e){return this._value|=e,this._value}},{key:"remove",value:function(e){return this._value&="string"==typeof e?~this._name2int[e]:~e,this._value}},{key:"isDefine",value:function(e){return(this._value&e)===e}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){this._value=e}},{key:"toNameDic",value:function(){var e=this._int2nameMap[this._value];return e||i._toText(this._value,this._int2name,this._int2nameMap)}}],[{key:"_reg",value:function(e,t,n,i){i[n[e]=t]=e}},{key:"_toText",value:function(e,t,n){var i=n[e];if(i)return i;for(var a,r,o={},s=0;s<32&&!(e<(a=1<<s));s++)e&a&&((r=t[a])&&(o[r]=""));return n[e]=o}},{key:"_toInt",value:function(e,t){for(var n=e.split("."),i=0,a=0,r=n.length;a<r;a++){var o=t[n[a]];if(!o)throw new Error("Defines to int err:"+e+"/"+n[a]);i|=o}return i}}]),i}(),Q=function(){T(n,t);var e=b(n);function n(){return S(this,n),e.call(this,n.__name2int,n.__int2name,n.__int2nameMap)}return C(n,null,[{key:"__init__",value:function(){n.reg("TEXTURE2D",n.TEXTURE2D),n.reg("PRIMITIVE",n.PRIMITIVE),n.reg("GLOW_FILTER",n.FILTERGLOW),n.reg("BLUR_FILTER",n.FILTERBLUR),n.reg("COLOR_FILTER",n.FILTERCOLOR),n.reg("COLOR_ADD",n.COLORADD),n.reg("WORLDMAT",n.WORLDMAT),n.reg("FILLTEXTURE",n.FILLTEXTURE),n.reg("FSHIGHPRECISION",n.SHADERDEFINE_FSHIGHPRECISION),n.reg("MVP3D",n.MVP3D)}},{key:"reg",value:function(e,t){this._reg(e,t,n.__name2int,n.__int2name)}},{key:"toText",value:function(e,t,n){return this._toText(e,t,n)}},{key:"toInt",value:function(e){return this._toInt(e,n.__name2int)}}]),n}();Q.TEXTURE2D=1,Q.PRIMITIVE=4,Q.FILTERGLOW=8,Q.FILTERBLUR=16,Q.FILTERCOLOR=32,Q.COLORADD=64,Q.WORLDMAT=128,Q.FILLTEXTURE=256,Q.SKINMESH=512,Q.SHADERDEFINE_FSHIGHPRECISION=1024,Q.MVP3D=2048,Q.NOOPTMASK=Q.FILTERGLOW|Q.FILTERBLUR|Q.FILTERCOLOR|Q.FILLTEXTURE,Q.__name2int={},Q.__int2name=[],Q.__int2nameMap=[];var J=function(){function n(){S(this,n)}return C(n,null,[{key:"show",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;n._StatRender.show(e,t)}},{key:"enable",value:function(){n._StatRender.enable()}},{key:"hide",value:function(){n._StatRender.hide()}},{key:"clear",value:function(){n.trianglesFaces=n.renderBatches=n.savedRenderBatches=n.shaderCall=n.spriteRenderUseCacheCount=n.frustumCulling=n.octreeNodeCulling=n.canvasNormal=n.canvasBitmap=n.canvasReCache=0}},{key:"onclick",set:function(e){n._StatRender.set_onclick(e)}}]),n}();J.FPS=0,J.loopCount=0,J.shaderCall=0,J.renderBatches=0,J.savedRenderBatches=0,J.trianglesFaces=0,J.spriteCount=0,J.spriteRenderUseCacheCount=0,J.frustumCulling=0,J.octreeNodeCulling=0,J.canvasNormal=0,J.canvasBitmap=0,J.canvasReCache=0,J.renderSlow=!1,J._fpsData=[],J._timer=0,J._count=0,J._StatRender=null;var e=function(){function e(){S(this,e),this._strsToID={},this._idToStrs=[],this._length=0}return C(e,[{key:"add",value:function(e){var t=this._strsToID[e];return null!=t?t:(this._idToStrs[this._length]=e,this._strsToID[e]=this._length++)}},{key:"getID",value:function(e){e=this._strsToID[e];return null==e?-1:e}},{key:"getName",value:function(e){e=this._idToStrs[e];return null==e?void 0:e}}]),e}(),$=function(){T(l,W);var o=b(l);function l(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if(S(this,l),(n=o.call(this))._attribInfo=null,n.customCompile=!1,n._curActTexIndex=0,n.tag={},n._program=null,n._params=null,n._paramsMap={},!e||!t)throw"Shader Error";return n._attribInfo=r,n._id=++l._count,n._vs=e,n._ps=t,n._nameMap=a||{},null!=i&&(l.sharders[i]=u(n)),n.recreateResource(),n.lock=!0,n}return C(l,[{key:"recreateResource",value:function(){this._compile(),this._setGPUMemory(0)}},{key:"_disposeResource",value:function(){y.mainContext.deleteShader(this._vshader),y.mainContext.deleteShader(this._pshader),y.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0}},{key:"_compile",value:function(){if(this._vs&&this._ps&&!this._params){var e;this._reCompile=!0,this._params=[],this.customCompile&&(e=M.ShaderCompile.preGetParams(this._vs,this._ps));var t,n=y.mainContext;this._program=n.createProgram(),this._vshader=l._createShader(n,this._vs,n.VERTEX_SHADER),this._pshader=l._createShader(n,this._ps,n.FRAGMENT_SHADER),n.attachShader(this._program,this._vshader),n.attachShader(this._program,this._pshader);for(var i=this._attribInfo?this._attribInfo.length:0,a=0;a<i;a+=2)n.bindAttribLocation(this._program,this._attribInfo[a+1],this._attribInfo[a]);if(n.linkProgram(this._program),!this.customCompile&&!n.getProgramParameter(this._program,n.LINK_STATUS))throw n.getProgramInfoLog(this._program);var r=this.customCompile?e.uniforms.length:n.getProgramParameter(this._program,n.ACTIVE_UNIFORMS);for(a=0;a<r;a++){var o,s=this.customCompile?e.uniforms[a]:n.getActiveUniform(this._program,a);0<(o={vartype:"uniform",glfun:null,ivartype:1,location:n.getUniformLocation(this._program,s.name),name:s.name,type:s.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(o.name=o.name.substr(0,o.name.length-3),o.isArray=!0,o.location=n.getUniformLocation(this._program,o.name)),this._params.push(o)}for(a=0,t=this._params.length;a<t;a++)switch((o=this._params[a]).indexOfParams=a,o.index=1,o.value=[o.location,null],o.codename=o.name,o.name=this._nameMap[o.codename]||o.codename,(this._paramsMap[o.name]=o)._this=this,o.uploadedValue=[],o.type){case n.INT:o.fun=o.isArray?this._uniform1iv:this._uniform1i;break;case n.FLOAT:o.fun=o.isArray?this._uniform1fv:this._uniform1f;break;case n.FLOAT_VEC2:o.fun=o.isArray?this._uniform_vec2v:this._uniform_vec2;break;case n.FLOAT_VEC3:o.fun=o.isArray?this._uniform_vec3v:this._uniform_vec3;break;case n.FLOAT_VEC4:o.fun=o.isArray?this._uniform_vec4v:this._uniform_vec4;break;case n.SAMPLER_2D:o.fun=this._uniform_sampler2D;break;case n.SAMPLER_CUBE:o.fun=this._uniform_samplerCube;break;case n.FLOAT_MAT4:o.glfun=n.uniformMatrix4fv,o.fun=this._uniformMatrix4fv;break;case n.BOOL:o.fun=this._uniform1i;break;case n.FLOAT_MAT2:case n.FLOAT_MAT3:default:throw new Error("compile shader err!")}}}},{key:"getUniform",value:function(e){return this._paramsMap[e]}},{key:"_uniform1f",value:function(e,t){var n=e.uploadedValue;return n[0]!==t?(y.mainContext.uniform1f(e.location,n[0]=t),1):0}},{key:"_uniform1fv",value:function(e,t){if(t.length<4){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(y.mainContext.uniform1fv(e.location,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],1):0}return y.mainContext.uniform1fv(e.location,t),1}},{key:"_uniform_vec2",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]?(y.mainContext.uniform2f(e.location,n[0]=t[0],n[1]=t[1]),1):0}},{key:"_uniform_vec2v",value:function(e,t){if(t.length<2){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(y.mainContext.uniform2fv(e.location,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],1):0}return y.mainContext.uniform2fv(e.location,t),1}},{key:"_uniform_vec3",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]?(y.mainContext.uniform3f(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2]),1):0}},{key:"_uniform_vec3v",value:function(e,t){return y.mainContext.uniform3fv(e.location,t),1}},{key:"_uniform_vec4",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(y.mainContext.uniform4f(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),1):0}},{key:"_uniform_vec4v",value:function(e,t){return y.mainContext.uniform4fv(e.location,t),1}},{key:"_uniformMatrix2fv",value:function(e,t){return y.mainContext.uniformMatrix2fv(e.location,!1,t),1}},{key:"_uniformMatrix3fv",value:function(e,t){return y.mainContext.uniformMatrix3fv(e.location,!1,t),1}},{key:"_uniformMatrix4fv",value:function(e,t){return y.mainContext.uniformMatrix4fv(e.location,!1,t),1}},{key:"_uniform1i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t?(y.mainContext.uniform1i(e.location,n[0]=t),1):0}},{key:"_uniform1iv",value:function(e,t){return y.mainContext.uniform1iv(e.location,t),1}},{key:"_uniform_ivec2",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]?(y.mainContext.uniform2i(e.location,n[0]=t[0],n[1]=t[1]),1):0}},{key:"_uniform_ivec2v",value:function(e,t){return y.mainContext.uniform2iv(e.location,t),1}},{key:"_uniform_vec3i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]?(y.mainContext.uniform3i(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2]),1):0}},{key:"_uniform_vec3vi",value:function(e,t){return y.mainContext.uniform3iv(e.location,t),1}},{key:"_uniform_vec4i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(y.mainContext.uniform4i(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),1):0}},{key:"_uniform_vec4vi",value:function(e,t){return y.mainContext.uniform4iv(e.location,t),1}},{key:"_uniform_sampler2D",value:function(e,t){var n=y.mainContext,i=e.uploadedValue;return null==i[0]?(i[0]=this._curActTexIndex,n.uniform1i(e.location,this._curActTexIndex),y.activeTexture(n,n.TEXTURE0+this._curActTexIndex),y.bindTexture(n,n.TEXTURE_2D,t),this._curActTexIndex++,1):(y.activeTexture(n,n.TEXTURE0+i[0]),y.bindTexture(n,n.TEXTURE_2D,t),0)}},{key:"_uniform_samplerCube",value:function(e,t){var n=y.mainContext,i=e.uploadedValue;return null==i[0]?(i[0]=this._curActTexIndex,n.uniform1i(e.location,this._curActTexIndex),y.activeTexture(n,n.TEXTURE0+this._curActTexIndex),y.bindTexture(n,n.TEXTURE_CUBE_MAP,t),this._curActTexIndex++,1):(y.activeTexture(n,n.TEXTURE0+i[0]),y.bindTexture(n,n.TEXTURE_CUBE_MAP,t),0)}},{key:"_noSetValue",value:function(e){console.log("no....:"+e.name)}},{key:"uploadOne",value:function(e,t){y.useProgram(y.mainContext,this._program);e=this._paramsMap[e];e.fun.call(this,e,t)}},{key:"uploadTexture2D",value:function(e){var t=y;t._activeTextures[0]!==e&&(t.bindTexture(y.mainContext,P.instance.TEXTURE_2D,e),t._activeTextures[0]=e)}},{key:"upload",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;W.activeShader=W.bindShader=this;var n=y.mainContext;y.useProgram(n,this._program),this._reCompile?(t=this._params,this._reCompile=!1):t=t||this._params;for(var i,a,r=t.length,o=0,s=0;s<r;s++)null!==(a=e[(i=t[s]).name])&&(o+=i.fun.call(this,i,a));J.shaderCall+=o}},{key:"uploadArray",value:function(e,t,n){W.activeShader=this,W.bindShader=this,y.useProgram(y.mainContext,this._program);this._params;for(var i,a,r=0,o=t-2;0<=o;o-=2)(a=this._paramsMap[e[o]])&&null!=(i=e[o+1])&&(n&&n[a.name]&&n[a.name].bind(),r+=a.fun.call(this,a,i));J.shaderCall+=r}},{key:"getParams",value:function(){return this._params}},{key:"setAttributesLocation",value:function(e){this._attribInfo=e}}],[{key:"getShader",value:function(e){return l.sharders[e]}},{key:"create",value:function(e,t){return new l(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,4<arguments.length&&void 0!==arguments[4]?arguments[4]:null)}},{key:"withCompile",value:function(e,t,n,i){if(n&&l.sharders[n])return l.sharders[n];var a=l._preCompileShader[l.SHADERNAME2ID*e];if(!a)throw new Error("withCompile shader err!"+e);return a.createShader(t,n,i,null)}},{key:"withCompile2D",value:function(e,t,n,i,a){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;if(i&&l.sharders[i])return l.sharders[i];var o=l._preCompileShader[l.SHADERNAME2ID*e+t];if(!o)throw new Error("withCompile shader err!"+e+" "+t);return o.createShader(n,i,a,r)}},{key:"addInclude",value:function(e,t){M.ShaderCompile.addInclude(e,t)}},{key:"preCompile",value:function(e,t,n,i){e=l.SHADERNAME2ID*e;l._preCompileShader[e]=new M.ShaderCompile(t,n,i)}},{key:"preCompile2D",value:function(e,t,n,i,a){t=l.SHADERNAME2ID*e+t;l._preCompileShader[t]=new M.ShaderCompile(n,i,a)}},{key:"_createShader",value:function(e,t,n){n=e.createShader(n);return e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.log(e.getShaderInfoLog(n)),null)}}]),l}();$._count=0,$._preCompileShader={},$.SHADERNAME2ID=2e-4,$.nameKey=new e,$.sharders=new Array(32);var a=function(){T(o,$);var r=b(o);function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return S(this,o),(a=r.call(this,e,t,n,i,a))._params2dQuick2=null,a._shaderValueWidth=0,a._shaderValueHeight=0,a}return C(o,[{key:"_disposeResource",value:function(){G(z(o.prototype),"_disposeResource",this).call(this),this._params2dQuick2=null}},{key:"upload2dQuick2",value:function(e){this.upload(e,this._params2dQuick2||this._make2dQuick2())}},{key:"_make2dQuick2",value:function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var e,t=this._params,n=0,i=t.length;n<i;n++)"size"!==(e=t[n]).name&&this._params2dQuick2.push(e)}return this._params2dQuick2}}],[{key:"create",value:function(e,t){return new o(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,4<arguments.length&&void 0!==arguments[4]?arguments[4]:null)}}]),o}(),ee=function(){function i(e,t){S(this,i),this.defines=new Q,this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[M.Context._MAXSIZE,0,0,M.Context._MAXSIZE],this.clipMatPos=[0,0],this.clipOff=[0,0],this.mainID=e,this.subID=t,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=e|t,this._inClassCache=i._cache[this._cacheID],0<e&&!this._inClassCache&&(this._inClassCache=i._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}return C(i,[{key:"setValue",value:function(e){}},{key:"_ShaderWithCompile",value:function(){return $.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,a.create,this._attribLocation)}},{key:"upload",value:function(){var e=j;j.worldMatrix4===j.TEMPMAT4_ARRAY||this.defines.addInt(Q.WORLDMAT),this.mmat=e.worldMatrix4,j.matWVP&&(this.defines.addInt(Q.MVP3D),this.u_MvpMatrix=j.matWVP.elements);var t=$.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();t._shaderValueWidth!==e.width||t._shaderValueHeight!==e.height?(this.size[0]=e.width,this.size[1]=e.height,t._shaderValueWidth=e.width,t._shaderValueHeight=e.height,t.upload(this,null)):t.upload(this,t._params2dQuick2||t._make2dQuick2())}},{key:"setFilters",value:function(e){if(this.filters=e)for(var t,n=e.length,i=0;i<n;i++)(t=e[i])&&(this.defines.add(t.type),t.action.setValue(this))}},{key:"clear",value:function(){this.defines._value=this.subID+(M.WebGL.shaderHighPrecision?Q.SHADERDEFINE_FSHIGHPRECISION:0),this.clipOff[0]=0}},{key:"release",value:function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1,this.clipOff[0]=0)}}],[{key:"_initone",value:function(e,t){i._typeClass[e]=t,i._cache[e]=[],i._cache[e]._length=0}},{key:"__init__",value:function(){}},{key:"create",value:function(e,t){var n=i._cache[e|t];return n._length?n[--n._length]:new i._typeClass[e|t](t)}}]),i}();ee._cache=[],ee._typeClass=[],ee.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var te=function(){function e(){S(this,e),this.clear()}return C(e,[{key:"clear",value:function(){this.submitType=-1,this.blendShader=this.other=0}},{key:"copyFrom",value:function(e){this.other=e.other,this.blendShader=e.blendShader,this.submitType=e.submitType}},{key:"copyFrom2",value:function(e,t,n){this.other=n,this.submitType=t}},{key:"equal3_2",value:function(e,t,n){return this.submitType===t&&this.other===n&&this.blendShader===e.blendShader}},{key:"equal4_2",value:function(e,t,n){return this.submitType===t&&this.other===n&&this.blendShader===e.blendShader}},{key:"equal_3",value:function(e){return this.submitType===e.submitType&&this.blendShader===e.blendShader}},{key:"equal",value:function(e){return this.other===e.other&&this.submitType===e.submitType&&this.blendShader===e.blendShader}}]),e}(),ne=function(){function a(){S(this,a),this._ref=1,this._key=new te}return C(a,[{key:"renderSubmit",value:function(){return this.fun.apply(this._this,this.args),1}},{key:"getRenderType",value:function(){return 0}},{key:"releaseRender",value:function(){var e;--this._ref<1&&((e=a.POOL)[e._length++]=this)}}],[{key:"create",value:function(e,t,n){var i=a.POOL._length?a.POOL[--a.POOL._length]:new a;return i.fun=t,i.args=e,i._this=n,i._ref=1,i._key.clear(),i}}]),a}();ne.POOL=[],ne.POOL._length=0;var ie=function(){function e(){S(this,e)}return C(e,[{key:"type",get:function(){return-1}}]),e}();ie.BLUR=16,ie.COLOR=32,ie.GLOW=8,ie._filter=function(e,t,n,i){var a=t,r=this._next;if(r){var o=e.filters,s=o.length;if(1==s&&o[0].type==ie.COLOR)return t.save(),t.setColorFilter(o[0]),r._fun.call(r,e,t,n,i),void t.restore();var l,h=ee.create(Q.TEXTURE2D,0),u=L.TEMP,d=a._curMat,c=D.create();d.copyTo(c);var _=0,f=0,g=null,y=e._cacheStyle.filterCache||null;if(y&&0==e.getRepaint()){if((e._cacheStyle.hasGlowFilter||!1)&&(_=50,f=25),(l=e.getBounds()).width<=0||l.height<=0)return;l.width+=_,l.height+=_,u.x=l.x*c.a+l.y*c.c,u.y=l.y*c.d+l.x*c.b,l.x=u.x,l.y=u.y,u.x=l.width*c.a+l.height*c.c,u.y=l.height*c.d+l.width*c.b,l.width=u.x,l.height=u.y}else{e._isHaveGlowFilter()&&(_=50,f=25),(l=new O).copyFrom(e.getSelfBounds()),l.x+=e.x,l.y+=e.y,l.x-=e.pivotX+4,l.y-=e.pivotY+4;var v=l.x,d=l.y;if(l.width+=_+8,l.height+=_+8,u.x=l.x*c.a+l.y*c.c,u.y=l.y*c.d+l.x*c.b,l.x=u.x,l.y=u.y,u.x=l.width*c.a+l.height*c.c,u.y=l.height*c.d+l.width*c.b,l.width=u.x,l.height=u.y,l.width<=0||l.height<=0)return;y&&Z.releaseRT(y),g=Z.getRT(l.width,l.height);var p=y=Z.getRT(l.width,l.height);e._getCacheStyle().filterCache=y,a.pushRT(),a.useRT(g);v=e.x-v+f,d=e.y-d+f;r._fun.call(r,e,t,v,d),a.useRT(p);for(var m=0;m<s;m++){0!=m&&(a.useRT(g),a.drawTarget(p,0,0,l.width,l.height,D.TEMP.identity(),h,null,K.TOINT.overlay),a.useRT(p));var w=o[m];switch(w.type){case ie.BLUR:case ie.GLOW:w._glRender&&w._glRender.render(g,t,l.width,l.height,w);break;case ie.COLOR:a.setColorFilter(w),a.drawTarget(g,0,0,l.width,l.height,D.EMPTY.identity(),ee.create(Q.TEXTURE2D,0)),a.setColorFilter(null)}}a.popRT()}n=n-f-e.x,i=i-f-e.y,u.setTo(n,i),c.transformPoint(u),n=u.x+l.x,i=u.y+l.y,a._drawRenderTexture(y,n,i,l.width,l.height,D.TEMP.identity(),1,q.defuv),g&&(i=ne.create([g],function(e){e.destroy()},this),g=null,t.addRenderObject(i)),c.destroy()}};var ae=function(){function d(){S(this,d)}function e(e){return t.apply(this,arguments)}var t;return C(d,null,[{key:"toRadian",value:function(e){return e*d._pi2}},{key:"toAngle",value:function(e){return e*d._pi}},{key:"toHexColor",value:function(e){if(e<0||isNaN(e))return null;for(var t=e.toString(16);t.length<6;)t="0"+t;return"#"+t}},{key:"getGID",value:function(){return d._gid++}},{key:"concatArray",value:function(e,t){if(!t)return e;if(!e)return t;for(var n=t.length,i=0;i<n;i++)e.push(t[i]);return e}},{key:"clearArray",value:function(e){return e&&(e.length=0,e)}},{key:"copyArray",value:function(e,t){if(e=e||[],!t)return e;e.length=t.length;for(var n=t.length,i=0;i<n;i++)e[i]=t[i];return e}},{key:"getGlobalRecByPoints",value:function(e,t,n,i,a){n=L.create().setTo(t,n);n=e.localToGlobal(n),a=L.create().setTo(i,a),a=e.localToGlobal(a);e=O._getWrapRec([n.x,n.y,a.x,a.y]);return n.recover(),a.recover(),e}},{key:"getGlobalPosAndScale",value:function(e){return d.getGlobalRecByPoints(e,0,0,1,1)}},{key:"bind",value:function(e,t){return e.bind(t)}},{key:"updateOrder",value:function(e){if(!e||e.length<2)return!1;for(var t,n,i,a=1,r=e.length;a<r;){for(i=e[t=a],n=e[t]._zOrder;-1<--t&&e[t]._zOrder>n;)e[t+1]=e[t];e[t+1]=i,a++}return!0}},{key:"transPointList",value:function(e,t,n){for(var i=e.length,a=0;a<i;a+=2)e[a]+=t,e[a+1]+=n}},{key:"parseInt",value:(t=function(e){e=parseInt(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0);return isNaN(e)?0:e},e.toString=function(){return t.toString()},e)},{key:"getFileExtension",value:function(e){d._extReg.lastIndex=e.lastIndexOf(".");e=d._extReg.exec(e);return e&&1<e.length?e[1].toLowerCase():null}},{key:"getTransformRelativeToWindow",value:function(e,t,n){var i=d.gStage,a=d.getGlobalPosAndScale(e),r=i._canvasTransform.clone(),o=r.tx,s=r.ty;r.rotate(-Math.PI/180*i.canvasDegree),r.scale(i.clientScaleX,i.clientScaleY);var l,h,u,e=i.canvasDegree%180!=0;return e?(l=n+a.y,h=t+a.x,l*=r.d,h*=r.a,90==i.canvasDegree?(l=o-l,h+=s):(l+=o,h=s-h)):(l=t+a.x,h=n+a.y,l*=r.a,h*=r.d,l+=o,h+=s),h+=i._safariOffsetY,a=e?(u=r.d*a.height,r.a*a.width):(u=r.a*a.width,r.d*a.height),{x:l,y:h,scaleX:u,scaleY:a}}},{key:"fitDOMElementInArea",value:function(e,t,n,i,a,r){e._fitLayaAirInitialized||(e._fitLayaAirInitialized=!0,e.style.transformOrigin=e.style.webKittransformOrigin="left top",e.style.position="absolute");i=d.getTransformRelativeToWindow(t,n,i);e.style.transform=e.style.webkitTransform="scale("+i.scaleX+","+i.scaleY+") rotate("+d.gStage.canvasDegree+"deg)",e.style.width=a+"px",e.style.height=r+"px",e.style.left=i.x+"px",e.style.top=i.y+"px"}},{key:"isOkTextureList",value:function(e){if(!e)return!1;for(var t,n=e.length,i=0;i<n;i++)if(!(t=e[i])||!t._getSource())return!1;return!0}},{key:"isOKCmdList",value:function(e){if(!e)return!1;for(var t=e.length,n=0;n<t;n++)e[n];return!0}},{key:"getQueryString",value:function(e){if(M.Browser.onMiniGame)return null;if(!window.location||!window.location.search)return null;e=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),e=window.location.search.substr(1).match(e);return null!=e?unescape(e[2]):null}}]),d}();ae.gStage=null,ae._gid=1,ae._pi=180/Math.PI,ae._pi2=Math.PI/180,ae._extReg=/\.(\w+)\??/g,ae.parseXMLFromString=function(e){if(e=e.replace(/>\s+</g,"><"),-1<(e=(new DOMParser).parseFromString(e,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(e.firstChild.firstChild.textContent);return e};var re=function(){function s(e){if(S(this,s),this.arrColor=[],null==e)return this.strColor="#00000000",this.numColor=0,void(this.arrColor=[0,0,0,0]);var t;if("string"==typeof e)if(0<=e.indexOf("rgba(")||0<=e.indexOf("rgb(")){var n=(a=e).indexOf("("),i=a.indexOf(")"),a=a.substring(n+1,i);for(this.arrColor=a.split(","),t=this.arrColor.length,o=0;o<t;o++)this.arrColor[o]=parseFloat(this.arrColor[o]),o<3&&(this.arrColor[o]=Math.round(this.arrColor[o]));a=4==this.arrColor.length?256*(256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2])+Math.round(255*this.arrColor[3]):256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2],this.strColor=e}else{if(3===(t=(e="#"===(this.strColor=e).charAt(0)?e.substr(1):e).length)||4===t){for(var r="",o=0;o<t;o++)r+=e[o]+e[o];e=r}a=parseInt(e,16)}else a=e,this.strColor=ae.toHexColor(a);0<=this.strColor.indexOf("rgba")||9===this.strColor.length?(this.arrColor=[((4278190080&a)>>>24)/255,((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255],this.numColor=(4278190080&a)>>>24|(16711680&a)>>8|(65280&a)<<8|(255&a)<<24):(this.arrColor=[((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255,1],this.numColor=4278190080|(16711680&a)>>16|65280&a|(255&a)<<16),this.arrColor.__id=++s._COLODID}return C(s,null,[{key:"_initDefault",value:function(){for(var e in s._DEFAULT={},s._COLOR_MAP)s._SAVE[e]=s._DEFAULT[e]=new s(s._COLOR_MAP[e]);return s._DEFAULT}},{key:"_initSaveMap",value:function(){for(var e in s._SAVE_SIZE=0,s._SAVE={},s._DEFAULT)s._SAVE[e]=s._DEFAULT[e]}},{key:"create",value:function(e){var t=e+"",n=s._SAVE[t];return null!=n?n:(s._SAVE_SIZE<1e3&&s._initSaveMap(),s._SAVE[t]=new s(e))}}]),s}();re._SAVE={},re._SAVE_SIZE=0,re._COLOR_MAP={purple:"#800080",orange:"#ffa500",white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#808080"},re._DEFAULT=re._initDefault(),re._COLODID=1;var oe=function(){T(i,ie);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return S(this,i),e=n.call(this),t=t||e._copyMatrix(i.IDENTITY_MATRIX),e._mat=new Float32Array(16),e._alpha=new Float32Array(4),e.setByMatrix(t),e}return C(i,[{key:"gray",value:function(){return this.setByMatrix(i.GRAY_MATRIX)}},{key:"color",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;return this.setByMatrix([1,0,0,0,e,0,1,0,0,t,0,0,1,0,n,0,0,0,1,i])}},{key:"setColor",value:function(e){e=re.create(e).arrColor,e=[0,0,0,0,256*e[0],0,0,0,0,256*e[1],0,0,0,0,256*e[2],0,0,0,1,0];return this.setByMatrix(e)}},{key:"setByMatrix",value:function(e){this._matrix!=e&&this._copyMatrix(e);for(var t=0,n=0,i=0;i<20;i++)i%5!=4?this._mat[t++]=e[i]:this._alpha[n++]=e[i];return this}},{key:"adjustColor",value:function(e,t,n,i){return this.adjustHue(i),this.adjustContrast(t),this.adjustBrightness(e),this.adjustSaturation(n),this}},{key:"adjustBrightness",value:function(e){return 0==(e=this._clampValue(e,100))||isNaN(e)?this:this._multiplyMatrix([1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])}},{key:"adjustContrast",value:function(e){if(0==(e=this._clampValue(e,100))||isNaN(e))return this;var t=e<0?127+e/100*127:127*(t=0==(t=e%1)?i.DELTA_INDEX[e]:i.DELTA_INDEX[e<<0]*(1-t)+i.DELTA_INDEX[1+(e<<0)]*t)+127,e=t/127,t=.5*(127-t);return this._multiplyMatrix([e,0,0,0,t,0,e,0,0,t,0,0,e,0,t,0,0,0,1,0,0,0,0,0,1])}},{key:"adjustSaturation",value:function(e){if(0==(e=this._clampValue(e,100))||isNaN(e))return this;var t=1+(0<e?3*e/100:e/100),n=1-t,i=.3086*n,e=.6094*n,n=.082*n;return this._multiplyMatrix([i+t,e,n,0,0,i,e+t,n,0,0,i,e,n+t,0,0,0,0,0,1,0,0,0,0,0,1])}},{key:"adjustHue",value:function(e){if(0==(e=this._clampValue(e,180)/180*Math.PI)||isNaN(e))return this;var t=Math.cos(e),n=Math.sin(e),i=.213,a=.715,e=.072;return this._multiplyMatrix([i+.787*t+n*-i,a+t*-a+n*-a,e+t*-e+.928*n,0,0,i+t*-i+.143*n,a+t*(1-a)+.14*n,e+t*-e+-.283*n,0,0,i+t*-i+-.787*n,a+t*-a+n*a,e+.928*t+n*e,0,0,0,0,0,1,0,0,0,0,0,1])}},{key:"reset",value:function(){return this.setByMatrix(this._copyMatrix(i.IDENTITY_MATRIX))}},{key:"_multiplyMatrix",value:function(e){var t=[];this._matrix=this._fixMatrix(this._matrix);for(var n=0;n<5;n++){for(var i=0;i<5;i++)t[i]=this._matrix[i+5*n];for(i=0;i<5;i++){for(var a=0,r=0;r<5;r++)a+=e[i+5*r]*t[r];this._matrix[i+5*n]=a}}return this.setByMatrix(this._matrix)}},{key:"_clampValue",value:function(e,t){return Math.min(t,Math.max(-t,e))}},{key:"_fixMatrix",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return null==e?i.IDENTITY_MATRIX:(e.length<i.LENGTH?e=e.slice(0,e.length).concat(i.IDENTITY_MATRIX.slice(e.length,i.LENGTH)):e.length>i.LENGTH&&(e=e.slice(0,i.LENGTH)),e)}},{key:"_copyMatrix",value:function(e){var t=i.LENGTH;this._matrix||(this._matrix=[]);for(var n=0;n<t;n++)this._matrix[n]=e[n];return this._matrix}},{key:"type",get:function(){return ie.COLOR}}]),i}();oe.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],oe.GRAY_MATRIX=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0],oe.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],oe.LENGTH=25;var se=function(){function d(){S(this,d),this.colorFlt=null,this.uv=null}return C(d,[{key:"recover",value:function(){this.texture&&this.texture._removeReference(),this.texture=null,this.matrix=null,g.recover("DrawTextureCmd",this)}},{key:"run",value:function(e,t,n){this.texture&&e.drawTextureWithTransform(this.texture,this.x,this.y,this.width,this.height,this.matrix,t,n,this.alpha,this.blendMode,this.colorFlt,this.uv)}},{key:"cmdID",get:function(){return d.ID}}],[{key:"create",value:function(e,t,n,i,a,r,o,s,l,h){var u=g.getItemByClass("DrawTextureCmd",d);return(u.texture=e)._addReference(),u.x=t,u.y=n,u.width=i,u.height=a,u.matrix=r,u.alpha=o,u.color=s,u.blendMode=l,u.uv=null==h?null:h,s&&(u.colorFlt=new oe,u.colorFlt.setColor(s)),u}}]),d}();se.ID="DrawTexture";var le=function(){function h(){S(this,h)}return C(h,[{key:"recover",value:function(){this.texture=null,this.offset=null,this.other=null,g.recover("FillTextureCmd",this)}},{key:"run",value:function(e,t,n){e.fillTexture(this.texture,this.x+t,this.y+n,this.width,this.height,this.type,this.offset,this.other)}},{key:"cmdID",get:function(){return h.ID}}],[{key:"create",value:function(e,t,n,i,a,r,o,s){var l=g.getItemByClass("FillTextureCmd",h);return l.texture=e,l.x=t,l.y=n,l.width=i,l.height=a,l.type=r,l.offset=o,l.other=s,l}}]),h}();le.ID="FillTexture";var he=function(){function e(){S(this,e)}return C(e,[{key:"recover",value:function(){g.recover("RestoreCmd",this)}},{key:"run",value:function(e,t,n){e.restore()}},{key:"cmdID",get:function(){return e.ID}}],[{key:"create",value:function(){return g.getItemByClass("RestoreCmd",e)}}]),e}();he.ID="Restore";var ue=function(){function a(){S(this,a)}return C(a,[{key:"recover",value:function(){g.recover("RotateCmd",this)}},{key:"run",value:function(e,t,n){e._rotate(this.angle,this.pivotX+t,this.pivotY+n)}},{key:"cmdID",get:function(){return a.ID}}],[{key:"create",value:function(e,t,n){var i=g.getItemByClass("RotateCmd",a);return i.angle=e,i.pivotX=t,i.pivotY=n,i}}]),a}();ue.ID="Rotate";var de=function(){function r(){S(this,r)}return C(r,[{key:"recover",value:function(){g.recover("ScaleCmd",this)}},{key:"run",value:function(e,t,n){e._scale(this.scaleX,this.scaleY,this.pivotX+t,this.pivotY+n)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(e,t,n,i){var a=g.getItemByClass("ScaleCmd",r);return a.scaleX=e,a.scaleY=t,a.pivotX=n,a.pivotY=i,a}}]),r}();de.ID="Scale";var ce=function(){function a(){S(this,a)}return C(a,[{key:"recover",value:function(){this.matrix=null,g.recover("TransformCmd",this)}},{key:"run",value:function(e,t,n){e._transform(this.matrix,this.pivotX+t,this.pivotY+n)}},{key:"cmdID",get:function(){return a.ID}}],[{key:"create",value:function(e,t,n){var i=g.getItemByClass("TransformCmd",a);return i.matrix=e,i.pivotX=t,i.pivotY=n,i}}]),a}();ce.ID="Transform";var _e=function(){function i(){S(this,i)}return C(i,[{key:"recover",value:function(){g.recover("TranslateCmd",this)}},{key:"run",value:function(e,t,n){e.translate(this.tx,this.ty)}},{key:"cmdID",get:function(){return i.ID}}],[{key:"create",value:function(e,t){var n=g.getItemByClass("TranslateCmd",i);return n.tx=e,n.ty=t,n}}]),i}();_e.ID="Translate";var fe=function(){function e(){S(this,e),this._controlPoints=[new L,new L,new L],this._calFun=this.getPoint2}return C(e,[{key:"_switchPoint",value:function(e,t){var n=this._controlPoints.shift();n.setTo(e,t),this._controlPoints.push(n)}},{key:"getPoint2",value:function(e,t){var n=this._controlPoints[0],i=this._controlPoints[1],a=this._controlPoints[2],r=Math.pow(1-e,2)*n.x+2*e*(1-e)*i.x+Math.pow(e,2)*a.x,a=Math.pow(1-e,2)*n.y+2*e*(1-e)*i.y+Math.pow(e,2)*a.y;t.push(r,a)}},{key:"getPoint3",value:function(e,t){var n=this._controlPoints[0],i=this._controlPoints[1],a=this._controlPoints[2],r=this._controlPoints[3],o=Math.pow(1-e,3)*n.x+3*i.x*e*(1-e)*(1-e)+3*a.x*e*e*(1-e)+r.x*Math.pow(e,3),e=Math.pow(1-e,3)*n.y+3*i.y*e*(1-e)*(1-e)+3*a.y*e*e*(1-e)+r.y*Math.pow(e,3);t.push(o,e)}},{key:"insertPoints",value:function(e,t){for(var n=1/(e=0<e?e:5),i=0;i<=1;i+=n)this._calFun(i,t)}},{key:"getBezierPoints",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2,a=e.length;if(a<2*(i+1))return[];var r=[];switch(i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(L.create());for(t=0;t<2*i;t+=2)this._switchPoint(e[t],e[t+1]);for(t=2*i;t<a;t+=2)this._switchPoint(e[t],e[t+1]),t/2%i==0&&this.insertPoints(n,r);return r}}]),e}();fe.I=new fe;var ge=function(){function h(){S(this,h)}return C(h,null,[{key:"multiply",value:function(e,t,n){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}},{key:"dis",value:function(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}},{key:"_getPoints",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;for(h._mPointList||(h._mPointList=[]);h._mPointList.length<e;)h._mPointList.push(new L);return(n=n||[]).length=0,t?h.getFrom(n,h._mPointList,e):h.getFromR(n,h._mPointList,e),n}},{key:"getFrom",value:function(e,t,n){for(var i=0;i<n;i++)e.push(t[i]);return e}},{key:"getFromR",value:function(e,t,n){for(var i=0;i<n;i++)e.push(t.pop());return e}},{key:"pListToPointList",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=e.length/2,i=h._getPoints(n,t,h._tempPointList),a=0;a<n;a++)i[a].setTo(e[a+a],e[a+a+1]);return i}},{key:"pointListToPlist",value:function(e){for(var t,n=e.length,i=h._temPList,a=i.length=0;a<n;a++)t=e[a],i.push(t.x,t.y);return i}},{key:"scanPList",value:function(e){return ae.copyArray(e,h.pointListToPlist(h.scan(h.pListToPointList(e,!0))))}},{key:"scan",value:function(e){var t,n,i,a,r=0,o=e.length,s={},l=h._temArr;for(l.length=0,t=e.length-1;0<=t;t--)(a=(i=e[t]).x+"_"+i.y)in s||(s[a]=!0,l.push(i));for(o=l.length,ae.copyArray(e,l),t=1;t<o;t++)(e[t].y<e[r].y||e[t].y==e[r].y&&e[t].x<e[r].x)&&(r=t);for(i=e[0],e[0]=e[r],e[r]=i,t=1;t<o-1;t++){for(n=(r=t)+1;n<o;n++)(0<h.multiply(e[n],e[r],e[0])||0==h.multiply(e[n],e[r],e[0])&&h.dis(e[0],e[n])<h.dis(e[0],e[r]))&&(r=n);i=e[t],e[t]=e[r],e[r]=i}if((l=h._temArr).length=0,e.length<3)return ae.copyArray(l,e);for(l.push(e[0],e[1],e[2]),t=3;t<o;t++){for(;2<=l.length&&0<=h.multiply(e[t],l[l.length-1],l[l.length-2]);)l.pop();e[t]&&l.push(e[t])}return l}}]),h}();ge._tempPointList=[],ge._temPList=[],ge._temArr=[];var ye=function e(){S(this,e)};ye.animationInterval=50,ye.isAntialias=!1,ye.isAlpha=!1,ye.premultipliedAlpha=!0,ye.isStencil=!0,ye.preserveDrawingBuffer=!1,ye.webGL2D_MeshAllocMaxMem=!0,ye.is2DPixelArtGame=!1,ye.useWebGL2=!0,ye.useRetinalCanvas=!1,window.Config=ye;var ve=function(){function n(e){S(this,n),this.setValue(e)}return C(n,[{key:"setValue",value:function(e){this._color=e?e instanceof re?e:re.create(e):re.create("#000000")}},{key:"reset",value:function(){this._color=re.create("#000000")}},{key:"toInt",value:function(){return this._color.numColor}},{key:"equal",value:function(e){return"string"==typeof e?this._color.strColor===e:e instanceof re&&this._color.numColor===e.numColor}},{key:"toColorStr",value:function(){return this._color.strColor}}],[{key:"create",value:function(e){if(e){var t=e instanceof re?e:re.create(e);return t._drawStyle||(t._drawStyle=new n(e))}return n.DEFAULT}}]),n}();ve.DEFAULT=new ve("#000000");var pe=function(){function e(){S(this,e),this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}return C(e,[{key:"beginPath",value:function(e){this.paths.length=1,this._curPath=this.paths[0]=new me,this._curPath.convex=e}},{key:"closePath",value:function(){this._curPath.loop=!0}},{key:"newPath",value:function(){this._curPath=new me,this.paths.push(this._curPath)}},{key:"addPoint",value:function(e,t){this._curPath.path.push(e,t)}},{key:"push",value:function(e,t){(!this._curPath||0<this._curPath.path.length)&&(this._curPath=new me,this.paths.push(this._curPath));var n=this._curPath;n.path=e.slice(),n.convex=t}},{key:"reset",value:function(){this.paths.length=0}}]),e}(),me=function e(){S(this,e),this.path=[],this.loop=!1,this.convex=!1},we=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:t.TYPE_2D;S(this,t),this.clipInfoID=-1,this._mesh=null,this._blendFn=null,this._id=0,this._renderType=0,this._parent=null,this._key=new te,this._startIdx=0,this._numEle=0,this._ref=1,this.shaderValue=null,this._renderType=e,this._id=++t.ID}return C(t,[{key:"getID",value:function(){return this._id}},{key:"getRenderType",value:function(){return this._renderType}},{key:"toString",value:function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key}},{key:"renderSubmit",value:function(){return 1}},{key:"releaseRender",value:function(){}}],[{key:"__init__",value:function(){var e=t.RENDERBASE=new t(-1);e.shaderValue=new ee(0,0),e.shaderValue.ALPHA=1,e._ref=4294967295}}]),t}();we.TYPE_2D=1e4,we.TYPE_CANVAS=10003,we.TYPE_CMDSETRT=10004,we.TYPE_CUSTOM=10005,we.TYPE_BLURRT=10006,we.TYPE_CMDDESTORYPRERT=10007,we.TYPE_DISABLESTENCIL=10008,we.TYPE_OTHERIBVB=10009,we.TYPE_PRIMITIVE=10010,we.TYPE_RT=10011,we.TYPE_BLUR_RT=10012,we.TYPE_TARGET=10013,we.TYPE_CHANGE_VALUE=10014,we.TYPE_SHAPE=10015,we.TYPE_TEXTURE=10016,we.TYPE_FILLTEXTURE=10017,we.KEY_ONCE=-1,we.KEY_FILLRECT=1,we.KEY_DRAWTEXTURE=2,we.KEY_VG=3,we.KEY_TRIANGLES=4,we.ID=1,we.preRender=null;var xe=function(){function r(){S(this,r)}return C(r,[{key:"isSaveMark",value:function(){return!1}},{key:"restore",value:function(e){this._dataObj[this._valueName]=this._value,(r.POOL[r.POOL._length++]=this)._newSubmit&&(e._curSubmit=we.RENDERBASE)}}],[{key:"_createArray",value:function(){var e=[];return e._length=0,e}},{key:"_init",value:function(){var e=r._namemap={};return e[r.TYPE_ALPHA]="ALPHA",e[r.TYPE_FILESTYLE]="fillStyle",e[r.TYPE_FONT]="font",e[r.TYPE_LINEWIDTH]="lineWidth",e[r.TYPE_STROKESTYLE]="strokeStyle",e[r.TYPE_ENABLEMERGE]="_mergeID",e[r.TYPE_MARK]=e[r.TYPE_TRANSFORM]=e[r.TYPE_TRANSLATE]=[],e[r.TYPE_TEXTBASELINE]="textBaseline",e[r.TYPE_TEXTALIGN]="textAlign",e[r.TYPE_GLOBALCOMPOSITEOPERATION]="_nBlendType",e[r.TYPE_SHADER]="shader",e[r.TYPE_FILTERS]="filters",e[r.TYPE_COLORFILTER]="_colorFiler",e}},{key:"save",value:function(e,t,n,i){var a;(e._saveMark._saveuse&t)!==t&&(e._saveMark._saveuse|=t,(a=0<(a=r.POOL)._length?a[--a._length]:new r)._value=n[a._valueName=r._namemap[t]],a._dataObj=n,a._newSubmit=i,(e=e._save)[e._length++]=a)}}]),r}();xe.TYPE_ALPHA=1,xe.TYPE_FILESTYLE=2,xe.TYPE_FONT=8,xe.TYPE_LINEWIDTH=256,xe.TYPE_STROKESTYLE=512,xe.TYPE_MARK=1024,xe.TYPE_TRANSFORM=2048,xe.TYPE_TRANSLATE=4096,xe.TYPE_ENABLEMERGE=8192,xe.TYPE_TEXTBASELINE=16384,xe.TYPE_TEXTALIGN=32768,xe.TYPE_GLOBALCOMPOSITEOPERATION=65536,xe.TYPE_CLIPRECT=131072,xe.TYPE_CLIPRECT_STENCIL=262144,xe.TYPE_IBVB=524288,xe.TYPE_SHADER=1048576,xe.TYPE_FILTERS=2097152,xe.TYPE_FILTERS_TYPE=4194304,xe.TYPE_COLORFILTER=8388608,xe.POOL=xe._createArray(),xe._namemap=xe._init();var ke=function(){function n(){S(this,n),this._globalClipMatrix=new D,this._clipInfoID=-1,this._clipRect=new O,this.incache=!1}return C(n,[{key:"isSaveMark",value:function(){return!1}},{key:"restore",value:function(e){this._globalClipMatrix.copyTo(e._globalClipMatrix),this._clipRect.clone(e._clipRect),e._clipInfoID=this._clipInfoID,n.POOL[n.POOL._length++]=this,e._clipInCache=this.incache}}],[{key:"save",value:function(e){var t;(e._saveMark._saveuse&xe.TYPE_CLIPRECT)!=xe.TYPE_CLIPRECT&&(e._saveMark._saveuse|=xe.TYPE_CLIPRECT,t=0<(t=n.POOL)._length?t[--t._length]:new n,e._globalClipMatrix.copyTo(t._globalClipMatrix),e._clipRect.clone(t._clipRect),t._clipInfoID=e._clipInfoID,t.incache=e._clipInCache,(e=e._save)[e._length++]=t)}}]),n}();ke.POOL=xe._createArray();var Te=function(){function n(){S(this,n),this._saveuse=0}return C(n,[{key:"isSaveMark",value:function(){return!0}},{key:"restore",value:function(e){e._saveMark=this._preSaveMark,n.POOL[n.POOL._length++]=this}}],[{key:"Create",value:function(e){var t=n.POOL,t=0<t._length?t[--t._length]:new n;return t._saveuse=0,t._preSaveMark=e._saveMark,e._saveMark=t}}]),n}();Te.POOL=xe._createArray();var Ee=function(){function n(){S(this,n),this._matrix=new D}return C(n,[{key:"isSaveMark",value:function(){return!1}},{key:"restore",value:function(e){e._curMat=this._savematrix,n.POOL[n.POOL._length++]=this}}],[{key:"save",value:function(e){var t=e._saveMark;(t._saveuse&xe.TYPE_TRANSFORM)!==xe.TYPE_TRANSFORM&&(t._saveuse|=xe.TYPE_TRANSFORM,(t=0<(t=n.POOL)._length?t[--t._length]:new n)._savematrix=e._curMat,e._curMat=e._curMat.copyTo(t._matrix),(e=e._save)[e._length++]=t)}}]),n}();Ee.POOL=xe._createArray();var Me=function(){function n(){S(this,n),this._mat=new D}return C(n,[{key:"isSaveMark",value:function(){return!1}},{key:"restore",value:function(e){this._mat.copyTo(e._curMat),n.POOL[n.POOL._length++]=this}}],[{key:"save",value:function(e){var t=n.POOL,t=0<t._length?t[--t._length]:new n;e._curMat.copyTo(t._mat);e=e._save;e[e._length++]=t}}]),n}();function be(){S(this,be)}Me.POOL=xe._createArray();var Se=function(){function e(){S(this,e),this._nativeVertexArrayObject=P.layaGPUInstance.createVertexArray()}return C(e,[{key:"bind",value:function(){e._curBindedBufferState!==this&&(P.layaGPUInstance.bindVertexArray(this._nativeVertexArrayObject),e._curBindedBufferState=this)}},{key:"unBind",value:function(){if(e._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";P.layaGPUInstance.bindVertexArray(null),e._curBindedBufferState=null}},{key:"destroy",value:function(){P.layaGPUInstance.deleteVertexArray(this._nativeVertexArrayObject)}},{key:"bindForNative",value:function(){P.instance.bindVertexArray(this._nativeVertexArrayObject),e._curBindedBufferState=this}},{key:"unBindForNative",value:function(){P.instance.bindVertexArray(null),e._curBindedBufferState=null}}]),e}(),Ie=function(){T(t,Se);var e=b(t);function t(){return S(this,t),e.call(this)}return t}(),Ne=function(){function e(){S(this,e),this._byteLength=0,this._glBuffer=P.instance.createBuffer()}return C(e,[{key:"_bindForVAO",value:function(){}},{key:"bind",value:function(){return!1}},{key:"destroy",value:function(){this._glBuffer&&(P.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)}},{key:"bufferUsage",get:function(){return this._bufferUsage}}]),e}();be.loopStTm=0,be.loopCount=0;var Re=function(){T(n,Ne);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._maxsize=0,e._upload=!0,e._uploadSize=0,e._bufferSize=0,e._u8Array=null,e}return C(n,[{key:"setByteLength",value:function(e){this._byteLength!==e&&(e<=this._bufferSize||this._resizeBuffer(2*e+256,!0),this._byteLength=e)}},{key:"needSize",value:function(e){var t=this._byteLength;return e&&((e=this._byteLength+e)<=this._bufferSize||this._resizeBuffer(e<<1,!0),this._byteLength=e),t}},{key:"_bufferData",value:function(){this._maxsize=Math.max(this._maxsize,this._byteLength),be.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,P.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),P.instance.bufferSubData(this._bufferType,0,new Uint8Array(this._buffer,0,this._byteLength))}},{key:"_bufferSubData",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;this._maxsize=Math.max(this._maxsize,this._byteLength),be.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,P.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),t||n?(n=this._buffer.slice(t,n),P.instance.bufferSubData(this._bufferType,e,n)):P.instance.bufferSubData(this._bufferType,e,this._buffer)}},{key:"_checkArrayUse",value:function(){}},{key:"_bind_uploadForVAO",value:function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)}},{key:"_bind_upload",value:function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)}},{key:"_bind_subUpload",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(e,t,n),!0)}},{key:"_resizeBuffer",value:function(e,t){var n=this._buffer;if(e<=n.byteLength)return this;var i,a=this._u8Array;return t&&n&&0<n.byteLength?(i=new ArrayBuffer(e),t=a&&a.buffer==n?a:new Uint8Array(n),(a=this._u8Array=new Uint8Array(i)).set(t,0),n=this._buffer=i):(n=this._buffer=new ArrayBuffer(e),this._u8Array=null),this._checkArrayUse(),this._upload=!0,this._bufferSize=n.byteLength,this}},{key:"append",value:function(e){var t,n;this._upload=!0,t=e.byteLength,e instanceof Uint8Array?(this._resizeBuffer(this._byteLength+t,!0),n=new Uint8Array(this._buffer,this._byteLength)):e instanceof Uint16Array?(this._resizeBuffer(this._byteLength+t,!0),n=new Uint16Array(this._buffer,this._byteLength)):e instanceof Float32Array&&(this._resizeBuffer(this._byteLength+t,!0),n=new Float32Array(this._buffer,this._byteLength)),n.set(e,0),this._byteLength+=t,this._checkArrayUse()}},{key:"appendU16Array",value:function(e,t){this._resizeBuffer(this._byteLength+2*t,!0);var n=new Uint16Array(this._buffer,this._byteLength,t);if(6==t)n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5];else if(100<=t)n.set(new Uint16Array(e.buffer,0,t));else for(var i=0;i<t;i++)n[i]=e[i];this._byteLength+=2*t,this._checkArrayUse()}},{key:"appendEx",value:function(e,t){var n;this._upload=!0,n=e.byteLength,this._resizeBuffer(this._byteLength+n,!0),new t(this._buffer,this._byteLength).set(e,0),this._byteLength+=n,this._checkArrayUse()}},{key:"appendEx2",value:function(e,t,n){var i,a,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;for(this._upload=!0,r=n*r,this._resizeBuffer(this._byteLength+r,!0),i=new t(this._buffer,this._byteLength),a=0;a<n;a++)i[a]=e[a];this._byteLength+=r,this._checkArrayUse()}},{key:"getBuffer",value:function(){return this._buffer}},{key:"setNeedUpload",value:function(){this._upload=!0}},{key:"getNeedUpload",value:function(){return this._upload}},{key:"upload",value:function(){var e=P.instance,t=this._bind_upload();return e.bindBuffer(this._bufferType,null),this._bufferType==e.ARRAY_BUFFER&&(Ne._bindedVertexBuffer=null),this._bufferType==e.ELEMENT_ARRAY_BUFFER&&(Ne._bindedIndexBuffer=null),W.activeShader=null,t}},{key:"subUpload",value:function(){var e=P.instance,t=this._bind_subUpload();return e.bindBuffer(this._bufferType,null),this._bufferType==e.ARRAY_BUFFER&&(Ne._bindedVertexBuffer=null),this._bufferType==e.ELEMENT_ARRAY_BUFFER&&(Ne._bindedIndexBuffer=null),W.activeShader=null,t}},{key:"_disposeResource",value:function(){this._upload=!0,this._uploadSize=0}},{key:"clear",value:function(){this._byteLength=0,this._upload=!0}},{key:"bufferLength",get:function(){return this._buffer.byteLength}},{key:"byteLength",set:function(e){this.setByteLength(e)}}],[{key:"__int__",value:function(e){}}]),n}();Re.FLOAT32=4,Re.SHORT=2;var Ce=function(){T(i,Re);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:35044;return S(this,i),(e=n.call(this))._bufferUsage=t,e._bufferType=P.instance.ELEMENT_ARRAY_BUFFER,e._buffer=new ArrayBuffer(8),e}return C(i,[{key:"_checkArrayUse",value:function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))}},{key:"getUint16Array",value:function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))}},{key:"_bindForVAO",value:function(){var e=P.instance;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._glBuffer)}},{key:"bind",value:function(){if(Ne._bindedIndexBuffer===this._glBuffer)return!1;var e=P.instance;return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._glBuffer),Ne._bindedIndexBuffer=this._glBuffer,!0}},{key:"destory",value:function(){this._uint16Array=null,this._buffer=null}},{key:"disposeResource",value:function(){this._disposeResource()}}]),i}();Ce.create=function(){return new Ce(0<arguments.length&&void 0!==arguments[0]?arguments[0]:35044)};var Ae=function(){T(a,Re);var i=b(a);function a(e,t){var n;return S(this,a),(n=i.call(this))._vertexStride=e,n._bufferUsage=t,n._bufferType=P.instance.ARRAY_BUFFER,n._buffer=new ArrayBuffer(8),n._floatArray32=new Float32Array(n._buffer),n._uint32Array=new Uint32Array(n._buffer),n}return C(a,[{key:"getFloat32Array",value:function(){return this._floatArray32}},{key:"appendArray",value:function(e){var t=this._byteLength>>2;this.setByteLength(this._byteLength+4*e.length),this.getFloat32Array().set(e,t),this._upload=!0}},{key:"_checkArrayUse",value:function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))}},{key:"deleteBuffer",value:function(){G(z(a.prototype),"_disposeResource",this).call(this)}},{key:"_bindForVAO",value:function(){var e=P.instance;e.bindBuffer(e.ARRAY_BUFFER,this._glBuffer)}},{key:"bind",value:function(){if(Ne._bindedVertexBuffer===this._glBuffer)return!1;var e=P.instance;return e.bindBuffer(e.ARRAY_BUFFER,this._glBuffer),Ne._bindedVertexBuffer=this._glBuffer,!0}},{key:"destroy",value:function(){G(z(a.prototype),"destroy",this).call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null}},{key:"vertexStride",get:function(){return this._vertexStride}}]),a}();Ae.create=function(e){return new Ae(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:35048)};var De=function(){function i(e,t,n){S(this,i),this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._quadNum=0,this.canReuse=!1,this._stride=e,this._vb=new Ae(e,P.instance.DYNAMIC_DRAW),t?this._vb._resizeBuffer(t,!1):ye.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*e,!1),this._ib=new Ce,n&&this._ib._resizeBuffer(n,!1)}return C(i,[{key:"cloneWithNewVB",value:function(){var e=new i(this._stride,0,0);return e._ib=this._ib,e._quadNum=this._quadNum,e._attribInfo=this._attribInfo,e}},{key:"cloneWithNewVBIB",value:function(){var e=new i(this._stride,0,0);return e._attribInfo=this._attribInfo,e}},{key:"getVBW",value:function(){return this._vb.setNeedUpload(),this._vb}},{key:"getVBR",value:function(){return this._vb}},{key:"getIBR",value:function(){return this._ib}},{key:"getIBW",value:function(){return this._ib.setNeedUpload(),this._ib}},{key:"createQuadIB",value:function(e){this._quadNum=e,this._ib._resizeBuffer(6*e*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var t=this._ib.getUint16Array(),n=0,i=0,a=0;a<e;a++)t[n++]=i,t[n++]=i+2,t[n++]=i+1,t[n++]=i,t[n++]=i+3,t[n++]=i+2,i+=4;this._ib.setNeedUpload()}},{key:"setAttributes",value:function(e){if(this._attribInfo=e,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"}},{key:"configVAO",value:function(e){if(!this._applied){this._applied=!0,this._vao||(this._vao=new Ie),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var t=this._attribInfo.length/3,n=0,i=0;i<t;i++){var a=this._attribInfo[n+1],r=this._attribInfo[n],o=this._attribInfo[n+2];e.enableVertexAttribArray(i),e.vertexAttribPointer(i,a,r,!1,this._stride,o),n+=3}this._vao.unBind()}}},{key:"useMesh",value:function(e){this._applied||this.configVAO(e),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()}},{key:"getEleNum",value:function(){return this._ib.getBuffer().byteLength/2}},{key:"releaseMesh",value:function(){}},{key:"destroy",value:function(){}},{key:"clearVB",value:function(){this._vb.clear()}}]),i}();De._gvaoid=0;var Le=function(){T(l,De);var t=b(l);function l(){var e;return S(this,l),(e=t.call(this,l.const_stride,4,4)).canReuse=!0,e.setAttributes(l._fixattriInfo),l._fixib?(e._ib=l._fixib,e._quadNum=l._maxIB):(e.createQuadIB(l._maxIB),l._fixib=e._ib),e}return C(l,[{key:"releaseMesh",value:function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,l._POOL.push(this)}},{key:"destroy",value:function(){this._vb.destroy(),this._vb.deleteBuffer()}},{key:"addQuad",value:function(e,t,n,i){var a=this._vb,r=a._byteLength>>2;a.setByteLength(r+l.const_stride<<2);var o=a._floatArray32||a.getFloat32Array(),s=a._uint32Array,r=r,i=i?255:0;o[r++]=e[0],o[r++]=e[1],o[r++]=t[0],o[r++]=t[1],s[r++]=n,s[r++]=i,o[r++]=e[2],o[r++]=e[3],o[r++]=t[2],o[r++]=t[3],s[r++]=n,s[r++]=i,o[r++]=e[4],o[r++]=e[5],o[r++]=t[4],o[r++]=t[5],s[r++]=n,s[r++]=i,o[r++]=e[6],o[r++]=e[7],o[r++]=t[6],o[r++]=t[7],s[r++]=n,s[+r]=i,a._upload=!0}}],[{key:"__int__",value:function(){l._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}},{key:"getAMesh",value:function(e){var t=null,t=l._POOL.length?l._POOL.pop():new l;return e&&t._vb._resizeBuffer(65536*l.const_stride,!1),t}}]),l}();Le.const_stride=24,Le._maxIB=16384,Le._POOL=[];var Oe=function(){T(M,De);var t=b(M);function M(){var e;return S(this,M),(e=t.call(this,M.const_stride,4,4)).canReuse=!0,e.setAttributes(M._fixattriInfo),e}return C(M,[{key:"addData",value:function(e,t,n,i,a){var r=this._vb,o=this._ib,s=e.length>>1,l=r.needSize(s*M.const_stride)>>2,h=r._floatArray32||r.getFloat32Array(),u=r._uint32Array,d=0,c=i.a,_=i.b,f=i.c,g=i.d,y=i.tx,v=i.ty,p=0;for(p=0;p<s;p++){var m=e[d],w=e[d+1];h[l]=m*c+w*f+y,h[l+1]=m*_+w*g+v,h[l+2]=t[d],h[l+3]=t[d+1],u[l+4]=a,u[l+5]=255,l+=6,d+=2}r.setNeedUpload();var x=this.vertNum,i=n.length,r=o.needSize(n.byteLength),k=o.getUint16Array(),r=r>>1;if(0<x)for(var T=r+i,E=0,p=r;p<T;p++,E++)k[p]=n[E]+x;else k.set(n,r);o.setNeedUpload(),this.vertNum+=s,this.indexNum+=n.length}},{key:"releaseMesh",value:function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,M._POOL.push(this)}},{key:"destroy",value:function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()}}],[{key:"__init__",value:function(){M._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}},{key:"getAMesh",value:function(e){var t=M._POOL.length?M._POOL.pop():new M;return e&&t._vb._resizeBuffer(65536*M.const_stride,!1),t}}]),M}();Oe.const_stride=24,Oe._POOL=[];var Pe=function(){T(u,De);var t=b(u);function u(){var e;return S(this,u),(e=t.call(this,u.const_stride,4,4)).canReuse=!0,e.setAttributes(u._fixattriInfo),e}return C(u,[{key:"addVertAndIBToMesh",value:function(e,t,n,i){for(var a=this._vb.needSize(t.length/2*u.const_stride)>>2,r=this._vb._floatArray32||this._vb.getFloat32Array(),o=this._vb._uint32Array,s=0,l=t.length/2,h=0;h<l;h++)r[a++]=t[s],r[a++]=t[s+1],s+=2,o[a++]=n;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(i)),this._ib.setNeedUpload(),this.vertNum+=l,this.indexNum+=i.length}},{key:"releaseMesh",value:function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,u._POOL.push(this)}},{key:"destroy",value:function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()}}],[{key:"__init__",value:function(){u._fixattriInfo=[5126,2,0,5121,4,8]}},{key:"getAMesh",value:function(e){var t=u._POOL.length?u._POOL.pop():new u;return e&&t._vb._resizeBuffer(65536*u.const_stride,!1),t}}]),u}();Pe.const_stride=12,Pe._POOL=[];var Fe=function(){function n(e,t){S(this,n),this.submitStartPos=0,this.submitEndPos=0,this.context=null,this.touches=[],this.submits=[],this.sprite=null,this.meshlist=[],this.cachedClipInfo=new D,this.oldTx=0,this.oldTy=0,this.invMat=new D,this.context=e,this.sprite=t,e._globalClipMatrix.copyTo(this.cachedClipInfo)}return C(n,[{key:"startRec",value:function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context)),this.context._incache=!0,this.touches.length=0,this.context.touches=this.touches,this.context._globalClipMatrix.copyTo(this.cachedClipInfo),this.submits.length=0,this.submitStartPos=this.context._submits._length;for(var e=0,t=this.meshlist.length;e<t;e++){var n=this.meshlist[e];n.canReuse?n.releaseMesh():n.destroy()}this.meshlist.length=0,this._mesh=Le.getAMesh(!1),this._pathMesh=Pe.getAMesh(!1),this._triangleMesh=Oe.getAMesh(!1),this.meshlist.push(this._mesh),this.meshlist.push(this._pathMesh),this.meshlist.push(this._triangleMesh),this.context._curSubmit=we.RENDERBASE,this._oldMesh=this.context._mesh,this._oldPathMesh=this.context._pathMesh,this._oldTriMesh=this.context._triangleMesh,this._oldMeshList=this.context.meshlist,this.context._mesh=this._mesh,this.context._pathMesh=this._pathMesh,this.context._triangleMesh=this._triangleMesh,this.context.meshlist=this.meshlist,this.oldTx=this.context._curMat.tx,this.oldTy=this.context._curMat.ty,this.context._curMat.tx=0,this.context._curMat.ty=0,this.context._curMat.copyTo(this.invMat),this.invMat.invert()}},{key:"endRec",value:function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));var e=this.context._submits;this.submitEndPos=e._length;for(var t=this.submitEndPos-this.submitStartPos,n=0;n<t;n++)this.submits.push(e[this.submitStartPos+n]);e._length-=t,this.context._mesh=this._oldMesh,this.context._pathMesh=this._oldPathMesh,this.context._triangleMesh=this._oldTriMesh,this.context.meshlist=this._oldMeshList,this.context._curSubmit=we.RENDERBASE,this.context._curMat.tx=this.oldTx,this.context._curMat.ty=this.oldTy,this.context.touches=null,this.context._incache=!1}},{key:"isCacheValid",value:function(){var e=this.context._globalClipMatrix;return e.a==this.cachedClipInfo.a&&e.b==this.cachedClipInfo.b&&e.c==this.cachedClipInfo.c&&e.d==this.cachedClipInfo.d&&e.tx==this.cachedClipInfo.tx&&e.ty==this.cachedClipInfo.ty}},{key:"flushsubmit",value:function(){var t=we.RENDERBASE;this.submits.forEach(function(e){e!=we.RENDERBASE&&(we.preRender=t,(t=e).renderSubmit())})}},{key:"releaseMem",value:function(){}}]),n}();Fe.matI=new D;var Be=function(){function e(){S(this,e),this.ALPHA=1,this.defines=new Q,this.shaderType=0,this.fillStyle=ve.DEFAULT,this.strokeStyle=ve.DEFAULT}return C(e,[{key:"destroy",value:function(){this.defines=null,this.filters=null}}],[{key:"__init__",value:function(){$.preCompile2D(0,Q.TEXTURE2D,"/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\nuniform vec2 clipOff;\t\t\t// 使用要把clip偏移。cacheas normal用. 只用了[0]\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\t\n\tvec2 clpos = clipMatPos.xy;\n\t#ifdef WORLDMAT\n\t\t// 如果有mmat，需要修改clipMatPos,因为 这是cacheas normal （如果不是就错了）， clipMatPos被去掉了偏移\n\t\tif(clipOff[0]>0.0){\n\t\t\tclpos.x+=mmat[3].x;\t//tx\t最简单处理\n\t\t\tclpos.y+=mmat[3].y;\t//ty\n\t\t}\n\t#endif\n\tvec2 clippos = pos.xy - clpos;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}","/*\n\ttexture和fillrect使用的。\n*/\n#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",null),$.preCompile2D(0,Q.PRIMITIVE,"attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}","precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}",null),$.preCompile2D(0,Q.SKINMESH,"attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}","precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",null)}}]),e}(),Ve=function(){function t(){S(this,t);var e=P.instance;this.ib=Ce.create(e.DYNAMIC_DRAW),this.vb=Ae.create(8)}return C(t,[{key:"addSkinMesh",value:function(e){e.getData2(this.vb,this.ib,this.vb._byteLength/32)}},{key:"reset",value:function(){this.vb.clear(),this.ib.clear()}}],[{key:"getInstance",value:function(){return t.instance=t.instance||new t}}]),t}(),Ue=function(){function b(){S(this,b)}return C(b,null,[{key:"createLine2",value:function(e,t,n,i,a,r){if(e.length<4)return null;var o=b.tempData.length>e.length+2?b.tempData:new Array(e.length+2);o[0]=e[0],o[1]=e[1];for(var s=2,l=0,h=e.length,l=2;l<h;l+=2).01<Math.abs(e[l]-e[l-2])+Math.abs(e[l+1]-e[l-1])&&(o[s++]=e[l],o[s++]=e[l+1]);r&&.01<Math.abs(e[0]-o[s-2])+Math.abs(e[1]-o[s-1])&&(o[s++]=e[0],o[s++]=e[1]);var u,d,c,_,f,g,y,v=a,h=s/2,p=n/2,m=o[0],w=o[1],x=o[2],k=o[3],T=-(w-k),E=m-x,M=Math.sqrt(T*T+E*E);for(T=T/M*p,E=E/M*p,v.push(m-T,w-E,m+T,w+E),l=1;l<h-1;l++)m=o[2*(l-1)],w=o[2*(l-1)+1],x=o[2*l],k=o[2*l+1],_=o[2*(l+1)],d=o[2*(l+1)+1],E=m-x,y=x-_,c=(-(T=(T=-(w-k))/(M=Math.sqrt(T*T+E*E))*p)+m)*(-(E=E/M*p)+k)-(-T+x)*(-E+w),g=(-(f=(f=-(k-d))/(M=Math.sqrt(f*f+y*y))*p)+_)*(-(y=y/M*p)+k)-(-f+x)*(-y+d),y=(u=-E+w-(-E+k))*(f=-f+x-(-f+_))-(_=-y+d-(-y+k))*(d=-T+x-(-T+m)),Math.abs(y)<.1?(y+=10.1,v.push(x-T,k-E,x+T,k+E)):(f=(d*g-f*c)/y,y=(_*c-u*g)/y,v.push(f,y,x-(f-x),k-(y-k)));for(m=o[s-4],w=o[s-3],E=m-(x=o[s-2]),T=(T=-(w-(k=o[s-1])))/(M=Math.sqrt(T*T+E*E))*p,E=E/M*p,v.push(x-T,k-E,x+T,k+E),l=1;l<h;l++)t.push(i+2*(l-1),i+2*(l-1)+1,i+2*l+1,i+2*l+1,i+2*l,i+2*(l-1));return v}},{key:"createLineTriangle",value:function(e,t,n,i,a,r,o){var s=e.slice(),e=s.length,l=s[0],h=s[1],u=s[2],d=(s[2],0),c=0,_=0,f=0,g=e/2;if(!(g<=1)&&2!=g){for(var y=new Array(4*g),v=0,p=0,m=0;m<g-1;m++)l=s[p++],h=s[p++],u=s[p++],f=s[p++]-h,0!=(_=u-l)&&0!=f&&.001<(d=Math.sqrt(_*_+f*f))&&(y[c=4*v]=l,y[c+1]=h,y[c+2]=_/d,y[c+3]=f/d,v++);for(i?(l=s[e-2],h=s[e-1],u=s[0],f=s[1]-h,0!=(_=u-l)&&0!=f&&.001<(d=Math.sqrt(_*_+f*f))&&(y[c=4*v]=l,y[c+1]=h,y[c+2]=_/d,y[c+3]=f/d,v++)):(y[c=4*v]=l,y[c+1]=h,y[c+2]=_/d,y[c+3]=f/d,v++),m=p=0;m<g;m++)l=s[p],h=s[p+1],u=s[p+2],s[p+3]}}}]),b}();function ze(e,t,n){S(this,ze),this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ue.tempData=new Array(256);var Ge=function(){function g(){S(this,g)}return C(g,null,[{key:"earcut",value:function(e,t,n){n=n||2;var i,a,r,o,s,l,h,u=t&&t.length,d=u?t[0]*n:e.length,c=g.linkedList(e,0,d,n,!0),_=[];if(!c)return _;if(u&&(c=g.eliminateHoles(e,t,c,n)),e.length>80*n){i=r=e[0],a=o=e[1];for(var f=n;f<d;f+=n)(s=e[f])<i&&(i=s),(l=e[f+1])<a&&(a=l),r<s&&(r=s),o<l&&(o=l);h=0!==(h=Math.max(r-i,o-a))?1/h:0}return g.earcutLinked(c,_,n,i,a,h),_}},{key:"linkedList",value:function(e,t,n,i,a){var r,o;if(a===0<g.signedArea(e,t,n,i))for(r=t;r<n;r+=i)o=g.insertNode(r,e[r],e[r+1],o);else for(r=n-i;t<=r;r-=i)o=g.insertNode(r,e[r],e[r+1],o);return o&&g.equals(o,o.next)&&(g.removeNode(o),o=o.next),o}},{key:"filterPoints",value:function(e,t){if(!e)return e;t=t||e;var n,i=e;do{if(n=!1,i.steiner||!g.equals(i,i.next)&&0!==g.area(i.prev,i,i.next))i=i.next;else{if(g.removeNode(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}},{key:"earcutLinked",value:function(e,t,n,i,a,r){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;if(e){!o&&r&&g.indexCurve(e,i,a,r);for(var s,l,h=e;e.prev!==e.next;)if(s=e.prev,l=e.next,r?g.isEarHashed(e,i,a,r):g.isEar(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),g.removeNode(e),e=l.next,h=l.next;else if((e=l)===h){o?1===o?(e=g.cureLocalIntersections(e,t,n),g.earcutLinked(e,t,n,i,a,r,2)):2===o&&g.splitEarcut(e,t,n,i,a,r):g.earcutLinked(g.filterPoints(e,null),t,n,i,a,r,1);break}}}},{key:"isEar",value:function(e){var t=e.prev,n=e,i=e.next;if(0<=g.area(t,n,i))return!1;for(var a=e.next.next;a!==e.prev;){if(g.pointInTriangle(t.x,t.y,n.x,n.y,i.x,i.y,a.x,a.y)&&0<=g.area(a.prev,a,a.next))return!1;a=a.next}return!0}},{key:"isEarHashed",value:function(e,t,n,i){var a=e.prev,r=e,o=e.next;if(0<=g.area(a,r,o))return!1;for(var s=(a.x<r.x?a.x<o.x?a:o:r.x<o.x?r:o).x,l=(a.y<r.y?a.y<o.y?a:o:r.y<o.y?r:o).y,h=(a.x>r.x?a.x>o.x?a:o:r.x>o.x?r:o).x,u=(a.y>r.y?a.y>o.y?a:o:r.y>o.y?r:o).y,d=g.zOrder(s,l,t,n,i),c=g.zOrder(h,u,t,n,i),_=e.nextZ;_&&_.z<=c;){if(_!==e.prev&&_!==e.next&&g.pointInTriangle(a.x,a.y,r.x,r.y,o.x,o.y,_.x,_.y)&&0<=g.area(_.prev,_,_.next))return!1;_=_.nextZ}for(_=e.prevZ;_&&_.z>=d;){if(_!==e.prev&&_!==e.next&&g.pointInTriangle(a.x,a.y,r.x,r.y,o.x,o.y,_.x,_.y)&&0<=g.area(_.prev,_,_.next))return!1;_=_.prevZ}return!0}},{key:"cureLocalIntersections",value:function(e,t,n){var i=e;do{var a=i.prev,r=i.next.next}while(!g.equals(a,r)&&g.intersects(a,i,i.next,r)&&g.locallyInside(a,r)&&g.locallyInside(r,a)&&(t.push(a.i/n),t.push(i.i/n),t.push(r.i/n),g.removeNode(i),g.removeNode(i.next),i=e=r),(i=i.next)!==e);return i}},{key:"splitEarcut",value:function(e,t,n,i,a,r){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&g.isValidDiagonal(o,s)){var l=g.splitPolygon(o,s),o=g.filterPoints(o,o.next),l=g.filterPoints(l,l.next);return g.earcutLinked(o,t,n,i,a,r),void g.earcutLinked(l,t,n,i,a,r)}s=s.next}}while((o=o.next)!==e)}},{key:"eliminateHoles",value:function(e,t,n,i){for(var a,r,o=[],s=0,l=t.length;s<l;s++)a=t[s]*i,r=s<l-1?t[s+1]*i:e.length,(r=g.linkedList(e,a,r,i,!1))===r.next&&(r.steiner=!0),o.push(g.getLeftmost(r));for(o.sort(g.compareX),s=0;s<o.length;s++)g.eliminateHole(o[s],n),n=g.filterPoints(n,n.next);return n}},{key:"compareX",value:function(e,t){return e.x-t.x}},{key:"eliminateHole",value:function(e,t){(t=g.findHoleBridge(e,t))&&(e=g.splitPolygon(t,e),g.filterPoints(e,e.next))}},{key:"findHoleBridge",value:function(e,t){var n,i=t,a=e.x,r=e.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=a&&o<s){if((o=s)===a){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}}while((i=i.next)!==t);if(!n)return null;if(a===o)return n.prev;for(var l,h=n,u=n.x,d=n.y,c=1/0,i=n.next;i!==h;)a>=i.x&&i.x>=u&&a!==i.x&&g.pointInTriangle(r<d?a:o,r,u,d,r<d?o:a,r,i.x,i.y)&&((l=Math.abs(r-i.y)/(a-i.x))<c||l===c&&i.x>n.x)&&g.locallyInside(i,e)&&(n=i,c=l),i=i.next;return n}},{key:"indexCurve",value:function(e,t,n,i){for(var a=e;null===a.z&&(a.z=g.zOrder(a.x,a.y,t,n,i)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next,a!==e;);a.prevZ.nextZ=null,a.prevZ=null,g.sortLinked(a)}},{key:"sortLinked",value:function(e){var t,n,i,a,r,o,s,l,h=1;do{for(n=e,r=e=null,o=0;n;){for(o++,i=n,t=s=0;t<h&&(s++,i=i.nextZ);t++);for(l=h;0<s||0<l&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(n=(a=n).nextZ,s--):(i=(a=i).nextZ,l--),r?r.nextZ=a:e=a,a.prevZ=r,r=a;n=i}}while(r.nextZ=null,h*=2,1<o);return e}},{key:"zOrder",value:function(e,t,n,i,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}},{key:"getLeftmost",value:function(e){for(var t=e,n=e;t.x<n.x&&(n=t),t=t.next,t!==e;);return n}},{key:"pointInTriangle",value:function(e,t,n,i,a,r,o,s){return 0<=(a-o)*(t-s)-(e-o)*(r-s)&&0<=(e-o)*(i-s)-(n-o)*(t-s)&&0<=(n-o)*(r-s)-(a-o)*(i-s)}},{key:"isValidDiagonal",value:function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!g.intersectsPolygon(e,t)&&g.locallyInside(e,t)&&g.locallyInside(t,e)&&g.middleInside(e,t)}},{key:"area",value:function(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}},{key:"equals",value:function(e,t){return e.x===t.x&&e.y===t.y}},{key:"intersects",value:function(e,t,n,i){return!!(g.equals(e,t)&&g.equals(n,i)||g.equals(e,i)&&g.equals(n,t))||0<g.area(e,t,n)!=0<g.area(e,t,i)&&0<g.area(n,i,e)!=0<g.area(n,i,t)}},{key:"intersectsPolygon",value:function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&g.intersects(n,n.next,e,t))return!0}while((n=n.next)!==e);return!1}},{key:"locallyInside",value:function(e,t){return g.area(e.prev,e,e.next)<0?0<=g.area(e,t,e.next)&&0<=g.area(e,e.prev,t):g.area(e,t,e.prev)<0||g.area(e,e.next,t)<0}},{key:"middleInside",value:function(e,t){for(var n=e,i=!1,a=(e.x+t.x)/2,r=(e.y+t.y)/2;n.y>r!=n.next.y>r&&n.next.y!==n.y&&a<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next,n!==e;);return i}},{key:"splitPolygon",value:function(e,t){var n=new ze(e.i,e.x,e.y),i=new ze(t.i,t.x,t.y),a=e.next,r=t.prev;return(e.next=t).prev=e,(n.next=a).prev=n,(i.next=n).prev=i,(r.next=i).prev=r,i}},{key:"insertNode",value:function(e,t,n,i){n=new ze(e,t,n);return i?(n.next=i.next,(n.prev=i).next.prev=n,i.next=n):(n.prev=n).next=n,n}},{key:"removeNode",value:function(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}},{key:"signedArea",value:function(e,t,n,i){for(var a=0,r=t,o=n-i;r<n;r+=i)a+=(e[o]-e[r])*(e[r+1]+e[o+1]),o=r;return a}}]),g}(),Xe=function e(){S(this,e)};Xe.BYTES_PE=4,Xe.BYTES_PIDX=2,Xe.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Xe.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],Xe.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],Xe._TMPARRAY=[],Xe._OFFSETX=0,Xe._OFFSETY=0;var He=function(){T(r,we);var t=b(r);function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:we.TYPE_2D;return S(this,r),t.call(this,e)}return C(r,[{key:"renderSubmit",value:function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var e=this.shaderValue.textureHost;if(e){var t=e._getSource();if(!t)return 1;this.shaderValue.texture=t}t=y.mainContext;return this._mesh.useMesh(t),this.shaderValue.upload(),K.activeBlendFunction!==this._blendFn&&(y.setBlend(t,!0),this._blendFn(t),K.activeBlendFunction=this._blendFn),t.drawElements(t.TRIANGLES,this._numEle,t.UNSIGNED_SHORT,this._startIdx),J.renderBatches++,J.trianglesFaces+=this._numEle/3,1}},{key:"releaseRender",value:function(){we.RENDERBASE!=this&&--this._ref<1&&((r.POOL[r._poolSize++]=this).shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))}}],[{key:"create",value:function(e,t,n){var i=r._poolSize?r.POOL[--r._poolSize]:new r;i._ref=1,i._mesh=t,i._key.clear(),i._startIdx=t.indexNum*Xe.BYTES_PIDX,i._numEle=0;t=e._nBlendType;i._blendFn=(e._targets?K.targetFns:K.fns)[t],i.shaderValue=n,i.shaderValue.setValue(e._shader2D);e=e._shader2D.filters;return e&&i.shaderValue.setFilters(e),i}},{key:"createShape",value:function(e,t,n,i){var a=r._poolSize?r.POOL[--r._poolSize]:new r;a._mesh=t,a._numEle=n,a._startIdx=2*t.indexNum,a._ref=1,a.shaderValue=i,a.shaderValue.setValue(e._shader2D);i=e._nBlendType;return a._key.blendShader=i,a._blendFn=(e._targets?K.targetFns:K.fns)[i],a}}]),r}();He._poolSize=0,He.POOL=[];var Ye=function(){T(a,we);var t=b(a);function a(){var e;return S(this,a),(e=t.call(this,we.TYPE_2D))._matrix=new D,e._matrix4=Xe.defaultMatrix4.concat(),e.shaderValue=new ee(0,0),e}return C(a,[{key:"renderSubmit",value:function(){var e=j.worldAlpha,t=j.worldMatrix4,n=j.worldMatrix,i=j.worldFilters,a=j.worldShaderDefines,r=this.shaderValue,o=this._matrix,s=this._matrix4,l=D.TEMP;return D.mul(o,n,l),s[0]=l.a,s[1]=l.b,s[4]=l.c,s[5]=l.d,s[12]=l.tx,s[13]=l.ty,j.worldMatrix=l.clone(),j.worldMatrix4=s,j.worldAlpha=j.worldAlpha*r.alpha,r.filters&&r.filters.length&&(j.worldFilters=r.filters,j.worldShaderDefines=r.defines),this.canv.flushsubmit(),j.worldAlpha=e,j.worldMatrix4=t,j.worldMatrix.destroy(),j.worldMatrix=n,j.worldFilters=i,j.worldShaderDefines=a,1}},{key:"releaseRender",value:function(){var e;--this._ref<1&&(e=a.POOL,this._mesh=null,e[e._length++]=this)}},{key:"getRenderType",value:function(){return we.TYPE_CANVAS}}],[{key:"create",value:function(e,t,n){var i=a.POOL._length?a.POOL[--a.POOL._length]:new a;i.canv=e,i._ref=1,i._numEle=0;e=i.shaderValue;return e.alpha=t,e.defines.setValue(0),n&&n.length&&e.setFilters(n),i}}]),a}();Ye.POOL=[],Ye.POOL._length=0;var We=function(){function r(){S(this,r),this.blendType=0,this._ref=1,this._key=new te}return C(r,[{key:"renderSubmit",value:function(){var e=y.mainContext;this._mesh.useMesh(e);var t=this.srcRT;return t&&(this.shaderValue.texture=t._getSource(),this.shaderValue.upload(),this.blend(),J.renderBatches++,J.trianglesFaces+=this._numEle/3,e.drawElements(e.TRIANGLES,this._numEle,e.UNSIGNED_SHORT,this._startIdx)),1}},{key:"blend",value:function(){var e;K.activeBlendFunction!==K.fns[this.blendType]&&((e=y.mainContext).enable(e.BLEND),K.fns[this.blendType](e),K.activeBlendFunction=K.fns[this.blendType])}},{key:"getRenderType",value:function(){return 0}},{key:"releaseRender",value:function(){var e;--this._ref<1&&((e=r.POOL)[e._length++]=this)}}],[{key:"create",value:function(e,t,n,i){var a=r.POOL._length?r.POOL[--r.POOL._length]:new r;return a._mesh=t,a.srcRT=i,a._startIdx=t.indexNum*Xe.BYTES_PIDX,a._ref=1,a._key.clear(),a._numEle=0,a.blendType=e._nBlendType,a._key.blendShader=a.blendType,a.shaderValue=n,a.shaderValue.setValue(e._shader2D),e._colorFiler&&(e=e._colorFiler,n.defines.add(e.type),n.colorMat=e._mat,n.colorAlpha=e._alpha),a}}]),r}();We.POOL=[],We.POOL._length=0;var je=function(){T(a,we);var t=b(a);function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:we.TYPE_2D;return S(this,a),t.call(this,e)}return C(a,[{key:"releaseRender",value:function(){--this._ref<1&&((a.POOL[a._poolSize++]=this).shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))}},{key:"renderSubmit",value:function(){if(0===this._numEle)return 1;var e=this.shaderValue.textureHost;if(e){var t=e?e._getSource():null;if(!t)return 1}var n=y.mainContext;this._mesh.useMesh(n);var i=we.preRender,e=we.preRender._key;return 0===this._key.blendShader&&this._key.submitType===e.submitType&&this._key.blendShader===e.blendShader&&W.activeShader&&we.preRender.clipInfoID==this.clipInfoID&&i.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&Q.NOOPTMASK)?W.activeShader.uploadTexture2D(t):(K.activeBlendFunction!==this._blendFn&&(y.setBlend(n,!0),this._blendFn(n),K.activeBlendFunction=this._blendFn),this.shaderValue.texture=t,this.shaderValue.upload()),n.drawElements(n.TRIANGLES,this._numEle,n.UNSIGNED_SHORT,this._startIdx),J.renderBatches++,J.trianglesFaces+=this._numEle/3,1}}],[{key:"create",value:function(e,t,n){var i=a._poolSize?a.POOL[--a._poolSize]:new a(we.TYPE_TEXTURE);i._mesh=t,i._key.clear(),i._key.submitType=we.KEY_DRAWTEXTURE,i._ref=1,i._startIdx=t.indexNum*Xe.BYTES_PIDX,i._numEle=0;t=e._nBlendType;return i._key.blendShader=t,i._blendFn=(e._targets?K.targetFns:K.fns)[t],i.shaderValue=n,e._colorFiler&&(e=e._colorFiler,n.defines.add(e.type),n.colorMat=e._mat,n.colorAlpha=e._alpha),i}}]),a}();je._poolSize=0,je.POOL=[];var qe=function(){function o(){S(this,o),this._data=[],this._ndata=0,this._clipid=-1,this._clipMatrix=new D,this._enbale=!1}return C(o,[{key:"clear",value:function(){this._tex=null,this._imgId=-1,this._ndata=0,this._enbale=!1,this._colorFiler=null}},{key:"destroy",value:function(){this.clear(),this._data.length=0,this._data=null}},{key:"add",value:function(e,t,n,i,a,r){0<this._ndata&&(this._tex!=t||this._imgId!=n||0<=this._clipid&&this._clipid!=e._clipInfoID)&&this.submit(e),this._clipid=e._clipInfoID,e._globalClipMatrix.copyTo(this._clipMatrix),this._tex=t,this._imgId=n,this._colorFiler=e._colorFiler,this._data[this._ndata]=i,this._data[this._ndata+1]=a,this._data[this._ndata+2]=r,this._ndata+=3}},{key:"getPos",value:function(){return 0==o.__nPosPool?new Array(8):o.__posPool[--o.__nPosPool]}},{key:"enable",value:function(e,t){e!==this._enbale&&(this._enbale=e,this._enbale||this.submit(t))}},{key:"submit",value:function(e){var t=this._ndata;if(t){var n=e._mesh,i=e._colorFiler;e._colorFiler=this._colorFiler;var a=je.create(e,n,ee.create(Q.TEXTURE2D,0));(e._submits[e._submits._length++]=e._curSubmit=a).shaderValue.textureHost=this._tex,a._key.other=this._imgId,e._colorFiler=i,e._copyClipInfo(a,this._clipMatrix),a.clipInfoID=this._clipid;for(var r=0;r<t;r+=3)n.addQuad(this._data[r],this._data[r+1],this._data[r+2],!0),o.__posPool[o.__nPosPool++]=this._data[r];t/=3,a._numEle+=6*t,n.indexNum+=6*t,n.vertNum+=4*t,e._drawCount+=t,this._ndata=0,be.loopCount%100==0&&(this._data.length=0)}}}]),o}();qe.__posPool=[],qe.__nPosPool=0;var Ze=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;S(this,i),this.atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._used=0,this._cells=null,this._rowInfo=null,this.atlasID=n,this._init(e,t)}return C(i,[{key:"addRect",value:function(e,t,n,i){return!!this._get(t,n,i)&&(this._fill(i.x,i.y,t,n,e),this._texCount++,!0)}},{key:"_release",value:function(){this._cells=null,this._rowInfo=null}},{key:"_init",value:function(e,t){return this._width=e,this._height=t,this._release(),0!=this._width&&(this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=new Uint8Array(this._height),this._used=0,this._clear(),!0)}},{key:"_get",value:function(e,t,n){if(e>this._width||t>this._height)return!1;for(var i,a=-1,r=this._width,o=this._height,s=this._cells,l=0;l<o;l++)if(!(this._rowInfo[l]<e))for(var h=0;h<r;){var u=3*(l*r+h);if(0!=s[u]||s[1+u]<e||s[2+u]<t)h+=s[1+u];else{a=h,i=l;for(var d=0;d<e;d++)if(s[3*d+u+2]<t){a=-1;break}if(!(a<0))return n.x=a,n.y=i,!0;h+=s[1+u]}}return!1}},{key:"_fill",value:function(e,t,n,i,a){var r=this._width,o=this._height;this._check(e+n<=r&&t+i<=o);for(var s=t;s<i+t;++s){this._check(this._rowInfo[s]>=n),this._rowInfo[s]-=n;for(var l=0;l<n;l++){var h=3*(e+s*r+l);this._check(0==this._cells[h]),this._cells[h]=a,this._cells[1+h]=n,this._cells[2+h]=i}}if(0<e)for(s=0;s<i;++s){for(var u=0,l=e-1;0<=l&&0==this._cells[3*((t+s)*r+l)];--l,++u);for(l=u;0<l;--l)this._cells[3*((t+s)*r+e-l)+1]=l,this._check(0<l)}if(0<t)for(l=e;l<e+n;++l){for(u=0,s=t-1;0<=s&&0==this._cells[3*(l+s*r)];--s,u++);for(s=u;0<s;--s)this._cells[3*(l+(t-s)*r)+2]=s,this._check(0<s)}this._used+=n*i/(this._width*this._height)}},{key:"_check",value:function(e){0==e&&console.log("xtexMerger 错误啦")}},{key:"_clear",value:function(){for(var e=this._texCount=0;e<this._height;e++)this._rowInfo[e]=this._width;for(var t=0;t<this._height;t++)for(var n=0;n<this._width;n++){var i=3*(t*this._width+n);this._cells[i]=0,this._cells[1+i]=this._width-n,this._cells[2+i]=this._width-t}}}]),i}(),Ke=function(){T(h,V);var i=b(h);function h(e,t){var n;return S(this,h),(n=i.call(this))._texW=0,n._texH=0,n.__destroyed=!1,n._discardTm=0,n.genID=0,n.bitmap={id:0,_glTexture:null},n.curUsedCovRate=0,n.curUsedCovRateAtlas=0,n.lastTouchTm=0,n.ri=null,n._texW=e||h.gTextRender.atlasWidth,n._texH=t||h.gTextRender.atlasWidth,n.bitmap.id=n.id,n.lock=!0,n}return C(h,[{key:"recreateResource",value:function(){var e,t;this._source||(e=P.instance,t=this._source=e.createTexture(),this.bitmap._glTexture=t,y.bindTexture(e,e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this._texW,this._texH,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),h.gTextRender.debugUV&&this.fillWhite())}},{key:"addChar",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(h.gTextRender.isWan1Wan)return this.addCharCanvas(e,t,n,i);this._source||this.recreateResource();var a=P.instance;y.bindTexture(a,a.TEXTURE_2D,this._source),M.Render.isConchApp||a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var r,o,s,l=e.data;return e.data instanceof Uint8ClampedArray&&(l=new Uint8Array(l.buffer)),a.texSubImage2D(a.TEXTURE_2D,0,t,n,e.width,e.height,a.RGBA,a.UNSIGNED_BYTE,l),M.Render.isConchApp||a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e=M.Render.isConchApp?(r=t/this._texW,o=n/this._texH,s=(t+e.width)/this._texW,(n+e.height)/this._texH):(r=(t+1)/this._texW,o=n/this._texH,s=(t+e.width-1)/this._texW,(n+e.height-1)/this._texH),(i=i||new Array(8))[0]=r,i[1]=o,i[2]=s,i[3]=o,i[4]=s,i[5]=e,i[6]=r,i[7]=e,i}},{key:"addCharCanvas",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this._source||this.recreateResource();var a,r,o,s=P.instance;return y.bindTexture(s,s.TEXTURE_2D,this._source),M.Render.isConchApp||s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.texSubImage2D(s.TEXTURE_2D,0,t,n,s.RGBA,s.UNSIGNED_BYTE,e),M.Render.isConchApp||s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e=M.Render.isConchApp?(a=t/this._texW,r=n/this._texH,o=(t+e.width)/this._texW,(n+e.height)/this._texH):(a=(t+1)/this._texW,r=(n+1)/this._texH,o=(t+e.width-1)/this._texW,(n+e.height-1)/this._texH),(i=i||new Array(8))[0]=a,i[1]=r,i[2]=o,i[3]=r,i[4]=o,i[5]=e,i[6]=a,i[7]=e,i}},{key:"fillWhite",value:function(){this._source||this.recreateResource();var e=P.instance,t=new Uint8Array(this._texW*this._texH*4);t.fill(255),e.texSubImage2D(e.TEXTURE_2D,0,0,0,this._texW,this._texH,e.RGBA,e.UNSIGNED_BYTE,t)}},{key:"discard",value:function(){this._texW==h.gTextRender.atlasWidth&&this._texH==h.gTextRender.atlasWidth?(this.genID++,h.poolLen>=h.pool.length&&(h.pool=h.pool.concat(new Array(10))),this._discardTm=be.loopStTm,h.pool[h.poolLen++]=this):this.destroy()}},{key:"destroy",value:function(){this.__destroyed=!0;var e=P.instance;this._source&&e.deleteTexture(this._source),this._source=null}},{key:"touchRect",value:function(e,t){this.lastTouchTm!=t&&(this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=t);var n=h.gTextRender.atlasWidth*h.gTextRender.atlasWidth,t=M.TextAtlas.atlasGridW*M.TextAtlas.atlasGridW;this.curUsedCovRate+=e.bmpWidth*e.bmpHeight/n,this.curUsedCovRateAtlas+=Math.ceil(e.bmpWidth/M.TextAtlas.atlasGridW)*Math.ceil(e.bmpHeight/M.TextAtlas.atlasGridW)/(n/t)}},{key:"_getSource",value:function(){return this._source}},{key:"drawOnScreen",value:function(e,t){}},{key:"texture",get:function(){return this}}],[{key:"getTextTexture",value:function(e,t){if(e!=h.gTextRender.atlasWidth||e!=h.gTextRender.atlasWidth)return new h(e,t);if(0<h.poolLen){var n=h.pool[--h.poolLen];return 0<h.poolLen&&h.clean(),n}return new h(e,t)}},{key:"clean",value:function(){var e=be.loopStTm;if(e-(h.cleanTm=0===h.cleanTm?e:h.cleanTm)>=h.gTextRender.checkCleanTextureDt){for(var t=0;t<h.poolLen;t++){var n=h.pool[t];e-n._discardTm>=h.gTextRender.destroyUnusedTextureDt&&(n.destroy(),h.pool[t]=h.pool[h.poolLen-1],h.poolLen--,t--)}h.cleanTm=e}}}]),h}();Ke.gTextRender=null,Ke.pool=new Array(10),Ke.poolLen=0,Ke.cleanTm=0;var Qe=function(){function i(){S(this,i),this.texWidth=1024,this.texHeight=1024,this.texture=null,this.charMaps={},this.texHeight=this.texWidth=M.TextRender.atlasWidth,this.texture=Ke.getTextTexture(this.texWidth,this.texHeight),256<this.texWidth/i.atlasGridW&&(i.atlasGridW=Math.ceil(this.texWidth/256)),this.atlasgrid=new Ze(this.texWidth/i.atlasGridW,this.texHeight/i.atlasGridW,this.texture.id)}return C(i,[{key:"setProtecteDist",value:function(e){}},{key:"getAEmpty",value:function(e,t,n){t=this.atlasgrid.addRect(1,Math.ceil(e/i.atlasGridW),Math.ceil(t/i.atlasGridW),n);return t&&(n.x*=i.atlasGridW,n.y*=i.atlasGridW),t}},{key:"destroy",value:function(){for(var e in this.charMaps)this.charMaps[e].deleted=!0;this.texture.discard()}},{key:"printDebugInfo",value:function(){}},{key:"usedRate",get:function(){return this.atlasgrid._used}}]),i}();Qe.atlasGridW=16;var Je=function(){function e(){S(this,e)}return C(e,[{key:"setTo",value:function(e,t,n){return this.type=e,this.currentTarget=t,this.target=n,this}},{key:"stopPropagation",value:function(){this._stoped=!0}},{key:"touches",get:function(){if(!this.nativeEvent)return null;var e=this.nativeEvent.touches;if(e)for(var t=M.stage,n=0,i=e.length;n<i;n++){var a=e[n],r=L.TEMP;r.setTo(a.clientX,a.clientY),t._canvasTransform.invertTransformPoint(r),t.transform.invertTransformPoint(r),a.stageX=r.x,a.stageY=r.y}return e}},{key:"altKey",get:function(){return this.nativeEvent.altKey}},{key:"ctrlKey",get:function(){return this.nativeEvent.ctrlKey}},{key:"shiftKey",get:function(){return this.nativeEvent.shiftKey}},{key:"charCode",get:function(){return this.nativeEvent.charCode}},{key:"keyLocation",get:function(){return this.nativeEvent.location||this.nativeEvent.keyLocation}},{key:"stageX",get:function(){return M.stage.mouseX}},{key:"stageY",get:function(){return M.stage.mouseY}}]),e}();Je.EMPTY=new Je,Je.MOUSE_DOWN="mousedown",Je.MOUSE_UP="mouseup",Je.CLICK="click",Je.RIGHT_MOUSE_DOWN="rightmousedown",Je.RIGHT_MOUSE_UP="rightmouseup",Je.RIGHT_CLICK="rightclick",Je.MOUSE_MOVE="mousemove",Je.MOUSE_OVER="mouseover",Je.MOUSE_OUT="mouseout",Je.MOUSE_WHEEL="mousewheel",Je.ROLL_OVER="mouseover",Je.ROLL_OUT="mouseout",Je.DOUBLE_CLICK="doubleclick",Je.CHANGE="change",Je.CHANGED="changed",Je.RESIZE="resize",Je.ADDED="added",Je.REMOVED="removed",Je.DISPLAY="display",Je.UNDISPLAY="undisplay",Je.ERROR="error",Je.COMPLETE="complete",Je.LOADED="loaded",Je.READY="ready",Je.PROGRESS="progress",Je.INPUT="input",Je.RENDER="render",Je.OPEN="open",Je.MESSAGE="message",Je.CLOSE="close",Je.KEY_DOWN="keydown",Je.KEY_PRESS="keypress",Je.KEY_UP="keyup",Je.FRAME="enterframe",Je.DRAG_START="dragstart",Je.DRAG_MOVE="dragmove",Je.DRAG_END="dragend",Je.ENTER="enter",Je.SELECT="select",Je.BLUR="blur",Je.FOCUS="focus",Je.VISIBILITY_CHANGE="visibilitychange",Je.FOCUS_CHANGE="focuschange",Je.PLAYED="played",Je.PAUSED="paused",Je.STOPPED="stopped",Je.START="start",Je.END="end",Je.COMPONENT_ADDED="componentadded",Je.COMPONENT_REMOVED="componentremoved",Je.RELEASED="released",Je.LINK="link",Je.LABEL="label",Je.FULL_SCREEN_CHANGE="fullscreenchange",Je.DEVICE_LOST="devicelost",Je.TRANSFORM_CHANGED="transformchanged",Je.ANIMATION_CHANGED="animationchanged",Je.TRAIL_FILTER_CHANGE="trailfilterchange",Je.TRIGGER_ENTER="triggerenter",Je.TRIGGER_STAY="triggerstay",Je.TRIGGER_EXIT="triggerexit";var $e=function(){T(_,d);var r=b(_);function _(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;return S(this,_),(e=r.call(this)).uvrect=[0,0,1,1],e._destroyed=!1,e._referenceCount=0,e.$_GID=0,e.offsetX=0,e.offsetY=0,e._w=0,e._h=0,e.sourceWidth=0,e.sourceHeight=0,e.url=null,e.scaleRate=1,e.setTo(t,n,i,a),e}return C(_,[{key:"_addReference",value:function(){this._bitmap&&this._bitmap._addReference(),this._referenceCount++}},{key:"_removeReference",value:function(){this._bitmap&&this._bitmap._removeReference(),this._referenceCount--}},{key:"_getSource",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return this._destroyed||!this._bitmap?null:(this.recoverBitmap(e),this._bitmap.destroyed?null:this.bitmap._getSource())}},{key:"_onLoaded",value:function(e,t){t&&(t==this||(t instanceof _?_._create(t,0,0,t.width,t.height,0,0,t.sourceWidth,t.sourceHeight,this):(this.bitmap=t,this.sourceWidth=this._w=t.width,this.sourceHeight=this._h=t.height))),e&&e.run(),this.event(Je.READY,this)}},{key:"getIsReady",value:function(){return!this._destroyed&&!!this._bitmap}},{key:"setTo",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;this.bitmap=e,this.sourceWidth=n,this.sourceHeight=i,e&&(this._w=e.width,this._h=e.height,this.sourceWidth=this.sourceWidth||e.width,this.sourceHeight=this.sourceHeight||e.height),this.uv=t||_.DEF_UV}},{key:"load",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._destroyed||M.loader.load(e,F.create(this,this._onLoaded,[t]),null,"htmlimage",1,!0)}},{key:"getTexturePixels",value:function(e,t,n,i){var a=this.bitmap,r=a.width,o=a.height;if(r<e+n&&(n-=e+n-r),o<t+i&&(i-=t+i-o),n<=0||i<=0)return null;var s=4*n,l=null;try{l=a.getPixels()}catch(e){}if(l){if(0==e&&0==t&&n==r&&i==o)return l;for(var h=new Uint8Array(n*i*4),u=4*e,d=(t+i-1)*(s=4*r)+4*e,c=i-1;0<=c;c--)h.set(v.slice(d,d+4*n),u),u+=s,d-=s;return h}var _=new M.Context;_.size(n,i),_.asBitmap=!0;var f,g,y=null;0==e&&0==t&&n==r&&i==o||(f=(y=this._uv.slice())[0],g=y[1],y=[f+e*(r=(y[2]-f)/r),g+t*(o=(y[7]-g)/o),f+(e+n)*r,g+t*o,f+(e+n)*r,g+(t+i)*o,f+e*r,g+(t+i)*o]),_._drawTextureM(this,0,0,n,i,null,1,y),_._targets.start(),_.flush(),_._targets.end(),_._targets.restore();var v=_._targets.getData(0,0,n,i);for(_.destroy(),h=new Uint8Array(n*i*4),u=0,d=(i-1)*s,c=i-1;0<=c;c--)h.set(v.slice(d,d+s),u),u+=s,d-=s;return h}},{key:"getPixels",value:function(e,t,n,i){return window.conch?this._nativeObj.getImageData(e,t,n,i):this.getTexturePixels(e,t,n,i)}},{key:"recoverBitmap",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=this._bitmap.url;this._destroyed||this._bitmap&&!this._bitmap.destroyed||!e||M.loader.load(e,F.create(this,function(e){this.bitmap=e,t&&t()}),null,"htmlimage",1,!0)}},{key:"disposeBitmap",value:function(){!this._destroyed&&this._bitmap&&this._bitmap.destroy()}},{key:"destroy",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._destroyed||(this._destroyed=!0,(e=this._bitmap)&&(e._removeReference(this._referenceCount),0!==e.referenceCount&&!t||e.destroy(),e=null),this.url&&this===M.loader.getRes(this.url)&&M.Loader.clearRes(this.url))}},{key:"uv",get:function(){return this._uv},set:function(e){this.uvrect[0]=Math.min(e[0],e[2],e[4],e[6]),this.uvrect[1]=Math.min(e[1],e[3],e[5],e[7]),this.uvrect[2]=Math.max(e[0],e[2],e[4],e[6])-this.uvrect[0],this.uvrect[3]=Math.max(e[1],e[3],e[5],e[7])-this.uvrect[1],this._uv=e}},{key:"width",get:function(){return this._w||(this.bitmap?this.uv&&this.uv!==_.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width:0)},set:function(e){this._w=e,this.sourceWidth||(this.sourceWidth=e)}},{key:"height",get:function(){return this._h||(this.bitmap?this.uv&&this.uv!==_.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height:0)},set:function(e){this._h=e,this.sourceHeight||(this.sourceHeight=e)}},{key:"bitmap",get:function(){return this._bitmap},set:function(e){this._bitmap&&this._bitmap._removeReference(this._referenceCount),(this._bitmap=e)&&e._addReference(this._referenceCount)}},{key:"destroyed",get:function(){return this._destroyed}}],[{key:"moveUV",value:function(e,t,n){for(var i=0;i<8;i+=2)n[i]+=e,n[i+1]+=t;return n}},{key:"create",value:function(e,t,n,i,a){return _._create(e,t,n,i,a,5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,8<arguments.length&&void 0!==arguments[8]?arguments[8]:0)}},{key:"_create",value:function(e,t,n,i,a){var r,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,h=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0,u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:null,d=e instanceof _,c=d?e.uv:_.DEF_UV,d=d?e.bitmap:e;d.width&&t+i>d.width&&(i=d.width-t),d.height&&n+a>d.height&&(a=d.height-n),u?(r=u).setTo(d,null,l||i,h||a):r=new _(d,null,l||i,h||a),r.width=i,r.height=a,r.offsetX=o,r.offsetY=s;e=1/d.width,u=1/d.height;t*=e,n*=u,i*=e,a*=u;l=r.uv[0],h=r.uv[1],o=r.uv[4],s=r.uv[5],e=o-l,u=s-h,a=_.moveUV(c[0],c[1],[t,n,t+i,n,t+i,n+a,t,n+a]);r.uv=new Float32Array([l+a[0]*e,h+a[1]*u,o-(1-a[2])*e,h+a[3]*u,o-(1-a[4])*e,s-(1-a[5])*u,l+a[6]*e,s-(1-a[7])*u]);d=d.scaleRate;return d&&1!=d?(r.sourceWidth/=d,r.sourceHeight/=d,r.width/=d,r.height/=d,r.scaleRate=d):r.scaleRate=1,r}},{key:"createFromTexture",value:function(e,t,n,i,a){var r=e.scaleRate;1!=r&&(t*=r,n*=r,i*=r,a*=r);t=O.TEMP.setTo(t-e.offsetX,n-e.offsetY,i,a),n=t.intersection(_._rect1.setTo(0,0,e.width,e.height),_._rect2);return n?_.create(e,n.x,n.y,n.width,n.height,n.x-t.x,n.y-t.y,i,a):null}}]),_}();$e.DEF_UV=new Float32Array([0,0,1,0,1,1,0,1]),$e.NO_UV=new Float32Array([0,0,0,0,0,0,0,0]),$e.INV_UV=new Float32Array([0,1,1,1,1,0,0,0]),$e._rect1=new O,$e._rect2=new O;var et=function(){function n(e){S(this,n),this._font="14px Arial",this._family="Arial",this._size=14,this._italic=!1,this._bold=!1,this._id=n._gfontID++,this.setFont(e||this._font)}return C(n,[{key:"setFont",value:function(e){var t=(this._font=e).split(" "),n=t.length;if(n<2)1==n&&0<t[0].indexOf("px")&&(this._size=parseInt(t[0]));else{for(var i=-1,a=0;a<n;a++)if(0<t[a].indexOf("px")||0<t[a].indexOf("pt")){i=a,this._size=parseInt(t[a]),this._size<=0&&(console.error("font parse error:"+e),this._size=14);break}var r=i+1,o=t[r];for(r++;r<n;r++)o+=" "+t[r];this._family=o.split(",")[0],this._italic=0<=t.indexOf("italic"),this._bold=0<=t.indexOf("bold")}}}],[{key:"Parse",value:function(e){if(e===n._lastFont)return n._lastFontInfo;var t=(t=n._cache[e])||(n._cache[e]=new n(e));return n._lastFont=e,n._lastFontInfo=t}}]),n}();et.EMPTY=new et(null),et._cache={},et._gfontID=0,et._lastFont="";var tt=function(){function e(){S(this,e),this.save=[],this.toUpperCase=null,this.width=-1,this.pageChars=[],this.startID=0,this.startIDStroke=0,this.lastGCCnt=0,this.splitRender=!1}return C(e,[{key:"setText",value:function(e){this.changed=!0,this._text=e,this.width=-1,this.cleanCache()}},{key:"toString",value:function(){return this._text}},{key:"charCodeAt",value:function(e){return this._text?this._text.charCodeAt(e):NaN}},{key:"charAt",value:function(e){return this._text?this._text.charAt(e):null}},{key:"cleanCache",value:function(){this.pageChars.forEach(function(e){var t=e.tex;e.words;1==e.words.length&&t&&t.ri&&t.destroy()}),this.pageChars=[],this.startID=0}},{key:"length",get:function(){return this._text?this._text.length:0}}]),e}(),nt=function(){function e(){S(this,e),this.char="",this.deleted=!1,this.uv=new Array(8),this.pos=0,this.orix=0,this.oriy=0,this.touchTick=0,this.isSpace=!1}return C(e,[{key:"touch",value:function(){var e=be.loopCount;this.touchTick!=e&&this.tex.touchRect(this,e),this.touchTick=e}}]),e}(),it=function(){function e(){S(this,e),this.fontsz=16}return C(e,[{key:"getWidth",value:function(e,t){return 0}},{key:"scale",value:function(e,t){}},{key:"getCharBmp",value:function(e,t,n,i,a,r,o,s,l,h){return null}},{key:"canvasWidth",get:function(){return 0},set:function(e){}}]),e}(),at=function(){function h(){S(this,h)}return C(h,null,[{key:"__init__",value:function(){var e=window.Laya||M.Laya;if(h._window)return h._window;var t=h._window=window,n=h._document=t.document,i=h.userAgent=t.navigator.userAgent;-1<i.indexOf("AlipayMiniGame")&&"my"in h.window&&(window.aliPayMiniGame(e,e),e.ALIMiniAdapter?e.ALIMiniAdapter.enable():console.error("请先添加阿里小游戏适配库")),-1==i.indexOf("OPPO")&&-1<i.indexOf("MiniGame")&&"wx"in h.window&&("qq"in h.window?(window.qqMiniGame(e,e),e.QQMiniAdapter?e.QQMiniAdapter.enable():console.error("请引入手机QQ小游戏的适配库：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")):(window.wxMiniGame(e,e),e.MiniAdpter?e.MiniAdpter.enable():console.error("请先添加小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0"))),-1<i.indexOf("MiniGame")&&"qq"in h.window&&(window.qqMiniGame(e,e),e.QQMiniAdapter?e.QQMiniAdapter.enable():console.error("请先添加小游戏适配库,详细教程")),-1<i.indexOf("SwanGame")&&(window.bdMiniGame(e,e),e.BMiniAdapter?e.BMiniAdapter.enable():console.error("请先添加百度小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),-1<i.indexOf("QuickGame")&&(window.miMiniGame(e,e),e.KGMiniAdapter?e.KGMiniAdapter.enable():console.error("请先添加小米小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),-1<i.indexOf("OPPO")&&-1<i.indexOf("MiniGame")&&(window.qgMiniGame(e,e),e.QGMiniAdapter?e.QGMiniAdapter.enable():console.error("请先添加OPPO小游戏适配库")),-1<i.indexOf("VVGame")&&(window.vvMiniGame(e,e),e.VVMiniAdapter?e.VVMiniAdapter.enable():console.error("请先添加VIVO小游戏适配库")),t.trace=console.log,t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)};e=n.body.style;e.margin=0,e.overflow="hidden",e["-webkit-user-select"]="none",e["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";for(var a=n.getElementsByTagName("meta"),r=0,o=!1,s="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";r<a.length;){var l=a[r];if("viewport"==l.name){l.content=s,o=!0;break}r++}return o||((l=n.createElement("meta")).name="viewport",l.content=s,n.getElementsByTagName("head")[0].appendChild(l)),h.onMobile=!!window.isConchApp||-1<i.indexOf("Mobile"),h.onIOS=!!i.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),h.onIPhone=-1<i.indexOf("iPhone"),h.onMac=-1<i.indexOf("Mac OS X"),h.onIPad=-1<i.indexOf("iPad"),h.onAndroid=-1<i.indexOf("Android")||-1<i.indexOf("Adr"),h.onWP=-1<i.indexOf("Windows Phone"),h.onQQBrowser=-1<i.indexOf("QQBrowser"),h.onMQQBrowser=-1<i.indexOf("MQQBrowser")||-1<i.indexOf("Mobile")&&-1<i.indexOf("QQ"),h.onIE=!!t.ActiveXObject||"ActiveXObject"in t,h.onWeiXin=-1<i.indexOf("MicroMessenger"),h.onSafari=-1<i.indexOf("Safari"),h.onPC=!h.onMobile,h.onMiniGame=-1<i.indexOf("MiniGame"),h.onBDMiniGame=-1<i.indexOf("SwanGame"),h.onLayaRuntime=!!h.window.conch,-1<i.indexOf("OPPO")&&-1<i.indexOf("MiniGame")?(h.onQGMiniGame=!0,h.onMiniGame=!1):"qq"in h.window&&-1<i.indexOf("MiniGame")&&(h.onQQMiniGame=!0,h.onMiniGame=!1),h.onVVMiniGame=-1<i.indexOf("VVGame"),h.onKGMiniGame=-1<i.indexOf("QuickGame"),-1<i.indexOf("AlipayMiniGame")&&(h.onAlipayMiniGame=!0,h.onMiniGame=!1),t}},{key:"createElement",value:function(e){return h.__init__(),h._document.createElement(e)}},{key:"getElementById",value:function(e){return h.__init__(),h._document.getElementById(e)}},{key:"removeElement",value:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},{key:"now",value:function(){return Date.now()}},{key:"clientWidth",get:function(){return h.__init__(),h._window.innerWidth||h._document.body.clientWidth}},{key:"clientHeight",get:function(){return h.__init__(),h._window.innerHeight||h._document.body.clientHeight||h._document.documentElement.clientHeight}},{key:"width",get:function(){return h.__init__(),(M.stage&&M.stage.canvasRotation?h.clientHeight:h.clientWidth)*h.pixelRatio}},{key:"height",get:function(){return h.__init__(),(M.stage&&M.stage.canvasRotation?h.clientWidth:h.clientHeight)*h.pixelRatio}},{key:"pixelRatio",get:function(){return h._pixelRatio<0&&(h.__init__(),-1<h.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?h._pixelRatio=2:(h._pixelRatio=h._window.devicePixelRatio||1)<1&&(h._pixelRatio=1)),h._pixelRatio}},{key:"container",get:function(){return h._container||(h.__init__(),(h._container=h.createElement("div")).id="layaContainer",h._document.body.appendChild(h._container)),h._container},set:function(e){h._container=e}},{key:"window",get:function(){return h._window||h.__init__()}},{key:"document",get:function(){return h.__init__(),h._document}}]),h}();at._pixelRatio=-1,at.mainCanvas=null,at.hanzi=new RegExp("^[一-龥]$"),at.fontMap=[],at.measureText=function(e,t){var n=at.hanzi.test(e);if(n&&at.fontMap[t])return at.fontMap[t];var i=at.context;i.font=t;e=i.measureText(e);return n&&(at.fontMap[t]=e),e};var rt=function(){T(f,it);var o=b(f);function f(e,t){var n,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],a=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],r=4<arguments.length&&void 0!==arguments[4]&&arguments[4];return S(this,f),(n=o.call(this)).ctx=null,n.lastScaleX=1,n.lastScaleY=1,n.maxTexW=0,n.maxTexH=0,n.scaleFontSize=!0,n.showDbgInfo=!1,n.supportImageData=!0,n.maxTexW=e,n.maxTexH=t,n.scaleFontSize=i,n.supportImageData=a,n.showDbgInfo=r,f.canvas||(f.canvas=at.createElement("canvas"),f.canvas.width=1024,f.canvas.height=512,f.canvas.style.left="-10000px",f.canvas.style.position="absolute",document.body.appendChild(f.canvas),n.ctx=f.canvas.getContext("2d")),n}return C(f,[{key:"getWidth",value:function(e,t){return this.ctx?(this.ctx._lastFont!=e&&(this.ctx.font=e,this.ctx._lastFont=e),this.ctx.measureText(t).width):0}},{key:"scale",value:function(e,t){if(!this.supportImageData)return this.lastScaleX=e,void(this.lastScaleY=t);this.lastScaleX==e&&this.lastScaleY==t||(this.ctx.setTransform(e,0,0,t,0,0),this.lastScaleX=e,this.lastScaleY=t)}},{key:"getCharBmp",value:function(e,t,n,i,a,r,o,s,l,h){var u=10<arguments.length&&void 0!==arguments[10]?arguments[10]:null;if(!this.supportImageData)return this.getCharCanvas(e,t,n,i,a,r,o,s,l,h);var d=this.ctx,c=this.fontsz;d.font!=t&&(d.font=t,d._lastFont=t),r.width=d.measureText(e).width;var _=r.width*this.lastScaleX,t=r.height*this.lastScaleY;_+=(o+l)*this.lastScaleX,t+=(s+h)*this.lastScaleY,_=Math.ceil(_),t=Math.ceil(t);l=(_=Math.min(_,f.canvas.width))+2*n+1,h=(t=Math.min(t,f.canvas.height))+2*n+1;u&&(l=Math.max(l,u[0]+u[2]+1),h=Math.max(h,u[1]+u[3]+1)),d.clearRect(0,0,l,h),d.save(),d.textBaseline="middle",0<n&&(d.strokeStyle=a,d.lineWidth=n,d.strokeText(e,o,s+c/2)),i&&(d.fillStyle=i,d.fillText(e,o,s+c/2)),this.showDbgInfo&&(d.strokeStyle="#ff0000",d.strokeRect(1,1,_-2,t-2),d.strokeStyle="#00ff00",d.strokeRect(o,s,r.width,r.height)),u&&-1==u[2]&&(u[2]=Math.ceil((r.width+2*n)*this.lastScaleX));t=u?d.getImageData(u[0],u[1],u[2],u[3]):d.getImageData(0,0,_,t);return d.restore(),r.bmpWidth=t.width,r.bmpHeight=t.height,t}},{key:"getCharCanvas",value:function(e,t,n,i,a,r,o,s,l,h){var u=this.ctx;u.font!=t&&(u.font=t,u._lastFont=t),r.width=u.measureText(e).width;var d=r.width*this.lastScaleX,c=r.height*this.lastScaleY;d+=(o+l)*this.lastScaleX,c+=(s+h)*this.lastScaleY+1,d=Math.min(d,this.maxTexW),c=Math.min(c,this.maxTexH),f.canvas.width=Math.min(d+1,this.maxTexW),f.canvas.height=Math.min(c+1,this.maxTexH),u.font=t,u.clearRect(0,0,d+1+n,c+1+n),u.setTransform(1,0,0,1,0,0),u.save(),this.scaleFontSize&&u.scale(this.lastScaleX,this.lastScaleY),u.translate(o,s),u.textAlign="left";s=this.fontsz;return u.textBaseline="middle",0<n?(u.strokeStyle=a,u.fillStyle=i,u.lineWidth=n,u.fillAndStrokeText?u.fillAndStrokeText(e,0,s/2):(u.strokeText(e,0,s/2),u.fillText(e,0,s/2))):i&&(u.fillStyle=i,u.fillText(e,0,s/2)),this.showDbgInfo&&(u.strokeStyle="#ff0000",u.strokeRect(0,0,d,c),u.strokeStyle="#00ff00",u.strokeRect(0,0,r.width,r.height)),u.restore(),r.bmpWidth=f.canvas.width,r.bmpHeight=f.canvas.height,f.canvas}},{key:"canvasWidth",get:function(){return f.canvas.width},set:function(e){f.canvas.width!=e&&(2048<(f.canvas.width=e)&&console.warn("画文字设置的宽度太大，超过2048了"),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.lastScaleX,this.lastScaleY))}}]),f}();rt.canvas=null;var ot=function(){T(n,it);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).lastFont="",e}return C(n,[{key:"getWidth",value:function(e,t){return window.conchTextCanvas?(window.conchTextCanvas.font=e,this.lastFont=e,window.conchTextCanvas.measureText(t).width):0}},{key:"scale",value:function(e,t){}},{key:"getCharBmp",value:function(e,t,n,i,a,r,o,s,l,h){if(!window.conchTextCanvas)return null;window.conchTextCanvas.font=t,this.lastFont=t;r.width=window.conchTextCanvas.measureText(e).width;t=r.height;t+=s+h;a=re.create(a).numColor,i=re.create(i).numColor,a=window.conchTextCanvas.getTextBitmapData(e,i,2<n?2:n,a);return r.bmpWidth=a.width,r.bmpHeight=a.height,a}}]),n}(),st=function(){function x(){S(this,x),this.fontSizeInfo={},this.mapFont={},this.fontID=0,this.mapColor=[],this.colorID=0,this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.textAtlases=[],this.isoTextures=[],this.lastFont=null,this.fontSizeW=0,this.fontSizeH=0,this.fontSizeOffX=0,this.fontSizeOffY=0,this.renderPerChar=!0,this.tmpAtlasPos=new L,this.textureMem=0,M.TextAtlas=Qe;var e=!1,t=M.Laya.MiniAdpter;t&&t.systemInfo&&t.systemInfo.system&&(e="ios 10.1.1"===t.systemInfo.system.toLowerCase()),M.Browser.onMiniGame&&!e&&(x.isWan1Wan=!0),this.charRender=M.Render.isConchApp?new ot:new rt(x.atlasWidth,x.atlasWidth,x.scaleFontWithCtx,!x.isWan1Wan,!1),x.textRenderInst=this,M.Laya.textRender=this,x.atlasWidth2=x.atlasWidth*x.atlasWidth}return C(x,[{key:"setFont",value:function(e){var t,n,i,a,r;this.lastFont!=e&&(this.lastFont=e,t=(r=this.getFontSizeInfo(e._family))>>24,n=r>>16&255,i=r>>8&255,a=255&r,r=e._size/x.standardFontSize,this.fontSizeOffX=Math.ceil(t*r),this.fontSizeOffY=Math.ceil(n*r),this.fontSizeW=Math.ceil(i*r),this.fontSizeH=Math.ceil(a*r),0<=e._font.indexOf("italic")?this.fontStr=e._font.replace("italic",""):this.fontStr=e._font)}},{key:"getNextChar",value:function(e){var t=e.length,n=this._curStrPos;if(t<=n)return null;for(var i=n,a=0;i<t;i++){var r=e.charCodeAt(i);if(r>>>11==27){if(1==a)break;a=1,i++}else if(65038!==r&&65039!==r)if(8205==r)a=2;else if(0==a)a=1;else if(1==a)break}return this._curStrPos=i,e.substring(n,i)}},{key:"filltext",value:function(e,t,n,i,a,r,o,s,l){var h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:0;if(!(t.length<=0)){var a=et.Parse(a),u=0;switch(l){case"center":u=M.Context.ENUM_TEXTALIGN_CENTER;break;case"right":u=M.Context.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(e,t,null,n,i,a,r,o,s,u,h)}}},{key:"fillWords",value:function(e,t,n,i,a,r,o,s){t&&(t.length<=0||(a="string"==typeof a?et.Parse(a):a,this._fast_filltext(e,null,t,n,i,a,r,o,s,0,0)))}},{key:"_fast_filltext",value:function(e,t,n,i,a,r,o,s,l,h){if(!(t&&t.length<1||n&&n.length<1)){if(l<0&&(l=0),this.setFont(r),this.fontScaleX=this.fontScaleY=1,!M.Render.isConchApp&&x.scaleFontWithCtx){var u=1,d=1,d=M.Render.isConchApp?(u=e._curMat.getScaleX(),e._curMat.getScaleY()):(u=e.getMatScaleX(),e.getMatScaleY());if(u<1e-4||d<.1)return;1<u&&(this.fontScaleX=u),1<d&&(this.fontScaleY=d)}r._italic&&(e._italicDeg=13);var u=t,d=!n&&t instanceof tt,c=t,t=!!n,_=d?u.pageChars:[],f=0;switch(d?(c=u._text,(f=u.width)<0&&(f=u.width=this.charRender.getWidth(this.fontStr,c))):f=c?this.charRender.getWidth(this.fontStr,c):0,h){case M.Context.ENUM_TEXTALIGN_CENTER:i-=f/2;break;case M.Context.ENUM_TEXTALIGN_RIGHT:i-=f}u&&_&&this.hasFreedText(_)&&(_=u.pageChars=[]);var g=null,u=this.renderPerChar=!d||x.forceSplitRender||t||d&&u.splitRender;if(!_||_.length<1)if(u){var y,v,p,m=0,w=0;for(this._curStrPos=0;;){if(n?(v=n[this._curStrPos++])?(y=v.char,m=v.x,w=v.y):y=null:y=this.getNextChar(c),!y)break;if(!(g=this.getCharRenderInfo(y,r,o,s,l,!1)))break;g.isSpace||(p=(p=_[g.tex.id])?p.words:(v={texgen:g.tex.genID,tex:g.tex,words:[]},(_[g.tex.id]=v).words),M.Render.isConchApp?p.push({ri:g,x:m,y:w,w:g.bmpWidth/this.fontScaleX,h:g.bmpHeight/this.fontScaleY}):p.push({ri:g,x:m+1/this.fontScaleX,y:w,w:(g.bmpWidth-2)/this.fontScaleX,h:(g.bmpHeight-1)/this.fontScaleY}),m+=g.width)}}else{u=x.noAtlas||f*this.fontScaleX>x.atlasWidth,g=this.getCharRenderInfo(c,r,o,s,l,u);M.Render.isConchApp?_[0]={texgen:g.tex.genID,tex:g.tex,words:[{ri:g,x:0,y:0,w:g.bmpWidth/this.fontScaleX,h:g.bmpHeight/this.fontScaleY}]}:_[0]={texgen:g.tex.genID,tex:g.tex,words:[{ri:g,x:1/this.fontScaleX,y:0/this.fontScaleY,w:(g.bmpWidth-2)/this.fontScaleX,h:(g.bmpHeight-1)/this.fontScaleY}]}}this._drawResortedWords(e,i,a,_),e._italicDeg=0}}},{key:"_drawResortedWords",value:function(e,t,n,i){for(var a=!!e._charSubmitCache&&e._charSubmitCache._enbale,r=e._curMat,o=i.length,s=0;s<o;s++){var l=i[s];if(l){var h=l.words,u=h.length;if(!(u<=0))for(var d=i[s].tex,c=0;c<u;c++){var _=h[c],f=_.ri;f.isSpace||(f.touch(),e.drawTexAlign=!0,M.Render.isConchApp?e._drawTextureM(d.texture,t+_.x-f.orix,n+_.y-f.oriy,_.w,_.h,null,1,f.uv):e._inner_drawTexture(d.texture,d.id,t+_.x-f.orix,n+_.y-f.oriy,_.w,_.h,r,f.uv,1,a),e.touches&&e.touches.push(f))}}}}},{key:"hasFreedText",value:function(e){for(var t=e.length,n=0;n<t;n++){var i=e[n];if(i){var a=i.tex;if(a.__destroyed||a.genID!=i.texgen)return!0}}return!1}},{key:"getCharRenderInfo",value:function(e,t,n,i,a){var r=5<arguments.length&&void 0!==arguments[5]&&arguments[5],o=this.mapFont[t._family];null==o&&(this.mapFont[t._family]=o=this.fontID++);var s=e+"_"+o+"_"+t._size+"_"+n;0<a&&(s+="_"+i+a),t._bold&&(s+="P"),1==this.fontScaleX&&1==this.fontScaleY||(s+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0));var l,h,u=0,d=this.textAtlases.length;if(!r)for(u=0;u<d;u++)if(l=(h=this.textAtlases[u]).charMaps[s])return l.touch(),l;l=new nt,this.charRender.scale(this.fontScaleX,this.fontScaleY),l.char=e,l.height=t._size;var c=M.Render.isConchApp?0:t._size/3|0,_=null;a=a||0;var f,g,y=Math.ceil((this.charRender.getWidth(this.fontStr,e)+2*a)*this.fontScaleX);return y>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,y+2*c)),r?(this.charRender.fontsz=t._size,(_=this.charRender.getCharBmp(e,this.fontStr,a,n,i,l,c,c,c,c,null))&&((g=Ke.getTextTexture(_.width,_.height)).addChar(_,0,0,l.uv),l.tex=g,l.orix=c,l.oriy=c,g.ri=l,this.isoTextures.push(g))):(f=e.length,o=+a,r=Math.ceil((this.fontSizeW+2*o)*this.fontScaleX),g=Math.ceil((this.fontSizeH+2*o)*this.fontScaleY),x.imgdtRect[0]=(c-this.fontSizeOffX-o)*this.fontScaleX|0,x.imgdtRect[1]=(c-this.fontSizeOffY-o)*this.fontScaleY|0,this.renderPerChar||1==f?(x.imgdtRect[2]=Math.max(y,r),x.imgdtRect[3]=Math.max(y,g)):(x.imgdtRect[2]=-1,x.imgdtRect[3]=g),this.charRender.fontsz=t._size,(_=this.charRender.getCharBmp(e,this.fontStr,a,n,i,l,c,c,c,c,x.imgdtRect))&&(h=this.addBmpData(_,l),x.isWan1Wan?(l.orix=c,l.oriy=c):(l.orix=this.fontSizeOffX+o,l.oriy=this.fontSizeOffY+o),h.charMaps[s]=l)),l}},{key:"addBmpData",value:function(e,t){for(var n,i=e.width,a=e.height,r=this.textAtlases.length,o=!1,s=0;s<r&&!(o=(n=this.textAtlases[s]).getAEmpty(i,a,this.tmpAtlasPos));s++);if(!o){if(n=new Qe,this.textAtlases.push(n),!(o=n.getAEmpty(i,a,this.tmpAtlasPos)))throw"err1";this.cleanAtlases()}return o&&(n.texture.addChar(e,this.tmpAtlasPos.x,this.tmpAtlasPos.y,t.uv),t.tex=n.texture),n}},{key:"GC",value:function(){for(var e,t=0,n=this.textAtlases.length,i=x.destroyAtlasDt,a=0,r=be.loopCount,o=-1,s=0,l=null,h=null;t<n;t++)(l=(h=this.textAtlases[t]).texture)&&(l.curUsedCovRate,a+=l.curUsedCovRateAtlas,s<(e=h.usedRate-l.curUsedCovRateAtlas)&&(s=e,o=t)),i<r-h.texture.lastTouchTm&&(x.showLog&&console.log(h.texture.id),h.destroy(),this.textAtlases[t]=this.textAtlases[n-1],n--,t--,o=-1);for(this.textAtlases.length=n,n=this.isoTextures.length,t=0;t<n;t++)r-(l=this.isoTextures[t]).lastTouchTm>x.destroyUnusedTextureDt&&(l.ri.deleted=!0,l.ri.tex=null,l.destroy(),this.isoTextures[t]=this.isoTextures[n-1],n--,t--);this.isoTextures.length=n;var u=1<this.textAtlases.length&&2<=this.textAtlases.length-a;(x.atlasWidth*x.atlasWidth*4*this.textAtlases.length>x.cleanMem||u||x.simClean)&&(x.simClean=!1,x.showLog&&console.log("清理使用率低的贴图。总使用率:",a,":",this.textAtlases.length,"最差贴图:"+o),0<=o&&((h=this.textAtlases[o]).destroy(),this.textAtlases[o]=this.textAtlases[this.textAtlases.length-1],this.textAtlases.length=this.textAtlases.length-1)),Ke.clean()}},{key:"cleanAtlases",value:function(){}},{key:"getCharBmp",value:function(e){}},{key:"checkBmpLine",value:function(e,t,n,i){this.bmpData32.buffer!=e.data.buffer&&(this.bmpData32=new Uint32Array(e.data.buffer));for(var a=e.width*t+n,r=n;r<i;r++)if(0!=this.bmpData32[a++])return!0;return!1}},{key:"updateBbx",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.width,a=e.height,r=0,o=t[1],s=0,l=o;if(this.checkBmpLine(e,o,0,i))for(;;){if(o<=(l=(o+s)/2|0)+1){t[1]=l;break}this.checkBmpLine(e,l,0,i)?o=l:s=l}if(t[3]>a)t[3]=a;else if(l=o=t[3],s=a,this.checkBmpLine(e,o,0,i))for(;;){if((l=(o+s)/2|0)-1<=o){t[3]=l;break}this.checkBmpLine(e,l,0,i)?o=l:s=l}if(!n){for(var h=t[0],u=i*t[1],l=t[1];l<t[3];l++){for(r=0;r<h;r++)if(0!=this.bmpData32[u+r]){h=r;break}u+=i}t[0]=h;var d=t[2],u=i*t[1];for(l=t[1];l<t[3];l++){for(r=d;r<i;r++)if(0!=this.bmpData32[u+r]){d=r;break}u+=i}t[2]=d}}},{key:"getFontSizeInfo",value:function(e){var t=this.fontSizeInfo[e];if(null!=t)return t;var n="bold "+x.standardFontSize+"px "+e;if(x.isWan1Wan){this.fontSizeW=1.5*this.charRender.getWidth(n,"有"),this.fontSizeH=1.5*x.standardFontSize;var i=this.fontSizeW<<8|this.fontSizeH;return this.fontSizeInfo[e]=i}x.pixelBBX[0]=x.standardFontSize/2,x.pixelBBX[1]=x.standardFontSize/2,x.pixelBBX[2]=x.standardFontSize,x.pixelBBX[3]=x.standardFontSize;var a=16,t=16;this.charRender.scale(1,1),x.tmpRI.height=x.standardFontSize,this.charRender.fontsz=x.standardFontSize;i=this.charRender.getCharBmp("g",n,0,"red",null,x.tmpRI,a,t,16,16);M.Render.isConchApp&&(i.data=new Uint8ClampedArray(i.data)),this.bmpData32=new Uint32Array(i.data.buffer),this.updateBbx(i,x.pixelBBX,!1),i=this.charRender.getCharBmp("有",n,0,"red",null,x.tmpRI,t,t,16,16),M.Render.isConchApp&&(i.data=new Uint8ClampedArray(i.data)),this.bmpData32=new Uint32Array(i.data.buffer),x.pixelBBX[2]<a+x.tmpRI.width&&(x.pixelBBX[2]=a+x.tmpRI.width),this.updateBbx(i,x.pixelBBX,!1),M.Render.isConchApp&&(t=a=0);t=Math.max(a-x.pixelBBX[0],0)<<24|Math.max(t-x.pixelBBX[1],0)<<16|x.pixelBBX[2]-x.pixelBBX[0]<<8|x.pixelBBX[3]-x.pixelBBX[1];return this.fontSizeInfo[e]=t}},{key:"printDbgInfo",value:function(){for(var e in console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+x.atlasWidth+"x"+x.atlasWidth," 用canvas:",x.isWan1Wan),console.log("图集占用空间:"+x.atlasWidth*x.atlasWidth*4/1024/1024*this.textAtlases.length+"M"),console.log("缓存用到的字体:"),this.mapFont){var t=this.getFontSizeInfo(e),n=t>>24,i=t>>16&255,a=t>>8&255,t=255&t;console.log("    "+e," off:",n,i," size:",a,t)}var r=0;console.log("缓存数据:");var o=0,s=0;this.textAtlases.forEach(function(e){var t,n=e.texture.id,i=be.loopCount-e.texture.lastTouchTm,i=0<i?i+"帧以前":"当前帧";for(t in o+=e.texture.curUsedCovRate,s+=e.texture.curUsedCovRateAtlas,console.log("--图集(id:"+n+",当前使用率:"+(1e3*e.texture.curUsedCovRate|0)+"‰","当前图集使用率:",(100*e.texture.curUsedCovRateAtlas|0)+"%","图集使用率:",100*e.usedRate|0,"%, 使用于:"+i+")--:"),e.charMaps){var a=e.charMaps[t];console.log("     off:",a.orix,a.oriy," bmp宽高:",a.bmpWidth,a.bmpHeight,"无效:",a.deleted,"touchdt:",be.loopCount-a.touchTick,"位置:",a.uv[0]*x.atlasWidth|0,a.uv[1]*x.atlasWidth|0,"字符:",a.char,"key:",t),r++}}),console.log("独立贴图文字("+this.isoTextures.length+"个):"),this.isoTextures.forEach(function(e){console.log("    size:",e._texW,e._texH,"touch间隔:",be.loopCount-e.lastTouchTm,"char:",e.ri.char)}),console.log("总缓存:",r,"总使用率:",o,"总当前图集使用率:",s)}},{key:"showAtlas",value:function(e,n,t,i,a,r){if(!this.textAtlases[e])return console.log("没有这个图集"),null;var o=new M.Sprite,s=this.textAtlases[e].texture,l={width:x.atlasWidth,height:x.atlasWidth,sourceWidth:x.atlasWidth,sourceHeight:x.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return s._getSource()},bitmap:{id:s.id},_uv:$e.DEF_UV};return o.size=function(e,t){return this.width=e,this.height=t,o.graphics.clear(),o.graphics.drawRect(0,0,o.width,o.height,n),o.graphics.drawTexture(l,0,0,o.width,o.height),this},o.graphics.drawRect(0,0,a,r,n),o.graphics.drawTexture(l,0,0,a,r),o.pos(t,i),M.stage.addChild(o),o}},{key:"filltext_native",value:function(e,t,n,i,a,r,o,s,l,h){var u=10<arguments.length&&void 0!==arguments[10]?arguments[10]:0;if(!(t&&t.length<=0||n&&n.length<1)){var r=et.Parse(r),d=0;switch(h){case"center":d=M.Context.ENUM_TEXTALIGN_CENTER;break;case"right":d=M.Context.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(e,t,n,i,a,r,o,s,l,d,u)}}}]),x}();st.useOldCharBook=!1,st.atlasWidth=2048,st.noAtlas=!1,st.forceSplitRender=!1,st.forceWholeRender=!1,st.scaleFontWithCtx=!0,st.standardFontSize=32,st.destroyAtlasDt=10,st.checkCleanTextureDt=2e3,st.destroyUnusedTextureDt=3e3,st.cleanMem=104857600,st.isWan1Wan=!1,st.showLog=!1,st.debugUV=!1,st.atlasWidth2=4194304,st.tmpRI=new nt,st.pixelBBX=[0,0,0,0],st.imgdtRect=[0,0,0,0],st.simClean=!1,Ke.gTextRender=st;var lt=function(){function b(){var e;S(this,b),this._tmpMatrix=new D,this._drawTexToDrawTri_Vert=new Float32Array(8),this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3]),this._tempUV=new Float32Array(8),this._drawTriUseAbsMatrix=!1,this._id=++b._COUNT,this._other=null,this._renderNextSubmitIndex=0,this._path=null,this._drawCount=1,this._width=b._MAXSIZE,this._height=b._MAXSIZE,this._renderCount=0,this._submits=null,this._curSubmit=null,this._submitKey=new te,this._mesh=null,this._pathMesh=null,this._triangleMesh=null,this.meshlist=[],this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=b.MAXCLIPRECT,this._globalClipMatrix=new D(b._MAXSIZE,0,0,b._MAXSIZE,0,0),this._clipInCache=!1,this._clipInfoID=0,this._clipID_Gen=0,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._save=null,this._targets=null,this._charSubmitCache=null,this._saveMark=null,this._shader2D=new Be,this.sprite=null,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this.defTexture=null,this._colorFiler=null,this.drawTexAlign=!1,this._incache=!1,this.isMain=!1,b._contextcount++,b._textRender=b._textRender||new st,this.defTexture||((e=new X(2,2)).setPixels(new Uint8Array(16)),e.lock=!0,this.defTexture=new $e(e)),this._lastTex=this.defTexture,this.clear()}return C(b,[{key:"drawImage",value:function(){}},{key:"getImageData",value:function(){}},{key:"measureText",value:function(e){return null}},{key:"setTransform",value:function(){}},{key:"$transform",value:function(e,t,n,i,a,r){}},{key:"clearRect",value:function(e,t,n,i){}},{key:"_drawRect",value:function(e,t,n,i,a){J.renderBatches++,a&&(this.fillStyle=a),this.fillRect(e,t,n,i,null)}},{key:"drawTexture2",value:function(e,t,n,i,a,r){}},{key:"transformByMatrix",value:function(e,t,n){this.transform(e.a,e.b,e.c,e.d,e.tx+t,e.ty+n)}},{key:"saveTransform",value:function(e){this.save()}},{key:"restoreTransform",value:function(e){this.restore()}},{key:"drawRect",value:function(e,t,n,i,a,r,o){null!=a&&(this.fillStyle=a,this.fillRect(e,t,n,i)),null!=r&&(this.strokeStyle=r,this.lineWidth=o,this.strokeRect(e,t,n,i))}},{key:"alpha",value:function(e){this.globalAlpha*=e}},{key:"_transform",value:function(e,t,n){this.translate(t,n),this.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),this.translate(-t,-n)}},{key:"_rotate",value:function(e,t,n){this.translate(t,n),this.rotate(e),this.translate(-t,-n)}},{key:"_scale",value:function(e,t,n,i){this.translate(n,i),this.scale(e,t),this.translate(-n,-i)}},{key:"_drawLine",value:function(e,t,n,i,a,r,o,s,l){this.beginPath(),this.strokeStyle=o,this.lineWidth=s,this.moveTo(e+n,t+i),this.lineTo(e+a,t+r),this.stroke()}},{key:"_drawLines",value:function(e,t,n,i,a,r){this.beginPath(),this.strokeStyle=i,this.lineWidth=a,this.addPath(n.slice(),!1,!1,e,t),this.stroke()}},{key:"drawCurves",value:function(e,t,n,i,a){this.beginPath(),this.strokeStyle=i,this.lineWidth=a,this.moveTo(e+n[0],t+n[1]);for(var r=2,o=n.length;r<o;)this.quadraticCurveTo(e+n[r++],t+n[r++],e+n[r++],t+n[r++]);this.stroke()}},{key:"_fillAndStroke",value:function(e,t,n){null!=e&&(this.fillStyle=e,this.fill()),null!=t&&0<n&&(this.strokeStyle=t,this.lineWidth=n,this.stroke())}},{key:"_drawCircle",value:function(e,t,n,i,a,r,o){J.renderBatches++,this.beginPath(!0),this.arc(e,t,n,0,b.PI2),this.closePath(),this._fillAndStroke(i,a,r)}},{key:"_drawPie",value:function(e,t,n,i,a,r,o,s,l){this.beginPath(),this.moveTo(e,t),this.arc(e,t,n,i,a),this.closePath(),this._fillAndStroke(r,o,s)}},{key:"_drawPoly",value:function(e,t,n,i,a,r,o,s){this.beginPath(),this.addPath(n.slice(),!0,o,e,t),this.closePath(),this._fillAndStroke(i,a,r,o)}},{key:"_drawPath",value:function(e,t,n,i,a){this.beginPath();for(var r=0,o=n.length;r<o;r++){var s=n[r];switch(s[0]){case"moveTo":this.moveTo(e+s[1],t+s[2]);break;case"lineTo":this.lineTo(e+s[1],t+s[2]);break;case"arcTo":this.arcTo(e+s[1],t+s[2],e+s[3],t+s[4],s[5]);break;case"closePath":this.closePath()}}null!=i&&(this.fillStyle=i.fillStyle,this.fill()),null!=a&&(this.strokeStyle=a.strokeStyle,this.lineWidth=a.lineWidth||1,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.miterLimit=a.miterLimit,this.stroke())}},{key:"clearBG",value:function(e,t,n,i){var a=y.mainContext;a.clearColor(e,t,n,i),a.clear(a.COLOR_BUFFER_BIT)}},{key:"_getSubmits",value:function(){return this._submits}},{key:"_releaseMem",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(this._submits){this._curMat&&this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null,this._charSubmitCache.clear();for(var t,n=0,i=this._submits._length;n<i;n++)this._submits[n].releaseRender();for(this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null,n=0,t=this.meshlist.length;n<t;n++)this.meshlist[n].destroy();this.meshlist.length=0,this.sprite=null,e||(this._targets&&this._targets.destroy(),this._targets=null)}}},{key:"destroy",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];--b._contextcount,this.sprite=null,this._releaseMem(e),this._charSubmitCache.destroy(),this._mesh.destroy(),e||(this._targets&&this._targets.destroy(),this._targets=null)}},{key:"clear",value:function(){this._submits||(this._other=ut.DEFAULT,this._curMat=D.create(),this._charSubmitCache=new qe,this._mesh=Le.getAMesh(this.isMain),this.meshlist.push(this._mesh),this._pathMesh=Pe.getAMesh(this.isMain),this.meshlist.push(this._pathMesh),this._triangleMesh=Oe.getAMesh(this.isMain),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[Te.Create(this)],this._save.length=10,this._shader2D=new Be),this._submitKey.clear(),this._mesh.clearVB(),this._drawCount=1,this._other=ut.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=b.MAXCLIPRECT,this._curSubmit=we.RENDERBASE,we.RENDERBASE._ref=16777215,we.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=ve.DEFAULT;for(var e=0,t=this._submits._length;e<t;e++)this._submits[e].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1}},{key:"size",value:function(e,t){this._width==e&&this._height==t||(this._width=e,this._height=t,this._targets&&(this._targets.destroy(),this._targets=new q(e,t,H.R8G8B8A8,-1)),this.isMain&&(y.mainContext.viewport(0,0,e,t),j.width=e,j.height=t)),0===e&&0===t&&this._releaseMem()}},{key:"getMatScaleX",value:function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b||(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b),this._lastMatScaleX}},{key:"getMatScaleY",value:function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d||(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d),this._lastMatScaleY}},{key:"setFillColor",value:function(e){this._fillColor=e}},{key:"getFillColor",value:function(){return this._fillColor}},{key:"translate",value:function(e,t){0===e&&0===t||(Me.save(this),this._curMat._bTransform?(Ee.save(this),this._curMat.tx+=e*this._curMat.a+t*this._curMat.c,this._curMat.ty+=e*this._curMat.b+t*this._curMat.d):(this._curMat.tx=e,this._curMat.ty=t))}},{key:"save",value:function(){this._save[this._save._length++]=Te.Create(this)}},{key:"restore",value:function(){var e=this._save._length,t=this._nBlendType;if(!(e<1)){for(var n=e-1;0<=n;n--){var i=this._save[n];if(i.restore(this),i.isSaveMark())return void(this._save._length=n)}t!=this._nBlendType&&(this._curSubmit=we.RENDERBASE)}}},{key:"fillText",value:function(e,t,n,i,a,r){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"";b._textRender.filltext(this,e,t,n,i,a,s,o,r)}},{key:"drawText",value:function(e,t,n,i,a,r){b._textRender.filltext(this,e,t,n,i,a,null,0,r)}},{key:"fillWords",value:function(e,t,n,i,a){b._textRender.fillWords(this,e,t,n,i,a,null,0)}},{key:"strokeWord",value:function(e,t,n,i,a,r,o){b._textRender.filltext(this,e,t,n,i,null,a,r,o)}},{key:"fillBorderText",value:function(e,t,n,i,a,r,o,s){b._textRender.filltext(this,e,t,n,i,a,r,o,s)}},{key:"fillBorderWords",value:function(e,t,n,i,a,r,o){b._textRender.fillWords(this,e,t,n,i,a,r,o)}},{key:"_fast_filltext",value:function(e,t,n,i,a,r,o,s){var l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0;b._textRender._fast_filltext(this,e,null,t,n,i,a,r,o,s,l)}},{key:"_fillRect",value:function(e,t,n,i,a){var r=this._curSubmit,o=r&&r._key.submitType===we.KEY_DRAWTEXTURE&&r._key.blendShader===this._nBlendType;this._mesh.vertNum+4>b._MAXVERTNUM&&(this._mesh=Le.getAMesh(this.isMain),this.meshlist.push(this._mesh),o=!1),o=o&&(o&&this.isSameClipInfo(r)),this.transformQuad(e,t,n,i,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,$e.NO_UV,a,!1),o||(r=this._curSubmit=je.create(this,this._mesh,ee.create(Q.TEXTURE2D,0)),this._submits[this._submits._length++]=r,this._copyClipInfo(r,this._globalClipMatrix),r.shaderValue.textureHost=this._lastTex,r._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,r._renderType=we.TYPE_TEXTURE),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)}},{key:"fillRect",value:function(e,t,n,i,a){a=a?ve.create(a):this._shader2D.fillStyle,a=this.mixRGBandAlpha(a.toInt());this._fillRect(e,t,n,i,a)}},{key:"fillTexture",value:function(e,t,n,i,a,r,o,s){e._getSource()?this._fillTexture(e,e.width,e.height,e.uvrect,t,n,i,a,r,o.x,o.y):this.sprite&&M.systemTimer.callLater(this,this._repaintSprite)}},{key:"_fillTexture",value:function(e,t,n,i,a,r,o,s,l,h,u){var d=this._curSubmit;this._mesh.vertNum+4>b._MAXVERTNUM&&(this._mesh=Le.getAMesh(this.isMain),this.meshlist.push(this._mesh));var c=!0,_=!0;switch(l){case"repeat":break;case"repeat-x":_=!1;break;case"repeat-y":c=!1;break;case"no-repeat":c=_=!1}var f=this._temp4Points,g=0,y=0,v=0,p=0,m=0,l=0;h<0?(v=a,g=-h%t/t):v=a+h,u<0?(p=r,y=-u%n/n):p=r+u,m=a+o,l=r+s,c||(m=Math.min(m,a+h+t)),_||(l=Math.min(l,r+u+n)),m<a||l<r||m<v||l<p||(t=(m-a-h)/t,n=(l-r-u)/n,this.transformQuad(v,p,m-v,l-p,0,this._curMat,this._transedPoints),f[0]=g,f[1]=y,f[2]=t,f[3]=y,f[4]=t,f[5]=n,f[6]=g,f[7]=n,this.clipedOff(this._transedPoints)||(n=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA),this._mesh.addQuad(this._transedPoints,f,n,!0),(n=ee.create(Q.TEXTURE2D,0)).defines.add(Q.FILLTEXTURE),n.u_TexRange=i,d=this._curSubmit=je.create(this,this._mesh,n),this._submits[this._submits._length++]=d,this._copyClipInfo(d,this._globalClipMatrix),d.shaderValue.textureHost=e,d._renderType=we.TYPE_TEXTURE,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4),this.breakNextMerge())}},{key:"setColorFilter",value:function(e){xe.save(this,xe.TYPE_COLORFILTER,this,!0),this._colorFiler=e,this._curSubmit=we.RENDERBASE}},{key:"drawTexture",value:function(e,t,n,i,a){this._drawTextureM(e,t,n,i,a,null,1,null)}},{key:"drawTextures",value:function(e,t,n,i){if(e._getSource())for(var a=t.length/2,r=0,o=e.bitmap.id,s=0;s<a;s++)this._inner_drawTexture(e,o,t[r++]+n,t[r++]+i,0,0,null,null,1,!1);else this.sprite&&M.systemTimer.callLater(this,this._repaintSprite)}},{key:"_drawTextureAddSubmit",value:function(e,t){var n=null,n=je.create(this,this._mesh,ee.create(Q.TEXTURE2D,0));(this._submits[this._submits._length++]=n).shaderValue.textureHost=t,n._key.other=e,n._renderType=we.TYPE_TEXTURE,this._curSubmit=n}},{key:"_drawTextureM",value:function(e,t,n,i,a,r,o,s){var l=this.sprite;return!!e._getSource(function(){l&&l.repaint()})&&this._inner_drawTexture(e,e.bitmap.id,t,n,i,a,r,s,o,!1)}},{key:"_drawRenderTexture",value:function(e,t,n,i,a,r,o,s){return this._inner_drawTexture(e,-1,t,n,i,a,r,s,1,!1)}},{key:"submitDebugger",value:function(){this._submits[this._submits._length++]=ne.create([],function(){},this)}},{key:"_copyClipInfo",value:function(e,t){var n=e.shaderValue.clipMatDir;n[0]=t.a,n[1]=t.b,n[2]=t.c,n[3]=t.d;n=e.shaderValue.clipMatPos;n[0]=t.tx,n[1]=t.ty,e.clipInfoID=this._clipInfoID,this._clipInCache&&(e.shaderValue.clipOff[0]=1)}},{key:"isSameClipInfo",value:function(e){return e.clipInfoID===this._clipInfoID}},{key:"_useNewTex2DSubmit",value:function(e,t){this._mesh.vertNum+t>b._MAXVERTNUM&&(this._mesh=Le.getAMesh(this.isMain),this.meshlist.push(this._mesh));t=je.create(this,this._mesh,ee.create(Q.TEXTURE2D,0));(this._submits[this._submits._length++]=this._curSubmit=t).shaderValue.textureHost=e,this._copyClipInfo(t,this._globalClipMatrix)}},{key:"_drawTexRect",value:function(e,t,n,i,a){this.transformQuad(e,t,n,i,this._italicDeg,this._curMat,this._transedPoints);i=this._transedPoints;i[0]=i[0]+.5|0,i[1]=i[1]+.5|0,i[2]=i[2]+.5|0,i[3]=i[3]+.5|0,i[4]=i[4]+.5|0,i[5]=i[5]+.5|0,i[6]=i[6]+.5|0,i[7]=i[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,a,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)}},{key:"drawCallOptimize",value:function(e){return this._charSubmitCache.enable(e,this),e}},{key:"_inner_drawTexture",value:function(e,t,n,i,a,r,o,s,l,h){var u=this._curSubmit._key;if(s=s||e._uv,u.submitType===we.KEY_TRIANGLES&&u.other===t){var d=this._drawTexToDrawTri_Vert;d[0]=n,d[1]=i,d[2]=n+a,d[3]=i,d[4]=n+a,d[5]=i+r,d[6]=n,d[7]=i+r,this._drawTriUseAbsMatrix=!0;var c=this._tempUV;return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],this.drawTriangles(e,0,0,d,c,this._drawTexToDrawTri_Index,o,l,null,null),!(this._drawTriUseAbsMatrix=!1)}var _=this._mesh,d=this._curSubmit,c=h?this._charSubmitCache.getPos():this._transedPoints;this.transformQuad(n,i,a||e.width,r||e.height,this._italicDeg,o||this._curMat,c),this.drawTexAlign&&(o=Math.round,c[0]=o(c[0]),c[1]=o(c[1]),c[2]=o(c[2]),c[3]=o(c[3]),c[4]=o(c[4]),c[5]=o(c[5]),c[6]=o(c[6]),c[7]=o(c[7]),this.drawTexAlign=!1);l=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*l);if(h)return this._charSubmitCache.add(this,e,t,c,s,l),!0;this._drawCount++;u=(u=0<=t&&u.submitType===we.KEY_DRAWTEXTURE&&u.other===t)&&u&&this.isSameClipInfo(d);return this._lastTex=e,_.vertNum+4>b._MAXVERTNUM&&(_=this._mesh=Le.getAMesh(this.isMain),this.meshlist.push(_),u=!1),_.addQuad(c,s,l,!0),u||(this._submits[this._submits._length++]=this._curSubmit=d=je.create(this,_,ee.create(Q.TEXTURE2D,0)),d.shaderValue.textureHost=e,d._key.other=t,this._copyClipInfo(d,this._globalClipMatrix)),d._numEle+=6,_.indexNum+=6,_.vertNum+=4,!0}},{key:"transform4Points",value:function(e,t,n){var i=t.tx,a=t.ty,r=t.a,o=t.b,s=t.c,l=t.d,h=e[0],u=e[1],d=e[2],c=e[3],_=e[4],f=e[5],g=e[6],e=e[7];t._bTransform?(n[0]=h*r+u*s+i,n[1]=h*o+u*l+a,n[2]=d*r+c*s+i,n[3]=d*o+c*l+a,n[4]=_*r+f*s+i,n[5]=_*o+f*l+a,n[6]=g*r+e*s+i,n[7]=g*o+e*l+a):(n[0]=h+i,n[1]=u+a,n[2]=d+i,n[3]=c+a,n[4]=_+i,n[5]=f+a,n[6]=g+i,n[7]=e+a)}},{key:"clipedOff",value:function(e){return this._clipRect.width<=0||this._clipRect.height<=0}},{key:"transformQuad",value:function(e,t,n,i,a,r,o){var s=0;0!=a&&(s=Math.tan(a*Math.PI/180)*i);var l=e+n,h=t+i,u=r.tx,d=r.ty,c=r.a,_=r.b,f=r.c,g=r.d,a=e+s,n=t,i=l+s,s=t,t=l,l=h,e=e,h=h;r._bTransform?(o[0]=a*c+n*f+u,o[1]=a*_+n*g+d,o[2]=i*c+s*f+u,o[3]=i*_+s*g+d,o[4]=t*c+l*f+u,o[5]=t*_+l*g+d,o[6]=e*c+h*f+u,o[7]=e*_+h*g+d):(o[0]=a+u,o[1]=n+d,o[2]=i+u,o[3]=s+d,o[4]=t+u,o[5]=l+d,o[6]=e+u,o[7]=h+d)}},{key:"pushRT",value:function(){this.addRenderObject(ne.create(null,q.pushRT,this))}},{key:"popRT",value:function(){this.addRenderObject(ne.create(null,q.popRT,this)),this.breakNextMerge()}},{key:"useRT",value:function(e){this.addRenderObject(ne.create([e],function(e){if(!e)throw"error useRT";e.start(),e.clear(0,0,0,0)},this)),this.breakNextMerge()}},{key:"RTRestore",value:function(e){this.addRenderObject(ne.create([e],function(e){e.restore()},this)),this.breakNextMerge()}},{key:"breakNextMerge",value:function(){this._curSubmit=we.RENDERBASE}},{key:"_repaintSprite",value:function(){this.sprite&&this.sprite.repaint()}},{key:"drawTextureWithTransform",value:function(e,t,n,i,a,r,o,s,l,h){var u,d=10<arguments.length&&void 0!==arguments[10]?arguments[10]:null,c=11<arguments.length?arguments[11]:void 0,_=this._curMat;h&&(u=this.globalCompositeOperation,this.globalCompositeOperation=h);var f=this._colorFiler;if(d&&this.setColorFilter(d),!r)return this._drawTextureM(e,t+o,n+s,i,a,_,l,c),h&&(this.globalCompositeOperation=u),void(d&&this.setColorFilter(f));var g=this._tmpMatrix;g.a=r.a,g.b=r.b,g.c=r.c,g.d=r.d,g.tx=r.tx+o,g.ty=r.ty+s,g._bTransform=r._bTransform,r&&_._bTransform?(D.mul(g,_,g),(r=g)._bTransform=!0):(g.tx+=_.tx,g.ty+=_.ty,r=g),this._drawTextureM(e,t,n,i,a,r,l,c),h&&(this.globalCompositeOperation=u),d&&this.setColorFilter(f)}},{key:"_flushToTarget",value:function(e,t){j.worldScissorTest=!1;var n=P.instance;n.disable(n.SCISSOR_TEST);var i=j.worldAlpha,a=j.worldMatrix4,n=j.worldMatrix;j.worldMatrix=D.EMPTY,j.restoreTempArray(),j.worldMatrix4=j.TEMPMAT4_ARRAY,j.worldAlpha=1,W.activeShader=null,t.start(),0<e._submits._length&&t.clear(0,0,0,0),e._curSubmit=we.RENDERBASE,e.flush(),e.clear(),t.restore(),e._curSubmit=we.RENDERBASE,W.activeShader=null,j.worldAlpha=i,j.worldMatrix4=a,j.worldMatrix=n}},{key:"drawCanvas",value:function(e,t,n,i,a){var r,o;e&&((r=e.context)._targets?(0<r._submits._length&&(o=ne.create([r,r._targets],this._flushToTarget,this),this._submits[this._submits._length++]=o),this._drawRenderTexture(r._targets,t,n,i,a,null,1,q.flipyuv)):((i=e).touches&&i.touches.forEach(function(e){e.touch()}),o=Ye.create(e,this._shader2D.ALPHA,this._shader2D.filters),(this._submits[this._submits._length++]=o)._key.clear(),a=o._matrix,this._curMat.copyTo(a),e=a.tx,o=a.ty,a.tx=a.ty=0,a.transformPoint(L.TEMP.setTo(t,n)),a.translate(L.TEMP.x+e,L.TEMP.y+o),D.mul(i.invMat,a,a)),this._curSubmit=we.RENDERBASE)}},{key:"drawTarget",value:function(e,t,n,i,a,r,o){var s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:null,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:-1;if(this._drawCount++,this._mesh.vertNum+4>b._MAXVERTNUM&&(this._mesh=Le.getAMesh(this.isMain),this.meshlist.push(this._mesh)),this.transformQuad(t,n,i,a,0,r||this._curMat,this._transedPoints),this.clipedOff(this._transedPoints))return this._curSubmit=we.RENDERBASE,!1;this._mesh.addQuad(this._transedPoints,s||$e.DEF_UV,4294967295,!0);e=this._curSubmit=We.create(this,this._mesh,o,e);return e.blendType=-1==l?this._nBlendType:l,this._copyClipInfo(e,this._globalClipMatrix),e._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._submits[this._submits._length++]=e,this._curSubmit=we.RENDERBASE,!0}},{key:"drawTriangles",value:function(e,t,n,i,a,r,o,s,l,h){var u,d,c,_,f,g=10<arguments.length&&void 0!==arguments[10]?arguments[10]:4294967295,y=null;h&&(y=this.globalCompositeOperation,this.globalCompositeOperation=h),e._getSource()?(this._drawCount++,u=this._tmpMatrix,d=this._triangleMesh,c=null,_=!1,l&&(c=this._colorFiler,this._colorFiler=l,this._curSubmit=we.RENDERBASE,_=c!=l),f=e.bitmap,l=(l=this._curSubmit._key).submitType===we.KEY_TRIANGLES&&l.other===f.id&&l.blendShader==this._nBlendType,d.vertNum+i.length/2>b._MAXVERTNUM&&(d=this._triangleMesh=Oe.getAMesh(this.isMain),this.meshlist.push(d),l=!1),l||((l=this._curSubmit=je.create(this,d,ee.create(Q.TEXTURE2D,0))).shaderValue.textureHost=e,l._renderType=we.TYPE_TEXTURE,l._key.submitType=we.KEY_TRIANGLES,l._key.other=f.id,this._copyClipInfo(l,this._globalClipMatrix),this._submits[this._submits._length++]=l),s=this._mixRGBandAlpha(g,this._shader2D.ALPHA*s),this._drawTriUseAbsMatrix?d.addData(i,a,r,o,s):(o?(u.a=o.a,u.b=o.b,u.c=o.c,u.d=o.d,u.tx=o.tx+t,u.ty=o.ty+n):(u.a=1,u.b=0,u.c=0,u.d=1,u.tx=t,u.ty=n),D.mul(u,this._curMat,u),d.addData(i,a,r,u||this._curMat,s)),this._curSubmit._numEle+=r.length,_&&(this._colorFiler=c,this._curSubmit=we.RENDERBASE),h&&(this.globalCompositeOperation=y)):this.sprite&&M.systemTimer.callLater(this,this._repaintSprite)}},{key:"transform",value:function(e,t,n,i,a,r){Ee.save(this),D.mul(D.TEMP.setTo(e,t,n,i,a,r),this._curMat,this._curMat),this._curMat._checkTransform()}},{key:"_transformByMatrix",value:function(e,t,n){e.setTranslate(t,n),D.mul(e,this._curMat,this._curMat),e.setTranslate(0,0),this._curMat._bTransform=!0}},{key:"setTransformByMatrix",value:function(e){e.copyTo(this._curMat)}},{key:"rotate",value:function(e){Ee.save(this),this._curMat.rotateEx(e)}},{key:"scale",value:function(e,t){Ee.save(this),this._curMat.scaleEx(e,t)}},{key:"clipRect",value:function(e,t,n,i){ke.save(this),this._clipRect==b.MAXCLIPRECT?this._clipRect=new O(e,t,n,i):(this._clipRect.width=n,this._clipRect.height=i,this._clipRect.x=e,this._clipRect.y=t),this._clipID_Gen++,this._clipID_Gen%=1e4,this._clipInfoID=this._clipID_Gen;var a=this._globalClipMatrix,r=a.tx,o=a.ty,n=r+a.a,i=o+a.d;this._clipRect.width>=b._MAXSIZE?(a.a=a.d=b._MAXSIZE,a.b=a.c=a.tx=a.ty=0):(this._curMat._bTransform?(a.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,a.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,a.a=this._clipRect.width*this._curMat.a,a.b=this._clipRect.width*this._curMat.b,a.c=this._clipRect.height*this._curMat.c,a.d=this._clipRect.height*this._curMat.d):(a.tx=this._clipRect.x+this._curMat.tx,a.ty=this._clipRect.y+this._curMat.ty,a.a=this._clipRect.width,a.b=a.c=0,a.d=this._clipRect.height),this._incache&&(this._clipInCache=!0)),0<a.a&&0<a.d&&(e=a.tx+a.a,t=a.ty+a.d,e<=r||t<=o||a.tx>=n||a.ty>=i?(a.a=-.1,a.d=-.1):(a.tx<r&&(a.a-=r-a.tx,a.tx=r),n<e&&(a.a-=e-n),a.ty<o&&(a.d-=o-a.ty,a.ty=o),i<t&&(a.d-=t-i),a.a<=0&&(a.a=-.1),a.d<=0&&(a.d=-.1)))}},{key:"drawMesh",value:function(e,t,n,i,a,r,o,s){}},{key:"addRenderObject",value:function(e){this._submits[this._submits._length++]=e}},{key:"submitElement",value:function(e,t){this.isMain;var n=this._submits,i=n._length;t<0&&(t=n._length);for(var a=we.RENDERBASE;e<t;)this._renderNextSubmitIndex=e+1,n[e]!==we.RENDERBASE?(we.preRender=a,e+=(a=n[e]).renderSubmit()):e++;return i}},{key:"flush",value:function(){this._clipID_Gen=0;var e=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),Ve.instance&&Ve.getInstance().reset(),this._curSubmit=we.RENDERBASE;for(var t=0,n=this.meshlist.length;t<n;t++){var i=this.meshlist[t];i.canReuse?i.releaseMesh():i.destroy()}return this.meshlist.length=0,this._mesh=Le.getAMesh(this.isMain),this._pathMesh=Pe.getAMesh(this.isMain),this._triangleMesh=Oe.getAMesh(this.isMain),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%60==0&&this.isMain&&st.textRenderInst&&st.textRenderInst.GC(),e}},{key:"beginPath",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._getPath().beginPath(e)}},{key:"closePath",value:function(){this._path.closePath()}},{key:"addPath",value:function(e,t,n,i,a){for(var r=0,o=0,s=e.length/2;o<s;o++){var l=e[r]+i,h=e[r+1]+a;e[r]=l,e[r+1]=h,r+=2}this._getPath().push(e,n)}},{key:"fill",value:function(){var e=this._curMat,t=this._getPath(),n=this._curSubmit,i=n._key.submitType===we.KEY_VG&&n._key.blendShader===this._nBlendType;(i=i&&(i&&this.isSameClipInfo(n)))||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var a=this.mixRGBandAlpha(this.fillStyle.toInt()),r=0,o=0,s=t.paths.length;o<s;o++){var l=t.paths[o],h=l.path.length/2;if(!(h<3||3==h&&!l.convex)){var u,d,c,_,f=l.path.concat(),g=0;if(e._bTransform)for(g=0;g<h;g++)d=(u=g<<1)+1,c=f[u],_=f[d],f[u]=e.a*c+e.c*_+e.tx,f[d]=e.b*c+e.d*_+e.ty;else for(g=0;g<h;g++)d=(u=g<<1)+1,c=f[u],_=f[d],f[u]=c+e.tx,f[d]=_+e.ty;this._pathMesh.vertNum+h>b._MAXVERTNUM&&(this._curSubmit._numEle+=r,r=0,this._pathMesh=Pe.getAMesh(this.isMain),this._curSubmit=this.addVGSubmit(this._pathMesh));var y=this._pathMesh.vertNum;if(l.convex)for(var v=h-2,p=new Array(3*v),m=0,w=0;w<v;w++)p[m++]=y,p[m++]=w+1+y,p[m++]=w+2+y;else if(p=Ge.earcut(f,null,2),0<y)for(var x=0;x<p.length;x++)p[x]+=y;this._pathMesh.addVertAndIBToMesh(this,f,a,p),r+=p.length}}this._curSubmit._numEle+=r}},{key:"addVGSubmit",value:function(e){e=He.createShape(this,e,0,ee.create(Q.PRIMITIVE,0));return e._key.submitType=we.KEY_VG,this._submits[this._submits._length++]=e,this._copyClipInfo(e,this._globalClipMatrix),e}},{key:"stroke",value:function(){if(0<this.lineWidth){var e=this.mixRGBandAlpha(this.strokeStyle._color.numColor),t=this._getPath(),n=this._curSubmit,i=n._key.submitType===we.KEY_VG&&n._key.blendShader===this._nBlendType;(i=i&&(i&&this.isSameClipInfo(n)))||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var a=0,r=0,o=t.paths.length;r<o;r++){var s=t.paths[r];if(!(s.path.length<=0)){var l=[],h=[],u=2*s.path.length;if(!(u<2)){this._pathMesh.vertNum+u>b._MAXVERTNUM&&(this._curSubmit._numEle+=a,a=0,this._pathMesh=Pe.getAMesh(this.isMain),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),Ue.createLine2(s.path,l,this.lineWidth,this._pathMesh.vertNum,h,s.loop);var d,c,_,f,g=h.length/2,y=this._curMat,v=0;if(y._bTransform)for(v=0;v<g;v++)c=(d=v<<1)+1,_=h[d],f=h[c],h[d]=y.a*_+y.c*f+y.tx,h[c]=y.b*_+y.d*f+y.ty;else for(v=0;v<g;v++)c=(d=v<<1)+1,_=h[d],f=h[c],h[d]=_+y.tx,h[c]=f+y.ty;this._pathMesh.addVertAndIBToMesh(this,h,e,l),a+=l.length}}}this._curSubmit._numEle+=a}}},{key:"moveTo",value:function(e,t){var n=this._getPath();n.newPath(),n._lastOriX=e,n._lastOriY=t,n.addPoint(e,t)}},{key:"lineTo",value:function(e,t){var n=this._getPath();Math.abs(e-n._lastOriX)<.001&&Math.abs(t-n._lastOriY)<.001||(n._lastOriX=e,n._lastOriY=t,n.addPoint(e,t))}},{key:"arcTo",value:function(e,t,n,i,a){var r=0,o=0,s=0,l=this._path._lastOriX-e,h=this._path._lastOriY-t;if(!((g=Math.sqrt(l*l+h*h))<=1e-6)){var u=l/g,d=h/g,c=n-e,_=i-t,f=c*c+_*_,l=Math.sqrt(f);if(!(l<=1e-6)){h=c/l,n=_/l,i=u+h,f=d+n,c=Math.sqrt(i*i+f*f);if(!(c<=1e-6)){var g,_=i/c,l=f/c,i=Math.acos(_*u+l*d),f=Math.PI/2-i,c=(g=a/Math.tan(f))*u+e,i=g*d+t,a=Math.sqrt(g*g+a*a),y=e+_*a,v=t+l*a,p=0,m=0;m=(p=(h=0<=u*n-d*h?2*f/b.SEGNUM:2*-f/b.SEGNUM,Math.sin(h)),Math.cos(h));var w=this._path._lastOriX,x=this._path._lastOriY,f=c,h=i;(.1<Math.abs(f-this._path._lastOriX)||.1<Math.abs(h-this._path._lastOriY))&&(w=o=f,x=s=h,this._path._lastOriX=o,this._path._lastOriY=s,this._path.addPoint(o,s));for(var k=c-y,T=i-v,r=0;r<b.SEGNUM;r++){var E=k*m+T*p,M=-k*p+T*m,o=E+y,s=M+v;(.1<Math.abs(w-o)||.1<Math.abs(x-s))&&(this._path._lastOriX=o,this._path._lastOriY=s,this._path.addPoint(o,s),w=o,x=s),k=E,T=M}}}}}},{key:"arc",value:function(e,t,n,i,a){var r,o=0,s=0,l=0,h=0,o=a-i;if(5<arguments.length&&void 0!==arguments[5]&&arguments[5])if(Math.abs(o)>=2*Math.PI)o=2*-Math.PI;else for(;0<o;)o-=2*Math.PI;else if(Math.abs(o)>=2*Math.PI)o=2*Math.PI;else for(;o<0;)o+=2*Math.PI;for(var u=this.getMatScaleX(),d=this.getMatScaleY(),d=n*(d<u?u:d),d=2*Math.PI*d,c=0|Math.max(d/10,10),_=this._getPath(),f=0;f<=c;f++)r=i+o*(f/c),s=Math.cos(r),h=t+Math.sin(r)*n,(l=e+s*n)==this._path._lastOriX&&h==this._path._lastOriY||_.addPoint(l,h);s=Math.cos(a),h=t+Math.sin(a)*n,(l=e+s*n)==this._path._lastOriX&&h==this._path._lastOriY||_.addPoint(l,h)}},{key:"quadraticCurveTo",value:function(e,t,n,i){for(var a=fe.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,e,t,n,i],30,2),r=0,o=a.length/2;r<o;r++)this.lineTo(a[2*r],a[2*r+1]);this.lineTo(n,i)}},{key:"mixRGBandAlpha",value:function(e){return this._mixRGBandAlpha(e,this._shader2D.ALPHA)}},{key:"_mixRGBandAlpha",value:function(e,t){if(1<=t)return e;var n=(4278190080&e)>>>24;return 0!=n?n*=t:n=255*t,16777215&e|n<<24}},{key:"strokeRect",value:function(e,t,n,i,a){var r,o;0<this.lineWidth&&(r=this.mixRGBandAlpha(this.strokeStyle._color.numColor),o=this.lineWidth/2,this._fillRect(e-o,t-o,n+this.lineWidth,this.lineWidth,r),this._fillRect(e-o,t-o+i,n+this.lineWidth,this.lineWidth,r),this._fillRect(e-o,t+o,this.lineWidth,i-this.lineWidth,r),this._fillRect(e-o+n,t+o,this.lineWidth,i-this.lineWidth,r))}},{key:"clip",value:function(){}},{key:"drawParticle",value:function(e,t,n){n.x=e,n.y=t,this._submits[this._submits._length++]=n}},{key:"_getPath",value:function(){return this._path||(this._path=new pe)}},{key:"_fillTexture_h",value:function(e,t,n,i,a,r,o,s){for(var l=r,h=Math.floor(s/i),u=s%i,d=0;d<h;d++)this._inner_drawTexture(e,t,l,o,i,a,this._curMat,n,1,!1),l+=i;0<u&&(r=n[2]-n[0],s=n[0]+u/i*r,(r=b.tmpuv1)[0]=n[0],r[1]=n[1],r[2]=s,r[3]=n[3],r[4]=s,r[5]=n[5],r[6]=n[6],r[7]=n[7],this._inner_drawTexture(e,t,l,o,u,a,this._curMat,r,1,!1))}},{key:"_fillTexture_v",value:function(e,t,n,i,a,r,o,s){for(var l=o,h=Math.floor(s/a),u=s%a,d=0;d<h;d++)this._inner_drawTexture(e,t,r,l,i,a,this._curMat,n,1,!1),l+=a;0<u&&(o=n[7]-n[1],s=n[1]+u/a*o,(o=b.tmpuv1)[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=s,o[6]=n[6],o[7]=s,this._inner_drawTexture(e,t,r,l,i,u,this._curMat,o,1,!1))}},{key:"drawTextureWithSizeGrid",value:function(e,t,n,i,a,r,o,s){var l,h,u,d,c,_,f,g,y,v,p,m,w,x,k,T,E,M;e._getSource()&&(t+=o,n+=s,E=e.uv,T=e.bitmap.width,x=e.bitmap.height,u=(l=r[0])/x,d=(h=r[3])/T,f=(c=r[1])/T,g=(_=r[2])/x,M=r[4],y=!1,a==x&&(l=_=0),i<(h=i==T?c=0:h)+c&&(k=i,y=!0,i=h+c,this.save(),this.clipRect(0+t,0+n,k,a)),v=e.bitmap.id,p=this._curMat,m=this._tempUV,o=w=E[0],r=s=E[1],T=x=E[4],E=k=E[5],h&&l&&(T=w+d,E=s+u,m[0]=w,m[1]=s,m[2]=T,m[3]=s,m[4]=T,m[5]=E,m[6]=w,m[7]=E,this._inner_drawTexture(e,v,t,n,h,l,p,m,1,!1)),c&&l&&(o=x-f,T=x,E=(r=s)+u,m[0]=o,m[1]=r,m[2]=T,m[3]=r,m[4]=T,m[5]=E,m[6]=o,m[7]=E,this._inner_drawTexture(e,v,i-c+t,0+n,c,l,p,m,1,!1)),h&&_&&(r=k-g,T=(o=w)+d,E=k,m[0]=o,m[1]=r,m[2]=T,m[3]=r,m[4]=T,m[5]=E,m[6]=o,m[7]=E,this._inner_drawTexture(e,v,0+t,a-_+n,h,_,p,m,1,!1)),c&&_&&(o=x-f,r=k-g,T=x,E=k,m[0]=o,m[1]=r,m[2]=T,m[3]=r,m[4]=T,m[5]=E,m[6]=o,m[7]=E,this._inner_drawTexture(e,v,i-c+t,a-_+n,c,_,p,m,1,!1)),l&&(o=w+d,T=x-f,E=(r=s)+u,m[0]=o,m[1]=r,m[2]=T,m[3]=r,m[4]=T,m[5]=E,m[6]=o,m[7]=E,M?this._fillTexture_h(e,v,m,e.width-h-c,l,h+t,n,i-h-c):this._inner_drawTexture(e,v,h+t,n,i-h-c,l,p,m,1,!1)),_&&(o=w+d,r=k-g,T=x-f,E=k,m[0]=o,m[1]=r,m[2]=T,m[3]=r,m[4]=T,m[5]=E,m[6]=o,m[7]=E,M?this._fillTexture_h(e,v,m,e.width-h-c,_,h+t,a-_+n,i-h-c):this._inner_drawTexture(e,v,h+t,a-_+n,i-h-c,_,p,m,1,!1)),h&&(r=s+u,T=(o=w)+d,E=k-g,m[0]=o,m[1]=r,m[2]=T,m[3]=r,m[4]=T,m[5]=E,m[6]=o,m[7]=E,M?this._fillTexture_v(e,v,m,h,e.height-l-_,t,l+n,a-l-_):this._inner_drawTexture(e,v,t,l+n,h,a-l-_,p,m,1,!1)),c&&(o=x-f,r=s+u,T=x,E=k-g,m[0]=o,m[1]=r,m[2]=T,m[3]=r,m[4]=T,m[5]=E,m[6]=o,m[7]=E,M?this._fillTexture_v(e,v,m,c,e.height-l-_,i-c+t,l+n,a-l-_):this._inner_drawTexture(e,v,i-c+t,l+n,c,a-l-_,p,m,1,!1)),o=w+d,r=s+u,T=x-f,E=k-g,m[0]=o,m[1]=r,m[2]=T,m[3]=r,m[4]=T,m[5]=E,m[6]=o,m[7]=E,M?((M=b.tmpUVRect)[0]=o,M[1]=r,M[2]=T-o,M[3]=E-r,this._fillTexture(e,e.width-h-c,e.height-l-_,M,h+t,l+n,i-h-c,a-l-_,"repeat",0,0)):this._inner_drawTexture(e,v,h+t,l+n,i-h-c,a-l-_,p,m,1,!1),y&&this.restore())}},{key:"lineJoin",get:function(){return""},set:function(e){}},{key:"lineCap",get:function(){return""},set:function(e){}},{key:"miterLimit",get:function(){return""},set:function(e){}},{key:"asBitmap",set:function(e){if(e){if(this._targets||(this._targets=new q(this._width,this._height,H.R8G8B8A8,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}},{key:"fillStyle",set:function(e){this._shader2D.fillStyle.equal(e)||(xe.save(this,xe.TYPE_FILESTYLE,this._shader2D,!1),this._shader2D.fillStyle=ve.create(e),this._submitKey.other=-this._shader2D.fillStyle.toInt())},get:function(){return this._shader2D.fillStyle}},{key:"globalAlpha",set:function(e){(e=Math.floor(1e3*e)/1e3)!=this._shader2D.ALPHA&&(xe.save(this,xe.TYPE_ALPHA,this._shader2D,!1),this._shader2D.ALPHA=e)},get:function(){return this._shader2D.ALPHA}},{key:"textAlign",set:function(e){this._other.textAlign===e||(this._other=this._other.make(),xe.save(this,xe.TYPE_TEXTALIGN,this._other,!1),this._other.textAlign=e)},get:function(){return this._other.textAlign}},{key:"textBaseline",set:function(e){this._other.textBaseline===e||(this._other=this._other.make(),xe.save(this,xe.TYPE_TEXTBASELINE,this._other,!1),this._other.textBaseline=e)},get:function(){return this._other.textBaseline}},{key:"globalCompositeOperation",set:function(e){e=K.TOINT[e];null==e||this._nBlendType===e||(xe.save(this,xe.TYPE_GLOBALCOMPOSITEOPERATION,this,!0),this._curSubmit=we.RENDERBASE,this._nBlendType=e)},get:function(){return K.NAMES[this._nBlendType]}},{key:"strokeStyle",set:function(e){this._shader2D.strokeStyle.equal(e)||(xe.save(this,xe.TYPE_STROKESTYLE,this._shader2D,!1),this._shader2D.strokeStyle=ve.create(e),this._submitKey.other=-this._shader2D.strokeStyle.toInt())},get:function(){return this._shader2D.strokeStyle}},{key:"lineWidth",set:function(e){this._other.lineWidth===e||(this._other=this._other.make(),xe.save(this,xe.TYPE_LINEWIDTH,this._other,!1),this._other.lineWidth=e)},get:function(){return this._other.lineWidth}},{key:"font",set:function(e){this._other=this._other.make(),xe.save(this,xe.TYPE_FONT,this._other,!1)}},{key:"canvas",get:function(){return this._canvas}}],[{key:"__init__",value:function(){b.MAXCLIPRECT=new O(0,0,b._MAXSIZE,b._MAXSIZE),ut.DEFAULT=new ut}},{key:"set2DRenderConfig",value:function(){var e=P.instance;y.setBlend(e,!0),y.setBlendEquation(e,e.FUNC_ADD),y.setBlendFunc(e,e.ONE,e.ONE_MINUS_SRC_ALPHA),y.setDepthTest(e,!1),y.setCullFace(e,!1),y.setDepthMask(e,!0),y.setFrontFace(e,e.CCW),e.viewport(0,0,j.width,j.height)}}]),b}();lt.ENUM_TEXTALIGN_DEFAULT=0,lt.ENUM_TEXTALIGN_CENTER=1,lt.ENUM_TEXTALIGN_RIGHT=2,lt._SUBMITVBSIZE=32e3,lt._MAXSIZE=99999999,lt._MAXVERTNUM=65535,lt.MAXCLIPRECT=null,lt._COUNT=0,lt.SEGNUM=32,lt._contextcount=0,lt.PI2=2*Math.PI,lt._textRender=null,lt.tmpuv1=[0,0,0,0,0,0,0,0],lt.tmpUV=[0,0,0,0,0,0,0,0],lt.tmpUVRect=[0,0,0,0];var ht,ut=function(){function e(){S(this,e),this.lineWidth=1}return C(e,[{key:"clear",value:function(){this.lineWidth=1,this.textAlign=this.textBaseline=null}},{key:"make",value:function(){return this===e.DEFAULT?new e:this}}]),e}(),dt=function(){function e(){S(this,e)}return C(e,null,[{key:"_uint8ArraySlice",value:function(){for(var e=this.length,t=new Uint8Array(this.length),n=0;n<e;n++)t[n]=this[n];return t}},{key:"_float32ArraySlice",value:function(){for(var e=this.length,t=new Float32Array(this.length),n=0;n<e;n++)t[n]=this[n];return t}},{key:"_uint16ArraySlice",value:function(){var e,t,n;if(0===arguments.length)for(e=this.length,t=new Uint16Array(e),n=0;n<e;n++)t[n]=this[n];else if(2===arguments.length){var i=arguments.length<=0?void 0:arguments[0],a=arguments.length<=1?void 0:arguments[1];if(i<a)for(e=a-i,t=new Uint16Array(e),n=i;n<a;n++)t[n-i]=this[n];else t=new Uint16Array(0)}return t}},{key:"_nativeRender_enable",value:function(){}},{key:"enable",value:function(){return!0}},{key:"inner_enable",value:function(){return Float32Array.prototype.slice||(Float32Array.prototype.slice=e._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=e._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=e._uint8ArraySlice),!0}},{key:"onStageResize",value:function(e,t){null!=y.mainContext&&(y.mainContext.viewport(0,0,e,t),j.width=e,j.height=t)}}]),e}();function ct(e,t){ht[e]=!0,void 0!==t&&(t=t,window.console&&window.console.error&&window.console.error(t))}function _t(e){var t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var i=new _t.VertexAttrib(t);this.attribs[n]=i}this.maxAttrib=0}function ft(i){var n,a,s=this;this.gl=i,a=(n=i).getError,n.getError=function(){for(var e,t;(e=a.apply(n))!=n.NO_ERROR&&(ht[e]=!0),e!=n.NO_ERROR;);for(t in ht)if(ht[t])return delete ht[t],parseInt(t);return n.NO_ERROR};var l=this.original={getParameter:i.getParameter,enableVertexAttribArray:i.enableVertexAttribArray,disableVertexAttribArray:i.disableVertexAttribArray,bindBuffer:i.bindBuffer,getVertexAttrib:i.getVertexAttrib,vertexAttribPointer:i.vertexAttribPointer};i.getParameter=function(e){return e==s.VERTEX_ARRAY_BINDING_OES?s.currentVertexArrayObject==s.defaultVertexArrayObject?null:s.currentVertexArrayObject:l.getParameter.apply(this,arguments)},i.enableVertexAttribArray=function(e){var t=s.currentVertexArrayObject;return t.maxAttrib=Math.max(t.maxAttrib,e),t.attribs[e].enabled=!0,l.enableVertexAttribArray.apply(this,arguments)},i.disableVertexAttribArray=function(e){var t=s.currentVertexArrayObject;return t.maxAttrib=Math.max(t.maxAttrib,e),t.attribs[e].enabled=!1,l.disableVertexAttribArray.apply(this,arguments)},i.bindBuffer=function(e,t){switch(e){case i.ARRAY_BUFFER:s.currentArrayBuffer=t;break;case i.ELEMENT_ARRAY_BUFFER:s.currentVertexArrayObject.elementArrayBuffer=t}return l.bindBuffer.apply(this,arguments)},i.getVertexAttrib=function(e,t){var n=s.currentVertexArrayObject.attribs[e];switch(t){case i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return n.buffer;case i.VERTEX_ATTRIB_ARRAY_ENABLED:return n.enabled;case i.VERTEX_ATTRIB_ARRAY_SIZE:return n.size;case i.VERTEX_ATTRIB_ARRAY_STRIDE:return n.stride;case i.VERTEX_ATTRIB_ARRAY_TYPE:return n.type;case i.VERTEX_ATTRIB_ARRAY_NORMALIZED:return n.normalized;default:return l.getVertexAttrib.apply(this,arguments)}},i.vertexAttribPointer=function(e,t,n,i,a,r){var o=s.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,e);e=o.attribs[e];return e.buffer=s.currentArrayBuffer,e.size=t,e.type=n,e.normalized=i,e.stride=a,e.offset=r,e.recache(),l.vertexAttribPointer.apply(this,arguments)},i.instrumentExtension&&i.instrumentExtension(this,"OES_vertex_array_object"),i.canvas.addEventListener("webglcontextrestored",function(){window.console&&window.console.log&&window.console.log("OESVertexArrayObject emulation library context restored"),s.reset_()},!0),this.reset_()}dt._isWebGL2=!1,dt.isNativeRender_enable=!1,ht={},(_t.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=e.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")},ft.prototype.VERTEX_ARRAY_BINDING_OES=34229,ft.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;var t=this.gl;this.maxVertexAttribs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new _t(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},ft.prototype.createVertexArrayOES=function(){var e=new _t(this);return this.vertexArrayObjects.push(e),e},ft.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject==e&&this.bindVertexArrayOES(null)},ft.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof _t&&e.hasBeenBound&&e.ext==this)},ft.prototype.bindVertexArrayOES=function(e){var t=this.gl;if(!e||e.isAlive){var n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var a=this.currentVertexArrayObject;if(i!=a){i&&a.elementArrayBuffer==i.elementArrayBuffer||n.bindBuffer.call(t,t.ELEMENT_ARRAY_BUFFER,a.elementArrayBuffer);for(var r=this.currentArrayBuffer,o=Math.max(i?i.maxAttrib:0,a.maxAttrib),s=0;s<=o;s++){var l,h=a.attribs[s],u=i?i.attribs[s]:null;i&&h.enabled==u.enabled||(h.enabled?n.enableVertexAttribArray:n.disableVertexAttribArray).call(t,s),h.enabled&&(l=!1,i&&h.buffer==u.buffer||(r!=h.buffer&&(n.bindBuffer.call(t,t.ARRAY_BUFFER,h.buffer),r=h.buffer),l=!0),!l&&h.cached==u.cached||n.vertexAttribPointer.call(t,s,h.size,h.type,h.normalized,h.stride,h.offset))}this.currentArrayBuffer!=r&&n.bindBuffer.call(t,t.ARRAY_BUFFER,this.currentArrayBuffer)}}else ct(t.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},window._setupVertexArrayObject=function(e){var t=e.getSupportedExtensions;e.getSupportedExtensions=function(){var e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};var n=e.getExtension;e.getExtension=function(e){var t=n.call(this,e);return t||("OES_vertex_array_object"!==e?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new ft(this)),this.__OESVertexArrayObject))}},window._forceSetupVertexArrayObject=function(e){var t=e.getSupportedExtensions;e.getSupportedExtensions=function(){var e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};var n=e.getExtension;e.getExtension=function(e){if("OES_vertex_array_object"===e)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new ft(this)),this.__OESVertexArrayObject;e=n.call(this,e);return e||null}};var gt=function(){function a(e,t){S(this,a),this._gl=null,this._vaoExt=null,this._angleInstancedArrays=null,this._isWebGL2=!1,this._oesTextureHalfFloat=null,this._oesTextureHalfFloatLinear=null,this._oesTextureFloat=null,this._extTextureFilterAnisotropic=null,this._compressedTextureS3tc=null,this._compressedTexturePvrtc=null,this._compressedTextureEtc1=null,this._gl=e,this._isWebGL2=t;try{e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?dt.shaderHighPrecision=!0:dt.shaderHighPrecision=!1}catch(e){}t?this._getExtension("EXT_color_buffer_float"):(t=a._forceSupportVAOPlatform(),M.Render.isConchApp||window._setupVertexArrayObject&&(t?window._forceSetupVertexArrayObject(e):window._setupVertexArrayObject(e)),this._vaoExt=this._getExtension("OES_vertex_array_object"),t||(this._angleInstancedArrays=this._getExtension("ANGLE_instanced_arrays")),this._oesTextureHalfFloat=this._getExtension("OES_texture_half_float"),this._oesTextureHalfFloatLinear=this._getExtension("OES_texture_half_float_linear"),this._oesTextureFloat=this._getExtension("OES_texture_float")),this._extTextureFilterAnisotropic=this._getExtension("EXT_texture_filter_anisotropic"),this._compressedTextureS3tc=this._getExtension("WEBGL_compressed_texture_s3tc"),this._compressedTexturePvrtc=this._getExtension("WEBGL_compressed_texture_pvrtc"),this._compressedTextureEtc1=this._getExtension("WEBGL_compressed_texture_etc1")}return C(a,[{key:"_getExtension",value:function(e){var t,n=a._extentionVendorPrefixes;for(t in n){var i=this._gl.getExtension(n[t]+e);if(i)return i}return null}},{key:"createVertexArray",value:function(){return this._isWebGL2?this._gl.createVertexArray():this._vaoExt.createVertexArrayOES()}},{key:"bindVertexArray",value:function(e){this._isWebGL2?this._gl.bindVertexArray(e):this._vaoExt.bindVertexArrayOES(e)}},{key:"deleteVertexArray",value:function(e){this._isWebGL2?this._gl.deleteVertexArray(e):this._vaoExt.deleteVertexArrayOES(e)}},{key:"isVertexArray",value:function(e){this._isWebGL2?this._gl.isVertexArray(e):this._vaoExt.isVertexArrayOES(e)}},{key:"drawElementsInstanced",value:function(e,t,n,i,a){this._isWebGL2?this._gl.drawElementsInstanced(e,t,n,i,a):this._angleInstancedArrays.drawElementsInstancedANGLE(e,t,n,i,a)}},{key:"drawArraysInstanced",value:function(e,t,n,i){this._isWebGL2?this._gl.drawArraysInstanced(e,t,n,i):this._angleInstancedArrays.drawArraysInstancedANGLE(e,t,n,i)}},{key:"vertexAttribDivisor",value:function(e,t){this._isWebGL2?this._gl.vertexAttribDivisor(e,t):this._angleInstancedArrays.vertexAttribDivisorANGLE(e,t)}},{key:"supportInstance",value:function(){return!(!this._isWebGL2&&!this._angleInstancedArrays)}}],[{key:"_forceSupportVAOPlatform",value:function(){var e=M.Browser;return e.onBDMiniGame||e.onQGMiniGame}}]),a}();gt._extentionVendorPrefixes=["","WEBKIT_","MOZ_"];var yt=function(){function a(e,t,n){S(this,a),this._timeId=0,a._mainCanvas=n;n=a._mainCanvas.source;n.id="layaCanvas",n.width=e,n.height=t,a.isConchApp&&document.body.appendChild(n),this.initRender(a._mainCanvas,e,t),window.requestAnimationFrame(function e(t){M.stage._loop();window.requestAnimationFrame(e)}),M.stage.on("visibilitychange",this,this._onVisibilitychange)}return C(a,[{key:"_onVisibilitychange",value:function(){M.stage.isVisibility?0!=this._timeId&&window.clearInterval(this._timeId):this._timeId=window.setInterval(this._enterFrame,1e3)}},{key:"initRender",value:function(e,t,n){var i=P.instance=y.mainContext=function(e){var t,n=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];ye.useWebGL2&&!at.onBDMiniGame||n.shift();for(var i=0;i<n.length;i++){try{t=e.getContext(n[i],{stencil:ye.isStencil,alpha:ye.isAlpha,antialias:ye.isAntialias,premultipliedAlpha:ye.premultipliedAlpha,preserveDrawingBuffer:ye.preserveDrawingBuffer})}catch(e){}if(t)return"webgl2"===n[i]&&(dt._isWebGL2=!0),new P,t}return null}(a._mainCanvas.source);if(!i)return!1;P.instance=i,P.layaGPUInstance=new gt(i,dt._isWebGL2),e.size(t,n),lt.__init__(),we.__init__();n=new lt;return n.isMain=!0,a._context=n,e._setContext(n),Q.__init__(),ee.__init__(),Be.__init__(),Re.__int__(i),K._init_(i),!0}},{key:"_enterFrame",value:function(){M.stage._loop()}}],[{key:"context",get:function(){return a._context}},{key:"canvas",get:function(){return a._mainCanvas.source}}]),a}();yt.supportWebGLPlusCulling=!1,yt.supportWebGLPlusAnimation=!1,yt.supportWebGLPlusRendering=!1,yt.isConchApp=!1,yt.isConchApp=null!=window.conch,(yt.isConchApp||null!=window.qq&&null!=window.qq.webglPlus)&&(yt.supportWebGLPlusCulling=!1,yt.supportWebGLPlusAnimation=!0,yt.supportWebGLPlusRendering=!0);var vt=function(){function c(){S(this,c)}return C(c,[{key:"recover",value:function(){this.texture=null,this.vertices=null,this.uvs=null,this.indices=null,this.matrix=null,g.recover("DrawTrianglesCmd",this)}},{key:"run",value:function(e,t,n){e.drawTriangles(this.texture,this.x+t,this.y+n,this.vertices,this.uvs,this.indices,this.matrix,this.alpha,this.color,this.blendMode,this.colorNum)}},{key:"cmdID",get:function(){return c.ID}}],[{key:"create",value:function(e,t,n,i,a,r,o,s,l,h,u){var d=g.getItemByClass("DrawTrianglesCmd",c);return d.texture=e,d.x=t,d.y=n,d.vertices=i,d.uvs=a,d.indices=r,d.matrix=o,d.alpha=s,l&&(d.color=new oe,l=re.create(l).arrColor,d.color.color(255*l[0],255*l[1],255*l[2],255*l[3])),d.blendMode=h,d.colorNum=u,d}}]),c}();vt.ID="DrawTriangles";var pt=function(){function s(){S(this,s)}return C(s,[{key:"recover",value:function(){this.texture._removeReference(),g.recover("Draw9GridTexture",this)}},{key:"run",value:function(e,t,n){e.drawTextureWithSizeGrid(this.texture,this.x,this.y,this.width,this.height,this.sizeGrid,t,n)}},{key:"cmdID",get:function(){return s.ID}}],[{key:"create",value:function(e,t,n,i,a,r){var o=g.getItemByClass("Draw9GridTexture",s);return(o.texture=e)._addReference(),o.x=t,o.y=n,o.width=i,o.height=a,o.sizeGrid=r,o}}]),s}();pt.ID="Draw9GridTexture";var mt=function(){function v(){S(this,v),this._cacheBoundsType=!1}return C(v,[{key:"destroy",value:function(){this._graphics=null,this._cacheBoundsType=!1,this._temp&&(this._temp.length=0),this._rstBoundPoints&&(this._rstBoundPoints.length=0),this._bounds&&this._bounds.recover(),this._bounds=null,g.recover("GraphicsBounds",this)}},{key:"reset",value:function(){this._temp&&(this._temp.length=0)}},{key:"getBounds",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this._bounds&&this._temp&&!(this._temp.length<1)&&e==this._cacheBoundsType||(this._bounds=O._getWrapRec(this.getBoundPoints(e),this._bounds)),this._cacheBoundsType=e,this._bounds}},{key:"getBoundPoints",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return(!this._temp||this._temp.length<1||e!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(e)),this._cacheBoundsType=e,this._rstBoundPoints=ae.copyArray(this._rstBoundPoints,this._temp)}},{key:"_getCmdPoints",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=this._graphics.cmds,n=this._temp||(this._temp=[]);if(n.length=0,t||null==this._graphics._one||(v._tempCmds.length=0,v._tempCmds.push(this._graphics._one),t=v._tempCmds),!t)return n;var i=v._tempMatrixArrays;i.length=0;var a=v._initMatrix;a.identity();for(var r,o=v._tempMatrix,s=0,l=t.length;s<l;s++)switch((r=t[s]).cmdID){case p.ID:i.push(a),a=a.clone();break;case he.ID:a=i.pop();break;case de.ID:o.identity(),o.translate(-r.pivotX,-r.pivotY),o.scale(r.scaleX,r.scaleY),o.translate(r.pivotX,r.pivotY),this._switchMatrix(a,o);break;case ue.ID:o.identity(),o.translate(-r.pivotX,-r.pivotY),o.rotate(r.angle),o.translate(r.pivotX,r.pivotY),this._switchMatrix(a,o);break;case _e.ID:o.identity(),o.translate(r.tx,r.ty),this._switchMatrix(a,o);break;case ce.ID:o.identity(),o.translate(-r.pivotX,-r.pivotY),o.concat(r.matrix),o.translate(r.pivotX,r.pivotY),this._switchMatrix(a,o);break;case x.ID:case le.ID:v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,r.width,r.height),a);break;case se.ID:a.copyTo(o),r.matrix&&o.concat(r.matrix),v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,r.width,r.height),o);break;case x.ID:var h,u,d,c,_,f,g=r.texture;e?r.width&&r.height?v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,r.width,r.height),a):v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,g.width,g.height),a):(h=(r.width||g.sourceWidth)/g.width,u=(r.height||g.sourceHeight)/g.height,d=h*g.sourceWidth,c=u*g.sourceHeight,_=0<g.offsetX?g.offsetX:0,f=0<g.offsetY?g.offsetY:0,_*=h,f*=u,v._addPointArrToRst(n,O._getBoundPointS(r.x-_,r.y-f,d,c),a));break;case le.ID:r.width&&r.height?v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,r.width,r.height),a):(g=r.texture,v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,g.width,g.height),a));break;case se.ID:var y=r.matrix?(a.copyTo(o),o.concat(r.matrix),o):a;e?r.width&&r.height?v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,r.width,r.height),y):(g=r.texture,v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,g.width,g.height),y)):(g=r.texture,h=(r.width||g.sourceWidth)/g.width,u=(r.height||g.sourceHeight)/g.height,d=h*g.sourceWidth,c=u*g.sourceHeight,_=0<g.offsetX?g.offsetX:0,f=0<g.offsetY?g.offsetY:0,_*=h,f*=u,v._addPointArrToRst(n,O._getBoundPointS(r.x-_,r.y-f,d,c),y));break;case A.ID:v._addPointArrToRst(n,O._getBoundPointS(r.x,r.y,r.width,r.height),a);break;case m.ID:v._addPointArrToRst(n,O._getBoundPointS(r.x-r.radius,r.y-r.radius,r.radius+r.radius,r.radius+r.radius),a);break;case k.ID:v._tempPoints.length=0,y=.5*r.lineWidth,r.fromX==r.toX?v._tempPoints.push(r.fromX+y,r.fromY,r.toX+y,r.toY,r.fromX-y,r.fromY,r.toX-y,r.toY):r.fromY==r.toY?v._tempPoints.push(r.fromX,r.fromY+y,r.toX,r.toY+y,r.fromX,r.fromY-y,r.toX,r.toY-y):v._tempPoints.push(r.fromX,r.fromY,r.toX,r.toY),v._addPointArrToRst(n,v._tempPoints,a);break;case w.ID:v._addPointArrToRst(n,fe.I.getBezierPoints(r.points),a,r.x,r.y);break;case E.ID:case R.ID:v._addPointArrToRst(n,r.points,a,r.x,r.y);break;case I.ID:v._addPointArrToRst(n,this._getPathPoints(r.paths),a,r.x,r.y);break;case N.ID:v._addPointArrToRst(n,this._getPiePoints(r.x,r.y,r.radius,r.startAngle,r.endAngle),a);break;case vt.ID:v._addPointArrToRst(n,this._getTriAngBBXPoints(r.vertices),a);break;case pt.ID:v._addPointArrToRst(n,this._getDraw9GridBBXPoints(r),a)}return 200<n.length?n=ae.copyArray(n,O._getWrapRec(n)._getBoundPoints()):8<n.length&&(n=ge.scanPList(n)),n}},{key:"_switchMatrix",value:function(e,t){t.concat(e),t.copyTo(e)}},{key:"_getPiePoints",value:function(e,t,n,i,a){var r=v._tempPoints;v._tempPoints.length=0;var o=Math.PI/180,s=a-i;if(360<=s||s<=-360)return r.push(e-n,t-n),r.push(e+n,t-n),r.push(e+n,t+n),r.push(e-n,t+n),r;r.push(e,t);var l=s%360;l<0&&(l+=360);a=i+l,s=i*o,l=a*o;r.push(e+n*Math.cos(s),t+n*Math.sin(s)),r.push(e+n*Math.cos(l),t+n*Math.sin(l));for(var i=90*Math.ceil(i/90),h=90*Math.floor(a/90),u=i;u<=h;u+=90){var d=u*o;r.push(e+n*Math.cos(d),t+n*Math.sin(d))}return r}},{key:"_getTriAngBBXPoints",value:function(e){var t=e.length;if(t<2)return[];for(var n=e[0],i=e[1],a=n,r=i,o=2;o<t;){var s=e[o++],l=e[o++];s<n&&(n=s),l<i&&(i=l),a<s&&(a=s),r<l&&(r=l)}return[n,i,a,i,a,r,n,r]}},{key:"_getDraw9GridBBXPoints",value:function(e){var t=e.width,e=e.height;return[0,0,t,0,t,e,0,e]}},{key:"_getPathPoints",value:function(e){var t,n,i,a=v._tempPoints;for(a.length=0,n=e.length,t=0;t<n;t++)1<(i=e[t]).length&&(a.push(i[1],i[2]),3<i.length&&a.push(i[3],i[4]));return a}}],[{key:"create",value:function(){return g.getItemByClass("GraphicsBounds",v)}},{key:"_addPointArrToRst",value:function(e,t,n){for(var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=t.length,o=0;o<r;o+=2)v._addPointToRst(e,t[o]+i,t[o+1]+a,n)}},{key:"_addPointToRst",value:function(e,t,n,i){var a=L.TEMP;a.setTo(t||0,n||0),i.transformPoint(a),e.push(a.x,a.y)}}]),v}();mt._tempMatrix=new D,mt._initMatrix=new D,mt._tempPoints=[],mt._tempMatrixArrays=[],mt._tempCmds=[];var wt=function e(){S(this,e)};wt.ALPHA=1,wt.TRANSFORM=2,wt.BLEND=4,wt.CANVAS=8,wt.FILTERS=16,wt.MASK=32,wt.CLIP=64,wt.STYLE=128,wt.TEXTURE=256,wt.GRAPHICS=512,wt.LAYAGL3D=1024,wt.CUSTOM=2048,wt.ONECHILD=4096,wt.CHILDS=8192,wt.REPAINT_NONE=0,wt.REPAINT_NODE=1,wt.REPAINT_CACHE=2,wt.REPAINT_ALL=3;var xt=function(){function r(){S(this,r)}return C(r,[{key:"recover",value:function(){g.recover("ClipRectCmd",this)}},{key:"run",value:function(e,t,n){e.clipRect(this.x+t,this.y+n,this.width,this.height)}},{key:"cmdID",get:function(){return r.ID}}],[{key:"create",value:function(e,t,n,i){var a=g.getItemByClass("ClipRectCmd",r);return a.x=e,a.y=t,a.width=n,a.height=i,a}}]),r}();xt.ID="ClipRect";var kt=function(){function i(){S(this,i)}return C(i,[{key:"recover",value:function(){this.texture._removeReference(),this.texture=null,this.pos=null,g.recover("DrawTexturesCmd",this)}},{key:"run",value:function(e,t,n){e.drawTextures(this.texture,this.pos,t,n)}},{key:"cmdID",get:function(){return i.ID}}],[{key:"create",value:function(e,t){var n=g.getItemByClass("DrawTexturesCmd",i);return(n.texture=e)._addReference(),n.pos=t,n}}]),i}();kt.ID="DrawTextures";var Tt=function(){function u(){S(this,u),this._textIsWorldText=!1,this._fontColor=4294967295,this._strokeColor=0,this._fontObj=u._defFontObj,this._nTexAlign=0}return C(u,[{key:"recover",value:function(){g.recover("FillTextCmd",this)}},{key:"run",value:function(e,t,n){M.stage.isGlobalRepaint()&&this._textIsWorldText&&this._text.cleanCache(),this._words?lt._textRender.fillWords(e,this._words,this.x+t,this.y+n,this._fontObj,this._color,this._borderColor,this._lineWidth):this._textIsWorldText?e._fast_filltext(this._text,this.x+t,this.y+n,this._fontObj,this._color,this._borderColor,this._lineWidth,this._nTexAlign,0):lt._textRender.filltext(e,this._text,this.x+t,this.y+n,this.font,this.color,this._borderColor,this._lineWidth,this._textAlign)}},{key:"cmdID",get:function(){return u.ID}},{key:"text",get:function(){return this._text},set:function(e){this._text=e,this._textIsWorldText=e instanceof tt,this._textIsWorldText&&this._text.cleanCache()}},{key:"font",get:function(){return this._font},set:function(e){this._font=e,this._fontObj=et.Parse(e),this._textIsWorldText&&this._text.cleanCache()}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._fontColor=re.create(e).numColor,this._textIsWorldText&&this._text.cleanCache()}},{key:"textAlign",get:function(){return this._textAlign},set:function(e){switch(this._textAlign=e){case"center":this._nTexAlign=M.Context.ENUM_TEXTALIGN_CENTER;break;case"right":this._nTexAlign=M.Context.ENUM_TEXTALIGN_RIGHT;break;default:this._nTexAlign=M.Context.ENUM_TEXTALIGN_DEFAULT}this._textIsWorldText&&this._text.cleanCache()}}],[{key:"create",value:function(e,t,n,i,a,r,o,s,l){var h=g.getItemByClass("FillTextCmd",u);return h.text=e,h._textIsWorldText=e instanceof tt,h._words=t,h.x=n,h.y=i,h.font=a,h.color=r,h.textAlign=o,h._lineWidth=s,h._borderColor=l,h}}]),u}();Tt.ID="FillText",Tt._defFontObj=new et(null);var Et=function(){function e(){S(this,e)}return C(e,[{key:"recover",value:function(){g.recover("SaveCmd",this)}},{key:"run",value:function(e,t,n){e.save()}},{key:"cmdID",get:function(){return e.ID}}],[{key:"create",value:function(){return g.getItemByClass("SaveCmd",e)}}]),e}();Et.ID="Save";var Mt=function(){function a(){S(this,a)}return C(a,null,[{key:"regCacheByFunction",value:function(e,t){a.unRegCacheByFunction(e,t),t={tryDispose:e,getCacheList:t},a._cacheList.push(t)}},{key:"unRegCacheByFunction",value:function(e,t){for(var n=a._cacheList.length,i=0;i<n;i++)if(a._cacheList[i].tryDispose==e&&a._cacheList[i].getCacheList==t)return void a._cacheList.splice(i,1)}},{key:"forceDispose",value:function(){for(var e=a._cacheList.length,t=0;t<e;t++)a._cacheList[t].tryDispose(!0)}},{key:"beginCheck",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:15e3;M.systemTimer.loop(e,null,a._checkLoop)}},{key:"stopCheck",value:function(){M.systemTimer.clear(null,a._checkLoop)}},{key:"_checkLoop",value:function(){var e=a._cacheList;if(!(e.length<1))for(var t,n=M.Browser.now(),i=t=e.length;0<t&&(e[a._index=++a._index%i].tryDispose(!1),!(M.Browser.now()-n>a.loopTimeLimit));)t--}}]),a}();Mt.loopTimeLimit=2,Mt._cacheList=[],Mt._index=0;var bt=function(){function e(){S(this,e),this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],Mt.regCacheByFunction(this.startDispose.bind(this),this.getCacheList.bind(this))}return C(e,[{key:"getId",value:function(){return this._id++}},{key:"addShape",value:function(e,t){this.shapeDic[e]=t,this.useDic[e]||(this.useDic[e]=!0)}},{key:"addLine",value:function(e,t){this.shapeLineDic[e]=t,this.shapeLineDic[e]||(this.shapeLineDic[e]=!0)}},{key:"getShape",value:function(e){this._checkKey&&null!=this.useDic[e]&&(this.useDic[e]=!0)}},{key:"deleteShape",value:function(e){this.shapeDic[e]&&(this.shapeDic[e]=null,delete this.shapeDic[e]),this.shapeLineDic[e]&&(this.shapeLineDic[e]=null,delete this.shapeLineDic[e]),null!=this.useDic[e]&&delete this.useDic[e]}},{key:"getCacheList",value:function(){var e,t=[];for(e in this.shapeDic)t.push(this.shapeDic[e]);for(e in this.shapeLineDic)t.push(this.shapeLineDic[e]);return t}},{key:"startDispose",value:function(e){for(var t in this.useDic)this.useDic[t]=!1;this._checkKey=!0}},{key:"endDispose",value:function(){if(this._checkKey){for(var e in this.useDic)this.useDic[e]||this.deleteShape(e);this._checkKey=!1}}}],[{key:"getInstance",value:function(){return e.instance=e.instance||new e}}]),e}(),St=function(){function e(){S(this,e),this._sp=null,this._one=null,this._render=this._renderEmpty,this._cmds=null,this._vectorgraphArray=null,this._graphicBounds=null,this.autoDestroy=!1,this._createData()}return C(e,[{key:"_createData",value:function(){}},{key:"_clearData",value:function(){}},{key:"_destroyData",value:function(){}},{key:"destroy",value:function(){this.clear(!0),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0,this._sp._setRenderType(0),this._sp=null),this._destroyData()}},{key:"clear",value:function(){if(!(0<arguments.length&&void 0!==arguments[0])||arguments[0]){var e=this._one;if(this._cmds){for(var t=this._cmds.length,n=0;n<t;n++)(e=this._cmds[n]).recover();this._cmds.length=0}else e&&e.recover()}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._clearData(),this._sp&&(this._sp._renderType&=~wt.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),this._repaint(),this._vectorgraphArray){for(n=0,t=this._vectorgraphArray.length;n<t;n++)bt.getInstance().deleteShape(this._vectorgraphArray[n]);this._vectorgraphArray.length=0}}},{key:"_clearBoundsCache",value:function(){this._graphicBounds&&this._graphicBounds.reset()}},{key:"_initGraphicBounds",value:function(){this._graphicBounds||(this._graphicBounds=mt.create(),this._graphicBounds._graphics=this)}},{key:"_repaint",value:function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()}},{key:"_isOnlyOne",value:function(){return!this._cmds||0===this._cmds.length}},{key:"getBounds",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this._initGraphicBounds(),this._graphicBounds.getBounds(e)}},{key:"getBoundPoints",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this._initGraphicBounds(),this._graphicBounds.getBoundPoints(e)}},{key:"drawImage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;if(!e)return null;if(i=i||e.sourceWidth,a=a||e.sourceHeight,e.getIsReady()){var r=i/e.sourceWidth,o=a/e.sourceHeight,i=e.width*r,a=e.height*o;if(i<=0||a<=0)return null;t+=e.offsetX*r,n+=e.offsetY*o}this._sp&&(this._sp._renderType|=wt.GRAPHICS,this._sp._setRenderType(this._sp._renderType));a=x.create.call(this,e,t,n,i,a);return null==this._one?(this._one=a,this._render=this._renderOneImg):this._saveToCmd(null,a),this._repaint(),a}},{key:"drawTexture",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:null,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:null,h=9<arguments.length?arguments[9]:void 0;if(!e||o<.01)return null;if(!e.getIsReady())return null;if(i=i||e.sourceWidth,a=a||e.sourceHeight,e.getIsReady()){var u=i/e.sourceWidth,d=a/e.sourceHeight,i=e.width*u,a=e.height*d;if(i<=0||a<=0)return null;t+=e.offsetX*u,n+=e.offsetY*d}this._sp&&(this._sp._renderType|=wt.GRAPHICS,this._sp._setRenderType(this._sp._renderType));h=se.create.call(this,e,t,n,i,a,r,o,s,l,h);return this._repaint(),this._saveToCmd(null,h)}},{key:"drawTextures",value:function(e,t){return e?this._saveToCmd(yt._context.drawTextures,kt.create.call(this,e,t)):null}},{key:"drawTriangles",value:function(e,t,n,i,a,r){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:null,h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:null,u=10<arguments.length&&void 0!==arguments[10]?arguments[10]:void 0;return this._saveToCmd(yt._context.drawTriangles,vt.create.call(this,e,t,n,i,a,r,o,s,l,h,u))}},{key:"fillTexture",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"repeat",o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;return e&&e.getIsReady()?this._saveToCmd(yt._context._fillTexture,le.create.call(this,e,t,n,i,a,r,o||L.EMPTY,{})):null}},{key:"_saveToCmd",value:function(e,t){return this._sp&&(this._sp._renderType|=wt.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),null==this._one?(this._one=t,this._render=this._renderOne):(this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(t)),this._repaint(),t}},{key:"clipRect",value:function(e,t,n,i){return this._saveToCmd(yt._context.clipRect,xt.create.call(this,e,t,n,i))}},{key:"fillText",value:function(e,t,n,i,a,r){return this._saveToCmd(yt._context.fillText,Tt.create.call(this,e,null,t,n,i||M.Text.defaultFontStr(),a,r,0,""))}},{key:"fillBorderText",value:function(e,t,n,i,a,r,o,s){return this._saveToCmd(yt._context.fillText,Tt.create.call(this,e,null,t,n,i||M.Text.defaultFontStr(),a,s,o,r))}},{key:"fillWords",value:function(e,t,n,i,a){return this._saveToCmd(yt._context.fillText,Tt.create.call(this,null,e,t,n,i||M.Text.defaultFontStr(),a))}},{key:"fillBorderWords",value:function(e,t,n,i,a,r,o){return this._saveToCmd(yt._context.fillText,Tt.create.call(this,null,e,t,n,i||M.Text.defaultFontStr(),a,"",o,r))}},{key:"strokeText",value:function(e,t,n,i,a,r,o){return this._saveToCmd(yt._context.fillText,Tt.create.call(this,e,null,t,n,i||M.Text.defaultFontStr(),null,o,r,a))}},{key:"alpha",value:function(e){return this._saveToCmd(yt._context.alpha,p.create.call(this,e))}},{key:"transform",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return this._saveToCmd(yt._context._transform,ce.create.call(this,e,t,n))}},{key:"rotate",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return this._saveToCmd(yt._context._rotate,ue.create.call(this,e,t,n))}},{key:"scale",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;return this._saveToCmd(yt._context._scale,de.create.call(this,e,t,n,i))}},{key:"translate",value:function(e,t){return this._saveToCmd(yt._context.translate,_e.create.call(this,e,t))}},{key:"save",value:function(){return this._saveToCmd(yt._context._save,Et.create.call(this))}},{key:"restore",value:function(){return this._saveToCmd(yt._context.restore,he.create.call(this))}},{key:"replaceText",value:function(e){this._repaint();var t=this._cmds;if(t){for(var n=t.length-1;-1<n;n--)if(this._isTextCmd(t[n]))return t[n].text=e,!0}else if(this._one&&this._isTextCmd(this._one))return this._one.text=e,!0;return!1}},{key:"_isTextCmd",value:function(e){return e.cmdID==Tt.ID}},{key:"replaceTextColor",value:function(e){this._repaint();var t=this._cmds;if(t)for(var n=t.length-1;-1<n;n--)this._isTextCmd(t[n])&&this._setTextCmdColor(t[n],e);else this._one&&this._isTextCmd(this._one)&&this._setTextCmdColor(this._one,e)}},{key:"_setTextCmdColor",value:function(e,t){e.cmdID===Tt.ID&&(e.color=t)}},{key:"loadImage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=M.Loader.getRes(e);o?o.getIsReady()?this.drawImage(o,t,n,i,a):o.once(Je.READY,this,this.drawImage,[o,t,n,i,a]):((o=new $e).load(e),M.Loader.cacheTexture(e,o),o.once(Je.READY,this,this.drawImage,[o,t,n,i,a])),null!=r&&(o.getIsReady()?r.call(this._sp):o.on(Je.READY,this._sp,r))}},{key:"_renderEmpty",value:function(e,t,n,i){}},{key:"_renderAll",value:function(e,t,n,i){for(var a=this._cmds,r=0,o=a.length;r<o;r++)a[r].run(t,n,i)}},{key:"_renderOne",value:function(e,t,n,i){t.sprite=e,this._one.run(t,n,i)}},{key:"_renderOneImg",value:function(e,t,n,i){t.sprite=e,this._one.run(t,n,i)}},{key:"drawLine",value:function(e,t,n,i,a){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,o=r<1||r%2==0?0:.5;return this._saveToCmd(yt._context._drawLine,k.create.call(this,e+o,t+o,n+o,i+o,a,r,0))}},{key:"drawLines",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1;if(!n||n.length<4)return null;var r=a<1||a%2==0?0:.5;return this._saveToCmd(yt._context._drawLines,E.create.call(this,e+r,t+r,n,i,a,0))}},{key:"drawCurves",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1;return this._saveToCmd(yt._context.drawCurves,w.create.call(this,e,t,n,i,a))}},{key:"drawRect",value:function(e,t,n,i,a){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1,s=1<=o&&r?o/2:0,l=r?o:0;return this._saveToCmd(yt._context.drawRect,A.create.call(this,e+s,t+s,n-l,i-l,a,r,o))}},{key:"drawCircle",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,o=1<=r&&a?r/2:0;return this._saveToCmd(yt._context._drawCircle,m.create.call(this,e,t,n-o,i,a,r,0))}},{key:"drawPie",value:function(e,t,n,i,a,r){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1,l=1<=s&&o?s/2:0,h=o?s:0;return this._saveToCmd(yt._context._drawPie,N.create.call(this,e+l,t+l,n-h,ae.toRadian(i),ae.toRadian(a),r,o,s,0))}},{key:"drawPoly",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,o=!1,o=!(6<n.length),s=!(1<=r&&a)||r%2==0?0:.5;return this._saveToCmd(yt._context._drawPoly,R.create.call(this,e+s,t+s,n,i,a,r,o,0))}},{key:"drawPath",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return this._saveToCmd(yt._context._drawPath,I.create.call(this,e,t,n,i,a))}},{key:"draw9Grid",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;this._saveToCmd(null,pt.create(e,t,n,i,a,r))}},{key:"cmds",get:function(){return this._cmds},set:function(e){this._sp&&(this._sp._renderType|=wt.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),this._cmds=e,this._render=this._renderAll,this._repaint()}}]),e}(),It=function e(){S(this,e)};It.NOT_ACTIVE=1,It.ACTIVE_INHIERARCHY=2,It.AWAKED=4,It.NOT_READY=8,It.DISPLAY=16,It.HAS_ZORDER=32,It.HAS_MOUSE=64,It.DISPLAYED_INSTAGE=128,It.DRAWCALL_OPTIMIZE=256;var Nt=function(){function y(){S(this,y)}return C(y,null,[{key:"__init__",value:function(){y.map[wt.ALPHA|wt.TRANSFORM|wt.GRAPHICS]=y.alpha_transform_drawLayaGL,y.map[wt.ALPHA|wt.GRAPHICS]=y.alpha_drawLayaGL,y.map[wt.TRANSFORM|wt.GRAPHICS]=y.transform_drawLayaGL,y.map[wt.TRANSFORM|wt.CHILDS]=y.transform_drawNodes,y.map[wt.ALPHA|wt.TRANSFORM|wt.TEXTURE]=y.alpha_transform_drawTexture,y.map[wt.ALPHA|wt.TEXTURE]=y.alpha_drawTexture,y.map[wt.TRANSFORM|wt.TEXTURE]=y.transform_drawTexture,y.map[wt.GRAPHICS|wt.CHILDS]=y.drawLayaGL_drawNodes}},{key:"transform_drawTexture",value:function(e,t,n,i){e._style;var a=e.texture;t.saveTransform(y.curMat),t.transformByMatrix(e.transform,n,i),t.drawTexture(a,-e.pivotX,-e.pivotY,e._width||a.width,e._height||a.height),t.restoreTransform(y.curMat)}},{key:"alpha_drawTexture",value:function(e,t,n,i){var a,r,o=e._style,s=e.texture;(.01<(a=o.alpha)||e._needRepaint())&&(r=t.globalAlpha,t.globalAlpha*=a,t.drawTexture(s,n-o.pivotX+s.offsetX,i-o.pivotY+s.offsetY,e._width||s.width,e._height||s.height),t.globalAlpha=r)}},{key:"alpha_transform_drawTexture",value:function(e,t,n,i){var a,r,o=e._style,s=e.texture;(.01<(a=o.alpha)||e._needRepaint())&&(r=t.globalAlpha,t.globalAlpha*=a,t.saveTransform(y.curMat),t.transformByMatrix(e.transform,n,i),t.drawTexture(s,-o.pivotX+s.offsetX,-o.pivotY+s.offsetY,e._width||s.width,e._height||s.height),t.restoreTransform(y.curMat),t.globalAlpha=r)}},{key:"alpha_transform_drawLayaGL",value:function(e,t,n,i){var a,r,o=e._style;(.01<(a=o.alpha)||e._needRepaint())&&(r=t.globalAlpha,t.globalAlpha*=a,t.saveTransform(y.curMat),t.transformByMatrix(e.transform,n,i),e._graphics&&e._graphics._render(e,t,-o.pivotX,-o.pivotY),t.restoreTransform(y.curMat),t.globalAlpha=r)}},{key:"alpha_drawLayaGL",value:function(e,t,n,i){var a,r,o=e._style;(.01<(a=o.alpha)||e._needRepaint())&&(r=t.globalAlpha,t.globalAlpha*=a,e._graphics&&e._graphics._render(e,t,n-o.pivotX,i-o.pivotY),t.globalAlpha=r)}},{key:"transform_drawLayaGL",value:function(e,t,n,i){var a=e._style;t.saveTransform(y.curMat),t.transformByMatrix(e.transform,n,i),e._graphics&&e._graphics._render(e,t,-a.pivotX,-a.pivotY),t.restoreTransform(y.curMat)}},{key:"transform_drawNodes",value:function(e,t,n,i){var a=e._getBit(It.DRAWCALL_OPTIMIZE)&&t.drawCallOptimize(!0),r=e._style;t.saveTransform(y.curMat),t.transformByMatrix(e.transform,n,i),n=-r.pivotX,i=-r.pivotY;var o,s=e._children,l=s.length;if(r.viewport)for(var h,u,r=r.viewport,d=r.x,c=r.y,_=r.right,f=r.bottom,g=0;g<l;++g)(o=s[g])._visible&&(h=o._x)<_&&h+o.width>d&&(u=o._y)<f&&u+o.height>c&&o.render(t,n,i);else for(var g=0;g<l;++g)(o=s[g])._visible&&o.render(t,n,i);t.restoreTransform(y.curMat),a&&t.drawCallOptimize(!1)}},{key:"drawLayaGL_drawNodes",value:function(e,t,n,i){var a=e._getBit(It.DRAWCALL_OPTIMIZE)&&t.drawCallOptimize(!0),r=e._style;n-=r.pivotX,i-=r.pivotY,e._graphics&&e._graphics._render(e,t,n,i);var o,s=e._children,l=s.length;if(r.viewport)for(var h,u,r=r.viewport,d=r.x,c=r.y,_=r.right,f=r.bottom,g=0;g<l;++g)(o=s[g])._visible&&(h=o._x)<_&&h+o.width>d&&(u=o._y)<f&&u+o.height>c&&o.render(t,n,i);else for(var g=0;g<l;++g)(o=s[g])._visible&&o.render(t,n,i);a&&t.drawCallOptimize(!1)}}]),y}();Nt.map={},Nt.curMat=new D;var Rt=function(){function _(e,t){if(S(this,_),Nt.map[e])return this._fun=Nt.map[e],void(this._next=_.NORENDER);switch(this._next=t||_.NORENDER,e){case 0:return void(this._fun=this._no);case wt.ALPHA:return void(this._fun=this._alpha);case wt.TRANSFORM:return void(this._fun=this._transform);case wt.BLEND:return void(this._fun=this._blend);case wt.CANVAS:return void(this._fun=this._canvas);case wt.MASK:return void(this._fun=this._mask);case wt.CLIP:return void(this._fun=this._clip);case wt.STYLE:return void(this._fun=this._style);case wt.GRAPHICS:return void(this._fun=this._graphics);case wt.CHILDS:return void(this._fun=this._children);case wt.CUSTOM:return void(this._fun=this._custom);case wt.TEXTURE:return void(this._fun=this._texture);case wt.FILTERS:return void(this._fun=ie._filter);case _.INIT:return void(this._fun=_._initRenderFun)}this.onCreate(e)}return C(_,[{key:"onCreate",value:function(e){}},{key:"_style",value:function(e,t,n,i){var a=e._style;null!=a.render&&a.render(e,t,n,i);a=this._next;a._fun.call(a,e,t,n,i)}},{key:"_no",value:function(e,t,n,i){}},{key:"_custom",value:function(e,t,n,i){e.customRender(t,n,i),this._next._fun.call(this._next,e,t,n-e.pivotX,i-e.pivotY)}},{key:"_clip",value:function(e,t,n,i){var a,r=this._next;r!=_.NORENDER&&(a=e._style.scrollRect,t.save(),t.clipRect(n,i,a.width,a.height),r._fun.call(r,e,t,n-a.x,i-a.y),t.restore())}},{key:"_texture",value:function(e,t,n,i){var a=e.texture;a._getSource()&&t.drawTexture(a,n-e.pivotX+a.offsetX,i-e.pivotY+a.offsetY,e._width||a.width,e._height||a.height);a=this._next;a!=_.NORENDER&&a._fun.call(a,e,t,n,i)}},{key:"_graphics",value:function(e,t,n,i){var a=e._style,r=e._graphics;r&&r._render(e,t,n-a.pivotX,i-a.pivotY);a=this._next;a!=_.NORENDER&&a._fun.call(a,e,t,n,i)}},{key:"_image",value:function(e,t,n,i){var a=e._style;t.drawTexture2(n,i,a.pivotX,a.pivotY,e.transform,e._graphics._one)}},{key:"_image2",value:function(e,t,n,i){var a=e._style;t.drawTexture2(n,i,a.pivotX,a.pivotY,e.transform,e._graphics._one)}},{key:"_alpha",value:function(e,t,n,i){var a,r;(.01<(r=e._style.alpha)||e._needRepaint())&&(a=t.globalAlpha,t.globalAlpha*=r,(r=this._next)._fun.call(r,e,t,n,i),t.globalAlpha=a)}},{key:"_transform",value:function(e,t,n,i){var a=e.transform,r=this._next;e._style;a&&r!=_.NORENDER?(t.save(),t.transform(a.a,a.b,a.c,a.d,a.tx+n,a.ty+i),r._fun.call(r,e,t,0,0),t.restore()):r!=_.NORENDER&&r._fun.call(r,e,t,n,i)}},{key:"_children",value:function(e,t,n,i){var a,r=e._style,o=e._children,s=o.length;n-=e.pivotX,i-=e.pivotY;e=e._getBit(It.DRAWCALL_OPTIMIZE)&&t.drawCallOptimize(!0);if(r.viewport)for(var l,h,r=r.viewport,u=r.x,d=r.y,c=r.right,_=r.bottom,f=0;f<s;++f)(a=o[f])._visible&&(l=a._x)<c&&l+a.width>u&&(h=a._y)<_&&h+a.height>d&&a.render(t,n,i);else for(var f=0;f<s;++f)(a=o[f])._visible&&a.render(t,n,i);e&&t.drawCallOptimize(!1)}},{key:"_canvas",value:function(e,t,n,i){var a=e._cacheStyle,r=this._next;if(a.enableCanvasRender){"bitmap"===a.cacheAs?J.canvasBitmap++:J.canvasNormal++;var o=!1,s=!1;if(a.canvas){var l=a.canvas,h=(l.context,l.touches);if(h)for(var u=0;u<h.length;u++)if(h[u].deleted){s=!0;break}o=l.isCacheValid&&!l.isCacheValid()}if(e._needRepaint()||!a.canvas||s||o||M.stage.isGlobalRepaint())if("normal"===a.cacheAs){if(t._targets)return void r._fun.call(r,e,t,n,i);this._canvas_webgl_normal_repaint(e,t)}else this._canvas_repaint(e,t,n,i);o=a.cacheRect;t.drawCanvas(a.canvas,n+o.x,i+o.y,o.width,o.height)}else r._fun.call(r,e,t,n,i)}},{key:"_canvas_repaint",value:function(e,t,n,i){var a,r=e._cacheStyle,o=this._next,s=r.canvas,l=r.cacheAs,h=r._calculateCacheRect(e,l,n,i),u=h.x,d=h.y,c=r.cacheRect,_=c.width*u,f=c.height*d,h=c.x,c=c.y;if("bitmap"===l&&(2048<_||2048<f))return console.warn("cache bitmap size larger than 2048,cache ignored"),r.releaseContext(),void o._fun.call(o,e,t,n,i);s||(r.createContext(),s=r.canvas),(i=s.context).sprite=e,s.width==_&&s.height==f||s.size(_,f),"bitmap"===l?i.asBitmap=!0:"normal"===l&&(i.asBitmap=!1),i.clear(),1!=u||1!=d?((a=i).save(),a.scale(u,d),o._fun.call(o,e,i,-h,-c),a.restore()):(a=i,o._fun.call(o,e,i,-h,-c)),e._applyFilters(),r.staticCache&&(r.reCache=!1),J.canvasReCache++}},{key:"_canvas_webgl_normal_repaint",value:function(e,t){var n=e._cacheStyle,i=this._next,a=n.canvas,r=n.cacheAs;n._calculateCacheRect(e,r,0,0);t=(a=a||(n.canvas=new Fe(t,e))).context;a.startRec(),i._fun.call(i,e,t,e.pivotX,e.pivotY),e._applyFilters(),J.canvasReCache++,a.endRec()}},{key:"_blend",value:function(e,t,n,i){var a=e._style,r=this._next;a.blendMode?(t.save(),t.globalCompositeOperation=a.blendMode,r._fun.call(r,e,t,n,i),t.restore()):r._fun.call(r,e,t,n,i)}},{key:"_mask",value:function(e,t,n,i){var a,r,o,s,l,h,u=this._next,d=e.mask,c=t;d?(c.save(),a=c.globalCompositeOperation,(r=new O).copyFrom(d.getBounds()),r.width=Math.round(r.width),r.height=Math.round(r.height),r.x=Math.round(r.x),r.y=Math.round(r.y),0<r.width&&0<r.height&&(o=r.width,s=r.height,l=Z.getRT(o,s),c.breakNextMerge(),c.pushRT(),c.addRenderObject(ne.create([c,l,o,s],_.tmpTarget,this)),d.render(c,-r.x,-r.y),c.breakNextMerge(),c.popRT(),c.save(),c.clipRect(n+r.x-e.getStyle().pivotX,i+r.y-e.getStyle().pivotY,o,s),u._fun.call(u,e,c,n,i),c.restore(),a=c.globalCompositeOperation,c.addRenderObject(ne.create(["mask"],_.setBlendMode,this)),h=ee.create(Q.TEXTURE2D,0),d=$e.INV_UV,c.drawTarget(l,n+r.x-e.getStyle().pivotX,i+r.y-e.getStyle().pivotY,o,s,D.TEMP.identity(),h,d,6),c.addRenderObject(ne.create([l],_.recycleTarget,this)),c.addRenderObject(ne.create([a],_.setBlendMode,this))),c.restore()):u._fun.call(u,e,t,n,i)}}],[{key:"__init__",value:function(){var e,t,n;for(Nt.__init__(),n=new _(_.INIT,null),t=_.renders.length=2*wt.CHILDS,e=0;e<t;e++)_.renders[e]=n;_.renders[0]=new _(0,null)}},{key:"_initRenderFun",value:function(e,t,n,i){var a=e._renderType;(_.renders[a]=_._getTypeRender(a))._fun(e,t,n,i)}},{key:"_getTypeRender",value:function(e){if(Nt.map[e])return new _(e,null);for(var t=null,n=wt.CHILDS;0<n;)n&e&&(t=new _(n,t)),n>>=1;return t}},{key:"tmpTarget",value:function(e,t,n,i){t.start(),t.clear(0,0,0,0)}},{key:"recycleTarget",value:function(e){Z.releaseRT(e)}},{key:"setBlendMode",value:function(e){var t=y.mainContext;K.targetFns[K.TOINT[e]](t)}}]),_}();Rt.INIT=69905,Rt.renders=[],Rt.NORENDER=new Rt(0,null),Rt.tempUV=new Array(8);var Ct=function(){T(i,v);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return S(this,i),(e=n.call(this))._source=t?at.createElement("canvas"):u(e),e.lock=!0,e}return C(i,[{key:"_getSource",value:function(){return this._source}},{key:"clear",value:function(){this._ctx&&this._ctx.clear&&this._ctx.clear(),this._texture&&(this._texture.destroy(),this._texture=null)}},{key:"destroy",value:function(){G(z(i.prototype),"destroy",this).call(this),this._setCPUMemory(0),this._ctx&&this._ctx.destroy&&this._ctx.destroy(),this._ctx=null}},{key:"release",value:function(){}},{key:"_setContext",value:function(e){this._ctx=e}},{key:"getContext",value:function(e){return this.context}},{key:"getMemSize",value:function(){return 0}},{key:"size",value:function(e,t){this._width==e&&this._height==t&&(!this._source||this._source.width==e&&this._source.height==t)||(this._width=e,this._height=t,this._setCPUMemory(e*t*4),this._ctx&&this._ctx.size&&this._ctx.size(e,t),this._source&&(this._source.height=t,this._source.width=e),this._texture&&(this._texture.destroy(),this._texture=null))}},{key:"getTexture",value:function(){var e;return this._texture||((e=new X).loadImageSource(this.source),this._texture=new $e(e)),this._texture}},{key:"toBase64",value:function(e,t){if(this._source){if(M.Render.isConchApp){var n=window;if(2==n.conchConfig.threadMode)throw"native 2 thread mode use toBase64Async";var i=this._ctx._targets.sourceWidth,a=this._ctx._targets.sourceHeight,r=this._ctx._targets.getData(0,0,i,a);return n.conchToBase64FlipY?n.conchToBase64FlipY(e,t,r.buffer,i,a):n.conchToBase64(e,t,r.buffer,i,a)}return this._source.toDataURL(e,t)}return null}},{key:"toBase64Async",value:function(n,i,a){var r=this._ctx._targets.sourceWidth,o=this._ctx._targets.sourceHeight;this._ctx._targets.getDataAsync(0,0,r,o,function(e){var t=window,e=t.conchToBase64FlipY?t.conchToBase64FlipY(n,i,e.buffer,r,o):t.conchToBase64(n,i,e.buffer,r,o);a(e)})}},{key:"source",get:function(){return this._source}},{key:"context",get:function(){return this._ctx||(this._source==this?this._ctx=new M.Context:this._ctx=this._source.getContext(M.Render.isConchApp?"layagl":"2d"),(this._ctx._canvas=this)._ctx)}}]),i}(),At=function(){function d(){S(this,d)}return C(d,[{key:"contains",value:function(e,t){return!!d._isHitGraphic(e,t,this.hit)&&!d._isHitGraphic(e,t,this.unHit)}},{key:"hit",get:function(){return this._hit||(this._hit=new M.Graphics),this._hit},set:function(e){this._hit=e}},{key:"unHit",get:function(){return this._unHit||(this._unHit=new M.Graphics),this._unHit},set:function(e){this._unHit=e}}],[{key:"_isHitGraphic",value:function(e,t,n){if(!n)return!1;var i,a,r,o=n.cmds;if(!o&&n._one&&((o=d._cmds).length=1,o[0]=n._one),!o)return!1;for(a=o.length,i=0;i<a;i++)if(r=o[i],r&&("Translate"===r.cmdID&&(e-=r.tx,t-=r.ty),d._isHitCmd(e,t,r)))return!0;return!1}},{key:"_isHitCmd",value:function(e,t,n){if(!n)return!1;var i=!1;switch(n.cmdID){case"DrawRect":d._rect.setTo(n.x,n.y,n.width,n.height),i=d._rect.contains(e,t);break;case"DrawCircle":i=(e-=n.x)*e+(t-=n.y)*t<n.radius*n.radius;break;case"DrawPoly":e-=n.x,t-=n.y,i=d._ptInPolygon(e,t,n.points)}return i}},{key:"_ptInPolygon",value:function(e,t,n){var i=d._ptPoint;i.setTo(e,t);for(var a=0,r=n.length,o=0;o<r;o+=2){var s,l=n[o],h=n[o+1],u=n[(o+2)%r];h!=(s=n[(o+3)%r])&&(i.y<Math.min(h,s)||i.y>=Math.max(h,s)||(i.y-h)*(u-l)/(s-h)+l>i.x&&a++)}return a%2==1}}]),d}();At._cmds=[],At._rect=new O,At._ptPoint=new L;var Dt=function(){function _(){S(this,_)}return C(_,null,[{key:"regClass",value:function(e,t){_._classMap[e]=t}},{key:"regShortClassName",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=n.name;_._classMap[i]=n}}},{key:"getRegClass",value:function(e){return _._classMap[e]}},{key:"getClass",value:function(e){var t=_._classMap[e]||_._classMap["Laya."+e]||e,n=M.Laya;return"string"==typeof t?M.__classMap[t]||n[e]:t}},{key:"getInstance",value:function(e){var t=_.getClass(e);return t?new t:(console.warn("[error] Undefined class:",e),null)}},{key:"createByJson",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=(e="string"==typeof e?JSON.parse(e):e).props;if(!t&&!(t=a?a.runWith(e):_.getInstance(r.runtime||e.type)))return null;var o=e.child;if(o)for(var s=0,l=o.length;s<l;s++){var h,u=o[s];"render"!==u.props.name&&"render"!==u.props.renderType||!t._$set_itemRender?"Graphic"==u.type?_._addGraphicsToSprite(u,t):_._isDrawType(u.type)?_._addGraphicToSprite(u,t,!0):(h=_.createByJson(u,null,n,i,a),"Script"===u.type?"owner"in h?h.owner=t:"target"in h&&(h.target=t):"mask"==u.props.renderType?t.mask=h:t.addChild(h)):t.itemRender=u}if(r)for(var d in r){var c=r[d];"var"===d&&n?n[c]=t:c instanceof Array&&t[d]instanceof Function?t[d].apply(t,c):t[d]=c}return i&&e.customProps&&i.runWith([t,e]),t.created&&t.created(),t}},{key:"_addGraphicsToSprite",value:function(e,t){var n=e.child;if(n&&!(n.length<1)){var i,a,r=_._getGraphicsFromSprite(e,t),o=0,t=0;for(e.props&&(o=_._getObjVar(e.props,"x",0),t=_._getObjVar(e.props,"y",0)),0!=o&&0!=t&&r.translate(o,t),a=n.length,i=0;i<a;i++)_._addGraphicToGraphics(n[i],r);0!=o&&0!=t&&r.translate(-o,-t)}}},{key:"_addGraphicToSprite",value:function(e,t){t=2<arguments.length&&void 0!==arguments[2]&&arguments[2]?_._getGraphicsFromSprite(e,t):t.graphics;_._addGraphicToGraphics(e,t)}},{key:"_getGraphicsFromSprite",value:function(e,t){if(!e||!e.props)return t.graphics;var n,e=e.props.renderType;return"hit"!==e&&"unHit"!==e||((n=t._style.hitArea||(t.hitArea=new At))[e]||(n[e]=new St),n=n[e]),n=n||t.graphics}},{key:"_getTransformData",value:function(e){var t;("pivotX"in e||"pivotY"in e)&&(t=t||new D).translate(-_._getObjVar(e,"pivotX",0),-_._getObjVar(e,"pivotY",0));var n=_._getObjVar(e,"scaleX",1),i=_._getObjVar(e,"scaleY",1),a=_._getObjVar(e,"rotation",0);_._getObjVar(e,"skewX",0),_._getObjVar(e,"skewY",0);return 1==n&&1==i&&0==a||((t=t||new D).scale(n,i),t.rotate(.0174532922222222*a)),t}},{key:"_addGraphicToGraphics",value:function(e,t){var n,i=e.props;!i||(n=_.DrawTypeDic[e.type])&&(e=t,t=_._getParams(i,n[1],n[2],n[3]),!(i=_._tM)&&1==_._alpha||(e.save(),i&&e.transform(i),1!=_._alpha&&e.alpha(_._alpha)),e[n[0]].apply(e,t),!i&&1==_._alpha||e.restore())}},{key:"_adptLineData",value:function(e){return e[2]=parseFloat(e[0])+parseFloat(e[2]),e[3]=parseFloat(e[1])+parseFloat(e[3]),e}},{key:"_adptTextureData",value:function(e){return e[0]=M.Loader.getRes(e[0]),e}},{key:"_adptLinesData",value:function(e){return e[2]=_._getPointListByStr(e[2]),e}},{key:"_isDrawType",value:function(e){return"Image"!==e&&e in _.DrawTypeDic}},{key:"_getParams",value:function(e,t){var n,i,a,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,s=_._temParam;for(s.length=t.length,i=t.length,n=0;n<i;n++)s[n]=_._getObjVar(e,t[n][0],t[n][1]);return _._alpha=_._getObjVar(e,"alpha",1),(a=_._getTransformData(e))?(r=r||0,a.translate(s[r],s[r+1]),s[r]=s[r+1]=0,_._tM=a):_._tM=null,s=o&&_[o]?_[o](s):s}},{key:"_getPointListByStr",value:function(e){for(var t=e.split(","),n=t.length,i=0;i<n;i++)t[i]=parseFloat(t[i]);return t}},{key:"_getObjVar",value:function(e,t,n){return t in e?e[t]:n}}]),_}();Dt.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]},Dt._temParam=[],Dt._classMap={};var Lt=function(){function e(){S(this,e)}return C(e,[{key:"reset",value:function(){return this.bounds&&this.bounds.recover(),this.userBounds&&this.userBounds.recover(),this.bounds=null,this.userBounds=null,this.temBM=null,this}},{key:"recover",value:function(){g.recover("BoundsStyle",this.reset())}}],[{key:"create",value:function(){return g.getItemByClass("BoundsStyle",e)}}]),e}(),Ot=function(){function o(){S(this,o),this.reset()}return C(o,[{key:"needBitmapCache",value:function(){return this.cacheForFilters||!!this.mask}},{key:"needEnableCanvasRender",value:function(){return"none"!=this.userSetCache||this.cacheForFilters||!!this.mask}},{key:"releaseContext",value:function(){if(this.canvas&&this.canvas.size){g.recover("CacheCanvas",this.canvas),this.canvas.size(0,0);try{this.canvas.width=0,this.canvas.height=0}catch(e){}}this.canvas=null}},{key:"createContext",value:function(){this.canvas||(this.canvas=g.getItem("CacheCanvas")||new Ct(!1),this.canvas.context||this.canvas.getContext("2d"))}},{key:"releaseFilterCache",value:function(){var e=this.filterCache;e&&(e.destroy(),e.recycle(),this.filterCache=null)}},{key:"recover",value:function(){this!==o.EMPTY&&g.recover("SpriteCache",this.reset())}},{key:"reset",value:function(){return this.releaseContext(),this.releaseFilterCache(),this.cacheAs="none",this.enableCanvasRender=!1,this.userSetCache="none",this.cacheForFilters=!1,this.staticCache=!1,this.reCache=!0,this.mask=null,this.maskParent=null,this.filterCache=null,this.filters=null,this.hasGlowFilter=!1,this.cacheRect&&this.cacheRect.recover(),this.cacheRect=null,this}},{key:"_calculateCacheRect",value:function(e,t,n,i){var a,r=e._cacheStyle;return r.cacheRect||(r.cacheRect=O.create()),"bitmap"===t?((a=e.getSelfBounds()).width=a.width+2*o.CANVAS_EXTEND_EDGE,a.height=a.height+2*o.CANVAS_EXTEND_EDGE,a.x=a.x-e.pivotX,a.y=a.y-e.pivotY,a.x=a.x-o.CANVAS_EXTEND_EDGE,a.y=a.y-o.CANVAS_EXTEND_EDGE,a.x=Math.floor(a.x+n)-n,a.y=Math.floor(a.y+i)-i,a.width=Math.floor(a.width),a.height=Math.floor(a.height),r.cacheRect.copyFrom(a)):r.cacheRect.setTo(-e._style.pivotX,-e._style.pivotY,1,1),a=r.cacheRect,e._style.scrollRect&&(e=e._style.scrollRect,a.x-=e.x,a.y-=e.y),o._scaleInfo.setTo(1,1),o._scaleInfo}}],[{key:"create",value:function(){return g.getItemByClass("SpriteCache",o)}}]),o}();Ot.EMPTY=new Ot,Ot._scaleInfo=new L,Ot.CANVAS_EXTEND_EDGE=16;var Pt=function(){function e(){S(this,e),this.reset()}return C(e,[{key:"reset",value:function(){return this.scaleX=this.scaleY=1,this.skewX=this.skewY=0,this.pivotX=this.pivotY=this.rotation=0,this.alpha=1,this.scrollRect&&this.scrollRect.recover(),this.scrollRect=null,this.viewport&&this.viewport.recover(),this.viewport=null,this.hitArea=null,this.dragging=null,this.blendMode=null,this}},{key:"recover",value:function(){this!==e.EMPTY&&g.recover("SpriteStyle",this.reset())}}],[{key:"create",value:function(){return g.getItemByClass("SpriteStyle",e)}}]),e}();Pt.EMPTY=new Pt;var Ft=function(){T(o,d);var t=b(o);function o(){var e;return S(this,o),(e=t.call(this))._bits=0,e._children=o.ARRAY_EMPTY,e._extUIChild=o.ARRAY_EMPTY,e._parent=null,e.name="",e.destroyed=!1,e.createGLBuffer(),e}return C(o,[{key:"createGLBuffer",value:function(){}},{key:"_setBit",value:function(e,t){e===It.DISPLAY&&this._getBit(e)!=t&&this._updateDisplayedInstage(),t?this._bits|=e:this._bits&=~e}},{key:"_getBit",value:function(e){return 0!=(this._bits&e)}},{key:"_setUpNoticeChain",value:function(){this._getBit(It.DISPLAY)&&this._setBitUp(It.DISPLAY)}},{key:"_setBitUp",value:function(e){var t=this;for(t._setBit(e,!0),t=t._parent;t;){if(t._getBit(e))return;t._setBit(e,!0),t=t._parent}}},{key:"on",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return e!==Je.DISPLAY&&e!==Je.UNDISPLAY||this._getBit(It.DISPLAY)||this._setBitUp(It.DISPLAY),this._createListener(e,t,n,i,!1)}},{key:"once",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return e!==Je.DISPLAY&&e!==Je.UNDISPLAY||this._getBit(It.DISPLAY)||this._setBitUp(It.DISPLAY),this._createListener(e,t,n,i,!0)}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.destroyed=!0,this._destroyAllComponent(),this._parent&&this._parent.removeChild(this),this._children&&(e?this.destroyChildren():this.removeChildren()),this.onDestroy(),this._children=null,this.offAll()}},{key:"onDestroy",value:function(){}},{key:"destroyChildren",value:function(){if(this._children)for(var e=0,t=this._children.length;e<t;e++)this._children[0].destroy(!0)}},{key:"addChild",value:function(e){return!e||this.destroyed||e===this||(e._zOrder&&this._setBit(It.HAS_ZORDER,!0),e._parent===this?(t=this.getChildIndex(e))!==this._children.length-1&&(this._children.splice(t,1),this._children.push(e),this._childChanged()):(e._parent&&e._parent.removeChild(e),this._children===o.ARRAY_EMPTY&&(this._children=[]),this._children.push(e),e._setParent(this),this._childChanged())),e;var t}},{key:"addInputChild",value:function(e){if(this._extUIChild==o.ARRAY_EMPTY)this._extUIChild=[e];else{if(0<=this._extUIChild.indexOf(e))return null;this._extUIChild.push(e)}return null}},{key:"removeInputChild",value:function(e){e=this._extUIChild.indexOf(e);0<=e&&this._extUIChild.splice(e,1)}},{key:"addChildren",value:function(){for(var e,t=0,n=arguments.length;t<n;)this.addChild((e=t++)<0||arguments.length<=e?void 0:arguments[e])}},{key:"addChildAt",value:function(e,t){if(!e||this.destroyed||e===this)return e;var n;if(e._zOrder&&this._setBit(It.HAS_ZORDER,!0),0<=t&&t<=this._children.length)return e._parent===this?(n=this.getChildIndex(e),this._children.splice(n,1),this._children.splice(t,0,e),this._childChanged()):(e._parent&&e._parent.removeChild(e),this._children===o.ARRAY_EMPTY&&(this._children=[]),this._children.splice(t,0,e),e._setParent(this)),e;throw new Error("appendChildAt:The index is out of bounds")}},{key:"getChildIndex",value:function(e){return this._children.indexOf(e)}},{key:"getChildByName",value:function(e){var t=this._children;if(t)for(var n=0,i=t.length;n<i;n++){var a=t[n];if(a.name===e)return a}return null}},{key:"getChildAt",value:function(e){return this._children[e]||null}},{key:"setChildIndex",value:function(e,t){var n=this._children;if(t<0||t>=n.length)throw new Error("setChildIndex:The index is out of bounds.");var i=this.getChildIndex(e);if(i<0)throw new Error("setChildIndex:node is must child of this object.");return n.splice(i,1),n.splice(t,0,e),this._childChanged(),e}},{key:"_childChanged",value:function(){}},{key:"removeChild",value:function(e){if(!this._children)return e;e=this._children.indexOf(e);return this.removeChildAt(e)}},{key:"removeSelf",value:function(){return this._parent&&this._parent.removeChild(this),this}},{key:"removeChildByName",value:function(e){e=this.getChildByName(e);return e&&this.removeChild(e),e}},{key:"removeChildAt",value:function(e){var t=this.getChildAt(e);return t&&(this._children.splice(e,1),t._setParent(null)),t}},{key:"removeChildren",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2147483647;if(this._children&&0<this._children.length){var n,i=this._children;0===e&&t>=i.length-1?(n=i,this._children=o.ARRAY_EMPTY):n=i.splice(e,t-e);for(var a=0,r=n.length;a<r;a++)n[a]._setParent(null)}return this}},{key:"replaceChild",value:function(e,t){var n=this._children.indexOf(t);return-1<n?(this._children.splice(n,1,e),t._setParent(null),e._setParent(this),e):null}},{key:"_setParent",value:function(e){this._parent!==e&&(e?(this._parent=e,this._onAdded(),this.event(Je.ADDED),this._getBit(It.DISPLAY)&&(this._setUpNoticeChain(),e.displayedInStage&&this._displayChild(this,!0)),e._childChanged(this)):(this._onRemoved(),this.event(Je.REMOVED),this._parent._childChanged(),this._getBit(It.DISPLAY)&&this._displayChild(this,!1),this._parent=e))}},{key:"_updateDisplayedInstage",value:function(){for(var e=this,t=M.stage,n=!1;e;){if(e._getBit(It.DISPLAY)){n=e._getBit(It.DISPLAYED_INSTAGE);break}if(e===t||e._getBit(It.DISPLAYED_INSTAGE)){n=!0;break}e=e._parent}this._setBit(It.DISPLAYED_INSTAGE,n)}},{key:"_setDisplay",value:function(e){this._getBit(It.DISPLAYED_INSTAGE)!==e&&(this._setBit(It.DISPLAYED_INSTAGE,e),e?this.event(Je.DISPLAY):this.event(Je.UNDISPLAY))}},{key:"_displayChild",value:function(e,t){var n=e._children;if(n)for(var i=0,a=n.length;i<a;i++){var r=n[i];r._getBit(It.DISPLAY)&&(0<r._children.length?this._displayChild(r,t):r._setDisplay(t))}e._setDisplay(t)}},{key:"contains",value:function(e){if(e===this)return!0;for(;e;){if(e._parent===this)return!0;e=e._parent}return!1}},{key:"timerLoop",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],r=5<arguments.length&&void 0!==arguments[5]&&arguments[5];(this.scene||M).timer.loop(e,t,n,i,a,r)}},{key:"timerOnce",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];(this.scene||M).timer._create(!1,!1,e,t,n,i,a)}},{key:"frameLoop",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];(this.scene||M).timer._create(!0,!0,e,t,n,i,a)}},{key:"frameOnce",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];(this.scene||M).timer._create(!0,!1,e,t,n,i,a)}},{key:"clearTimer",value:function(e,t){(this.scene||M).timer.clear(e,t)}},{key:"callLater",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;(this.scene||M).timer.callLater(this,e,t)}},{key:"runCallLater",value:function(e){(this.scene||M).timer.runCallLater(this,e)}},{key:"_onActive",value:function(){J.spriteCount++}},{key:"_onInActive",value:function(){J.spriteCount--}},{key:"_onActiveInScene",value:function(){}},{key:"_onInActiveInScene",value:function(){}},{key:"_parse",value:function(e,t){}},{key:"_setBelongScene",value:function(e){if(!this._scene){this._scene=e,this._onActiveInScene();for(var t=0,n=this._children.length;t<n;t++)this._children[t]._setBelongScene(e)}}},{key:"_setUnBelongScene",value:function(){if(this._scene!==this){this._onInActiveInScene(),this._scene=null;for(var e=0,t=this._children.length;e<t;e++)this._children[e]._setUnBelongScene()}}},{key:"onAwake",value:function(){}},{key:"onEnable",value:function(){}},{key:"_processActive",value:function(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._activeHierarchy(this._activeChangeScripts),this._activeScripts()}},{key:"_activeHierarchy",value:function(e){if(this._setBit(It.ACTIVE_INHIERARCHY,!0),this._components)for(var t=0,n=this._components.length;t<n;t++){var i=this._components[t];i._setActive(!0),i._isScript()&&i._enabled&&e.push(i)}for(this._onActive(),t=0,n=this._children.length;t<n;t++){var a=this._children[t];a._getBit(It.NOT_ACTIVE)||a._activeHierarchy(e)}this._getBit(It.AWAKED)||(this._setBit(It.AWAKED,!0),this.onAwake()),this.onEnable()}},{key:"_activeScripts",value:function(){for(var e=0,t=this._activeChangeScripts.length;e<t;e++)this._activeChangeScripts[e].onEnable();this._activeChangeScripts.length=0}},{key:"_processInActive",value:function(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._inActiveHierarchy(this._activeChangeScripts),this._inActiveScripts()}},{key:"_inActiveHierarchy",value:function(e){if(this._onInActive(),this._components)for(var t=0,n=this._components.length;t<n;t++){var i=this._components[t];i._setActive(!1),i._isScript()&&i._enabled&&e.push(i)}for(this._setBit(It.ACTIVE_INHIERARCHY,!1),t=0,n=this._children.length;t<n;t++){var a=this._children[t];a&&!a._getBit(It.NOT_ACTIVE)&&a._inActiveHierarchy(e)}this.onDisable()}},{key:"_inActiveScripts",value:function(){for(var e=0,t=this._activeChangeScripts.length;e<t;e++)this._activeChangeScripts[e].onDisable();this._activeChangeScripts.length=0}},{key:"onDisable",value:function(){}},{key:"_onAdded",value:function(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.";var e=this._parent.scene;e&&this._setBelongScene(e),this._parent.activeInHierarchy&&this.active&&this._processActive()}},{key:"_onRemoved",value:function(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._parent.activeInHierarchy&&this.active&&this._processInActive(),this._parent.scene&&this._setUnBelongScene()}},{key:"_addComponentInstance",value:function(e){this._components=this._components||[],this._components.push(e),e.owner=this,e._onAdded(),this.activeInHierarchy&&(e._setActive(!0),e._isScript()&&e._enabled&&e.onEnable())}},{key:"_destroyComponent",value:function(e){if(this._components)for(var t=0,n=this._components.length;t<n;t++){var i=this._components[t];if(i===e){i._destroy(),this._components.splice(t,1);break}}}},{key:"_destroyAllComponent",value:function(){if(this._components){for(var e=0,t=this._components.length;e<t;e++)this._components[e]._destroy();this._components.length=0}}},{key:"_cloneTo",value:function(e,t,n){var i=e;if(this._components)for(var a=0,r=this._components.length;a<r;a++){var o=i.addComponent(this._components[a].constructor);this._components[a]._cloneTo(o)}}},{key:"addComponentIntance",value:function(e){if(e.owner)throw"Node:the component has belong to other node.";if(e.isSingleton&&this.getComponent(e.constructor))throw"Node:the component is singleton,can't add the second one.";return this._addComponentInstance(e),e}},{key:"addComponent",value:function(e){var t=g.createByClass(e);if(t._destroyed=!1,t.isSingleton&&this.getComponent(e))throw"无法实例"+e+"组件，"+e+"组件已存在！";return this._addComponentInstance(t),t}},{key:"getComponent",value:function(e){if(this._components)for(var t=0,n=this._components.length;t<n;t++){var i=this._components[t];if(i instanceof e)return i}return null}},{key:"getComponents",value:function(e){var t;if(this._components)for(var n=0,i=this._components.length;n<i;n++){var a=this._components[n];a instanceof e&&(t=t||[]).push(a)}return t}},{key:"numChildren",get:function(){return this._children.length}},{key:"parent",get:function(){return this._parent}},{key:"displayedInStage",get:function(){return this._getBit(It.DISPLAY)||this._setBitUp(It.DISPLAY),this._getBit(It.DISPLAYED_INSTAGE)}},{key:"scene",get:function(){return this._scene}},{key:"active",get:function(){return!this._getBit(It.NOT_READY)&&!this._getBit(It.NOT_ACTIVE)},set:function(e){if(e=!!e,!this._getBit(It.NOT_ACTIVE)!==e){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw e?"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.":"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._setBit(It.NOT_ACTIVE,!e),this._parent&&this._parent.activeInHierarchy&&(e?this._processActive():this._processInActive())}}},{key:"activeInHierarchy",get:function(){return this._getBit(It.ACTIVE_INHIERARCHY)}},{key:"timer",get:function(){return(this.scene||M).timer}}]),o}();Ft.ARRAY_EMPTY=[],Dt.regClass("laya.display.Node",Ft),Dt.regClass("Laya.Node",Ft);var Bt=function(){T(h,Ft);var t=b(h);function h(){var e;return S(this,h),(e=t.call(this))._x=0,e._y=0,e._width=0,e._height=0,e._visible=!0,e._mouseState=0,e._zOrder=0,e._renderType=0,e._transform=null,e._tfChanged=!1,e._repaint=wt.REPAINT_NONE,e._texture=null,e._style=Pt.EMPTY,e._cacheStyle=Ot.EMPTY,e._boundStyle=null,e._graphics=null,e.mouseThrough=!1,e.autoSize=!1,e.hitTestPrior=!1,e}return C(h,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(h.prototype),"destroy",this).call(this,e),this._style&&this._style.recover(),this._cacheStyle&&this._cacheStyle.recover(),this._boundStyle&&this._boundStyle.recover(),this._style=null,this._cacheStyle=null,this._boundStyle=null,this._transform=null,this._graphics&&this._graphics.autoDestroy&&this._graphics.destroy(),this._graphics=null,this.texture=null}},{key:"updateZOrder",value:function(){ae.updateOrder(this._children)&&this.repaint()}},{key:"_getBoundsStyle",value:function(){return this._boundStyle||(this._boundStyle=Lt.create()),this._boundStyle}},{key:"_setCustomRender",value:function(){}},{key:"_setCacheAs",value:function(e){}},{key:"_checkCanvasEnable",value:function(){var e=this._cacheStyle.needEnableCanvasRender();(this._getCacheStyle().enableCanvasRender=e)?(this._cacheStyle.needBitmapCache()?this._cacheStyle.cacheAs="bitmap":this._cacheStyle.cacheAs=this._cacheStyle.userSetCache,this._cacheStyle.reCache=!0,this._renderType|=wt.CANVAS):(this._cacheStyle.cacheAs="none",this._cacheStyle.releaseContext(),this._renderType&=~wt.CANVAS),this._setCacheAs(this._cacheStyle.cacheAs),this._setRenderType(this._renderType)}},{key:"reCache",value:function(){this._cacheStyle.reCache=!0,this._repaint|=wt.REPAINT_CACHE}},{key:"getRepaint",value:function(){return this._repaint}},{key:"_setX",value:function(e){this._x=e}},{key:"_setY",value:function(e){this._y=e}},{key:"_setWidth",value:function(e,t){}},{key:"_setHeight",value:function(e,t){}},{key:"set_width",value:function(e){this._width!==e&&(this._width=e,this._setWidth(this.texture,e),this._setTranformChange())}},{key:"get_width",value:function(){return this.autoSize?this.texture?this.texture.width:this._graphics||0!==this._children.length?this.getSelfBounds().width:0:this._width||(this.texture?this.texture.width:0)}},{key:"set_height",value:function(e){this._height!==e&&(this._height=e,this._setHeight(this.texture,e),this._setTranformChange())}},{key:"get_height",value:function(){return this.autoSize?this.texture?this.texture.height:this._graphics||0!==this._children.length?this.getSelfBounds().height:0:this._height||(this.texture?this.texture.height:0)}},{key:"setSelfBounds",value:function(e){this._getBoundsStyle().userBounds=e}},{key:"getBounds",value:function(){return this._getBoundsStyle().bounds=O._getWrapRec(this._boundPointsToParent())}},{key:"getSelfBounds",value:function(){return this._boundStyle&&this._boundStyle.userBounds?this._boundStyle.userBounds:this._graphics||0!==this._children.length||this._texture?this._getBoundsStyle().bounds=O._getWrapRec(this._getBoundPointsM(!1)):O.TEMP.setTo(0,0,this.width,this.height)}},{key:"_boundPointsToParent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=0,n=0;this._style&&(t=this.pivotX,n=this.pivotY,e=e||0!==this._style.rotation,this._style.scrollRect&&(t+=this._style.scrollRect.x,n+=this._style.scrollRect.y));var i=this._getBoundPointsM(e);if(!i||i.length<1)return i;if(8!=i.length&&(i=e?ge.scanPList(i):O._getWrapRec(i,O.TEMP)._getBoundPoints()),!this.transform)return ae.transPointList(i,this._x-t,this._y-n),i;for(var a=L.TEMP,r=i.length,o=0;o<r;o+=2)a.x=i[o],a.y=i[o+1],this.toParentPoint(a),i[o]=a.x,i[o+1]=a.y;return i}},{key:"getGraphicBounds",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this._graphics?this._graphics.getBounds(e):O.TEMP.setTo(0,0,0,0)}},{key:"_getBoundPointsM",value:function(){var e,t,n,i,a=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds._getBoundPoints();if(this._boundStyle||this._getBoundsStyle(),this._boundStyle.temBM||(this._boundStyle.temBM=[]),this._style.scrollRect){var r=ae.clearArray(this._boundStyle.temBM),o=O.TEMP;return o.copyFrom(this._style.scrollRect),ae.concatArray(r,o._getBoundPoints()),r}this._graphics?e=this._graphics.getBoundPoints():(e=ae.clearArray(this._boundStyle.temBM),this._texture&&((o=O.TEMP).setTo(0,0,this.width||this._texture.width,this.height||this._texture.height),ae.concatArray(e,o._getBoundPoints())));for(var s=0,l=(i=this._children).length;s<l;s++)(t=i[s])instanceof h&&!0===t._visible&&(n=t._boundPointsToParent(a))&&(e=e?ae.concatArray(e,n):n);return e}},{key:"_getCacheStyle",value:function(){return this._cacheStyle===Ot.EMPTY&&(this._cacheStyle=Ot.create()),this._cacheStyle}},{key:"getStyle",value:function(){return this._style===Pt.EMPTY&&(this._style=Pt.create()),this._style}},{key:"setStyle",value:function(e){this._style=e}},{key:"_setScaleX",value:function(e){this._style.scaleX=e}},{key:"_setScaleY",value:function(e){this._style.scaleY=e}},{key:"set_scaleX",value:function(e){this.getStyle().scaleX!==e&&(this._setScaleX(e),this._setTranformChange())}},{key:"get_scaleX",value:function(){return this._style.scaleX}},{key:"set_scaleY",value:function(e){this.getStyle().scaleY!==e&&(this._setScaleY(e),this._setTranformChange())}},{key:"get_scaleY",value:function(){return this._style.scaleY}},{key:"_setRotation",value:function(e){this._style.rotation=e}},{key:"_setSkewX",value:function(e){this._style.skewX=e}},{key:"_setSkewY",value:function(e){this._style.skewY=e}},{key:"_createTransform",value:function(){return D.create()}},{key:"_adjustTransform",value:function(){this._tfChanged=!1;var e=this._style,t=e.scaleX,n=e.scaleY,i=e.skewX,a=e.skewY,r=e.rotation,o=this._transform||(this._transform=this._createTransform());return r||1!==t||1!==n||0!==i||0!==a?(o._bTransform=!0,e=.0174532922222222*(r-i),i=.0174532922222222*(r+a),r=Math.cos(i),a=Math.sin(i),i=Math.sin(e),e=Math.cos(e),o.a=t*r,o.b=t*a,o.c=-n*i,o.d=n*e,o.tx=o.ty=0):(o.identity(),this._renderType&=~wt.TRANSFORM,this._setRenderType(this._renderType)),o}},{key:"_setTransform",value:function(e){}},{key:"get_transform",value:function(){return this._tfChanged?this._adjustTransform():this._transform}},{key:"set_transform",value:function(e){this._tfChanged=!1;var t=this._transform||(this._transform=this._createTransform());e.copyTo(t),this._setTransform(t),e&&(this._x=t.tx,this._y=t.ty,t.tx=t.ty=0),e?this._renderType|=wt.TRANSFORM:this._renderType&=~wt.TRANSFORM,this._setRenderType(this._renderType),this.parentRepaint()}},{key:"_setPivotX",value:function(e){this.getStyle().pivotX=e}},{key:"_getPivotX",value:function(){return this._style.pivotX}},{key:"_setPivotY",value:function(e){this.getStyle().pivotY=e}},{key:"_getPivotY",value:function(){return this._style.pivotY}},{key:"_setAlpha",value:function(e){this._style.alpha!==e&&(1!==(this.getStyle().alpha=e)?this._renderType|=wt.ALPHA:this._renderType&=~wt.ALPHA,this._setRenderType(this._renderType),this.parentRepaint())}},{key:"_getAlpha",value:function(){return this._style.alpha}},{key:"get_visible",value:function(){return this._visible}},{key:"set_visible",value:function(e){this._visible!==e&&(this._visible=e,this.parentRepaint(wt.REPAINT_ALL))}},{key:"_setBlendMode",value:function(e){}},{key:"_setGraphics",value:function(e){}},{key:"_setGraphicsCallBack",value:function(){}},{key:"_setScrollRect",value:function(e){}},{key:"pos",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(this._x!==e||this._y!==t){if(this.destroyed)return this;n?(this._setX(e),this._setY(t),this.parentRepaint(wt.REPAINT_CACHE),(n=this._cacheStyle.maskParent)&&n.repaint(wt.REPAINT_CACHE)):(this.x=e,this.y=t)}return this}},{key:"pivot",value:function(e,t){return this.pivotX=e,this.pivotY=t,this}},{key:"size",value:function(e,t){return this.width=e,this.height=t,this}},{key:"scale",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=this.getStyle();if(i.scaleX!=e||i.scaleY!=t){if(this.destroyed)return this;n?(this._setScaleX(e),this._setScaleY(t),this._setTranformChange()):(this.scaleX=e,this.scaleY=t)}return this}},{key:"skew",value:function(e,t){return this.skewX=e,this.skewY=t,this}},{key:"render",value:function(e,t,n){Rt.renders[this._renderType]._fun(this,e,t+this._x,n+this._y),this._repaint=0}},{key:"drawToCanvas",value:function(e,t,n,i){return h.drawToCanvas(this,this._renderType,e,t,n,i)}},{key:"drawToTexture",value:function(e,t,n,i){return h.drawToTexture(this,this._renderType,e,t,n,i)}},{key:"drawToTexture3D",value:function(e,t,n){throw"not implement"}},{key:"customRender",value:function(e,t,n){this._repaint=wt.REPAINT_ALL}},{key:"_applyFilters",value:function(){}},{key:"_setColorFilter",value:function(e){}},{key:"_isHaveGlowFilter",value:function(){var e,t;if(this.filters)for(e=0;e<this.filters.length;e++)if(this.filters[e].type==ie.GLOW)return!0;for(e=0,t=this._children.length;e<t;e++)if(this._children[e]._isHaveGlowFilter())return!0;return!1}},{key:"localToGlobal",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;!0===t&&(e=new L(e.x,e.y));for(var i=this,n=n||M.stage;i&&!i.destroyed&&i!=n;)e=i.toParentPoint(e),i=i.parent;return e}},{key:"globalToLocal",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;t&&(e=new L(e.x,e.y));for(var i=this,a=[],n=n||M.stage;i&&!i.destroyed&&i!=n;)a.push(i),i=i.parent;for(var r=a.length-1;0<=r;)e=(i=a[r]).fromParentPoint(e),r--;return e}},{key:"toParentPoint",value:function(e){if(!e)return e;e.x-=this.pivotX,e.y-=this.pivotY,this.transform&&this._transform.transformPoint(e),e.x+=this._x,e.y+=this._y;var t=this._style.scrollRect;return t&&(e.x-=t.x,e.y-=t.y),e}},{key:"fromParentPoint",value:function(e){if(!e)return e;e.x-=this._x,e.y-=this._y;var t=this._style.scrollRect;return t&&(e.x+=t.x,e.y+=t.y),this.transform&&this._transform.invertTransformPoint(e),e.x+=this.pivotX,e.y+=this.pivotY,e}},{key:"fromStagePoint",value:function(e){return e}},{key:"on",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return 1!==this._mouseState&&this.isMouseEvent(e)?(this.mouseEnabled=!0,this._setBit(It.HAS_MOUSE,!0),this._parent&&this._onDisplay(),this._createListener(e,t,n,i,!1)):G(z(h.prototype),"on",this).call(this,e,t,n,i)}},{key:"once",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return 1!==this._mouseState&&this.isMouseEvent(e)?(this.mouseEnabled=!0,this._setBit(It.HAS_MOUSE,!0),this._parent&&this._onDisplay(),this._createListener(e,t,n,i,!0)):G(z(h.prototype),"once",this).call(this,e,t,n,i)}},{key:"_onDisplay",value:function(e){if(1!==this._mouseState)for(var t=(t=this).parent;t&&1!==t._mouseState&&!t._getBit(It.HAS_MOUSE);)t.mouseEnabled=!0,t._setBit(It.HAS_MOUSE,!0),t=t.parent}},{key:"_setParent",value:function(e){G(z(h.prototype),"_setParent",this).call(this,e),e&&this._getBit(It.HAS_MOUSE)&&this._onDisplay()}},{key:"loadImage",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;function i(){this.repaint(wt.REPAINT_ALL),n&&n.run()}return e?((t=M.Loader.textureMap[B.formatURL(e)])||((t=new $e).load(e),M.Loader.cacheTexture(e,t)),(this.texture=t).getIsReady()?i.call(this):t.once(Je.READY,this,i)):(this.texture=null,i.call(this)),this}},{key:"repaint",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:wt.REPAINT_CACHE;this._repaint&e||(this._repaint|=e,this.parentRepaint(e)),this._cacheStyle&&this._cacheStyle.maskParent&&this._cacheStyle.maskParent.repaint(e)}},{key:"_needRepaint",value:function(){return this._repaint&wt.REPAINT_CACHE&&this._cacheStyle.enableCanvasRender&&this._cacheStyle.reCache}},{key:"_childChanged",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this._children.length?this._renderType|=wt.CHILDS:this._renderType&=~wt.CHILDS,this._setRenderType(this._renderType),e&&this._getBit(It.HAS_ZORDER)&&M.systemTimer.callLater(this,this.updateZOrder),this.repaint(wt.REPAINT_ALL)}},{key:"parentRepaint",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:wt.REPAINT_CACHE,t=this._parent;!t||t._repaint&e||(t._repaint|=e,t.parentRepaint(e))}},{key:"_setMask",value:function(e){}},{key:"startDrag",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:300,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]&&arguments[5],o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:.92;this._style.dragging||(this.getStyle().dragging=new M.Dragging),this._style.dragging.start(this,e,t,n,i,a,r,o)}},{key:"stopDrag",value:function(){this._style.dragging&&this._style.dragging.stop()}},{key:"_setDisplay",value:function(e){e||this._cacheStyle&&(this._cacheStyle.releaseContext(),this._cacheStyle.releaseFilterCache(),this._cacheStyle.hasGlowFilter&&(this._cacheStyle.hasGlowFilter=!1)),G(z(h.prototype),"_setDisplay",this).call(this,e)}},{key:"hitTestPoint",value:function(e,t){var n=this.globalToLocal(L.TEMP.setTo(e,t));return e=n.x,t=n.y,(this._style.hitArea||(0<this._width&&0<this._height?O.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds())).contains(e,t)}},{key:"getMousePoint",value:function(){return this.globalToLocal(L.TEMP.setTo(M.stage.mouseX,M.stage.mouseY))}},{key:"_setTexture",value:function(e){}},{key:"_setRenderType",value:function(e){}},{key:"_setTranformChange",value:function(){this._tfChanged=!0,this._renderType|=wt.TRANSFORM,this.parentRepaint(wt.REPAINT_CACHE)}},{key:"_setBgStyleColor",value:function(e,t,n,i,a){}},{key:"_setBorderStyleColor",value:function(e,t,n,i,a,r){}},{key:"captureMouseEvent",value:function(e){M.MouseManager.instance.setCapture(this,e)}},{key:"releaseMouseEvent",value:function(){M.MouseManager.instance.releaseCapture()}},{key:"customRenderEnable",set:function(e){e&&(this._renderType|=wt.CUSTOM,this._setRenderType(this._renderType),this._setCustomRender())}},{key:"cacheAs",get:function(){return this._cacheStyle.cacheAs},set:function(e){e!==this._cacheStyle.userSetCache&&(this.mask&&"normal"===e||(this._setCacheAs(e),this._getCacheStyle().userSetCache=e,this._checkCanvasEnable(),this.repaint()))}},{key:"staticCache",get:function(){return this._cacheStyle.staticCache},set:function(e){(this._getCacheStyle().staticCache=e)||this.reCache()}},{key:"x",get:function(){return this._x},set:function(e){this.destroyed||this._x!==e&&(this._setX(e),this.parentRepaint(wt.REPAINT_CACHE),(e=this._cacheStyle.maskParent)&&e.repaint(wt.REPAINT_CACHE))}},{key:"y",get:function(){return this._y},set:function(e){this.destroyed||this._y!==e&&(this._setY(e),this.parentRepaint(wt.REPAINT_CACHE),(e=this._cacheStyle.maskParent)&&e.repaint(wt.REPAINT_CACHE))}},{key:"width",get:function(){return this.get_width()},set:function(e){this.set_width(e)}},{key:"height",get:function(){return this.get_height()},set:function(e){this.set_height(e)}},{key:"displayWidth",get:function(){return this.width*this.scaleX}},{key:"displayHeight",get:function(){return this.height*this.scaleY}},{key:"scaleX",get:function(){return this._style.scaleX},set:function(e){this.set_scaleX(e)}},{key:"scaleY",get:function(){return this._style.scaleY},set:function(e){this.set_scaleY(e)}},{key:"rotation",get:function(){return this._style.rotation},set:function(e){this.getStyle().rotation!==e&&(this._setRotation(e),this._setTranformChange())}},{key:"skewX",get:function(){return this._style.skewX},set:function(e){this.getStyle().skewX!==e&&(this._setSkewX(e),this._setTranformChange())}},{key:"skewY",get:function(){return this._style.skewY},set:function(e){this.getStyle().skewY!==e&&(this._setSkewY(e),this._setTranformChange())}},{key:"transform",get:function(){return this._tfChanged?this._adjustTransform():this._transform},set:function(e){this.set_transform(e)}},{key:"pivotX",get:function(){return this._getPivotX()},set:function(e){this._setPivotX(e),this.repaint()}},{key:"pivotY",get:function(){return this._getPivotY()},set:function(e){this._setPivotY(e),this.repaint()}},{key:"alpha",get:function(){return this._getAlpha()},set:function(e){e=e<0?0:1<e?1:e,this._setAlpha(e)}},{key:"visible",get:function(){return this.get_visible()},set:function(e){this.set_visible(e)}},{key:"blendMode",get:function(){return this._style.blendMode},set:function(e){this._setBlendMode(e),(this.getStyle().blendMode=e)&&"source-over"!=e?this._renderType|=wt.BLEND:this._renderType&=~wt.BLEND,this._setRenderType(this._renderType),this.parentRepaint()}},{key:"graphics",get:function(){return this._graphics||(this.graphics=new St,this._graphics.autoDestroy=!0),this._graphics},set:function(e){this._graphics&&(this._graphics._sp=null),(this._graphics=e)?(this._setGraphics(e),this._renderType|=wt.GRAPHICS,e._sp=this):this._renderType&=~wt.GRAPHICS,this._setRenderType(this._renderType),this.repaint()}},{key:"scrollRect",get:function(){return this._style.scrollRect},set:function(e){this.getStyle().scrollRect=e,this._setScrollRect(e),this.repaint(),e?this._renderType|=wt.CLIP:this._renderType&=~wt.CLIP,this._setRenderType(this._renderType)}},{key:"filters",get:function(){return this._cacheStyle.filters},set:function(e){e&&0===e.length&&(e=null),this._cacheStyle.filters!=e&&(this._getCacheStyle().filters=e?e.slice():null,e&&e.length?(this._setColorFilter(e[0]),this._renderType|=wt.FILTERS):(this._setColorFilter(null),this._renderType&=~wt.FILTERS),this._setRenderType(this._renderType),e&&0<e.length?(this._getBit(It.DISPLAY)||this._setBitUp(It.DISPLAY),1==e.length&&e[0]instanceof oe||(this._getCacheStyle().cacheForFilters=!0,this._checkCanvasEnable())):this._cacheStyle.cacheForFilters&&(this._cacheStyle.cacheForFilters=!1,this._checkCanvasEnable()),this._getCacheStyle().hasGlowFilter=this._isHaveGlowFilter(),this.repaint())}},{key:"stage",get:function(){return M.stage}},{key:"hitArea",get:function(){return this._style.hitArea},set:function(e){this.getStyle().hitArea=e}},{key:"mask",get:function(){return this._cacheStyle.mask},set:function(e){e&&this.mask&&this.mask._cacheStyle.maskParent||(this._getCacheStyle().mask=e,this._setMask(e),this._checkCanvasEnable(),e?e._getCacheStyle().maskParent=this:this.mask&&(this.mask._getCacheStyle().maskParent=null),this._renderType|=wt.MASK,this._setRenderType(this._renderType),this.parentRepaint(wt.REPAINT_ALL))}},{key:"mouseEnabled",get:function(){return 1<this._mouseState},set:function(e){this._mouseState=e?2:1}},{key:"globalScaleX",get:function(){for(var e=1,t=this;t&&t!==M.stage;)e*=t.scaleX,t=t.parent;return e}},{key:"globalRotation",get:function(){for(var e=0,t=this;t&&t!==M.stage;)e+=t.rotation,t=t.parent;return e}},{key:"globalScaleY",get:function(){for(var e=1,t=this;t&&t!==M.stage;)e*=t.scaleY,t=t.parent;return e}},{key:"mouseX",get:function(){return this.getMousePoint().x}},{key:"mouseY",get:function(){return this.getMousePoint().y}},{key:"zOrder",get:function(){return this._zOrder},set:function(e){this._zOrder!=e&&(this._zOrder=e,this._parent&&(e&&this._parent._setBit(It.HAS_ZORDER,!0),M.systemTimer.callLater(this._parent,this.updateZOrder)))}},{key:"texture",get:function(){return this._texture},set:function(e){"string"==typeof e?this.loadImage(e):this._texture!=e&&(this._texture&&this._texture._removeReference(),(this._texture=e)&&e._addReference(),this._setTexture(e),this._setWidth(this._texture,this.width),this._setHeight(this._texture,this.height),e?this._renderType|=wt.TEXTURE:this._renderType&=~wt.TEXTURE,this._setRenderType(this._renderType),this.repaint())}},{key:"viewport",get:function(){return this._style.viewport},set:function(e){var t;"string"!=typeof e||3<(t=e.split(",")).length&&(e=new O(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))),this.getStyle().viewport=e}},{key:"drawCallOptimize",set:function(e){this._setBit(It.DRAWCALL_OPTIMIZE,e)},get:function(){return this._getBit(It.DRAWCALL_OPTIMIZE)}}],[{key:"drawToCanvas",value:function(e,t,n,i,a,r){a-=e.x,r-=e.y,a|=0,r|=0,n|=0,i|=0;var o=new lt;o.size(n,i),o.asBitmap=!0,o._targets.start(),o._targets.clear(0,0,0,0),Rt.renders[t]._fun(e,o,a,r),o.flush(),o._targets.end(),o._targets.restore();var s=o._targets.getData(0,0,n,i);o.destroy();for(var r=new ImageData(n,i),l=4*n,h=r.data,u=i-1,d=u*l,c=0;0<=u;u--)h.set(s.subarray(c,c+l),d),d-=l,c+=l;o=new Ct(!0);return o.size(n,i),o.getContext("2d").putImageData(r,0,0),o}},{key:"drawToTexture",value:function(e,t,n,i,a,r){a-=e.x,r-=e.y,a|=0,r|=0,n|=0,i|=0;var o=new lt;o.size(n,i),o.asBitmap=!0,o._targets.start(),o._targets.clear(0,0,0,0),Rt.renders[t]._fun(e,o,a,r),o.flush(),o._targets.end(),o._targets.restore();r=new $e(o._targets,$e.INV_UV);return o.destroy(!0),r}},{key:"fromImage",value:function(e){return(new h).loadImage(e)}}]),h}();Dt.regClass("laya.display.Sprite",Bt),Dt.regClass("Laya.Sprite",Bt);var Vt=function(){T(n,Pt);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).italic=!1,e}return C(n,[{key:"reset",value:function(){return G(z(n.prototype),"reset",this).call(this),this.italic=!1,this.align="left",this.wordWrap=!1,this.leading=0,this.padding=[0,0,0,0],this.bgColor=null,this.borderColor=null,this.asPassword=!1,this.stroke=0,this.strokeColor="#000000",this.bold=!1,this.underline=!1,this.underlineColor=null,this.currBitmapFont=null,this}},{key:"recover",value:function(){this!==n.EMPTY&&g.recover("TextStyle",this.reset())}},{key:"render",value:function(e,t,n,i){(this.bgColor||this.borderColor)&&t.drawRect(n,i,e.width,e.height,this.bgColor,this.borderColor,1)}}],[{key:"create",value:function(){return g.getItemByClass("TextStyle",n)}}]),n}();Vt.EMPTY=new Vt;var Ut=function(){T(E,Bt);var t=b(E);function E(){var e;return S(this,E),(e=t.call(this))._textWidth=0,e._textHeight=0,e._lines=[],e._lineWidths=[],e._startX=0,e._startY=0,e._charSize={},e._valign="top",e._fontSize=E.defaultFontSize,e._font=E.defaultFont,e._color="#000000",e._singleCharRender=!1,e.overflow=E.VISIBLE,e._style=Vt.EMPTY,e}return C(E,[{key:"getStyle",value:function(){return this._style===Vt.EMPTY&&(this._style=Vt.create()),this._style}},{key:"_getTextStyle",value:function(){return this._style===Vt.EMPTY&&(this._style=Vt.create()),this._style}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(E.prototype),"destroy",this).call(this,e),this._clipPoint=null,this._lines=null,this._lineWidths=null,this._words&&this._words.forEach(function(e){e.cleanCache()}),this._words=null,this._charSize=null}},{key:"_getBoundPointsM",value:function(){var e=O.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()}},{key:"getGraphicBounds",value:function(){var e=O.TEMP;return e.setTo(0,0,this.width,this.height),e}},{key:"_getCSSStyle",value:function(){return this._style}},{key:"get_text",value:function(){return this._text||""}},{key:"set_text",value:function(e){this._text!==e&&(this.lang(e+""),this.isChanged=!0,this.event(Je.CHANGE),this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}},{key:"lang",value:function(e){if(e=E.langPacks&&E.langPacks[e]?E.langPacks[e]:e,arguments.length<2)this._text=e;else{for(var t=0,n=arguments.length;t<n;t++)e=e.replace("{"+t+"}",arguments[t+1]);this._text=e}}},{key:"get_color",value:function(){return this._color}},{key:"set_color",value:function(e){this._color!=e&&(this._color=e,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}},{key:"set_bgColor",value:function(e){this._getTextStyle().bgColor=e,this._renderType|=wt.STYLE,this._setBgStyleColor(0,0,this.width,this.height,e),this._setRenderType(this._renderType),this.isChanged=!0}},{key:"get_bgColor",value:function(){return this._style.bgColor}},{key:"_getContextFont",value:function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(M.Browser.onIPhone&&E.fontFamilyMap[this.font]||this.font)}},{key:"_isPassWordMode",value:function(){var e=this._style.asPassword;return e="prompt"in this&&this.prompt==this._text?!1:e}},{key:"_getPassWordTxt",value:function(e){for(var t="",n=e.length;0<n;n--)t+="●";return t}},{key:"_renderText",value:function(){var e=this.padding,t=this._lines.length;this.overflow!=E.VISIBLE&&(t=Math.min(t,Math.floor((this.height-e[0]-e[2])/(this.leading+this._charSize.height))+1));var n=this.scrollY/(this._charSize.height+this.leading)|0,i=this.graphics;i.clear(!0);var a=this._getContextFont();M.Browser.context.font=a;var r=e[3],o="left",s=this._lines,l=this.leading+this._charSize.height,h=this._style.currBitmapFont;h&&(l=this.leading+h.getMaxHeight());var u=e[0];!h&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(o="right",r=this._width-e[1]):"center"==this.align&&(o="center",r=.5*this._width+e[3]-e[1])),0<this._height&&("middle"===(_=this._textHeight>this._height?"top":this.valign)?u=.5*(this._height-t*l)+e[0]-e[2]:"bottom"===_&&(u=this._height-t*l-e[2]));var d,c,_,f=this._style;h&&h.autoScaleSize&&(d=h.fontSize/this.fontSize),this._clipPoint&&(i.save(),h&&h.autoScaleSize?(c=this._width?this._width-e[3]-e[1]:this._textWidth,_=this._height?this._height-e[0]-e[2]:this._textHeight,c*=d,_*=d,i.clipRect(e[3],e[0],c,_)):i.clipRect(e[3],e[0],this._width?this._width-e[3]-e[1]:this._textWidth,this._height?this._height-e[0]-e[2]:this._textHeight),this.repaint());var g=f.asPassword;"prompt"in this&&this.prompt==this._text&&(g=!1);for(var y,v,p=Math.min(this._lines.length,t+n)||1,m=n;m<p;m++){var w,x=s[m];if(g)for(var k=x.length,x="",T=k;0<T;T--)x+="●";null==x&&(x=""),y=r-(this._clipPoint?this._clipPoint.x:0),v=u+l*m-(this._clipPoint?this._clipPoint.y:0),this.underline&&this._drawUnderline(o,y,v,m),h?(k=this.width,h.autoScaleSize&&(k=this.width*d),h._drawText(x,this,y,v,this.align,k)):(this._words||(this._words=[]),this._words.length>m-n?w=this._words[m-n]:(w=new tt,this._words.push(w)),w.setText(x),w.splitRender=this._singleCharRender,f.stroke?i.fillBorderText(w,y,v,a,this.color,f.strokeColor,f.stroke,o):i.fillText(w,y,v,a,this.color,o))}h&&h.autoScaleSize&&(t=1/d,this.scale(t,t)),this._clipPoint&&i.restore(),this._startX=r,this._startY=u}},{key:"_drawUnderline",value:function(e,t,n,i){var a=this._lineWidths[i];switch(e){case"center":t-=a/2;break;case"right":t-=a}n+=this._charSize.height,this._graphics.drawLine(t,n,t+a,n,this.underlineColor||this.color,1)}},{key:"typeset",value:function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);M.Render.isConchApp?window.conchTextCanvas.font=this._getContextFont():M.Browser.context.font=this._getContextFont(),this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this._parseLines(this._getPassWordTxt(this._text)):this._parseLines(this._text),this._evalTextSize(),this._checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new L(0,0)):this._clipPoint=null,this._renderText()}},{key:"_evalTextSize",value:function(){var e=Math.max.apply(this,this._lineWidths),t=this._style.currBitmapFont?this._lines.length*(this._style.currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2];e==this._textWidth&&t==this._textHeight||(this._textWidth=e,this._textHeight=t)}},{key:"_checkEnabledViewportOrNot",value:function(){return this.overflow==E.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)}},{key:"changeText",value:function(e){this._text!==e&&(this.lang(e+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())}},{key:"_parseLines",value:function(e){var t,n=this.wordWrap||this.overflow==E.HIDDEN;n&&(t=this._getWordWrapWidth());var i=this._style.currBitmapFont;i?(this._charSize.width=i.getMaxWidth(),this._charSize.height=i.getMaxHeight()):(i=null,i=(i=(M.Render.isConchApp?window.conchTextCanvas:M.Browser.context).measureText(E._testWord))||{width:100},this._charSize.width=i.width,this._charSize.height=i.height||this.fontSize);for(var a=e.replace(/\r\n/g,"\n").split("\n"),r=0,o=a.length;r<o;r++){var s=a[r];n?this._parseLine(s,t):(this._lineWidths.push(this._getTextWidth(s)),this._lines.push(s))}}},{key:"_parseLine",value:function(e,t){var n=this._lines,i=0,a=0,r=0,o=0;if((a=this._getTextWidth(e))<=t)return n.push(e),void this._lineWidths.push(a);a=this._charSize.width,0==(i=Math.floor(t/a))&&(i=1),r=a=this._getTextWidth(e.substring(0,i));for(var s=i,l=e.length;s<l;s++)if(t<(r+=a=this._getTextWidth(e.charAt(s))))if(this.wordWrap){var h,u=e.substring(o,s);if(u.charCodeAt(u.length-1)<255&&((h=/(?:\w|-)+$/.exec(u))&&(s=h.index+o,0==h.index?s+=u.length:u=e.substring(o,s))),n.push(u),this._lineWidths.push(r-a),!((o=s)+i<l)){n.push(e.substring(o,l)),this._lineWidths.push(this._getTextWidth(n[n.length-1])),o=-1;break}s+=i,r=a=this._getTextWidth(e.substring(o,s)),s--}else if(this.overflow==E.HIDDEN)return n.push(e.substring(0,s)),void this._lineWidths.push(this._getTextWidth(n[n.length-1]));this.wordWrap&&-1!=o&&(n.push(e.substring(o,l)),this._lineWidths.push(this._getTextWidth(n[n.length-1])))}},{key:"_getTextWidth",value:function(e){var t=this._style.currBitmapFont;return t?t.getTextWidth(e):(M.Render.isConchApp?window.conchTextCanvas:M.Browser.context).measureText(e).width}},{key:"_getWordWrapWidth",value:function(){var e=this.padding,t=this._style.currBitmapFont,t=t&&t.autoScaleSize?this._width*(t.fontSize/this.fontSize):this._width;return(t=(t=t<=0?this.wordWrap?100:M.Browser.width:t)<=0?100:t)-e[3]-e[1]}},{key:"getCharPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._isChanged&&M.systemTimer.runCallLater(this,this.typeset);for(var n=0,i=this._lines,a=0,r=0,o=i.length;r<o;r++){if(e<(n+=i[r].length)){var s=r;break}a=n}var l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;M.Browser.context.font=l;l=this._getTextWidth(this._text.substring(a,e));return(t||new L).setTo(this._startX+l-(this._clipPoint?this._clipPoint.x:0),this._startY+s*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))}},{key:"width",get:function(){return this._width||this.textWidth+this.padding[1]+this.padding[3]},set:function(e){e!=this._width&&(G(z(E.prototype),"set_width",this).call(this,e),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}},{key:"height",get:function(){return this._height||this.textHeight},set:function(e){e!=this._height&&(G(z(E.prototype),"set_height",this).call(this,e),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}},{key:"textWidth",get:function(){return this._isChanged&&M.systemTimer.runCallLater(this,this.typeset),this._textWidth}},{key:"textHeight",get:function(){return this._isChanged&&M.systemTimer.runCallLater(this,this.typeset),this._textHeight}},{key:"text",get:function(){return this._text||""},set:function(e){this.set_text(e)}},{key:"font",get:function(){return this._font},set:function(e){this._style.currBitmapFont&&(this._getTextStyle().currBitmapFont=null,this.scale(1,1)),E._bitmapFonts&&E._bitmapFonts[e]&&(this._getTextStyle().currBitmapFont=E._bitmapFonts[e]),this._font=e,this.isChanged=!0}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!=e&&(this._fontSize=e,this.isChanged=!0)}},{key:"bold",get:function(){return this._style.bold},set:function(e){this._getTextStyle().bold=e,this.isChanged=!0}},{key:"color",get:function(){return this._color},set:function(e){this.set_color(e)}},{key:"italic",get:function(){return this._style.italic},set:function(e){this._getTextStyle().italic=e,this.isChanged=!0}},{key:"align",get:function(){return this._style.align},set:function(e){this._getTextStyle().align=e,this.isChanged=!0}},{key:"valign",get:function(){return this._valign},set:function(e){this._valign=e,this.isChanged=!0}},{key:"wordWrap",get:function(){return this._style.wordWrap},set:function(e){this._getTextStyle().wordWrap=e,this.isChanged=!0}},{key:"leading",get:function(){return this._style.leading},set:function(e){this._getTextStyle().leading=e,this.isChanged=!0}},{key:"padding",get:function(){return this._style.padding},set:function(e){if("string"==typeof e){for(var t,n=e.split(","),i=n.length;n.length<4;)n.push(0);for(t=0;t<i;t++)n[t]=parseFloat(n[t])||0;e=n}this._getTextStyle().padding=e,this.isChanged=!0}},{key:"bgColor",get:function(){return this._style.bgColor},set:function(e){this.set_bgColor(e)}},{key:"borderColor",get:function(){return this._style.borderColor},set:function(e){this._getTextStyle().borderColor=e,this._renderType|=wt.STYLE,this._setBorderStyleColor(0,0,this.width,this.height,e,1),this._setRenderType(this._renderType),this.isChanged=!0}},{key:"stroke",get:function(){return this._style.stroke},set:function(e){this._getTextStyle().stroke=e,this.isChanged=!0}},{key:"strokeColor",get:function(){return this._style.strokeColor},set:function(e){this._getTextStyle().strokeColor=e,this.isChanged=!0}},{key:"isChanged",set:function(e){this._isChanged!==e&&(this._isChanged=e)&&M.systemTimer.callLater(this,this.typeset)}},{key:"scrollX",set:function(e){var t;this.overflow!=E.SCROLL||this.textWidth<this._width||!this._clipPoint||(e=e<this.padding[3]?this.padding[3]:e,e=(t=this._textWidth-this._width)<e?t:e,this._clipPoint.x=e,this._renderText())},get:function(){return this._clipPoint?this._clipPoint.x:0}},{key:"scrollY",set:function(e){var t;this.overflow!=E.SCROLL||this.textHeight<this._height||!this._clipPoint||(e=e<this.padding[0]?this.padding[0]:e,e=(t=this._textHeight-this._height)<e?t:e,this._clipPoint.y=e,this._renderText())},get:function(){return this._clipPoint?this._clipPoint.y:0}},{key:"maxScrollX",get:function(){return this.textWidth<this._width?0:this._textWidth-this._width}},{key:"maxScrollY",get:function(){return this.textHeight<this._height?0:this._textHeight-this._height}},{key:"lines",get:function(){return this._isChanged&&this.typeset(),this._lines}},{key:"underlineColor",get:function(){return this._style.underlineColor},set:function(e){this._getTextStyle().underlineColor=e,this._isChanged||this._renderText()}},{key:"underline",get:function(){return this._style.underline},set:function(e){this._getTextStyle().underline=e}},{key:"singleCharRender",set:function(e){this._singleCharRender=e},get:function(){return this._singleCharRender}}],[{key:"defaultFontStr",value:function(){return E.defaultFontSize+"px "+E.defaultFont}},{key:"registerBitmapFont",value:function(e,t){(E._bitmapFonts=!E._bitmapFonts?{}:E._bitmapFonts)[e]=t}},{key:"unregisterBitmapFont",value:function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];E._bitmapFonts&&E._bitmapFonts[e]&&(t=E._bitmapFonts[e],n&&t.destroy(),delete E._bitmapFonts[e])}}]),E}();Ut.VISIBLE="visible",Ut.SCROLL="scroll",Ut.HIDDEN="hidden",Ut.defaultFontSize=12,Ut.defaultFont="Arial",Ut.isComplexText=!1,Ut.fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"},Ut._testWord="游",Ut.CharacterCache=!0,Ut.RightToLeft=!1,M.regClass(Ut),Dt.regClass("laya.display.Text",Ut),Dt.regClass("Laya.Text",Ut);var zt=function(){T(a,Ut);var t=b(a);function a(){var e;return S(this,a),(e=t.call(this))._multiline=!1,e._editable=!0,e._maxChars=1e5,e._type="text",e._prompt="",e._promptColor="#A9A9A9",e._originColor="#000000",e._content="",a.IOS_IFRAME=M.Browser.onIOS&&M.Browser.window.top!=M.Browser.window.self,e._width=100,e._height=20,e.multiline=!1,e.overflow=Ut.SCROLL,e.on(Je.MOUSE_DOWN,u(e),e._onMouseDown),e.on(Je.UNDISPLAY,u(e),e._onUnDisplay),e}return C(a,[{key:"setSelection",value:function(e,t){this.focus=!0,a.inputElement.selectionStart=e,a.inputElement.selectionEnd=t}},{key:"_onUnDisplay",value:function(){this.focus=!1}},{key:"_onMouseDown",value:function(e){this.focus=!0}},{key:"_syncInputTransform",value:function(){var e=this.nativeInput,t=ae.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),n=this._width-this.padding[1]-this.padding[3],i=this._height-this.padding[0]-this.padding[2];M.Render.isConchApp?(e.setScale(t.scaleX,t.scaleY),e.setSize(n,i),e.setPos(t.x,t.y)):(a.inputContainer.style.transform=a.inputContainer.style.webkitTransform="scale("+t.scaleX+","+t.scaleY+") rotate("+M.stage.canvasDegree+"deg)",e.style.width=n+"px",e.style.height=i+"px",a.inputContainer.style.left=t.x+"px",a.inputContainer.style.top=t.y+"px")}},{key:"select",value:function(){this.nativeInput.select()}},{key:"_setInputMethod",value:function(){a.input.parentElement&&a.inputContainer.removeChild(a.input),a.area.parentElement&&a.inputContainer.removeChild(a.area),a.inputElement=this._multiline?a.area:a.input,a.inputContainer.appendChild(a.inputElement),Ut.RightToLeft&&(a.inputElement.style.direction="rtl")}},{key:"_focusIn",value:function(){a.isInputting=!0;var e=this.nativeInput;this._focus=!0;var t=e.style;t.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),e.readOnly=!this._editable,M.Render.isConchApp&&(e.setType(this._type),e.setForbidEdit(!this._editable)),e.maxLength=this._maxChars;this.padding;e.value=this._content,e.placeholder=this._prompt,M.stage.off(Je.KEY_DOWN,this,this._onKeyDown),M.stage.on(Je.KEY_DOWN,this,this._onKeyDown),(M.stage.focus=this).event(Je.FOCUS),M.Browser.onPC&&e.focus(),M.Browser.onMiniGame||M.Browser.onBDMiniGame||M.Browser.onQGMiniGame||M.Browser.onKGMiniGame||M.Browser.onVVMiniGame||M.Browser.onAlipayMiniGame||M.Browser.onQQMiniGame||(this._text,this._text=null),this.typeset(),e.setColor(this._originColor),e.setFontSize(this.fontSize),e.setFontFace(M.Browser.onIPhone&&Ut.fontFamilyMap[this.font]||this.font),M.Render.isConchApp&&e.setMultiAble&&e.setMultiAble(this._multiline),t.lineHeight=this.leading+this.fontSize+"px",t.fontStyle=this.italic?"italic":"normal",t.fontWeight=this.bold?"bold":"normal",t.textAlign=this.align,t.padding="0 0",this._syncInputTransform(),!M.Render.isConchApp&&M.Browser.onPC&&M.systemTimer.frameLoop(1,this,this._syncInputTransform)}},{key:"_setPromptColor",value:function(){a.promptStyleDOM=M.Browser.getElementById("promptStyle"),a.promptStyleDOM||(a.promptStyleDOM=M.Browser.createElement("style"),a.promptStyleDOM.setAttribute("id","promptStyle"),M.Browser.document.head.appendChild(a.promptStyleDOM)),a.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"}},{key:"_focusOut",value:function(){a.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(G(z(a.prototype),"set_text",this).call(this,this._content),G(z(a.prototype),"set_color",this).call(this,this._originColor)):(G(z(a.prototype),"set_text",this).call(this,this._prompt),G(z(a.prototype),"set_color",this).call(this,this._promptColor)),M.stage.off(Je.KEY_DOWN,this,this._onKeyDown),M.stage.focus=null,this.event(Je.BLUR),this.event(Je.CHANGE),M.Render.isConchApp&&this.nativeInput.blur(),M.Browser.onPC&&M.systemTimer.clear(this,this._syncInputTransform)}},{key:"_onKeyDown",value:function(e){13===e.keyCode&&(M.Browser.onMobile&&!this._multiline&&(this.focus=!1),this.event(Je.ENTER))}},{key:"changeText",value:function(e){this._content=e,this._focus?(this.nativeInput.value=e||"",this.event(Je.CHANGE)):G(z(a.prototype),"changeText",this).call(this,e)}},{key:"multiline",get:function(){return this._multiline},set:function(e){this._multiline=e,this.valign=e?"top":"middle"}},{key:"nativeInput",get:function(){return this._multiline?a.area:a.input}},{key:"focus",get:function(){return this._focus},set:function(e){var t=this.nativeInput;this._focus!==e&&(e?(t.target?t.target._focusOut():this._setInputMethod(),(t.target=this)._focusIn()):(t.target=null,this._focusOut(),M.Browser.document.body.scrollTop=0,t.blur(),M.Render.isConchApp?t.setPos(-1e4,-1e4):a.inputContainer.contains(t)&&a.inputContainer.removeChild(t)))}},{key:"text",set:function(e){G(z(a.prototype),"set_color",this).call(this,this._originColor),e+="",this._focus?(this.nativeInput.value=e||"",this.event(Je.CHANGE)):(this._multiline||(e=e.replace(/\r?\n/g,"")),(this._content=e)?G(z(a.prototype),"set_text",this).call(this,e):(G(z(a.prototype),"set_text",this).call(this,this._prompt),G(z(a.prototype),"set_color",this).call(this,this.promptColor)))},get:function(){return this._focus?this.nativeInput.value:this._content||""}},{key:"color",set:function(e){this._focus&&this.nativeInput.setColor(e),G(z(a.prototype),"set_color",this).call(this,this._content?e:this._promptColor),this._originColor=e},get:function(){return G(z(a.prototype),"color",this)}},{key:"bgColor",set:function(e){G(z(a.prototype),"set_bgColor",this).call(this,e),M.Render.isConchApp&&this.nativeInput.setBgColor(e)},get:function(){return G(z(a.prototype),"bgColor",this)}},{key:"restrict",get:function(){return this._restrictPattern?this._restrictPattern.source:""},set:function(e){e?(-1<(e="[^"+e+"]").indexOf("^^")&&(e=e.replace("^^","")),this._restrictPattern=new RegExp(e,"g")):this._restrictPattern=null}},{key:"editable",set:function(e){this._editable=e,M.Render.isConchApp&&a.input.setForbidEdit(!e)},get:function(){return this._editable}},{key:"maxChars",get:function(){return this._maxChars},set:function(e){e<=0&&(e=1e5),this._maxChars=e}},{key:"prompt",get:function(){return this._prompt},set:function(e){!this._text&&e&&G(z(a.prototype),"set_color",this).call(this,this._promptColor),this.promptColor=this._promptColor,this._text?G(z(a.prototype),"set_text",this).call(this,this._text==this._prompt?e:this._text):G(z(a.prototype),"set_text",this).call(this,e),this._prompt=Ut.langPacks&&Ut.langPacks[e]?Ut.langPacks[e]:e}},{key:"promptColor",get:function(){return this._promptColor},set:function(e){this._promptColor=e,this._content||G(z(a.prototype),"set_color",this).call(this,e)}},{key:"type",get:function(){return this._type},set:function(e){this._getTextStyle().asPassword="password"===e,this._type=e}}],[{key:"__init__",value:function(){var e;a._createInputElement(),M.Browser.onMobile&&(e=!1,(M.Browser.onMiniGame||M.Browser.onBDMiniGame||M.Browser.onQGMiniGame||M.Browser.onKGMiniGame||M.Browser.onVVMiniGame||M.Browser.onAlipayMiniGame||M.Browser.onQQMiniGame)&&(e=!0),M.Render.canvas.addEventListener(!a.IOS_IFRAME||e?"touchend":"click",a._popupInputMethod))}},{key:"_popupInputMethod",value:function(e){a.isInputting&&a.inputElement.focus()}},{key:"_createInputElement",value:function(){a._initInput(a.area=M.Browser.createElement("textarea")),a._initInput(a.input=M.Browser.createElement("input")),a.inputContainer=M.Browser.createElement("div"),a.inputContainer.style.position="absolute",a.inputContainer.style.zIndex=1e5,M.Browser.container.appendChild(a.inputContainer),a.inputContainer.setPos=function(e,t){a.inputContainer.style.left=e+"px",a.inputContainer.style.top=t+"px"}}},{key:"_initInput",value:function(t){var e=t.style;e.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",e.resize="none",e.backgroundColor="transparent",e.border="none",e.outline="none",e.zIndex=1,t.addEventListener("input",a._processInputting),t.addEventListener("mousemove",a._stopEvent),t.addEventListener("mousedown",a._stopEvent),t.addEventListener("touchmove",a._stopEvent),t.setFontFace=function(e){t.style.fontFamily=e},M.Render.isConchApp||(t.setColor=function(e){t.style.color=e},t.setFontSize=function(e){t.style.fontSize=e+"px"})}},{key:"_processInputting",value:function(e){var t,n=a.inputElement.target;n&&(t=a.inputElement.value,n._restrictPattern&&(t=t.replace(/\u2006|\x27/g,""),n._restrictPattern.test(t)&&(t=t.replace(n._restrictPattern,""),a.inputElement.value=t)),n._text=t,n.event(Je.INPUT))}},{key:"_stopEvent",value:function(e){"touchmove"==e.type&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}}]),a}();zt.TYPE_TEXT="text",zt.TYPE_PASSWORD="password",zt.TYPE_EMAIL="email",zt.TYPE_URL="url",zt.TYPE_NUMBER="number",zt.TYPE_RANGE="range",zt.TYPE_DATE="date",zt.TYPE_MONTH="month",zt.TYPE_WEEK="week",zt.TYPE_TIME="time",zt.TYPE_DATE_TIME="datetime",zt.TYPE_DATE_TIME_LOCAL="datetime-local",zt.TYPE_SEARCH="search",zt.IOS_IFRAME=!1,zt.inputHeight=45,zt.isInputting=!1,Dt.regClass("laya.display.Input",zt),Dt.regClass("Laya.Input",zt);var Gt=function(){function f(){S(this,f),this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._event=new Je,this._lastClickTime=0}return C(f,[{key:"_clearTempArrs",value:function(){f._oldArr.length=0,f._newArr.length=0,f._tEleArr.length=0}},{key:"getTouchFromArr",value:function(e,t){for(var n,i=t.length,a=0;a<i;a++)if((n=t[a]).id==e)return n;return null}},{key:"removeTouchFromArr",value:function(e,t){for(var n=t.length-1;0<=n;n--)t[n].id==e&&t.splice(n,1)}},{key:"createTouchO",value:function(e,t){var n=g.getItem("TouchData")||{};return n.id=t,n.tar=e,n}},{key:"onMouseDown",value:function(e,t){var n,i,a,r,o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.enable&&(a=this.getTouchFromArr(t,this.preOvers),r=this.getEles(e,null,f._tEleArr),a?a.tar=e:(n=this.createTouchO(e,t),this.preOvers.push(n)),at.onMobile&&this.sendEvents(r,Je.MOUSE_OVER),i=o?this.preDowns:this.preRightDowns,(a=this.getTouchFromArr(t,i))?a.tar=e:(n=this.createTouchO(e,t),i.push(n)),this.sendEvents(r,o?Je.MOUSE_DOWN:Je.RIGHT_MOUSE_DOWN),this._clearTempArrs())}},{key:"sendEvents",value:function(e,t){var n,i,a=e.length;for(this._event._stoped=!1,i=e[0],n=0;n<a;n++){var r=e[n];if(r.destroyed)return;if(r.event(t,this._event.setTo(t,r,i)),this._event._stoped)break}}},{key:"getEles",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;for(n?n.length=0:n=[];e&&e!=t;)n.push(e),e=e.parent;return n}},{key:"checkMouseOutAndOverOfMove",value:function(e,t){var n,i,a,r,o,s,l;if(t!=e)if(t.contains(e))l=this.getEles(e,t,f._tEleArr),this.sendEvents(l,Je.MOUSE_OVER);else if(e.contains(t))l=this.getEles(t,e,f._tEleArr),this.sendEvents(l,Je.MOUSE_OUT);else{for((l=f._tEleArr).length=0,r=this.getEles(t,null,f._oldArr),o=this.getEles(e,null,f._newArr),a=r.length,i=0;i<a;i++){if(n=r[i],0<=(s=o.indexOf(n))){o.splice(s,o.length-s);break}l.push(n)}0<l.length&&this.sendEvents(l,Je.MOUSE_OUT),0<o.length&&this.sendEvents(o,Je.MOUSE_OVER)}}},{key:"onMouseMove",value:function(e,t){var n,i;this.enable&&((i=this.getTouchFromArr(t,this.preOvers))?(this.checkMouseOutAndOverOfMove(e,i.tar),i.tar=e,n=this.getEles(e,null,f._tEleArr)):(n=this.getEles(e,null,f._tEleArr),this.sendEvents(n,Je.MOUSE_OVER),this.preOvers.push(this.createTouchO(e,t))),this.sendEvents(n,Je.MOUSE_MOVE),this._clearTempArrs())}},{key:"getLastOvers",value:function(){return(f._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,f._tEleArr):(f._tEleArr.push(M.stage),f._tEleArr)}},{key:"stageMouseOut",value:function(){var e=this.getLastOvers();this.preOvers.length=0,this.sendEvents(e,Je.MOUSE_OUT)}},{key:"onMouseUp",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(this.enable){var i,a,r,o,s,l,h,u=at.onMobile,d=this.getEles(e,null,f._tEleArr);if(this.sendEvents(d,n?Je.MOUSE_UP:Je.RIGHT_MOUSE_UP),h=n?this.preDowns:this.preRightDowns,i=this.getTouchFromArr(t,h)){var c=at.now(),_=c-this._lastClickTime<300;if(this._lastClickTime=c,e==i.tar)l=d;else for(a=this.getEles(i.tar,null,f._oldArr),(l=f._newArr).length=0,o=a.length,r=0;r<o;r++)s=a[r],0<=d.indexOf(s)&&l.push(s);0<l.length&&this.sendEvents(l,n?Je.CLICK:Je.RIGHT_CLICK),n&&_&&this.sendEvents(l,Je.DOUBLE_CLICK),this.removeTouchFromArr(t,h),i.tar=null,g.recover("TouchData",i)}else;(i=this.getTouchFromArr(t,this.preOvers))&&u&&((l=this.getEles(i.tar,null,l))&&0<l.length&&this.sendEvents(l,Je.MOUSE_OUT),this.removeTouchFromArr(t,this.preOvers),i.tar=null,g.recover("TouchData",i)),this._clearTempArrs()}}}]),f}();Gt.I=new Gt,Gt._oldArr=[],Gt._newArr=[],Gt._tEleArr=[];var Xt=function(){function s(){S(this,s),this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._event=new Je,this._captureSp=null,this._captureChain=[],this._captureExlusiveMode=!1,this._hitCaputreSp=!1,this._point=new L,this._rect=new O,this._lastMoveTimer=0,this._prePoint=new L,this._touchIDs={},this._curTouchID=NaN,this._id=1}return C(s,[{key:"__init__",value:function(e,t){this._stage=e;var n=this;t.oncontextmenu=function(e){if(s.enabled)return!1},t.addEventListener("mousedown",function(e){s.enabled&&(at.onIE||e.cancelable&&e.preventDefault(),n.mouseDownTime=at.now(),n.runEvent(e))}),t.addEventListener("mouseup",function(e){s.enabled&&(e.cancelable&&e.preventDefault(),n.mouseDownTime=-at.now(),n.runEvent(e))},!0),t.addEventListener("mousemove",function(e){var t;s.enabled&&(e.cancelable&&e.preventDefault(),(t=at.now())-n._lastMoveTimer<10||(n._lastMoveTimer=t,n.runEvent(e)))},!0),t.addEventListener("mouseout",function(e){s.enabled&&n.runEvent(e)}),t.addEventListener("mouseover",function(e){s.enabled&&n.runEvent(e)}),t.addEventListener("touchstart",function(e){s.enabled&&(s._isFirstTouch||zt.isInputting||e.cancelable&&e.preventDefault(),n.mouseDownTime=at.now(),n.runEvent(e))}),t.addEventListener("touchend",function(e){s.enabled?(s._isFirstTouch||zt.isInputting||e.cancelable&&e.preventDefault(),s._isFirstTouch=!1,n.mouseDownTime=-at.now(),n.runEvent(e)):n._curTouchID=NaN},!0),t.addEventListener("touchmove",function(e){s.enabled&&(e.cancelable&&e.preventDefault(),n.runEvent(e))},!0),t.addEventListener("touchcancel",function(e){s.enabled?(e.cancelable&&e.preventDefault(),n.runEvent(e)):n._curTouchID=NaN},!0),t.addEventListener("mousewheel",function(e){s.enabled&&n.runEvent(e)}),t.addEventListener("DOMMouseScroll",function(e){s.enabled&&n.runEvent(e)})}},{key:"initEvent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._event._stoped=!1,this._event.nativeEvent=t||e,this._target=null,this._point.setTo(e.pageX||e.clientX,e.pageY||e.clientY),this._stage._canvasTransform&&(this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y),this._event.touchId=e.identifier||0,this._tTouchID=this._event.touchId,(e=Gt.I._event)._stoped=!1,e.nativeEvent=this._event.nativeEvent,e.touchId=this._event.touchId}},{key:"checkMouseWheel",value:function(e){this._event.delta=e.wheelDelta?.025*e.wheelDelta:-e.detail;for(var t=Gt.I.getLastOvers(),n=0,i=t.length;n<i;n++){var a=t[n];a.event(Je.MOUSE_WHEEL,this._event.setTo(Je.MOUSE_WHEEL,a,this._target))}}},{key:"onMouseMove",value:function(e){Gt.I.onMouseMove(e,this._tTouchID)}},{key:"onMouseDown",value:function(e){var t,n;zt.isInputting&&M.stage.focus&&M.stage.focus.focus&&!M.stage.focus.contains(this._target)&&(t=M.stage.focus._tf||M.stage.focus,(n=e._tf||e)instanceof zt&&n.multiline==t.multiline?t._focusOut():t.focus=!1),Gt.I.onMouseDown(e,this._tTouchID,this._isLeftMouse)}},{key:"onMouseUp",value:function(e){Gt.I.onMouseUp(e,this._tTouchID,this._isLeftMouse)}},{key:"check",value:function(e,t,n,i){this._point.setTo(t,n),e.fromParentPoint(this._point),t=this._point.x,n=this._point.y;var a=e._style.scrollRect;if(a&&(this._rect.setTo(a.x,a.y,a.width,a.height),!this._rect.contains(t,n)))return!1;if(!this.disableMouseEvent){if(e.hitTestPrior&&!e.mouseThrough&&!this.hitTest(e,t,n))return!1;for(var r=e._children.length-1;-1<r;r--){var o=e._children[r];if(!o.destroyed&&1<o._mouseState&&o._visible&&this.check(o,t,n,i))return!0}for(r=e._extUIChild.length-1;0<=r;r--){var s=e._extUIChild[r];if(!s.destroyed&&1<s._mouseState&&s._visible&&this.check(s,t,n,i))return!0}}a=!(!e.hitTestPrior||e.mouseThrough||this.disableMouseEvent)||this.hitTest(e,t,n);return a?(this._target=e,i.call(this,e),this._target==this._hitCaputreSp&&(this._hitCaputreSp=!0)):i===this.onMouseUp&&e===this._stage&&(this._target=this._stage,i.call(this,this._target)),a}},{key:"hitTest",value:function(e,t,n){var i=!1;e.scrollRect&&(t-=e._style.scrollRect.x,n-=e._style.scrollRect.y);var a=e._style.hitArea;return a&&a._hit?a.contains(t,n):0<e.width&&0<e.height||e.mouseThrough||a?(e.mouseThrough?e.getGraphicBounds():a||this._rect.setTo(0,0,e.width,e.height)).contains(t,n):i}},{key:"_checkAllBaseUI",value:function(e,t,n){var i=this.handleExclusiveCapture(this.mouseX,this.mouseY,n);return!!i||(i=this.check(this._stage,this.mouseX,this.mouseY,n),this.handleCapture(this.mouseX,this.mouseY,n)||i)}},{key:"check3DUI",value:function(e,t,n){for(var i=this._stage._3dUI,a=0,r=!1;a<i.length;a++){var o=i[a];!(this._stage._curUIBase=o).destroyed&&1<o._mouseState&&o._visible&&(r=r||this.check(o,this.mouseX,this.mouseY,n))}return this._stage._curUIBase=this._stage,r}},{key:"handleExclusiveCapture",value:function(e,t,n){if(this._captureExlusiveMode&&this._captureSp&&0<this._captureChain.length){var i;this._point.setTo(e,t);for(var a=0;a<this._captureChain.length;a++)(i=this._captureChain[a]).fromParentPoint(this._point);return this._target=i,n.call(this,i),!0}return!1}},{key:"handleCapture",value:function(e,t,n){if(!this._hitCaputreSp&&this._captureSp&&0<this._captureChain.length){var i;this._point.setTo(e,t);for(var a=0;a<this._captureChain.length;a++)(i=this._captureChain[a]).fromParentPoint(this._point);return this._target=i,n.call(this,i),!0}return!1}},{key:"runEvent",value:function(e){switch("mousemove"!==e.type&&(this._prePoint.x=this._prePoint.y=-1e6),e.type){case"mousedown":this._touchIDs[0]=this._id++,s._isTouchRespond?s._isTouchRespond=!1:(this._isLeftMouse=0===e.button,this.initEvent(e),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"mouseup":this._isLeftMouse=0===e.button,this.initEvent(e),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-e.clientX)+Math.abs(this._prePoint.y-e.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=e.clientX,this._prePoint.y=e.clientY,this.initEvent(e),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"touchstart":s._isTouchRespond=!0,this._isLeftMouse=!0;for(var t=e.changedTouches,n=0,i=t.length;n<i;n++)r=t[n],(s.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=r.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[r.identifier]=this._id++,this.initEvent(r,e),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"touchend":case"touchcancel":s._isTouchRespond=!0,this._isLeftMouse=!0;var a=e.changedTouches;for(n=0,i=a.length;n<i;n++){var r=a[n];!s.multiTouchEnabled&&r.identifier!=this._curTouchID||(this._curTouchID=NaN,this.initEvent(r,e),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp)||this.onMouseUp(null))}break;case"touchmove":var o=e.changedTouches;for(n=0,i=o.length;n<i;n++)r=o[n],!s.multiTouchEnabled&&r.identifier!=this._curTouchID||(this.initEvent(r,e),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(e);break;case"mouseout":Gt.I.stageMouseOut();break;case"mouseover":this._stage.event(Je.MOUSE_OVER,this._event.setTo(Je.MOUSE_OVER,this._stage,this._stage))}}},{key:"setCapture",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this._captureSp=e,this._captureExlusiveMode=t,this._captureChain.length=0,this._captureChain.push(e);for(var n=e;n!=M.stage&&n!=M.stage._curUIBase&&(n=n.parent);)this._captureChain.splice(0,0,n)}},{key:"releaseCapture",value:function(){console.log("release capture"),this._captureSp=null}}]),s}();Xt.instance=new Xt,Xt.enabled=!0,Xt.multiTouchEnabled=!0,Xt._isFirstTouch=!0;var Ht=function(){function e(){S(this,e),this._pool=[],this._map={},this._laters=[]}return C(e,[{key:"_update",value:function(){var e=this._laters,t=e.length;if(0<t){for(var n=0,i=t-1;n<=i;n++){var a=e[n];(this._map[a.key]=null)!==a.method&&(a.run(),a.clear()),this._pool.push(a),n===i&&(i=e.length-1)}e.length=0}}},{key:"_getHandler",value:function(e,t){e=e?e.$_GID||(e.$_GID=M.Utils.getGID()):0,t=t.$_TID||(t.$_TID=M.Timer._mid++);return this._map[e+"."+t]}},{key:"callLater",value:function(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;null==this._getHandler(e,t)&&((n=this._pool.length?this._pool.pop():new Wt).caller=e,n.method=t,n.args=i,e=e?e.$_GID:0,t=t.$_TID,n.key=e+"."+t,this._map[n.key]=n,this._laters.push(n))}},{key:"runCallLater",value:function(e,t){t=this._getHandler(e,t);t&&null!=t.method&&(this._map[t.key]=null,t.run(),t.clear())}}]),e}();function Yt(){S(this,Yt)}Ht.I=new Ht;var Wt=function(){function e(){S(this,e)}return C(e,[{key:"clear",value:function(){this.caller=null,this.method=null,this.args=null}},{key:"run",value:function(){var e=this.caller;if(e&&e.destroyed)return this.clear();var t=this.method,n=this.args;null!=t&&(n?t.apply(e,n):t.call(e))}}]),e}();Yt.createShaderCondition=function(e){e="(function() {return "+e+";})";return window.Laya._runScript(e)},Yt.changeWebGLSize=function(e,t){dt.onStageResize(e,t)};var jt=function(){T(f,Bt);var r=b(f);function f(){var t;S(this,f),(t=r.call(this)).offset=new L,t._frameRate="fast",t.designWidth=0,t.designHeight=0,t.canvasRotation=!1,t.canvasDegree=0,t.renderingEnabled=!0,t.screenAdaptationEnabled=!0,t._canvasTransform=new D,t._screenMode="none",t._scaleMode="noscale",t._alignV="top",t._alignH="left",t._bgColor="black",t._mouseMoveTime=0,t._renderCount=0,t._safariOffsetY=0,t._frameStartTime=0,t._previousOrientation=at.window.orientation,t._wgColor=[0,0,0,1],t._scene3Ds=[],t._globalRepaintSet=!1,t._globalRepaintGet=!1,t._3dUI=[],t._curUIBase=null,t.useRetinalCanvas=!1,G((a=u(t),z(f.prototype)),"set_transform",a).call(a,t._createTransform()),t.mouseEnabled=!0,t.hitTestPrior=!0,t.autoSize=!1,t._setBit(It.DISPLAYED_INSTAGE,!0),t._setBit(It.ACTIVE_INHIERARCHY,!0),t._isFocused=!0,t._isVisibility=!0,t.useRetinalCanvas=ye.useRetinalCanvas;var e=at.window;e.addEventListener("focus",function(){t._isFocused=!0,t.event(Je.FOCUS),t.event(Je.FOCUS_CHANGE)}),e.addEventListener("blur",function(){t._isFocused=!1,t.event(Je.BLUR),t.event(Je.FOCUS_CHANGE),t._isInputting()&&(zt.inputElement.target.focus=!1)});var n="visibilityState",i="visibilitychange",a=e.document;return void 0!==a.hidden?(i="visibilitychange",n="visibilityState"):void 0!==a.mozHidden?(i="mozvisibilitychange",n="mozVisibilityState"):void 0!==a.msHidden?(i="msvisibilitychange",n="msVisibilityState"):void 0!==a.webkitHidden&&(i="webkitvisibilitychange",n="webkitVisibilityState"),e.document.addEventListener(i,function(){"hidden"==at.document[n]?(t._isVisibility=!1,t._isInputting()&&(zt.inputElement.target.focus=!1)):t._isVisibility=!0,t.renderingEnabled=t._isVisibility,t.event(Je.VISIBILITY_CHANGE)}),e.addEventListener("resize",function(){var e=at.window.orientation;null!=e&&e!=t._previousOrientation&&t._isInputting()&&(zt.inputElement.target.focus=!1),t._previousOrientation=e,t._isInputting()||(at.onSafari&&(t._safariOffsetY=(at.window.innerHeight||at.document.body.clientHeight||at.document.documentElement.clientHeight)-at.window.innerHeight),t._resetCanvas())}),e.addEventListener("orientationchange",function(e){t._resetCanvas()}),t.on(Je.MOUSE_MOVE,u(t),t._onmouseMove),at.onMobile&&t.on(Je.MOUSE_DOWN,u(t),t._onmouseMove),t}return C(f,[{key:"_isInputting",value:function(){return at.onMobile&&zt.isInputting}},{key:"_changeCanvasSize",value:function(){this.setScreenSize(at.clientWidth*at.pixelRatio,at.clientHeight*at.pixelRatio)}},{key:"_resetCanvas",value:function(){this.screenAdaptationEnabled&&this._changeCanvasSize()}},{key:"setScreenSize",value:function(e,t){var n=!1;this._screenMode!==f.SCREEN_NONE&&(n=(e/t<1?f.SCREEN_VERTICAL:f.SCREEN_HORIZONTAL)!==this._screenMode)&&(_=t,t=e,e=_),this.canvasRotation=n;var i=yt._mainCanvas,a=i.source.style,r=this._canvasTransform.identity(),o=this._scaleMode,s=e/this.designWidth,l=t/this.designHeight,h=this.useRetinalCanvas?e:this.designWidth,u=this.useRetinalCanvas?t:this.designHeight,d=e,c=t,_=at.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,o){case f.SCALE_NOSCALE:s=l=1,d=this.designWidth,c=this.designHeight;break;case f.SCALE_SHOWALL:s=l=Math.min(s,l),h=d=Math.round(this.designWidth*s),u=c=Math.round(this.designHeight*l);break;case f.SCALE_NOBORDER:s=l=Math.max(s,l),d=Math.round(this.designWidth*s),c=Math.round(this.designHeight*l);break;case f.SCALE_FULL:s=l=1,this._width=h=e,this._height=u=t;break;case f.SCALE_FIXED_WIDTH:l=s,this._height=u=Math.round(t/s);break;case f.SCALE_FIXED_HEIGHT:s=l,this._width=h=Math.round(e/l);break;case f.SCALE_FIXED_AUTO:e/t<this.designWidth/this.designHeight?(l=s,this._height=u=Math.round(t/s)):(s=l,this._width=h=Math.round(e/l))}this.useRetinalCanvas&&(h=e,u=t),s*=this.scaleX,l*=this.scaleY,1===s&&1===l?this.transform.identity():(this.transform.a=this._formatData(s/(d/h)),this.transform.d=this._formatData(l/(c/u))),i.size(h,u),Yt.changeWebGLSize(h,u),r.scale(d/h/_,c/u/_),this._alignH===f.ALIGN_LEFT?this.offset.x=0:this._alignH===f.ALIGN_RIGHT?this.offset.x=e-d:this.offset.x=.5*(e-d)/_,this._alignV===f.ALIGN_TOP?this.offset.y=0:this._alignV===f.ALIGN_BOTTOM?this.offset.y=t-c:this.offset.y=.5*(t-c)/_,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),r.translate(this.offset.x,this.offset.y),this._safariOffsetY&&r.translate(0,this._safariOffsetY),this.canvasDegree=0,n&&(this._screenMode===f.SCREEN_HORIZONTAL?(r.rotate(Math.PI/2),r.translate(t/_,0),this.canvasDegree=90):(r.rotate(-Math.PI/2),r.translate(0,e/_),this.canvasDegree=-90)),r.a=this._formatData(r.a),r.d=this._formatData(r.d),r.tx=this._formatData(r.tx),r.ty=this._formatData(r.ty),G(z(f.prototype),"set_transform",this).call(this,this.transform),a.transformOrigin=a.webkitTransformOrigin=a.msTransformOrigin=a.mozTransformOrigin=a.oTransformOrigin="0px 0px 0px",a.transform=a.webkitTransform=a.msTransform=a.mozTransform=a.oTransform="matrix("+r.toString()+")",this._safariOffsetY&&r.translate(0,-this._safariOffsetY),r.translate(parseInt(a.left)||0,parseInt(a.top)||0),this.visible=!0,this._repaint|=wt.REPAINT_CACHE,this.event(Je.RESIZE)}},{key:"_formatData",value:function(e){return Math.abs(e)<1e-6?0:Math.abs(1-e)<.001?0<e?1:-1:e}},{key:"getMousePoint",value:function(){return L.TEMP.setTo(this.mouseX,this.mouseY)}},{key:"repaint",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:wt.REPAINT_CACHE;this._repaint|=e}},{key:"parentRepaint",value:function(){}},{key:"_loop",value:function(){return this._globalRepaintGet=this._globalRepaintSet,this._globalRepaintSet=!1,this.render(yt._context,0,0),!0}},{key:"getFrameTm",value:function(){return this._frameStartTime}},{key:"_onmouseMove",value:function(e){this._mouseMoveTime=at.now()}},{key:"getTimeFromFrameStart",value:function(){return at.now()-this._frameStartTime}},{key:"render",value:function(e,t,n){if(window.conch)this.renderToNative(e,t,n);else{if(f._dbgSprite.graphics.clear(),this._frameRate===f.FRAME_SLEEP){var i=at.now();if(!(1e3<=i-this._frameStartTime))return;this._frameStartTime=i}else{if(!this._visible)return this._renderCount++,void(this._renderCount%5==0&&(Ht.I._update(),J.loopCount++,be.loopCount=J.loopCount,this._updateTimers()));this._frameStartTime=at.now(),be.loopStTm=this._frameStartTime}this._renderCount++;var a=(this._frameRate===f.FRAME_MOUSE?this._frameStartTime-this._mouseMoveTime<2e3?f.FRAME_FAST:f.FRAME_SLOW:this._frameRate)!==f.FRAME_SLOW,i=this._renderCount%2==0;if(J.renderSlow=!a,a||i){if(Ht.I._update(),J.loopCount++,be.loopCount=J.loopCount,this.renderingEnabled){for(var r=0,o=this._scene3Ds.length;r<o;r++)this._scene3Ds[r]._update();e.clear(),G(z(f.prototype),"render",this).call(this,e,t,n),J._StatRender.renderNotCanvas(e,t,n)}f._dbgSprite.render(e,0,0),this.renderingEnabled&&(f.clear(this._bgColor),e.flush(),bt.instance&&bt.getInstance().endDispose()),this._updateTimers()}}}},{key:"renderToNative",value:function(e,t,n){if(this._renderCount++,this._visible){if(Ht.I._update(),J.loopCount++,be.loopCount=J.loopCount,this.renderingEnabled){for(var i=0,a=this._scene3Ds.length;i<a;i++)this._scene3Ds[i]._update();e.clear(),G(z(f.prototype),"render",this).call(this,e,t,n),J._StatRender.renderNotCanvas(e,t,n)}this.renderingEnabled&&(f.clear(this._bgColor),e.flush(),bt.instance&&bt.getInstance().endDispose()),this._updateTimers()}else this._renderCount%5==0&&(Ht.I._update(),J.loopCount++,be.loopCount=J.loopCount,this._updateTimers())}},{key:"_updateTimers",value:function(){M.systemTimer._update(),M.startTimer._update(),M.physicsTimer._update(),M.updateTimer._update(),M.lateTimer._update(),M.timer._update()}},{key:"_requestFullscreen",value:function(){var e=at.document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},{key:"_fullScreenChanged",value:function(){M.stage.event(Je.FULL_SCREEN_CHANGE)}},{key:"exitFullscreen",value:function(){var e=at.document;e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}},{key:"isGlobalRepaint",value:function(){return this._globalRepaintGet}},{key:"setGlobalRepaint",value:function(){this._globalRepaintSet=!0}},{key:"add3DUI",value:function(e){e=e.rootView;0<=this._3dUI.indexOf(e)||this._3dUI.push(e)}},{key:"remove3DUI",value:function(e){e=e.rootView,e=this._3dUI.indexOf(e);return 0<=e&&(this._3dUI.splice(e,1),!0)}},{key:"width",set:function(e){this.designWidth=e,G(z(f.prototype),"set_width",this).call(this,e),M.systemTimer.callLater(this,this._changeCanvasSize)},get:function(){return G(z(f.prototype),"get_width",this).call(this)}},{key:"height",set:function(e){this.designHeight=e,G(z(f.prototype),"set_height",this).call(this,e),M.systemTimer.callLater(this,this._changeCanvasSize)},get:function(){return G(z(f.prototype),"get_height",this).call(this)}},{key:"transform",set:function(e){G(z(f.prototype),"set_transform",this).call(this,e)},get:function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||this._createTransform()}},{key:"isFocused",get:function(){return this._isFocused}},{key:"isVisibility",get:function(){return this._isVisibility}},{key:"scaleMode",get:function(){return this._scaleMode},set:function(e){this._scaleMode=e,M.systemTimer.callLater(this,this._changeCanvasSize)}},{key:"alignH",get:function(){return this._alignH},set:function(e){this._alignH=e,M.systemTimer.callLater(this,this._changeCanvasSize)}},{key:"alignV",get:function(){return this._alignV},set:function(e){this._alignV=e,M.systemTimer.callLater(this,this._changeCanvasSize)}},{key:"bgColor",get:function(){return this._bgColor},set:function(e){this._bgColor=e,this._wgColor=e?re.create(e).arrColor:null,yt.canvas.style.background=e||"none"}},{key:"mouseX",get:function(){return Math.round(Xt.instance.mouseX/this.clientScaleX)}},{key:"mouseY",get:function(){return Math.round(Xt.instance.mouseY/this.clientScaleY)}},{key:"clientScaleX",get:function(){return this._transform?this._transform.getScaleX():1}},{key:"clientScaleY",get:function(){return this._transform?this._transform.getScaleY():1}},{key:"screenMode",get:function(){return this._screenMode},set:function(e){this._screenMode=e}},{key:"visible",set:function(e){this.visible!==e&&(G(z(f.prototype),"set_visible",this).call(this,e),yt._mainCanvas.source.style.visibility=e?"visible":"hidden")},get:function(){return G(z(f.prototype),"visible",this)}},{key:"fullScreenEnabled",set:function(e){var t=at.document,n=yt.canvas;e?(n.addEventListener("mousedown",this._requestFullscreen),n.addEventListener("touchstart",this._requestFullscreen),t.addEventListener("fullscreenchange",this._fullScreenChanged),t.addEventListener("mozfullscreenchange",this._fullScreenChanged),t.addEventListener("webkitfullscreenchange",this._fullScreenChanged),t.addEventListener("msfullscreenchange",this._fullScreenChanged)):(n.removeEventListener("mousedown",this._requestFullscreen),n.removeEventListener("touchstart",this._requestFullscreen),t.removeEventListener("fullscreenchange",this._fullScreenChanged),t.removeEventListener("mozfullscreenchange",this._fullScreenChanged),t.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),t.removeEventListener("msfullscreenchange",this._fullScreenChanged))}},{key:"frameRate",get:function(){return M.Render.isConchApp?this._frameRateNative:this._frameRate},set:function(e){if(M.Render.isConchApp){var t=window.conch;switch(e){case f.FRAME_FAST:t.config.setLimitFPS(60);break;case f.FRAME_MOUSE:t.config.setMouseFrame(2e3);break;case f.FRAME_SLOW:t.config.setSlowFrame(!0);break;case f.FRAME_SLEEP:t.config.setLimitFPS(1)}this._frameRateNative=e}else this._frameRate=e}}]),f}();jt.SCALE_NOSCALE="noscale",jt.SCALE_EXACTFIT="exactfit",jt.SCALE_SHOWALL="showall",jt.SCALE_NOBORDER="noborder",jt.SCALE_FULL="full",jt.SCALE_FIXED_WIDTH="fixedwidth",jt.SCALE_FIXED_HEIGHT="fixedheight",jt.SCALE_FIXED_AUTO="fixedauto",jt.ALIGN_LEFT="left",jt.ALIGN_RIGHT="right",jt.ALIGN_CENTER="center",jt.ALIGN_TOP="top",jt.ALIGN_MIDDLE="middle",jt.ALIGN_BOTTOM="bottom",jt.SCREEN_NONE="none",jt.SCREEN_HORIZONTAL="horizontal",jt.SCREEN_VERTICAL="vertical",jt.FRAME_FAST="fast",jt.FRAME_SLOW="slow",jt.FRAME_MOUSE="mouse",jt.FRAME_SLEEP="sleep",jt._dbgSprite=new Bt,jt.clear=function(e){lt.set2DRenderConfig();var t=P.instance;j.worldScissorTest&&t.disable(t.SCISSOR_TEST);t=yt.context,e=0==t._submits._length||ye.preserveDrawingBuffer?re.create(e).arrColor:window.Laya.stage._wgColor;e?t.clearBG(e[0],e[1],e[2],e[3]):t.clearBG(0,0,0,0),j.clear()},Dt.regClass("laya.display.Stage",jt),Dt.regClass("Laya.Stage",jt);var qt=function(){function a(){S(this,a)}return C(a,null,[{key:"__init__",value:function(){a._addEvent("keydown"),a._addEvent("keypress"),a._addEvent("keyup")}},{key:"_addEvent",value:function(t){M.Browser.document.addEventListener(t,function(e){a._dispatch(e,t)},!0)}},{key:"_dispatch",value:function(e,t){if(a.enabled){a._event._stoped=!1,a._event.nativeEvent=e,a._event.keyCode=e.keyCode||e.which||e.charCode,"keydown"===t?a._pressKeys[a._event.keyCode]=!0:"keyup"===t&&(a._pressKeys[a._event.keyCode]=null);for(var n=M.stage.focus&&null!=M.stage.focus.event&&M.stage.focus.displayedInStage?M.stage.focus:M.stage,i=n;i;)i.event(t,a._event.setTo(t,i,n)),i=i.parent}}},{key:"hasKeyDown",value:function(e){return a._pressKeys[e]}}]),a}();qt._pressKeys={},qt.enabled=!0,qt._event=new Je;var Zt=function(){T(n,d);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).isStopped=!1,e}return C(n,[{key:"play",value:function(){}},{key:"stop",value:function(){this.completeHandler&&this.completeHandler.run()}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"__runComplete",value:function(e){e&&e.run()}},{key:"volume",set:function(e){},get:function(){return 1}},{key:"position",get:function(){return 0}},{key:"duration",get:function(){return 0}}]),n}(),Kt=function(){T(i,Zt);var n=b(i);function i(e){var t;return S(this,i),(t=n.call(this))._audio=null,t._onEnd=t.__onEnd.bind(u(t)),t._resumePlay=t.__resumePlay.bind(u(t)),e.addEventListener("ended",t._onEnd),t._audio=e,t}return C(i,[{key:"__onEnd",value:function(e){if(1==this.loops)return this.completeHandler&&(M.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(Je.COMPLETE);0<this.loops&&this.loops--,this.startTime=0,this.play()}},{key:"__resumePlay",value:function(){if(this._audio&&this._audio.removeEventListener("canplay",this._resumePlay),!this.isStopped)try{this._audio.currentTime=this.startTime,at.container.appendChild(this._audio),this._audio.play()}catch(e){this.event(Je.ERROR)}}},{key:"play",value:function(){this.isStopped=!1;try{this._audio.playbackRate=M.SoundManager.playbackRate,this._audio.currentTime=this.startTime}catch(e){return void this._audio.addEventListener("canplay",this._resumePlay)}M.SoundManager.addChannel(this),at.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()}},{key:"stop",value:function(){G(z(i.prototype),"stop",this).call(this),this.isStopped=!0,M.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&M.Render.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),M.Browser.onIE||this._audio!=M.AudioSound._musicAudio&&M.Pool.recover("audio:"+this.url,this._audio),at.removeElement(this._audio),this._audio=null,M.SoundManager.autoReleaseSound&&M.SoundManager.disposeSoundLater(this.url))}},{key:"pause",value:function(){this.isStopped=!0,M.SoundManager.removeChannel(this),"pause"in this._audio&&this._audio.pause(),M.SoundManager.autoReleaseSound&&M.SoundManager.disposeSoundLater(this.url)}},{key:"resume",value:function(){this._audio&&(this.isStopped=!1,M.SoundManager.addChannel(this),"play"in this._audio&&this._audio.play())}},{key:"position",get:function(){return this._audio?this._audio.currentTime:0}},{key:"duration",get:function(){return this._audio?this._audio.duration:0}},{key:"volume",set:function(e){this._audio&&(this._audio.volume=e)},get:function(){return this._audio?this._audio.volume:1}}]),i}(),Qt=function(){T(o,d);var t=b(o);function o(){var e;return S(this,o),(e=t.apply(this,arguments)).loaded=!1,e}return C(o,[{key:"dispose",value:function(){var e=o._audioCache[this.url];g.clearBySign("audio:"+this.url),e&&(yt.isConchApp||(e.src=""),delete o._audioCache[this.url])}},{key:"load",value:function(e){var t,n;function i(){r(),n.loaded=!0,n.event(Je.COMPLETE)}function a(){t.load=null,r(),n.event(Je.ERROR)}function r(){t.removeEventListener("canplaythrough",i),t.removeEventListener("error",a)}e=B.formatURL(e),(this.url=e)==M.SoundManager._bgMusic?(o._initMusicAudio(),(t=o._musicAudio).src!=e&&(o._audioCache[t.src]=null,t=null)):t=o._audioCache[e],t&&2<=t.readyState?this.event(Je.COMPLETE):(t||(t=e==M.SoundManager._bgMusic?(o._initMusicAudio(),o._musicAudio):at.createElement("audio"),(o._audioCache[e]=t).src=e),t.addEventListener("canplaythrough",i),t.addEventListener("error",a),((n=this).audio=t).load?t.load():a())}},{key:"play",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!this.url)return null;if(!(e=this.url==M.SoundManager._bgMusic?o._musicAudio:o._audioCache[this.url]))return null;i=g.getItem("audio:"+this.url),yt.isConchApp?i||((i=at.createElement("audio")).src=this.url):this.url==M.SoundManager._bgMusic?(o._initMusicAudio(),(i=o._musicAudio).src=this.url):i=i||e.cloneNode(!0);var i=new Kt(i);return i.url=this.url,i.loops=n,i.startTime=t,i.play(),M.SoundManager.addChannel(i),i}},{key:"duration",get:function(){var e=o._audioCache[this.url];return e?e.duration:0}}],[{key:"_initMusicAudio",value:function(){o._musicAudio||(o._musicAudio||(o._musicAudio=at.createElement("audio")),yt.isConchApp||at.document.addEventListener("mousedown",o._makeMusicOK))}},{key:"_makeMusicOK",value:function(){at.document.removeEventListener("mousedown",o._makeMusicOK),o._musicAudio.src?o._musicAudio.play():(o._musicAudio.src="",o._musicAudio.load())}}]),o}();Qt._audioCache={};var Jt=function(){T(i,Zt);var t=b(i);function i(){var e;return S(this,i),(e=t.call(this)).bufferSource=null,e._currentTime=0,e._volume=1,e._startTime=0,e._pauseTime=0,e.context=M.WebAudioSound.ctx,e._onPlayEnd=ae.bind(e.__onPlayEnd,u(e)),e.context.createGain?e.gain=e.context.createGain():e.gain=e.context.createGainNode(),e}return C(i,[{key:"play",value:function(){if(M.SoundManager.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){if(this.startTime>=this.duration)return stop();var e=this.context,t=this.gain,n=e.createBufferSource();(this.bufferSource=n).buffer=this.audioBuffer,n.connect(t),t&&t.disconnect(),t.connect(e.destination),n.onended=this._onPlayEnd,this._startTime=at.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,i.SetTargetDelay):this.gain.gain.value=this._volume,0==this.loops&&(n.loop=!0),n.playbackRate.setTargetAtTime?n.playbackRate.setTargetAtTime(M.SoundManager.playbackRate,this.context.currentTime,i.SetTargetDelay):n.playbackRate.value=M.SoundManager.playbackRate,n.start(0,this.startTime),this._currentTime=0}}},{key:"__onPlayEnd",value:function(){if(1==this.loops)return this.completeHandler&&(M.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(Je.COMPLETE);0<this.loops&&this.loops--,this.startTime=0,this.play()}},{key:"_clearBufferSource",value:function(){var e;this.bufferSource&&((e=this.bufferSource).stop?e.stop(0):e.noteOff(0),e.disconnect(0),e.onended=null,i._tryCleanFailed||this._tryClearBuffer(e),this.bufferSource=null)}},{key:"_tryClearBuffer",value:function(e){if(at.onMac)try{e.buffer=M.WebAudioSound._miniBuffer}catch(e){i._tryCleanFailed=!0}else try{e.buffer=null}catch(e){i._tryCleanFailed=!0}}},{key:"stop",value:function(){G(z(i.prototype),"stop",this).call(this),this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,M.SoundManager.removeChannel(this),this.completeHandler=null,M.SoundManager.autoReleaseSound&&M.SoundManager.disposeSoundLater(this.url)}},{key:"pause",value:function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,M.SoundManager.removeChannel(this),M.SoundManager.autoReleaseSound&&M.SoundManager.disposeSoundLater(this.url)}},{key:"resume",value:function(){this.startTime=this._pauseTime,this.play()}},{key:"position",get:function(){return this.bufferSource?(at.now()-this._startTime)/1e3+this.startTime:0}},{key:"duration",get:function(){return this.audioBuffer?this.audioBuffer.duration:0}},{key:"volume",set:function(e){this._volume=e,this.isStopped||(this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(e,this.context.currentTime,i.SetTargetDelay):this.gain.gain.value=e)},get:function(){return this._volume}}]),i}();Jt._tryCleanFailed=!1,Jt.SetTargetDelay=.001;var $t=function(){T(i,d);var t=b(i);function i(){var e;return S(this,i),(e=t.apply(this,arguments)).loaded=!1,e._disposed=!1,e}return C(i,[{key:"load",value:function(e){var t,n=this;e=B.formatURL(e),this.url=e,this.audioBuffer=i._dataCache[e],this.audioBuffer?this._loaded(this.audioBuffer):(i.e.on("loaded:"+e,this,this._loaded),i.e.on("err:"+e,this,this._err),i.__loadingSound[e]||(i.__loadingSound[e]=!0,(t=new XMLHttpRequest).open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){n._disposed?n._removeLoadEvents():(n.data=t.response,i.buffs.push({buffer:n.data,url:n.url}),i.decode())},t.onerror=function(e){n._err()},t.send()))}},{key:"_err",value:function(){this._removeLoadEvents(),i.__loadingSound[this.url]=!1,this.event(Je.ERROR)}},{key:"_loaded",value:function(e){this._removeLoadEvents(),this._disposed||(this.audioBuffer=e,i._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event(Je.COMPLETE))}},{key:"_removeLoadEvents",value:function(){i.e.off("loaded:"+this.url,this,this._loaded),i.e.off("err:"+this.url,this,this._err)}},{key:"__playAfterLoaded",value:function(){if(this.__toPlays){for(var e,t=this.__toPlays,n=t.length,i=0;i<n;i++)(e=t[i])[2]&&!e[2].isStopped&&this.play(e[0],e[1],e[2]);this.__toPlays.length=0}}},{key:"play",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=(n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)||new Jt;return this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([e,t,n]),this.once(Je.COMPLETE,this,this.__playAfterLoaded),this.load(this.url)),n.url=this.url,n.loops=t,n.audioBuffer=this.audioBuffer,n.startTime=e,n.play(),M.SoundManager.addChannel(n),n}},{key:"dispose",value:function(){this._disposed=!0,delete i._dataCache[this.url],delete i.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]}},{key:"duration",get:function(){return this.audioBuffer?this.audioBuffer.duration:0}}],[{key:"decode",value:function(){i.buffs.length<=0||i.isDecoding||(i.isDecoding=!0,i.tInfo=i.buffs.shift(),i.ctx.decodeAudioData(i.tInfo.buffer,i._done,i._fail))}},{key:"_done",value:function(e){i.e.event("loaded:"+i.tInfo.url,e),i.isDecoding=!1,i.decode()}},{key:"_fail",value:function(){i.e.event("err:"+i.tInfo.url,null),i.isDecoding=!1,i.decode()}},{key:"_playEmptySound",value:function(){var e;null!=i.ctx&&((e=i.ctx.createBufferSource()).buffer=i._miniBuffer,e.connect(i.ctx.destination),e.start(0,0,0))}},{key:"_unlock",value:function(){i._unlocked||(i._playEmptySound(),"running"==i.ctx.state&&(window.document.removeEventListener("mousedown",i._unlock,!0),window.document.removeEventListener("touchend",i._unlock,!0),window.document.removeEventListener("touchstart",i._unlock,!0),i._unlocked=!0))}},{key:"initWebAudio",value:function(){"running"!=i.ctx.state&&(i._unlock(),window.document.addEventListener("mousedown",i._unlock,!0),window.document.addEventListener("touchend",i._unlock,!0),window.document.addEventListener("touchstart",i._unlock,!0))}}]),i}();$t._dataCache={},$t.webAudioEnabled=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,$t.ctx=$t.webAudioEnabled?new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext):void 0,$t.buffs=[],$t.isDecoding=!1,$t._miniBuffer=$t.ctx?$t.ctx.createBuffer(1,1,22050):void 0,$t.e=new d,$t._unlocked=!1,$t.__loadingSound={};var en=function(){function s(){S(this,s)}return C(s,null,[{key:"__init__",value:function(){var e=M.Browser.window,e=!!(e.AudioContext||e.webkitAudioContext||e.mozAudioContext);return e&&$t.initWebAudio(),s._soundClass=e?$t:Qt,Qt._initMusicAudio(),s._musicClass=Qt,e}},{key:"addChannel",value:function(e){0<=s._channels.indexOf(e)||s._channels.push(e)}},{key:"removeChannel",value:function(e){for(var t=s._channels.length-1;0<=t;t--)s._channels[t]==e&&s._channels.splice(t,1)}},{key:"disposeSoundLater",value:function(e){s._lastSoundUsedTimeDic[e]=M.Browser.now(),s._isCheckingDispose||(s._isCheckingDispose=!0,M.timer.loop(5e3,null,s._checkDisposeSound))}},{key:"_checkDisposeSound",value:function(){var e,t=M.Browser.now(),n=!1;for(e in s._lastSoundUsedTimeDic)3e4<t-s._lastSoundUsedTimeDic[e]?(delete s._lastSoundUsedTimeDic[e],s.disposeSoundIfNotUsed(e)):n=!0;n||(s._isCheckingDispose=!1,M.timer.clear(null,s._checkDisposeSound))}},{key:"disposeSoundIfNotUsed",value:function(e){for(var t=s._channels.length-1;0<=t;t--)if(s._channels[t].url==e)return;s.destroySound(e)}},{key:"_visibilityChange",value:function(){M.stage.isVisibility?s._stageOnFocus():s._stageOnBlur()}},{key:"_stageOnBlur",value:function(){s._isActive=!1,s._musicChannel&&(s._musicChannel.isStopped||(s._blurPaused=!0,s._musicChannel.pause())),s.stopAllSound(),M.stage.once(Je.MOUSE_DOWN,null,s._stageOnFocus)}},{key:"_recoverWebAudio",value:function(){$t.ctx&&"running"!=$t.ctx.state&&$t.ctx.resume&&$t.ctx.resume()}},{key:"_stageOnFocus",value:function(){s._isActive=!0,s._recoverWebAudio(),M.stage.off(Je.MOUSE_DOWN,null,s._stageOnFocus),s._blurPaused&&s._musicChannel&&s._musicChannel.isStopped&&(s._blurPaused=!1,s._musicChannel.resume())}},{key:"playSound",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;if(!s._isActive||!e)return null;if(s._muted)return null;if(s._recoverWebAudio(),(e=B.formatURL(e))==s._bgMusic){if(s._musicMuted)return null}else{if(M.Render.isConchApp){var o=ae.getFileExtension(e);if("wav"!=o&&"ogg"!=o)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(s._soundMuted)return null}return M.Browser.onBDMiniGame||M.Browser.onMiniGame||M.Browser.onKGMiniGame||M.Browser.onQGMiniGame||M.Browser.onVVMiniGame||M.Browser.onAlipayMiniGame||M.Browser.onQQMiniGame||(t=M.loader.getRes(e)),a=a||s._soundClass,t||((t=new a).load(e),M.Browser.onBDMiniGame||M.Browser.onMiniGame||M.Browser.onKGMiniGame||M.Browser.onQGMiniGame||M.Browser.onVVMiniGame||M.Browser.onAlipayMiniGame||M.Browser.onQQMiniGame||M.Loader.cacheRes(e,t)),(n=t.play(r,n))?(n.url=e,n.volume=e==s._bgMusic?s.musicVolume:s.soundVolume,n.completeHandler=i,n):null}},{key:"destroySound",value:function(e){var t=M.loader.getRes(e);t&&(M.Loader.clearRes(e),t.dispose())}},{key:"playMusic",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;return e=B.formatURL(e),s._bgMusic=e,s._musicChannel&&s._musicChannel.stop(),s._musicChannel=s.playSound(e,t,n,s._musicClass,i)}},{key:"stopSound",value:function(e){var t,n;for(e=B.formatURL(e),t=s._channels.length-1;0<=t;t--)(n=s._channels[t]).url==e&&n.stop()}},{key:"stopAll",value:function(){var e;for(s._bgMusic=null,e=s._channels.length-1;0<=e;e--)s._channels[e].stop()}},{key:"stopAllSound",value:function(){for(var e,t=s._channels.length-1;0<=t;t--)(e=s._channels[t]).url!=s._bgMusic&&e.stop()}},{key:"stopMusic",value:function(){s._musicChannel&&s._musicChannel.stop(),s._bgMusic=null}},{key:"setSoundVolume",value:function(e){var t,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(i)i=B.formatURL(i),s._setVolume(i,e);else for(s.soundVolume=e,t=s._channels.length-1;0<=t;t--)(n=s._channels[t]).url!=s._bgMusic&&(n.volume=e)}},{key:"setMusicVolume",value:function(e){s.musicVolume=e,s._setVolume(s._bgMusic,e)}},{key:"_setVolume",value:function(e,t){var n,i;for(e=B.formatURL(e),n=s._channels.length-1;0<=n;n--)(i=s._channels[n]).url==e&&(i.volume=t)}},{key:"autoStopMusic",set:function(e){M.stage.off(Je.BLUR,null,s._stageOnBlur),M.stage.off(Je.FOCUS,null,s._stageOnFocus),M.stage.off(Je.VISIBILITY_CHANGE,null,s._visibilityChange),(s._autoStopMusic=e)&&(M.stage.on(Je.BLUR,null,s._stageOnBlur),M.stage.on(Je.FOCUS,null,s._stageOnFocus),M.stage.on(Je.VISIBILITY_CHANGE,null,s._visibilityChange))},get:function(){return s._autoStopMusic}},{key:"muted",set:function(e){e!=s._muted&&(e&&s.stopAllSound(),s.musicMuted=e,s._muted=e)},get:function(){return s._muted}},{key:"soundMuted",set:function(e){s._soundMuted=e},get:function(){return s._soundMuted}},{key:"musicMuted",set:function(e){e!=s._musicMuted&&(e?(s._bgMusic&&s._musicChannel&&!s._musicChannel.isStopped?M.Render.isConchApp?s._musicChannel._audio&&(s._musicChannel._audio.muted=!0):s._musicChannel.pause():s._musicChannel=null,s._musicMuted=e):(s._musicMuted=e,s._bgMusic&&s._musicChannel&&(M.Render.isConchApp?s._musicChannel._audio&&(s._musicChannel._audio.muted=!1):s._musicChannel.resume())))},get:function(){return s._musicMuted}},{key:"musicPosition",get:function(){return s._musicChannel?s._musicChannel.position:0}},{key:"useAudioMusic",get:function(){return s._useAudioMusic},set:function(e){s._useAudioMusic=e,s._musicClass=e?Qt:null}}]),s}();en.musicVolume=1,en.soundVolume=1,en.playbackRate=1,en._useAudioMusic=!0,en._muted=!1,en._soundMuted=!1,en._musicMuted=!1,en._bgMusic=null,en._musicChannel=null,en._channels=[],en._blurPaused=!1,en._isActive=!0,en._lastSoundUsedTimeDic={},en._isCheckingDispose=!1,en.autoReleaseSound=!0;var tn=function(){function e(){S(this,e)}return C(e,[{key:"create",value:function(){return this.json?M.SceneUtils.createByData(null,this.json):null}}]),e}(),nn=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;S(this,t),this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,e?(this._u8d_=new Uint8Array(e),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this._resizeBuffer(this._allocated_)}return C(t,[{key:"_resizeBuffer",value:function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(e){throw"Invalid typed array length:"+t}}},{key:"getString",value:function(){return this.readString()}},{key:"readString",value:function(){return this._rUTF(this.getUint16())}},{key:"getFloat32Array",value:function(e,t){return this.readFloat32Array(e,t)}},{key:"readFloat32Array",value:function(e,t){t=(t=e+t)>this._length?this._length:t,e=new Float32Array(this._d_.buffer.slice(e,t));return this._pos_=t,e}},{key:"getUint8Array",value:function(e,t){return this.readUint8Array(e,t)}},{key:"readUint8Array",value:function(e,t){t=(t=e+t)>this._length?this._length:t,e=new Uint8Array(this._d_.buffer.slice(e,t));return this._pos_=t,e}},{key:"getInt16Array",value:function(e,t){return this.readInt16Array(e,t)}},{key:"readInt16Array",value:function(e,t){t=(t=e+t)>this._length?this._length:t,e=new Int16Array(this._d_.buffer.slice(e,t));return this._pos_=t,e}},{key:"getFloat32",value:function(){return this.readFloat32()}},{key:"readFloat32",value:function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var e=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,e}},{key:"getFloat64",value:function(){return this.readFloat64()}},{key:"readFloat64",value:function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var e=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,e}},{key:"writeFloat32",value:function(e){this._ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,e,this._xd_),this._pos_+=4}},{key:"writeFloat64",value:function(e){this._ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,e,this._xd_),this._pos_+=8}},{key:"getInt32",value:function(){return this.readInt32()}},{key:"readInt32",value:function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var e=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,e}},{key:"getUint32",value:function(){return this.readUint32()}},{key:"readUint32",value:function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var e=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,e}},{key:"writeInt32",value:function(e){this._ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,e,this._xd_),this._pos_+=4}},{key:"writeUint32",value:function(e){this._ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,e,this._xd_),this._pos_+=4}},{key:"getInt16",value:function(){return this.readInt16()}},{key:"readInt16",value:function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var e=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,e}},{key:"getUint16",value:function(){return this.readUint16()}},{key:"readUint16",value:function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var e=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,e}},{key:"writeUint16",value:function(e){this._ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,e,this._xd_),this._pos_+=2}},{key:"writeInt16",value:function(e){this._ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,e,this._xd_),this._pos_+=2}},{key:"getUint8",value:function(){return this.readUint8()}},{key:"readUint8",value:function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._u8d_[this._pos_++]}},{key:"writeUint8",value:function(e){this._ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,e),this._pos_++}},{key:"_getUInt8",value:function(e){return this._readUInt8(e)}},{key:"_readUInt8",value:function(e){return this._d_.getUint8(e)}},{key:"_getUint16",value:function(e){return this._readUint16(e)}},{key:"_readUint16",value:function(e){return this._d_.getUint16(e,this._xd_)}},{key:"_getMatrix",value:function(){return this._readMatrix()}},{key:"_readMatrix",value:function(){return new D(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())}},{key:"_rUTF",value:function(e){var t,n,i,a=this._pos_+e,r=String.fromCharCode,o=this._u8d_,s=[],l=0;for(s.length=1e3;this._pos_<a;)(t=o[this._pos_++])<128?0!=t&&(s[l++]=r(t)):t<224?s[l++]=r((63&t)<<6|127&o[this._pos_++]):t<240?(n=o[this._pos_++],s[l++]=r((31&t)<<12|(127&n)<<6|127&o[this._pos_++])):(n=o[this._pos_++],i=o[this._pos_++],s[l++]=r((15&t)<<18|(127&n)<<12|i<<6&127|127&o[this._pos_++]));return s.length=l,s.join("")}},{key:"getCustomString",value:function(e){return this.readCustomString(e)}},{key:"readCustomString",value:function(e){for(var t,n="",i=0,a=String.fromCharCode,r=this._u8d_;0<e;)if((t=r[this._pos_])<128)n+=a(t),this._pos_++,e--;else for(i=t-128,this._pos_++,e-=i;0<i;)t=r[this._pos_++],n+=a(r[this._pos_++]<<8|t),i--;return n}},{key:"clear",value:function(){this._pos_=0,this.length=0}},{key:"__getBuffer",value:function(){return this._d_.buffer}},{key:"writeUTFBytes",value:function(e){for(var t=0,n=(e+="").length;t<n;t++){var i=e.charCodeAt(t);i<=127?this.writeByte(i):i<=2047?(this._ensureWrite(this._pos_+2),this._u8d_.set([192|i>>6,128|63&i],this._pos_),this._pos_+=2):i<=65535?(this._ensureWrite(this._pos_+3),this._u8d_.set([224|i>>12,128|i>>6&63,128|63&i],this._pos_),this._pos_+=3):(this._ensureWrite(this._pos_+4),this._u8d_.set([240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i],this._pos_),this._pos_+=4)}}},{key:"writeUTFString",value:function(e){var t=this.pos;this.writeUint16(1),this.writeUTFBytes(e);e=this.pos-t-2;this._d_.setUint16(t,e,this._xd_)}},{key:"readUTFString",value:function(){return this.readUTFBytes(this.getUint16())}},{key:"getUTFString",value:function(){return this.readUTFString()}},{key:"readUTFBytes",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;if(0===e)return"";var t=this.bytesAvailable;if(t<e)throw"readUTFBytes error - Out of bounds";return e=0<e?e:t,this._rUTF(e)}},{key:"getUTFBytes",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;return this.readUTFBytes(e)}},{key:"writeByte",value:function(e){this._ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,e),this._pos_+=1}},{key:"readByte",value:function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)}},{key:"getByte",value:function(){return this.readByte()}},{key:"_ensureWrite",value:function(e){this._length<e&&(this._length=e),this._allocated_<e&&(this.length=e)}},{key:"writeArrayBuffer",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(t<0||n<0)throw"writeArrayBuffer error - Out of bounds";0==n&&(n=e.byteLength-t),this._ensureWrite(this._pos_+n);e=new Uint8Array(e);this._u8d_.set(e.subarray(t,t+n),this._pos_),this._pos_+=n}},{key:"readArrayBuffer",value:function(e){var t=this._u8d_.buffer.slice(this._pos_,this._pos_+e);return this._pos_=this._pos_+e,t}},{key:"buffer",get:function(){var e=this._d_.buffer;return e.byteLength===this._length?e:e.slice(0,this._length)}},{key:"endian",get:function(){return this._xd_?t.LITTLE_ENDIAN:t.BIG_ENDIAN},set:function(e){this._xd_=e===t.LITTLE_ENDIAN}},{key:"length",set:function(e){this._allocated_<e?this._resizeBuffer(this._allocated_=Math.floor(Math.max(e,2*this._allocated_))):this._allocated_>e&&this._resizeBuffer(this._allocated_=e),this._length=e},get:function(){return this._length}},{key:"pos",get:function(){return this._pos_},set:function(e){this._pos_=e}},{key:"bytesAvailable",get:function(){return this._length-this._pos_}}],[{key:"getSystemEndian",value:function(){var e;return t._sysEndian||(e=new ArrayBuffer(2),new DataView(e).setInt16(0,256,!0),t._sysEndian=256===new Int16Array(e)[0]?t.LITTLE_ENDIAN:t.BIG_ENDIAN),t._sysEndian}}]),t}();nn.BIG_ENDIAN="bigEndian",nn.LITTLE_ENDIAN="littleEndian",nn._sysEndian=null;var an=function(){function e(){S(this,e),this._fontCharDic={},this._fontWidthMap={},this._maxWidth=0,this._spaceWidth=10,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}return C(e,[{key:"loadFont",value:function(e,t){this._path=e,this._complete=t,e&&-1!==e.indexOf(".fnt")?M.loader.load([{url:e,type:M.Loader.XML},{url:e.replace(".fnt",".png"),type:M.Loader.IMAGE}],F.create(this,this._onLoaded)):console.error('Bitmap font configuration information must be a ".fnt" file')}},{key:"_onLoaded",value:function(){this.parseFont(M.Loader.getRes(this._path),M.Loader.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.run()}},{key:"parseFont",value:function(e,t){if(null!=e&&null!=t){this._texture=t;var n=e.getElementsByTagName("info");if(!n[0].getAttributeNode)return this.parseFont2(e,t);this.fontSize=parseInt(n[0].getAttributeNode("size").nodeValue);n=n[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];for(var i=e.getElementsByTagName("char"),a=0,a=0;a<i.length;a++){var r=i[a],o=parseInt(r.getAttributeNode("id").nodeValue),s=+parseInt(r.getAttributeNode("xoffset").nodeValue),l=+parseInt(r.getAttributeNode("yoffset").nodeValue),h=+parseInt(r.getAttributeNode("xadvance").nodeValue),u=new O;u.x=parseInt(r.getAttributeNode("x").nodeValue),u.y=parseInt(r.getAttributeNode("y").nodeValue),u.width=parseInt(r.getAttributeNode("width").nodeValue),u.height=parseInt(r.getAttributeNode("height").nodeValue);l=$e.create(t,u.x,u.y,u.width,u.height,s,l);this._maxWidth=Math.max(this._maxWidth,h+this.letterSpacing),this._fontCharDic[o]=l,this._fontWidthMap[o]=h}}}},{key:"parseFont2",value:function(e,t){if(null!=e&&null!=t){this._texture=t;var n=e.getElementsByTagName("info");this.fontSize=parseInt(n[0].attributes.size.nodeValue);n=n[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];for(var i=e.getElementsByTagName("char"),a=0,a=0;a<i.length;a++){var r=i[a].attributes,o=parseInt(r.id.nodeValue),s=+parseInt(r.xoffset.nodeValue),l=+parseInt(r.yoffset.nodeValue),h=+parseInt(r.xadvance.nodeValue),u=new O;u.x=parseInt(r.x.nodeValue),u.y=parseInt(r.y.nodeValue),u.width=parseInt(r.width.nodeValue),u.height=parseInt(r.height.nodeValue);l=$e.create(t,u.x,u.y,u.width,u.height,s,l);this._maxWidth=Math.max(this._maxWidth,h+this.letterSpacing),this._fontCharDic[o]=l,this._fontWidthMap[o]=h}}}},{key:"getCharTexture",value:function(e){return this._fontCharDic[e.charCodeAt(0)]}},{key:"destroy",value:function(){if(this._texture){for(var e in this._fontCharDic){var t=this._fontCharDic[e];t&&t.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null,this._complete=null,this._padding=null}}},{key:"setSpaceWidth",value:function(e){this._spaceWidth=e}},{key:"getCharWidth",value:function(e){var t=e.charCodeAt(0);return this._fontWidthMap[t]?this._fontWidthMap[t]+this.letterSpacing:" "===e?this._spaceWidth+this.letterSpacing:0}},{key:"getTextWidth",value:function(e){for(var t=0,n=0,i=e.length;n<i;n++)t+=this.getCharWidth(e.charAt(n));return t}},{key:"getMaxWidth",value:function(){return this._maxWidth}},{key:"getMaxHeight",value:function(){return this.fontSize}},{key:"_drawText",value:function(e,t,n,i,a,r){for(var o,s=this.getTextWidth(e),l="right"===a?r-s:"center"===a?(r-s)/2:0,h=0,u=0,d=e.length;u<d;u++)(o=this.getCharTexture(e.charAt(u)))&&(t.graphics.drawImage(o,n+h+l,i),h+=this.getCharWidth(e.charAt(u)))}}]),e}();Dt.regClass("laya.display.BitmapFont",an),Dt.regClass("Laya.BitmapFont",an);var rn=function(){T(n,d);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments))._http=new XMLHttpRequest,e}return C(n,[{key:"send",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"get",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"text",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if(at.window.merge){var r=window.location.href.slice(0,window.location.href.lastIndexOf("/")+1),o=e.replace(r,""),s=c(at.window.merge);try{for(s.s();!(l=s.n()).done;){var l=l.value;if(l.config[o])return this.clear(),this._data=JSON.parse(l.config[o]),void this.event(Je.COMPLETE,this._data instanceof Array?[this._data]:this._data)}}catch(e){s.e(e)}finally{s.f()}}this._responseType=i,this._data=null,(at.onVVMiniGame||at.onQGMiniGame||at.onQQMiniGame)&&(e=encodeURI(e)),this._url=e;var h=this,u=this._http;if(e=B.getAdptedFilePath(e),u.open(n,e,!0),a)for(var d=0;d<a.length;d++)u.setRequestHeader(a[d++],a[d]);else window.conch||(t&&"string"!=typeof t?u.setRequestHeader("Content-Type","application/json"):u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));i="arraybuffer"!==i?"text":"arraybuffer";u.responseType=i,u.dataType&&(u.dataType=i),u.onerror=function(e){h._onError(e)},u.onabort=function(e){h._onAbort(e)},u.onprogress=function(e){h._onProgress(e)},u.onload=function(e){h._onLoad(e)},u.send(t)}},{key:"_onProgress",value:function(e){e&&e.lengthComputable&&this.event(Je.PROGRESS,e.loaded/e.total)}},{key:"_onAbort",value:function(e){this.error("Request was aborted by user")}},{key:"_onError",value:function(e){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)}},{key:"_onLoad",value:function(e){var t=this._http,n=void 0!==t.status?t.status:200;200===n||204===n||0===n?this.complete():this.error("["+t.status+"]"+t.statusText+":"+t.responseURL)}},{key:"error",value:function(e){this.clear(),console.warn(this.url,e),this.event(Je.ERROR,e)}},{key:"complete",value:function(){this.clear();var t=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=ae.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(e){t=!1,this.error(e.message)}t&&this.event(Je.COMPLETE,this._data instanceof Array?[this._data]:this._data)}},{key:"clear",value:function(){var e=this._http;e.onerror=e.onabort=e.onprogress=e.onload=null}},{key:"url",get:function(){return this._url}},{key:"data",get:function(){return this._data}},{key:"http",get:function(){return this._http}}]),n}(),on=function(){T(w,d);var t=b(w);function w(){var e;return S(this,w),(e=t.apply(this,arguments))._customParse=!1,e}return C(w,[{key:"load",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:M.WorkerLoader.enable;if(e)return w.setGroup(e,"666"),0===(this._url=e).indexOf("data:image")?t=w.IMAGE:e=B.formatURL(e),this._type=t=t||w.getTypeFromUrl(this._url),this._cache=n,this._useWorkerLoader=r,this._data=null,r&&M.WorkerLoader.enableWorkerLoader(),r=(t==w.IMAGE?w.textureMap:w.loadedMap)[e],!a&&r?(this._data=r,this.event(Je.PROGRESS,1),void this.event(Je.COMPLETE,this._data)):(i&&w.setGroup(e,i),null!=w.parserMap[t]?(this._customParse=!0,void(w.parserMap[t]instanceof F?w.parserMap[t].runWith(this):w.parserMap[t].call(null,this))):void this._loadResourceFilter(t,e));this.onLoaded(null)}},{key:"_loadResourceFilter",value:function(e,t){this._loadResource(e,t)}},{key:"_loadResource",value:function(e,t){switch(e){case w.IMAGE:case"htmlimage":case"nativeimage":this._loadImage(t);break;case w.SOUND:this._loadSound(t);break;case w.TTF:this._loadTTF(t);break;case w.ATLAS:case w.PREFAB:case w.PLF:this._loadHttpRequestWhat(t,w.JSON);break;case w.FONT:this._loadHttpRequestWhat(t,w.XML);break;case w.PLFB:this._loadHttpRequestWhat(t,w.BUFFER);break;default:this._loadHttpRequestWhat(t,e)}}},{key:"_loadHttpRequest",value:function(e,t,n,i,a,r,o,s){!at.onVVMiniGame&&this._http||(this._http=new rn),r&&this._http.on(Je.PROGRESS,a,r),i&&this._http.on(Je.COMPLETE,n,i),this._http.on(Je.ERROR,o,s),this._http.send(e,null,"get",t)}},{key:"_loadHtmlImage",value:function(t,e,n,i,a){function r(){var e=o;e.onload=null,e.onerror=null,delete w._imgCache[t]}var o;(o=new at.window.Image).crossOrigin="",o.onload=function(){r(),n.call(e,o)},o.onerror=function(){r(),a.call(i)},o.src=t,w._imgCache[t]=o}},{key:"_loadHttpRequestWhat",value:function(e,t){w.preLoadedMap[e]?this.onLoaded(w.preLoadedMap[e]):this._loadHttpRequest(e,t,this,this.onLoaded,this,this.onProgress,this,this.onError)}},{key:"_loadTTF",value:function(e){e=B.formatURL(e);var t=new M.TTFLoader;t.complete=F.create(this,this.onLoaded),t.load(e)}},{key:"_loadImage",value:function(i){var e,t=this,a=this;i=B.formatURL(i);function n(){a.event(Je.ERROR,"Load image failed")}var r;"nativeimage"===this._type?(e=function(e){t.onLoaded(e)},this._loadHtmlImage(i,this,e,this,n)):"ktx"===(r=ae.getFileExtension(i))||"pvr"===r?(e=function(e){var t;switch(r){case"ktx":t=f.ETC1RGB;break;case"pvr":t=f.PVRTCRGBA_4BPPV;break;default:return void console.error("unknown format",r)}var n=new X(0,0,t,!1,!1);n.wrapModeU=U.WARPMODE_CLAMP,n.wrapModeV=U.WARPMODE_CLAMP,n.setCompressData(e),n._setCreateURL(i),a.onLoaded(n)},this._loadHttpRequest(i,w.BUFFER,this,e,null,null,this,n)):(e=function(e){var t=new X(e.width,e.height,1,!1,!1);t.wrapModeU=U.WARPMODE_CLAMP,t.wrapModeV=U.WARPMODE_CLAMP,t.loadImageSource(e,!0),t._setCreateURL(i),a.onLoaded(t)},this._loadHtmlImage(i,this,e,this,n))}},{key:"_loadSound",value:function(e){var t=new en._soundClass,n=this;function i(){t.offAll()}t.on(Je.COMPLETE,this,function(){i(),n.onLoaded(t)}),t.on(Je.ERROR,this,function(){i(),t.dispose(),n.event(Je.ERROR,"Load sound failed")}),t.load(e)}},{key:"onProgress",value:function(e){this._type===w.ATLAS?this.event(Je.PROGRESS,.3*e):this.event(Je.PROGRESS,e)}},{key:"onError",value:function(e){this.event(Je.ERROR,e)}},{key:"onLoaded",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=this._type;if(t==w.PLFB)this.parsePLFBData(e),this.complete(e);else if(t==w.PLF)this.parsePLFData(e),this.complete(e);else if(t===w.IMAGE){var n=new $e(e);n.url=this._url,this.complete(n)}else if(t===w.SOUND||"htmlimage"===t||"nativeimage"===t)this.complete(e);else if(t===w.ATLAS){if(!(e instanceof X)){var i=[];if(!this._data){if((this._data=e).meta&&e.meta.image){i=e.meta.image.split(",");var a=0<=this._url.indexOf("/")?"/":"\\",r=this._url.lastIndexOf(a),o=0<=r?this._url.substr(0,r+1):"",s=null;at.onAndroid&&e.meta.compressTextureAndroid&&(s=".ktx"),at.onIOS&&e.meta.compressTextureIOS&&(s=".pvr");for(var l=0,h=i.length;l<h;l++)i[l]=s?o+i[l].replace(".png",s):o+i[l]}else i=[this._url.replace(".json",".png")];i.reverse(),e.toLoads=i,e.pics=[]}return this.event(Je.PROGRESS,.3+1/i.length*.6),this._loadResourceFilter(w.IMAGE,i.pop())}if(this._data.pics.push(e),0<this._data.toLoads.length)return this.event(Je.PROGRESS,.3+1/this._data.toLoads.length*.6),this._loadResourceFilter(w.IMAGE,this._data.toLoads.pop());var u=this._data.frames,a=this._url.split("?")[0],d=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:a.substring(0,a.lastIndexOf("."))+"/",c=this._data.pics,r=B.formatURL(this._url),_=w.atlasMap[r]||(w.atlasMap[r]=[]);_.dir=d;var f;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var g in f=parseFloat(this._data.meta.scale),u){var y,v=u[g],p=c[v.frame.idx||0],m=B.formatURL(d+g);p.scaleRate=f,y=$e._create(p,v.frame.x,v.frame.y,v.frame.w,v.frame.h,v.spriteSourceSize.x,v.spriteSourceSize.y,v.sourceSize.w,v.sourceSize.h,w.getRes(m)),w.cacheTexture(m,y),y.url=m,_.push(m)}else for(g in u)p=c[(v=u[g]).frame.idx||0],m=B.formatURL(d+g),y=$e._create(p,v.frame.x,v.frame.y,v.frame.w,v.frame.h,v.spriteSourceSize.x,v.spriteSourceSize.y,v.sourceSize.w,v.sourceSize.h,w.getRes(m)),w.cacheTexture(m,y),y.url=m,_.push(m);delete this._data.pics,this.complete(this._data)}else if(t===w.FONT){if(!e._source)return this._data=e,this.event(Je.PROGRESS,.5),this._loadImage(this._url.replace(".fnt",".png"));a=new an;a.parseFont(this._data,new $e(e));r=this._url.split(".fnt")[0].split("/"),r=r[r.length-1];Ut.registerBitmapFont(r,a),this._data=a,this.complete(this._data)}else t===w.PREFAB?((t=new tn).json=e,this.complete(t)):this.complete(e)}},{key:"parsePLFData",value:function(e){var t,n,i;for(t in e)switch(i=e[t],t){case"json":case"text":for(n in i)w.preLoadedMap[B.formatURL(n)]=i[n];break;default:for(n in i)w.preLoadedMap[B.formatURL(n)]=i[n]}}},{key:"parsePLFBData",value:function(e){for(var t=new nn(e),n=t.getInt32(),i=0;i<n;i++)this.parseOnePLFBFile(t)}},{key:"parseOnePLFBFile",value:function(e){var t=e.getUTFString(),n=e.getInt32(),n=e.readArrayBuffer(n);w.preLoadedMap[B.formatURL(t)]=n}},{key:"complete",value:function(e){this._data=e,this._customParse?this.event(Je.LOADED,e instanceof Array?[e]:e):(w._loaders.push(this),w._isWorking||w.checkNext())}},{key:"endLoad",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e&&(this._data=e),this._cache&&w.cacheRes(this._url,this._data),this.event(Je.PROGRESS,1),this.event(Je.COMPLETE,this.data instanceof Array?[this.data]:this.data)}},{key:"url",get:function(){return this._url}},{key:"type",get:function(){return this._type}},{key:"cache",get:function(){return this._cache}},{key:"data",get:function(){return this._data}}],[{key:"getTypeFromUrl",value:function(e){var t=ae.getFileExtension(e);return t?w.typeMap[t]:(console.warn("Not recognize the resources suffix",e),"text")}},{key:"checkNext",value:function(){w._isWorking=!0;for(var e=at.now();w._startIndex<w._loaders.length;)if(w._loaders[w._startIndex].endLoad(),w._startIndex++,at.now()-e>w.maxTimeOut)return console.warn("loader callback cost a long time:"+(at.now()-e)+" url="+w._loaders[w._startIndex-1].url),void M.systemTimer.frameOnce(1,null,w.checkNext);w._loaders.length=0,w._startIndex=0,w._isWorking=!1}},{key:"clearRes",value:function(e){e=B.formatURL(e);var t=w.getAtlas(e);if(t){for(var n=0,i=t.length;n<i;n++){var a=t[n],r=w.getRes(a);delete w.textureMap[a],r&&r.destroy()}t.length=0,delete w.atlasMap[e]}var o=w.textureMap[e];o&&(o.destroy(),delete w.textureMap[e]),w.loadedMap[e]&&delete w.loadedMap[e]}},{key:"clearTextureRes",value:function(e){e=B.formatURL(e);var t=w.getAtlas(e);t&&0<t.length?t.forEach(function(e){e=w.getRes(e);e instanceof $e&&e.disposeBitmap()}):(e=w.getRes(e))instanceof $e&&e.disposeBitmap()}},{key:"getRes",value:function(e){var t=w.textureMap[B.formatURL(e)];return t||w.loadedMap[B.formatURL(e)]}},{key:"getAtlas",value:function(e){return w.atlasMap[B.formatURL(e)]}},{key:"cacheRes",value:function(e,t){e=B.formatURL(e),null!=w.loadedMap[e]?console.warn("Resources already exist,is repeated loading:",e):t instanceof $e?(w.loadedMap[e]=t.bitmap,w.textureMap[e]=t):w.loadedMap[e]=t}},{key:"cacheTexture",value:function(e,t){e=B.formatURL(e),null!=w.textureMap[e]||(w.textureMap[e]=t)}},{key:"setGroup",value:function(e,t){w.groupMap[t]||(w.groupMap[t]=[]),w.groupMap[t].push(e)}},{key:"clearResByGroup",value:function(e){if(w.groupMap[e]){for(var t=w.groupMap[e],n=t.length,i=0;i<n;i++)w.clearRes(t[i]);t.length=0}}}]),w}();on.TEXT="text",on.JSON="json",on.PREFAB="prefab",on.XML="xml",on.BUFFER="arraybuffer",on.IMAGE="image",on.SOUND="sound",on.ATLAS="atlas",on.FONT="font",on.TTF="ttf",on.PLF="plf",on.PLFB="plfb",on.HIERARCHY="HIERARCHY",on.MESH="MESH",on.MATERIAL="MATERIAL",on.TEXTURE2D="TEXTURE2D",on.TEXTURECUBE="TEXTURECUBE",on.ANIMATIONCLIP="ANIMATIONCLIP",on.AVATAR="AVATAR",on.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA",on.TERRAINRES="TERRAIN",on.typeMap={ttf:"ttf",png:"image",jpg:"image",jpeg:"image",ktx:"image",pvr:"image",txt:"text",json:"json",prefab:"prefab",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",plf:"plf",plfb:"plfb",scene:"json",ani:"json",sk:"arraybuffer"},on.parserMap={},on.maxTimeOut=100,on.groupMap={},on.loadedMap={},on.atlasMap={},on.textureMap={},on.preLoadedMap={},on._imgCache={},on._loaders=[],on._isWorking=!1,on._startIndex=0;var sn=function(){function s(){S(this,s)}return C(s,null,[{key:"enable",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;M.loader.load(e,F.create(null,s._onInfoLoaded,[t]),null,on.JSON)}},{key:"_onInfoLoaded",value:function(e,t){var n,i,a,r,o;for(n in t)for(i=(a=t[n])[0],o=(a=a[1]).length,r=0;r<o;r++)s._fileLoadDic[i+a[r]]=n;e&&e.run()}},{key:"getFileLoadPath",value:function(e){return s._fileLoadDic[e]||e}}]),s}();sn._fileLoadDic={};var ln=function(){T(c,d);var n=b(c);function c(){var e;S(this,c),(e=n.call(this)).retryNum=1,e.retryDelay=0,e.maxLoader=5,e._loaders=[],e._loaderCount=0,e._resInfos=[],e._infoPool=[],e._maxPriority=5,e._failRes={},e._statInfo={count:1,loaded:1};for(var t=0;t<e._maxPriority;t++)e._resInfos[t]=[];return e}return C(c,[{key:"getProgress",value:function(){return this._statInfo.loaded/this._statInfo.count}},{key:"resetProgress",value:function(){this._statInfo.count=this._statInfo.loaded=1}},{key:"create",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1,s=!(7<arguments.length&&void 0!==arguments[7])||arguments[7];this._create(e,!0,t,n,i,a,r,o,s)}},{key:"_create",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1,l=!(8<arguments.length&&void 0!==arguments[8])||arguments[8];if(e instanceof Array){var h,u=!0,d=e,c=d.length,_=0;i&&(h=F.create(i.caller,i?i.method:null,i.args,!1));for(var f=0;f<c;f++){var g=d[f];(g="string"==typeof g?d[f]={url:g}:g).progress=0}for(f=0;f<c;f++){g=d[f];var y=i?F.create(null,function(e,t){e.progress=t;for(var n=0,i=0;i<c;i++)n+=d[i].progress;t=n/c;h.runWith(t)},[g],!1):null,v=i||n?F.create(null,function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_++,e.progress=1,t||(u=!1),_===c&&n&&n.runWith(u)},[g]):null;this._createOne(g.url,t,v,y,g.type||a,g.constructParams||r,g.propertyParams||o,g.priority||s,l)}}else this._createOne(e,t,n,i,a,r,o,s,l)}},{key:"_createOne",value:function(t,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1,l=!(8<arguments.length&&void 0!==arguments[8])||arguments[8],h=this.getRes(t);h?(!n&&h instanceof V&&h._addReference(),e&&e.runWith(1),i&&i.runWith(h)):(h=ae.getFileExtension(t),(a=a||(c.createMap[h]?c.createMap[h][0]:null))&&on.parserMap[a]?this._createLoad(t,F.create(null,function(e){e&&(!n&&e instanceof V&&e._addReference(),e._setCreateURL(t)),i&&i.runWith(e),M.loader.event(t)}),e,a,r,o,s,l,!0):this.load(t,i,e,a,s,l))}},{key:"load",value:function(e){var t,n,i,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,l=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],h=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,u=7<arguments.length&&void 0!==arguments[7]&&arguments[7],d=8<arguments.length&&void 0!==arguments[8]?arguments[8]:M.WorkerLoader.enable;return e instanceof Array?this._loadAssets(e,a,r,o,s,l,h):(t=(o===on.IMAGE?on.textureMap:on.loadedMap)[B.formatURL(e)],u||null==t?(n=e,(e=sn.getFileLoadPath(e))!=n&&"nativeimage"!==o?o=on.ATLAS:n=null,(i=c._resMap[e])?(a&&(n?a&&i._createListener(Je.COMPLETE,this,this._resInfoLoaded,[n,a],!1,!1):a&&i._createListener(Je.COMPLETE,a.caller,a.method,a.args,!1,!1)),r&&i._createListener(Je.PROGRESS,r.caller,r.method,r.args,!1,!1)):((i=this._infoPool.length?this._infoPool.pop():new hn).url=e,i.type=o,i.cache=l,i.group=h,i.ignoreCache=u,i.useWorkerLoader=d,i.originalUrl=n,a&&i.on(Je.COMPLETE,a.caller,a.method,a.args),r&&i.on(Je.PROGRESS,r.caller,r.method,r.args),c._resMap[e]=i,s=s<this._maxPriority?s:this._maxPriority-1,this._resInfos[s].push(i),this._statInfo.count++,this.event(Je.PROGRESS,this.getProgress()),this._next())):M.systemTimer.frameOnce(1,this,function(){r&&r.runWith(1),a&&a.runWith(t instanceof Array?[t]:t),this._loaderCount||this.event(Je.COMPLETE)}),this)}},{key:"_resInfoLoaded",value:function(e,t){t.runWith(on.getRes(e))}},{key:"_createLoad",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1,s=!(7<arguments.length&&void 0!==arguments[7])||arguments[7],l=8<arguments.length&&void 0!==arguments[8]&&arguments[8];if(e instanceof Array)return this._loadAssets(e,t,n,i,o,s);var h,u=on.getRes(e);return null!=u?M.systemTimer.frameOnce(1,this,function(){n&&n.runWith(1),t&&t.runWith(u),this._loaderCount||this.event(Je.COMPLETE)}):(h=c._resMap[e])?(t&&h._createListener(Je.COMPLETE,t.caller,t.method,t.args,!1,!1),n&&h._createListener(Je.PROGRESS,n.caller,n.method,n.args,!1,!1)):((h=this._infoPool.length?this._infoPool.pop():new hn).url=e,h.type=i,h.cache=!1,h.ignoreCache=l,h.originalUrl=null,h.group=null,h.createCache=s,h.createConstructParams=a,h.createPropertyParams=r,t&&h.on(Je.COMPLETE,t.caller,t.method,t.args),n&&h.on(Je.PROGRESS,n.caller,n.method,n.args),c._resMap[e]=h,o=o<this._maxPriority?o:this._maxPriority-1,this._resInfos[o].push(h),this._statInfo.count++,this.event(Je.PROGRESS,this.getProgress()),this._next()),this}},{key:"_next",value:function(){if(!(this._loaderCount>=this.maxLoader)){for(var e=0;e<this._maxPriority;e++)for(var t=this._resInfos[e];0<t.length;){var n=t.shift();if(n)return this._doLoad(n)}this._loaderCount||this.event(Je.COMPLETE)}}},{key:"_doLoad",value:function(t){this._loaderCount++;var n=this._loaders.length?this._loaders.pop():new on;n.on(Je.COMPLETE,null,a),n.on(Je.PROGRESS,null,function(e){t.event(Je.PROGRESS,e)}),n.on(Je.ERROR,null,function(e){a(null)});var i=this;function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;n.offAll(),n._data=null,n._customParse=!1,i._loaders.push(n),i._endLoad(t,e instanceof Array?[e]:e),i._loaderCount--,i._next()}n._constructParams=t.createConstructParams,n._propertyParams=t.createPropertyParams,n._createCache=t.createCache,n.load(t.url,t.type,t.cache,t.group,t.ignoreCache,t.useWorkerLoader)}},{key:"_endLoad",value:function(e,t){var n=e.url;if(null==t){var i=this._failRes[n]||0;if(i<this.retryNum)return console.warn("[warn]Retry to load:",n),this._failRes[n]=i+1,void M.systemTimer.once(this.retryDelay,this,this._addReTry,[e],!1);on.clearRes(n),console.warn("[error]Failed to load:",n),this.event(Je.ERROR,n)}this._failRes[n]&&(this._failRes[n]=0),delete c._resMap[n],e.originalUrl&&(t=on.getRes(e.originalUrl)),e.event(Je.COMPLETE,t),e.offAll(),this._infoPool.push(e),this._statInfo.loaded++,this.event(Je.PROGRESS,this.getProgress())}},{key:"_addReTry",value:function(e){this._resInfos[this._maxPriority-1].push(e),this._next()}},{key:"clearRes",value:function(e){on.clearRes(e)}},{key:"clearTextureRes",value:function(e){on.clearTextureRes(e)}},{key:"getRes",value:function(e){return on.getRes(e)}},{key:"cacheRes",value:function(e,t){on.cacheRes(e,t)}},{key:"setGroup",value:function(e,t){on.setGroup(e,t)}},{key:"clearResByGroup",value:function(e){on.clearResByGroup(e)}},{key:"clearUnLoaded",value:function(){for(var e=0;e<this._maxPriority;e++){for(var t=this._resInfos[e],n=t.length-1;-1<n;n--){var i=t[n];i&&(i.offAll(),this._infoPool.push(i))}t.length=0}this._loaderCount=0,c._resMap={}}},{key:"cancelLoadByUrls",value:function(e){if(e)for(var t=0,n=e.length;t<n;t++)this.cancelLoadByUrl(e[t])}},{key:"cancelLoadByUrl",value:function(e){for(var t=0;t<this._maxPriority;t++)for(var n=this._resInfos[t],i=n.length-1;-1<i;i--){var a=n[i];a&&a.url===e&&(n[i]=null,a.offAll(),this._infoPool.push(a))}c._resMap[e]&&delete c._resMap[e]}},{key:"_loadAssets",value:function(e){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,t=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,a=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],r=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,s=e.length,l=0,h=0,u=[],d=!0,c=0;c<s;c++){var _=e[c],f=void 0;(f="string"==typeof _?{url:_,type:t,size:1,priority:i}:_).size||(f.size=1),f.progress=0,h+=f.size,u.push(f);var g=o?F.create(null,v,[f],!1):null,_=n||o?F.create(null,y,[f]):null;this.load(f.url,_,g,f.type,f.priority||1,a,f.group||r,!1,f.useWorkerLoader)}function y(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;l++,e.progress=1,t||(d=!1),l===s&&n&&n.runWith(d)}function v(e,t){if(null!=o){e.progress=t;for(var n=0,i=0;i<u.length;i++){var a,r=u[i];r&&(a=null==r.progress?0:r.progress,n+=null==r.size?0:r.size*a)}t=n/h;o.runWith(t)}}return this}},{key:"decodeBitmaps",value:function(e){for(var t=e.length,n=M.Render._context,i=0;i<t;i++){var a=on.getAtlas(e[i]);a?this._decodeTexture(a[0],n):(a=this.getRes(e[i]))&&a instanceof $e&&this._decodeTexture(a,n)}}},{key:"_decodeTexture",value:function(e,t){var n=e.bitmap;e&&n&&((n=n.source||n.image)&&n instanceof HTMLImageElement&&(t.drawImage(n,0,0,1,1),t.getImageData(0,0,1,1)))}}],[{key:"cacheRes",value:function(e,t){on.cacheRes(e,t)}}]),c}();ln._resMap={},ln.createMap={atlas:[null,on.ATLAS]};var hn=function(){T(t,d);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}(),un=function(){function n(){S(this,n)}return C(n,null,[{key:"__init__",value:function(){return n._baseClass||(n._baseClass=dn).init(),n.items=n._baseClass.items,n.support=n._baseClass.support}},{key:"setItem",value:function(e,t){n._baseClass.setItem(e,t)}},{key:"getItem",value:function(e){return n._baseClass.getItem(e)}},{key:"setJSON",value:function(e,t){n._baseClass.setJSON(e,t)}},{key:"getJSON",value:function(e){return n._baseClass.getJSON(e)}},{key:"removeItem",value:function(e){n._baseClass.removeItem(e)}},{key:"clear",value:function(){n._baseClass.clear()}}]),n}();un.support=!1;var dn=function(){function n(){S(this,n)}return C(n,null,[{key:"init",value:function(){try{n.support=!0,n.items=window.localStorage,n.setItem("laya","1"),n.removeItem("laya")}catch(e){n.support=!1}n.support||console.log("LocalStorage is not supprot or browser is private mode.")}},{key:"setItem",value:function(e,t){try{n.support&&n.items.setItem(e,t)}catch(e){console.warn("set localStorage failed",e)}}},{key:"getItem",value:function(e){return n.support?n.items.getItem(e):null}},{key:"setJSON",value:function(e,t){try{n.support&&n.items.setItem(e,JSON.stringify(t))}catch(e){console.warn("set localStorage failed",e)}}},{key:"getJSON",value:function(e){return JSON.parse(n.support?n.items.getItem(e):null)}},{key:"removeItem",value:function(e){n.support&&n.items.removeItem(e)}},{key:"clear",value:function(){n.support&&n.items.clear()}}]),n}();dn.support=!1;var cn=function(){function n(){S(this,n)}return C(n,[{key:"load",value:function(e){e=(this._url=e).split(".ttf")[0].split("/");this.fontName=e[e.length-1],M.Render.isConchApp?this._loadConch():window.FontFace?this._loadWithFontFace():this._loadWithCSS()}},{key:"_loadConch",value:function(){this._http=new rn,this._http.on(Je.ERROR,this,this._onErr),this._http.on(Je.COMPLETE,this,this._onHttpLoaded),this._http.send(this._url,null,"get",on.BUFFER)}},{key:"_onHttpLoaded",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;window.conchTextCanvas.setFontFaceFromBuffer(this.fontName,e),this._clearHttp(),this._complete()}},{key:"_clearHttp",value:function(){this._http&&(this._http.off(Je.ERROR,this,this._onErr),this._http.off(Je.COMPLETE,this,this._onHttpLoaded),this._http=null)}},{key:"_onErr",value:function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)}},{key:"_complete",value:function(){M.systemTimer.clear(this,this._complete),M.systemTimer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)}},{key:"_checkComplete",value:function(){M.Browser.measureText(n._testString,this._fontTxt).width!=this._txtWidth&&this._complete()}},{key:"_loadWithFontFace",value:function(){var e=new window.FontFace(this.fontName,"url('"+this._url+"')");document.fonts.add(e);var t=this;e.loaded.then(function(){t._complete()}),e.load()}},{key:"_createDiv",value:function(){this._div=at.createElement("div"),this._div.innerHTML="laya";var e=this._div.style;e.fontFamily=this.fontName,e.position="absolute",e.left="-100px",e.top="-100px",document.body.appendChild(this._div)}},{key:"_loadWithCSS",value:function(){var e=at.createElement("style");e.type="text/css",document.body.appendChild(e),e.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=at.measureText(n._testString,this._fontTxt).width;var t=this;e.onload=function(){M.systemTimer.once(1e4,t,this._complete)},M.systemTimer.loop(20,this,this._checkComplete),this._createDiv()}}]),n}();cn._testString="LayaTTFFont";var _n=function(){function s(){S(this,s)}return C(s,null,[{key:"linearNone",value:function(e,t,n,i){return n*e/i+t}},{key:"linearIn",value:function(e,t,n,i){return n*e/i+t}},{key:"linearInOut",value:function(e,t,n,i){return n*e/i+t}},{key:"linearOut",value:function(e,t,n,i){return n*e/i+t}},{key:"bounceIn",value:function(e,t,n,i){return n-s.bounceOut(i-e,0,n,i)+t}},{key:"bounceInOut",value:function(e,t,n,i){return e<.5*i?.5*s.bounceIn(2*e,0,n,i)+t:.5*s.bounceOut(2*e-i,0,n,i)+.5*n+t}},{key:"bounceOut",value:function(e,t,n,i){return(e/=i)<1/2.75?n*(7.5625*e*e)+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}},{key:"backIn",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1.70158;return n*(e/=i)*e*((a+1)*e-a)+t}},{key:"backInOut",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1.70158;return(e/=.5*i)<1?.5*n*(e*e*((1+(a*=1.525))*e-a))+t:n/2*((e-=2)*e*((1+(a*=1.525))*e+a)+2)+t}},{key:"backOut",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1.70158;return n*((e=e/i-1)*e*((a+1)*e+a)+1)+t}},{key:"elasticIn",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;return 0==e?t:1==(e/=i)?t+n:(r=r||.3*i,n=!a||0<n&&a<n||n<0&&a<-n?(a=n,r/4):r/s.PI2*Math.asin(n/a),-(a*Math.pow(2,10*--e)*Math.sin((e*i-n)*s.PI2/r))+t)}},{key:"elasticInOut",value:function(e,t,n,i){var a,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;return 0==e?t:2==(e/=.5*i)?t+n:(o=o||i*(.3*1.5),a=!r||0<n&&r<n||n<0&&r<-n?(r=n,o/4):o/s.PI2*Math.asin(n/r),e<1?r*Math.pow(2,10*--e)*Math.sin((e*i-a)*s.PI2/o)*-.5+t:r*Math.pow(2,-10*--e)*Math.sin((e*i-a)*s.PI2/o)*.5+n+t)}},{key:"elasticOut",value:function(e,t,n,i){var a,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;return 0==e?t:1==(e/=i)?t+n:(o=o||.3*i,a=!r||0<n&&r<n||n<0&&r<-n?(r=n,o/4):o/s.PI2*Math.asin(n/r),r*Math.pow(2,-10*e)*Math.sin((e*i-a)*s.PI2/o)+n+t)}},{key:"strongIn",value:function(e,t,n,i){return n*(e/=i)*e*e*e*e+t}},{key:"strongInOut",value:function(e,t,n,i){return(e/=.5*i)<1?.5*n*e*e*e*e*e+t:.5*n*((e-=2)*e*e*e*e+2)+t}},{key:"strongOut",value:function(e,t,n,i){return n*((e=e/i-1)*e*e*e*e+1)+t}},{key:"sineInOut",value:function(e,t,n,i){return.5*-n*(Math.cos(Math.PI*e/i)-1)+t}},{key:"sineIn",value:function(e,t,n,i){return-n*Math.cos(e/i*s.HALF_PI)+n+t}},{key:"sineOut",value:function(e,t,n,i){return n*Math.sin(e/i*s.HALF_PI)+t}},{key:"quintIn",value:function(e,t,n,i){return n*(e/=i)*e*e*e*e+t}},{key:"quintInOut",value:function(e,t,n,i){return(e/=.5*i)<1?.5*n*e*e*e*e*e+t:.5*n*((e-=2)*e*e*e*e+2)+t}},{key:"quintOut",value:function(e,t,n,i){return n*((e=e/i-1)*e*e*e*e+1)+t}},{key:"quartIn",value:function(e,t,n,i){return n*(e/=i)*e*e*e+t}},{key:"quartInOut",value:function(e,t,n,i){return(e/=.5*i)<1?.5*n*e*e*e*e+t:.5*-n*((e-=2)*e*e*e-2)+t}},{key:"quartOut",value:function(e,t,n,i){return-n*((e=e/i-1)*e*e*e-1)+t}},{key:"cubicIn",value:function(e,t,n,i){return n*(e/=i)*e*e+t}},{key:"cubicInOut",value:function(e,t,n,i){return(e/=.5*i)<1?.5*n*e*e*e+t:.5*n*((e-=2)*e*e+2)+t}},{key:"cubicOut",value:function(e,t,n,i){return n*((e=e/i-1)*e*e+1)+t}},{key:"quadIn",value:function(e,t,n,i){return n*(e/=i)*e+t}},{key:"quadInOut",value:function(e,t,n,i){return(e/=.5*i)<1?.5*n*e*e+t:.5*-n*(--e*(e-2)-1)+t}},{key:"quadOut",value:function(e,t,n,i){return-n*(e/=i)*(e-2)+t}},{key:"expoIn",value:function(e,t,n,i){return 0==e?t:n*Math.pow(2,10*(e/i-1))+t-.001*n}},{key:"expoInOut",value:function(e,t,n,i){return 0==e?t:e==i?t+n:(e/=.5*i)<1?.5*n*Math.pow(2,10*(e-1))+t:.5*n*(2-Math.pow(2,-10*--e))+t}},{key:"expoOut",value:function(e,t,n,i){return e==i?t+n:n*(1-Math.pow(2,-10*e/i))+t}},{key:"circIn",value:function(e,t,n,i){return-n*(Math.sqrt(1-(e/=i)*e)-1)+t}},{key:"circInOut",value:function(e,t,n,i){return(e/=.5*i)<1?.5*-n*(Math.sqrt(1-e*e)-1)+t:.5*n*(Math.sqrt(1-(e-=2)*e)+1)+t}},{key:"circOut",value:function(e,t,n,i){return n*Math.sqrt(1-(e=e/i-1)*e)+t}}]),s}();_n.HALF_PI=.5*Math.PI,_n.PI2=2*Math.PI;var fn=function(){function n(){S(this,n)}return C(n,null,[{key:"isZero",value:function(e){return Math.abs(e)<n.zeroTolerance}},{key:"nearEqual",value:function(e,t){return!!n.isZero(e-t)}},{key:"fastInvSqrt",value:function(e){return n.isZero(e)?e:1/Math.sqrt(e)}}]),n}();fn.zeroTolerance=1e-6,fn.MaxValue=340282347e30,fn.MinValue=-340282347e30;var gn=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;S(this,n),this.x=e,this.y=t}return C(n,[{key:"setValue",value:function(e,t){this.x=e,this.y=t}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.x=e[t+0],this.y=e[t+1]}},{key:"cloneTo",value:function(e){e.x=this.x,e.y=this.y}},{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"forNativeElement",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e?(this.elements=e,this.elements[0]=this.x,this.elements[1]=this.y):this.elements=new Float32Array([this.x,this.y]),n.rewriteNumProperty(this,"x",0),n.rewriteNumProperty(this,"y",1)}}],[{key:"scale",value:function(e,t,n){n.x=e.x*t,n.y=e.y*t}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y}},{key:"normalize",value:function(e,t){var n=e.x,i=e.y,e=n*n+i*i;0<e&&(e=1/Math.sqrt(e),t.x=n*e,t.y=i*e)}},{key:"scalarLength",value:function(e){var t=e.x,e=e.y;return Math.sqrt(t*t+e*e)}},{key:"rewriteNumProperty",value:function(e,t,n){Object.defineProperty(e,t,{get:function(){return this.elements[n]},set:function(e){this.elements[n]=e}})}}]),n}();gn.ZERO=new gn(0,0),gn.ONE=new gn(1,1);var yn=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;S(this,a),this.x=e,this.y=t,this.z=n,this.w=i}return C(a,[{key:"setValue",value:function(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3]}},{key:"cloneTo",value:function(e){e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w}},{key:"clone",value:function(){var e=new a;return this.cloneTo(e),e}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"forNativeElement",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e?(this.elements=e,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z,this.elements[3]=this.w):this.elements=new Float32Array([this.x,this.y,this.z,this.w]),gn.rewriteNumProperty(this,"x",0),gn.rewriteNumProperty(this,"y",1),gn.rewriteNumProperty(this,"z",2),gn.rewriteNumProperty(this,"w",3)}}],[{key:"lerp",value:function(e,t,n,i){var a=e.x,r=e.y,o=e.z,e=e.w;i.x=a+n*(t.x-a),i.y=r+n*(t.y-r),i.z=o+n*(t.z-o),i.w=e+n*(t.w-e)}},{key:"transformByM4x4",value:function(e,t,n){var i=e.x,a=e.y,r=e.z,e=e.w,t=t.elements;n.x=i*t[0]+a*t[4]+r*t[8]+e*t[12],n.y=i*t[1]+a*t[5]+r*t[9]+e*t[13],n.z=i*t[2]+a*t[6]+r*t[10]+e*t[14],n.w=i*t[3]+a*t[7]+r*t[11]+e*t[15]}},{key:"equals",value:function(e,t){return fn.nearEqual(Math.abs(e.x),Math.abs(t.x))&&fn.nearEqual(Math.abs(e.y),Math.abs(t.y))&&fn.nearEqual(Math.abs(e.z),Math.abs(t.z))&&fn.nearEqual(Math.abs(e.w),Math.abs(t.w))}},{key:"normalize",value:function(e,t){var n=e.length();0<n&&(t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n)}},{key:"add",value:function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w}},{key:"subtract",value:function(e,t,n){n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w}},{key:"multiply",value:function(e,t,n){n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n.w=e.w*t.w}},{key:"scale",value:function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t}},{key:"Clamp",value:function(e,t,n,i){var a=e.x,r=e.y,o=e.z,s=e.w,l=t.x,h=t.y,u=t.z,d=t.w,c=n.x,e=n.y,t=n.z,n=n.w;a=(a=c<a?c:a)<l?l:a,r=(r=e<r?e:r)<h?h:r,o=(o=t<o?t:o)<u?u:o,s=(s=n<s?n:s)<d?d:s,i.x=a,i.y=r,i.z=o,i.w=s}},{key:"distanceSquared",value:function(e,t){var n=e.x-t.x,i=e.y-t.y,a=e.z-t.z,t=e.w-t.w;return n*n+i*i+a*a+t*t}},{key:"distance",value:function(e,t){var n=e.x-t.x,i=e.y-t.y,a=e.z-t.z,t=e.w-t.w;return Math.sqrt(n*n+i*i+a*a+t*t)}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}},{key:"min",value:function(e,t,n){n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n.w=Math.min(e.w,t.w)}},{key:"max",value:function(e,t,n){n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n.w=Math.max(e.w,t.w)}}]),a}();yn.ZERO=new yn,yn.ONE=new yn(1,1,1,1),yn.UnitX=new yn(1,0,0,0),yn.UnitY=new yn(0,1,0,0),yn.UnitZ=new yn(0,0,1,0),yn.UnitW=new yn(0,0,0,1);var vn=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;S(this,a),this.x=e,this.y=t,this.z=n}return C(a,[{key:"setValue",value:function(e,t,n){this.x=e,this.y=t,this.z=n}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.x=e[t+0],this.y=e[t+1],this.z=e[t+2]}},{key:"cloneTo",value:function(e){e.x=this.x,e.y=this.y,e.z=this.z}},{key:"clone",value:function(){var e=new a;return this.cloneTo(e),e}},{key:"toDefault",value:function(){this.x=0,this.y=0,this.z=0}},{key:"forNativeElement",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e?(this.elements=e,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z):this.elements=new Float32Array([this.x,this.y,this.z]),gn.rewriteNumProperty(this,"x",0),gn.rewriteNumProperty(this,"y",1),gn.rewriteNumProperty(this,"z",2)}}],[{key:"distanceSquared",value:function(e,t){var n=e.x-t.x,i=e.y-t.y,t=e.z-t.z;return n*n+i*i+t*t}},{key:"distance",value:function(e,t){var n=e.x-t.x,i=e.y-t.y,t=e.z-t.z;return Math.sqrt(n*n+i*i+t*t)}},{key:"min",value:function(e,t,n){n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z)}},{key:"max",value:function(e,t,n){n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z)}},{key:"transformQuat",value:function(e,t,n){var i=e.x,a=e.y,r=e.z,o=t.x,s=t.y,l=t.z,h=t.w,u=h*i+s*r-l*a,e=h*a+l*i-o*r,t=h*r+o*a-s*i,r=-o*i-s*a-l*r;n.x=u*h+r*-o+e*-l-t*-s,n.y=e*h+r*-s+t*-o-u*-l,n.z=t*h+r*-l+u*-s-e*-o}},{key:"scalarLength",value:function(e){var t=e.x,n=e.y,e=e.z;return Math.sqrt(t*t+n*n+e*e)}},{key:"scalarLengthSquared",value:function(e){var t=e.x,n=e.y,e=e.z;return t*t+n*n+e*e}},{key:"normalize",value:function(e,t){var n=e.x,i=e.y,a=e.z,e=n*n+i*i+a*a;0<e&&(e=1/Math.sqrt(e),t.x=n*e,t.y=i*e,t.z=a*e)}},{key:"multiply",value:function(e,t,n){n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z}},{key:"scale",value:function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t}},{key:"lerp",value:function(e,t,n,i){var a=e.x,r=e.y,e=e.z;i.x=a+n*(t.x-a),i.y=r+n*(t.y-r),i.z=e+n*(t.z-e)}},{key:"transformV3ToV3",value:function(e,t,n){var i=a._tempVector4;a.transformV3ToV4(e,t,i),n.x=i.x,n.y=i.y,n.z=i.z}},{key:"transformV3ToV4",value:function(e,t,n){var i=e.x,a=e.y,e=e.z,t=t.elements;n.x=i*t[0]+a*t[4]+e*t[8]+t[12],n.y=i*t[1]+a*t[5]+e*t[9]+t[13],n.z=i*t[2]+a*t[6]+e*t[10]+t[14],n.w=i*t[3]+a*t[7]+e*t[11]+t[15]}},{key:"TransformNormal",value:function(e,t,n){var i=e.x,a=e.y,e=e.z,t=t.elements;n.x=i*t[0]+a*t[4]+e*t[8],n.y=i*t[1]+a*t[5]+e*t[9],n.z=i*t[2]+a*t[6]+e*t[10]}},{key:"transformCoordinate",value:function(e,t,n){var i=e.x,a=e.y,r=e.z,e=t.elements,t=i*e[3]+a*e[7]+r*e[11]+e[15];n.x=i*e[0]+a*e[4]+r*e[8]+e[12]/t,n.y=i*e[1]+a*e[5]+r*e[9]+e[13]/t,n.z=i*e[2]+a*e[6]+r*e[10]+e[14]/t}},{key:"Clamp",value:function(e,t,n,i){var a=e.x,r=e.y,o=e.z,s=t.x,l=t.y,h=t.z,e=n.x,t=n.y,n=n.z;a=(a=e<a?e:a)<s?s:a,r=(r=t<r?t:r)<l?l:r,o=(o=n<o?n:o)<h?h:o,i.x=a,i.y=r,i.z=o}},{key:"add",value:function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z}},{key:"subtract",value:function(e,t,n){n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z}},{key:"cross",value:function(e,t,n){var i=e.x,a=e.y,r=e.z,o=t.x,e=t.y,t=t.z;n.x=a*t-r*e,n.y=r*o-i*t,n.z=i*e-a*o}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}},{key:"equals",value:function(e,t){return fn.nearEqual(e.x,t.x)&&fn.nearEqual(e.y,t.y)&&fn.nearEqual(e.z,t.z)}}]),a}();vn._tempVector4=new yn,vn._ZERO=new vn(0,0,0),vn._ONE=new vn(1,1,1),vn._NegativeUnitX=new vn(-1,0,0),vn._UnitX=new vn(1,0,0),vn._UnitY=new vn(0,1,0),vn._UnitZ=new vn(0,0,1),vn._ForwardRH=new vn(0,0,-1),vn._ForwardLH=new vn(0,0,1),vn._Up=new vn(0,1,0);var pn=function(){function u(){S(this,u),this.gid=0,this.repeat=1,this._count=0}return C(u,[{key:"to",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]&&arguments[6];return this._create(e,t,n,i,a,r,o,!0,!1,!0)}},{key:"from",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]&&arguments[6];return this._create(e,t,n,i,a,r,o,!1,!1,!0)}},{key:"_create",value:function(e,t,n,i,a,r,o,s,l,h){if(!e)throw new Error("Tween:target is null");this._target=e,this._duration=n,this._ease=i||t.ease||u.easeNone,this._complete=a||t.complete,this._delay=r,this._props=[],this._usedTimer=0,this._startTimer=at.now(),this._usedPool=l,this._delayParam=null,this.update=t.update;l=e.$_GID||(e.$_GID=ae.getGID());return u.tweenMap[l]?(o&&u.clearTween(e),u.tweenMap[l].push(this)):u.tweenMap[l]=[this],h?r<=0?this.firstStart(e,t,s):(this._delayParam=[e,t,s],M.timer.once(r,this,this.firstStart,this._delayParam)):this._initProps(e,t,s),this}},{key:"firstStart",value:function(e,t,n){this._delayParam=null,e.destroyed?this.clear():(this._initProps(e,t,n),this._beginLoop())}},{key:"_initProps",value:function(e,t,n){for(var i in t){var a=(n?e:t)[i],r=(n?t:e)[i];"number"==typeof e[i]?this._props.push([i,a,r-a]):e[i]instanceof vn?(a=a.clone(),r=r.clone(),vn.subtract(r,a,r),this._props.push([i,a,r])):e[i]instanceof yn&&(a=a.clone(),r=r.clone(),yn.subtract(r,a,r),this._props.push([i,a,r])),n||(e[i]=a)}}},{key:"_beginLoop",value:function(){M.timer.frameLoop(1,this,this._doEase)}},{key:"_doEase",value:function(){this._updateEase(at.now())}},{key:"_updateEase",value:function(e){var t=this._target;if(t){if(t.destroyed)return u.clearTween(t);e=this._usedTimer=e-this._startTimer-this._delay;if(!(e<0)){if(e>=this._duration)return this.complete();for(var n=0<e?this._ease(e,0,1,this._duration):0,i=this._props,a=0,r=i.length;a<r;a++){var o=i[a];"number"==typeof o[1]?t[o[0]]=o[1]+n*o[2]:o[1]instanceof vn?(t[o[0]].x=o[1].x+n*o[2].x,t[o[0]].y=o[1].y+n*o[2].y,t[o[0]].z=o[1].z+n*o[2].z,t[o[0]]=t[o[0]]):o[1]instanceof yn&&(t[o[0]].x=o[1].x+n*o[2].x,t[o[0]].y=o[1].y+n*o[2].y,t[o[0]].z=o[1].z+n*o[2].z,t[o[0]].w=o[1].w+n*o[2].w,t[o[0]]=t[o[0]])}this.update&&this.update.run()}}}},{key:"complete",value:function(){if(this._target){M.timer.runTimer(this,this.firstStart);for(var e=this._target,t=this._props,n=this._complete,i=0,a=t.length;i<a;i++){var r=t[i];"number"==typeof e[r[0]]?e[r[0]]=r[1]+r[2]:e[r[0]]instanceof vn?(vn.add(r[1],r[2],e[r[0]]),e[r[0]]=e[r[0]]):e[r[0]]instanceof yn&&(yn.add(r[1],r[2],e[r[0]]),e[r[0]]=e[r[0]])}this.update&&this.update.run(),this._count++,0!=this.repeat&&this._count>=this.repeat?(this.clear(),n&&n.run()):this.restart()}}},{key:"pause",value:function(){M.timer.clear(this,this._beginLoop),M.timer.clear(this,this._doEase),M.timer.clear(this,this.firstStart);var e=at.now()-this._startTimer-this._delay;e<0&&(this._usedTimer=e)}},{key:"setStartTime",value:function(e){this._startTimer=e}},{key:"clear",value:function(){this._target&&(this._remove(),this._clear())}},{key:"_clear",value:function(){this.pause(),M.timer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,g.recover("tween",this))}},{key:"recover",value:function(){this._usedPool=!0,this._clear()}},{key:"_remove",value:function(){var e=u.tweenMap[this._target.$_GID];if(e)for(var t=0,n=e.length;t<n;t++)if(e[t]===this){e.splice(t,1);break}}},{key:"restart",value:function(){if(this.pause(),this._usedTimer=0,this._startTimer=at.now(),this._delayParam)M.timer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var e=this._props,t=0,n=e.length;t<n;t++){var i=e[t];this._target[i[0]]=i[1]}M.timer.once(this._delay,this,this._beginLoop)}}},{key:"resume",value:function(){this._usedTimer>=this._duration||(this._startTimer=at.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?M.timer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())}},{key:"progress",set:function(e){e*=this._duration;this._startTimer=at.now()-this._delay-e}}],[{key:"to",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]&&arguments[6],s=!(7<arguments.length&&void 0!==arguments[7])||arguments[7];return g.getItemByClass("tween",u)._create(e,t,n,i,a,r,o,!0,s,!0)}},{key:"from",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]&&arguments[6],s=!(7<arguments.length&&void 0!==arguments[7])||arguments[7];return g.getItemByClass("tween",u)._create(e,t,n,i,a,r,o,!1,s,!0)}},{key:"clearAll",value:function(e){if(e&&e.$_GID){var t=u.tweenMap[e.$_GID];if(t){for(var n=0,i=t.length;n<i;n++)t[n]._clear();t.length=0}}}},{key:"clear",value:function(e){e.clear()}},{key:"clearTween",value:function(e){u.clearAll(e)}},{key:"easeNone",value:function(e,t,n,i){return n*e/i+t}}]),u}();pn.tweenMap=[];var mn=function(){function e(){S(this,e),this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}return C(e,[{key:"start",value:function(e,t,n,i,a,r,o){var s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:.92;this.clearTimer(),this.target=e,this.area=t,this.hasInertia=n,this.elasticDistance=t?i:0,this.elasticBackTime=a,this.data=r,this._disableMouseEvent=o,this.ratio=s,this._parent=e.parent,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,M.stage.on(Je.MOUSE_UP,this,this.onStageMouseUp),M.stage.on(Je.MOUSE_OUT,this,this.onStageMouseUp),M.systemTimer.frameLoop(1,this,this.loop)}},{key:"clearTimer",value:function(){M.systemTimer.clear(this,this.loop),M.systemTimer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)}},{key:"stop",value:function(){this._dragging&&(Xt.instance.disableMouseEvent=!1,M.stage.off(Je.MOUSE_UP,this,this.onStageMouseUp),M.stage.off(Je.MOUSE_OUT,this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())}},{key:"loop",value:function(){var e=this._parent.getMousePoint(),t=e.x,n=e.y,i=t-this._lastX,e=n-this._lastY;if(this._clickOnly){if(!(1<Math.abs(i*M.stage._canvasTransform.getScaleX())||1<Math.abs(e*M.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event(Je.DRAG_START,this.data),Xt.instance.disableMouseEvent=this._disableMouseEvent}else this._offsets.push(i,e);0==i&&0==e||(this._lastX=t,this._lastY=n,this.target.x+=i*this._elasticRateX,this.target.y+=e*this._elasticRateY,this.area&&this.checkArea(),this.target.event(Je.DRAG_MOVE,this.data))}},{key:"checkArea",value:function(){var e;this.elasticDistance<=0?this.backToArea():(e=this.target._x<this.area.x?this.area.x-this.target._x:this.target._x>this.area.x+this.area.width?this.target._x-this.area.x-this.area.width:0,this._elasticRateX=Math.max(0,1-e/this.elasticDistance),e=this.target._y<this.area.y?this.area.y-this.target.y:this.target._y>this.area.y+this.area.height?this.target._y-this.area.y-this.area.height:0,this._elasticRateY=Math.max(0,1-e/this.elasticDistance))}},{key:"backToArea",value:function(){this.target.x=Math.min(Math.max(this.target._x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target._y,this.area.y),this.area.y+this.area.height)}},{key:"onStageMouseUp",value:function(e){if(Xt.instance.disableMouseEvent=!1,M.stage.off(Je.MOUSE_UP,this,this.onStageMouseUp),M.stage.off(Je.MOUSE_OUT,this,this.onStageMouseUp),M.systemTimer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var t=this._offsets.length,n=Math.min(t,6),i=this._offsets.length-n,a=t-1;i<a;a--)this._offsetY+=this._offsets[a--],this._offsetX+=this._offsets[a];this._offsetX=this._offsetX/n*2,this._offsetY=this._offsetY/n*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),M.systemTimer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()}},{key:"checkElastic",value:function(){var e,t=NaN,n=NaN;this.target.x<this.area.x?t=this.area.x:this.target._x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?n=this.area.y:this.target._y>this.area.y+this.area.height&&(n=this.area.y+this.area.height),isNaN(t)&&isNaN(n)?this.clear():(e={},isNaN(t)||(e.x=t),isNaN(n)||(e.y=n),this._tween=pn.to(this.target,e,this.elasticBackTime,_n.sineOut,F.create(this,this.clear),0,!1,!1))}},{key:"tweenMove",value:function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event(Je.DRAG_MOVE,this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(M.systemTimer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())}},{key:"clear",value:function(){var e;this.target&&(this.clearTimer(),e=this.target,this.target=null,this._parent=null,e.event(Je.DRAG_END,this.data))}}]),e}(),wn=function(){function e(){S(this,e),this._id=ae.getGID(),this._resetComp()}return C(e,[{key:"_isScript",value:function(){return!1}},{key:"_resetComp",value:function(){this._indexInList=-1,this._enabled=!0,this._awaked=!1,this.owner=null}},{key:"_getIndexInList",value:function(){return this._indexInList}},{key:"_setIndexInList",value:function(e){this._indexInList=e}},{key:"_onAdded",value:function(){}},{key:"_onAwake",value:function(){}},{key:"_onEnable",value:function(){}},{key:"_onDisable",value:function(){}},{key:"_onDestroy",value:function(){}},{key:"onReset",value:function(){}},{key:"_parse",value:function(e){}},{key:"_cloneTo",value:function(e){}},{key:"_setActive",value:function(e){e?(this._awaked||(this._awaked=!0,this._onAwake()),this._enabled&&this._onEnable()):this._enabled&&this._onDisable()}},{key:"destroy",value:function(){this.owner&&this.owner._destroyComponent(this)}},{key:"_destroy",value:function(){this.owner.activeInHierarchy&&this._enabled&&(this._setActive(!1),this._isScript()&&this.onDisable()),this._onDestroy(),this._destroyed=!0,this.onReset!==e.prototype.onReset?(this.onReset(),this._resetComp(),g.recoverByClass(this)):this._resetComp()}},{key:"id",get:function(){return this._id}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!=e&&(this._enabled=e,this.owner&&(e?this.owner.activeInHierarchy&&this._onEnable():this.owner.activeInHierarchy&&this._onDisable()))}},{key:"isSingleton",get:function(){return!0}},{key:"destroyed",get:function(){return this._destroyed}}]),e}(),xn=function(){T(i,Bt);var t=b(i);function i(){var e;return S(this,i),(e=t.call(this)).wrapMode=0,e._interval=ye.animationInterval,e._isReverse=!1,e._frameRateChanged=!1,e._setBitUp(It.DISPLAY),e}return C(i,[{key:"play",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";this._isPlaying=!0,this._actionName=n,this.index="string"==typeof e?this._getFrameByLabel(e):e,this.loop=t,this._isReverse=this.wrapMode===i.WRAP_REVERSE,0==this.index&&this._isReverse&&(this.index=this.count-1),0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)}},{key:"_getFrameByLabel",value:function(e){for(var t=0;t<this._count;t++){var n=this._labels[t];if(n&&-1<n.indexOf(e))return t}return 0}},{key:"_frameLoop",value:function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event(Je.COMPLETE);this.wrapMode==i.WRAP_PINGPONG?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event(Je.COMPLETE)}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event(Je.COMPLETE);this.wrapMode==i.WRAP_PINGPONG?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event(Je.COMPLETE)}this.index=this._index}},{key:"_setControlNode",value:function(e){this._controlNode&&(this._controlNode.off(Je.DISPLAY,this,this._resumePlay),this._controlNode.off(Je.UNDISPLAY,this,this._resumePlay)),(this._controlNode=e)&&e!=this&&(e.on(Je.DISPLAY,this,this._resumePlay),e.on(Je.UNDISPLAY,this,this._resumePlay))}},{key:"_setDisplay",value:function(e){G(z(i.prototype),"_setDisplay",this).call(this,e),this._resumePlay()}},{key:"_resumePlay",value:function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))}},{key:"stop",value:function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)}},{key:"addLabel",value:function(e,t){this._labels||(this._labels={}),this._labels[t]||(this._labels[t]=[]),this._labels[t].push(e)}},{key:"removeLabel",value:function(e){if(e){if(this._labels)for(var t in this._labels)this._removeLabelFromList(this._labels[t],e)}else this._labels=null}},{key:"_removeLabelFromList",value:function(e,t){if(e)for(var n=e.length-1;0<=n;n--)e[n]==t&&e.splice(n,1)}},{key:"gotoAndStop",value:function(e){this.index="string"==typeof e?this._getFrameByLabel(e):e,this.stop()}},{key:"_displayToIndex",value:function(e){}},{key:"clear",value:function(){return this.stop(),this._labels=null,this}},{key:"interval",get:function(){return this._interval},set:function(e){this._interval!=e&&(this._frameRateChanged=!0,this._interval=e,this._isPlaying&&0<e&&this.timerLoop(e,this,this._frameLoop,null,!0,!0))}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"index",get:function(){return this._index},set:function(e){if(this._index=e,this._displayToIndex(e),this._labels&&this._labels[e])for(var t=this._labels[e],n=0,i=t.length;n<i;n++)this.event(Je.LABEL,t[n])}},{key:"count",get:function(){return this._count}}]),i}();xn.WRAP_POSITIVE=0,xn.WRAP_REVERSE=1,xn.WRAP_PINGPONG=2,Dt.regClass("laya.display.AnimationBase",xn),Dt.regClass("Laya.AnimationBase",xn);var kn=function(){function a(){S(this,a)}return C(a,null,[{key:"subtractVector3",value:function(e,t,n){n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2]}},{key:"lerp",value:function(e,t,n){return e*(1-n)+t*n}},{key:"scaleVector3",value:function(e,t,n){n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t}},{key:"lerpVector3",value:function(e,t,n,i){var a=e[0],r=e[1],e=e[2];i[0]=a+n*(t[0]-a),i[1]=r+n*(t[1]-r),i[2]=e+n*(t[2]-e)}},{key:"lerpVector4",value:function(e,t,n,i){var a=e[0],r=e[1],o=e[2],e=e[3];i[0]=a+n*(t[0]-a),i[1]=r+n*(t[1]-r),i[2]=o+n*(t[2]-o),i[3]=e+n*(t[3]-e)}},{key:"slerpQuaternionArray",value:function(e,t,n,i,a,r,o){var s,l=e[t+0],h=e[t+1],u=e[t+2],d=e[t+3],c=n[i+0],_=n[i+1],e=n[i+2],t=n[i+3],n=l*c+h*_+u*e+d*t;return n<0&&(n=-n,c=-c,_=-_,e=-e,t=-t),a=1e-6<1-n?(i=Math.acos(n),n=Math.sin(i),s=Math.sin((1-a)*i)/n,Math.sin(a*i)/n):(s=1-a,a),r[o+0]=s*l+a*c,r[o+1]=s*h+a*_,r[o+2]=s*u+a*e,r[o+3]=s*d+a*t,r}},{key:"getRotation",value:function(e,t,n,i){return Math.atan2(i-t,n-e)/Math.PI*180}},{key:"sortBigFirst",value:function(e,t){return e==t?0:e<t?1:-1}},{key:"sortSmallFirst",value:function(e,t){return e==t?0:e<t?-1:1}},{key:"sortNumBigFirst",value:function(e,t){return parseFloat(t)-parseFloat(e)}},{key:"sortNumSmallFirst",value:function(e,t){return parseFloat(e)-parseFloat(t)}},{key:"sortByKey",value:function(n){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=e?t?a.sortNumBigFirst:a.sortBigFirst:t?a.sortNumSmallFirst:a.sortSmallFirst;return function(e,t){return i(e[n],t[n])}}}]),a}(),Tn=function(){T(n,xn);var t=b(n);function n(){var e;return S(this,n),e=t.call(this),null===n._sortIndexFun&&(n._sortIndexFun=kn.sortByKey("index",!1,!0)),e}return C(n,[{key:"_setUp",value:function(e,t){this._targetDic=e,this._animationData=t,this.interval=1e3/t.frameRate,t.parsed?(this._count=t.count,this._labels=t.labels,this._usedFrames=t.animationNewFrames):(this._usedFrames=[],this._calculateDatas(),t.parsed=!0,t.labels=this._labels,t.count=this._count,t.animationNewFrames=this._usedFrames)}},{key:"clear",value:function(){return G(z(n.prototype),"clear",this).call(this),this._targetDic=null,this._animationData=null,this}},{key:"_displayToIndex",value:function(e){if(this._animationData){(e=e<0?0:e)>this._count&&(e=this._count);for(var t=this._animationData.nodes,n=t.length,i=0;i<n;i++)this._displayNodeToFrame(t[i],e)}}},{key:"_displayNodeToFrame",value:function(e,t){var n=((2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)||this._targetDic)[e.target];if(n){for(var i,a,r=e.frames,o=e.keys,s=o.length,l=0;l<s;l++)a=(a=r[i=o[l]]).length>t?a[t]:a[a.length-1],n[i]=a;var h,u=e.funkeys;if(0!=(s=u.length))for(l=0;l<s;l++)void 0!==(h=r[i=u[l]])[t]&&n[i]&&n[i].apply(n,h[t])}}},{key:"_calculateDatas",value:function(){if(this._animationData){for(var e,t=this._animationData.nodes,n=t.length,i=this._count=0;i<n;i++)e=t[i],this._calculateKeyFrames(e);this._count+=1}}},{key:"_calculateKeyFrames",value:function(e){var t,n=e.keyframes,i=e.target;for(t in e.frames||(e.frames={}),e.keys?e.keys.length=0:e.keys=[],e.funkeys?e.funkeys.length=0:e.funkeys=[],e.initValues||(e.initValues={}),n){var a=-1!=t.indexOf("()"),r=n[t];if(a&&(t=t.substr(0,t.length-2)),e.frames[t]||(e.frames[t]=[]),a){e.funkeys.push(t);for(var o=e.frames[t],s=0;s<r.length;s++){var l=r[s];o[l.index]=l.value,l.index>this._count&&(this._count=l.index)}}else this._targetDic&&this._targetDic[i]&&(e.initValues[t]=this._targetDic[i][t]),e.keys.push(t),this._calculateNodePropFrames(r,e.frames[t],t,i)}}},{key:"resetNodes",value:function(){if(this._targetDic&&this._animationData)for(var e,t,n=this._animationData.nodes,i=n.length,a=0;a<i;a++)if(t=(e=n[a]).initValues){var r,o=this._targetDic[e.target];if(o)for(r in t)o[r]=t[r]}}},{key:"_calculateNodePropFrames",value:function(e,t,n,i){var a,r=e.length-1;for(t.length=e[r].index+1,a=0;a<r;a++)this._dealKeyFrame(e[a]),this._calculateFrameValues(e[a],e[a+1],t);0==r&&(t[0]=e[0].value,this._usedFrames&&(this._usedFrames[e[0].index]=!0)),this._dealKeyFrame(e[a])}},{key:"_dealKeyFrame",value:function(e){e.label&&""!=e.label&&this.addLabel(e.label,e.index)}},{key:"_calculateFrameValues",value:function(e,t,n){var i,a,r=e.index,o=t.index,s=e.value,l=t.value-e.value,h=o-r,u=this._usedFrames;if(o>this._count&&(this._count=o),e.tween)for(null==(a=_n[e.tweenMethod])&&(a=_n.linearNone),i=r;i<o;i++)n[i]=a(i-r,s,l,h),u&&(u[i]=!0);else for(i=r;i<o;i++)n[i]=s;u&&(u[e.index]=!0,u[t.index]=!0),n[t.index]=t.value}}]),n}();Dt.regClass("laya.display.FrameAnimation",Tn),Dt.regClass("Laya.FrameAnimation",Tn);var En=!!WeakMap,Mn=function(){function i(){S(this,i),this._obj=i.supportWeakMap?new at.window.WeakMap:{},i.supportWeakMap||i._maps.push(this)}return C(i,[{key:"set",value:function(e,t){var n;null!=e&&(i.supportWeakMap?("string"!=typeof(n=e)&&"number"!=typeof e||(n=(n=i._keys[e])||(i._keys[e]={k:e})),this._obj.set(n,t)):"string"==typeof e||"number"==typeof e?this._obj[e]=t:(e.$_GID||(e.$_GID=ae.getGID()),this._obj[e.$_GID]=t))}},{key:"get",value:function(e){if(null==e)return null;if(i.supportWeakMap){var t="string"==typeof e||"number"==typeof e?i._keys[e]:e;return t?this._obj.get(t):null}return"string"==typeof e||"number"==typeof e?this._obj[e]:this._obj[e.$_GID]}},{key:"del",value:function(e){var t;null!=e&&(i.supportWeakMap?(t="string"==typeof e||"number"==typeof e?i._keys[e]:e)&&this._obj.delete(t):"string"==typeof e||"number"==typeof e?delete this._obj[e]:delete this._obj[this._obj.$_GID])}},{key:"has",value:function(e){if(null==e)return!1;if(i.supportWeakMap){var t="string"==typeof e||"number"==typeof e?i._keys[e]:e;return this._obj.has(t)}return"string"==typeof e||"number"==typeof e?null!=this._obj[e]:null!=this._obj[this._obj.$_GID]}}],[{key:"__init__",value:function(){i.I=new i,i.supportWeakMap||M.systemTimer.loop(i.delInterval,null,i.clearCache)}},{key:"clearCache",value:function(){for(var e=0,t=i._maps.length;e<t;e++)i._maps[e]._obj={}}}]),i}();Mn.supportWeakMap=En,Mn.delInterval=6e5,Mn._keys={},Mn._maps=[];var bn=function(){function v(){S(this,v)}return C(v,null,[{key:"__init",value:function(){v._funMap=new Mn}},{key:"getBindFun",value:function(e){var t,n=v._funMap.get(e);return null==n&&(t="(function(data){if(data==null)return;with(data){try{\nreturn "+('"'+e+'"').replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"')+"\n}catch(e){}}})",n=window.Laya._runScript(t),v._funMap.set(e,n)),n}},{key:"createByData",value:function(e,t){var n=In.create();if((e=v.createComp(t,e,e,null,n))._setBit(It.NOT_READY,!0),"_idMap"in e&&(e._idMap=n._idMap),t.animations){for(var i,a,r=[],o=t.animations,s=o.length,l=0;l<s;l++){switch(i=new Tn,a=o[l],i._setUp(n._idMap,a),(e[a.name]=i)._setControlNode(e),a.action){case 1:i.play(0,!1);break;case 2:i.play(0,!0)}r.push(i)}e._aniList=r}return"Scene"===e._$componentType&&0<e._width&&null==t.props.hitTestPrior&&!e.mouseThrough&&(e.hitTestPrior=!0),n.beginLoad(e),e}},{key:"createInitTool",value:function(){return In.create()}},{key:"createComp",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if("Scene3D"==e.type||"Sprite3D"==e.type){var r=[],o=M.Laya.Utils3D._createSceneByJsonForMaker(e,r,a);return"Sprite3D"==e.type?M.Laya.StaticBatchManager.combine(o,r):M.Laya.StaticBatchManager.combine(null,r),o}if(!(t=t||v.getCompInstance(e)))return e.props&&e.props.runtime?console.warn("runtime not found:"+e.props.runtime):console.warn("can not create:"+e.type),null;var s=e.child;if(s)for(var l="List"==t._$componentType,h=0,u=s.length;h<u;h++){var d,c,_=s[h];"itemRender"in t&&("render"==_.props.name||"render"===_.props.renderType)?t.itemRender=_:"Graphic"==_.type?M.ClassUtils._addGraphicsToSprite(_,t):M.ClassUtils._isDrawType(_.type)?M.ClassUtils._addGraphicToSprite(_,t,!0):(l?(c=v.createComp(_,null,n,d=[],a),d.length&&(c._$bindData=d)):c=v.createComp(_,null,n,i,a),"Script"==_.type?c instanceof wn?t._addComponentInstance(c):"owner"in c?c.owner=t:"target"in c&&(c.target=t):"mask"==_.props.renderType||"mask"==_.props.name?t.mask=c:c instanceof Ft&&t.addChild(c))}var f,g=e.props;for(f in g){var y=g[f];"string"==typeof y&&(0<=y.indexOf("@node:")||0<=y.indexOf("@Prefab:"))?a&&a.addNodeRef(t,f,y):v.setCompValue(t,f,y,n,i)}return t._afterInited&&t._afterInited(),e.compId&&a&&a._idMap&&(a._idMap[e.compId]=t),t}},{key:"setCompValue",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if("string"==typeof n&&-1<n.indexOf("${"))if(v._sheet=v._sheet||M.ClassUtils.getClass("laya.data.Table")){if(a)a.push(e,t,n);else if(i){-1==n.indexOf("].")&&(n=n.replace(".","[0]."));var r,o=new Sn(e,t,n);o.exe(i);for(var s=n.replace(/\[.*?\]\./g,".");null!=(r=v._parseWatchData.exec(s));){for(var l=r[1];null!=(h=v._parseKeyWord.exec(l));){var h=h[0],u=i._watchMap[h]||(i._watchMap[h]=[]);u.push(o),v._sheet.I.notifer.on(h,i,i.changeData,[h])}(u=i._watchMap[l]||(i._watchMap[l]=[])).push(o),v._sheet.I.notifer.on(l,i,i.changeData,[l])}}}else console.warn("Can not find class Sheet");else"var"===t&&i?i[n]=e:e[t]="true"===n||"false"!==n&&n}},{key:"getCompInstance",value:function(e){if("UIView"==e.type&&e.props&&e.props.pageData)return v.createByData(null,e.props.pageData);var t=e.props&&e.props.runtime||e.type,n=M.ClassUtils.getClass(t);if(!n)throw"Can not find class "+t;if("Script"===e.type&&n.prototype._doAwake){t=g.createByClass(n);return t._destroyed=!1,t}return e.props&&"renderType"in e.props&&"instance"==e.props.renderType?(n.instance||(n.instance=new n),n.instance):new n}}]),v}();bn._parseWatchData=/\${(.*?)}/g,bn._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g;var Sn=function(){function i(e,t,n){S(this,i),this.comp=e,this.prop=t,this.value=n}return C(i,[{key:"exe",value:function(e){var t=bn.getBindFun(this.value);this.comp[this.prop]=t.call(this,e)}}]),i}(),In=function(){function t(){S(this,t)}return C(t,[{key:"reset",value:function(){this._nodeRefList=null,this._initList=null,this._idMap=null,this._loadList=null,this._scene=null}},{key:"recover",value:function(){this.reset(),g.recover("InitTool",this)}},{key:"addLoadRes",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._loadList||(this._loadList=[]),t?this._loadList.push({url:e,type:t}):this._loadList.push(e)}},{key:"addNodeRef",value:function(e,t,n){this._nodeRefList||(this._nodeRefList=[]),this._nodeRefList.push([e,t,n]),0<=n.indexOf("@Prefab:")&&this.addLoadRes(n.replace("@Prefab:",""),on.PREFAB)}},{key:"setNodeRef",value:function(){if(this._nodeRefList)if(this._idMap){for(var e,t=this._nodeRefList.length,n=0;n<t;n++)(e=this._nodeRefList[n])[0][e[1]]=this.getReferData(e[2]);this._nodeRefList=null}else this._nodeRefList=null}},{key:"getReferData",value:function(e){if(0<=e.indexOf("@Prefab:"))return on.getRes(e.replace("@Prefab:",""));if(0<=e.indexOf("@arr:")){for(var t,n,i=(t=(e=e.replace("@arr:","")).split(",")).length,a=0;a<i;a++)n=t[a],t[a]=n?this._idMap[n.replace("@node:","")]:null;return t}return this._idMap[e.replace("@node:","")]}},{key:"addInitItem",value:function(e){this._initList||(this._initList=[]),this._initList.push(e)}},{key:"doInits",value:function(){this._initList&&(this._initList=null)}},{key:"finish",value:function(){this.setNodeRef(),this.doInits(),this._scene._setBit(It.NOT_READY,!1),this._scene.parent&&this._scene.parent.activeInHierarchy&&this._scene.active&&this._scene._processActive(),this._scene.event("onViewCreated"),this.recover()}},{key:"beginLoad",value:function(e){this._scene=e,!this._loadList||this._loadList.length<1?this.finish():M.loader.load(this._loadList,F.create(this,this.finish))}}],[{key:"create",value:function(){var e=g.getItemByClass("InitTool",t);return e._idMap=[],e}}]),t}(),Nn=function(){function e(){S(this,e)}return C(e,[{key:"show",value:function(){}},{key:"enable",value:function(){}},{key:"hide",value:function(){}},{key:"set_onclick",value:function(e){}},{key:"isCanvasRender",value:function(){return!0}},{key:"renderNotCanvas",value:function(e,t,n){}}]),e}(),Rn=function(){T(o,Nn);var t=b(o);function o(){var e;return S(this,o),(e=t.apply(this,arguments))._show=!1,e._useCanvas=!1,e._height=100,e._view=[],e}return C(o,[{key:"show",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;at.onMiniGame||M.Render.isConchApp||at.onBDMiniGame||at.onKGMiniGame||at.onQGMiniGame||at.onQQMiniGame||at.onAlipayMiniGame||(this._useCanvas=!0),this._show=!0,J._fpsData.length=60,this._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},this._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},this._view[2]={title:"RenderBatches",value:"renderBatches",color:"white",units:"int"},this._view[3]={title:"SavedRenderBatches",value:"savedRenderBatches",color:"white",units:"int"},this._view[4]={title:"CPUMemory",value:"cpuMemory",color:"yellow",units:"M"},this._view[5]={title:"GPUMemory",value:"gpuMemory",color:"yellow",units:"M"},this._view[6]={title:"Shader",value:"shaderCall",color:"white",units:"int"},yt.is3DMode?(this._view[0].title="FPS(3D)",this._view[7]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},this._view[8]={title:"FrustumCulling",value:"frustumCulling",color:"white",units:"int"},this._view[9]={title:"OctreeNodeCulling",value:"octreeNodeCulling",color:"white",units:"int"}):(this._view[0].title="FPS(WebGL)",this._view[7]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"}),this._useCanvas?this.createUIPre(e,t):this.createUI(e,t),this.enable()}},{key:"createUIPre",value:function(e,t){var n=at.pixelRatio;this._width=180*n,this._vx=120*n,this._height=n*(12*this._view.length+3*n)+4,o._fontSize=12*n;for(var i=0;i<this._view.length;i++)this._view[i].x=4,this._view[i].y=i*o._fontSize+2*n;this._canvas||(this._canvas=new Ct(!0),this._canvas.size(this._width,this._height),this._ctx=this._canvas.getContext("2d"),this._ctx.textBaseline="top",this._ctx.font=o._fontSize+"px Arial",this._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+e+"px;top:"+t+"px;width:"+this._width/n+"px;height:"+this._height/n+"px;"),at.onKGMiniGame||at.container.appendChild(this._canvas.source),this._first=!0,this.loop(),this._first=!1}},{key:"createUI",value:function(e,t){var n=this._sp,i=at.pixelRatio;n||(n=new Bt,this._leftText=new Ut,this._leftText.pos(5,5),this._leftText.color="#ffffff",n.addChild(this._leftText),this._txt=new Ut,this._txt.pos(130*i,5),this._txt.color="#ffffff",n.addChild(this._txt),this._sp=n),n.pos(e,t);for(var a="",r=0;r<this._view.length;r++)a+=this._view[r].title+"\n";this._leftText.text=a;e=138*i,t=i*(12*this._view.length+3*i)+4;this._txt.fontSize=o._fontSize*i,this._leftText.fontSize=o._fontSize*i,n.size(e,t),n.graphics.clear(),n.graphics.alpha(.5),n.graphics.drawRect(0,0,110+e,30+t,"#999999"),n.graphics.alpha(2),this.loop()}},{key:"enable",value:function(){M.systemTimer.frameLoop(1,this,this.loop)}},{key:"hide",value:function(){this._show=!1,M.systemTimer.clear(this,this.loop),this._canvas&&at.removeElement(this._canvas.source)}},{key:"set_onclick",value:function(e){this._sp&&this._sp.on("click",this._sp,e),this._canvas&&(this._canvas.source.onclick=e,this._canvas.source.style.pointerEvents="")}},{key:"loop",value:function(){J._count++;var e,t=at.now();t-J._timer<1e3||(e=J._count,J.FPS=Math.round(1e3*e/(t-J._timer)),this._show&&(J.trianglesFaces=Math.round(J.trianglesFaces/e),this._useCanvas?J.renderBatches=Math.round(J.renderBatches/e):J.renderBatches=Math.round(J.renderBatches/e)-1,J.savedRenderBatches=Math.round(J.savedRenderBatches/e),J.shaderCall=Math.round(J.shaderCall/e),J.spriteRenderUseCacheCount=Math.round(J.spriteRenderUseCacheCount/e),J.canvasNormal=Math.round(J.canvasNormal/e),J.canvasBitmap=Math.round(J.canvasBitmap/e),J.canvasReCache=Math.ceil(J.canvasReCache/e),J.frustumCulling=Math.round(J.frustumCulling/e),J.octreeNodeCulling=Math.round(J.octreeNodeCulling/e),e=0<J.FPS?Math.floor(1e3/J.FPS).toString():" ",J._fpsStr=J.FPS+(J.renderSlow?" slow":"")+" "+e,J._spriteStr=J.spriteCount+(J.spriteRenderUseCacheCount?"/"+J.spriteRenderUseCacheCount:""),J._canvasStr=J.canvasReCache+"/"+J.canvasNormal+"/"+J.canvasBitmap,J.cpuMemory=V.cpuMemory,J.gpuMemory=V.gpuMemory,this._useCanvas?this.renderInfoPre():this.renderInfo(),J.clear()),J._count=0,J._timer=t)}},{key:"renderInfoPre",value:function(){var e,t,n=0;if(this._canvas){var i=this._ctx;for(i.clearRect(this._first?0:this._vx,0,this._width,this._height),n=0;n<this._view.length;n++)e=this._view[n],this._first&&(i.fillStyle="white",i.fillText(e.title,e.x,e.y)),i.fillStyle=e.color,t=J[e.value],"M"==e.units&&(t=Math.floor(t/1048576*100)/100+" M"),i.fillText(t+"",e.x+this._vx,e.y)}}},{key:"renderInfo",value:function(){for(var e="",t=0;t<this._view.length;t++){var n=this._view[t],i=J[n.value];"M"==n.units&&(i=Math.floor(i/1048576*100)/100+" M"),e+=(i="K"==n.units?Math.floor(i/1024*100)/100+" K":i)+"\n"}this._txt.text=e}},{key:"isCanvasRender",value:function(){return this._useCanvas}},{key:"renderNotCanvas",value:function(e,t,n){this._show&&this._sp&&this._sp.render(e,0,0)}}]),o}();Rn._fontSize=12;var Cn=function(){function l(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];S(this,l),this.scale=1,this.currTimer=Date.now(),this.currFrame=0,this._delta=0,this._lastTimer=Date.now(),this._map=[],this._handlers=[],this._temp=[],this._count=0,e&&l.gSysTimer&&l.gSysTimer.frameLoop(1,this,this._update)}return C(l,[{key:"_update",value:function(){if(this.scale<=0)return this._lastTimer=Date.now(),void(this._delta=0);var e=this.currFrame=this.currFrame+this.scale,t=Date.now(),n=3e4<t-this._lastTimer;this._delta=(t-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=t;for(var a=this._handlers,r=this._count=0,o=a.length;r<o;r++){var s=a[r];if(null!==s.method){var l=s.userFrame?e:i;if(l>=s.exeTime)if(s.repeat)if(!s.jumpFrame||n)s.exeTime+=s.delay,s.run(!1),l>s.exeTime&&(s.exeTime+=Math.ceil((l-s.exeTime)/s.delay)*s.delay);else for(;l>=s.exeTime;)s.exeTime+=s.delay,s.run(!1);else s.run(!0)}else this._count++}(30<this._count||e%200==0)&&this._clearHandlers()}},{key:"_clearHandlers",value:function(){for(var e=this._handlers,t=0,n=e.length;t<n;t++){var i=e[t];null!==i.method?this._temp.push(i):this._recoverHandler(i)}this._handlers=this._temp,e.length=0,this._temp=e}},{key:"_recoverHandler",value:function(e){this._map[e.key]==e&&(this._map[e.key]=null),e.clear(),l._pool.push(e)}},{key:"_create",value:function(e,t,n,i,a,r,o){if(!n)return a.apply(i,r),null;if(o){var s=this._getHandler(i,a);if(s)return s.repeat=t,s.userFrame=e,s.delay=n,s.caller=i,s.method=a,s.args=r,s.exeTime=n+(e?this.currFrame:this.currTimer+Date.now()-this._lastTimer),s}return(s=0<l._pool.length?l._pool.pop():new An).repeat=t,s.userFrame=e,s.delay=n,s.caller=i,s.method=a,s.args=r,s.exeTime=n+(e?this.currFrame:this.currTimer+Date.now()-this._lastTimer),this._indexHandler(s),this._handlers.push(s),s}},{key:"_indexHandler",value:function(e){var t=e.caller,n=e.method,t=t?t.$_GID||(t.$_GID=M.Utils.getGID()):0,n=n.$_TID||(n.$_TID=1e5*l._mid++);e.key=t+n,this._map[e.key]=e}},{key:"once",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];this._create(!1,!1,e,t,n,i,a)}},{key:"loop",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],r=5<arguments.length&&void 0!==arguments[5]&&arguments[5],a=this._create(!1,!0,e,t,n,i,a);a&&(a.jumpFrame=r)}},{key:"frameOnce",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];this._create(!0,!1,e,t,n,i,a)}},{key:"frameLoop",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];this._create(!0,!0,e,t,n,i,a)}},{key:"toString",value:function(){return" handlers:"+this._handlers.length+" pool:"+l._pool.length}},{key:"clear",value:function(e,t){t=this._getHandler(e,t);t&&(this._map[t.key]=null,t.key=0,t.clear())}},{key:"clearAll",value:function(e){if(e)for(var t=0,n=this._handlers.length;t<n;t++){var i=this._handlers[t];i.caller===e&&(this._map[i.key]=null,i.key=0,i.clear())}}},{key:"_getHandler",value:function(e,t){e=e?e.$_GID||(e.$_GID=M.Utils.getGID()):0,t=t.$_TID||(t.$_TID=1e5*l._mid++);return this._map[e+t]}},{key:"callLater",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;Ht.I.callLater(e,t,n)}},{key:"runCallLater",value:function(e,t){Ht.I.runCallLater(e,t)}},{key:"runTimer",value:function(e,t){t=this._getHandler(e,t);t&&null!=t.method&&(this._map[t.key]=null,t.run(!0))}},{key:"pause",value:function(){this.scale=0}},{key:"resume",value:function(){this.scale=1}},{key:"delta",get:function(){return this._delta}}]),l}();Cn.gSysTimer=null,Cn._pool=[],Cn._mid=1;var An=function(){function e(){S(this,e)}return C(e,[{key:"clear",value:function(){this.caller=null,this.method=null,this.args=null}},{key:"run",value:function(e){var t=this.caller;if(t&&t.destroyed)return this.clear();var n=this.method,i=this.args;e&&this.clear(),null!=n&&(i?n.apply(t,i):n.call(t))}}]),e}(),Dn=function(){T(r,ee);var a=b(r);function r(e){var t;S(this,r),(t=a.call(this,Q.SKINMESH,0)).offsetX=300,t.offsetY=0;var n=y.mainContext,i=8*Xe.BYTES_PE;return t.position=[2,n.FLOAT,!1,i,0],t.texcoord=[2,n.FLOAT,!1,i,2*Xe.BYTES_PE],t.color=[4,n.FLOAT,!1,i,4*Xe.BYTES_PE],t}return r}(),Ln=function(){T(i,ee);var n=b(i);function i(e){var t;return S(this,i),(t=n.call(this,Q.PRIMITIVE,0))._attribLocation=["position",0,"attribColor",1],t}return i}(),On=function(){T(n,ee);var t=b(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return S(this,n),(e=t.call(this,Q.TEXTURE2D,e)).strength=0,e.blurInfo=null,e.colorMat=null,e.colorAlpha=null,e._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2],e}return C(n,[{key:"clear",value:function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(dt.shaderHighPrecision?Q.SHADERDEFINE_FSHIGHPRECISION:0)}}]),n}(),Pn=function(){function r(e){S(this,r),this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=e;for(var t,n,i=0;!((i=e.indexOf("#begin",i))<0);){for(n=i+5;!((n=e.indexOf("#end",n))<0)&&"i"===e.charAt(n+4);)n+=5;if(n<0)throw"add include err,no #end:"+e;t=e.indexOf("\n",i);var a=M.ShaderCompile.splitToWords(e.substr(i,t-i),null);"code"==a[1]?this.codes[a[2]]=e.substr(t+1,n-t-1):"function"==a[1]&&(t=e.indexOf("function",i),t+="function".length,this.funs[a[3]]=e.substr(t+1,n-t-1),this.funnames+=a[3]+";"),i=n+1}}return C(r,[{key:"getWith",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=e?this.codes[e]:this.script;if(!t)throw"get with error:"+e;return t}},{key:"getFunsScript",value:function(e){var t,n="";for(t in this.funs)0<=e.indexOf(t+";")&&(n+=this.funs[t]);return n}}]),r}(),Fn=function(){function n(e){S(this,n),this.childs=[],this.text="",this.useFuns="",this.z=0,this.includefiles=e}return C(n,[{key:"setParent",value:function(e){e.childs.push(this),this.z=e.z+1,this.parent=e}},{key:"setCondition",value:function(e,t){e&&(this.conditionType=t,e=e.replace(/(\s*$)/g,""),this.condition=function(){return this[e]},this.condition.__condition=e)}},{key:"toscript",value:function(e,t){return this._toscript(e,t,++n.__id)}},{key:"_toscript",value:function(i,a,r){if(this.childs.length<1&&!this.text)return a;a.length;if(this.condition){var e=!!this.condition.call(i);if(!(e=this.conditionType===M.ShaderCompile.IFDEF_ELSE?!e:e))return a}if(this.text&&a.push(this.text),0<this.childs.length&&this.childs.forEach(function(e,t,n){e._toscript(i,a,r)}),0<this.includefiles.length&&0<this.useFuns.length)for(var t,n=0,o=this.includefiles.length;n<o;n++)this.includefiles[n].curUseID!=r&&0<(t=this.includefiles[n].file.getFunsScript(this.useFuns)).length&&(this.includefiles[n].curUseID=r,a[0]=t+a[0]);return a}}]),n}();Fn.__id=1;var Bn=function(){function v(e,t,n){S(this,v),this.defs={};var i=this;function a(e){e=e.replace(v._clearCR,"");var t=[],n=new Fn(t);return i._compileToTree(n,e.split("\n"),0,t,i.defs),n}var r=Date.now();this._VS=a(e),this._PS=a(t),this._nameMap=n,2<Date.now()-r&&console.log("ShaderCompile use time:"+(Date.now()-r)+"  size:"+e.length+"/"+t.length)}return C(v,[{key:"_compileToTree",value:function(e,t,n,i,a){for(var r,o,s,l,h,u,d,c,_,f=n;f<t.length;f++)if(s=t[f],!(s.length<1)&&0!==(h=s.indexOf("//"))){if(0<=h&&(s=s.substr(0,h)),r=d||new Fn(i),d=null,r.text=s,r.noCompile=!0,0<=(h=s.indexOf("#"))){for(l="#",_=h+1,c=s.length;_<c;_++){var g=s.charAt(_);if(" "===g||"\t"===g||"?"===g)break;l+=g}switch(r.name=l){case"#ifdef":case"#ifndef":if(r.src=s,r.noCompile=null!=s.match(/[!&|()=<>]/),r.noCompile?console.log("function():Boolean{return "+s.substr(h+r.name.length)+"}"):(u=s.replace(/^\s*/,"").split(/\s+/),r.setCondition(u[1],"#ifdef"===l?v.IFDEF_YES:v.IFDEF_ELSE),r.text="//"+r.text),r.setParent(e),e=r,a)for(u=s.substr(_).split(v._splitToWordExps3),_=0;_<u.length;_++)(s=u[_]).length&&(a[s]=!0);continue;case"#if":if(r.src=s,r.noCompile=!0,r.setParent(e),e=r,a)for(u=s.substr(_).split(v._splitToWordExps3),_=0;_<u.length;_++)(s=u[_]).length&&"defined"!=s&&(a[s]=!0);continue;case"#else":r.src=s,o=(e=e.parent).childs[e.childs.length-1],r.noCompile=o.noCompile,r.noCompile||(r.condition=o.condition,r.conditionType=o.conditionType==v.IFDEF_YES?v.IFDEF_ELSE:v.IFDEF_YES,r.text="//"+r.text+" "+o.text+" "+r.conditionType),r.setParent(e),e=r;continue;case"#endif":o=(e=e.parent).childs[e.childs.length-1],r.noCompile=o.noCompile,r.noCompile||(r.text="//"+r.text),r.setParent(e);continue;case"#include":u=v.splitToWords(s,null);var y=v.includes[u[1]];if(!y)throw"ShaderCompile error no this include file:"+u[1];if((h=u[0].indexOf("?"))<0){r.setParent(e),s=y.getWith("with"==u[2]?u[3]:null),this._compileToTree(r,s.split("\n"),0,i,a),r.text="";continue}r.setCondition(u[0].substr(h+1),v.IFDEF_YES),r.text=y.getWith("with"==u[2]?u[3]:null);break;case"#import":y=(u=v.splitToWords(s,null))[1],i.push({node:r,file:v.includes[y],ofs:r.text.length});continue}}else{if((o=e.childs[e.childs.length-1])&&!o.name){0<i.length&&v.splitToWords(s,o),d=r,o.text+="\n"+s;continue}0<i.length&&v.splitToWords(s,r)}r.setParent(e)}}},{key:"createShader",value:function(e,t,n,i){var a={},r="";if(e)for(var o in e)r+="#define "+o+"\n",a[o]=!0;var s=this._VS.toscript(a,[]),e=this._PS.toscript(a,[]);return(n||$.create)(r+s.join("\n"),r+e.join("\n"),t,this._nameMap,i)}}],[{key:"__init__",value:function(){var e=P.instance;v.shaderParamsMap={float:e.FLOAT,int:e.INT,bool:e.BOOL,vec2:e.FLOAT_VEC2,vec3:e.FLOAT_VEC3,vec4:e.FLOAT_VEC4,ivec2:e.INT_VEC2,ivec3:e.INT_VEC3,ivec4:e.INT_VEC4,bvec2:e.BOOL_VEC2,bvec3:e.BOOL_VEC3,bvec4:e.BOOL_VEC4,mat2:e.FLOAT_MAT2,mat3:e.FLOAT_MAT3,mat4:e.FLOAT_MAT4,sampler2D:e.SAMPLER_2D,samplerCube:e.SAMPLER_CUBE}}},{key:"_parseOne",value:function(e,t,n,i,a,r){var o={type:v.shaderParamsMap[n[i+1]],name:n[i+2],size:isNaN(parseInt(n[i+3]))?1:parseInt(n[i+3])};return r&&("attribute"==a?e:t).push(o),":"==n[i+3]&&(o.type=n[i+4],i+=2),i+=2}},{key:"addInclude",value:function(e,t){if(!t||0===t.length)throw new Error("add shader include file err:"+e);if(v.includes[e])throw new Error("add shader include file err, has add:"+e);v.includes[e]=new Pn(t)}},{key:"preGetParams",value:function(e,t){var n=[e,t],t={},i=[],a=[],r={},o=[];t.attributes=i,t.uniforms=a,t.defines=r;for(var s=0;s<2;s++){n[s]=n[s].replace(v._removeAnnotation,"");for(var l,h=n[s].match(v._reg),u=0,d=h.length;u<d;u++){var c=h[u];if("attribute"==c||"uniform"==c)u=v._parseOne(i,a,h,u,c,!0);else if("#define"!=c){if("#ifdef"==c){r[l=h[++u]]=r[l]||[];for(u++;u<d;u++)if("attribute"==(c=h[u])||"uniform"==c)u=v._parseOne(i,a,h,u,c,o[l]);else if("#else"==c)for(u++;u<d;u++)if("attribute"==(c=h[u])||"uniform"==c)u=v._parseOne(i,a,h,u,c,!o[l]);else if("#endif"==c)break}}else o[c=h[++u]]=1}}return t}},{key:"splitToWords",value:function(e,t){for(var n,i=[],a=-1,r=0,o=e.length;r<o;r++)if(s=e.charAt(r),0<=" \t=+-*/&%!<>()'\",;".indexOf(s))if(0<=a&&1<r-a&&(n=e.substr(a,r-a),i.push(n)),'"'!=s&&"'"!=s)"("==s&&t&&0<i.length&&(n=i[i.length-1]+";","vec4;main;".indexOf(n)<0&&(t.useFuns+=n)),a=-1;else{var s=e.indexOf(s,r+1);if(s<0)throw"Sharder err:"+e;i.push(e.substr(r+1,s-r-1)),r=s,a=-1}else a<0&&(a=r);return a<o&&1<o-a&&(n=e.substr(a,o-a),i.push(n)),i}}]),v}();Bn.IFDEF_NO=0,Bn.IFDEF_YES=1,Bn.IFDEF_ELSE=2,Bn.IFDEF_PARENT=3,Bn._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),Bn._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),Bn._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),Bn.includes={},Bn._clearCR=new RegExp("\r","g"),Bn._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g"),(e=function(){T(a,d);var n=b(a);function a(){var e;S(this,a),(e=n.call(this)).worker=new Worker(a.workerPath);var t=u(e);return e.worker.onmessage=function(e){t.workerMessage(e.data)},e}return C(a,[{key:"workerMessage",value:function(e){if(e)switch(e.type){case"Image":this.imageLoaded(e);break;case"Disable":a.enable=!1}}},{key:"imageLoaded",value:function(e){var t,n;e.dataType&&"imageBitmap"==e.dataType?(t=e.imageBitmap,(n=new X).loadImageSource(t),console.log("load:",e.url),this.event(e.url,n)):this.event(e.url,null)}},{key:"loadImage",value:function(e){this.worker.postMessage(e)}},{key:"_loadImage",value:function(t){var n,i=this;this._useWorkerLoader&&a._enable?(t=B.formatURL(t),n=function(e){a.I.off(t,i,n),e?i.onLoaded(e):a._preLoadFun.call(i,t)},a.I.on(t,i,n),a.I.loadImage(t)):a._preLoadFun.call(i,t)}}],[{key:"__init__",value:function(){return null==a._preLoadFun&&(!!Worker&&(a._preLoadFun=on.prototype._loadImage,on.prototype._loadImage=a.prototype._loadImage,a.I||(a.I=new a),!0))}},{key:"workerSupported",value:function(){return!!Worker}},{key:"enableWorkerLoader",value:function(){a._tryEnabled||(a.enable=!0,a._tryEnabled=!0)}},{key:"enable",set:function(e){a._enable!=e&&(a._enable=e)&&null==a._preLoadFun&&(a._enable=a.__init__())},get:function(){return a._enable}}]),a}()).workerPath="libs/workerloader.js",e._enable=!1,e._tryEnabled=!1;var Vn=function(){function t(){S(this,t)}return C(t,null,[{key:"__init__",value:function(){}},{key:"hide",value:function(){"none"!=t.cursor&&(t._preCursor=t.cursor,t.cursor="none")}},{key:"show",value:function(){"none"==t.cursor&&(t.cursor=t._preCursor||"auto")}},{key:"cursor",set:function(e){t._style.cursor=e},get:function(){return t._style.cursor}}]),t}(),Un=function(){T(i,De);var n=b(i);function i(e){var t;return S(this,i),(t=n.call(this,i.const_stride,4*e*i.const_stride,4)).canReuse=!0,t.setAttributes(i._fixattriInfo),t.createQuadIB(e),t._quadNum=e,t}return C(i,[{key:"setMaxParticleNum",value:function(e){this._vb._resizeBuffer(4*e*i.const_stride,!1),this.createQuadIB(e)}},{key:"releaseMesh",value:function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,i._POOL.push(this)}},{key:"destroy",value:function(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()}}],[{key:"__init__",value:function(){var e=P.instance;i._fixattriInfo=[e.FLOAT,4,0,e.FLOAT,3,16,e.FLOAT,3,28,e.FLOAT,4,40,e.FLOAT,4,56,e.FLOAT,3,72,e.FLOAT,2,84,e.FLOAT,4,92,e.FLOAT,1,108,e.FLOAT,1,112]}},{key:"getAMesh",value:function(e){if(i._POOL.length){var t=i._POOL.pop();return t.setMaxParticleNum(e),t}return new i(e)}}]),i}();Un.const_stride=116,Un._POOL=[],(En=function(){T(t,v);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}()).create=function(e,t,n){n=new X(e,t,n,!1,!1);return n.wrapModeU=U.WARPMODE_CLAMP,n.wrapModeV=U.WARPMODE_CLAMP,n};var zn=function(){function h(){S(this,h)}return C(h,null,[{key:"__init",value:function(e){e.forEach(function(e){e.__init$&&e.__init$()})}},{key:"init",value:function(e,t){if(!h._isinit){h._isinit=!0,ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=h._arrayBufferSlice),at.__init__();var n=at.mainCanvas=new Ct(!0),i=n.source.style;i.position="absolute",i.top=i.left="0px",i.background="#000000",at.onKGMiniGame||at.onAlipayMiniGame||at.container.appendChild(n.source),at.canvas=new Ct(!0),at.context=at.canvas.getContext("2d"),at.supportWebAudio=en.__init__(),at.supportLocalStorage=un.__init__(),h.systemTimer=new Cn(!1),Cn.gSysTimer=h.systemTimer,h.startTimer=new Cn(!1),h.physicsTimer=new Cn(!1),h.updateTimer=new Cn(!1),h.lateTimer=new Cn(!1),h.timer=new Cn(!1),M.startTimer=h.startTimer,M.lateTimer=h.lateTimer,M.updateTimer=h.updateTimer,M.systemTimer=h.systemTimer,M.timer=h.timer,M.physicsTimer=h.physicsTimer,h.loader=new ln,M.Laya=h,M.loader=h.loader,Mn.__init__(),bn.__init(),Vn.__init__(),dt.inner_enable();for(var a=arguments.length,r=new Array(2<a?a-2:0),o=2;o<a;o++)r[o-2]=arguments[o];if(r)for(var s=0,l=r.length;s<l;s++)r[s]&&r[s].enable&&r[s].enable();return M.Render.isConchApp&&h.enableNative(),h.enableWebGLPlus(),Mt.beginCheck(),Gn=h.stage=new jt,M.stage=h.stage,ae.gStage=h.stage,B.rootPath=B._basePath=h._getUrlPath(),Le.__int__(),Pe.__init__(),Oe.__init__(),h.render=new yt(0,0,at.mainCanvas),h.stage.size(e,t),window.stage=h.stage,y.__init__(),Un.__init__(),Bn.__init__(),Rt.__init__(),qt.__init__(),Xt.instance.__init__(h.stage,yt.canvas),zt.__init__(),en.autoStopMusic=!0,J._StatRender=new Rn,ee._initone(Q.TEXTURE2D,On),ee._initone(Q.TEXTURE2D|Q.FILTERGLOW,On),ee._initone(Q.PRIMITIVE,Ln),ee._initone(Q.SKINMESH,Dn),yt.canvas}}},{key:"_getUrlPath",value:function(){var e=at.window.location,t=":"==(t=e.pathname).charAt(2)?t.substring(1):t;return B.getPath("file:"==e.protocol?t:e.protocol+"//"+e.host+e.pathname)}},{key:"_arrayBufferSlice",value:function(e,t){t=new Uint8Array(this,e,t-e),e=new Uint8Array(t.length);return e.set(t),e.buffer}},{key:"_runScript",value:function(e){return at.window[h._evcode](e)}},{key:"enableDebugPanel",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"libs/laya.debugtool.js";window.Laya.DebugPanel?window.Laya.DebugPanel.enable():((e=at.createElement("script")).onload=function(){window.Laya.DebugPanel.enable()},e.src=t,at.document.body.appendChild(e))}},{key:"enableWebGLPlus",value:function(){y.__init_native()}},{key:"enableNative",value:function(){h.isNativeRender_enable||(h.isNativeRender_enable=!0,$.prototype.uploadTexture2D=function(e){var t=P.instance;t.bindTexture(t.TEXTURE_2D,e)},j.width=at.window.innerWidth,j.height=at.window.innerHeight,at.measureText=function(e,t){return window.conchTextCanvas.font=t,window.conchTextCanvas.measureText(e)},jt.clear=function(e){lt.set2DRenderConfig();var t=re.create(e).arrColor,e=P.instance;t&&e.clearColor(t[0],t[1],t[2],t[3]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),j.clear()},Bt.drawToCanvas=Bt.drawToTexture=function(e,t,n,i,a,r){a-=e.x,r-=e.y,a|=0,r|=0,n|=0,i|=0;var o=new Ct(!1),s=o.getContext("2d");return o.size(n,i),s.asBitmap=!0,s._targets.start(),Rt.renders[t]._fun(e,s,a,r),s.flush(),s._targets.end(),s._targets.restore(),o},Object.defineProperty(q.prototype,"uv",{get:function(){return this._uv},set:function(e){this._uv=e}}),Ct.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=q.flipyuv,this._texture.bitmap=this._texture),this._texture})}},{key:"alertGlobalError",set:function(e){var r=0;at.window.onerror=e?function(e,t,n,i,a){r++<5&&a&&this.alert("出错啦，请把此信息截图给研发商\n"+e+"\n"+a.stack)}:null}}]),h}();zn.stage=null,zn.systemTimer=null,zn.startTimer=null,zn.physicsTimer=null,zn.updateTimer=null,zn.lateTimer=null,zn.timer=null,zn.loader=null,zn.version="2.3.0beta1",zn._isinit=!1,zn.isWXOpenDataContext=!1,zn.isWXPosMsg=!1,zn.__classmap=null,zn.Config=ye,zn.TextRender=st,zn.EventDispatcher=d,zn.SoundChannel=Zt,zn.Stage=jt,zn.Render=yt,zn.Browser=at,zn.Sprite=Bt,zn.Node=Ft,zn.Context=lt,zn.WebGL=dt,zn.Handler=F,zn.RunDriver=Yt,zn.Utils=ae,zn.Input=zt,zn.Loader=on,zn.LocalStorage=un,zn.SoundManager=en,zn.URL=B,zn.Event=Je,zn.Matrix=D,zn.HTMLImage=En,(zn.Laya=zn)._evcode="eval",zn.isNativeRender_enable=!1,zn.__classmap=M.__classMap,M.Timer=Cn,M.Dragging=mn,M.GraphicsBounds=mt,M.Sprite=Bt,M.TextRender=st,M.Loader=on,M.TTFLoader=cn,M.WebAudioSound=$t,M.SoundManager=en,M.ShaderCompile=Bn,M.ClassUtils=Dt,M.SceneUtils=bn,M.Context=lt,M.Render=yt,M.MouseManager=Xt,M.Text=Ut,M.Browser=at,M.WebGL=dt,M.AudioSound=Qt,M.Pool=g,M.Utils=ae,M.Graphics=St,M.Submit=He,M.Stage=jt,M.Resource=V,M.WorkerLoader=e;var Gn,Xn=window._layalibs;if(Xn){Xn.sort(function(e,t){return e.i-t.i});for(var Hn=0;Hn<Xn.length;Hn++)Xn[Hn].f(window,window.document,zn)}(e=window).Laya?(e.Laya.Laya=zn,Object.assign(e.Laya,zn)):e.Laya=zn;var Yn,Wn,jn,qn=function(){T(t,wn);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"_onAwake",value:function(){this.onAwake(),this.onStart!==t.prototype.onStart&&M.startTimer.callLater(this,this.onStart)}},{key:"_onEnable",value:function(){var e=t.prototype;this.onTriggerEnter!==e.onTriggerEnter&&this.owner.on(Je.TRIGGER_ENTER,this,this.onTriggerEnter),this.onTriggerStay!==e.onTriggerStay&&this.owner.on(Je.TRIGGER_STAY,this,this.onTriggerStay),this.onTriggerExit!==e.onTriggerExit&&this.owner.on(Je.TRIGGER_EXIT,this,this.onTriggerExit),this.onMouseDown!==e.onMouseDown&&this.owner.on(Je.MOUSE_DOWN,this,this.onMouseDown),this.onMouseUp!==e.onMouseUp&&this.owner.on(Je.MOUSE_UP,this,this.onMouseUp),this.onClick!==e.onClick&&this.owner.on(Je.CLICK,this,this.onClick),this.onStageMouseDown!==e.onStageMouseDown&&M.stage.on(Je.MOUSE_DOWN,this,this.onStageMouseDown),this.onStageMouseUp!==e.onStageMouseUp&&M.stage.on(Je.MOUSE_UP,this,this.onStageMouseUp),this.onStageClick!==e.onStageClick&&M.stage.on(Je.CLICK,this,this.onStageClick),this.onStageMouseMove!==e.onStageMouseMove&&M.stage.on(Je.MOUSE_MOVE,this,this.onStageMouseMove),this.onDoubleClick!==e.onDoubleClick&&this.owner.on(Je.DOUBLE_CLICK,this,this.onDoubleClick),this.onRightClick!==e.onRightClick&&this.owner.on(Je.RIGHT_CLICK,this,this.onRightClick),this.onMouseMove!==e.onMouseMove&&this.owner.on(Je.MOUSE_MOVE,this,this.onMouseMove),this.onMouseOver!==e.onMouseOver&&this.owner.on(Je.MOUSE_OVER,this,this.onMouseOver),this.onMouseOut!==e.onMouseOut&&this.owner.on(Je.MOUSE_OUT,this,this.onMouseOut),this.onKeyDown!==e.onKeyDown&&M.stage.on(Je.KEY_DOWN,this,this.onKeyDown),this.onKeyPress!==e.onKeyPress&&M.stage.on(Je.KEY_PRESS,this,this.onKeyPress),this.onKeyUp!==e.onKeyUp&&M.stage.on(Je.KEY_UP,this,this.onKeyUp),this.onUpdate!==e.onUpdate&&M.updateTimer.frameLoop(1,this,this.onUpdate),this.onLateUpdate!==e.onLateUpdate&&M.lateTimer.frameLoop(1,this,this.onLateUpdate),this.onPreRender!==e.onPreRender&&M.lateTimer.frameLoop(1,this,this.onPreRender)}},{key:"_onDisable",value:function(){this.owner.offAllCaller(this),M.stage.offAllCaller(this),M.startTimer.clearAll(this),M.updateTimer.clearAll(this),M.lateTimer.clearAll(this)}},{key:"_isScript",value:function(){return!0}},{key:"_onDestroy",value:function(){this.onDestroy()}},{key:"onAwake",value:function(){}},{key:"onEnable",value:function(){}},{key:"onStart",value:function(){}},{key:"onTriggerEnter",value:function(e,t,n){}},{key:"onTriggerStay",value:function(e,t,n){}},{key:"onTriggerExit",value:function(e,t,n){}},{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onClick",value:function(e){}},{key:"onStageMouseDown",value:function(e){}},{key:"onStageMouseUp",value:function(e){}},{key:"onStageClick",value:function(e){}},{key:"onStageMouseMove",value:function(e){}},{key:"onDoubleClick",value:function(e){}},{key:"onRightClick",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"onMouseOver",value:function(e){}},{key:"onMouseOut",value:function(e){}},{key:"onKeyDown",value:function(e){}},{key:"onKeyPress",value:function(e){}},{key:"onKeyUp",value:function(e){}},{key:"onUpdate",value:function(){}},{key:"onLateUpdate",value:function(){}},{key:"onPreRender",value:function(){}},{key:"onPostRender",value:function(){}},{key:"onDisable",value:function(){}},{key:"onDestroy",value:function(){}},{key:"isSingleton",get:function(){return!1}}]),t}(),Zn=function(){T(n,qn);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).zoom=.9,e.clickSound="res/fishdld/sound/F4BY_Button.wav",e}return C(n,[{key:"onEnable",value:function(){var e,t;this.btn=this.owner,this.originScaleX=this.btn.scaleX,this.originScaleY=this.btn.scaleY,.5!=this.btn.anchorX&&(e=isNaN(this.btn.anchorX)?0:this.btn.anchorX,t=this.btn.width*(.5-e),this.btn.anchorX=.5,this.btn.x+=t),.5!=this.btn.anchorY&&(e=isNaN(this.btn.anchorY)?0:this.btn.anchorY,t=this.btn.height*(.5-e),this.btn.anchorY=.5,this.btn.y+=t),this.bindMouseDown(),this.bindMouseUp(),this.bindMouseOut()}},{key:"bindMouseDown",value:function(){var e=this;this.btn.on(Je.MOUSE_DOWN,this,function(){e.btn.scale(e.zoom,e.zoom),en.playSound(e.clickSound)})}},{key:"bindMouseUp",value:function(){var e=this;this.btn.on(Je.MOUSE_UP,this,function(){e.btn.scale(e.originScaleX,e.originScaleY)})}},{key:"bindMouseOut",value:function(){var e=this;this.btn.on(Je.MOUSE_OUT,this,function(){e.btn.scale(e.originScaleX,e.originScaleY)})}},{key:"offAll",value:function(e){var t=this.btn.offAll(e);return this.destroyed||(e?e==Je.MOUSE_DOWN?this.bindMouseDown():e==Je.MOUSE_UP?this.bindMouseUp():e==Je.MOUSE_OUT&&this.bindMouseOut():(this.bindMouseDown(),this.bindMouseUp(),this.bindMouseOut())),t}}]),n}();function Kn(e,t,n,i){var a,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;0<=s;s--)(a=e[s])&&(o=(r<3?a(o):3<r?a(t,n,o):a(t,n))||o);return 3<r&&o&&Object.defineProperty(t,n,o),o}function Qn(e,t){var n=c(jn);try{for(n.s();!(i=n.n()).done;){var i=i.value;if(i.key==e)return i}}catch(e){n.e(e)}finally{n.f()}if(t){t=new Wn;return t.key=e,t.metadatas={},jn.push(t),t}}function Jn(e,t,n,i){var a="object"==h(t)?t.constructor:t,r=e;if(r+=void 0===n?"":"_propertyKey_"+n,r+=void 0===i?"":"_paramIndex_"+i,Qn(a=n||i?t.constructor:a))return Qn(a).metadatas[r];for(;t.__proto__;){var o=t.__proto__.constructor;if(Qn(o)&&void 0!==Qn(o).metadatas[r])return Qn(o).metadatas[r];t=t.__proto__}}function $n(e){return Yn.metadata("Commander",e)}function ei(e){return Yn.metadata("AutoShowErr",e)}function ti(e){return Yn.metadata("Priority",e)}function ni(e,t){var n=e[t];delete e[t],Object.defineProperty(e,t,{get:function(){return n},set:function(e){n=Number(e)},enumerable:!0,configurable:!0})}function ii(){return Yn.metadata("IgnoreClone",!0)}function ai(e){return Yn.metadata("ServerName",e)}function ri(e){return Yn.metadata("RawData",e)}function oi(e){return Yn.metadata("ShowLog",e)}function si(){S(this,si)}e=Yn=Yn||{},Wn=function e(){S(this,e)},jn=new Array,e.metadata=function(a,r){return function(e,t,n){var i=e;(t||n)&&(i=e.constructor);e=a;e+=void 0===t?"":"_propertyKey_"+t,e+=void 0===n?"":"_paramIndex_"+n,Qn(i,!0).metadatas[e]=r}},e.getMetadata=Jn,e.getDecorator=function(e,t,n,i){return Jn(e.toString().match(/metadata\("(.*)",/)[1],t,n,i)};var li=function(){T(i,si);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new nn;return S(this,i),(e=n.call(this))._bytes=t,e._bytes.endian="BIG_ENDIAN",e}return C(i,[{key:"readInt64",value:function(){var e=this._bytes.readUint32().toString(16),t="00000000".substr(0,8-e.length)+e,e=this._bytes.readUint32().toString(16);return t+="00000000".substr(0,8-e.length)+e,Number(parseInt(t,16).toString())}},{key:"writeInt64",value:function(e){e=e.toString(16),e="00000000".substr(0,16-e.length)+e;this._bytes.writeUint32(parseInt(e.substr(0,8),16)),this._bytes.writeUint32(parseInt(e.substr(8,8),16))}},{key:"readBoolean",value:function(){return 0!=this._bytes.readByte()}},{key:"writeBoolean",value:function(e){e?this._bytes.writeByte(1):this._bytes.writeByte(0)}}]),i}();Kn([ii()],li.prototype,"_bytes",void 0);var hi=function(){T(t,li);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}(),ui=function(){T(t,li);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}();!function(e){e.name="game";var t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){var e=Date.now().toString();this.ping_id=Number(e.substr(5)),this._bytes.clear(),this._bytes.writeInt32(this.ping_id)}}]),t}(),t=Kn([ai(e.name),$n(20189)],t);e.GameHeartReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.ping_id=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(20190)],t),e.GameHeartResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.v3)}}]),t}(),t=Kn([ai(e.name),$n(5006)],t),e.GameValidateReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.v1=this._bytes.readInt32(),this.v2=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(5006)],t),e.GameValidateResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.vesion=this._bytes.readUTFString()}}]),t}(),t=Kn([ai(e.name),$n(9999)],t),e.GameVersionResp=t,t=function(){T(n,hi);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).roomid=0,e}return C(n,[{key:"encode",value:function(){this._bytes.writeInt32(this.roomid)}}]),n}(),t=Kn([ai(e.name),$n(5001)],t),e.GameRoomIdReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(5001)],t),e.GameRoomIdResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.userid),this._bytes.writeUTFString(this.password),this._bytes.writeByte(this.client_type),this._bytes.writeUTFString(this.client_info),this._bytes.writeByte(this.version),this.writeBoolean(this.fixseat),this._bytes.writeUTFString(this.dbname),this.writeInt64(this.first_money),this._bytes.writeInt32(this.roomid),this._bytes.writeUTFString(this.linecode),this._bytes.writeInt32(this.all_npc)}}]),t}(),t=Kn([ai(e.name),$n(20100)],t),e.GameLoginReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.id=this._bytes.readInt32(),this.into_money=this.readInt64(),this.is_award=this._bytes.readByte(),this.re_enter=this.readBoolean(),this.showdouble=this._bytes.readByte()}}]),t}(),t=Kn([ai(e.name),$n(20105)],t),e.LoginSuccessResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.money=this._bytes.readFloat64(),this.money=parseFloat(this.money.toFixed(2)),this.result=this._bytes.readUTFString()}}]),t}(),t=Kn([ai(e.name),$n(20106)],t),e.UpdateIntomoney=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(20102),ti(50)],t),e.GameQuitReq=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt16(this.tableId),this._bytes.writeByte(this.sitIndex)}}]),t}(),t=Kn([ai(e.name),$n(20103)],t),e.GameSitReq=t;var n=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.userName=this._bytes.readUTFString(),this.roomName=this._bytes.readUTFString(),this.enterMoney=this._bytes.readInt32(),this.dizhu=this._bytes.readInt32(),this.isScore=this.readBoolean(),this.isShow=this._bytes.readUTFString(),this.tableId=this._bytes.readInt32()}}]),t}();e.DeskMatchInfos=n;var i=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.headid=this._bytes.readInt16()}}]),t}();e.SeatInfo=i,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.tableId=this._bytes.readInt16(),this.isPlaying=this.readBoolean(),this.matchInfos=new n(this._bytes),this.matchInfos.decode(),this.seatInfos=[];for(var e=this._bytes.readInt16();e--;){var t=new i(this._bytes);t.decode(),this.seatInfos.push(t)}this.isPassWord=this.readBoolean()}}]),t}(),e.DeskInfo=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.userid=this._bytes.readInt32(),this.nickname=this._bytes.readUTFString(),this.avatar_no=this._bytes.readInt16(),this.level=this._bytes.readInt16(),this.into_money=this.readInt64(),this.netspeed=this._bytes.readInt32(),this.deskno=this._bytes.readInt16(),this.win_times=this._bytes.readInt32(),this.lose_times=this._bytes.readInt32(),this.winning=this._bytes.readByte(),this.vip_level=this._bytes.readInt16()}}]),t}(),e.DeskRankInfovo=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.uid),this._bytes.writeFloat64(this.bulletValue);var e=this.fishId.length;for(this._bytes.writeInt16(e);e--;)this._bytes.writeInt32(this.fishId[this.fishId.length-1-e]);for(e=this.freeFishId.length,this._bytes.writeInt16(e);e--;)this._bytes.writeInt32(this.freeFishId[this.freeFishId.length-1-e])}}]),t}(),t=Kn([ai(e.name),$n(24005)],t),e.FishHitContinuouslyReq=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeUTFString(this.info)}}]),t}(),t=Kn([ai(e.name),$n(24006)],t),e.FishCustomEventReq=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.bulletPrice),this._bytes.writeFloat64(this.bulletLv)}}]),t}(),t=Kn([ai(e.name),$n(24010),ti(30)],t),e.FishSwitchCannonReq=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(24014)],t),e.FishSyncNormalFishesReq=t;var a=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.fish_id=this._bytes.readInt32(),this.fish_size_type=this._bytes.readInt32(),this.shoalid=this._bytes.readInt32(),this.f_type=this._bytes.readInt32(),this.left_time=this._bytes.readInt32(),this.hp=this._bytes.readInt32()}}]),t}();e.FishSyncNormalFishInfo=a,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.info=[];for(var e=this._bytes.readInt16();e--;){var t=new a(this._bytes);t.decode(),this.info.push(t)}}}]),t}(),t=Kn([ai(e.name),$n(24047)],t),e.FishSyncNormalFishesResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(24011)],t),e.FishSyncGroupFishesReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.fishGroupId=this._bytes.readInt32(),this.fishId=[];for(var e=this._bytes.readInt16();e--;)this.fishId.push(this._bytes.readInt32());for(this.time=this._bytes.readInt32(),this.fishBlood=[],e=this._bytes.readInt16();e--;)this.fishBlood.push(this._bytes.readInt32())}}]),t}(),t=Kn([ai(e.name),$n(24038)],t),e.FishSyncGroupFishesResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.npc_uid)}}]),t}(),t=Kn([ai(e.name),$n(24015)],t),e.FishNpcLeaveReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.is_control=this._bytes.readByte()}}]),t}(),t=Kn([ai(e.name),$n(24022)],t),e.FishNpcControlResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.fishList=[];for(var e=this._bytes.readInt16();e--;)this.fishList.push(this._bytes.readInt32());for(this.fishType=this._bytes.readInt32(),this.routeId=this._bytes.readInt32(),this.fishBlood=[],e=this._bytes.readInt16();e--;)this.fishBlood.push(this._bytes.readInt32())}}]),t}(),t=Kn([ai(e.name),oi(!1),$n(24026)],t),e.FishNewFish=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.bulletPrice=this._bytes.readFloat64(),this.bulletPrice=parseFloat(this.bulletPrice.toFixed(2)),this.bulletLv=this._bytes.readFloat64(),this.bulletLv=parseFloat(this.bulletLv.toFixed(2))}}]),t}(),t=Kn([ai(e.name),$n(24030)],t),e.FishSwitchCannonResp=t;var r=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.fishId=this._bytes.readInt32(),this.score=this._bytes.readFloat64(),this.score=parseFloat(this.score.toFixed(2)),this.extra_score=this._bytes.readFloat64(),this.extra_score=parseFloat(this.extra_score.toFixed(2))}}]),t}();e.FishScoreInfo=r,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.fishes=[];for(var e=this._bytes.readInt16();e--;){var t=new r(this._bytes);t.decode(),this.fishes.push(t)}this.score=this._bytes.readFloat64(),this.score=parseFloat(this.score.toFixed(2)),this.exp=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24035)],t),e.FishExplodeResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.boomFishId=this._bytes.readInt32(),this.fishes=[];for(var e=this._bytes.readInt16();e--;){var t=new r(this._bytes);t.decode(),this.fishes.push(t)}this.uScore=this._bytes.readFloat64(),this.uScore=parseFloat(this.uScore.toFixed(2)),this.uExp=this._bytes.readInt32(),this.totalScore=this._bytes.readFloat64(),this.totalScore=parseFloat(this.totalScore.toFixed(2))}}]),t}(),t=Kn([ai(e.name),$n(24036)],t),e.FishCatchSweepResultResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.time=this._bytes.readInt32(),this.style=this._bytes.readInt32(),this.boss_id=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24037)],t),e.FishCleanResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24040)],t),e.FishDummyShootStopResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24041)],t),e.FishDummyShootStartResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.isFast=this._bytes.readByte()}}]),t}(),t=Kn([ai(e.name),$n(24042)],t),e.FishDummyFastShootResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.fishId=this._bytes.readInt32(),this.fishAngle=this._bytes.readFloat64(),this.fishAngle=parseFloat(this.fishAngle.toFixed(2))}}]),t}(),t=Kn([ai(e.name),$n(24043)],t),e.FishDummyLockFishResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.info=this._bytes.readUTFString()}}]),t}(),t=Kn([ai(e.name),$n(24046)],t),e.FishCustomEventResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(20161)],t),e.GameReadyReq=t;var o=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.active_point=this._bytes.readInt32(),this.avatar_img=this._bytes.readUTFString(),this.avatar_no=this._bytes.readInt16(),this.bag_money=this._bytes.readFloat64(),this.bag_money=parseFloat(this.bag_money.toFixed(2)),this.client_address=this._bytes.readUTFString(),this.exp=this._bytes.readInt32(),this.into_money=this._bytes.readFloat64(),this.into_money=parseFloat(this.into_money.toFixed(2)),this.is_staff=this.readBoolean(),this.keynum=this._bytes.readInt32(),this.level=this._bytes.readInt16(),this.lose_times=this._bytes.readInt32(),this.mobile_type=this._bytes.readInt16(),this.nickname=this._bytes.readUTFString(),this.position=this._bytes.readByte(),this.ready=this.readBoolean(),this.uid=this._bytes.readInt32(),this.vip_level=this._bytes.readByte(),this.waiting=this.readBoolean(),this.win_times=this._bytes.readInt32(),this.winning=this._bytes.readInt32(),this.wzcardnum=this._bytes.readInt32(),this.upoint=this._bytes.readInt32(),this.win_rate=this._bytes.readInt32(),this.win_num=this._bytes.readInt32(),this.max_winmoney=this._bytes.readInt32(),this.lose_num=this._bytes.readInt32(),this.max_cards=[];for(var e=this._bytes.readInt16();e--;)this.max_cards.push(this._bytes.readByte());for(this.cannon_type=this._bytes.readInt32(),this.cannon_level=this._bytes.readFloat64(),this.cannon_level=parseFloat(this.cannon_level.toFixed(2)),this.score=this._bytes.readFloat64(),this.score=parseFloat(this.score.toFixed(2)),this.money=this._bytes.readFloat64(),this.money=parseFloat(this.money.toFixed(2)),this.cannons=[],e=this._bytes.readInt16();e--;)this.cannons.push(this._bytes.readFloat64());for(this.is_dummy=this.readBoolean(),this.fast_shoot=this.readBoolean(),this.lock_fish=this._bytes.readInt32(),this.lock_angle=this._bytes.readInt32(),this.is_shoot_stop=this.readBoolean(),this.ip=this._bytes.readUTFString(),this.buttle_num=this._bytes.readInt32(),this.rank=this._bytes.readInt32(),this.jushu=this._bytes.readInt32(),this.myprops=[],e=this._bytes.readInt16();e--;){var t=new l(this._bytes);t.decode(),this.myprops.push(t)}}}]),t}();e.GameMemberInfo=o;var s=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.score=this._bytes.readFloat64(),this.score=parseFloat(this.score.toFixed(2)),this.uid=this._bytes.readInt32(),this.nickname=this._bytes.readUTFString(),this.rank=this._bytes.readInt32()}}]),t}();e.Top10Info=s;var l=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.pid=this._bytes.readInt32(),this.num=this._bytes.readInt32()}}]),t}(),h=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.state_id=this._bytes.readInt32(),this.state_type=this._bytes.readInt32(),this.con_time=this._bytes.readFloat64(),this.con_time=parseFloat(this.con_time.toFixed(2)),this.param_type=this._bytes.readInt32()}}]),t}(),u=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.magic_id=this._bytes.readInt32(),this.magic_type=this._bytes.readInt32(),this.param_types=[];for(var e=this._bytes.readInt16();e--;)this.param_types.push(this._bytes.readInt32())}}]),t}(),t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.continue_timeout=this._bytes.readByte(),this.init_money=this._bytes.readFloat64(),this.init_money=parseFloat(this.init_money.toFixed(2)),this.max_player_num=this._bytes.readByte(),this.p2p=this._bytes.readByte(),this.top_money=this._bytes.readFloat64(),this.top_money=parseFloat(this.top_money.toFixed(2)),this.unit_money=this._bytes.readFloat64(),this.unit_money=parseFloat(this.unit_money.toFixed(2)),this.memberinfos=[];for(var e=this._bytes.readInt16();e--;){var t=new o(this._bytes);t.decode(),this.memberinfos.push(t)}for(this.bb_money=this._bytes.readFloat64(),this.bb_money=parseFloat(this.bb_money.toFixed(2)),this.sb_money=this._bytes.readFloat64(),this.sb_money=parseFloat(this.sb_money.toFixed(2)),this.nolimit=this._bytes.readByte(),this.max_chip=this._bytes.readFloat64(),this.max_chip=parseFloat(this.max_chip.toFixed(2)),this.init_bets=[],e=this._bytes.readInt16();e--;)this.init_bets.push(this._bytes.readFloat64());for(this.level_type=this._bytes.readInt32(),this.cannon_rate=this._bytes.readFloat64(),this.cannon_rate=parseFloat(this.cannon_rate.toFixed(2)),this.cannon_doubles=[],e=this._bytes.readInt16();e--;)this.cannon_doubles.push(this._bytes.readFloat64());for(this.calltype=this._bytes.readInt32(),this.deskno=this._bytes.readInt32(),this.max_bullet_multiple=this._bytes.readFloat64(),this.max_bullet_multiple=parseFloat(this.max_bullet_multiple.toFixed(2)),this.min_bullet_multiple=this._bytes.readFloat64(),this.min_bullet_multiple=parseFloat(this.min_bullet_multiple.toFixed(2)),this.myprops=[],e=this._bytes.readInt16();e--;){var n=new l(this._bytes);n.decode(),this.myprops.push(n)}for(this.awards=[],e=this._bytes.readInt16();e--;)this.awards.push(this._bytes.readFloat64());for(this.apply_cost=this._bytes.readFloat64(),this.apply_cost=parseFloat(this.apply_cost.toFixed(2)),this.apply_num=this._bytes.readInt32(),this.need_num=this._bytes.readInt32(),this.buttle_num=this._bytes.readInt32(),this.game_mode=this._bytes.readInt32(),this.apply_surplus=this._bytes.readInt32(),this.step=this._bytes.readInt32(),this.top10=[],e=this._bytes.readInt16();e--;){var i=new s(this._bytes);i.decode(),this.top10.push(i)}for(this.round=this._bytes.readInt32(),this.matchtime=this._bytes.readInt32(),this.cn=this._bytes.readInt32(),this.multiple=[],e=this._bytes.readInt16();e--;)this.multiple.push(this._bytes.readFloat64());for(this.title=this._bytes.readUTFString(),this.promotioncn=this._bytes.readInt32(),this.promotion_jushu=this._bytes.readInt32(),this.max_round=this._bytes.readInt32(),this.max_unit_money=this._bytes.readFloat64(),this.max_unit_money=parseFloat(this.max_unit_money.toFixed(2)),this.max_mult=this._bytes.readInt32(),this.min_mult=this._bytes.readInt32(),this.match_type=this._bytes.readInt32(),this.def_cannon=[],e=this._bytes.readInt16();e--;)this.def_cannon.push(this._bytes.readInt32());for(this.def_avatar=[],e=this._bytes.readInt16();e--;)this.def_avatar.push(this._bytes.readFloat64());for(this.cannon_types=[],e=this._bytes.readInt16();e--;)this.cannon_types.push(this._bytes.readInt32());for(this.cannon_levels=[],e=this._bytes.readInt16();e--;)this.cannon_levels.push(this._bytes.readInt32());for(this.avatar_speeds=[],e=this._bytes.readInt16();e--;)this.avatar_speeds.push(this._bytes.readInt32());for(this.avatar_lock_types=[],e=this._bytes.readInt16();e--;)this.avatar_lock_types.push(this._bytes.readInt32());for(this.avatar_props=[],e=this._bytes.readInt16();e--;)this.avatar_props.push(this._bytes.readInt32());for(this.shoot_interval=this._bytes.readFloat64(),this.shoot_interval=parseFloat(this.shoot_interval.toFixed(2)),this.bullet_max=this._bytes.readInt32(),this.angle_min=this._bytes.readFloat64(),this.angle_min=parseFloat(this.angle_min.toFixed(2)),this.angle_max=this._bytes.readFloat64(),this.angle_max=parseFloat(this.angle_max.toFixed(2)),this.data_effect=[],e=this._bytes.readInt16();e--;){var a=new h(this._bytes);a.decode(),this.data_effect.push(a)}for(this.data_magic=[],e=this._bytes.readInt16();e--;){var r=new u(this._bytes);r.decode(),this.data_magic.push(r)}}}]),t}(),t=Kn([ai(e.name),$n(20162)],t);e.GameEnterResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.memberinfo=[];for(var e=this._bytes.readInt16();e--;){var t=new o(this._bytes);t.decode(),this.memberinfo.push(t)}for(this.myprops=[],e=this._bytes.readInt16();e--;){var n=new l(this._bytes);n.decode(),this.myprops.push(n)}}}]),t}(),t=Kn([ai(e.name),$n(20159)],t),e.UserEnterResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32()}},{key:"encode",value:function(){this._bytes.writeInt32(this.uid)}}]),t}(),t=Kn([ai(e.name),$n(20160)],t),e.UserLeaveResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.error=this._bytes.readInt16(),this.body=this._bytes.readInt16(),this.infos=[];for(var e=this._bytes.readInt16();e--;)this.infos.push(this._bytes.readUTFString())}}]),t}(),t=Kn([ai(e.name),$n(20149)],t),e.GameLoginFailResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.end_time=this._bytes.readFloat64(),this.end_time=parseFloat(this.end_time.toFixed(2)),this.multiple=this._bytes.readInt32(),this.add_time=this._bytes.readFloat64(),this.add_time=parseFloat(this.add_time.toFixed(2)),this.add_multiple=this._bytes.readInt32(),this.fish_id=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24057)],t),e.UpdateAdventureInfoResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(24058)],t),e.GetHundredsOfMillionsInfoReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.num=this._bytes.readFloat64(),this.num=parseFloat(this.num.toFixed(2))}}]),t}(),t=Kn([ai(e.name),$n(24059)],t),e.GetHundredsOfMillionsInfoResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.money=this._bytes.readFloat64(),this.money=parseFloat(this.money.toFixed(2))}}]),t}(),t=Kn([ai(e.name),$n(24060)],t),e.HundredsOfMillionsAwardInfoResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(24061)],t),e.GetFishGameAwardInfoReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.infos=[];for(var e=this._bytes.readInt16();e--;){var t=new d(this._bytes);t.decode(),this.infos.push(t)}}}]),t}(),t=Kn([ai(e.name),$n(24062)],t),e.GetFishGameAwardInfoResp=t;var d=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.nickname=this._bytes.readUTFString(),this.award_time=this._bytes.readUTFString(),this.award_money=this._bytes.readFloat64(),this.award_money=parseFloat(this.award_money.toFixed(2))}}]),t}();e.FishGetFishGameAwardInfoInfo=d,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(24063)],t),e.GetFreePoolAwardInfoReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.free_pool_switch=this._bytes.readByte(),this.free_pool_stock=this._bytes.readFloat64(),this.free_pool_stock=parseFloat(this.free_pool_stock.toFixed(2)),this.player_money=this._bytes.readFloat64(),this.player_money=parseFloat(this.player_money.toFixed(2)),this.award_config=[];for(var e=this._bytes.readInt16();e--;){var t=new c(this._bytes);t.decode(),this.award_config.push(t)}}}]),t}(),t=Kn([ai(e.name),$n(24064)],t),e.GetFreePoolAwardInfoResp=t;var c=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.type=this._bytes.readInt32(),this.money=this._bytes.readFloat64(),this.money=parseFloat(this.money.toFixed(2)),this.infos=[];for(var e=this._bytes.readInt16();e--;){var t=new _(this._bytes);t.decode(),this.infos.push(t)}}}]),t}();e.GetFreePoolAwardInfoAwardConfig=c;var _=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.award_id=this._bytes.readInt32(),this.award_type=this._bytes.readInt32(),this.award_num=this._bytes.readInt32()}}]),t}();e.GetFreePoolAwardInfoAwardConfigInfo=_,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.player_money=this._bytes.readFloat64(),this.player_money=parseFloat(this.player_money.toFixed(2))}}]),t}(),t=Kn([ai(e.name),$n(24065)],t),e.UpdateFreePoolPlayerMoneyResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.free_pool_switch)}}]),t}(),t=Kn([ai(e.name),$n(24066)],t),e.ChangeFreePoolSwitchReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.free_pool_switch=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24067)],t),e.ChangeFreePoolSwitchResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.award_type)}}]),t}(),t=Kn([ai(e.name),$n(24068)],t),e.FreePoolLotteryDrawReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.award_result=[];for(var e=this._bytes.readInt16();e--;)this.award_result.push(this._bytes.readInt32());this.player_money=this._bytes.readFloat64(),this.player_money=parseFloat(this.player_money.toFixed(2))}}]),t}(),t=Kn([ai(e.name),$n(24069)],t),e.FreePoolLotteryDrawResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(24070)],t),e.GetCallTicketNumReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.call_ticket_num=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24071)],t),e.GetCallTicketNumResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(24072)],t),e.UseCallTicketReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.call_ticket_num=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24073)],t),e.UseCallTicketResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.fish_ids=[];for(var e=this._bytes.readInt16();e--;)this.fish_ids.push(this._bytes.readInt32());for(this.fish_type=this._bytes.readInt32(),this.fish_path=this._bytes.readInt32(),this.fish_bloods=[],e=this._bytes.readInt16();e--;)this.fish_bloods.push(this._bytes.readInt32());this.times=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(24074)],t),e.FishNewfishCall=t}(bi=bi||{});var di=bi,ci=function e(){S(this,e)};ci.defaultSizeGrid=[4,4,4,4,0],ci.labelColor="#000000",ci.labelPadding=[2,2,2,2],ci.inputLabelPadding=[1,1,1,3],ci.buttonStateNum=3,ci.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"],ci.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"],ci.scrollBarMinNum=15,ci.scrollBarDelayTime=500;var _i=function(){T(n,St);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).autoCacheCmd=!0,e._width=0,e._height=0,e.uv=null,e}return C(n,[{key:"destroy",value:function(){G(z(n.prototype),"destroy",this).call(this),this._source=null,this._sizeGrid=null,this._offset=null}},{key:"_setChanged",value:function(){this._isChanged||(this._isChanged=!0,M.timer.callLater(this,this.changeSource))}},{key:"changeSource",value:function(){this._isChanged=!1;var e=this._source;if(e&&e.bitmap){var t=this.width,n=this.height,i=this._sizeGrid,a=e.sourceWidth,r=e.sourceHeight;if(i&&(a!==t||r!==n))return this.clear(),this.draw9Grid(e,0,0,t,n,i),void this._repaint();this.clear(),this.drawTexture(e,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,t,n,null,1,null,null,this.uv),this._repaint()}}},{key:"drawBitmap",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;a<.1||r<.1||(!e||t.width==a&&t.height==r?this.drawImage(t,n,i,a,r):this.fillTexture(t,n,i,a,r))}},{key:"sizeGrid",get:function(){return this._sizeGrid},set:function(e){this._sizeGrid=e.map(function(e){return+e}),this._setChanged()}},{key:"width",get:function(){return this._width||(this._source?this._source.sourceWidth:0)},set:function(e){this._width!=e&&(this._width=e,this._setChanged())}},{key:"height",get:function(){return this._height||(this._source?this._source.sourceHeight:0)},set:function(e){this._height!=e&&(this._height=e,this._setChanged())}},{key:"source",get:function(){return this._source},set:function(e){e?(this._source=e,this._setChanged()):(this._source=null,this.clear())}}],[{key:"getTexture",value:function(e,t,n,i,a){var r;return i<=0&&(i=1),a<=0&&(a=1),e.$_GID||(e.$_GID=ae.getGID()),r=!r||!r._getSource()?$e.createFromTexture(e,t,n,i,a):r}}]),n}();Dt.regClass("laya.ui.AutoBitmap",_i),Dt.regClass("Laya.AutoBitmap",_i);var fi=function(){T(n,wn);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments))._top=NaN,e._bottom=NaN,e._left=NaN,e._right=NaN,e._centerX=NaN,e._centerY=NaN,e}return C(n,[{key:"onReset",value:function(){this._top=this._bottom=this._left=this._right=this._centerX=this._centerY=NaN}},{key:"_onEnable",value:function(){this.owner.parent?this._onAdded():this.owner.once(Je.ADDED,this,this._onAdded)}},{key:"_onDisable",value:function(){this.owner.off(Je.ADDED,this,this._onAdded),this.owner.parent&&this.owner.parent.off(Je.RESIZE,this,this._onParentResize)}},{key:"_onAdded",value:function(){this.owner.parent&&this.owner.parent.on(Je.RESIZE,this,this._onParentResize),this.resetLayoutX(),this.resetLayoutY()}},{key:"_onParentResize",value:function(){(this.resetLayoutX()||this.resetLayoutY())&&this.owner.event(Je.RESIZE)}},{key:"resetLayoutX",value:function(){var e=this.owner;if(!e)return!1;var t=e.parent;if(t)if(isNaN(this.centerX)){if(isNaN(this.left))isNaN(this.right)||(e.x=Math.round(t.width-e.displayWidth-this.right+e.pivotX*e.scaleX));else if(e.x=Math.round(this.left+e.pivotX*e.scaleX),!isNaN(this.right)){var n=(t._width-this.left-this.right)/(e.scaleX||.01);if(n!=e.width)return e.width=n,!0}}else e.x=Math.round(.5*(t.width-e.displayWidth)+this.centerX+e.pivotX*e.scaleX);return!1}},{key:"resetLayoutY",value:function(){var e=this.owner;if(!e)return!1;var t=e.parent;if(t)if(isNaN(this.centerY)){if(isNaN(this.top))isNaN(this.bottom)||(e.y=Math.round(t.height-e.displayHeight-this.bottom+e.pivotY*e.scaleY));else if(e.y=Math.round(this.top+e.pivotY*e.scaleY),!isNaN(this.bottom)){var n=(t._height-this.top-this.bottom)/(e.scaleY||.01);if(n!=e.height)return e.height=n,!0}}else e.y=Math.round(.5*(t.height-e.displayHeight)+this.centerY+e.pivotY*e.scaleY);return!1}},{key:"resetLayout",value:function(){this.owner&&(this.resetLayoutX(),this.resetLayoutY())}},{key:"top",get:function(){return this._top},set:function(e){this._top!=e&&(this._top=e,this.resetLayoutY())}},{key:"bottom",get:function(){return this._bottom},set:function(e){this._bottom!=e&&(this._bottom=e,this.resetLayoutY())}},{key:"left",get:function(){return this._left},set:function(e){this._left!=e&&(this._left=e,this.resetLayoutX())}},{key:"right",get:function(){return this._right},set:function(e){this._right!=e&&(this._right=e,this.resetLayoutX())}},{key:"centerX",get:function(){return this._centerX},set:function(e){this._centerX!=e&&(this._centerX=e,this.resetLayoutX())}},{key:"centerY",get:function(){return this._centerY},set:function(e){this._centerY!=e&&(this._centerY=e,this.resetLayoutY())}}]),n}();fi.EMPTY=null,M.regClass(fi),fi.EMPTY=new fi,Dt.regClass("laya.ui.Widget",fi),Dt.regClass("Laya.Widget",fi);var gi=function(){T(t,Je);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}();gi.SHOW_TIP="showtip",gi.HIDE_TIP="hidetip",M.regClass(gi),Dt.regClass("laya.ui.UIEvent",gi),Dt.regClass("Laya.UIEvent",gi);var yi=function(){function i(){S(this,i)}return C(i,null,[{key:"fillArray",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.concat();if(t)for(var a=t.split(","),r=0,o=Math.min(i.length,a.length);r<o;r++){var s=a[r];i[r]="true"==s||"false"!=s&&s,null!=n&&(i[r]=n(s))}return i}},{key:"toColor",value:function(e){return ae.toHexColor(e)}},{key:"gray",value:function(e){!(1<arguments.length&&void 0!==arguments[1])||arguments[1]?i.addFilter(e,i.grayFilter):i.clearFilter(e,oe)}},{key:"addFilter",value:function(e,t){var n=e.filters||[];n.push(t),e.filters=n}},{key:"clearFilter",value:function(e,t){var n=e.filters;if(null!=n&&0<n.length){for(var i=n.length-1;-1<i;i--)n[i]instanceof t&&n.splice(i,1);e.filters=n}}},{key:"_getReplaceStr",value:function(e){return i.escapeSequence[e]}},{key:"adptString",value:function(e){return e.replace(/\\(\w)/g,i._getReplaceStr)}},{key:"getBindFun",value:function(e){var t,n=(i._funMap=!i._funMap?new Mn:i._funMap).get(e);return null==n&&(t="(function(data){if(data==null)return;with(data){try{\nreturn "+('"'+e+'"').replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"')+"\n}catch(e){}}})",n=window.Laya._runScript(t),i._funMap.set(e,n)),n}}]),i}();yi.grayFilter=new oe([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0]),yi.escapeSequence={"\\n":"\n","\\t":"\t"},yi._funMap=null,Dt.regClass("laya.ui.UIUtils",yi),Dt.regClass("Laya.UIUtils",yi);var vi=function(){T(i,Bt);var n=b(i);function i(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return S(this,i),(e=n.call(this))._anchorX=NaN,e._anchorY=NaN,e._widget=fi.EMPTY,t&&(e.preinitialize(),e.createChildren(),e.initialize()),e}return C(i,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(i.prototype),"destroy",this).call(this,e),this._dataSource=null,this._tag=null,this._toolTip=null}},{key:"preinitialize",value:function(){}},{key:"createChildren",value:function(){}},{key:"initialize",value:function(){}},{key:"get_width",value:function(){return this._width||this.measureWidth()}},{key:"measureWidth",value:function(){var e=0;this.commitMeasure();for(var t=this.numChildren-1;-1<t;t--){var n=this.getChildAt(t);n._visible&&(e=Math.max(n._x+n.width*n.scaleX,e))}return e}},{key:"commitMeasure",value:function(){}},{key:"get_height",value:function(){return this._height||this.measureHeight()}},{key:"measureHeight",value:function(){var e=0;this.commitMeasure();for(var t=this.numChildren-1;-1<t;t--){var n=this.getChildAt(t);n._visible&&(e=Math.max(n._y+n.height*n.scaleY,e))}return e}},{key:"get_dataSource",value:function(){return this._dataSource}},{key:"set_dataSource",value:function(e){for(var t in this._dataSource=e,this._dataSource)t in this&&"function"!=typeof this[t]&&(this[t]=this._dataSource[t])}},{key:"get_top",value:function(){return this._widget.top}},{key:"set_top",value:function(e){e!=this._widget.top&&(this._getWidget().top=e)}},{key:"get_bottom",value:function(){return this._widget.bottom}},{key:"set_bottom",value:function(e){e!=this._widget.bottom&&(this._getWidget().bottom=e)}},{key:"_sizeChanged",value:function(){isNaN(this._anchorX)||(this.pivotX=this.anchorX*this.width),isNaN(this._anchorY)||(this.pivotY=this.anchorY*this.height),this.event(Je.RESIZE),this._widget!==fi.EMPTY&&this._widget.resetLayout()}},{key:"onMouseOver",value:function(e){M.stage.event(gi.SHOW_TIP,this._toolTip)}},{key:"onMouseOut",value:function(e){M.stage.event(gi.HIDE_TIP,this._toolTip)}},{key:"_getWidget",value:function(){return this._widget===fi.EMPTY&&(this._widget=this.addComponent(fi)),this._widget}},{key:"set_scaleX",value:function(e){G(z(i.prototype),"get_scaleX",this).call(this)!=e&&(G(z(i.prototype),"set_scaleX",this).call(this,e),this.event(Je.RESIZE))}},{key:"set_scaleY",value:function(e){G(z(i.prototype),"get_scaleY",this).call(this)!=e&&(G(z(i.prototype),"set_scaleY",this).call(this,e),this.event(Je.RESIZE))}},{key:"onCompResize",value:function(){this._sizeChanged()}},{key:"set_width",value:function(e){G(z(i.prototype),"get_width",this).call(this)!=e&&(G(z(i.prototype),"set_width",this).call(this,e),this.callLater(this._sizeChanged))}},{key:"set_height",value:function(e){G(z(i.prototype),"get_height",this).call(this)!=e&&(G(z(i.prototype),"set_height",this).call(this,e),this.callLater(this._sizeChanged))}},{key:"get_anchorX",value:function(){return this._anchorX}},{key:"set_anchorX",value:function(e){this._anchorX!=e&&(this._anchorX=e,this.callLater(this._sizeChanged))}},{key:"get_anchorY",value:function(){return this._anchorY}},{key:"set_anchorY",value:function(e){this._anchorY!=e&&(this._anchorY=e,this.callLater(this._sizeChanged))}},{key:"_childChanged",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.callLater(this._sizeChanged),G(z(i.prototype),"_childChanged",this).call(this,e)}},{key:"width",get:function(){return this.get_width()},set:function(e){this.set_width(e)}},{key:"height",get:function(){return this.get_height()},set:function(e){this.set_height(e)}},{key:"dataSource",get:function(){return this.get_dataSource()},set:function(e){this.set_dataSource(e)}},{key:"top",get:function(){return this.get_top()},set:function(e){this.set_top(e)}},{key:"bottom",get:function(){return this.get_bottom()},set:function(e){this.set_bottom(e)}},{key:"left",get:function(){return this._widget.left},set:function(e){e!=this._widget.left&&(this._getWidget().left=e)}},{key:"right",get:function(){return this._widget.right},set:function(e){e!=this._widget.right&&(this._getWidget().right=e)}},{key:"centerX",get:function(){return this._widget.centerX},set:function(e){e!=this._widget.centerX&&(this._getWidget().centerX=e)}},{key:"centerY",get:function(){return this._widget.centerY},set:function(e){e!=this._widget.centerY&&(this._getWidget().centerY=e)}},{key:"tag",get:function(){return this._tag},set:function(e){this._tag=e}},{key:"toolTip",get:function(){return this._toolTip},set:function(e){this._toolTip!=e&&(null!=(this._toolTip=e)?(this.on(Je.MOUSE_OVER,this,this.onMouseOver),this.on(Je.MOUSE_OUT,this,this.onMouseOut)):(this.off(Je.MOUSE_OVER,this,this.onMouseOver),this.off(Je.MOUSE_OUT,this,this.onMouseOut)))}},{key:"gray",get:function(){return this._gray},set:function(e){e!==this._gray&&(this._gray=e,yi.gray(this,e))}},{key:"disabled",get:function(){return this._disabled},set:function(e){e!==this._disabled&&(this.gray=this._disabled=e,this.mouseEnabled=!e)}},{key:"scaleX",set:function(e){this.set_scaleX(e)},get:function(){return G(z(i.prototype),"scaleX",this)}},{key:"scaleY",set:function(e){this.set_scaleY(e)},get:function(){return G(z(i.prototype),"scaleY",this)}},{key:"anchorX",get:function(){return this.get_anchorX()},set:function(e){this.set_anchorX(e)}},{key:"anchorY",get:function(){return this.get_anchorY()},set:function(e){this.set_anchorY(e)}}]),i}();M.regClass(vi),Dt.regClass("laya.ui.UIComponent",vi),Dt.regClass("Laya.UIComponent",vi);var pi=function(){T(i,vi);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return S(this,i),(e=n.call(this)).skin=t,e}return C(i,[{key:"destroy",value:function(){G(z(i.prototype),"destroy",this).call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null}},{key:"dispose",value:function(){this.destroy(!0),M.loader.clearRes(this._skin)}},{key:"createChildren",value:function(){this.graphics=this._bitmap=new _i,this._bitmap.autoCacheCmd=!1}},{key:"setSource",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e===this._skin&&t&&(this.source=t,this.onCompResize())}},{key:"measureWidth",value:function(){return this._bitmap.width}},{key:"measureHeight",value:function(){return this._bitmap.height}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin!=e&&((this._skin=e)?(e=on.getRes(e))?(this.source=e,this.onCompResize()):M.loader.load(this._skin,F.create(this,this.setSource,[this._skin]),null,on.IMAGE,1,!0,this._group):this.source=null)}},{key:"source",get:function(){return this._bitmap.source},set:function(e){this._bitmap&&(this._bitmap.source=e,this.event(Je.LOADED),this.repaint())}},{key:"group",get:function(){return this._group},set:function(e){e&&this._skin&&on.setGroup(this._skin,e),this._group=e}},{key:"width",set:function(e){s(z(i.prototype),"width",e,this,!0),this._bitmap.width=0==e?1e-7:e},get:function(){return G(z(i.prototype),"width",this)}},{key:"height",set:function(e){s(z(i.prototype),"height",e,this,!0),this._bitmap.height=0==e?1e-7:e},get:function(){return G(z(i.prototype),"height",this)}},{key:"sizeGrid",get:function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},set:function(e){this._bitmap.sizeGrid=yi.fillArray(ci.defaultSizeGrid,e,Number)}},{key:"dataSource",set:function(e){"string"==typeof(this._dataSource=e)?this.skin=e:s(z(i.prototype),"dataSource",e,this,!0)},get:function(){return G(z(i.prototype),"dataSource",this)}}]),i}();M.regClass(pi),Dt.regClass("laya.ui.Image",pi),Dt.regClass("Laya.Image",pi);var mi=function(){function a(){S(this,a);var e=this.elements=new Float32Array(9);e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}return C(a,[{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],r=e[4],o=e[5],s=e[6],l=e[7],e=e[8];return t*(e*r-o*l)+n*(-e*a+o*s)+i*(l*a-r*s)}},{key:"translate",value:function(e,t){var n=t.elements,i=this.elements,a=i[0],r=i[1],o=i[2],s=i[3],l=i[4],h=i[5],u=i[6],d=i[7],t=i[8],i=e.x,e=e.y;n[0]=a,n[1]=r,n[2]=o,n[3]=s,n[4]=l,n[5]=h,n[6]=i*a+e*s+u,n[7]=i*r+e*l+d,n[8]=i*o+e*h+t}},{key:"rotate",value:function(e,t){var n=t.elements,i=this.elements,a=i[0],r=i[1],o=i[2],s=i[3],l=i[4],h=i[5],u=i[6],d=i[7],t=i[8],i=Math.sin(e),e=Math.cos(e);n[0]=e*a+i*s,n[1]=e*r+i*l,n[2]=e*o+i*h,n[3]=e*s-i*a,n[4]=e*l-i*r,n[5]=e*h-i*o,n[6]=u,n[7]=d,n[8]=t}},{key:"scale",value:function(e,t){var n=t.elements,i=this.elements,t=e.x,e=e.y;n[0]=t*i[0],n[1]=t*i[1],n[2]=t*i[2],n[3]=e*i[3],n[4]=e*i[4],n[5]=e*i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8]}},{key:"invert",value:function(e){var t=e.elements,n=this.elements,i=n[0],a=n[1],r=n[2],o=n[3],s=n[4],l=n[5],h=n[6],u=n[7],d=n[8],c=d*s-l*u,_=-d*o+l*h,f=u*o-s*h,n=i*c+a*_+r*f;n||(e=null),n=1/n,t[0]=c*n,t[1]=(-d*a+r*u)*n,t[2]=(l*a-r*s)*n,t[3]=_*n,t[4]=(d*i-r*h)*n,t[5]=(-l*i+r*o)*n,t[6]=f*n,t[7]=(-u*i+a*h)*n,t[8]=(s*i-a*o)*n}},{key:"transpose",value:function(e){var t,n,i=e.elements,a=this.elements;e===this?(t=a[1],n=a[2],e=a[5],i[1]=a[3],i[2]=a[6],i[3]=t,i[5]=a[7],i[6]=n,i[7]=e):(i[0]=a[0],i[1]=a[3],i[2]=a[6],i[3]=a[1],i[4]=a[4],i[5]=a[7],i[6]=a[2],i[7]=a[5],i[8]=a[8])}},{key:"identity",value:function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}},{key:"cloneTo",value:function(e){var t,n=this.elements,i=e.elements;if(n!==i)for(t=0;t<9;++t)i[t]=n[t]}},{key:"clone",value:function(){var e=new a;return this.cloneTo(e),e}}],[{key:"createRotationQuaternion",value:function(e,t){var n=e.x,i=e.y,a=e.z,r=e.w,o=n*n,s=i*i,l=a*a,h=n*i,u=a*r,d=a*n,e=i*r,a=i*a,r=n*r,t=t.elements;t[0]=1-2*(s+l),t[1]=2*(h+u),t[2]=2*(d-e),t[3]=2*(h-u),t[4]=1-2*(l+o),t[5]=2*(a+r),t[6]=2*(d+e),t[7]=2*(a-r),t[8]=1-2*(s+o)}},{key:"createFromTranslation",value:function(e,t){t.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e.x,t[7]=e.y,t[8]=1}},{key:"createFromRotation",value:function(e,t){var n=t.elements,t=Math.sin(e),e=Math.cos(e);n[0]=e,n[1]=t,n[2]=0,n[3]=-t,n[4]=e,n[5]=0,n[6]=0,n[7]=0,n[8]=1}},{key:"createFromScaling",value:function(e,t){t=t.elements;t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z}},{key:"createFromMatrix4x4",value:function(e,t){e=e.elements,t=t.elements;t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10]}},{key:"multiply",value:function(e,t,n){var i=e.elements,a=t.elements,r=n.elements,o=i[0],s=i[1],l=i[2],h=i[3],u=i[4],d=i[5],c=i[6],_=i[7],f=i[8],g=a[0],y=a[1],v=a[2],p=a[3],e=a[4],t=a[5],n=a[6],i=a[7],a=a[8];r[0]=g*o+y*h+v*c,r[1]=g*s+y*u+v*i,r[2]=g*l+y*d+v*f,r[3]=p*o+e*h+t*c,r[4]=p*s+e*u+t*_,r[5]=p*l+e*d+t*f,r[6]=n*o+i*h+a*c,r[7]=n*s+i*u+a*_,r[8]=n*l+i*d+a*f}},{key:"lookAt",value:function(e,t,n,i){vn.subtract(e,t,a._tempV30),vn.normalize(a._tempV30,a._tempV30),vn.cross(n,a._tempV30,a._tempV31),vn.normalize(a._tempV31,a._tempV31),vn.cross(a._tempV30,a._tempV31,a._tempV32);e=a._tempV30,t=a._tempV31,n=a._tempV32,i=i.elements;i[0]=t.x,i[3]=t.y,i[6]=t.z,i[1]=n.x,i[4]=n.y,i[7]=n.z,i[2]=e.x,i[5]=e.y,i[8]=e.z}}]),a}();function wi(){S(this,wi)}mi.DEFAULT=new mi,mi._tempV30=new vn,mi._tempV31=new vn,mi._tempV32=new vn,wi.Scene3D=null,wi.MeshRenderStaticBatchManager=null,wi.MeshRenderDynamicBatchManager=null,wi.SubMeshDynamicBatch=null,wi.Laya3D=null,wi.Matrix4x4=null;var xi=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;S(this,r),this.x=e,this.y=t,this.z=n,this.w=i}return C(r,[{key:"scaling",value:function(e,t){t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e}},{key:"normalize",value:function(e){var t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;0<t&&(t=1/Math.sqrt(t),e.x=this.x*t,e.y=this.y*t,e.z=this.z*t,e.w=this.w*t)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"rotateX",value:function(e,t){e*=.5;var n=Math.sin(e),e=Math.cos(e);t.x=this.x*e+this.w*n,t.y=this.y*e+this.z*n,t.z=this.z*e-this.y*n,t.w=this.w*e-this.x*n}},{key:"rotateY",value:function(e,t){e*=.5;var n=Math.sin(e),e=Math.cos(e);t.x=this.x*e-this.z*n,t.y=this.y*e+this.w*n,t.z=this.z*e+this.x*n,t.w=this.w*e-this.y*n}},{key:"rotateZ",value:function(e,t){e*=.5;var n=Math.sin(e),e=Math.cos(e);t.x=this.x*e+this.y*n,t.y=this.y*e-this.x*n,t.z=this.z*e+this.w*n,t.w=this.w*e-this.z*n}},{key:"getYawPitchRoll",value:function(e){vn.transformQuat(vn._ForwardRH,this,r.TEMPVector31),vn.transformQuat(vn._Up,this,r.TEMPVector32);var t=r.TEMPVector32;r.angleTo(vn._ZERO,r.TEMPVector31,r.TEMPVector33);var n=r.TEMPVector33;n.x==Math.PI/2?(n.y=r.arcTanAngle(t.z,t.x),n.z=0):n.x==-Math.PI/2?(n.y=r.arcTanAngle(-t.z,-t.x),n.z=0):(wi.Matrix4x4.createRotationY(-n.y,wi.Matrix4x4.TEMPMatrix0),wi.Matrix4x4.createRotationX(-n.x,wi.Matrix4x4.TEMPMatrix1),vn.transformCoordinate(r.TEMPVector32,wi.Matrix4x4.TEMPMatrix0,r.TEMPVector32),vn.transformCoordinate(r.TEMPVector32,wi.Matrix4x4.TEMPMatrix1,r.TEMPVector32),n.z=r.arcTanAngle(t.y,-t.x)),n.y<=-Math.PI&&(n.y=Math.PI),n.z<=-Math.PI&&(n.z=Math.PI),n.y>=Math.PI&&n.z>=Math.PI&&(n.y=0,n.z=0,n.x=Math.PI-n.x);e.x=n.y,e.y=n.x,e.z=n.z}},{key:"invert",value:function(e){var t=this.x,n=this.y,i=this.z,a=this.w,r=t*t+n*n+i*i+a*a,r=r?1/r:0;e.x=-t*r,e.y=-n*r,e.z=-i*r,e.w=a*r}},{key:"identity",value:function(){this.x=0,this.y=0,this.z=0,this.w=1}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3]}},{key:"cloneTo",value:function(e){this!==e&&(e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w)}},{key:"clone",value:function(){var e=new r;return this.cloneTo(e),e}},{key:"equals",value:function(e){return fn.nearEqual(this.x,e.x)&&fn.nearEqual(this.y,e.y)&&fn.nearEqual(this.z,e.z)&&fn.nearEqual(this.w,e.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"forNativeElement",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e?(this.elements=e,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z,this.elements[3]=this.w):this.elements=new Float32Array([this.x,this.y,this.z,this.w]),gn.rewriteNumProperty(this,"x",0),gn.rewriteNumProperty(this,"y",1),gn.rewriteNumProperty(this,"z",2),gn.rewriteNumProperty(this,"w",3)}}],[{key:"createFromYawPitchRoll",value:function(e,t,n,i){var a=.5*n,r=.5*t,o=.5*e,n=Math.sin(a),t=Math.cos(a),e=Math.sin(r),a=Math.cos(r),r=Math.sin(o),o=Math.cos(o);i.x=o*e*t+r*a*n,i.y=r*a*t-o*e*n,i.z=o*a*n-r*e*t,i.w=o*a*t+r*e*n}},{key:"multiply",value:function(e,t,n){var i=e.x,a=e.y,r=e.z,o=e.w,s=t.x,l=t.y,h=t.z,u=t.w,d=a*h-r*l,c=r*s-i*h,e=i*l-a*s,t=i*s+a*l+r*h;n.x=i*u+s*o+d,n.y=a*u+l*o+c,n.z=r*u+h*o+e,n.w=o*u-t}},{key:"arcTanAngle",value:function(e,t){return 0==e?1==t?Math.PI/2:-Math.PI/2:0<e?Math.atan(t/e):e<0?0<t?Math.atan(t/e)+Math.PI:Math.atan(t/e)-Math.PI:0}},{key:"angleTo",value:function(e,t,n){vn.subtract(t,e,r.TEMPVector30),vn.normalize(r.TEMPVector30,r.TEMPVector30),n.x=Math.asin(r.TEMPVector30.y),n.y=r.arcTanAngle(-r.TEMPVector30.z,-r.TEMPVector30.x)}},{key:"createFromAxisAngle",value:function(e,t,n){t*=.5;var i=Math.sin(t);n.x=i*e.x,n.y=i*e.y,n.z=i*e.z,n.w=Math.cos(t)}},{key:"createFromMatrix4x4",value:function(e,t){var n,i,a=e.elements,e=a[0]+a[5]+a[10];0<e?(n=Math.sqrt(e+1),t.w=.5*n,n=.5/n,t.x=(a[6]-a[9])*n,t.y=(a[8]-a[2])*n,t.z=(a[1]-a[4])*n):a[0]>=a[5]&&a[0]>=a[10]?(i=.5/(n=Math.sqrt(1+a[0]-a[5]-a[10])),t.x=.5*n,t.y=(a[1]+a[4])*i,t.z=(a[2]+a[8])*i,t.w=(a[6]-a[9])*i):a[5]>a[10]?(i=.5/(n=Math.sqrt(1+a[5]-a[0]-a[10])),t.x=(a[4]+a[1])*i,t.y=.5*n,t.z=(a[9]+a[6])*i,t.w=(a[8]-a[2])*i):(i=.5/(n=Math.sqrt(1+a[10]-a[0]-a[5])),t.x=(a[8]+a[2])*i,t.y=(a[9]+a[6])*i,t.z=.5*n,t.w=(a[1]-a[4])*i)}},{key:"slerp",value:function(e,t,n,i){var a,r=e.x,o=e.y,s=e.z,l=e.w,h=t.x,u=t.y,d=t.z,c=t.w,e=r*h+o*u+s*d+l*c;return e<0&&(e=-e,h=-h,u=-u,d=-d,c=-c),n=1e-6<1-e?(t=Math.acos(e),e=Math.sin(t),a=Math.sin((1-n)*t)/e,Math.sin(n*t)/e):(a=1-n,n),i.x=a*r+n*h,i.y=a*o+n*u,i.z=a*s+n*d,i.w=a*l+n*c,i}},{key:"lerp",value:function(e,t,n,i){var a=1-n;0<=r.dot(e,t)?(i.x=a*e.x+n*t.x,i.y=a*e.y+n*t.y,i.z=a*e.z+n*t.z,i.w=a*e.w+n*t.w):(i.x=a*e.x-n*t.x,i.y=a*e.y-n*t.y,i.z=a*e.z-n*t.z,i.w=a*e.w-n*t.w),i.normalize(i)}},{key:"add",value:function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}},{key:"rotationLookAt",value:function(e,t,n){r.lookAt(vn._ZERO,e,t,n)}},{key:"lookAt",value:function(e,t,n,i){mi.lookAt(e,t,n,r._tempMatrix3x3),r.rotationMatrix(r._tempMatrix3x3,i)}},{key:"invert",value:function(e,t){var n=e.lengthSquared();fn.isZero(n)||(n=1/n,t.x=-e.x*n,t.y=-e.y*n,t.z=-e.z*n,t.w=e.w*n)}},{key:"rotationMatrix",value:function(e,t){var n,i,a=e.elements,r=a[0],o=a[1],s=a[2],l=a[3],h=a[4],u=a[5],d=a[6],c=a[7],e=a[8],a=r+h+e;0<a?(n=Math.sqrt(a+1),t.w=.5*n,n=.5/n,t.x=(u-c)*n,t.y=(d-s)*n,t.z=(o-l)*n):h<=r&&e<=r?(i=.5/(n=Math.sqrt(1+r-h-e)),t.x=.5*n,t.y=(o+l)*i,t.z=(s+d)*i,t.w=(u-c)*i):e<h?(i=.5/(n=Math.sqrt(1+h-r-e)),t.x=(l+o)*i,t.y=.5*n,t.z=(c+u)*i,t.w=(d-s)*i):(i=.5/(n=Math.sqrt(1+e-r-h)),t.x=(d+s)*i,t.y=(c+u)*i,t.z=.5*n,t.w=(o-l)*i)}}]),r}();xi.TEMPVector30=new vn,xi.TEMPVector31=new vn,xi.TEMPVector32=new vn,xi.TEMPVector33=new vn,xi._tempMatrix3x3=new mi,xi.DEFAULT=new xi,xi.NAN=new xi(NaN,NaN,NaN,NaN);var ki=function(){function v(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0,h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:0,u=10<arguments.length&&void 0!==arguments[10]?arguments[10]:1,d=11<arguments.length&&void 0!==arguments[11]?arguments[11]:0,c=12<arguments.length&&void 0!==arguments[12]?arguments[12]:0,_=13<arguments.length&&void 0!==arguments[13]?arguments[13]:0,f=14<arguments.length&&void 0!==arguments[14]?arguments[14]:0,g=15<arguments.length&&void 0!==arguments[15]?arguments[15]:1,y=16<arguments.length&&void 0!==arguments[16]?arguments[16]:null;S(this,v);y=this.elements=y||new Float32Array(16);y[0]=e,y[1]=t,y[2]=n,y[3]=i,y[4]=a,y[5]=r,y[6]=o,y[7]=s,y[8]=l,y[9]=h,y[10]=u,y[11]=d,y[12]=c,y[13]=_,y[14]=f,y[15]=g}return C(v,[{key:"setRotation",value:function(e){var t=e.x,n=e.y,i=e.z,a=e.w,r=t*t,o=n*n,s=i*i,l=t*n,h=i*a,u=i*t,e=n*a,i=n*i,t=t*a,a=this.elements;a[0]=1-2*(o+s),a[1]=2*(l+h),a[2]=2*(u-e),a[4]=2*(l-h),a[5]=1-2*(s+r),a[6]=2*(i+t),a[8]=2*(u+e),a[9]=2*(i-t),a[10]=1-2*(o+r)}},{key:"setPosition",value:function(e){var t=this.elements;t[12]=e.x,t[13]=e.y,t[14]=e.z}},{key:"getElementByRowColumn",value:function(e,t){if(e<0||3<e)throw new Error("row Rows and columns for matrices run from 0 to 3, inclusive.");if(t<0||3<t)throw new Error("column Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*e+t]}},{key:"setElementByRowColumn",value:function(e,t,n){if(e<0||3<e)throw new Error("row Rows and columns for matrices run from 0 to 3, inclusive.");if(t<0||3<t)throw new Error("column Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*e+t]=n}},{key:"equalsOtherMatrix",value:function(e){var t=this.elements,e=e.elements;return fn.nearEqual(t[0],e[0])&&fn.nearEqual(t[1],e[1])&&fn.nearEqual(t[2],e[2])&&fn.nearEqual(t[3],e[3])&&fn.nearEqual(t[4],e[4])&&fn.nearEqual(t[5],e[5])&&fn.nearEqual(t[6],e[6])&&fn.nearEqual(t[7],e[7])&&fn.nearEqual(t[8],e[8])&&fn.nearEqual(t[9],e[9])&&fn.nearEqual(t[10],e[10])&&fn.nearEqual(t[11],e[11])&&fn.nearEqual(t[12],e[12])&&fn.nearEqual(t[13],e[13])&&fn.nearEqual(t[14],e[14])&&fn.nearEqual(t[15],e[15])}},{key:"decomposeTransRotScale",value:function(e,t,n){var i=v._tempMatrix4x4;return this.decomposeTransRotMatScale(e,i,n)?(xi.createFromMatrix4x4(i,t),!0):(t.identity(),!1)}},{key:"decomposeTransRotMatScale",value:function(e,t,n){var i=this.elements,a=e,r=t.elements,o=n;a.x=i[12],a.y=i[13],a.z=i[14];var s=i[0],l=i[1],h=i[2],u=i[4],d=i[5],c=i[6],_=i[8],f=i[9],g=i[10],y=o.x=Math.sqrt(s*s+l*l+h*h),e=o.y=Math.sqrt(u*u+d*d+c*c),t=o.z=Math.sqrt(_*_+f*f+g*g);if(fn.isZero(y)||fn.isZero(e)||fn.isZero(t))return r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,!(r[0]=r[5]=r[10]=r[15]=1);n=v._tempVector0;n.x=_/t,n.y=f/t,n.z=g/t;a=v._tempVector1;a.x=s/y,a.y=l/y,a.z=h/y;i=v._tempVector2;vn.cross(n,a,i);a=v._tempVector1;return vn.cross(i,n,a),r[3]=r[7]=r[11]=r[12]=r[13]=r[14]=0,r[15]=1,r[0]=a.x,r[1]=a.y,r[2]=a.z,r[4]=i.x,r[5]=i.y,r[6]=i.z,r[8]=n.x,r[9]=n.y,r[10]=n.z,r[0]*s+r[1]*l+r[2]*h<0&&(o.x=-y),r[4]*u+r[5]*d+r[6]*c<0&&(o.y=-e),r[8]*_+r[9]*f+r[10]*g<0&&(o.z=-t),!0}},{key:"decomposeYawPitchRoll",value:function(e){var t=Math.asin(-this.elements[9]);e.y=t,Math.cos(t)>fn.zeroTolerance?(e.z=Math.atan2(this.elements[1],this.elements[5]),e.x=Math.atan2(this.elements[8],this.elements[10])):(e.z=Math.atan2(-this.elements[4],this.elements[0]),e.x=0)}},{key:"normalize",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],a=Math.sqrt(t*t+n*n+i*i);if(!a)return e[0]=0,e[1]=0,void(e[2]=0);1!=a&&(a=1/a,e[0]=t*a,e[1]=n*a,e[2]=i*a)}},{key:"transpose",value:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"invert",value:function(e){var t=this.elements,n=e.elements,i=t[0],a=t[1],r=t[2],o=t[3],s=t[4],l=t[5],h=t[6],u=t[7],d=t[8],c=t[9],_=t[10],f=t[11],g=t[12],y=t[13],v=t[14],p=t[15],m=i*l-a*s,w=i*h-r*s,x=i*u-o*s,k=a*h-r*l,T=a*u-o*l,E=r*u-o*h,M=d*y-c*g,b=d*v-_*g,S=d*p-f*g,I=c*v-_*y,N=c*p-f*y,e=_*p-f*v,t=m*e-w*N+x*I+k*S-T*b+E*M;0!==Math.abs(t)&&(t=1/t,n[0]=(l*e-h*N+u*I)*t,n[1]=(r*N-a*e-o*I)*t,n[2]=(y*E-v*T+p*k)*t,n[3]=(_*T-c*E-f*k)*t,n[4]=(h*S-s*e-u*b)*t,n[5]=(i*e-r*S+o*b)*t,n[6]=(v*x-g*E-p*w)*t,n[7]=(d*E-_*x+f*w)*t,n[8]=(s*N-l*S+u*M)*t,n[9]=(a*S-i*N-o*M)*t,n[10]=(g*T-y*x+p*m)*t,n[11]=(c*x-d*T-f*m)*t,n[12]=(l*b-s*I-h*M)*t,n[13]=(i*I-a*b+r*M)*t,n[14]=(y*w-g*k-v*m)*t,n[15]=(d*k-c*w+_*m)*t)}},{key:"identity",value:function(){var e=this.elements;e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1}},{key:"cloneTo",value:function(e){var t,n=this.elements,i=e.elements;if(n!==i)for(t=0;t<16;++t)i[t]=n[t]}},{key:"clone",value:function(){var e=new v;return this.cloneTo(e),e}},{key:"getTranslationVector",value:function(e){var t=this.elements;e.x=t[12],e.y=t[13],e.z=t[14]}},{key:"setTranslationVector",value:function(e){var t=this.elements,e=e;t[12]=e.x,t[13]=e.y,t[14]=e.z}},{key:"getForward",value:function(e){var t=this.elements;e.x=-t[8],e.y=-t[9],e.z=-t[10]}},{key:"setForward",value:function(e){var t=this.elements;t[8]=-e.x,t[9]=-e.y,t[10]=-e.z}}],[{key:"createRotationX",value:function(e,t){var n=t.elements,t=Math.sin(e),e=Math.cos(e);n[1]=n[2]=n[3]=n[4]=n[7]=n[8]=n[11]=n[12]=n[13]=n[14]=0,n[0]=n[15]=1,n[5]=n[10]=e,n[6]=t,n[9]=-t}},{key:"createRotationY",value:function(e,t){var n=t.elements,t=Math.sin(e),e=Math.cos(e);n[1]=n[3]=n[4]=n[6]=n[7]=n[9]=n[11]=n[12]=n[13]=n[14]=0,n[5]=n[15]=1,n[0]=n[10]=e,n[2]=-t,n[8]=t}},{key:"createRotationZ",value:function(e,t){var n=t.elements,t=Math.sin(e),e=Math.cos(e);n[2]=n[3]=n[6]=n[7]=n[8]=n[9]=n[11]=n[12]=n[13]=n[14]=0,n[10]=n[15]=1,n[0]=n[5]=e,n[1]=t,n[4]=-t}},{key:"createRotationYawPitchRoll",value:function(e,t,n,i){xi.createFromYawPitchRoll(e,t,n,v._tempQuaternion),v.createRotationQuaternion(v._tempQuaternion,i)}},{key:"createRotationAxis",value:function(e,t,n){var i=e.x,a=e.y,r=e.z,o=Math.cos(t),s=Math.sin(t),l=i*i,h=a*a,u=r*r,d=i*a,e=i*r,t=a*r,n=n.elements;n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=l+o*(1-l),n[1]=d-o*d+s*r,n[2]=e-o*e-s*a,n[4]=d-o*d-s*r,n[5]=h+o*(1-h),n[6]=t-o*t+s*i,n[8]=e-o*e+s*a,n[9]=t-o*t-s*i,n[10]=u+o*(1-u)}},{key:"createRotationQuaternion",value:function(e,t){var n=t.elements,i=e.x,a=e.y,r=e.z,o=e.w,s=i*i,l=a*a,h=r*r,u=i*a,d=r*o,t=r*i,e=a*o,r=a*r,o=i*o;n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=1-2*(l+h),n[1]=2*(u+d),n[2]=2*(t-e),n[4]=2*(u-d),n[5]=1-2*(h+s),n[6]=2*(r+o),n[8]=2*(t+e),n[9]=2*(r-o),n[10]=1-2*(l+s)}},{key:"createTranslate",value:function(e,t){t=t.elements;t[4]=t[8]=t[1]=t[9]=t[2]=t[6]=t[3]=t[7]=t[11]=0,t[0]=t[5]=t[10]=t[15]=1,t[12]=e.x,t[13]=e.y,t[14]=e.z}},{key:"createScaling",value:function(e,t){t=t.elements;t[0]=e.x,t[5]=e.y,t[10]=e.z,t[1]=t[4]=t[8]=t[12]=t[9]=t[13]=t[2]=t[6]=t[14]=t[3]=t[7]=t[11]=0,t[15]=1}},{key:"multiply",value:function(e,t,n){var i=t.elements,a=e.elements,r=n.elements,o=i[0],s=i[1],l=i[2],h=i[3],u=i[4],d=i[5],c=i[6],_=i[7],f=i[8],g=i[9],y=i[10],v=i[11],p=i[12],m=i[13],w=i[14],x=i[15],k=a[0],T=a[1],E=a[2],M=a[3],b=a[4],S=a[5],I=a[6],N=a[7],R=a[8],C=a[9],A=a[10],t=a[11],e=a[12],n=a[13],i=a[14],a=a[15];r[0]=o*k+s*b+l*R+h*e,r[1]=o*T+s*S+l*C+h*n,r[2]=o*E+s*I+l*A+h*i,r[3]=o*M+s*N+l*t+h*a,r[4]=u*k+d*b+c*R+_*e,r[5]=u*T+d*S+c*C+_*n,r[6]=u*E+d*I+c*A+_*i,r[7]=u*M+d*N+c*t+_*a,r[8]=f*k+g*b+y*R+v*e,r[9]=f*T+g*S+y*C+v*n,r[10]=f*E+g*I+y*A+v*i,r[11]=f*M+g*N+y*t+v*a,r[12]=p*k+m*b+w*R+x*e,r[13]=p*T+m*S+w*C+x*n,r[14]=p*E+m*I+w*A+x*i,r[15]=p*M+m*N+w*t+x*a}},{key:"multiplyForNative",value:function(e,t,n){P.instance.matrix4x4Multiply(e.elements,t.elements,n.elements)}},{key:"createFromQuaternion",value:function(e,t){var n=t.elements,i=e.x,a=e.y,r=e.z,o=e.w,s=i+i,l=a+a,h=r+r,u=i*s,t=a*s,e=a*l,i=r*s,a=r*l,r=r*h,s=o*s,l=o*l,h=o*h;n[0]=1-e-r,n[1]=t+h,n[2]=i-l,n[3]=0,n[4]=t-h,n[5]=1-u-r,n[6]=a+s,n[7]=0,n[8]=i+l,n[9]=a-s,n[10]=1-u-e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}},{key:"createAffineTransformation",value:function(e,t,n,i){var a=i.elements,r=t.x,o=t.y,s=t.z,l=t.w,h=r+r,u=o+o,d=s+s,c=r*h,_=r*u,i=r*d,t=o*u,r=o*d,o=s*d,s=l*h,h=l*u,u=l*d,l=n.x,d=n.y,n=n.z;a[0]=(1-(t+o))*l,a[1]=(_+u)*l,a[2]=(i-h)*l,a[3]=0,a[4]=(_-u)*d,a[5]=(1-(c+o))*d,a[6]=(r+s)*d,a[7]=0,a[8]=(i+h)*n,a[9]=(r-s)*n,a[10]=(1-(c+t))*n,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1}},{key:"createLookAt",value:function(e,t,n,i){var a=i.elements,r=v._tempVector0,o=v._tempVector1,s=v._tempVector2;vn.subtract(e,t,s),vn.normalize(s,s),vn.cross(n,s,r),vn.normalize(r,r),vn.cross(s,r,o),i.identity(),a[0]=r.x,a[4]=r.y,a[8]=r.z,a[1]=o.x,a[5]=o.y,a[9]=o.z,a[2]=s.x,a[6]=s.y,a[10]=s.z,a[12]=-vn.dot(r,e),a[13]=-vn.dot(o,e),a[14]=-vn.dot(s,e)}},{key:"createPerspective",value:function(e,t,n,i,a){e=1/Math.tan(.5*e),t=n/(e/t),e=n/e;v.createPerspectiveOffCenter(-t,t,-e,e,n,i,a)}},{key:"createPerspectiveOffCenter",value:function(e,t,n,i,a,r,o){o=o.elements,r/=r-a;o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[12]=o[13]=o[15]=0,o[0]=2*a/(t-e),o[5]=2*a/(i-n),o[8]=(e+t)/(t-e),o[9]=(i+n)/(i-n),o[10]=-r,o[11]=-1,o[14]=-a*r}},{key:"createOrthoOffCenter",value:function(e,t,n,i,a,r,o){o=o.elements,r=1/(r-a);o[1]=o[2]=o[3]=o[4]=o[6]=o[8]=o[7]=o[9]=o[11]=0,o[15]=1,o[0]=2/(t-e),o[5]=2/(i-n),o[10]=-r,o[12]=(e+t)/(e-t),o[13]=(i+n)/(n-i),o[14]=-a*r}},{key:"billboard",value:function(e,t,n,i,a,r){vn.subtract(e,t,v._tempVector0);t=vn.scalarLengthSquared(v._tempVector0);fn.isZero(t)?(vn.scale(a,-1,v._tempVector1),v._tempVector1.cloneTo(v._tempVector0)):vn.scale(v._tempVector0,1/Math.sqrt(t),v._tempVector0),vn.cross(i,v._tempVector0,v._tempVector2),vn.normalize(v._tempVector2,v._tempVector2),vn.cross(v._tempVector0,v._tempVector2,v._tempVector3);a=v._tempVector2,t=v._tempVector3,i=v._tempVector0,r=r.elements;r[0]=a.x,r[1]=a.y,r[2]=a.z,r[3]=0,r[4]=t.x,r[5]=t.y,r[6]=t.z,r[7]=0,r[8]=i.x,r[9]=i.y,r[10]=i.z,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1}},{key:"translation",value:function(e,t){t=t.elements;t[0]=t[5]=t[10]=t[15]=1,t[12]=e.x,t[13]=e.y,t[14]=e.z}}]),v}();ki._tempMatrix4x4=new ki,ki.TEMPMatrix0=new ki,ki.TEMPMatrix1=new ki,ki._tempVector0=new vn,ki._tempVector1=new vn,ki._tempVector2=new vn,ki._tempVector3=new vn,ki._tempQuaternion=new xi,ki.DEFAULT=new ki,ki.ZERO=new ki(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var Ti=function(){T(t,kn);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,null,[{key:"randInt",value:function(e,t){return e+Math.floor(Math.random()*(t-e))}},{key:"randSign",value:function(){return.5<=Math.random()?-1:1}},{key:"getSign",value:function(e){return e<0?-1:1}},{key:"ifTouch",value:function(e,t,n,i){var a=new O(0,0,e.width,e.height),r=new L(t,n);return(i=void 0===i?!0:i)&&(r=e.globalToLocal(new L(t,n))),a.contains(r.x,r.y)}},{key:"relativeCoordinate",value:function(e,t){var n=new L(e.x,e.y),i=new L(t.x,t.y),n=e.parent.localToGlobal(n),i=t.parent.localToGlobal(i);return new L(n.x-i.x,n.y-i.y)}},{key:"convertToParentPoint",value:function(e,t){e=e.parent.localToGlobal(new L(e.x,e.y)),t=new L(t.x-t.anchorX*t.width,t.y-t.anchorY*t.height);return new L(e.x-t.x,e.y-t.y)}},{key:"twoPointAngle",value:function(e,t,n,i){e=n-e,t=i-t;return 180*Math.atan2(t,e)/Math.PI}},{key:"pingPongSE",value:function(e,t,n){if(t==n)return t;var i=n-t;return i+=i,(e-=Math.floor((e-t)/i)*i)<n?e:n+n-e}},{key:"pingPongL",value:function(e,t){if(0==t)return 0;var n=t+t;return(e-=Math.floor(e/n)*n)<t?e:n-e}},{key:"repeatSE",value:function(e,t,n){if(t==n)return t;n-=t;return e-Math.floor((e-t)/n)*n}},{key:"repeatL",value:function(e,t){return 0==t?0:e-Math.floor(e/t)*t}},{key:"clamp",value:function(e,t,n){return n<e?n:e<t?t:e}},{key:"sceenPointToWorld",value:function(e,t,n){if(null==e)throw Error("camera is null");var i,a,r,o;e.orthographic?(i=Gn.width,a=Gn.height,r=e.orthographicVerticalSize*e.aspectRatio/i,o=e.orthographicVerticalSize/a,n.x=(.5*-i+t.x)*r,n.y=(.5*a-t.y)*o,vn.transformCoordinate(n,e.transform.worldMatrix,n),n.z=t.z):(e.projectionViewMatrix.invert(this.tempMatrix4x4),n.x=(t.x-e.viewport.x)/e.viewport.width*2-1,n.y=-((t.y-e.viewport.y)/e.viewport.height*2-1),o=e.nearPlane>this.EPSILON?e.nearPlane:.3,o=t.z>this.EPSILON?-t.z-o:-o,e=e.projectionMatrix.elements,n.z=-e[10]-e[14]/o,vn.transformV3ToV4(n,this.tempMatrix4x4,this.temp0Vector4),1!==(o=this.temp0Vector4.w)&&(n.x=this.temp0Vector4.x/o,n.y=this.temp0Vector4.y/o,n.z=this.temp0Vector4.z/o))}},{key:"lookAt",value:function(e,t,n){vn.normalize(e,this.temp1Vector3),vn.cross(t,this.temp1Vector3,this.temp2Vector3),vn.normalize(this.temp2Vector3,this.temp2Vector3),vn.cross(this.temp1Vector3,this.temp2Vector3,this.temp3Vector3);var i=this.temp2Vector3,a=this.temp3Vector3,e=this.temp1Vector3,t=xi._tempMatrix3x3.elements;t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=a.x,t[4]=a.y,t[5]=a.z,t[6]=e.x,t[7]=e.y,t[8]=e.z,xi.rotationMatrix(xi._tempMatrix3x3,n)}}]),t}();Ti.EPSILON=1e-6,Ti.temp0Point=new L,Ti.temp1Point=new L,Ti.temp0Vector2=new gn,Ti.temp0Vector3=new vn,Ti.temp1Vector3=new vn,Ti.temp2Vector3=new vn,Ti.temp3Vector3=new vn,Ti.temp0Vector4=new yn,Ti.tempQuaternion=new xi,Ti.tempMatrix4x4=new ki;var Ei=function(){function r(){S(this,r)}return C(r,null,[{key:"copyProperty",value:function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}},{key:"deepClone",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length?arguments[2]:void 0;if("object"!=h(e))return e;for(t in e)if(null===e[t])n[t]=null;else if(void 0===e[t])n[t]=void 0;else if(!Yn.getDecorator(ii,e,t))if(e[t]instanceof Array){n[t]=[];for(var a=0;a<e[t].length;a++)n[t][a]=r.deepClone(e[t][a],n[t][a],i)}else!i&&"function"==typeof e[t]||(n[t]="object"===h(e[t])?r.deepClone(e[t],n[t],i):e[t]);return n}},{key:"getClassName",value:function(e){return e.constructor.toString().match(/\s(\S*)\(/)[1]}},{key:"getByFullName",value:function(e,t){var n,i=e,a=c(t.split("."));try{for(a.s();!(n=a.n()).done;)i=i[n.value]}catch(e){a.e(e)}finally{a.f()}return i}}]),r}(),Mi=function(){T(r,d);var n=b(r);function r(e){var t;return S(this,r),(t=n.call(this)).forever_event_list=[],t.cache=[],t.is_pause=!1,t.name=e,t}return C(r,[{key:"on",value:function(e,t,n,i,a){if(e)return e=this.getEventType(e),G(z(r.prototype),a?"once":"on",this).call(this,e,t,n,i);console.warn("protocol is null")}},{key:"once",value:function(e,t,n,i){return this.on(e,t,n,i,!0)}},{key:"onForever",value:function(e,t,n,i){return this.forever_event_list.push({type:e,caller:t,listener:n,args:i}),this.on(e,t,n,i)}},{key:"event",value:function(e,t){if(e){if(!this.is_pause)return e=this.getEventType(e),G(z(r.prototype),"event",this).call(this,e,t);this.cache.push({type:e,data:t})}else console.warn("event name is null")}},{key:"off",value:function(t,n,i){return t=this.getEventType(t),this.forever_event_list.find(function(e){if(e.type==t&&e.caller==n&&e.listener==i)return!0})?this:G(z(r.prototype),"off",this).call(this,t,n,i)}},{key:"offAll",value:function(e){if(e)e=this.getEventType(e),G(z(r.prototype),"offAll",this).call(this,e);else{G(z(r.prototype),"offAll",this).call(this);var t=c(this.forever_event_list);try{for(t.s();!(n=t.n()).done;){var n=n.value;G(z(r.prototype),"on",this).call(this,n.type,n.caller,n.listener,n.args)}}catch(e){t.e(e)}finally{t.f()}}return this}},{key:"offForever",value:function(e,t,n){for(var i=0;i<this.forever_event_list.length;i++){var a=this.forever_event_list[i];a.type==e&&a.caller==t&&a.listener==n&&(this.forever_event_list.splice(i,1),i--)}return this.off(e,t,n)}},{key:"pause",value:function(){this.is_pause=!0}},{key:"resume",value:function(){for(var e in this.is_pause=!1,this.cache)this.event(this.cache[e].type,this.cache[e].data);this.cache=[]}},{key:"getEventType",value:function(e){if("string"==typeof e)return e;var t=Yn.getDecorator(ai,e),n=Yn.getDecorator($n,e).toString();return n||console.error(Ei.getClassName(e)+" have no Commander"),t+"_"+n}}]),r}();Kn([ni],(e=function e(){S(this,e)}).prototype,"user_id",void 0),Kn([ni],e.prototype,"appId",void 0),Kn([ni],e.prototype,"time",void 0);var bi=function(){function e(){S(this,e),this.gameInfo={id:2130,name:"捕鱼大乱斗"}}return C(e,[{key:"serverTime",set:function(e){this.gameServerTimeOffset=zn.timer.currTimer-e},get:function(){return zn.timer.currTimer-this.gameServerTimeOffset}}]),e}(),Si=function e(){S(this,e)};function Ii(){S(this,Ii)}function Ni(){S(this,Ni)}function Ri(){S(this,Ri)}Si.config=new e,Si.data=new bi,Si.event=new Mi("game_event"),Si.EventType={GameSocketOpen:"GameSocketOpen",GameSocketClose:"GameSocketClose",OnAppPause:"OnAppPause",OnAppResume:"OnAppResume",UpdatePlatformUserInfo:"UpdatePlatformUserInfo",LoginComplete:"LoginComplete",LoginFail:"LoginFail",TimeOut:"TimeOut"},Ii.SocketOpen="SocketOpen",Ii.SocketClose="SocketClose",Ii.SocketError="SocketError",Ii.SocketDelay="SocketDelay";var Ci=function(){function d(){S(this,d)}return C(d,null,[{key:"randString",value:function(){for(var e="",t=1;t<=32;t++)e+=Math.floor(16*Math.random()).toString(16),8!=t&&12!=t&&16!=t&&20!=t||(e+="-");return e}},{key:"formatNumber",value:function(e){if(1e4<=e&&e<1e8){var t=Math.floor(e/1e4).toString().length,n=(e/1e4).toString();return 0<=n.indexOf(".")&&t<=4&&(n=n.substring(0,n.lastIndexOf(".")+(5-t))),parseFloat(n)+"万"}if(1e8<=e){t=Math.floor(e/1e8).toString().length,n=(e/1e8).toString();return 0<=n.indexOf(".")&&t<=4&&(n=n.substring(0,n.lastIndexOf(".")+(5-t))),parseFloat(n)+"亿"}return""+e}},{key:"formatNumber2",value:function(e){return d.toThousands(Number(e).toFixed(2))}},{key:"toThousands",value:function(e){for(var t=Number(e)<0,n=[],e=e.toString().replace("-","").split("."),i=e[0].split("").reverse(),e="00"==e[1]||null==e[1]?"":"."+e[1],a=0;a<i.length;a++)0!=a&&a%3==0&&n.unshift(","),n.unshift(i[a]);e=n.join("")+e;return t?"-"+e:e}},{key:"hidePhoneNumber",value:function(e){var t=e.toString();return isNaN(Number(e))||11!=t.length?t:"****"+t.substr(7,4)}},{key:"tofixNumber",value:function(e){var t=Number(Number(e).toFixed(2)),n=Number(t.toFixed(0)),e=Number(t.toFixed(1)),t=Number(t.toFixed(2));return(n==e&&n==t?n:e==t?e:t).toString()}},{key:"tweenNumber",value:function(o,s,l){var t=this,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1e3,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:50,u=5<arguments.length?arguments[5]:void 0;s!=l&&function(){var a=s,r=Math.floor(n/h);void 0===u&&(l<=1||l!=Math.floor(l))&&(u=2);for(var e=0;e<r;e++)!function(i){o.timer.once(i*h,t,function(){var e,t,n;a+=(l-s)/r,o.text=d.toThousands(a.toFixed(u)),i==r-1&&(void 0===u?(e=Number(l.toFixed(0)),t=Number(l.toFixed(1)),n=Number(l.toFixed(2)),o.text=d.toThousands(e==t&&e==n||0==u?e:t==n||1==u?t:l.toFixed(u))):o.text=d.toThousands(l.toFixed(u)))})}(e)}()}}]),d}(),Ai=function(){function e(){S(this,e)}return C(e,null,[{key:"getDeviceId",value:function(){var e=un.getItem("deviceId");return e||(e=Ci.randString(),un.setItem("deviceId",e)),e}},{key:"randomDeviceId",value:function(){for(var e,t="h5_",n=0;n<32;n++)e=0==parseInt(""+2*Math.random())?parseInt(""+26*Math.random())+97:parseInt(""+10*Math.random())+48,t+=String.fromCharCode(e);return t}},{key:"urlPathName",value:function(e){var t=e.split("//"),e=t[1].indexOf("/");return t[1].substring(e+1)}},{key:"getUrlParam",value:function(e){var t={},n=((1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||window.location.href).split("?");if(1<n.length)for(var i=n[1].split("&"),a=0;a<i.length;++a){var r=i[a].split("=");t[r[0]]=r[1]}return t.hasOwnProperty(e)?t[e]:null}},{key:"getParentUrl",value:function(){var t="";if(parent!==window)try{t=parent.location.href}catch(e){t=document.referrer}return t}}]),e}(),Di=function(){function h(e,t,n,i,a,r,o,s,l){S(this,h),this.isFirst=!0,this.name=e,this.decoder=i,this.dispatcher=n,this.debug=o,this.heartReq=a,this.heartResp=r,this.heartReqCmd=Yn.getDecorator($n,a),this.heartRespCmd=r?Yn.getDecorator($n,r):null,this.loadingView=s,this.binaryType=l,this.timer=new Cn,this.open(t)}return C(h,[{key:"open",value:function(e){this.url=e,this.socket=new WebSocket(this.url),this.timer.once(1e4,this,this.connectTimeOut),this.binaryType&&(this.socket.binaryType=this.binaryType),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onerror=this.onError.bind(this)}},{key:"connectTimeOut",value:function(){this.socket.CONNECTING||(console.log(this.name,"connect time out"),this.dispatcher.event(Ii.SocketClose,this.name),this.close())}},{key:"setErrorHander",value:function(e){this.errHandler=e}},{key:"send",value:function(e){var t,n,i;this.socket?(n=(t=Yn.getDecorator(ri,e))||this.decoder.encode(e),(i=Yn.getDecorator($n,e))||t||console.warn("no cls conf",e),i!=this.heartReqCmd&&(this.debug&&Ai.getUrlParam("netlog")||!0===at.window.netlog)&&(console.log("%c send  -----\x3e>>>  "+i+"   "+(new Date).toLocaleString(),"background:#ccfbac;"),console.log(e)),this.waitForSend(n)):this.debug&&console.error(this.name+" socket is closed",e)}},{key:"waitForSend",value:function(e){var t=this;this.socket&&(this.isFirst?setTimeout(function(){t.socket&&(1===t.socket.readyState?(t.isFirst=!1,t.socket.send(e)):t.waitForSend(e))},20):(this.isFirst=!1,this.socket.send(e)))}},{key:"onOpen",value:function(){this.debug&&console.log(this.name+" open"),this.timer.clear(this,this.connectTimeOut),this.dispatcher.event(Ii.SocketOpen,this.name)}},{key:"onMessage",value:function(e){e=this.decoder.decode(e.data);if(this.heartFlag=!0,e.cmd!=this.heartRespCmd&&(this.debug&&Ai.getUrlParam("netlog")||!0===at.window.netlog)&&e.body&&!1!==Yn.getDecorator(oi,e.body)&&(console.log("%c "+this.name+" receive  <<<<-----  "+e.cmd+"   "+(new Date).toLocaleString(),"background:#f3c0b0;"),console.log(e.body)),e.isErr&&this.errHandler&&!1!==Yn.getDecorator(ei,e.body))return console.warn(e),void this.errHandler.runWith([e.errno]);this.dispatcher.event(this.name+"_"+e.cmd,[e.body,e.errno])}},{key:"onClose",value:function(){console.log(this.name+" close accident"),this.dispatcher.event(Ii.SocketClose,this.name),this.close()}},{key:"onError",value:function(){console.log(this.name+" error"),this.dispatcher.event(Ii.SocketClose,this.name),this.close()}},{key:"close",value:function(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null,console.log(this.name+" close")),this.dispatcher&&(this.dispatcher=null),this.timer&&(this.timer.clearAll(this),this.timer=null)}},{key:"startHeart",value:function(){this.sendHeart(),this.timer.loop(1e3,this,this.sendHeart),this.timer.loop(1e4,this,this.checkHeart)}},{key:"sendHeart",value:function(){this.socket.OPEN&&this.heartReq&&this.send(this.heartReq)}},{key:"checkHeart",value:function(){!this.heartFlag&&this.heartResp?(console.log(this.name+": heart timeout"),this.dispatcher.event(Ii.SocketClose,this.name),this.close()):this.heartFlag=!1}}]),h}();function Li(e){S(this,Li),this.userid=0,this.s_key="",this.agent=0,this.username="",this.user_end="",this.domain="",this.password="",this.nickname="",this.realname="",this.sex=0,this.avatar_no=0,this.birthday="",this.client_address="",this.email="",this.telephone="",this.qq="",this.cert_type=0,this.cert_no="",this.bag_money=0,this.bank_money=0,this.pay_money=0,this.dollar_money=0,this.award_dollar=0,this.award_dollar_sum=0,this.win_dollar_sum=0,this.online_time=0,this.level=0,this.vip_level=0,this.exp_value=0,this.next_exp=0,this.award_value=0,this.next_gift=11,this.happycard=0,this.validate_realname=0,this.validate_cert=0,this.validate_video=0,this.validate_email=0,this.validate_qq=0,this.validate_mobile=0,this.inviter_id=0,this.is_virgin_paid=-1,this.agent_user_id=0,this.chick_task=-1,this.bank_validate=0,this.locked=0,this.ol_roomd_id=0,this.linecode="",this.gametype="",this.game_hid="",this.show_back_button=1,this.vip_tp=1,this.all_npc=0,this.realusername="",this.currency="",this.platform="",Ei.deepClone(e,this)}!function(e){e.name="lobby";var t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(5e3)],t);e.LobbyHeartBeat=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.v3)}}]),t}(),t=Kn([ai(e.name),$n(5006)],t),e.LobbyValidateReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.v1=this._bytes.readInt32(),this.v2=this._bytes.readInt32()}}]),t}(),t=Kn([ai(e.name),$n(5006)],t),e.LobbyValidateResp=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.vesion=this._bytes.readUTFString()}}]),t}(),t=Kn([ai(e.name),$n(9999)],t),e.LobbyVersionResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(0)}}]),t}(),t=Kn([ai(e.name),$n(5001)],t),e.LobbyRoomIdReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(5001)],t),e.LobbyRoomIdResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeInt32(this.uid),this._bytes.writeInt32(this.agent_id),this._bytes.writeUTFString(this.device_id)}}]),t}(),t=Kn([ai(e.name),$n(10001)],t),e.GuestLoginReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.uid=this._bytes.readInt32(),this.username=this._bytes.readUTFString(),this.password=this._bytes.readUTFString(),this.nickname=this._bytes.readUTFString(),this.level=this._bytes.readInt32(),this.vip_level=this._bytes.readInt32(),this.avatar_no=this._bytes.readInt32(),this.avatar_img=this._bytes.readUTFString(),this.bag_money=this._bytes.readFloat64(),this.bag_money=parseFloat(this.bag_money.toFixed(2)),this.bank_money=this._bytes.readFloat64(),this.bank_money=parseFloat(this.bank_money.toFixed(2)),this.dollar_money=this.readInt64(),this.result=this._bytes.readUTFString()}}]),t}(),t=Kn([ai(e.name),$n(10001)],t),e.GuestLoginResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeUTFString(this.username),this._bytes.writeUTFString(this.password),this._bytes.writeUTFString(this.captcha),this._bytes.writeUTFString(this.proving),this._bytes.writeUTFString(this.machineCode),this._bytes.writeByte(this.client_type),this._bytes.writeUTFString(this.token),this._bytes.writeByte(this.is_encoded)}}]),t}(),t=Kn([ai(e.name),$n(1e4)],t),e.AccountLoginReq=t,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.username=this._bytes.readUTFString(),this.password=this._bytes.readUTFString(),this.result=this._bytes.readUTFString()}}]),t}(),t=Kn([ai(e.name),$n(1e4)],t),e.AccountLoginResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){}}]),t}(),t=Kn([ai(e.name),$n(10002)],t),e.GetAccountReq=t;var n=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.userid=this._bytes.readInt32(),this.username=this._bytes.readUTFString(),this.password=this._bytes.readUTFString(),this.nickname=this._bytes.readUTFString(),this.realname=this._bytes.readUTFString(),this.sex=this._bytes.readInt16(),this.birthday=this._bytes.readUTFString(),this.avatar_no=this._bytes.readInt16(),this.inviter_id=this._bytes.readInt32(),this.chick_task=this._bytes.readInt16(),this.email=this._bytes.readUTFString(),this.telephone=this._bytes.readUTFString(),this.qq=this._bytes.readUTFString(),this.agent_user_id=this._bytes.readInt32(),this.cert_type=this._bytes.readInt16(),this.cert_no=this._bytes.readUTFString(),this.validate_realname=this._bytes.readInt16(),this.validate_cert=this._bytes.readInt16(),this.validate_video=this._bytes.readInt32(),this.validate_email=this._bytes.readInt16(),this.validate_qq=this._bytes.readInt16(),this.validate_mobile=this._bytes.readInt16(),this.wechat_id=this._bytes.readUTFString(),this.wechat_lock=this._bytes.readInt16(),this.bank_validate=this._bytes.readInt16(),this.bag_money=this._bytes.readFloat64(),this.bag_money=parseFloat(this.bag_money.toFixed(2)),this.vip_level=this._bytes.readInt16(),this.bank_money=this._bytes.readFloat64(),this.bank_money=parseFloat(this.bank_money.toFixed(2)),this.pay_money=this.readInt64(),this.dollar_money=this.readInt64(),this.promo_dollar=this.readInt64(),this.win_dollar_sum=this.readInt64(),this.online_time=this._bytes.readInt32(),this.level=this._bytes.readInt16(),this.happycard=this._bytes.readInt32(),this.locked=this._bytes.readInt16(),this.exp_value=this._bytes.readInt32(),this.award_value=this._bytes.readInt32(),this.gold_money=this.readInt64(),this.next_exp=this._bytes.readInt32(),this.gfname=this._bytes.readUTFString(),this.wfname=this._bytes.readUTFString(),this.gfname1=this._bytes.readUTFString(),this.wfname1=this._bytes.readUTFString(),this.win_times=this._bytes.readInt32(),this.lost_times=this._bytes.readInt32(),this.ol_roomd_id=this._bytes.readInt32(),this.linecode=this._bytes.readUTFString(),this.game_hid=this._bytes.readUTFString(),this.show_back_button=this._bytes.readInt32(),this.vip_tp=this._bytes.readInt32(),this.realusername=this._bytes.readUTFString(),this.all_npc=this._bytes.readInt32(),this.currency=this._bytes.readUTFString()}}]),t}();e.AccountResp=n,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.body=new n(this._bytes),this.body.decode(),this.result=this._bytes.readUTFString()}}]),t}(),t=Kn([ai(e.name),$n(10002)],t),e.GetAccountResp=t,t=function(){T(t,hi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(){this._bytes.writeByte(this.rt),this._bytes.writeInt16(this.gt),this._bytes.writeInt32(this.maxv),this._bytes.writeInt32(this.agentid),this._bytes.writeInt32(this.minv),this._bytes.writeUTFString(this.currency),this._bytes.writeInt32(this.new_agent_id),this._bytes.writeInt32(this.new_main_agent_id)}}]),t}(),t=Kn([ai(e.name),$n(10008)],t),e.QueryRoomReq=t;var i=function(){T(n,ui);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).websocket=zi.defaultWebsocket,e.fixed_seat=!0,e}return C(n,[{key:"decode",value:function(){this.room_id=this._bytes.readInt32(),this.title=this._bytes.readUTFString(),this.game_type=this._bytes.readInt16(),this.room_type=this._bytes.readInt16(),this.room_level=this._bytes.readInt16(),this.unit_money=this._bytes.readFloat64(),this.unit_money=parseFloat(this.unit_money.toFixed(2)),this.init_money=this._bytes.readFloat64(),this.init_money=parseFloat(this.init_money.toFixed(2)),this.top_money=this._bytes.readFloat64(),this.top_money=parseFloat(this.top_money.toFixed(2)),this.min_money=this._bytes.readFloat64(),this.min_money=parseFloat(this.min_money.toFixed(2)),this.max_money=this._bytes.readFloat64(),this.max_money=parseFloat(this.max_money.toFixed(2)),this.entry_fee=this._bytes.readInt32(),this.max_online=this._bytes.readInt16(),this.online_num=this._bytes.readInt16(),this.is_active=this.readBoolean(),this.close_reason=this._bytes.readUTFString(),this.remark=this._bytes.readUTFString(),this.match_id=this._bytes.readInt32(),this.create_time=this._bytes.readUTFString(),this.end_time=this._bytes.readUTFString(),this.star_level=this._bytes.readInt16(),this.dbname=this._bytes.readUTFString(),this.is_end=this.readBoolean(),this.tag=this._bytes.readUTFString(),this.cmp=this._bytes.readUTFString(),this.flex=this.readBoolean(),this.ver=this._bytes.readInt16(),this.is_old=this.readBoolean(),this.socket_encode=this._bytes.readUTFString(),this.common_top=this.readBoolean(),this.match_top=this.readBoolean(),this.cannon_rate=[];for(var e=this._bytes.readInt16();e--;)this.cannon_rate.push(this._bytes.readFloat64())}}]),n}();e.RoomInfo=i,t=function(){T(t,ui);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"decode",value:function(){this.rooms=[];for(var e=this._bytes.readInt16();e--;){var t=new i(this._bytes);t.decode(),this.rooms.push(t)}this.result=this._bytes.readUTFString()}}]),t}(),t=Kn([ai(e.name),$n(10008)],t),e.RoomInfoListResp=t}(Gr=Gr||{});var Oi=Gr,Pi=function(){T(t,Ni);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(e){var t=new nn;t.endian="BIG_ENDIAN";var n=Yn.getDecorator($n,e);t.writeUint16(n),e.encode();e=e._bytes;return e&&t.writeArrayBuffer(e.buffer),t.buffer}},{key:"decode",value:function(e){var t=new nn(e);t.endian="BIG_ENDIAN";var n,i=t.readUint16(),a=new Ri;for(n in a.cmd=i,Oi)if(i==Yn.getDecorator($n,Oi[n])&&Oi[n].__proto__==ui){var r=new Oi[n](t);r.decode(),a.body=r;break}return a}}]),t}(),Fi=function(){function e(){S(this,e)}return C(e,null,[{key:"setItem",value:function(e,t){var n="object"!=h(t)?(n={value:t,_type:h(t)},JSON.stringify(n)):JSON.stringify(t);un.setItem(e,n)}},{key:"getItem",value:function(e,t){var n=un.getItem(e);if(null===n||""==n)return t;if("null"==n)return null;if("undefined"!=n)switch((n=JSON.parse(n))._type){case"number":return Number(n.value);case"boolean":return Boolean(n.value);case"string":return n.value;default:return n}}}]),e}(),Bi=function(){T(t,Ni);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"encode",value:function(e){var t=new nn;t.endian="BIG_ENDIAN";var n=Yn.getDecorator($n,e);t.writeUint16(n),e.encode();e=e._bytes;return e&&t.writeArrayBuffer(e.buffer),t.buffer}},{key:"decode",value:function(e){var t=new nn(e);t.endian="BIG_ENDIAN";var n,i=t.readUint16(),a=new Ri;for(n in a.cmd=i,di)if(i==Yn.getDecorator($n,di[n])&&di[n].__proto__==ui){var r=new di[n](t);r.decode(),a.body=r;break}return a}}]),t}();function Vi(){S(this,Vi)}(e=ns=ns||{}).BLOB="blob",e.ARRAY_BUFFER="arraybuffer";var Ui=ns;Vi.MouseDown="MouseDown",Vi.MouseUp="MouseUp",Vi.MouseMove="MouseMove",Vi.ChangeSpeed="ChangeSpeed",Vi.ClickLockFishKindBtn="ClickLockFishKindBtn",Vi.LockFish="LockFish",Vi.RequestOtherUserStatus="RequestOtherUserStatus",Vi.SyncMyUserStatus="SyncMyUserStatus",Vi.LockRotation="LockRotation",Vi.AutoShoot="AutoShoot",Vi.TouchPhasBegan="TouchPhasBegan",Vi.LockCancel="LockCancel",Vi.MousePoint="MousePoint",Vi.GunRotation="GunRotation",Vi.SetScore="SetScore",Vi.ReConnect="ReConnect",Vi.SpeedUp="SpeedUp";var zi=function(){function r(){S(this,r)}return C(r,[{key:"send",value:function(e){var t=Yn.getDecorator(ai,e);t?t==Oi.name&&this.lobbySocket?this.lobbySocket.send(e):t==di.name&&this.gameSocket&&this.gameSocket.send(e):console.error("没有配置ServerName",e)}},{key:"loginLobby",value:function(){Si.defaultLoadingView.show();var e=r.defaultWebsocket;this.lobbySocket=new Di(Oi.name,e,Si.event,new Pi,new Oi.LobbyHeartBeat,null,Si.DEBUG,Si.defaultLoadingView,Ui.ARRAY_BUFFER),Si.event.once(Oi.LobbyValidateResp,this,this.onLobbyValidateResp)}},{key:"onLobbyValidateResp",value:function(e){var t=new Oi.LobbyValidateReq;t.v3=e.v1^e.v1+e.v2,this.send(t),Si.event.once(Oi.LobbyVersionResp,this,this.onLobbyVersionResp)}},{key:"onLobbyVersionResp",value:function(e){var t=Number(e.vesion),e=t;t==e?(this.send(new Oi.LobbyRoomIdReq),Si.event.once(Oi.LobbyRoomIdResp,this,this.loginLobbySuccess)):e<t?console.warn(t,"客户端版本太低，请清理缓存或联系客服"):console.warn("服务端版本太低，请联系客服")}},{key:"loginLobbySuccess",value:function(){console.log("lobby服务器连接成功");Ai.getUrlParam("token");var e=new Oi.GuestLoginReq;e.device_id=Ai.randomDeviceId(),e.uid=Fi.getItem("guestid_fishdld")||0,e.agent_id=0,this.send(e),Si.event.once(Oi.GuestLoginResp,this,this.onGuestLoginResp),this.lobbySocket.startHeart()}},{key:"onGuestLoginResp",value:function(e){"ok"==e.result?(Fi.setItem("guestid_fishdld",e.uid),this.send(new Oi.GetAccountReq),Si.event.once(Oi.GetAccountResp,this,this.onGetAccountResp)):console.warn(e.result,"请刷新网页重新进入")}},{key:"onAccountLoginResp",value:function(e){"ok"==e.result?(this.send(new Oi.GetAccountReq),Si.event.once(Oi.GetAccountResp,this,this.onGetAccountResp)):console.warn(e.result,"请刷新网页重新进入")}},{key:"onGetAccountResp",value:function(e){Si.data.account=new Li(e.body);e=new Oi.QueryRoomReq;e.rt=-1,e.gt=Si.data.gameInfo.id,e.maxv=39999,e.agentid=0,e.minv=0,e.currency=Si.data.account.currency,e.new_agent_id=Si.data.account.agent_id,e.new_main_agent_id=Si.data.account.main_agent_id,this.send(e),Si.event.once(Oi.RoomInfoListResp,this,function(e){"ok"==e.result?(Si.data.rooms=e.rooms,Si.event.event(Si.EventType.LoginComplete),Si.defaultLoadingView.hide()):console.warn(e.result)})}},{key:"loginGame",value:function(e){this.loginRoom=e,this.gameSocket=new Di(di.name,e.websocket,Si.event,new Bi,new di.GameHeartReq,new di.GameHeartResp,Si.DEBUG,Si.defaultLoadingView,Ui.ARRAY_BUFFER),Si.event.once(di.GameValidateResp,this,this.onGameValidateResp)}},{key:"onGameValidateResp",value:function(e){var t=new di.GameValidateReq;t.v3=e.v1^e.v1+e.v2,this.send(t),Si.event.once(di.GameVersionResp,this,this.onGameVersionResp)}},{key:"onGameVersionResp",value:function(e){var t=Number(e.vesion),n=t;t==n?((e=new di.GameRoomIdReq).roomid=this.loginRoom.room_id,this.send(e),Si.event.once(di.GameRoomIdResp,this,this.onGameRoomIdResp)):n<t?console.warn(t,"客户端版本太低，请清理缓存或联系客服"):console.warn("服务端版本太低，请联系客服")}},{key:"onGameRoomIdResp",value:function(){console.log("game服务器连接成功");var e=new di.GameLoginReq;e.all_npc=Si.data.account.all_npc,e.userid=Si.data.account.userid,e.password=Si.data.account.password,e.client_type=0,e.client_info="h5",e.version=3,e.fixseat=this.loginRoom.fixed_seat,e.dbname=this.loginRoom.dbname,e.first_money=this.loginRoom.min_money,e.roomid=this.loginRoom.room_id,e.linecode=Si.data.account.linecode,this.send(e),Si.event.once(di.LoginSuccessResp,this,this.onLoginSuccessResp),this.gameSocket.startHeart()}},{key:"onLoginSuccessResp",value:function(e){e.re_enter||((e=new di.GameSitReq).sitIndex=-1,e.tableId=-1,this.send(e)),Si.event.once(di.UpdateIntomoney,this,this.onUpdateIntomoney)}},{key:"onUpdateIntomoney",value:function(){var e=new di.GameReadyReq;this.send(e)}},{key:"noticeMouseAction",value:function(e,t,n,i){var a=new di.FishCustomEventReq;a.info=JSON.stringify({uid:e,op:t,mouseX:n,mouseY:i}),r.I.send(a)}},{key:"noticeSpeedChange",value:function(e,t){var n=new di.FishCustomEventReq;n.info=JSON.stringify({uid:e,op:Vi.ChangeSpeed,speed:t}),r.I.send(n)}},{key:"noticeLockFish",value:function(e,t){var n=new di.FishCustomEventReq;n.info=JSON.stringify({uid:e,op:Vi.LockFish,fishUniqueId:t}),r.I.send(n)}},{key:"noticeClickLockFishKindBtn",value:function(e,t){var n=new di.FishCustomEventReq;n.info=JSON.stringify({uid:e,op:Vi.ClickLockFishKindBtn,value:t}),r.I.send(n)}},{key:"noticeSyncMyStatus",value:function(e){var t=new di.FishCustomEventReq;t.info=JSON.stringify(e),r.I.send(t)}},{key:"noticeRequestOtherUserStatus",value:function(){var e=new di.FishCustomEventReq;e.info=JSON.stringify({op:Vi.RequestOtherUserStatus}),r.I.send(e)}}],[{key:"I",get:function(){return this.instance||(this.instance=new r),this.instance}}]),r}();zi.defaultWebsocket="ws://asdfasdf.789.cn:9031/";var Gi=function(){function n(){S(this,n),this.textureName=null,this.textureCount=1,this.maxPartices=100,this.duration=1,this.ageAddScale=0,this.emitterVelocitySensitivity=1,this.minStartSize=100,this.maxStartSize=100,this.minEndSize=100,this.maxEndSize=100,this.minHorizontalVelocity=0,this.maxHorizontalVelocity=0,this.minVerticalVelocity=0,this.maxVerticalVelocity=0,this.endVelocity=1,this.gravity=new Float32Array([0,0,0]),this.minRotateSpeed=0,this.maxRotateSpeed=0,this.minStartRadius=0,this.maxStartRadius=0,this.minEndRadius=0,this.maxEndRadius=0,this.minHorizontalStartRadian=0,this.maxHorizontalStartRadian=0,this.minVerticalStartRadian=0,this.maxVerticalStartRadian=0,this.useEndRadian=!0,this.minHorizontalEndRadian=0,this.maxHorizontalEndRadian=0,this.minVerticalEndRadian=0,this.maxVerticalEndRadian=0,this.minStartColor=new Float32Array([1,1,1,1]),this.maxStartColor=new Float32Array([1,1,1,1]),this.minEndColor=new Float32Array([1,1,1,1]),this.maxEndColor=new Float32Array([1,1,1,1]),this.colorComponentInter=!1,this.disableColor=!1,this.blendState=0,this.emitterType="null",this.emissionRate=0,this.pointEmitterPosition=new Float32Array([0,0,0]),this.pointEmitterPositionVariance=new Float32Array([0,0,0]),this.pointEmitterVelocity=new Float32Array([0,0,0]),this.pointEmitterVelocityAddVariance=new Float32Array([0,0,0]),this.boxEmitterCenterPosition=new Float32Array([0,0,0]),this.boxEmitterSize=new Float32Array([0,0,0]),this.boxEmitterVelocity=new Float32Array([0,0,0]),this.boxEmitterVelocityAddVariance=new Float32Array([0,0,0]),this.sphereEmitterCenterPosition=new Float32Array([0,0,0]),this.sphereEmitterRadius=1,this.sphereEmitterVelocity=0,this.sphereEmitterVelocityAddVariance=0,this.ringEmitterCenterPosition=new Float32Array([0,0,0]),this.ringEmitterRadius=30,this.ringEmitterVelocity=0,this.ringEmitterVelocityAddVariance=0,this.ringEmitterUp=2,this.positionVariance=new Float32Array([0,0,0])}return C(n,null,[{key:"checkSetting",value:function(e){for(var t in n._defaultSetting)t in e||(e[t]=n._defaultSetting[t]);e.endVelocity=+e.endVelocity,e.gravity[0]=+e.gravity[0],e.gravity[1]=+e.gravity[1],e.gravity[2]=+e.gravity[2]}}]),n}();Gi._defaultSetting=new Gi;var Xi=function(){function e(){S(this,e)}return C(e,[{key:"addParticleArray",value:function(e,t){}}]),e}(),Hi=function(){function o(){S(this,o)}return C(o,null,[{key:"Create",value:function(e,t,n,i){var a=new o;a.position=t,kn.scaleVector3(n,e.emitterVelocitySensitivity,o._tempVelocity);var r,t=kn.lerp(e.minHorizontalVelocity,e.maxHorizontalVelocity,Math.random()),n=Math.random()*Math.PI*2;if(o._tempVelocity[0]+=t*Math.cos(n),o._tempVelocity[2]+=t*Math.sin(n),o._tempVelocity[1]+=kn.lerp(e.minVerticalVelocity,e.maxVerticalVelocity,Math.random()),a.velocity=o._tempVelocity,a.startColor=o._tempStartColor,a.endColor=o._tempEndColor,e.disableColor){for(r=0;r<3;r++)a.startColor[r]=1,a.endColor[r]=1;a.startColor[r]=kn.lerp(e.minStartColor[r],e.maxStartColor[r],Math.random()),a.endColor[r]=kn.lerp(e.minEndColor[r],e.maxEndColor[r],Math.random())}else if(e.colorComponentInter)for(r=0;r<4;r++)a.startColor[r]=kn.lerp(e.minStartColor[r],e.maxStartColor[r],Math.random()),a.endColor[r]=kn.lerp(e.minEndColor[r],e.maxEndColor[r],Math.random());else kn.lerpVector4(e.minStartColor,e.maxStartColor,Math.random(),a.startColor),kn.lerpVector4(e.minEndColor,e.maxEndColor,Math.random(),a.endColor);a.sizeRotation=o._tempSizeRotation;n=Math.random();a.sizeRotation[0]=kn.lerp(e.minStartSize,e.maxStartSize,n),a.sizeRotation[1]=kn.lerp(e.minEndSize,e.maxEndSize,n),a.sizeRotation[2]=kn.lerp(e.minRotateSpeed,e.maxRotateSpeed,Math.random()),a.radius=o._tempRadius;n=Math.random();a.radius[0]=kn.lerp(e.minStartRadius,e.maxStartRadius,n),a.radius[1]=kn.lerp(e.minEndRadius,e.maxEndRadius,n),a.radian=o._tempRadian,a.radian[0]=kn.lerp(e.minHorizontalStartRadian,e.maxHorizontalStartRadian,Math.random()),a.radian[1]=kn.lerp(e.minVerticalStartRadian,e.maxVerticalStartRadian,Math.random());n=e.useEndRadian;return a.radian[2]=n?kn.lerp(e.minHorizontalEndRadian,e.maxHorizontalEndRadian,Math.random()):a.radian[0],a.radian[3]=n?kn.lerp(e.minVerticalEndRadian,e.maxVerticalEndRadian,Math.random()):a.radian[1],a.durationAddScale=e.ageAddScale*Math.random(),a.time=i,a}}]),o}();Hi._tempVelocity=new Float32Array(3),Hi._tempStartColor=new Float32Array(4),Hi._tempEndColor=new Float32Array(4),Hi._tempSizeRotation=new Float32Array(3),Hi._tempRadius=new Float32Array(2),Hi._tempRadian=new Float32Array(4);var Yi=function(){T(i,Xi);var n=b(i);function i(e){var t;return S(this,i),(t=n.call(this))._floatCountPerVertex=29,t._firstActiveElement=0,t._firstNewElement=0,t._firstFreeElement=0,t._firstRetiredElement=0,t._currentTime=0,t.settings=e,t}return C(i,[{key:"reUse",value:function(e,t){return 0}},{key:"initialize",value:function(){var e;this._vertices=this._mesh._vb.getFloat32Array(),e=this._mesh._stride/4;for(var t=0,n=0,i=0;i<this.settings.maxPartices;i++){for(var a=Math.random(),r=this.settings.textureCount?1/this.settings.textureCount:1,o=0;o<this.settings.textureCount&&!(a<o+r);o+=r);this._vertices[t++]=-1,this._vertices[t++]=-1,this._vertices[t++]=0,this._vertices[t++]=o,t=n+=e,this._vertices[t++]=1,this._vertices[t++]=-1,this._vertices[t++]=1,this._vertices[t++]=o,t=n+=e,this._vertices[t++]=1,this._vertices[t++]=1,this._vertices[t++]=1,this._vertices[t++]=o+r,t=n+=e,this._vertices[t++]=-1,this._vertices[t++]=1,this._vertices[t++]=0,this._vertices[t++]=o+r,t=n+=e}}},{key:"update",value:function(e){this._currentTime+=e/1e3,this.retireActiveParticles(),this.freeRetiredParticles(),this._firstActiveElement==this._firstFreeElement&&(this._currentTime=0),this._firstRetiredElement==this._firstActiveElement&&(this._drawCounter=0)}},{key:"retireActiveParticles",value:function(){for(var e=this.settings.duration;this._firstActiveElement!=this._firstNewElement;){var t=this._firstActiveElement*this._floatCountPerVertex*4,n=28+t,i=this._currentTime-this._vertices[n];if(1e-4+(i*=1+this._vertices[27+t])<e)break;this._vertices[n]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this.settings.maxPartices&&(this._firstActiveElement=0)}}},{key:"freeRetiredParticles",value:function(){for(;this._firstRetiredElement!=this._firstActiveElement;){if(this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*4+28]<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this.settings.maxPartices&&(this._firstRetiredElement=0)}}},{key:"addNewParticlesToVertexBuffer",value:function(){}},{key:"addParticleArray",value:function(e,t){var n=this._firstFreeElement+1;if((n=n>=this.settings.maxPartices?0:n)!==this._firstRetiredElement){for(var i=Hi.Create(this.settings,e,t,this._currentTime),a=this._firstFreeElement*this._floatCountPerVertex*4,r=0;r<4;r++){for(var o=0,s=4;o<3;o++)this._vertices[a+r*this._floatCountPerVertex+s+o]=i.position[o];for(o=0,s=7;o<3;o++)this._vertices[a+r*this._floatCountPerVertex+s+o]=i.velocity[o];for(o=0,s=10;o<4;o++)this._vertices[a+r*this._floatCountPerVertex+s+o]=i.startColor[o];for(o=0,s=14;o<4;o++)this._vertices[a+r*this._floatCountPerVertex+s+o]=i.endColor[o];for(o=0,s=18;o<3;o++)this._vertices[a+r*this._floatCountPerVertex+s+o]=i.sizeRotation[o];for(o=0,s=21;o<2;o++)this._vertices[a+r*this._floatCountPerVertex+s+o]=i.radius[o];for(o=0,s=23;o<4;o++)this._vertices[a+r*this._floatCountPerVertex+s+o]=i.radian[o];this._vertices[a+r*this._floatCountPerVertex+27]=i.durationAddScale,this._vertices[a+r*this._floatCountPerVertex+28]=i.time}this._firstFreeElement=n}}}]),i}(),Wi="attribute vec4 a_CornerTextureCoordinate;\nattribute vec3 a_Position;\nattribute vec3 a_Velocity;\nattribute vec4 a_StartColor;\nattribute vec4 a_EndColor;\nattribute vec3 a_SizeRotation;\nattribute vec2 a_Radius;\nattribute vec4 a_Radian;\nattribute float a_AgeAddScale;\nattribute float a_Time;\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\n\nuniform float u_CurrentTime;\nuniform float u_Duration;\nuniform float u_EndVelocity;\nuniform vec3 u_Gravity;\n\nuniform vec2 size;\nuniform mat4 u_mmat;\n\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\n{\n\n   float startVelocity = length(velocity);//起始标量速度\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\n\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\n   \n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\n   \n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\n   \n   float r =cos(radianVertical)* radius;\n   addPosition.y += sin(radianVertical) * radius;\n\t\n   addPosition.x += cos(radianHorizontal) *r;\n   addPosition.z += sin(radianHorizontal) *r;\n  \n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\n   position+=addPosition;\n   return  vec4(position,1.0);\n}\n\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\n{    \n    float size = mix(startSize, endSize, normalizedAge);\n    return size;\n}\n\nmat2 ComputeParticleRotation(in float rot,in float age)\n{    \n    float rotation =rot * age;\n    //计算2x2旋转矩阵.\n    float c = cos(rotation);\n    float s = sin(rotation);\n    return mat2(c, -s, s, c);\n}\n\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\n{\n\tvec4 color=mix(startColor,endColor,normalizedAge);\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\n   \n    return color;\n}\n\nvoid main()\n{\n   float age = u_CurrentTime - a_Time;\n   age *= 1.0 + a_AgeAddScale;\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\n\t\n    mat4 mat=u_mmat;\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\n    gl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\n   \n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\n}\n\n",ji="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\n\nvoid main()\n{\t\n\tgl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\tgl_FragColor.xyz *= v_Color.w;\n}",qi=function(){T(t,$);var e=b(t);function t(){return S(this,t),e.call(this,Wi,ji,"ParticleShader",null,["a_CornerTextureCoordinate",0,"a_Position",1,"a_Velocity",2,"a_StartColor",3,"a_EndColor",4,"a_SizeRotation",5,"a_Radius",6,"a_Radian",7,"a_AgeAddScale",8,"a_Time",9])}return t}();qi.vs=Wi,qi.ps=ji;var Zi=function(){T(n,ee);var t=b(n);function n(){var e;return S(this,n),e=t.call(this,0,0),n.pShader||(n.pShader=new qi),e}return C(n,[{key:"upload",value:function(){var e=this.size;e[0]=j.width,e[1]=j.height,this.alpha=this.ALPHA*j.worldAlpha,n.pShader.upload(this)}}]),n}();Zi.pShader=null;var Ki=function(){T(a,Yi);var i=b(a);function a(e){var t;S(this,a),(t=i.call(this,e)).x=0,t.y=0,t.sv=new Zi,t._key={};var n=u(t);return M.loader.load(t.settings.textureName,F.create(null,function(e){n.texture=e}),null,on.IMAGE),t.sv.u_Duration=t.settings.duration,t.sv.u_Gravity=t.settings.gravity,t.sv.u_EndVelocity=t.settings.endVelocity,t._blendFn=K.fns[e.blendState],t._mesh=Un.getAMesh(t.settings.maxPartices),t.initialize(),t}return C(a,[{key:"getRenderType",value:function(){return-111}},{key:"releaseRender",value:function(){}},{key:"addParticleArray",value:function(e,t){e[0]+=this.x,e[1]+=this.y,G(z(a.prototype),"addParticleArray",this).call(this,e,t)}},{key:"addNewParticlesToVertexBuffer",value:function(){var e,t=this._mesh._vb;t.clear(),t.append(this._vertices),this._firstNewElement<this._firstFreeElement?(e=4*this._firstNewElement*this._floatCountPerVertex*4,t.subUpload(e,e,e+4*(this._firstFreeElement-this._firstNewElement)*this._floatCountPerVertex*4)):(e=4*this._firstNewElement*this._floatCountPerVertex*4,t.subUpload(e,e,e+4*(this.settings.maxPartices-this._firstNewElement)*this._floatCountPerVertex*4),0<this._firstFreeElement&&(t.setNeedUpload(),t.subUpload(0,0,4*this._firstFreeElement*this._floatCountPerVertex*4))),this._firstNewElement=this._firstFreeElement}},{key:"renderSubmit",value:function(){var e;return this.texture&&this.texture.getIsReady()&&(this.update(M.timer._delta),this.sv.u_CurrentTime=this._currentTime,this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this.blend(),this._firstActiveElement!=this._firstFreeElement&&(e=y.mainContext,this._mesh.useMesh(e),this.sv.u_texture=this.texture._getSource(),this.sv.upload(),this._firstActiveElement<this._firstFreeElement?e.drawElements(e.TRIANGLES,6*(this._firstFreeElement-this._firstActiveElement),e.UNSIGNED_SHORT,6*this._firstActiveElement*2):(y.mainContext.drawElements(e.TRIANGLES,6*(this.settings.maxPartices-this._firstActiveElement),e.UNSIGNED_SHORT,6*this._firstActiveElement*2),0<this._firstFreeElement&&e.drawElements(e.TRIANGLES,6*this._firstFreeElement,e.UNSIGNED_SHORT,0)),J.renderBatches++),this._drawCounter++),1}},{key:"updateParticleForNative",value:function(){this.texture&&this.texture.getIsReady()&&(this.update(M.timer._delta),this.sv.u_CurrentTime=this._currentTime,this._firstNewElement!=this._firstFreeElement&&(this._firstNewElement=this._firstFreeElement))}},{key:"getMesh",value:function(){return this._mesh}},{key:"getConchMesh",value:function(){return this._conchMesh}},{key:"getFirstNewElement",value:function(){return this._firstNewElement}},{key:"getFirstFreeElement",value:function(){return this._firstFreeElement}},{key:"getFirstActiveElement",value:function(){return this._firstActiveElement}},{key:"getFirstRetiredElement",value:function(){return this._firstRetiredElement}},{key:"setFirstFreeElement",value:function(e){this._firstFreeElement=e}},{key:"setFirstNewElement",value:function(e){this._firstNewElement=e}},{key:"addDrawCounter",value:function(){this._drawCounter++}},{key:"blend",value:function(){var e;K.activeBlendFunction!==this._blendFn&&((e=y.mainContext).enable(e.BLEND),this._blendFn(e),K.activeBlendFunction=this._blendFn)}},{key:"dispose",value:function(){this._mesh.releaseMesh()}}]),a}();Ki.activeBlendType=-1;var Qi=function(){function e(){S(this,e),this._frameTime=0,this._emissionRate=60,this._emissionTime=0,this.minEmissionTime=1/60}return C(e,[{key:"start",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Number.MAX_VALUE;0!=this._emissionRate&&(this._emissionTime=e)}},{key:"stop",value:function(){this._emissionTime=0}},{key:"clear",value:function(){this._emissionTime=0}},{key:"emit",value:function(){}},{key:"advanceTime",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;if(this._emissionTime-=e,!(this._emissionTime<0||(this._frameTime+=e,this._frameTime<this.minEmissionTime)))for(;this._frameTime>this.minEmissionTime;)this._frameTime-=this.minEmissionTime,this.emit()}},{key:"particleTemplate",set:function(e){this._particleTemplate=e}},{key:"emissionRate",set:function(e){e<=0||0<(this._emissionRate=e)&&(this.minEmissionTime=1/e)},get:function(){return this._emissionRate}}]),e}(),Ji=function(){T(i,Qi);var n=b(i);function i(e){var t;return S(this,i),(t=n.call(this)).template=e,t}return C(i,[{key:"emit",value:function(){G(z(i.prototype),"emit",this).call(this),null!=this._emitFun&&this._emitFun()}},{key:"getRandom",value:function(e){return(2*Math.random()-1)*e}},{key:"webGLEmit",value:function(){var e=new Float32Array(3);e[0]=this.getRandom(this._posRange[0]),e[1]=this.getRandom(this._posRange[1]),e[2]=this.getRandom(this._posRange[2]);var t=new Float32Array(3);t[0]=0,t[1]=0,t[2]=0,this._particleTemplate.addParticleArray(e,t)}},{key:"canvasEmit",value:function(){var e=new Float32Array(3);e[0]=this.getRandom(this._posRange[0]),e[1]=this.getRandom(this._posRange[1]),e[2]=this.getRandom(this._posRange[2]);var t=new Float32Array(3);t[0]=0,t[1]=0,t[2]=0,this._particleTemplate.addParticleArray(e,t)}},{key:"template",set:function(e){(this._particleTemplate=e)||(this._emitFun=null,this.setting=null,this._posRange=null),this.setting=e.settings,this._posRange=this.setting.positionVariance,this._particleTemplate instanceof Ki&&(this._emitFun=this.webGLEmit)},get:function(){return this._particleTemplate}}]),i}(),$i=function(){function n(){S(this,n)}return C(n,[{key:"recover",value:function(){this._templ=null,g.recover("DrawParticleCmd",this)}},{key:"run",value:function(e,t,n){e.drawParticle(t,n,this._templ)}},{key:"cmdID",get:function(){return n.ID}}],[{key:"create",value:function(e){var t=g.getItemByClass("DrawParticleCmd",n);return t._templ=e,t}}]),n}();$i.ID="DrawParticleCmd";var ea=function(){T(i,Bt);var n=b(i);function i(e){var t;return S(this,i),(t=n.call(this))._matrix4=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),t.autoPlay=!0,t.customRenderEnable=!0,e&&t.setParticleSetting(e),t}return C(i,[{key:"load",value:function(e){M.loader.load(e,F.create(this,this.setParticleSetting),null,M.Loader.JSON)}},{key:"setParticleSetting",value:function(e){if(!e)return this.stop();Gi.checkSetting(e),this.customRenderEnable=!0,this._particleTemplate=new Ki(e),this.graphics._saveToCmd(null,$i.create(this._particleTemplate)),this._emitter?this._emitter.template=this._particleTemplate:this._emitter=new Ji(this._particleTemplate),this.autoPlay&&(this.emitter.start(),this.play())}},{key:"play",value:function(){M.timer.frameLoop(1,this,this._loop)}},{key:"stop",value:function(){M.timer.clear(this,this._loop)}},{key:"_loop",value:function(){this.advanceTime(1/60)}},{key:"advanceTime",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this._canvasTemplate&&this._canvasTemplate.advanceTime(e),this._emitter&&this._emitter.advanceTime(e)}},{key:"customRender",value:function(e,t,n){this._matrix4[0]=e._curMat.a,this._matrix4[1]=e._curMat.b,this._matrix4[4]=e._curMat.c,this._matrix4[5]=e._curMat.d,this._matrix4[12]=e._curMat.tx,this._matrix4[13]=e._curMat.ty,this._particleTemplate.sv.u_mmat=this._matrix4,this._canvasTemplate&&this._canvasTemplate.render(e,t,n)}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._particleTemplate instanceof Ki&&this._particleTemplate.dispose(),G(z(i.prototype),"destroy",this).call(this,e)}},{key:"url",set:function(e){this.load(e)}},{key:"emitter",get:function(){return this._emitter}}]),i}();M.regClass(ea);var ta=function(){T(r,vi);var a=b(r);function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return S(this,r),(e=a.call(this))._clipX=1,e._clipY=1,e._clipWidth=0,e._clipHeight=0,e._interval=50,e._index=0,e._toIndex=-1,e._clipX=n,e._clipY=i,e.skin=t,e}return C(r,[{key:"destroy",value:function(){G(z(r.prototype),"destroy",this).call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null}},{key:"dispose",value:function(){this.destroy(!0),M.loader.clearRes(this._skin)}},{key:"createChildren",value:function(){this.graphics=this._bitmap=new _i}},{key:"_onDisplay",value:function(e){this._isPlaying?this._getBit(It.DISPLAYED_INSTAGE)?this.play():this.stop():this._autoPlay&&this.play()}},{key:"_skinLoaded",value:function(){this._setClipChanged(),this._sizeChanged(),this.event(Je.LOADED)}},{key:"changeClip",value:function(){var e;this._clipChanged=!1,this._skin&&((e=on.getRes(this._skin))?this.loadComplete(this._skin,e):M.loader.load(this._skin,F.create(this,this.loadComplete,[this._skin])))}},{key:"loadComplete",value:function(e,t){if(e===this._skin&&t){var n=this._clipWidth||Math.ceil(t.sourceWidth/this._clipX),i=this._clipHeight||Math.ceil(t.sourceHeight/this._clipY),a=this._skin+n+i,e=Mn.I.get(a);if(e=!ae.isOkTextureList(e)?null:e)this._sources=e;else{this._sources=[];for(var r=0;r<this._clipY;r++)for(var o=0;o<this._clipX;o++)this._sources.push($e.createFromTexture(t,n*o,i*r,n,i));Mn.I.set(a,this._sources)}this.index=this._index,this.event(Je.LOADED),this.onCompResize()}}},{key:"measureWidth",value:function(){return this.runCallLater(this.changeClip),this._bitmap.width}},{key:"measureHeight",value:function(){return this.runCallLater(this.changeClip),this._bitmap.height}},{key:"play",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;this._isPlaying=!0,this.index=e,this._toIndex=t,this._index++,M.timer.loop(this.interval,this,this._loop),this.on(Je.DISPLAY,this,this._onDisplay),this.on(Je.UNDISPLAY,this,this._onDisplay)}},{key:"_loop",value:function(){this._visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)}},{key:"stop",value:function(){this._isPlaying=!1,M.timer.clear(this,this._loop),this.event(Je.COMPLETE)}},{key:"_setClipChanged",value:function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin!=e&&((this._skin=e)?on.getRes(e)?this._skinLoaded():M.loader.load(this._skin,F.create(this,this._skinLoaded),null,on.IMAGE,1):this._bitmap.source=null)}},{key:"clipX",get:function(){return this._clipX},set:function(e){this._clipX=e||1,this._setClipChanged()}},{key:"clipY",get:function(){return this._clipY},set:function(e){this._clipY=e||1,this._setClipChanged()}},{key:"clipWidth",get:function(){return this._clipWidth},set:function(e){this._clipWidth=e,this._setClipChanged()}},{key:"clipHeight",get:function(){return this._clipHeight},set:function(e){this._clipHeight=e,this._setClipChanged()}},{key:"sources",get:function(){return this._sources},set:function(e){this._sources=e,this.index=this._index,this.event(Je.LOADED)}},{key:"group",get:function(){return this._group},set:function(e){e&&this._skin&&on.setGroup(this._skin,e),this._group=e}},{key:"width",set:function(e){s(z(r.prototype),"width",e,this,!0),this._bitmap.width=e},get:function(){return G(z(r.prototype),"width",this)}},{key:"height",set:function(e){s(z(r.prototype),"height",e,this,!0),this._bitmap.height=e},get:function(){return G(z(r.prototype),"height",this)}},{key:"sizeGrid",get:function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},set:function(e){this._bitmap.sizeGrid=yi.fillArray(ci.defaultSizeGrid,e,Number)}},{key:"index",get:function(){return this._index},set:function(e){this._index=e,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[e]),this.event(Je.CHANGE)}},{key:"total",get:function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}},{key:"autoPlay",get:function(){return this._autoPlay},set:function(e){this._autoPlay!=e&&((this._autoPlay=e)?this.play():this.stop())}},{key:"interval",get:function(){return this._interval},set:function(e){this._interval!=e&&(this._interval=e,this._isPlaying&&this.play())}},{key:"isPlaying",get:function(){return this._isPlaying},set:function(e){this._isPlaying=e}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.index=parseInt(e):s(z(r.prototype),"dataSource",e,this,!0)},get:function(){return G(z(r.prototype),"dataSource",this)}},{key:"bitmap",get:function(){return this._bitmap}}]),r}();M.regClass(ta),Dt.regClass("laya.ui.Clip",ta),Dt.regClass("Laya.Clip",ta);var na=function(){function e(){S(this,e)}return C(e,null,[{key:"lightAttenTexture",value:function(e,t,n,i,a,r){e/=n,n=1/(1+25*e);.64<=e&&(1<e?n=0:n*=1-(e-.64)/.36),r[a]=Math.floor(255*n+.5)}},{key:"haloTexture",value:function(e,t,n,i,a,r){n=(e-(n>>=1))/n,i=(t-(i>>=1))/i,i=n*n+i*i;1<i&&(i=1),r[a]=Math.floor(255*(1-i)+.5)}},{key:"_generateTexture2D",value:function(e,t,n,i){var a=0,r=0;switch(e.format){case f.R8G8B8:r=3;break;case f.R8G8B8A8:r=4;break;case f.Alpha8:r=1;break;default:throw"GeneratedTexture._generateTexture: unkonw texture format."}for(var o=new Uint8Array(t*n*r),s=0;s<n;s++)for(var l=0;l<t;l++)i(l,s,t,n,a,o),a+=r;e.setPixels(o)}}]),e}(),ia=function(){function b(){S(this,b)}return C(b,null,[{key:"_createFloatTextureBuffer",value:function(e,t){t=new X(e,t,f.R32G32B32A32,!1,!1);return t.filterMode=U.FILTERMODE_POINT,t.wrapModeU=U.WARPMODE_CLAMP,t.wrapModeV=U.WARPMODE_CLAMP,t.anisoLevel=0,t}},{key:"_convertToLayaVec3",value:function(e,t,n){t.x=n?-e.x():e.x(),t.y=e.y(),t.z=e.z()}},{key:"_convertToBulletVec3",value:function(e,t,n){t.setValue(n?-e.x:e.x,e.y,e.z)}},{key:"_rotationTransformScaleSkinAnimation",value:function(e,t,n,i,a,r,o,s,l,h,u,d){var c,_,f,g,y,v=b._tempArray16_0,p=b._tempArray16_1,m=b._tempArray16_2,w=i+i,x=a+a,k=r+r,T=i*w,E=a*w,M=a*x,i=r*w,a=r*x,r=r*k,w=o*w,x=o*x,k=o*k;for(v[15]=1,v[0]=1-M-r,v[1]=E+k,v[2]=i-x,v[4]=E-k,v[5]=1-T-r,v[6]=a+w,v[8]=i+x,v[9]=a-w,v[10]=1-T-M,p[15]=1,p[0]=s,p[5]=l,p[10]=h,c=0;c<4;c++)_=v[c],f=v[c+4],g=v[c+8],y=v[c+12],m[c]=_,m[c+4]=f,m[c+8]=g,m[c+12]=_*e+f*t+g*n+y;for(c=0;c<4;c++)_=m[c],f=m[c+4],g=m[c+8],y=m[c+12],u[c+d]=_*p[0]+f*p[1]+g*p[2]+y*p[3],u[c+d+4]=_*p[4]+f*p[5]+g*p[6]+y*p[7],u[c+d+8]=_*p[8]+f*p[9]+g*p[10]+y*p[11],u[c+d+12]=_*p[12]+f*p[13]+g*p[14]+y*p[15]}},{key:"_computeBoneAndAnimationDatasByBindPoseMatrxix",value:function(e,t,n,i,a,r){for(var o,s=0,l=0,h=e.length,u=0;u<h;s+=e[u].keyframeWidth,l+=16,u++)b._rotationTransformScaleSkinAnimation(t[s+0],t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],t[s+6],t[s+7],t[s+8],t[s+9],i,l),0!=u&&(o=16*e[u].parentIndex,b.mulMatrixByArray(i,o,i,l,i,l));var d=n.length;for(u=0;u<d;u++)b.mulMatrixByArrayAndMatrixFast(i,16*r[u],n[u],a,16*u)}},{key:"_computeAnimationDatasByArrayAndMatrixFast",value:function(e,t,n,i){for(var a=0,r=e.length;a<r;a++)b.mulMatrixByArrayAndMatrixFast(t,16*i[a],e[a],n,16*a)}},{key:"_computeBoneAndAnimationDatasByBindPoseMatrxixOld",value:function(e,t,n,i,a){for(var r,o=0,s=0,l=e.length,h=0;h<l;o+=e[h].keyframeWidth,s+=16,h++)b._rotationTransformScaleSkinAnimation(t[o+7],t[o+8],t[o+9],t[o+3],t[o+4],t[o+5],t[o+6],t[o+0],t[o+1],t[o+2],i,s),0!=h&&(r=16*e[h].parentIndex,b.mulMatrixByArray(i,r,i,s,i,s));var u=n.length;for(h=0;h<u;h++){var d=16*h;b.mulMatrixByArrayAndMatrixFast(i,d,n[h],a,d)}}},{key:"_computeAnimationDatasByArrayAndMatrixFastOld",value:function(e,t,n){for(var i=e.length,a=0;a<i;a++){var r=16*a;b.mulMatrixByArrayAndMatrixFast(t,r,e[a],n,r)}}},{key:"_computeRootAnimationData",value:function(e,t,n){for(var i=0,a=0,r=0,o=e.length;i<o;a+=e[i].keyframeWidth,r+=16,i++)b.createAffineTransformationArray(t[a+0],t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],t[a+9],n,r)}},{key:"transformVector3ArrayByQuat",value:function(e,t,n,i,a){var r=e[t],o=e[t+1],s=e[t+2],l=n.x,h=n.y,u=n.z,d=n.w,e=d*r+h*s-u*o,t=d*o+u*r-l*s,n=d*s+l*o-h*r,s=-l*r-h*o-u*s;i[a]=e*d+s*-l+t*-u-n*-h,i[a+1]=t*d+s*-h+n*-l-e*-u,i[a+2]=n*d+s*-u+e*-h-t*-l}},{key:"mulMatrixByArray",value:function(e,t,n,i,a,r){var o,s,l,h,u;if(a===n){for(n=b._tempArray16_3,o=0;o<16;++o)n[o]=a[r+o];i=0}for(o=0;o<4;o++)s=e[t+o],l=e[t+o+4],h=e[t+o+8],u=e[t+o+12],a[r+o]=s*n[i+0]+l*n[i+1]+h*n[i+2]+u*n[i+3],a[r+o+4]=s*n[i+4]+l*n[i+5]+h*n[i+6]+u*n[i+7],a[r+o+8]=s*n[i+8]+l*n[i+9]+h*n[i+10]+u*n[i+11],a[r+o+12]=s*n[i+12]+l*n[i+13]+h*n[i+14]+u*n[i+15]}},{key:"mulMatrixByArrayFast",value:function(e,t,n,i,a,r){for(var o,s,l,h,u=0;u<4;u++)o=e[t+u],s=e[t+u+4],l=e[t+u+8],h=e[t+u+12],a[r+u]=o*n[i+0]+s*n[i+1]+l*n[i+2]+h*n[i+3],a[r+u+4]=o*n[i+4]+s*n[i+5]+l*n[i+6]+h*n[i+7],a[r+u+8]=o*n[i+8]+s*n[i+9]+l*n[i+10]+h*n[i+11],a[r+u+12]=o*n[i+12]+s*n[i+13]+l*n[i+14]+h*n[i+15]}},{key:"mulMatrixByArrayAndMatrixFast",value:function(e,t,n,i,a){for(var r,o,s,l,n=n.elements,h=n[0],u=n[1],d=n[2],c=n[3],_=n[4],f=n[5],g=n[6],y=n[7],v=n[8],p=n[9],m=n[10],w=n[11],x=n[12],k=n[13],T=n[14],E=n[15],M=t,b=t+4,S=t+8,I=t+12,N=a,R=a+4,C=a+8,A=a+12,D=0;D<4;D++)r=e[M+D],o=e[b+D],s=e[S+D],l=e[I+D],i[N+D]=r*h+o*u+s*d+l*c,i[R+D]=r*_+o*f+s*g+l*y,i[C+D]=r*v+o*p+s*m+l*w,i[A+D]=r*x+o*k+s*T+l*E}},{key:"createAffineTransformationArray",value:function(e,t,n,i,a,r,o,s,l,h,u,d){var c=i+i,_=a+a,f=r+r,g=i*c,y=i*_,v=i*f,i=a*_,a=a*f,r=r*f,c=o*c,_=o*_,f=o*f;u[d+0]=(1-(i+r))*s,u[d+1]=(y+f)*s,u[d+2]=(v-_)*s,u[d+3]=0,u[d+4]=(y-f)*l,u[d+5]=(1-(g+r))*l,u[d+6]=(a+c)*l,u[d+7]=0,u[d+8]=(v+_)*h,u[d+9]=(a-c)*h,u[d+10]=(1-(g+i))*h,u[d+11]=0,u[d+12]=e,u[d+13]=t,u[d+14]=n,u[d+15]=1}},{key:"transformVector3ArrayToVector3ArrayCoordinate",value:function(e,t,n,i,a){var r=e[t+0],o=e[t+1],e=e[t+2],t=n.elements,n=r*t[3]+o*t[7]+e*t[11]+t[15];i[a]=r*t[0]+o*t[4]+e*t[8]+t[12]/n,i[a+1]=r*t[1]+o*t[5]+e*t[9]+t[13]/n,i[a+2]=r*t[2]+o*t[6]+e*t[10]+t[14]/n}},{key:"transformLightingMapTexcoordArray",value:function(e,t,n,i,a){i[a+0]=e[t+0]*n.x+n.z,i[a+1]=1-((1-e[t+1])*n.y+n.w)}},{key:"getURLVerion",value:function(e){var t=e.indexOf("?");return 0<=t?e.substr(t):null}},{key:"_createAffineTransformationArray",value:function(e,t,n,i){var a=t.x,r=t.y,o=t.z,s=t.w,l=a+a,h=r+r,u=o+o,d=a*l,c=a*h,_=a*u,t=r*h,a=r*u,r=o*u,o=s*l,l=s*h,h=s*u,s=n.x,u=n.y,n=n.z;i[0]=(1-(t+r))*s,i[1]=(c+h)*s,i[2]=(_-l)*s,i[3]=0,i[4]=(c-h)*u,i[5]=(1-(d+r))*u,i[6]=(a+o)*u,i[7]=0,i[8]=(_+l)*n,i[9]=(a-o)*n,i[10]=(1-(d+t))*n,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1}},{key:"_mulMatrixArray",value:function(e,t,n,i){for(var a,r,o,s,t=t.elements,l=t[0],h=t[1],u=t[2],d=t[3],c=t[4],_=t[5],f=t[6],g=t[7],y=t[8],v=t[9],p=t[10],m=t[11],w=t[12],x=t[13],k=t[14],T=t[15],E=i,M=i+4,b=i+8,S=i+12,I=0;I<4;I++)a=e[I],r=e[I+4],o=e[I+8],s=e[I+12],n[E+I]=a*l+r*h+o*u+s*d,n[M+I]=a*c+r*_+o*f+s*g,n[b+I]=a*y+r*v+o*p+s*m,n[S+I]=a*w+r*x+o*k+s*T}},{key:"arcTanAngle",value:function(e,t){return 0==e?1==t?Math.PI/2:-Math.PI/2:0<e?Math.atan(t/e):e<0?0<t?Math.atan(t/e)+Math.PI:Math.atan(t/e)-Math.PI:0}},{key:"angleTo",value:function(e,t,n){vn.subtract(t,e,xi.TEMPVector30),vn.normalize(xi.TEMPVector30,xi.TEMPVector30),n.x=Math.asin(xi.TEMPVector30.y),n.y=b.arcTanAngle(-xi.TEMPVector30.z,-xi.TEMPVector30.x)}},{key:"transformQuat",value:function(e,t,n){var i=e.x,a=e.y,r=e.z,o=t[0],s=t[1],l=t[2],h=t[3],u=h*i+s*r-l*a,e=h*a+l*i-o*r,t=h*r+o*a-s*i,r=-o*i-s*a-l*r;n.x=u*h+r*-o+e*-l-t*-s,n.y=e*h+r*-s+t*-o-u*-l,n.z=t*h+r*-l+u*-s-e*-o}},{key:"quaternionWeight",value:function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w}},{key:"quaternionConjugate",value:function(e,t){t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w}},{key:"scaleWeight",value:function(e,t,n){var i=e.x,a=e.y,e=e.z;n.x=0<i?Math.pow(Math.abs(i),t):-Math.pow(Math.abs(i),t),n.y=0<a?Math.pow(Math.abs(a),t):-Math.pow(Math.abs(a),t),n.z=0<e?Math.pow(Math.abs(e),t):-Math.pow(Math.abs(e),t)}},{key:"scaleBlend",value:function(e,t,n,i){var a=b._tempVector3_0,r=b._tempVector3_1;b.scaleWeight(e,1-n,a),b.scaleWeight(t,n,r);e=.5<n?t:e;i.x=0<e.x?Math.abs(a.x*r.x):-Math.abs(a.x*r.x),i.y=0<e.y?Math.abs(a.y*r.y):-Math.abs(a.y*r.y),i.z=0<e.z?Math.abs(a.z*r.z):-Math.abs(a.z*r.z)}},{key:"matrix4x4MultiplyFFF",value:function(e,t,n){var i,a,r,o;if(n===t)for(t=new Float32Array(16),T=0;T<16;++T)t[T]=n[T];for(var s=t[0],l=t[1],h=t[2],u=t[3],d=t[4],c=t[5],_=t[6],f=t[7],g=t[8],y=t[9],v=t[10],p=t[11],m=t[12],w=t[13],x=t[14],k=t[15],T=0;T<4;T++)i=e[T],a=e[T+4],r=e[T+8],o=e[T+12],n[T]=i*s+a*l+r*h+o*u,n[T+4]=i*d+a*c+r*_+o*f,n[T+8]=i*g+a*y+r*v+o*p,n[T+12]=i*m+a*w+r*x+o*k}},{key:"matrix4x4MultiplyFFFForNative",value:function(e,t,n){P.instance.matrix4x4Multiply(e,t,n)}},{key:"matrix4x4MultiplyMFM",value:function(e,t,n){b.matrix4x4MultiplyFFF(e.elements,t,n.elements)}},{key:"_buildTexture2D",value:function(e,t,n,i){n=new X(e,t,n,4<arguments.length&&void 0!==arguments[4]&&arguments[4],!0);return n.anisoLevel=1,n.filterMode=U.FILTERMODE_POINT,na._generateTexture2D(n,e,t,i),n}},{key:"_drawBound",value:function(e,t,n){e.lineCount+12>e.maxLineCount&&(e.maxLineCount+=12);var i=b._tempVector3_0,a=b._tempVector3_1,r=t.min,t=t.max;i.setValue(r.x,r.y,r.z),a.setValue(t.x,r.y,r.z),e.addLine(i,a,n,n),i.setValue(r.x,r.y,r.z),a.setValue(r.x,r.y,t.z),e.addLine(i,a,n,n),i.setValue(t.x,r.y,r.z),a.setValue(t.x,r.y,t.z),e.addLine(i,a,n,n),i.setValue(r.x,r.y,t.z),a.setValue(t.x,r.y,t.z),e.addLine(i,a,n,n),i.setValue(r.x,r.y,r.z),a.setValue(r.x,t.y,r.z),e.addLine(i,a,n,n),i.setValue(r.x,r.y,t.z),a.setValue(r.x,t.y,t.z),e.addLine(i,a,n,n),i.setValue(t.x,r.y,r.z),a.setValue(t.x,t.y,r.z),e.addLine(i,a,n,n),i.setValue(t.x,r.y,t.z),a.setValue(t.x,t.y,t.z),e.addLine(i,a,n,n),i.setValue(r.x,t.y,r.z),a.setValue(t.x,t.y,r.z),e.addLine(i,a,n,n),i.setValue(r.x,t.y,r.z),a.setValue(r.x,t.y,t.z),e.addLine(i,a,n,n),i.setValue(t.x,t.y,r.z),a.setValue(t.x,t.y,t.z),e.addLine(i,a,n,n),i.setValue(r.x,t.y,t.z),a.setValue(t.x,t.y,t.z),e.addLine(i,a,n,n)}},{key:"_getHierarchyPath",value:function(e,t,n){n.length=0;for(var i=t;i!==e;){var a=i._parent;if(!a)return null;n.push(a.getChildIndex(i)),i=a}return n}},{key:"_getNodeByHierarchyPath",value:function(e,t){for(var n=e,i=t.length-1;0<=i;i--)n=n.getChildAt(t[i]);return n}}]),b}();ia._tempVector3_0=new vn,ia._tempVector3_1=new vn,ia._tempArray16_0=new Float32Array(16),ia._tempArray16_1=new Float32Array(16),ia._tempArray16_2=new Float32Array(16),ia._tempArray16_3=new Float32Array(16),ia._compIdToNode=new Object;var aa=function(){function e(){S(this,e)}return C(e,[{key:"_resetPlayState",value:function(e){this._finish=!1,this._startPlayTime=e,this._elapsedTime=e,this._playEventIndex=0,this._lastIsFront=!0}},{key:"_cloneTo",value:function(e){e._finish=this._finish,e._startPlayTime=this._startPlayTime,e._elapsedTime=this._elapsedTime,e._playEventIndex=this._playEventIndex,e._lastIsFront=this._lastIsFront}},{key:"normalizedTime",get:function(){return this._normalizedTime}},{key:"duration",get:function(){return this._duration}}]),e}(),ra=function(){function t(e){S(this,t),this._defaultState=null,this._referenceCount=0,this._statesMap={},this.playOnWake=!0,this._playType=-1,this._crossMark=0,this._crossDuration=-1,this._crossNodesOwnersIndicesMap={},this._crossNodesOwnersCount=0,this._crossNodesOwners=[],this._currentPlayState=null,this._states=[],this._playStateInfo=new aa,this._crossPlayStateInfo=new aa,this._srcCrossClipNodeIndices=[],this._destCrossClipNodeIndices=[],this.name=e,this.defaultWeight=1,this.blendingMode=t.BLENDINGMODE_OVERRIDE}return C(t,[{key:"_removeClip",value:function(e,t,n,i){var a=i._clip,r=e[n];if(e.splice(n,1),delete t[i.name],this._animator){var o=a._nodes,s=r._nodeOwners;a._removeReference();for(var l=0,h=o.count;l<h;l++)this._animator._removeKeyframeNodeOwner(s,o.getNodeByIndex(l))}}},{key:"_getReferenceCount",value:function(){return this._referenceCount}},{key:"_addReference",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=0,n=this._states.length;t<n;t++)this._states[t]._addReference(e);this._referenceCount+=e}},{key:"_removeReference",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=0,n=this._states.length;t<n;t++)this._states[t]._removeReference(e);this._referenceCount-=e}},{key:"_clearReference",value:function(){this._removeReference(-this._referenceCount)}},{key:"getAnimatorState",value:function(e){e=this._statesMap[e];return e||null}},{key:"addState",value:function(e){var t=e.name;if(this._statesMap[t])throw"AnimatorControllerLayer:this stat's name has exist.";this._statesMap[t]=e,this._states.push(e),this._animator&&(e._clip._addReference(),this._animator._getOwnersByClip(e))}},{key:"removeState",value:function(e){for(var t=this._states,n=-1,i=0,a=t.length;i<a;i++)if(t[i]===e){n=i;break}-1!==n&&this._removeClip(t,this._statesMap,n,e)}},{key:"destroy",value:function(){this._clearReference(),this._statesMap=null,this._states=null,this._playStateInfo=null,this._crossPlayStateInfo=null,this._defaultState=null}},{key:"cloneTo",value:function(e){e.name=this.name,e.blendingMode=this.blendingMode,e.defaultWeight=this.defaultWeight,e.playOnWake=this.playOnWake}},{key:"clone",value:function(){var e=new t(this.name);return this.cloneTo(e),e}},{key:"defaultState",get:function(){return this._defaultState},set:function(e){this._defaultState=e,this._statesMap[e.name]=e}}]),t}();ra.BLENDINGMODE_OVERRIDE=0,ra.BLENDINGMODE_ADDTIVE=1;var oa=function(){function t(){S(this,t),this._referenceCount=0,this._clip=null,this._nodeOwners=[],this._currentFrameIndices=null,this._scripts=null,this.speed=1,this.clipStart=0,this.clipEnd=1}return C(t,[{key:"_getReferenceCount",value:function(){return this._referenceCount}},{key:"_addReference",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this._clip&&this._clip._addReference(e),this._referenceCount+=e}},{key:"_removeReference",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this._clip&&this._clip._removeReference(e),this._referenceCount-=e}},{key:"_clearReference",value:function(){this._removeReference(-this._referenceCount)}},{key:"_resetFrameIndices",value:function(){for(var e=0,t=this._currentFrameIndices.length;e<t;e++)this._currentFrameIndices[e]=-1}},{key:"addScript",value:function(e){e=new e;return this._scripts=this._scripts||[],this._scripts.push(e),e}},{key:"getScript",value:function(e){if(this._scripts)for(var t=0,n=this._scripts.length;t<n;t++){var i=this._scripts[t];if(i instanceof e)return i}return null}},{key:"getScripts",value:function(e){var t;if(this._scripts)for(var n=0,i=this._scripts.length;n<i;n++){var a=this._scripts[n];a instanceof e&&(t=t||[]).push(a)}return t}},{key:"cloneTo",value:function(e){e.name=this.name,e.speed=this.speed,e.clipStart=this.clipStart,e.clipEnd=this.clipEnd,e.clip=this._clip}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}},{key:"clip",get:function(){return this._clip},set:function(e){this._clip!==e&&(this._clip&&0<this._referenceCount&&this._clip._removeReference(this._referenceCount),e&&(this._currentFrameIndices=new Int16Array(e._nodes.count),this._resetFrameIndices(),0<this._referenceCount&&this._clip._addReference(this._referenceCount)),this._clip=e)}}]),t}(),sa=function(){function e(){S(this,e),this.indexInList=-1,this.referenceCount=0,this.updateMark=-1,this.type=-1,this.fullPath=null,this.propertyOwner=null,this.property=null,this.defaultValue=null,this.crossFixedValue=null}return C(e,[{key:"saveCrossFixedValue",value:function(){var e=this.propertyOwner;if(e)switch(this.type){case 0:for(var t=this.property,n=t.length-1,i=0;i<n&&(e=e[t[i]]);i++);this.crossFixedValue=e[t[n]];break;case 1:var a=e.localPosition;this.crossFixedValue||(this.crossFixedValue=new vn),this.crossFixedValue.x=a.x,this.crossFixedValue.y=a.y,this.crossFixedValue.z=a.z;break;case 2:a=e.localRotation;this.crossFixedValue||(this.crossFixedValue=new xi),this.crossFixedValue.x=a.x,this.crossFixedValue.y=a.y,this.crossFixedValue.z=a.z,this.crossFixedValue.w=a.w;break;case 3:var r=e.localScale;this.crossFixedValue||(this.crossFixedValue=new vn),this.crossFixedValue.x=r.x,this.crossFixedValue.y=r.y,this.crossFixedValue.z=r.z;break;case 4:r=e.localRotationEuler;this.crossFixedValue||(this.crossFixedValue=new vn),this.crossFixedValue.x=r.x,this.crossFixedValue.y=r.y,this.crossFixedValue.z=r.z;break;default:throw"Animator:unknown type."}}}]),e}(),la=function(){T(k,wn);var t=b(k);function k(){var e;return S(this,k),(e=t.call(this))._keyframeNodeOwners=[],e._linkAvatarSpritesData={},e._linkAvatarSprites=[],e._renderableSprites=[],e.cullingMode=k.CULLINGMODE_CULLCOMPLETELY,e._controllerLayers=[],e._linkSprites={},e._speed=1,e._keyframeNodeOwnerMap={},e._updateMark=0,e}return C(k,[{key:"_linkToSprites",value:function(e){for(var t in e){for(var n=this.owner,i=e[t],a=0,r=i.length;a<r;a++){var o=i[a];if(""===o)break;if(!(n=n.getChildByName(o)))break}n&&this.linkSprite3DToAvatarNode(t,n)}}},{key:"_addKeyframeNodeOwner",value:function(e,t,n){var i=t._indexInList,a=t.fullPath,r=this._keyframeNodeOwnerMap[a];if(r)r.referenceCount++,e[i]=r;else{for(var o=n,s=0,l=t.propertyCount;s<l&&(o=o[t.getPropertyByIndex(s)]);s++);(r=this._keyframeNodeOwnerMap[a]=new sa).fullPath=a,r.indexInList=this._keyframeNodeOwners.length,r.referenceCount=1,r.propertyOwner=n;for(var h=t.propertyCount,u=[],s=0;s<h;s++)u[s]=t.getPropertyByIndex(s);r.property=u,r.type=t.type,o&&(0===t.type?r.defaultValue=o:(n=new o.constructor,o.cloneTo(n),r.defaultValue=n)),this._keyframeNodeOwners.push(r),e[i]=r}}},{key:"_removeKeyframeNodeOwner",value:function(e,t){var n=t.fullPath,i=this._keyframeNodeOwnerMap[n];i&&(i.referenceCount--,0===i.referenceCount&&(delete this._keyframeNodeOwnerMap[n],this._keyframeNodeOwners.splice(this._keyframeNodeOwners.indexOf(i),1)),e[t._indexInList]=null)}},{key:"_getOwnersByClip",value:function(e){var t=e._clip._nodes,n=t.count,i=e._nodeOwners;i.length=n;for(var a=0;a<n;a++){for(var r,o=t.getNodeByIndex(a),s=this._avatar?this._avatarNodeMap[this._avatar._rootNode.name]:this.owner,l=0,h=o.ownerPathCount;l<h;l++){var u=o.getOwnerPathByIndex(l);if(""===u)break;if(!(s=s.getChildByName(u)))break}!s||(s=(r=o.propertyOwner)?s[r]:s)&&this._addKeyframeNodeOwner(i,o,s)}}},{key:"_updatePlayer",value:function(e,t,n,i){var a=e._clip._duration*(e.clipEnd-e.clipStart),r=t._elapsedTime,n=r+n;t._lastElapsedTime=r;r=(t._elapsedTime=n)/a,r=(t._normalizedTime=r)%1;t._normalizedPlayTime=r<0?1+r:r,t._duration=a;var o=e._scripts;if(!i&&a<=n){if(t._finish=!0,t._elapsedTime=a,t._normalizedPlayTime=1,o)for(var s=0,l=o.length;s<l;s++)o[s].onStateExit()}else if(o)for(s=0,l=o.length;s<l;s++)o[s].onStateUpdate()}},{key:"_eventScript",value:function(e,t,n,i,a){if(a)for(var r=t.length;n<r;n++){var o=t[n];if(!(o.time<=i))break;for(var s=0,l=e.length;s<l;s++){var h=e[s],u=h[o.eventName];u&&u.apply(h,o.params)}}else for(;0<=n&&(o=t[n]).time>=i;n--)for(s=0,l=e.length;s<l;s++)(u=(h=e[s])[o.eventName])&&u.apply(h,o.params);return n}},{key:"_updateEventScript",value:function(e,t){var n=this.owner._scripts;if(n){var i=e._clip,a=i._animationEvents,r=i._duration,o=t._elapsedTime,e=o%r,i=Math.abs(Math.floor(o/r)-Math.floor(t._lastElapsedTime/r)),o=t._elapsedTime>=t._lastElapsedTime;if(t._lastIsFront!==o&&(o?t._playEventIndex++:t._playEventIndex--,t._lastIsFront=o),0==i)t._playEventIndex=this._eventScript(n,a,t._playEventIndex,e,o);else if(o){this._eventScript(n,a,t._playEventIndex,r,!0);for(var s=0,l=i-1;s<l;s++)this._eventScript(n,a,0,r,!0);t._playEventIndex=this._eventScript(n,a,0,e,!0)}else{this._eventScript(n,a,t._playEventIndex,0,!1);for(var h=a.length-1,s=0,l=i-1;s<l;s++)this._eventScript(n,a,h,0,!1);t._playEventIndex=this._eventScript(n,a,h,e,!1)}}}},{key:"_updateClipDatas",value:function(e,t,n,i){var a=e._clip,r=a._duration,r=e.clipStart*r+n._normalizedPlayTime*n._duration,e=e._currentFrameIndices,n=n._elapsedTime>n._lastElapsedTime;a._evaluateClipDatasRealTime(a._nodes,r,e,t,n)}},{key:"_applyFloat",value:function(e,t,n,i,a,r,o){var s;n.updateMark===this._updateMark?i?e[t]+=a*o:(s=e[t],e[t]=s+a*(o-s)):r?e[t]=i?n.defaultValue+o:o:i?e[t]=n.defaultValue+a*o:(n=n.defaultValue,e[t]=n+a*(o-n))}},{key:"_applyPositionAndRotationEuler",value:function(e,t,n,i,a,r){var o,s,l,h;e.updateMark===this._updateMark?t?(r.x+=n*a.x,r.y+=n*a.y,r.z+=n*a.z):(o=r.x,s=r.y,l=r.z,r.x=o+n*(a.x-o),r.y=s+n*(a.y-s),r.z=l+n*(a.z-l)):i?t?(h=e.defaultValue,r.x=h.x+a.x,r.y=h.y+a.y,r.z=h.z+a.z):(r.x=a.x,r.y=a.y,r.z=a.z):(h=e.defaultValue,t?(r.x=h.x+n*a.x,r.y=h.y+n*a.y,r.z=h.z+n*a.z):(e=h.x,t=h.y,h=h.z,r.x=e+n*(a.x-e),r.y=t+n*(a.y-t),r.z=h+n*(a.z-h)))}},{key:"_applyRotation",value:function(e,t,n,i,a,r){var o,s;e.updateMark===this._updateMark?t?(o=k._tempQuaternion1,ia.quaternionWeight(a,n,o),o.normalize(o),xi.multiply(r,o,r)):xi.lerp(r,a,n,r):i?t?(s=e.defaultValue,xi.multiply(s,a,r)):(r.x=a.x,r.y=a.y,r.z=a.z,r.w=a.w):(s=e.defaultValue,t?(o=k._tempQuaternion1,ia.quaternionWeight(a,n,o),o.normalize(o),xi.multiply(s,o,r)):xi.lerp(s,a,n,r))}},{key:"_applyScale",value:function(e,t,n,i,a,r){var o,s;e.updateMark===this._updateMark?t?(o=k._tempVector31,ia.scaleWeight(a,n,o),r.x=r.x*o.x,r.y=r.y*o.y,r.z=r.z*o.z):ia.scaleBlend(r,a,n,r):i?t?(s=e.defaultValue,r.x=s.x*a.x,r.y=s.y*a.y,r.z=s.z*a.z):(r.x=a.x,r.y=a.y,r.z=a.z):(s=e.defaultValue,t?(o=k._tempVector31,ia.scaleWeight(a,n,o),r.x=s.x*o.x,r.y=s.y*o.y,r.z=s.z*o.z):ia.scaleBlend(s,a,n,r))}},{key:"_applyCrossData",value:function(e,t,n,i,a,r,o){var s=e.propertyOwner;if(s){switch(e.type){case 0:for(var l=e.property,h=l.length-1,u=0;u<h&&(s=s[l[u]]);u++);var d=a+o*(r-a);this._applyFloat(s,l[h],e,t,n,i,d);break;case 1:var c=s.localPosition,_=k._tempVector30,f=a.x,g=a.y,y=a.z;_.x=f+o*(r.x-f),_.y=g+o*(r.y-g),_.z=y+o*(r.z-y),this._applyPositionAndRotationEuler(e,t,n,i,_,c),s.localPosition=c;break;case 2:_=s.localRotation,c=k._tempQuaternion0;xi.lerp(a,r,o,c),this._applyRotation(e,t,n,i,c,_),s.localRotation=_;break;case 3:var v=s.localScale,p=k._tempVector30;ia.scaleBlend(a,r,o,p),this._applyScale(e,t,n,i,p,v),s.localScale=v;break;case 4:p=s.localRotationEuler,v=k._tempVector30,f=a.x,g=a.y,y=a.z;v.x=f+o*(r.x-f),v.y=g+o*(r.y-g),v.z=y+o*(r.z-y),this._applyPositionAndRotationEuler(e,t,n,i,v,p),s.localRotationEuler=p}e.updateMark=this._updateMark}}},{key:"_setClipDatasToNode",value:function(e,t,n,i){for(var a=e._clip._nodes,r=e._nodeOwners,o=0,s=a.count;o<s;o++){var l=r[o];if(l){var h=l.propertyOwner;if(h){switch(l.type){case 0:for(var u=l.property,d=u.length-1,c=0;c<d&&(h=h[u[c]]);c++);this._applyFloat(h,u[d],l,t,n,i,a.getNodeByIndex(o).data);break;case 1:var _=h.localPosition;this._applyPositionAndRotationEuler(l,t,n,i,a.getNodeByIndex(o).data,_),h.localPosition=_;break;case 2:_=h.localRotation;this._applyRotation(l,t,n,i,a.getNodeByIndex(o).data,_),h.localRotation=_;break;case 3:var f=h.localScale;this._applyScale(l,t,n,i,a.getNodeByIndex(o).data,f),h.localScale=f;break;case 4:f=h.localRotationEuler;this._applyPositionAndRotationEuler(l,t,n,i,a.getNodeByIndex(o).data,f),h.localRotationEuler=f}l.updateMark=this._updateMark}}}}},{key:"_setCrossClipDatasToNode",value:function(e,t,n,i,a){for(var r=e._crossNodesOwners,o=e._crossNodesOwnersCount,s=e.blendingMode!==ra.BLENDINGMODE_OVERRIDE,l=e.defaultWeight,h=e._destCrossClipNodeIndices,u=n._clip._nodes,d=n._nodeOwners,c=e._srcCrossClipNodeIndices,_=t._nodeOwners,f=t._clip._nodes,g=0;g<o;g++){var y,v,p,m=r[g];m&&(p=c[g],y=h[g],v=-1!==p?f.getNodeByIndex(p).data:d[y].defaultValue,p=-1!==y?u.getNodeByIndex(y).data:_[p].defaultValue,this._applyCrossData(m,s,l,a,v,p,i))}}},{key:"_setFixedCrossClipDatasToNode",value:function(e,t,n,i){for(var a=e._crossNodesOwners,r=e._crossNodesOwnersCount,o=e.blendingMode!==ra.BLENDINGMODE_OVERRIDE,s=e.defaultWeight,l=e._destCrossClipNodeIndices,h=t._clip._nodes,u=0;u<r;u++){var d,c,_=a[u];_&&(c=l[u],d=_.crossFixedValue,c=-1!==c?h.getNodeByIndex(c).data:_.defaultValue,this._applyCrossData(_,o,s,i,d,c,n))}}},{key:"_revertDefaultKeyframeNodes",value:function(e){for(var t=e._nodeOwners,n=0,i=t.length;n<i;n++){var a=t[n];if(a){var r=a.propertyOwner;if(r)switch(a.type){case 0:for(var o=a.property,s=o.length-1,l=0;l<s&&(r=r[o[l]]);l++);r[o[s]]=a.defaultValue;break;case 1:var h=r.localPosition,u=a.defaultValue;h.x=u.x,h.y=u.y,h.z=u.z,r.localPosition=h;break;case 2:var d=r.localRotation,h=a.defaultValue;d.x=h.x,d.y=h.y,d.z=h.z,d.w=h.w,r.localRotation=d;break;case 3:var c=r.localScale,u=a.defaultValue;c.x=u.x,c.y=u.y,c.z=u.z,r.localScale=c;break;case 4:c=r.localRotationEuler;u=a.defaultValue,c.x=u.x,c.y=u.y,c.z=u.z,r.localRotationEuler=c;break;default:throw"Animator:unknown type."}}}}},{key:"_onAdded",value:function(){var e=this.owner._parent;this.owner._setHierarchyAnimator(this,e?e._hierarchyAnimator:null),this.owner._changeAnimatorToLinkSprite3DNoAvatar(this,!0,[])}},{key:"_onDestroy",value:function(){for(var e=0,t=this._controllerLayers.length;e<t;e++)this._controllerLayers[e]._removeReference();var n=this.owner._parent;this.owner._clearHierarchyAnimator(this,n?n._hierarchyAnimator:null)}},{key:"_onEnable",value:function(){this.owner._scene._animatorPool.add(this);for(var e=0,t=this._controllerLayers.length;e<t;e++)this._controllerLayers[e].playOnWake&&this.getDefaultState(e)&&this.play(null,e,0)}},{key:"_onDisable",value:function(){this.owner._scene._animatorPool.remove(this)}},{key:"_handleSpriteOwnersBySprite",value:function(e,t,n){for(var i=0,a=this._controllerLayers.length;i<a;i++)for(var r=this._controllerLayers[i]._states,o=0,s=r.length;o<s;o++){var l=r[o],h=l._clip,u=t.join("/"),d=h._nodesMap[u];if(d)for(var c=l._nodeOwners,_=0,f=d.length;_<f;_++)e?this._addKeyframeNodeOwner(c,d[_],n):this._removeKeyframeNodeOwner(c,d[_])}}},{key:"_parse",value:function(e){var t=e.avatar;t&&(this.avatar=on.getRes(t.path),t=t.linkSprites,this._linkSprites=t,this._linkToSprites(t));e.clipPaths;for(var n=e.playOnWake,i=e.layers,a=0;a<i.length;a++){var r=i[a],o=new ra(r.name);o.defaultWeight=0===a?1:r.weight;var s=r.blendingMode;s&&(o.blendingMode=s),this.addControllerLayer(o);for(var l=r.states,h=0,u=l.length;h<u;h++){var d,c=l[h],_=c.clipPath;_&&(d=c.name,(c=on.getRes(_))&&((_=new oa).name=d,_.clip=c,o.addState(_),0===h&&(this.getControllerLayer(a).defaultState=_)))}void 0!==n&&(o.playOnWake=n)}e=e.cullingMode;void 0!==e&&(this.cullingMode=e)}},{key:"_update",value:function(){var e,t=this.owner._scene.timer,n=t._delta/1e3;if(0!==this._speed&&0!=n){if(this.cullingMode===k.CULLINGMODE_CULLCOMPLETELY){e=!1;for(var i=0,a=this._renderableSprites.length;i<a;i++)if(this._renderableSprites[i]._render._visible){e=!0;break}}else e=!0;this._updateMark++;for(var r=t.scale,i=0,a=this._controllerLayers.length;i<a;i++){var o=this._controllerLayers[i],s=o._playStateInfo,l=o._crossPlayStateInfo,h=o.blendingMode!==ra.BLENDINGMODE_OVERRIDE;switch(o._playType){case 0:var h,u=o._currentPlayState,d=u._clip,c=this._speed*u.speed,_=s._finish;_||this._updatePlayer(u,s,n*c,d.islooping),e&&(h=o.blendingMode!==ra.BLENDINGMODE_OVERRIDE,this._updateClipDatas(u,h,s,r*c),this._setClipDatasToNode(u,h,o.defaultWeight,0===i),_||this._updateEventScript(u,s));break;case 1:d=(u=o._currentPlayState)._clip;var f=o._crossPlayState,g=f._clip,y=o._crossDuration,v=l._startPlayTime,p=g._duration-v,m=p<y?p/y:1,w=this._speed*f.speed;this._updatePlayer(f,l,n*m*w,g.islooping);var x=(l._elapsedTime-v)/m/y;1<=x?e&&(this._updateClipDatas(f,h,l,r*w),this._setClipDatasToNode(f,h,o.defaultWeight,0===i),o._playType=0,o._currentPlayState=f,l._cloneTo(s)):(s._finish||(c=this._speed*u.speed,this._updatePlayer(u,s,n*c,d.islooping)),e&&(this._updateClipDatas(u,h,s,r*c),this._updateClipDatas(f,h,l,r*m*w),this._setCrossClipDatasToNode(o,u,f,x,0===i))),e&&(this._updateEventScript(u,s),this._updateEventScript(f,l));break;case 2:g=(f=o._crossPlayState)._clip,y=o._crossDuration,v=l._startPlayTime,m=(p=g._duration-v)<y?p/y:1,w=this._speed*f.speed,this._updatePlayer(f,l,n*m*w,g.islooping),e&&(1<=(x=(l._elapsedTime-v)/m/y)?(this._updateClipDatas(f,h,l,r*w),this._setClipDatasToNode(f,h,1,0===i),o._playType=0,o._currentPlayState=f,l._cloneTo(s)):(this._updateClipDatas(f,h,l,r*m*w),this._setFixedCrossClipDatasToNode(o,f,x,0===i)),this._updateEventScript(f,l))}}e&&this._avatar&&(yt.supportWebGLPlusAnimation&&this._updateAnimationNodeWorldMatix(this._animationNodeLocalPositions,this._animationNodeLocalRotations,this._animationNodeLocalScales,this._animationNodeWorldMatrixs,this._animationNodeParentIndices),this._updateAvatarNodesToSprite())}}},{key:"_cloneTo",value:function(e){var t=e;t.avatar=this.avatar,t.cullingMode=this.cullingMode;for(var n=0,i=this._controllerLayers.length;n<i;n++){var a=this._controllerLayers[n];t.addControllerLayer(a.clone());for(var r=a._states,o=0,s=r.length;o<s;o++){var l=r[o].clone(),h=t.getControllerLayer(n);h.addState(l),0==o&&(h.defaultState=l)}}t._linkSprites=this._linkSprites,t._linkToSprites(this._linkSprites)}},{key:"getDefaultState",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._controllerLayers[e].defaultState}},{key:"addState",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this._controllerLayers[t].addState(e),console.warn("Animator:this function is discard,please use animatorControllerLayer.addState() instead.")}},{key:"removeState",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this._controllerLayers[t].removeState(e),console.warn("Animator:this function is discard,please use animatorControllerLayer.removeState() instead.")}},{key:"addControllerLayer",value:function(e){this._controllerLayers.push(e),e._animator=this,e._addReference();for(var t=e._states,n=0,i=t.length;n<i;n++)this._getOwnersByClip(t[n])}},{key:"getControllerLayer",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._controllerLayers[e]}},{key:"getCurrentAnimatorPlayState",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._controllerLayers[e]._playStateInfo}},{key:"play",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Number.NEGATIVE_INFINITY,i=this._controllerLayers[t];if(i){var a=i.defaultState;if(!e&&!a)throw new Error("Animator:must have  default clip value,please set clip property.");var r=i._currentPlayState,o=i._playStateInfo,e=e?i._statesMap[e]:a,a=e._clip._duration;r!==e?(n!==Number.NEGATIVE_INFINITY?o._resetPlayState(a*n):o._resetPlayState(0),null!==r&&r!==e&&this._revertDefaultKeyframeNodes(r),i._playType=0,i._currentPlayState=e):n!==Number.NEGATIVE_INFINITY&&(o._resetPlayState(a*n),i._playType=0);var s=e._scripts;if(s)for(var l=0,h=s.length;l<h;l++)s[l].onStateEnter()}else console.warn("Invalid layerIndex "+t+".")}},{key:"crossFade",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Number.NEGATIVE_INFINITY,a=this._controllerLayers[n];if(a){var r=a._statesMap[e];if(r){var o=a._playType;if(-1!==o){var s=a._crossPlayStateInfo,l=a._crossNodesOwners,h=a._crossNodesOwnersIndicesMap,u=a._currentPlayState,d=r._nodeOwners,c=a._destCrossClipNodeIndices,_=r._clip,f=_._nodes,g=_._nodesDic;switch(o){case 0:var y=u._nodeOwners,v=a._srcCrossClipNodeIndices,p=u._clip,m=p._nodes,w=p._nodesDic;a._playType=1;for(var x=++a._crossMark,k=a._crossNodesOwnersCount=0,T=0,E=m.count;T<E;T++){var M,b=m.getNodeByIndex(T),S=b._indexInList,I=y[S];I&&(b=b.fullPath,v[k]=S,M=g[b],c[k]=M?M._indexInList:-1,h[b]=x,l[k]=I,k++)}for(T=0,E=f.count;T<E;T++){var N,R=(M=f.getNodeByIndex(T))._indexInList,C=d[R];C&&(w[N=M.fullPath]||(v[k]=-1,c[k]=R,h[N]=x,l[k]=C,k++))}break;case 1:case 2:for(a._playType=2,T=0,E=l.length;T<E;T++){var A=l[T];A.saveCrossFixedValue(),M=g[A.fullPath],c[T]=M?M._indexInList:-1}for(k=a._crossNodesOwnersCount,x=a._crossMark,T=0,E=f.count;T<E;T++)(C=d[R=(M=f.getNodeByIndex(T))._indexInList])&&h[N=M.fullPath]!==x&&(c[k]=R,h[N]=x,A=d[R],(l[k]=A).saveCrossFixedValue(),k++)}a._crossNodesOwnersCount=k,a._crossPlayState=r,a._crossDuration=u._clip._duration*t,i!==Number.NEGATIVE_INFINITY?s._resetPlayState(_._duration*i):s._resetPlayState(0);var D=r._scripts;if(D)for(T=0,E=D.length;T<E;T++)D[T].onStateEnter()}else this.play(e,n,i)}else console.warn("Invalid name "+n+".")}else console.warn("Invalid layerIndex "+n+".")}},{key:"_getAvatarOwnersAndInitDatasAsync",value:function(){for(var e,t=0,n=this._controllerLayers.length;t<n;t++)for(var i=this._controllerLayers[t]._states,a=0,r=i.length;a<r;a++)this._getOwnersByClip(i[a]);for(e in this._avatar._cloneDatasToAnimator(this),this._linkAvatarSpritesData){var o=this._linkAvatarSpritesData[e];if(o)for(var s=0,l=o.length;s<l;s++)this._isLinkSpriteToAnimationNode(o[s],e,!0)}}},{key:"_isLinkSpriteToAnimationNode",value:function(e,t,n){if(this._avatar){var i=this._avatarNodeMap[t];if(i)if(n){e._transform._dummy=i.transform,this._linkAvatarSprites.push(e);var a=i.transform,t=e.transform;if(!t.owner.isStatic&&a){n=t.worldMatrix,i=this.owner._transform._parent;if(i)ia.matrix4x4MultiplyMFM(i.worldMatrix,a.getWorldMatrix(),n);else for(var r=n.elements,o=a.getWorldMatrix(),s=0;s<16;s++)r[s]=o[s];t.worldMatrix=n}}else e._transform._dummy=null,this._linkAvatarSprites.splice(this._linkAvatarSprites.indexOf(e),1)}}},{key:"_isLinkSpriteToAnimationNodeData",value:function(e,t,n){var i=this._linkAvatarSpritesData[t];n?(i||(this._linkAvatarSpritesData[t]=i=[]),i.push(e)):(e=i.indexOf(e),i.splice(e,1))}},{key:"_updateAvatarNodesToSprite",value:function(){for(var e=0,t=this._linkAvatarSprites.length;e<t;e++){var n,i=this._linkAvatarSprites[e],a=i.transform._dummy,r=i.transform;!r.owner.isStatic&&a&&(n=r.worldMatrix,i=this.owner._transform,ia.matrix4x4MultiplyMFM(i.worldMatrix,a.getWorldMatrix(),n),r.worldMatrix=n)}}},{key:"linkSprite3DToAvatarNode",value:function(e,t){return this._isLinkSpriteToAnimationNodeData(t,e,!0),this._isLinkSpriteToAnimationNode(t,e,!0),!0}},{key:"unLinkSprite3DToAvatarNode",value:function(e){if(e._hierarchyAnimator!==this)throw"Animator:sprite3D must belong to this Animator";var t=e.transform._dummy;if(t){t=t._owner.name;return this._isLinkSpriteToAnimationNodeData(e,t,!1),this._isLinkSpriteToAnimationNode(e,t,!1),!0}return!1}},{key:"_updateAnimationNodeWorldMatix",value:function(e,t,n,i,a){P.instance.updateAnimationNodeWorldMatix(e,t,n,a,i)}},{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e}},{key:"avatar",get:function(){return this._avatar},set:function(e){this._avatar!==e&&((this._avatar=e)?(this._getAvatarOwnersAndInitDatasAsync(),this.owner._changeHierarchyAnimatorAvatar(this,e)):(e=this.owner._parent,this.owner._changeHierarchyAnimatorAvatar(this,e?e._hierarchyAnimator._avatar:null)))}}],[{key:"_update",value:function(e){for(var e=e._animatorPool,t=e.elements,n=0,i=e.length;n<i;n++){var a=t[n];a&&a.enabled&&a._update()}}}]),k}();la._tempVector30=new vn,la._tempVector31=new vn,la._tempQuaternion0=new xi,la._tempQuaternion1=new xi,la.CULLINGMODE_ALWAYSANIMATE=0,la.CULLINGMODE_CULLCOMPLETELY=2;var ha=function(){function t(){S(this,t),this._defaultPhysicsMemory=16,this._maxLightCount=32,this._lightClusterCount=new vn(12,12,12),this._editerEnvironment=!1,this.isAntialias=!0,this.isAlpha=!1,this.premultipliedAlpha=!0,this.isStencil=!0,this.enbaleMultiLight=!0,this.octreeCulling=!1,this.octreeInitialSize=64,this.octreeInitialCenter=new vn(0,0,0),this.octreeMinNodeSize=2,this.octreeLooseness=1.25,this.debugFrustumCulling=!1,this._maxAreaLightCountPerClusterAverage=Math.min(4*Math.floor(2048/this._lightClusterCount.z-1),this._maxLightCount)}return C(t,[{key:"_checkMaxLightCountPerCluster",value:function(e,t){return Math.ceil(e/4+1)*t<2048}},{key:"cloneTo",value:function(e){var t=e;t._defaultPhysicsMemory=this._defaultPhysicsMemory,t._editerEnvironment=this._editerEnvironment,t.isAntialias=this.isAntialias,t.isAlpha=this.isAlpha,t.premultipliedAlpha=this.premultipliedAlpha,t.isStencil=this.isStencil,t.octreeCulling=this.octreeCulling,this.octreeInitialCenter.cloneTo(t.octreeInitialCenter),t.octreeInitialSize=this.octreeInitialSize,t.octreeMinNodeSize=this.octreeMinNodeSize,t.octreeLooseness=this.octreeLooseness,t.debugFrustumCulling=this.debugFrustumCulling,t.maxLightCount=this.maxLightCount,t.enbaleMultiLight=this.enbaleMultiLight;e=t.lightClusterCount;this.lightClusterCount.cloneTo(e),t.lightClusterCount=e}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}},{key:"defaultPhysicsMemory",get:function(){return this._defaultPhysicsMemory},set:function(e){if(e<16)throw"defaultPhysicsMemory must large than 16M";this._defaultPhysicsMemory=e}},{key:"maxLightCount",get:function(){return this._maxLightCount},set:function(e){2048<e?(this._maxLightCount=2048,console.warn("Config3D: maxLightCount must less equal 2048.")):this._maxLightCount=e}},{key:"lightClusterCount",get:function(){return this._lightClusterCount},set:function(e){128<e.x||128<e.y||128<e.z?(this._lightClusterCount.setValue(Math.min(e.x,128),Math.min(e.y,128),Math.min(e.z,128)),console.warn("Config3D: lightClusterCount X and Y、Z must less equal 128.")):e.cloneTo(this._lightClusterCount);e=4*Math.floor(2048/this._lightClusterCount.z-1);e<this._maxLightCount&&console.warn("Config3D: if the area light(PointLight、SpotLight) count is large than "+e+",maybe the far away culster will ingonre some light."),this._maxAreaLightCountPerClusterAverage=Math.min(e,this._maxLightCount)}}]),t}();function ua(e,t){S(this,ua),this._index=e,this._value=t}ha._config=new ha,window.Config3D=ha;var da=function(){function t(){S(this,t),this._mask=[],this._length=0}return C(t,[{key:"_intersectionDefineDatas",value:function(e){for(var t=e._mask,n=this._mask,i=this._length-1;0<=i;i--){var a=n[i]&t[i];0==a&&i==this._length-1?this._length--:n[i]=a}}},{key:"add",value:function(e){var t=e._index,n=t+1,i=this._mask,a=i.length;if(a<n){for(i.length=n;a<t;a++)i[a]=0;i[t]=e._value,this._length=n}else i[t]|=e._value,this._length=Math.max(this._length,n)}},{key:"remove",value:function(e){var t=e._index,n=this._mask,i=this._length-1;i<t||(e=n[t]&~e._value,t==i&&0==e?this._length--:n[t]=e)}},{key:"addDefineDatas",value:function(e){var t=e._mask,n=e._length,i=this._mask,a=i.length;if(a<n){i.length=n;for(var r=0;r<a;r++)i[r]|=t[r];for(;a<n;a++)i[a]=t[a];this._length=n}else{for(r=0;r<n;r++)i[r]|=t[r];this._length=Math.max(this._length,n)}}},{key:"removeDefineDatas",value:function(e){for(var t,n=e._mask,i=this._mask,a=this._length-1,r=e._length-1;0<=r;r--)a<r||(t=i[r]&~n[r],r==a&&0==t?(a--,this._length--):i[r]=t)}},{key:"has",value:function(e){var t=e._index;return!(t>=this._length)&&0!=(this._mask[t]&e._value)}},{key:"clear",value:function(){this._length=0}},{key:"cloneTo",value:function(e){var e=e,t=e._mask,n=this._mask,i=this._length;t.length=i;for(var a=0;a<i;a++)t[a]=n[a];e._length=i}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}}]),t}(),ca=function(){function u(e,t,n,i){S(this,u),this._attributeMap=null,this._uniformMap=null,this._enableInstancing=!1,this._subShaders=[],this._name=e,this._attributeMap=t,this._uniformMap=n,this._enableInstancing=i}return C(u,[{key:"addSubShader",value:function(e){this._subShaders.push(e),e._owner=this}},{key:"getSubShaderAt",value:function(e){return this._subShaders[e]}}],[{key:"_getNamesByDefineData",value:function(e,t){for(var n=u._maskMap,i=e._mask,a=t.length=0,r=e._length;a<r;a++)for(var o=n[a],s=i[a],l=0;l<32;l++){var h=1<<l;if(0<s&&s<h)break;s&h&&t.push(o[h])}}},{key:"getDefineByName",value:function(e){var t,n,i,a=u._defineMap[e];return a||(t=u._maskMap,i=u._defineCounter,n=Math.floor(i/32),a=new ua(n,i=1<<i%32),u._defineMap[e]=a,n==t.length&&(t.length++,t[n]={}),t[n][i]=e,u._defineCounter++),a}},{key:"propertyNameToID",value:function(e){if(null!=u._propertyNameMap[e])return u._propertyNameMap[e];var t=u._propertyNameCounter++;return u._propertyNameMap[e]=t}},{key:"addInclude",value:function(e,t){t=t.replace(Bn._clearCR,""),Bn.addInclude(e,t)}},{key:"compileShaderByDefineNames",value:function(e,t,n,i){e=u.find(e);if(e){t=e.getSubShaderAt(t);if(t){n=t._passes[n];if(n){var a=u._compileDefineDatas;a.clear();for(var r=0,o=i.length;r<o;r++)a.add(u.getDefineByName(i[r]));dt.shaderHighPrecision&&a.add(u.SHADERDEFINE_HIGHPRECISION),ha._config._multiLighting||a.add(u.SHADERDEFINE_LEGACYSINGALLIGHTING),n.withCompile(a)}else console.warn("Shader3D: unknown passIndex.")}else console.warn("Shader3D: unknown subShaderIndex.")}else console.warn("Shader3D: unknown shader name.")}},{key:"compileShader",value:function(e,t,n){e=u.find(e);if(e){t=e.getSubShaderAt(t);if(t){t=t._passes[n];if(t){for(var n=u._compileDefineDatas,i=n._mask,a=i.length=0,r=arguments.length<=3?0:arguments.length-3;a<r;a++)i.push(a+3<3||arguments.length<=a+3?void 0:arguments[a+3]);n._length=arguments.length<=3?0:arguments.length-3,dt.shaderHighPrecision&&n.add(u.SHADERDEFINE_HIGHPRECISION),ha._config._multiLighting||n.add(u.SHADERDEFINE_LEGACYSINGALLIGHTING),t.withCompile(n)}else console.warn("Shader3D: unknown passIndex.")}else console.warn("Shader3D: unknown subShaderIndex.")}else console.warn("Shader3D: unknown shader name.")}},{key:"add",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return u._preCompileShader[e]=new u(e,t,n,i)}},{key:"find",value:function(e){return u._preCompileShader[e]}}]),u}();ca._compileDefineDatas=new da,ca.RENDER_STATE_CULL=0,ca.RENDER_STATE_BLEND=1,ca.RENDER_STATE_BLEND_SRC=2,ca.RENDER_STATE_BLEND_DST=3,ca.RENDER_STATE_BLEND_SRC_RGB=4,ca.RENDER_STATE_BLEND_DST_RGB=5,ca.RENDER_STATE_BLEND_SRC_ALPHA=6,ca.RENDER_STATE_BLEND_DST_ALPHA=7,ca.RENDER_STATE_BLEND_CONST_COLOR=8,ca.RENDER_STATE_BLEND_EQUATION=9,ca.RENDER_STATE_BLEND_EQUATION_RGB=10,ca.RENDER_STATE_BLEND_EQUATION_ALPHA=11,ca.RENDER_STATE_DEPTH_TEST=12,ca.RENDER_STATE_DEPTH_WRITE=13,ca.PERIOD_CUSTOM=0,ca.PERIOD_MATERIAL=1,ca.PERIOD_SPRITE=2,ca.PERIOD_CAMERA=3,ca.PERIOD_SCENE=4,ca._propertyNameCounter=0,ca._propertyNameMap={},ca._defineCounter=0,ca._defineMap={},ca._preCompileShader={},ca._maskMap=[],ca.debugMode=!0;var _a=function(){T(r,d);var n=b(r);function r(e){var t;return S(this,r),(t=n.call(this))._localPosition=new vn(0,0,0),t._localRotation=new xi(0,0,0,1),t._localScale=new vn(1,1,1),t._localRotationEuler=new vn(0,0,0),t._localMatrix=new ki,t._position=new vn(0,0,0),t._rotation=new xi(0,0,0,1),t._scale=new vn(1,1,1),t._rotationEuler=new vn(0,0,0),t._worldMatrix=new ki,t._children=null,t._parent=null,t._dummy=null,t._transformFlag=0,t._owner=e,t._children=[],t._setTransformFlag(r.TRANSFORM_LOCALQUATERNION|r.TRANSFORM_LOCALEULER|r.TRANSFORM_LOCALMATRIX,!1),t._setTransformFlag(r.TRANSFORM_WORLDPOSITION|r.TRANSFORM_WORLDQUATERNION|r.TRANSFORM_WORLDEULER|r.TRANSFORM_WORLDSCALE|r.TRANSFORM_WORLDMATRIX,!0),t}return C(r,[{key:"_getScaleMatrix",value:function(){var e=r._tempQuaternion0,t=r._tempMatrix3x30,n=r._tempMatrix3x31,i=r._tempMatrix3x32;return mi.createFromMatrix4x4(this.worldMatrix,n),this.rotation.invert(e),mi.createRotationQuaternion(e,t),mi.multiply(t,n,i),i}},{key:"_setTransformFlag",value:function(e,t){t?this._transformFlag|=e:this._transformFlag&=~e}},{key:"_getTransformFlag",value:function(e){return 0!=(this._transformFlag&e)}},{key:"_setParent",value:function(e){var t,n;this._parent!==e&&(this._parent&&(n=(t=this._parent._children).indexOf(this),t.splice(n,1)),e&&(e._children.push(this),e&&this._onWorldTransform()),this._parent=e)}},{key:"_onWorldPositionRotationTransform",value:function(){if(!(this._getTransformFlag(r.TRANSFORM_WORLDMATRIX)&&this._getTransformFlag(r.TRANSFORM_WORLDPOSITION)&&this._getTransformFlag(r.TRANSFORM_WORLDQUATERNION)&&this._getTransformFlag(r.TRANSFORM_WORLDEULER))){this._setTransformFlag(r.TRANSFORM_WORLDMATRIX|r.TRANSFORM_WORLDPOSITION|r.TRANSFORM_WORLDQUATERNION|r.TRANSFORM_WORLDEULER,!0),this.event(Je.TRANSFORM_CHANGED,this._transformFlag);for(var e=0,t=this._children.length;e<t;e++)this._children[e]._onWorldPositionRotationTransform()}}},{key:"_onWorldPositionScaleTransform",value:function(){if(!this._getTransformFlag(r.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(r.TRANSFORM_WORLDPOSITION)||!this._getTransformFlag(r.TRANSFORM_WORLDSCALE)){this._setTransformFlag(r.TRANSFORM_WORLDMATRIX|r.TRANSFORM_WORLDPOSITION|r.TRANSFORM_WORLDSCALE,!0),this.event(Je.TRANSFORM_CHANGED,this._transformFlag);for(var e=0,t=this._children.length;e<t;e++)this._children[e]._onWorldPositionScaleTransform()}}},{key:"_onWorldPositionTransform",value:function(){if(!this._getTransformFlag(r.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(r.TRANSFORM_WORLDPOSITION)){this._setTransformFlag(r.TRANSFORM_WORLDMATRIX|r.TRANSFORM_WORLDPOSITION,!0),this.event(Je.TRANSFORM_CHANGED,this._transformFlag);for(var e=0,t=this._children.length;e<t;e++)this._children[e]._onWorldPositionTransform()}}},{key:"_onWorldRotationTransform",value:function(){if(!this._getTransformFlag(r.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(r.TRANSFORM_WORLDQUATERNION)||!this._getTransformFlag(r.TRANSFORM_WORLDEULER)){this._setTransformFlag(r.TRANSFORM_WORLDMATRIX|r.TRANSFORM_WORLDQUATERNION|r.TRANSFORM_WORLDEULER,!0),this.event(Je.TRANSFORM_CHANGED,this._transformFlag);for(var e=0,t=this._children.length;e<t;e++)this._children[e]._onWorldPositionRotationTransform()}}},{key:"_onWorldScaleTransform",value:function(){if(!this._getTransformFlag(r.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(r.TRANSFORM_WORLDSCALE)){this._setTransformFlag(r.TRANSFORM_WORLDMATRIX|r.TRANSFORM_WORLDSCALE,!0),this.event(Je.TRANSFORM_CHANGED,this._transformFlag);for(var e=0,t=this._children.length;e<t;e++)this._children[e]._onWorldPositionScaleTransform()}}},{key:"_onWorldTransform",value:function(){if(!(this._getTransformFlag(r.TRANSFORM_WORLDMATRIX)&&this._getTransformFlag(r.TRANSFORM_WORLDPOSITION)&&this._getTransformFlag(r.TRANSFORM_WORLDQUATERNION)&&this._getTransformFlag(r.TRANSFORM_WORLDEULER)&&this._getTransformFlag(r.TRANSFORM_WORLDSCALE))){this._setTransformFlag(r.TRANSFORM_WORLDMATRIX|r.TRANSFORM_WORLDPOSITION|r.TRANSFORM_WORLDQUATERNION|r.TRANSFORM_WORLDEULER|r.TRANSFORM_WORLDSCALE,!0),this.event(Je.TRANSFORM_CHANGED,this._transformFlag);for(var e=0,t=this._children.length;e<t;e++)this._children[e]._onWorldTransform()}}},{key:"translate",value:function(e){!(1<arguments.length&&void 0!==arguments[1])||arguments[1]?(ki.createFromQuaternion(this.localRotation,r._tempMatrix0),vn.transformCoordinate(e,r._tempMatrix0,r._tempVector30),vn.add(this.localPosition,r._tempVector30,this._localPosition),this.localPosition=this._localPosition):(vn.add(this.position,e,this._position),this.position=this._position)}},{key:"rotate",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],e=!(2<arguments.length&&void 0!==arguments[2])||arguments[2]?e:(vn.scale(e,Math.PI/180,r._tempVector30),r._tempVector30);xi.createFromYawPitchRoll(e.y,e.x,e.z,r._tempQuaternion0),t?(xi.multiply(this._localRotation,r._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(xi.multiply(r._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)}},{key:"getForward",value:function(e){var t=this.worldMatrix.elements;e.x=-t[8],e.y=-t[9],e.z=-t[10]}},{key:"getUp",value:function(e){var t=this.worldMatrix.elements;e.x=t[4],e.y=t[5],e.z=t[6]}},{key:"getRight",value:function(e){var t=this.worldMatrix.elements;e.x=t[0],e.y=t[1],e.z=t[2]}},{key:"lookAt",value:function(e,t){var n,i;2<arguments.length&&void 0!==arguments[2]&&arguments[2]?(i=this._localPosition,Math.abs(i.x-e.x)<fn.zeroTolerance&&Math.abs(i.y-e.y)<fn.zeroTolerance&&Math.abs(i.z-e.z)<fn.zeroTolerance||(xi.lookAt(this._localPosition,e,t,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation)):(i=n=this.position,Math.abs(i.x-e.x)<fn.zeroTolerance&&Math.abs(i.y-e.y)<fn.zeroTolerance&&Math.abs(i.z-e.z)<fn.zeroTolerance||(xi.lookAt(n,e,t,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation))}},{key:"getWorldLossyScale",value:function(){var e;return this._getTransformFlag(r.TRANSFORM_WORLDSCALE)&&(null!==this._parent?(e=this._getScaleMatrix().elements,this._scale.x=e[0],this._scale.y=e[4],this._scale.z=e[8]):this._localScale.cloneTo(this._scale),this._setTransformFlag(r.TRANSFORM_WORLDSCALE,!1)),this._scale}},{key:"setWorldLossyScale",value:function(e){var t,n,i,a;null!==this._parent?(i=(n=t=r._tempMatrix3x33).elements,(a=this._parent._getScaleMatrix()).invert(a),mi.createFromScaling(e,t),mi.multiply(a,t,n),this._localScale.x=i[0],this._localScale.y=i[4],this._localScale.z=i[8]):e.cloneTo(this._localScale),this.localScale=this._localScale,this._scale!==e&&e.cloneTo(this._scale),this._setTransformFlag(r.TRANSFORM_WORLDSCALE,!1)}},{key:"_isFrontFaceInvert",get:function(){var e=this.getWorldLossyScale(),t=e.x<0;return e.y<0&&(t=!t),t=e.z<0?!t:t}},{key:"owner",get:function(){return this._owner}},{key:"worldNeedUpdate",get:function(){return this._getTransformFlag(r.TRANSFORM_WORLDMATRIX)}},{key:"localPositionX",get:function(){return this._localPosition.x},set:function(e){this._localPosition.x=e,this.localPosition=this._localPosition}},{key:"localPositionY",get:function(){return this._localPosition.y},set:function(e){this._localPosition.y=e,this.localPosition=this._localPosition}},{key:"localPositionZ",get:function(){return this._localPosition.z},set:function(e){this._localPosition.z=e,this.localPosition=this._localPosition}},{key:"localPosition",get:function(){return this._localPosition},set:function(e){this._localPosition!==e&&e.cloneTo(this._localPosition),this._setTransformFlag(r.TRANSFORM_LOCALMATRIX,!0),this._onWorldPositionTransform()}},{key:"localRotationX",get:function(){return this.localRotation.x},set:function(e){this._localRotation.x=e,this.localRotation=this._localRotation}},{key:"localRotationY",get:function(){return this.localRotation.y},set:function(e){this._localRotation.y=e,this.localRotation=this._localRotation}},{key:"localRotationZ",get:function(){return this.localRotation.z},set:function(e){this._localRotation.z=e,this.localRotation=this._localRotation}},{key:"localRotationW",get:function(){return this.localRotation.w},set:function(e){this._localRotation.w=e,this.localRotation=this._localRotation}},{key:"localRotation",get:function(){var e;return this._getTransformFlag(r.TRANSFORM_LOCALQUATERNION)&&(e=this._localRotationEuler,xi.createFromYawPitchRoll(e.y/r._angleToRandin,e.x/r._angleToRandin,e.z/r._angleToRandin,this._localRotation),this._setTransformFlag(r.TRANSFORM_LOCALQUATERNION,!1)),this._localRotation},set:function(e){this._localRotation!==e&&e.cloneTo(this._localRotation),this._localRotation.normalize(this._localRotation),this._setTransformFlag(r.TRANSFORM_LOCALEULER|r.TRANSFORM_LOCALMATRIX,!0),this._setTransformFlag(r.TRANSFORM_LOCALQUATERNION,!1),this._onWorldRotationTransform()}},{key:"localScaleX",get:function(){return this._localScale.x},set:function(e){this._localScale.x=e,this.localScale=this._localScale}},{key:"localScaleY",get:function(){return this._localScale.y},set:function(e){this._localScale.y=e,this.localScale=this._localScale}},{key:"localScaleZ",get:function(){return this._localScale.z},set:function(e){this._localScale.z=e,this.localScale=this._localScale}},{key:"localScale",get:function(){return this._localScale},set:function(e){this._localScale!==e&&e.cloneTo(this._localScale),this._setTransformFlag(r.TRANSFORM_LOCALMATRIX,!0),this._onWorldScaleTransform()}},{key:"localRotationEulerX",get:function(){return this.localRotationEuler.x},set:function(e){this._localRotationEuler.x=e,this.localRotationEuler=this._localRotationEuler}},{key:"localRotationEulerY",get:function(){return this.localRotationEuler.y},set:function(e){this._localRotationEuler.y=e,this.localRotationEuler=this._localRotationEuler}},{key:"localRotationEulerZ",get:function(){return this.localRotationEuler.z},set:function(e){this._localRotationEuler.z=e,this.localRotationEuler=this._localRotationEuler}},{key:"localRotationEuler",get:function(){var e,t;return this._getTransformFlag(r.TRANSFORM_LOCALEULER)&&(this._localRotation.getYawPitchRoll(r._tempVector30),e=r._tempVector30,(t=this._localRotationEuler).x=e.y*r._angleToRandin,t.y=e.x*r._angleToRandin,t.z=e.z*r._angleToRandin,this._setTransformFlag(r.TRANSFORM_LOCALEULER,!1)),this._localRotationEuler},set:function(e){this._localRotationEuler!==e&&e.cloneTo(this._localRotationEuler),this._setTransformFlag(r.TRANSFORM_LOCALEULER,!1),this._setTransformFlag(r.TRANSFORM_LOCALQUATERNION|r.TRANSFORM_LOCALMATRIX,!0),this._onWorldRotationTransform()}},{key:"localMatrix",get:function(){return this._getTransformFlag(r.TRANSFORM_LOCALMATRIX)&&(ki.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix),this._setTransformFlag(r.TRANSFORM_LOCALMATRIX,!1)),this._localMatrix},set:function(e){this._localMatrix!==e&&e.cloneTo(this._localMatrix),this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._setTransformFlag(r.TRANSFORM_LOCALEULER,!0),this._setTransformFlag(r.TRANSFORM_LOCALMATRIX,!1),this._onWorldTransform()}},{key:"position",get:function(){var e;return this._getTransformFlag(r.TRANSFORM_WORLDPOSITION)&&(null!=this._parent?(e=this.worldMatrix.elements,this._position.x=e[12],this._position.y=e[13],this._position.z=e[14]):this._localPosition.cloneTo(this._position),this._setTransformFlag(r.TRANSFORM_WORLDPOSITION,!1)),this._position},set:function(e){var t;null!=this._parent?(t=r._tempMatrix0,this._parent.worldMatrix.invert(t),vn.transformCoordinate(e,t,this._localPosition)):e.cloneTo(this._localPosition),this.localPosition=this._localPosition,this._position!==e&&e.cloneTo(this._position),this._setTransformFlag(r.TRANSFORM_WORLDPOSITION,!1)}},{key:"rotation",get:function(){return this._getTransformFlag(r.TRANSFORM_WORLDQUATERNION)&&(null!=this._parent?xi.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._setTransformFlag(r.TRANSFORM_WORLDQUATERNION,!1)),this._rotation},set:function(e){null!=this._parent?(this._parent.rotation.invert(r._tempQuaternion0),xi.multiply(r._tempQuaternion0,e,this._localRotation)):e.cloneTo(this._localRotation),this.localRotation=this._localRotation,e!==this._rotation&&e.cloneTo(this._rotation),this._setTransformFlag(r.TRANSFORM_WORLDQUATERNION,!1)}},{key:"rotationEuler",get:function(){var e,t;return this._getTransformFlag(r.TRANSFORM_WORLDEULER)&&(this.rotation.getYawPitchRoll(r._tempVector30),e=r._tempVector30,(t=this._rotationEuler).x=e.y*r._angleToRandin,t.y=e.x*r._angleToRandin,t.z=e.z*r._angleToRandin,this._setTransformFlag(r.TRANSFORM_WORLDEULER,!1)),this._rotationEuler},set:function(e){xi.createFromYawPitchRoll(e.y/r._angleToRandin,e.x/r._angleToRandin,e.z/r._angleToRandin,this._rotation),this.rotation=this._rotation,this._rotationEuler!==e&&e.cloneTo(this._rotationEuler),this._setTransformFlag(r.TRANSFORM_WORLDEULER,!1)}},{key:"worldMatrix",get:function(){return this._getTransformFlag(r.TRANSFORM_WORLDMATRIX)&&(null!=this._parent?ki.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._setTransformFlag(r.TRANSFORM_WORLDMATRIX,!1)),this._worldMatrix},set:function(e){null===this._parent?e.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),ki.multiply(this._localMatrix,e,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix!==e&&e.cloneTo(this._worldMatrix),this._setTransformFlag(r.TRANSFORM_WORLDMATRIX,!1)}},{key:"scale",get:function(){return this.getWorldLossyScale()},set:function(e){this.setWorldLossyScale(e)}}]),r}();_a._tempVector30=new vn,_a._tempQuaternion0=new xi,_a._tempMatrix0=new ki,_a._tempMatrix3x30=new mi,_a._tempMatrix3x31=new mi,_a._tempMatrix3x32=new mi,_a._tempMatrix3x33=new mi,_a.TRANSFORM_LOCALQUATERNION=1,_a.TRANSFORM_LOCALEULER=2,_a.TRANSFORM_LOCALMATRIX=4,_a.TRANSFORM_WORLDPOSITION=8,_a.TRANSFORM_WORLDQUATERNION=16,_a.TRANSFORM_WORLDSCALE=32,_a.TRANSFORM_WORLDMATRIX=64,_a.TRANSFORM_WORLDEULER=128,_a._angleToRandin=180/Math.PI;var fa=function(){T(l,Ft);var i=b(l);function l(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return S(this,l),(e=i.call(this))._needProcessCollisions=!1,e._needProcessTriggers=!1,e._id=++l._uniqueIDCounter,e._transform=new _a(u(e)),e._isStatic=n,e.layer=0,e.name=t||"New Sprite3D",e}return C(l,[{key:"_setCreateURL",value:function(e){this._url=B.formatURL(e)}},{key:"_changeAnimatorsToLinkSprite3D",value:function(e,t,n){var i=this.getComponent(la);i&&(i.avatar||e._changeAnimatorToLinkSprite3DNoAvatar(i,t,n)),this._parent&&this._parent instanceof l&&(n.unshift(this._parent.name),(i=this._parent)._hierarchyAnimator&&i._changeAnimatorsToLinkSprite3D(e,t,n))}},{key:"_setHierarchyAnimator",value:function(e,t){this._changeHierarchyAnimator(e),this._changeAnimatorAvatar(e.avatar);for(var n=0,i=this._children.length;n<i;n++){var a=this._children[n];a._hierarchyAnimator==t&&a._setHierarchyAnimator(e,t)}}},{key:"_clearHierarchyAnimator",value:function(e,t){this._changeHierarchyAnimator(t),this._changeAnimatorAvatar(t?t.avatar:null);for(var n=0,i=this._children.length;n<i;n++){var a=this._children[n];a._hierarchyAnimator==e&&a._clearHierarchyAnimator(e,t)}}},{key:"_changeHierarchyAnimatorAvatar",value:function(e,t){this._changeAnimatorAvatar(t);for(var n=0,i=this._children.length;n<i;n++){var a=this._children[n];a._hierarchyAnimator==e&&a._changeHierarchyAnimatorAvatar(e,t)}}},{key:"_changeAnimatorToLinkSprite3DNoAvatar",value:function(e,t,n){e._handleSpriteOwnersBySprite(t,n,this);for(var i=0,a=this._children.length;i<a;i++){var r=this._children[i],o=n.length;n.push(r.name),r._changeAnimatorToLinkSprite3DNoAvatar(e,t,n),n.splice(o,1)}}},{key:"_changeHierarchyAnimator",value:function(e){this._hierarchyAnimator=e}},{key:"_changeAnimatorAvatar",value:function(e){}},{key:"_onAdded",value:function(){var e;this._parent instanceof l&&(e=this._parent,this.transform._setParent(e.transform),e._hierarchyAnimator&&(this._hierarchyAnimator||this._setHierarchyAnimator(e._hierarchyAnimator,null),e._changeAnimatorsToLinkSprite3D(this,!0,[this.name]))),G(z(l.prototype),"_onAdded",this).call(this)}},{key:"_onRemoved",value:function(){var e;G(z(l.prototype),"_onRemoved",this).call(this),this._parent instanceof l&&(e=this._parent,this.transform._setParent(null),e._hierarchyAnimator&&(this._hierarchyAnimator==e._hierarchyAnimator&&this._clearHierarchyAnimator(e._hierarchyAnimator,null),e._changeAnimatorsToLinkSprite3D(this,!1,[this.name])))}},{key:"_parse",value:function(e,t){var n,i;void 0!==e.isStatic&&(this._isStatic=e.isStatic),void 0!==e.active&&(this.active=e.active),null!=e.name&&(this.name=e.name),void 0!==e.position&&((n=this.transform.localPosition).fromArray(e.position),this.transform.localPosition=n),void 0!==e.rotationEuler&&((n=this.transform.localRotationEuler).fromArray(e.rotationEuler),this.transform.localRotationEuler=n),void 0!==e.rotation&&((i=this.transform.localRotation).fromArray(e.rotation),this.transform.localRotation=i),void 0!==e.scale&&((i=this.transform.localScale).fromArray(e.scale),this.transform.localScale=i),null!=e.layer&&(this.layer=e.layer)}},{key:"_cloneTo",value:function(e,t,n){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var i=e;i.name=this.name,i.destroyed=this.destroyed,i.active=this.active;e=i.transform.localPosition;this.transform.localPosition.cloneTo(e),i.transform.localPosition=e;e=i.transform.localRotation;this.transform.localRotation.cloneTo(e),i.transform.localRotation=e;e=i.transform.localScale;this.transform.localScale.cloneTo(e),i.transform.localScale=e,i._isStatic=this._isStatic,i.layer=this.layer,G(z(l.prototype),"_cloneTo",this).call(this,i,t,n)}},{key:"clone",value:function(){var e=l._createSprite3DInstance(this);return l._parseSprite3DInstance(this,e,this,e),e}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.destroyed||(G(z(l.prototype),"destroy",this).call(this,e),this._transform=null,this._scripts=null,this._url&&on.clearRes(this._url))}},{key:"_create",value:function(){return new l}},{key:"id",get:function(){return this._id}},{key:"layer",get:function(){return this._layer},set:function(e){if(this._layer!==e){if(!(0<=e&&e<=30))throw new Error("Layer value must be 0-30.");this._layer=e}}},{key:"url",get:function(){return this._url}},{key:"isStatic",get:function(){return this._isStatic}},{key:"transform",get:function(){return this._transform}}],[{key:"__init__",value:function(){}},{key:"instantiate",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=e.clone();t&&t.addChild(r);t=r.transform;return n?(n=t.worldMatrix,e.transform.worldMatrix.cloneTo(n),t.worldMatrix=n):(i&&(t.position=i),a&&(t.rotation=a)),r}},{key:"load",value:function(e,t){zn.loader.create(e,t,null,l.HIERARCHY)}},{key:"_createSprite3DInstance",value:function(e){for(var t=e._create(),n=e._children,i=0,a=n.length;i<a;i++){var r=l._createSprite3DInstance(n[i]);t.addChild(r)}return t}},{key:"_parseSprite3DInstance",value:function(e,t,n,i){for(var a=n._children,r=i._children,o=0,s=a.length;o<s;o++)l._parseSprite3DInstance(e,t,a[o],r[o]);n._cloneTo(i,e,t)}}]),l}();fa.HIERARCHY="HIERARCHY",fa.WORLDMATRIX=ca.propertyNameToID("u_WorldMat"),fa.MVPMATRIX=ca.propertyNameToID("u_MvpMatrix"),fa._uniqueIDCounter=0;var ga=function(){T(n,fa);var t=b(n);function n(e){return S(this,n),t.call(this,e)}return C(n,[{key:"_onInActive",value:function(){G(z(n.prototype),"_onInActive",this).call(this);var e=this._scene;e._removeRenderObject(this._render),this._render.castShadow&&e._removeShadowCastRenderObject(this._render)}},{key:"_onActive",value:function(){G(z(n.prototype),"_onActive",this).call(this);var e=this._scene;e._addRenderObject(this._render),this._render.castShadow&&e._addShadowCastRenderObject(this._render)}},{key:"_onActiveInScene",value:function(){var e,t;G(z(n.prototype),"_onActiveInScene",this).call(this),wi.Laya3D._editerEnvironment&&(e=this._scene,t=new yn,e._allotPickColorByID(this.id,t),(e._pickIdToSprite[this.id]=this)._render._shaderValues.setVector(n.PICKCOLOR,t))}},{key:"_addToInitStaticBatchManager",value:function(){}},{key:"_setBelongScene",value:function(e){G(z(n.prototype),"_setBelongScene",this).call(this,e),this._render._setBelongScene(e)}},{key:"_setUnBelongScene",value:function(){this._render._shaderValues.removeDefine(n.SAHDERDEFINE_LIGHTMAP),G(z(n.prototype),"_setUnBelongScene",this).call(this)}},{key:"_changeHierarchyAnimator",value:function(e){var t;this._hierarchyAnimator&&(t=this._hierarchyAnimator._renderableSprites).splice(t.indexOf(this),1),e&&e._renderableSprites.push(this),G(z(n.prototype),"_changeHierarchyAnimator",this).call(this,e)}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(n.prototype),"destroy",this).call(this,e),this._render._destroy(),this._render=null}},{key:"_create",value:function(){return new n(this.name)}}],[{key:"__init__",value:function(){n.SHADERDEFINE_RECEIVE_SHADOW=ca.getDefineByName("RECEIVESHADOW"),n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=ca.getDefineByName("SCALEOFFSETLIGHTINGMAPUV"),n.SAHDERDEFINE_LIGHTMAP=ca.getDefineByName("LIGHTMAP")}}]),n}();ga.LIGHTMAPSCALEOFFSET=ca.propertyNameToID("u_LightmapScaleOffset"),ga.LIGHTMAP=ca.propertyNameToID("u_LightMap"),ga.PICKCOLOR=ca.propertyNameToID("u_PickColor");var ya=function(){function t(){S(this,t)}return C(t,null,[{key:"__init__",value:function(){var e=P.instance;t._elementInfos={single:[1,e.FLOAT,0],vector2:[2,e.FLOAT,0],vector3:[3,e.FLOAT,0],vector4:[4,e.FLOAT,0],color:[4,e.FLOAT,0],byte4:[4,e.UNSIGNED_BYTE,0],short2:[2,e.FLOAT,0],short4:[4,e.FLOAT,0],normalizedshort2:[2,e.FLOAT,0],normalizedshort4:[4,e.FLOAT,0],halfvector2:[2,e.FLOAT,0],halfvector4:[4,e.FLOAT,0]}}},{key:"getElementInfos",value:function(e){e=t._elementInfos[e];if(e)return e;throw"VertexElementFormat: this vertexElementFormat is not implement."}}]),t}();ya.Single="single",ya.Vector2="vector2",ya.Vector3="vector3",ya.Vector4="vector4",ya.Color="color",ya.Byte4="byte4",ya.Short2="short2",ya.Short4="short4",ya.NormalizedShort2="normalizedshort2",ya.NormalizedShort4="normalizedshort4",ya.HalfVector2="halfvector2",ya.HalfVector4="halfvector4";var va=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;S(this,i),this._ownerResource=null,this._data=null,this._defineDatas=new da,this._runtimeCopyValues=[],this._ownerResource=e,this._initData()}return C(i,[{key:"_initData",value:function(){this._data=new Object}},{key:"getData",value:function(){return this._data}},{key:"addDefine",value:function(e){this._defineDatas.add(e)}},{key:"removeDefine",value:function(e){this._defineDatas.remove(e)}},{key:"hasDefine",value:function(e){return this._defineDatas.has(e)}},{key:"clearDefine",value:function(){this._defineDatas.clear()}},{key:"getBool",value:function(e){return this._data[e]}},{key:"setBool",value:function(e,t){this._data[e]=t}},{key:"getInt",value:function(e){return this._data[e]}},{key:"setInt",value:function(e,t){this._data[e]=t}},{key:"getNumber",value:function(e){return this._data[e]}},{key:"setNumber",value:function(e,t){this._data[e]=t}},{key:"getVector2",value:function(e){return this._data[e]}},{key:"setVector2",value:function(e,t){this._data[e]=t}},{key:"getVector3",value:function(e){return this._data[e]}},{key:"setVector3",value:function(e,t){this._data[e]=t}},{key:"getVector",value:function(e){return this._data[e]}},{key:"setVector",value:function(e,t){this._data[e]=t}},{key:"getQuaternion",value:function(e){return this._data[e]}},{key:"setQuaternion",value:function(e,t){this._data[e]=t}},{key:"getMatrix4x4",value:function(e){return this._data[e]}},{key:"setMatrix4x4",value:function(e,t){this._data[e]=t}},{key:"getBuffer",value:function(e){return this._data[e]}},{key:"setBuffer",value:function(e,t){this._data[e]=t}},{key:"setTexture",value:function(e,t){var n=this._data[e];this._data[e]=t,this._ownerResource&&0<this._ownerResource.referenceCount&&(n&&n._removeReference(),t&&t._addReference())}},{key:"getTexture",value:function(e){return this._data[e]}},{key:"setAttribute",value:function(e,t){this._data[e]=t}},{key:"getAttribute",value:function(e){return this._data[e]}},{key:"getLength",value:function(){return this._data.length}},{key:"setLength",value:function(e){this._data.length=e}},{key:"cloneTo",value:function(e){var t,e=e,n=e._data;for(t in this._data){var i,a,r=this._data[t];null!=r&&("number"==typeof r||"number"==typeof r||"boolean"==typeof r?n[t]=r:r instanceof gn?(i=n[t]||(n[t]=new gn),r.cloneTo(i),n[t]=i):r instanceof vn?(i=n[t]||(n[t]=new vn),r.cloneTo(i),n[t]=i):r instanceof yn?(a=n[t]||(n[t]=new yn),r.cloneTo(a),n[t]=a):r instanceof ki?(a=n[t]||(n[t]=new ki),r.cloneTo(a),n[t]=a):r instanceof U&&(n[t]=r))}this._defineDatas.cloneTo(e._defineDatas)}},{key:"clone",value:function(){var e=new i;return this.cloneTo(e),e}},{key:"cloneToForNative",value:function(e){var t=e;0<this._int32Data.length-t._int32Data.length&&t.needRenewArrayBufferForNative(this._int32Data.length),t._int32Data.set(this._int32Data,0);var n=t._nativeArray,i=this._nativeArray.length;n.length=i;for(var a=0;a<i;a++){var r,o,s=this._nativeArray[a];s&&("number"==typeof s?(n[a]=s,t.setNumber(a,s)):"number"==typeof s?(n[a]=s,t.setInt(a,s)):"boolean"==typeof s?(n[a]=s,t.setBool(a,s)):s instanceof gn?(r=n[a]||(n[a]=new gn),s.cloneTo(r),n[a]=r,t.setVector2(a,r)):s instanceof vn?(r=n[a]||(n[a]=new vn),s.cloneTo(r),n[a]=r,t.setVector3(a,r)):s instanceof yn?(o=n[a]||(n[a]=new yn),s.cloneTo(o),n[a]=o,t.setVector(a,o)):s instanceof ki?(o=n[a]||(n[a]=new ki),s.cloneTo(o),n[a]=o,t.setMatrix4x4(a,o)):s instanceof U&&(n[a]=s,t.setTexture(a,s)))}this._defineDatas.cloneTo(t._defineDatas)}},{key:"_initDataForNative",value:function(){this._frameCount=-1,this._runtimeCopyValues.length=0,this._nativeArray=[],this._data=new ArrayBuffer(32),this._int32Data=new Int32Array(this._data),this._float32Data=new Float32Array(this._data),P.instance.createArrayBufferRef(this._data,P.ARRAY_BUFFER_TYPE_DATA,!0)}},{key:"needRenewArrayBufferForNative",value:function(e){var t,n,i;e>=this._int32Data.length&&(t=4*(e+1),i=this._int32Data,n=this._data.conchRef,e=this._data._ptrID,this._data=new ArrayBuffer(t),this._int32Data=new Int32Array(this._data),this._float32Data=new Float32Array(this._data),this._data.conchRef=n,this._data._ptrID=e,i&&this._int32Data.set(i,0),((i=P.instance).updateArrayBufferRef?i:window.conch).updateArrayBufferRef(this._data._ptrID,n.isSyncToRender(),this._data))}},{key:"getDataForNative",value:function(){return this._nativeArray}},{key:"getIntForNative",value:function(e){return this._int32Data[e]}},{key:"setIntForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),this._int32Data[e]=t,this._nativeArray[e]=t}},{key:"getBoolForNative",value:function(e){return 1==this._int32Data[e]}},{key:"setBoolForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),this._int32Data[e]=t?1:0,this._nativeArray[e]=t}},{key:"getNumberForNative",value:function(e){return this._float32Data[e]}},{key:"setNumberForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),this._float32Data[e]=t,this._nativeArray[e]=t}},{key:"getMatrix4x4ForNative",value:function(e){return this._nativeArray[e]}},{key:"setMatrix4x4ForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),this._nativeArray[e]=t;t=this.setReferenceForNative(t.elements);this._int32Data[e]=t}},{key:"getVectorForNative",value:function(e){return this._nativeArray[e]}},{key:"setVectorForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),(this._nativeArray[e]=t).elements||t.forNativeElement();t=this.setReferenceForNative(t.elements);this._int32Data[e]=t}},{key:"getVector2ForNative",value:function(e){return this._nativeArray[e]}},{key:"setVector2ForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),(this._nativeArray[e]=t).elements||t.forNativeElement();t=this.setReferenceForNative(t.elements);this._int32Data[e]=t}},{key:"getVector3ForNative",value:function(e){return this._nativeArray[e]}},{key:"setVector3ForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),(this._nativeArray[e]=t).elements||t.forNativeElement();t=this.setReferenceForNative(t.elements);this._int32Data[e]=t}},{key:"getQuaternionForNative",value:function(e){return this._nativeArray[e]}},{key:"setQuaternionForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),(this._nativeArray[e]=t).elements||t.forNativeElement();t=this.setReferenceForNative(t.elements);this._int32Data[e]=t}},{key:"getBufferForNative",value:function(e){return this._nativeArray[e]}},{key:"setBufferForNative",value:function(e,t){this.needRenewArrayBufferForNative(e),this._nativeArray[e]=t;t=this.setReferenceForNative(t);this._int32Data[e]=t}},{key:"getAttributeForNative",value:function(e){return this._nativeArray[e]}},{key:"setAttributeForNative",value:function(e,t){(this._nativeArray[e]=t)._ptrID||P.instance.createArrayBufferRef(t,P.ARRAY_BUFFER_TYPE_DATA,!0),P.instance.syncBufferToRenderThread(t),this._int32Data[e]=t._ptrID}},{key:"getTextureForNative",value:function(e){return this._nativeArray[e]}},{key:"setTextureForNative",value:function(e,t){var n;t&&(this.needRenewArrayBufferForNative(e),n=this._nativeArray[e],this._nativeArray[e]=t,this._int32Data[e]=t._glTexture.id,this._ownerResource&&0<this._ownerResource.referenceCount&&(n&&n._removeReference(),t&&t._addReference()))}},{key:"setReferenceForNative",value:function(e){this.clearRuntimeCopyArray();var t=0,n=0;return i._SET_RUNTIME_VALUE_MODE_REFERENCE_?(P.instance.createArrayBufferRefs(e,P.ARRAY_BUFFER_TYPE_DATA,!0,P.ARRAY_BUFFER_REF_REFERENCE),t=0,n=e.getPtrID(t)):(P.instance.createArrayBufferRefs(e,P.ARRAY_BUFFER_TYPE_DATA,!0,P.ARRAY_BUFFER_REF_COPY),t=e.getRefNum()-1,n=e.getPtrID(t),this._runtimeCopyValues.push({obj:e,refID:t,ptrID:n})),P.instance.syncBufferToRenderThread(e,t),n}},{key:"clearRuntimeCopyArray",value:function(){var e=J.loopCount;if(this._frameCount!=e){this._frameCount=e;for(var t=0,n=this._runtimeCopyValues.length;t<n;t++)this._runtimeCopyValues[t].obj.clearRefNum();this._runtimeCopyValues.length=0}}}],[{key:"setRuntimeValueMode",value:function(e){i._SET_RUNTIME_VALUE_MODE_REFERENCE_=e}}]),i}();va._SET_RUNTIME_VALUE_MODE_REFERENCE_=!0;var pa=function(){function l(e,t){S(this,l),this._id=++l._uniqueIDCounter,this._vertexElementsDic={},this._vertexStride=e;var n=(this._vertexElements=t).length;this._shaderValues=new va(null);for(var i=0;i<n;i++){var a=t[i],r=a._elementUsage;this._vertexElementsDic[r]=a;var o=new Int32Array(5),s=ya.getElementInfos(a._elementFormat);o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=this._vertexStride,o[4]=a._offset,this._shaderValues.setAttribute(r,o)}}return C(l,[{key:"getVertexElementByIndex",value:function(e){return this._vertexElements[e]}},{key:"getVertexElementByUsage",value:function(e){return this._vertexElementsDic[e]}},{key:"id",get:function(){return this._id}},{key:"vertexStride",get:function(){return this._vertexStride}},{key:"vertexElementCount",get:function(){return this._vertexElements.length}}]),l}();pa._uniqueIDCounter=1;var ma=function(){function i(e,t,n){S(this,i),this._offset=e,this._elementFormat=t,this._elementUsage=n}return C(i,[{key:"offset",get:function(){return this._offset}},{key:"elementFormat",get:function(){return this._elementFormat}},{key:"elementUsage",get:function(){return this._elementUsage}}]),i}(),wa=function(){function h(){S(this,h)}return C(h,null,[{key:"__init__",value:function(){h.instanceWorldMatrixDeclaration=new pa(64,[new ma(0,ya.Vector4,h.MESH_WORLDMATRIX_ROW0),new ma(16,ya.Vector4,h.MESH_WORLDMATRIX_ROW1),new ma(32,ya.Vector4,h.MESH_WORLDMATRIX_ROW2),new ma(48,ya.Vector4,h.MESH_WORLDMATRIX_ROW3)]),h.instanceMVPMatrixDeclaration=new pa(64,[new ma(0,ya.Vector4,h.MESH_MVPMATRIX_ROW0),new ma(16,ya.Vector4,h.MESH_MVPMATRIX_ROW1),new ma(32,ya.Vector4,h.MESH_MVPMATRIX_ROW2),new ma(48,ya.Vector4,h.MESH_MVPMATRIX_ROW3)])}},{key:"getVertexDeclaration",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=h._vertexDeclarationMap[e+(t?"_0":"_1")];if(!n){for(var i,a=e.split(","),r=0,o=[],s=0,l=a.length;s<l;s++){switch(a[s]){case"POSITION":i=new ma(r,ya.Vector3,h.MESH_POSITION0),r+=12;break;case"NORMAL":i=new ma(r,ya.Vector3,h.MESH_NORMAL0),r+=12;break;case"COLOR":i=new ma(r,ya.Vector4,h.MESH_COLOR0),r+=16;break;case"UV":i=new ma(r,ya.Vector2,h.MESH_TEXTURECOORDINATE0),r+=8;break;case"UV1":i=new ma(r,ya.Vector2,h.MESH_TEXTURECOORDINATE1),r+=8;break;case"BLENDWEIGHT":i=new ma(r,ya.Vector4,h.MESH_BLENDWEIGHT0),r+=16;break;case"BLENDINDICES":t?(i=new ma(r,ya.Vector4,h.MESH_BLENDINDICES0),r+=16):(i=new ma(r,ya.Byte4,h.MESH_BLENDINDICES0),r+=4);break;case"TANGENT":i=new ma(r,ya.Vector4,h.MESH_TANGENT0),r+=16;break;default:throw"VertexMesh: unknown vertex flag."}o.push(i)}n=new pa(r,o),h._vertexDeclarationMap[e+(t?"_0":"_1")]=n}return n}}]),h}();function xa(){S(this,xa)}wa.MESH_POSITION0=0,wa.MESH_COLOR0=1,wa.MESH_TEXTURECOORDINATE0=2,wa.MESH_NORMAL0=3,wa.MESH_TANGENT0=4,wa.MESH_BLENDINDICES0=5,wa.MESH_BLENDWEIGHT0=6,wa.MESH_TEXTURECOORDINATE1=7,wa.MESH_WORLDMATRIX_ROW0=8,wa.MESH_WORLDMATRIX_ROW1=9,wa.MESH_WORLDMATRIX_ROW2=10,wa.MESH_WORLDMATRIX_ROW3=11,wa.MESH_MVPMATRIX_ROW0=12,wa.MESH_MVPMATRIX_ROW1=13,wa.MESH_MVPMATRIX_ROW2=14,wa.MESH_MVPMATRIX_ROW3=15,wa._vertexDeclarationMap={};var ka=function(){function r(e){S(this,r),this._owner=e}return C(r,[{key:"_getMeshDefine",value:function(e,t){for(var n=t.length=0,i=e._subMeshes.length;n<i;n++)for(var a=e.getSubMesh(n)._vertexBuffer._vertexDeclaration._vertexElements,r=0,o=a.length;r<o;r++)switch(a[r]._elementUsage){case wa.MESH_COLOR0:t.push(xa.SHADERDEFINE_COLOR);break;case wa.MESH_TEXTURECOORDINATE0:t.push(xa.SHADERDEFINE_UV0);break;case wa.MESH_TEXTURECOORDINATE1:t.push(xa.SHADERDEFINE_UV1)}}},{key:"destroy",value:function(){this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)}},{key:"sharedMesh",get:function(){return this._sharedMesh},set:function(e){if(this._sharedMesh!==e){var t=this._owner._render._shaderValues,n=this._sharedMesh;if(n){n._removeReference(),this._getMeshDefine(n,r._meshVerticeDefine);for(var i=0,a=r._meshVerticeDefine.length;i<a;i++)t.removeDefine(r._meshVerticeDefine[i])}if(e){e._addReference(),this._getMeshDefine(e,r._meshVerticeDefine);for(i=0,a=r._meshVerticeDefine.length;i<a;i++)t.addDefine(r._meshVerticeDefine[i])}this._owner._render._onMeshChange(e),this._sharedMesh=e}}}]),r}();ka._meshVerticeDefine=[];var Ta=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;S(this,a),this.r=e,this.g=t,this.b=n,this.a=i}return C(a,[{key:"toLinear",value:function(e){e.r=a.gammaToLinearSpace(this.r),e.g=a.gammaToLinearSpace(this.g),e.b=a.gammaToLinearSpace(this.b)}},{key:"toGamma",value:function(e){e.r=a.linearToGammaSpace(this.r),e.g=a.linearToGammaSpace(this.g),e.b=a.linearToGammaSpace(this.b)}},{key:"cloneTo",value:function(e){e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a}},{key:"clone",value:function(){var e=new a;return this.cloneTo(e),e}},{key:"forNativeElement",value:function(){}}],[{key:"gammaToLinearSpace",value:function(e){return e<=.04045?e/12.92:e<1?Math.pow((e+.055)/1.055,2.4):Math.pow(e,2.4)}},{key:"linearToGammaSpace",value:function(e){return e<=0?0:e<=.0031308?12.92*e:e<=1?1.055*Math.pow(e,.41666)-.055:Math.pow(e,.41666)}}]),a}();Ta.RED=new Ta(1,0,0,1),Ta.GREEN=new Ta(0,1,0,1),Ta.BLUE=new Ta(0,0,1,1),Ta.CYAN=new Ta(0,1,1,1),Ta.YELLOW=new Ta(1,.92,.016,1),Ta.MAGENTA=new Ta(1,0,1,1),Ta.GRAY=new Ta(.5,.5,.5,1),Ta.WHITE=new Ta(1,1,1,1),Ta.BLACK=new Ta(0,0,0,1);var Ea=function(){function t(){S(this,t),this._batchRenderElementPool=[]}return C(t,[{key:"_clear",value:function(){this._batchRenderElementPoolIndex=0}},{key:"_getBatchRenderElementFromPool",value:function(){throw"StaticBatch:must override this function."}},{key:"dispose",value:function(){}}],[{key:"_registerManager",value:function(e){t._managers.push(e)}}]),t}();Ea._managers=[];var Ma=function(){function s(){S(this,s),this._initBatchSprites=[],this._staticBatches={},this._batchRenderElementPoolIndex=0,this._batchRenderElementPool=[]}return C(s,[{key:"_partition",value:function(e,t,n){for(var i=e[Math.floor((n+t)/2)];t<=n;){for(;this._compare(e[t],i)<0;)t++;for(;0<this._compare(e[n],i);)n--;if(t<n){var a=e[t];e[t]=e[n],e[n]=a,t++,n--}else if(t===n){t++;break}}return t}},{key:"_quickSort",value:function(e,t,n){var i,a;1<e.length&&(t<(a=(i=this._partition(e,t,n))-1)&&this._quickSort(e,t,a),i<n&&this._quickSort(e,i,n))}},{key:"_compare",value:function(e,t){throw"StaticBatch:must override this function."}},{key:"_initStaticBatchs",value:function(e){throw"StaticBatch:must override this function."}},{key:"_getBatchRenderElementFromPool",value:function(){throw"StaticBatch:must override this function."}},{key:"_addBatchSprite",value:function(e){this._initBatchSprites.push(e)}},{key:"_clear",value:function(){this._batchRenderElementPoolIndex=0}},{key:"_garbageCollection",value:function(){throw"StaticBatchManager: must override it."}},{key:"dispose",value:function(){this._staticBatches=null}}],[{key:"_addToStaticBatchQueue",value:function(e,t){e instanceof ga&&t.push(e);for(var n=0,i=e.numChildren;n<i;n++)s._addToStaticBatchQueue(e._children[n],t)}},{key:"_registerManager",value:function(e){s._managers.push(e)}},{key:"combine",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;t||(t=[],e&&s._addToStaticBatchQueue(e,t));var n=t.length;if(0<n){for(var i=0;i<n;i++){var a=t[i];a.destroyed||(a._render._isPartOfStaticBatch?console.warn("StaticBatchManager: Sprite "+a.name+" has a part of Static Batch,it will be ignore."):a._addToInitStaticBatchManager())}for(var r=0,o=s._managers.length;r<o;r++)s._managers[r]._initStaticBatchs(e)}}}]),s}();Ma._managers=[];var ba=function(){function m(){S(this,m)}return C(m,null,[{key:"__init__",value:function(){yt.supportWebGLPlusCulling&&(m._cullingBufferLength=0,m._cullingBuffer=new Float32Array(4096))}},{key:"_drawTraversalCullingBound",value:function(e,t){e.length;for(var n=e.elements,i=0,a=e.length;i<a;i++){var r=m._tempColor0;r.r=0,r.g=1,r.b=0,r.a=1,ia._drawBound(t,n[i].bounds._getBoundBox(),r)}}},{key:"_traversalCulling",value:function(e,t,n,i,a,r){for(var o=i.length,s=i.elements,l=e.boundFrustum,h=e._transform.position,u=0;u<o;u++){var d=s[u];if(e._isLayerVisible(d._owner._layer)&&d._enable)if(J.frustumCulling++,!e.useOcclusionCulling||d._needRender(l,n)){d._visible=!0,d._distanceForSort=vn.distance(d.bounds.getCenter(),h);for(var c=d._renderElements,_=0,f=c.length;_<f;_++)c[_]._update(t,n,a,r)}else d._visible=!1;else d._visible=!1}}},{key:"renderObjectCulling",value:function(e,t,n,i,a,r){var o=t._opaqueQueue,s=t._transparentQueue;o.clear(),s.clear();for(var l=Ma._managers,h=0,u=l.length;h<u;h++)l[h]._clear();var d=Ea._managers;for(h=0,u=d.length;h<u;h++)d[h]._clear();var c=t._octree;c&&(c.updateMotionObjects(),c.shrinkRootIfPossible(),c.getCollidingWithFrustum(n,a,r)),m._traversalCulling(e,t,n,i,a,r),m.debugFrustumCulling&&((_=t._debugTool).clear(),c&&(c.drawAllBounds(_),c.drawAllObjects(_)),m._drawTraversalCullingBound(i,_));var _=o.elements.length;0<_&&o._quickSort(0,_-1),0<(_=s.elements.length)&&s._quickSort(0,_-1)}},{key:"renderObjectCullingNative",value:function(e,t,n,i,a,r){var o=t._opaqueQueue,s=t._transparentQueue;o.clear(),s.clear();for(var l=Ma._managers,h=0,u=l.length;h<u;h++)l[h]._clear();var d=Ea._managers;for(h=0,u=d.length;h<u;h++)d[h]._clear();var c=i.length,_=i.elements;for(h=0;h<c;h++)_[h].bounds,_[h]._updateForNative&&_[h]._updateForNative(n);e.boundFrustum;m.cullingNative(e._boundFrustumBuffer,m._cullingBuffer,t._cullingBufferIndices,c,t._cullingBufferResult);var f=n.camera._transform.position;for(h=0;h<c;h++){var g=_[h];if(!e.useOcclusionCulling||e._isLayerVisible(g._owner._layer)&&g._enable&&t._cullingBufferResult[h]){g._visible=!0,g._distanceForSort=vn.distance(g.bounds.getCenter(),f);for(var y=g._renderElements,v=0,p=y.length;v<p;v++)y[v]._update(t,n,a,r)}else g._visible=!1}i=o.elements.length;0<i&&o._quickSort(0,i-1),0<(i=s.elements.length)&&s._quickSort(0,i-1)}},{key:"cullingNative",value:function(e,t,n,i,a){return P.instance.culling(e,t,n,i,a)}}]),m}();function Sa(){S(this,Sa),this.updateMark=-1,this.indexInList=-1,this.batched=!1}ba._tempVector3=new vn,ba._tempColor0=new Ta,ba.debugFrustumCulling=!1;var Ia=function(){function e(){S(this,e),this._destroyed=!1}return C(e,[{key:"_getType",value:function(){throw"GeometryElement:must override it."}},{key:"_prepareRender",value:function(e){return!0}},{key:"_render",value:function(e){throw"GeometryElement:must override it."}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0)}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();Ia._typeCounter=0;var Na=function(){T(o,Ne);var r=b(o);function o(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];S(this,o),(n=r.call(this))._vertexDeclaration=null,n._float32Reader=null;var a=P.instance;return n._bufferUsage=t,n._bufferType=a.ARRAY_BUFFER,n._canRead=i,n._byteLength=e,n.bind(),a.bufferData(n._bufferType,n._byteLength,n._bufferUsage),i&&(n._buffer=new Uint8Array(e),n._float32Reader=new Float32Array(n._buffer.buffer)),n}return C(o,[{key:"bind",value:function(){if(Ne._bindedVertexBuffer===this._glBuffer)return!1;var e=P.instance;return e.bindBuffer(e.ARRAY_BUFFER,this._glBuffer),Ne._bindedVertexBuffer=this._glBuffer,!0}},{key:"setData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER;this.bind(),0!==n||i!==Number.MAX_SAFE_INTEGER?(i=new Uint8Array(e,n,i),P.instance.bufferSubData(this._bufferType,t,i),this._canRead&&this._buffer.set(i,t)):(P.instance.bufferSubData(this._bufferType,t,e),this._canRead&&this._buffer.set(new Uint8Array(e),t))}},{key:"getUint8Data",value:function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")}},{key:"getFloat32Data",value:function(){if(this._canRead)return this._float32Reader;throw new Error("Can't read data from VertexBuffer with only write flag!")}},{key:"markAsUnreadbale",value:function(){this._canRead=!1,this._buffer=null,this._float32Reader=null}},{key:"destroy",value:function(){G(z(o.prototype),"destroy",this).call(this),this._buffer=null,this._float32Reader=null,this._vertexDeclaration=null}},{key:"vertexDeclaration",get:function(){return this._vertexDeclaration},set:function(e){this._vertexDeclaration=e}},{key:"canRead",get:function(){return this._canRead}}]),o}();Na.DATATYPE_FLOAT32ARRAY=0,Na.DATATYPE_UINT8ARRAY=1;var Ra=function(){T(i,Ia);var n=b(i);function i(){var e;S(this,i),(e=n.call(this)).maxInstanceCount=1024,e.instanceWorldMatrixData=new Float32Array(16*e.maxInstanceCount),e.instanceMVPMatrixData=new Float32Array(16*e.maxInstanceCount);var t=P.instance;return e.instanceWorldMatrixBuffer=new Na(4*e.instanceWorldMatrixData.length,t.DYNAMIC_DRAW),e.instanceMVPMatrixBuffer=new Na(4*e.instanceMVPMatrixData.length,t.DYNAMIC_DRAW),e.instanceWorldMatrixBuffer.vertexDeclaration=wa.instanceWorldMatrixDeclaration,e.instanceMVPMatrixBuffer.vertexDeclaration=wa.instanceMVPMatrixDeclaration,e}return C(i,[{key:"_render",value:function(e){var t=P.instance,n=e.renderElement,i=n.instanceSubMesh,e=n.instanceBatchElementList.length,n=i._indexCount;i._mesh._instanceBufferState.bind(),P.layaGPUInstance.drawElementsInstanced(t.TRIANGLES,n,t.UNSIGNED_SHORT,2*i._indexStart,e),J.renderBatches++,J.savedRenderBatches+=e-1,J.trianglesFaces+=n*e/3}}],[{key:"__init__",value:function(){i.instance=new i}}]),i}(),bi=function e(){S(this,e)},Ca=function e(){S(this,e),this.updateMark=-1,this.pointLightCount=0,this.spotLightCount=0,this.indices=[]},Aa=function(){function g(e,t,n,i){S(this,g),this._updateMark=0,this._depthSliceParam=new gn;t=(this._xSlices=e)*(this._ySlices=t),i=(this._zSlices=n)*(1+Math.ceil(i/4));this._clusterTexture=ia._createFloatTextureBuffer(t,i),this._clusterTexture.lock=!0,this._clusterPixels=new Float32Array(t*i*4);for(var a=new Array(this._zSlices),r=0;r<this._zSlices;r++){a[r]=new Array(this._ySlices);for(var o=0;o<this._ySlices;o++){a[r][o]=new Array(this._xSlices);for(var s=0;s<this._xSlices;s++)a[r][o][s]=new Ca}}this._clusterDatas=a}return C(g,[{key:"_insertSpotLightSphere",value:function(e,t,n,i,a){var r=g._tempVector35;r.x=a.x-e.x,r.y=a.y-e.y,r.z=a.z-e.z;e=vn.dot(r,r),a=a.w;if(!(a*a<e))return!1;t=vn.dot(r,t);return!(a<Math.cos(i)*Math.sqrt(e-t*t)-t*Math.sin(i)||a+n<t||t<-a)}},{key:"_placePointLightToClusters",value:function(e,t){for(var n=this._clusterDatas,i=this._updateMark,a=t.zMin,r=t.zMax;a<r;a++)for(var o=t.yMin,s=t.yMax;o<s;o++)for(var l=t.xMin,h=t.xMax;l<h;l++){var u=n[a][o][l];u.updateMark!=i&&(u.pointLightCount=0,u.spotLightCount=0,u.updateMark=i);var d=u.indices,u=u.pointLightCount++;u<d.length?d[u]=e:d.push(e)}}},{key:"_placeSpotLightToClusters",value:function(e,t){for(var n=this._clusterDatas,i=this._updateMark,a=t.zMin,r=t.zMax;a<r;a++)for(var o=t.yMin,s=t.yMax;o<s;o++)for(var l=t.xMin,h=t.xMax;l<h;l++){var u=n[a][o][l];u.updateMark!=i&&(u.pointLightCount=0,u.spotLightCount=0,u.updateMark=i);var d=u.indices,u=u.pointLightCount+u.spotLightCount++;u<d.length?d[u]=e:d.push(e)}}},{key:"_insertConePlane",value:function(e,t,n,i,a){var r=g._tempVector36,o=g._tempVector37;vn.cross(a,t,r),vn.cross(r,t,o),vn.normalize(o,o);var s=n*Math.tan(i),r=e.x+n*t.x+s*o.x,i=e.y+n*t.y+s*o.y,o=e.z+n*t.z+s*o.z;return r*a.x+i*a.y+o*a.z<=0||e.x*a.x+e.y*a.y+e.z*a.z<=0}},{key:"_shrinkSphereLightZPerspective",value:function(e,t,n,i,a){var r=n.z,n=r-i,i=r+i;if(t<n||i<=e)return!1;t=this._depthSliceParam;return a.zMin=Math.floor(Math.log2(Math.max(n,e))*t.x-t.y),a.zMax=Math.min(Math.ceil(Math.log2(i)*t.x-t.y),this._zSlices),!0}},{key:"_shrinkSpotLightZPerspective",value:function(e,t,n,i,a,r,o){var s=i.x,l=i.y,h=i.z,u=Math.tan(r)*a,d=n.x,i=n.y,r=n.z,d=s-d,l=l-i,i=h-r,l=d*d+l*l+i*i,i=Math.sqrt(1-i*i/l),l=Math.max(Math.min(r,h-i*u),n.z-a),a=Math.min(Math.max(r,h+i*u),n.z+a);if(t<l||a<=e)return!1;t=this._depthSliceParam;return o.zMin=Math.floor(Math.log2(Math.max(l,e))*t.x-t.y),o.zMax=Math.min(Math.ceil(Math.log2(a)*t.x-t.y),this._zSlices),!0}},{key:"_shrinkSphereLightByBoundOrth",value:function(e,t,n,i,a,r,o){var s=a.z,l=s-r,h=s+r;if(i<l||h<=n)return!1;var u=a.x,d=u-r,c=u+r;if(e<d||c<=-e)return!1;var _=a.y,f=_-r,s=_+r;if(t<f||s<=-t)return!1;i=this._xSlices,u=this._ySlices,a=this._depthSliceParam,_=2*e/i,r=2*t/u;return o.xMin=Math.max(Math.floor((d+e)/_),0),o.xMax=Math.min(Math.ceil((c+e)/_),i),o.yMin=Math.max(Math.floor((t-s)/r),0),o.yMax=Math.min(Math.ceil((t-f)/r),u),o.zMin=Math.floor(Math.log2(Math.max(l,n))*a.x-a.y),o.zMax=Math.min(Math.ceil(Math.log2(h)*a.x-a.y),this._zSlices),!0}},{key:"_shrinkSpotLightByBoundOrth",value:function(e,t,n,i,a,r,o,s,l){var h=r.x,u=r.y,d=r.z,c=Math.tan(s)*o,_=a.x,f=a.y,g=a.z,y=h-_,v=u-f,p=d-g,r=y*y+v*v+p*p,s=Math.sqrt(1-p*p/r),p=Math.max(Math.min(g,d-s*c),a.z-o),s=Math.min(Math.max(g,d+s*c),a.z+o);if(i<p||s<=n)return!1;i=Math.sqrt(1-y*y/r),y=Math.max(Math.min(_,h-i*c),a.x-o),i=Math.min(Math.max(_,h+i*c),a.x+o);if(e<y||i<=-e)return!1;v=Math.sqrt(1-v*v/r),r=Math.max(Math.min(f,u-v*c),a.y-o),f=Math.min(Math.max(f,u+v*c),a.y+o);if(t<r||f<=-t)return!1;u=this._xSlices,v=this._ySlices,c=this._depthSliceParam,a=2*e/u,o=2*t/v;return l.xMin=Math.max(Math.floor((y+e)/a),0),l.xMax=Math.min(Math.ceil((i+e)/a),u),l.yMin=Math.max(Math.floor((t-f)/o),0),l.yMax=Math.min(Math.ceil((t-r)/o),v),l.zMin=Math.floor(Math.log2(Math.max(p,n))*c.x-c.y),l.zMax=Math.min(Math.ceil(Math.log2(s)*c.x-c.y),this._zSlices),!0}},{key:"_shrinkXYByRadiusPerspective",value:function(e,t,n,i,a){for(var r,o,s,l,h,u=e.x,d=e.y,c=e.z,_=this._ySlices+1,f=0;f<_;f++)if(d*(h=a[f]).y+c*h.z<t){o=Math.max(0,f-1);break}if(f==_)return!1;for(l=this._ySlices,f=o+1;f<_;f++)if(d*(h=a[f]).y+c*h.z<=-t){l=Math.max(0,f);break}for(_=this._xSlices+1,f=0;f<_;f++)if(u*(h=i[f]).x+c*h.z<t){r=Math.max(0,f-1);break}for(s=this._xSlices,f=r+1;f<_;f++)if(u*(h=i[f]).x+c*h.z<=-t){s=Math.max(0,f);break}return n.xMin=r,n.xMax=s,n.yMin=o,n.yMax=l,!0}},{key:"_shrinkSpotXYByConePerspective",value:function(e,t,n,i,a,r,o){for(var s,l,h,u,d=g._tempVector32,c=a.yMax+1,_=a.yMin+1;_<c;_++)if(this._insertConePlane(e,t,n,i,o[_])){l=Math.max(0,_-1);break}u=a.yMax;for(_=l+1;_<c;_++){var f=o[_];if(d.setValue(0,-f.y,-f.z),!this._insertConePlane(e,t,n,i,d)){u=Math.max(0,_);break}}c=a.xMax+1;for(_=a.xMin+1;_<c;_++)if(this._insertConePlane(e,t,n,i,r[_])){s=Math.max(0,_-1);break}h=a.xMax;for(_=s+1;_<c;_++){f=r[_];if(d.setValue(-f.x,0,-f.z),!this._insertConePlane(e,t,n,i,d)){h=Math.max(0,_);break}}a.xMin=s,a.xMax=h,a.yMin=l,a.yMax=u}},{key:"_updatePointLightPerspective",value:function(e,t,n,i,a,r,o){var s=g._tempLightBound,l=g._tempVector30;vn.transformV3ToV3(i._transform.position,n,l),l.z*=-1,this._shrinkSphereLightZPerspective(e,t,l,i.range,s)&&this._shrinkXYByRadiusPerspective(l,i.range,s,r,o)&&this._placePointLightToClusters(a,s)}},{key:"_updateSpotLightPerspective",value:function(e,t,n,i,a,r,o){var s=g._tempLightBound,l=g._tempVector30,h=g._tempVector31,u=g._tempVector34,d=i._transform.position,c=i.range;i._transform.worldMatrix.getForward(h),vn.normalize(h,h),vn.scale(h,c,u),vn.add(d,u,u),vn.transformV3ToV3(d,n,l),vn.transformV3ToV3(u,n,u),l.z*=-1,u.z*=-1;i=i.spotAngle/2*Math.PI/180;this._shrinkSpotLightZPerspective(e,t,l,u,c,i,s)&&this._shrinkXYByRadiusPerspective(l,c,s,r,o)&&((t=g._tempVector33).x=u.x-l.x,t.y=u.y-l.y,t.z=u.z-l.z,vn.normalize(t,t),this._shrinkSpotXYByConePerspective(l,t,c,i,s,r,o),this._placeSpotLightToClusters(a,s))}},{key:"_updatePointLightOrth",value:function(e,t,n,i,a,r,o){var s=g._tempLightBound,l=g._tempVector30;vn.transformV3ToV3(r._transform.position,a,l),l.z*=-1,this._shrinkSphereLightByBoundOrth(e,t,n,i,l,r.range,s)&&this._placePointLightToClusters(o,s)}},{key:"_updateSpotLightOrth",value:function(e,t,n,i,a,r,o){var s=g._tempLightBound,l=g._tempVector30,h=g._tempVector31,u=g._tempVector34,d=r._transform.position,c=r.range;r._transform.worldMatrix.getForward(h),vn.normalize(h,h),vn.scale(h,c,u),vn.add(d,u,u),vn.transformV3ToV3(d,a,l),vn.transformV3ToV3(u,a,u),l.z*=-1,u.z*=-1;r=r.spotAngle/2*Math.PI/180;this._shrinkSpotLightByBoundOrth(e,t,n,i,l,u,c,r,s)&&this._placeSpotLightToClusters(o,s)}},{key:"update",value:function(e,t){this._updateMark++;var n=e.nearPlane;this._depthSliceParam.x=ha._config.lightClusterCount.z/Math.log2(e.farPlane/n),this._depthSliceParam.y=Math.log2(n)*this._depthSliceParam.x;var i=e.nearPlane,a=e.farPlane,r=e.viewMatrix,o=t._directionLights._length,n=t._pointLights,s=n._length,l=n._elements,t=t._spotLights,h=t._length,u=t._elements;if(e.orthographic){for(var d=e.orthographicVerticalSize/2,c=d*e.aspectRatio,_=0;_<s;_++,o++)this._updatePointLightOrth(c,d,i,a,r,l[_],o);for(_=0;_<h;_++,o++)this._updateSpotLightOrth(c,d,i,a,r,u[_],o)}else{e._updateClusterPlaneXY();for(var f=e._clusterXPlanes,g=e._clusterYPlanes,_=0;_<s;_++,o++)this._updatePointLightPerspective(i,a,r,l[_],o,f,g);for(_=0;_<h;_++,o++)this._updateSpotLightPerspective(i,a,r,u[_],o,f,g)}if(0<s+h){for(var y=this._xSlices,v=this._ySlices,p=this._zSlices,m=y*v*4,w=m*p,x=this._clusterPixels,k=x.length,T=this._clusterDatas,E=this._updateMark,M=!0,b=0;b<p;b++)for(var S=0;S<v;S++)for(var I=0;I<y;I++){var N=T[b][S][I],R=4*(I+S*y+b*y*v);if(N.updateMark!==E)x[R]=0,x[1+R]=0;else if(M){var C=N.indices,A=N.pointLightCount,N=N.spotLightCount,D=A+N;if(w+D<k){x[R]=A,x[1+R]=N,x[2+R]=Math.floor(w/m),x[3+R]=w%m;for(_=0;_<D;_++)x[w++]=C[_]}else{D=k-(w+D),A=Math.min(A,D),x[R]=A,x[1+R]=Math.min(N,D-A),x[2+R]=Math.floor(w/m),x[3+R]=w%m;for(_=0;_<D;_++)x[w++]=C[_];M=!1}}}e=this._clusterTexture.width;this._clusterTexture.setSubPixels(0,0,e,Math.ceil(w/(4*e)),x)}}}]),g}();Aa._tempVector30=new vn,Aa._tempVector31=new vn,Aa._tempVector32=new vn,Aa._tempVector33=new vn,Aa._tempVector34=new vn,Aa._tempVector35=new vn,Aa._tempVector36=new vn,Aa._tempVector37=new vn,Aa._tempLightBound=new bi;var Da=function(){function l(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;S(this,l),this.normal=e,this.distance=t}return C(l,[{key:"normalize",value:function(){var e=this.normal.x,t=this.normal.y,n=this.normal.z,i=1/Math.sqrt(e*e+t*t+n*n);this.normal.x=e*i,this.normal.y=t*i,this.normal.z=n*i,this.distance*=i}}],[{key:"createPlaneBy3P",value:function(e,t,n){var i=t.x-e.x,a=t.y-e.y,r=t.z-e.z,o=n.x-e.x,s=n.y-e.y,t=n.z-e.z,n=a*t-r*s,t=r*o-i*t,a=i*s-a*o,o=1/Math.sqrt(n*n+t*t+a*a),n=n*o,t=t*o,o=a*o;l._TEMPVec3.x=n,l._TEMPVec3.y=t,l._TEMPVec3.z=o;e=-(n*e.x+t*e.y+o*e.z);return new l(l._TEMPVec3,e)}}]),l}();function La(e,t){S(this,La),this.origin=e,this.direction=t}function Oa(){S(this,Oa)}Da._TEMPVec3=new vn,Da.PlaneIntersectionType_Back=0,Da.PlaneIntersectionType_Front=1,Da.PlaneIntersectionType_Intersecting=2,Oa.Disjoint=0,Oa.Contains=1,Oa.Intersects=2;var Pa=function(){function T(){S(this,T)}return C(T,null,[{key:"distancePlaneToPoint",value:function(e,t){return vn.dot(e.normal,t)-e.distance}},{key:"distanceBoxToPoint",value:function(e,t){var n=e.min,i=n.x,a=n.y,r=n.z,o=e.max,s=o.x,l=o.y,h=o.z,n=t.x,e=t.y,o=t.z,t=0;return n<i&&(t+=(i-n)*(i-n)),s<n&&(t+=(s-n)*(s-n)),e<a&&(t+=(a-e)*(a-e)),l<e&&(t+=(l-e)*(l-e)),o<r&&(t+=(r-o)*(r-o)),h<o&&(t+=(h-o)*(h-o)),Math.sqrt(t)}},{key:"distanceBoxToBox",value:function(e,t){var n,i=e.min,a=i.x,r=i.y,o=i.z,s=e.max,l=s.x,h=s.y,u=s.z,d=t.min,c=d.x,_=d.y,i=d.z,e=t.max,s=e.x,d=e.y,t=e.z,e=0;return s<a?e+=(n=a-s)*n:l<c&&(e+=(n=c-l)*n),d<r?e+=(n=r-d)*n:h<_&&(e+=(n=_-h)*n),t<o?e+=(n=o-t)*n:u<i&&(e+=(n=i-u)*n),Math.sqrt(e)}},{key:"distanceSphereToPoint",value:function(e,t){t=Math.sqrt(vn.distanceSquared(e.center,t));return t-=e.radius,Math.max(t,0)}},{key:"distanceSphereToSphere",value:function(e,t){var n=Math.sqrt(vn.distanceSquared(e.center,t.center));return n-=e.radius+t.radius,Math.max(n,0)}},{key:"intersectsRayAndTriangleRD",value:function(e,t,n,i,a){var r=e.origin,o=r.x,s=r.y,l=r.z,h=e.direction,u=h.x,d=h.y,c=h.z,_=t.x,f=t.y,g=t.z,y=n.x,v=n.y,p=n.z,m=i.x,w=i.y,x=i.z,k=T._tempV30.x,r=T._tempV30.y,e=T._tempV30.z,k=y-_,r=v-f,e=p-g,h=T._tempV31.x,t=T._tempV31.y,n=T._tempV31.z,h=m-_,t=w-f,n=x-g,i=T._tempV32.x,y=T._tempV32.y,v=T._tempV32.z,p=k*(i=d*n-c*t)+r*(y=c*h-u*n)+e*(v=u*t-d*h);if(fn.isZero(p))return!1;m=1/p,w=T._tempV33.x,x=T._tempV33.y,p=T._tempV33.z,y=(w=o-_)*i+(x=s-f)*y+(p=l-g)*v;if((y*=m)<0||1<y)return!1;l=T._tempV34.x,g=T._tempV34.y,v=T._tempV34.z,k=u*(l=x*e-p*r)+d*(g=p*k-w*e)+c*(v=w*r-x*k);if((k*=m)<0||1<y+k)return!1;v=h*l+t*g+n*v;return!((v*=m)<0)}},{key:"intersectsRayAndTriangleRP",value:function(e,t,n,i,a){return T.intersectsRayAndTriangleRD(e,t,n,i,void 0)?(vn.scale(e.direction,void 0,T._tempV30),vn.add(e.origin,T._tempV30,a),!0):(a=vn._ZERO,!1)}},{key:"intersectsRayAndPoint",value:function(e,t){vn.subtract(e.origin,t,T._tempV30);t=vn.dot(T._tempV30,e.direction),e=vn.dot(T._tempV30,T._tempV30)-fn.zeroTolerance;return!(0<e&&0<t)&&!(t*t-e<0)}},{key:"intersectsRayAndRay",value:function(e,t,n){var i=e.origin,a=i.x,r=i.y,o=i.z,s=e.direction,l=(s.x,s.y,s.z,t.origin),h=l.x,u=l.y,d=l.z,c=t.direction,_=c.x,f=c.y,g=c.z;vn.cross(s,c,T._tempV30);e=T._tempV30,t=vn.scalarLength(T._tempV30);if(fn.isZero(t)&&fn.nearEqual(h,a)&&fn.nearEqual(u,r)&&fn.nearEqual(d,o))return!0;t*=t;a=h-a,u-=r,r=d-o,d=e.x,o=e.y,e=e.z,t=(a*f*e+u*g*d+r*_*o-a*g*o-u*_*e-r*f*d)/t;vn.scale(s,t,T._tempV30),vn.scale(c,t,T._tempV31),vn.add(i,T._tempV30,T._tempV32),vn.add(l,T._tempV31,T._tempV33);i=T._tempV32,l=T._tempV33;return!!(fn.nearEqual(l.x,i.x)&&fn.nearEqual(l.y,i.y)&&fn.nearEqual(l.z,i.z))}},{key:"intersectsPlaneAndTriangle",value:function(e,t,n,i){t=T.intersectsPlaneAndPoint(e,t),n=T.intersectsPlaneAndPoint(e,n),i=T.intersectsPlaneAndPoint(e,i);return t==Da.PlaneIntersectionType_Front&&n==Da.PlaneIntersectionType_Front&&i==Da.PlaneIntersectionType_Front?Da.PlaneIntersectionType_Front:t==Da.PlaneIntersectionType_Back&&n==Da.PlaneIntersectionType_Back&&i==Da.PlaneIntersectionType_Back?Da.PlaneIntersectionType_Back:Da.PlaneIntersectionType_Intersecting}},{key:"intersectsRayAndPlaneRD",value:function(e,t,n){var i=t.normal,a=vn.dot(i,e.direction);if(fn.isZero(a))return!1;e=vn.dot(i,e.origin);return!((-t.distance-e)/a<0)||!1}},{key:"intersectsRayAndPlaneRP",value:function(e,t,n){return!!T.intersectsRayAndPlaneRD(e,t,void 0)&&(vn.scale(e.direction,void 0,T._tempV30),vn.add(e.origin,T._tempV30,T._tempV31),!0)}},{key:"intersectsRayAndBoxRD",value:function(e,t){var n=e.origin,i=n.x,a=n.y,r=n.z,o=e.direction,s=o.x,l=o.y,h=o.z,u=t.min,d=u.x,c=u.y,_=u.z,n=t.max,e=n.x,o=n.y,u=n.z,t=0,n=fn.MaxValue;if(fn.isZero(s)){if(i<d||e<i)return-1}else{s=1/s,d=(d-i)*s,i=(e-i)*s;if(i<d&&(s=d,d=i,i=s),t=Math.max(d,t),(n=Math.min(i,n))<t)return-1}if(fn.isZero(l)){if(a<c||o<a)return-1}else{l=1/l,c=(c-a)*l,a=(o-a)*l;if(a<c&&(l=c,c=a,a=l),t=Math.max(c,t),(n=Math.min(a,n))<t)return-1}if(fn.isZero(h)){if(r<_||u<r)return-1}else{h=1/h,_=(_-r)*h,r=(u-r)*h;if(r<_&&(h=_,_=r,r=h),t=Math.max(_,t),(n=Math.min(r,n))<t)return-1}return t}},{key:"intersectsRayAndBoxRP",value:function(e,t,n){t=T.intersectsRayAndBoxRD(e,t);return-1===t?vn._ZERO.cloneTo(n):(vn.scale(e.direction,t,T._tempV30),vn.add(e.origin,T._tempV30,T._tempV31),T._tempV31.cloneTo(n)),t}},{key:"intersectsRayAndSphereRD",value:function(e,t){var n=t.radius;vn.subtract(e.origin,t.center,T._tempV30);e=vn.dot(T._tempV30,e.direction),n=vn.dot(T._tempV30,T._tempV30)-n*n;if(0<n&&0<e)return-1;n=e*e-n;if(n<0)return-1;n=-e-Math.sqrt(n);return n=n<0?0:n}},{key:"intersectsRayAndSphereRP",value:function(e,t,n){t=T.intersectsRayAndSphereRD(e,t);return-1===t?vn._ZERO.cloneTo(n):(vn.scale(e.direction,t,T._tempV30),vn.add(e.origin,T._tempV30,T._tempV31),T._tempV31.cloneTo(n)),t}},{key:"intersectsSphereAndTriangle",value:function(e,t,n,i){var a=e.center,e=e.radius;return T.closestPointPointTriangle(a,t,n,i,T._tempV30),vn.subtract(T._tempV30,a,T._tempV31),vn.dot(T._tempV31,T._tempV31)<=e*e}},{key:"intersectsPlaneAndPoint",value:function(e,t){e=vn.dot(e.normal,t)+e.distance;return 0<e?Da.PlaneIntersectionType_Front:e<0?Da.PlaneIntersectionType_Back:Da.PlaneIntersectionType_Intersecting}},{key:"intersectsPlaneAndPlane",value:function(e,t){vn.cross(e.normal,t.normal,T._tempV30);t=vn.dot(T._tempV30,T._tempV30);return!fn.isZero(t)}},{key:"intersectsPlaneAndPlaneRL",value:function(e,t,n){var i=e.normal,a=t.normal;vn.cross(i,a,T._tempV34);var r=vn.dot(T._tempV34,T._tempV34);return!fn.isZero(r)&&(vn.scale(a,e.distance,T._tempV30),vn.scale(i,t.distance,T._tempV31),vn.subtract(T._tempV30,T._tempV31,T._tempV32),vn.cross(T._tempV32,T._tempV34,T._tempV33),vn.normalize(T._tempV34,T._tempV34),new La(T._tempV33,T._tempV34),!0)}},{key:"intersectsPlaneAndBox",value:function(e,t){var n=e.distance,i=e.normal,a=i.x,r=i.y,o=i.z,s=t.min,l=s.x,h=s.y,u=s.z,e=t.max,s=e.x,t=e.y,e=e.z;T._tempV30.x=0<a?l:s,T._tempV30.y=0<r?h:t,T._tempV30.z=0<o?u:e,T._tempV31.x=0<a?s:l,T._tempV31.y=0<r?t:h,T._tempV31.z=0<o?e:u;u=vn.dot(i,T._tempV30);return 0<u+n?Da.PlaneIntersectionType_Front:vn.dot(i,T._tempV31)+n<0?Da.PlaneIntersectionType_Back:Da.PlaneIntersectionType_Intersecting}},{key:"intersectsPlaneAndSphere",value:function(e,t){var n=t.radius,e=vn.dot(e.normal,t.center)+e.distance;return n<e?Da.PlaneIntersectionType_Front:e<-n?Da.PlaneIntersectionType_Back:Da.PlaneIntersectionType_Intersecting}},{key:"intersectsBoxAndBox",value:function(e,t){var n=e.min,i=e.max,e=t.min,t=t.max;return!(n.x>t.x||e.x>i.x)&&(!(n.y>t.y||e.y>i.y)&&!(n.z>t.z||e.z>i.z))}},{key:"intersectsBoxAndSphere",value:function(e,t){var n=t.center,t=t.radius;return vn.Clamp(n,e.min,e.max,T._tempV30),vn.distanceSquared(n,T._tempV30)<=t*t}},{key:"intersectsSphereAndSphere",value:function(e,t){var n=e.radius+t.radius;return vn.distanceSquared(e.center,t.center)<=n*n}},{key:"boxContainsPoint",value:function(e,t){var n=e.min,e=e.max;return n.x<=t.x&&e.x>=t.x&&n.y<=t.y&&e.y>=t.y&&n.z<=t.z&&e.z>=t.z?Oa.Contains:Oa.Disjoint}},{key:"boxContainsBox",value:function(e,t){var n=e.min,i=n.x,a=n.y,r=n.z,o=e.max,s=o.x,l=o.y,h=o.z,u=t.min,d=u.x,n=u.y,e=u.z,o=t.max,u=o.x,t=o.y,o=o.z;return s<d||u<i||l<n||t<a||h<e||o<r?Oa.Disjoint:i<=d&&u<=s&&a<=n&&t<=l&&r<=e&&o<=h?Oa.Contains:Oa.Intersects}},{key:"boxContainsSphere",value:function(e,t){var n=e.min,i=n.x,a=n.y,r=n.z,o=e.max,s=o.x,l=o.y,h=o.z,u=t.center,d=u.x,c=u.y,e=u.z,t=t.radius;return vn.Clamp(u,n,o,T._tempV30),t*t<vn.distanceSquared(u,T._tempV30)?Oa.Disjoint:i+t<=d&&d<=s-t&&t<s-i&&a+t<=c&&c<=l-t&&t<l-a&&r+t<=e&&e<=h-t&&t<h-r?Oa.Contains:Oa.Intersects}},{key:"sphereContainsPoint",value:function(e,t){return vn.distanceSquared(t,e.center)<=e.radius*e.radius?Oa.Contains:Oa.Disjoint}},{key:"sphereContainsTriangle",value:function(e,t,n,i){var a=T.sphereContainsPoint(e,t),r=T.sphereContainsPoint(e,n),o=T.sphereContainsPoint(e,i);return a==Oa.Contains&&r==Oa.Contains&&o==Oa.Contains?Oa.Contains:T.intersectsSphereAndTriangle(e,t,n,i)?Oa.Intersects:Oa.Disjoint}},{key:"sphereContainsBox",value:function(e,t){var n=e.center,i=(n.x,n.y,n.z,e.radius),a=t.min,r=(a.x,a.y,a.z,t.max),n=(r.x,r.y),a=r.z,r=T._tempV30;r.x,r.y,r.z;if(!T.intersectsBoxAndSphere(t,e))return Oa.Disjoint;i*=i;return vn.scalarLengthSquared(T._tempV30)>i||vn.scalarLengthSquared(T._tempV30)>i?Oa.Intersects:vn.scalarLengthSquared(T._tempV30)>i?Oa.Intersects:vn.scalarLengthSquared(T._tempV30)>i?Oa.Intersects:vn.scalarLengthSquared(T._tempV30)>i?Oa.Intersects:vn.scalarLengthSquared(T._tempV30)>i?Oa.Intersects:vn.scalarLengthSquared(T._tempV30)>i?Oa.Intersects:vn.scalarLengthSquared(T._tempV30)>i?Oa.Intersects:Oa.Contains}},{key:"sphereContainsSphere",value:function(e,t){var n=e.radius,i=t.radius,t=vn.distance(e.center,t.center);return n+i<t?Oa.Disjoint:n-i<t?Oa.Intersects:Oa.Contains}},{key:"closestPointPointTriangle",value:function(e,t,n,i,a){vn.subtract(n,t,T._tempV30),vn.subtract(i,t,T._tempV31),vn.subtract(e,t,T._tempV32),vn.subtract(e,n,T._tempV33),vn.subtract(e,i,T._tempV34);var r=vn.dot(T._tempV30,T._tempV32),o=vn.dot(T._tempV31,T._tempV32),s=vn.dot(T._tempV30,T._tempV33),l=vn.dot(T._tempV31,T._tempV33),h=vn.dot(T._tempV30,T._tempV34),u=vn.dot(T._tempV31,T._tempV34);if(r<=0&&o<=0)t.cloneTo(a);else if(0<=s&&l<=s)n.cloneTo(a);else{var d=r*l-s*o;if(d<=0&&0<=r&&s<=0){e=r/(r-s);return vn.scale(T._tempV30,e,a),void vn.add(t,a,a)}if(0<=u&&h<=u)i.cloneTo(a);else{r=h*o-r*u;if(r<=0&&0<=o&&u<=0){var c=o/(o-u);return vn.scale(T._tempV31,c,a),void vn.add(t,a,a)}c=s*u-h*l;if(c<=0&&0<=l-s&&0<=h-u){u=(l-s)/(l-s+(h-u));return vn.subtract(i,n,a),vn.scale(a,u,a),void vn.add(n,a,a)}c=1/(c+r+d),r=r*c,c=d*c;vn.scale(T._tempV30,r,T._tempV35),vn.scale(T._tempV31,c,T._tempV36),vn.add(T._tempV35,T._tempV36,a),vn.add(t,a,a)}}}},{key:"closestPointPlanePoint",value:function(e,t,n){var i=e.normal,e=vn.dot(i,t)-e.distance;vn.scale(i,e,T._tempV30),vn.subtract(t,T._tempV30,n)}},{key:"closestPointBoxPoint",value:function(e,t,n){vn.max(t,e.min,T._tempV30),vn.min(T._tempV30,e.max,n)}},{key:"closestPointSpherePoint",value:function(e,t,n){var i=e.center;vn.subtract(t,i,n),vn.normalize(n,n),vn.scale(n,e.radius,n),vn.add(n,i,n)}},{key:"closestPointSphereSphere",value:function(e,t,n){var i=e.center;vn.subtract(t.center,i,n),vn.normalize(n,n),vn.scale(n,e.radius,n),vn.add(n,i,n)}}]),T}();Pa._tempV30=new vn,Pa._tempV31=new vn,Pa._tempV32=new vn,Pa._tempV33=new vn,Pa._tempV34=new vn,Pa._tempV35=new vn,Pa._tempV36=new vn;var Fa=function(){function h(e){S(this,h),this._matrix=e,this._near=new Da(new vn),this._far=new Da(new vn),this._left=new Da(new vn),this._right=new Da(new vn),this._top=new Da(new vn),this._bottom=new Da(new vn),h._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}return C(h,[{key:"equalsBoundFrustum",value:function(e){return this._matrix.equalsOtherMatrix(e.matrix)}},{key:"equalsObj",value:function(e){return e instanceof h&&this.equalsBoundFrustum(e)}},{key:"getPlane",value:function(e){switch(e){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}}},{key:"getCorners",value:function(e){h._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(e[0]),h._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(e[1]),h._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(e[2]),h._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(e[3]),h._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(e[4]),h._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(e[5]),h._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(e[6]),h._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(e[7])}},{key:"containsPoint",value:function(e){for(var t=Da.PlaneIntersectionType_Front,n=Da.PlaneIntersectionType_Front,i=0;i<6;i++){switch(i){case 0:n=Pa.intersectsPlaneAndPoint(this._near,e);break;case 1:n=Pa.intersectsPlaneAndPoint(this._far,e);break;case 2:n=Pa.intersectsPlaneAndPoint(this._left,e);break;case 3:n=Pa.intersectsPlaneAndPoint(this._right,e);break;case 4:n=Pa.intersectsPlaneAndPoint(this._top,e);break;case 5:n=Pa.intersectsPlaneAndPoint(this._bottom,e)}switch(n){case Da.PlaneIntersectionType_Back:return Oa.Disjoint;case Da.PlaneIntersectionType_Intersecting:t=Da.PlaneIntersectionType_Intersecting}}return t!==Da.PlaneIntersectionType_Intersecting?Oa.Contains:Oa.Intersects}},{key:"intersects",value:function(e){var t=e.min,n=e.max,i=t.x,a=t.y,r=t.z,o=n.x,e=n.y,t=n.z,n=this._near.normal;if(this._near.distance+n.x*(n.x<0?i:o)+n.y*(n.y<0?a:e)+n.z*(n.z<0?r:t)<0)return!1;n=this._left.normal;if(this._left.distance+n.x*(n.x<0?i:o)+n.y*(n.y<0?a:e)+n.z*(n.z<0?r:t)<0)return!1;n=this._right.normal;if(this._right.distance+n.x*(n.x<0?i:o)+n.y*(n.y<0?a:e)+n.z*(n.z<0?r:t)<0)return!1;n=this._bottom.normal;if(this._bottom.distance+n.x*(n.x<0?i:o)+n.y*(n.y<0?a:e)+n.z*(n.z<0?r:t)<0)return!1;n=this._top.normal;if(this._top.distance+n.x*(n.x<0?i:o)+n.y*(n.y<0?a:e)+n.z*(n.z<0?r:t)<0)return!1;n=this._far.normal;return!(this._far.distance+n.x*(n.x<0?i:o)+n.y*(n.y<0?a:e)+n.z*(n.z<0?r:t)<0)}},{key:"containsBoundBox",value:function(e){for(var t=h._tempV30,n=h._tempV31,i=e.min,a=e.max,r=Oa.Contains,o=0;o<6;o++){var s=this.getPlane(o),l=s.normal;if(0<=l.x?(t.x=a.x,n.x=i.x):(t.x=i.x,n.x=a.x),0<=l.y?(t.y=a.y,n.y=i.y):(t.y=i.y,n.y=a.y),0<=l.z?(t.z=a.z,n.z=i.z):(t.z=i.z,n.z=a.z),Pa.intersectsPlaneAndPoint(s,t)===Da.PlaneIntersectionType_Back)return Oa.Disjoint;Pa.intersectsPlaneAndPoint(s,n)===Da.PlaneIntersectionType_Back&&(r=Oa.Intersects)}return r}},{key:"containsBoundSphere",value:function(e){for(var t=Da.PlaneIntersectionType_Front,n=Da.PlaneIntersectionType_Front,i=0;i<6;i++){switch(i){case 0:n=Pa.intersectsPlaneAndSphere(this._near,e);break;case 1:n=Pa.intersectsPlaneAndSphere(this._far,e);break;case 2:n=Pa.intersectsPlaneAndSphere(this._left,e);break;case 3:n=Pa.intersectsPlaneAndSphere(this._right,e);break;case 4:n=Pa.intersectsPlaneAndSphere(this._top,e);break;case 5:n=Pa.intersectsPlaneAndSphere(this._bottom,e)}switch(n){case Da.PlaneIntersectionType_Back:return Oa.Disjoint;case Da.PlaneIntersectionType_Intersecting:t=Da.PlaneIntersectionType_Intersecting}}return t!==Da.PlaneIntersectionType_Intersecting?Oa.Contains:Oa.Intersects}},{key:"matrix",get:function(){return this._matrix},set:function(e){this._matrix=e,h._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}},{key:"near",get:function(){return this._near}},{key:"far",get:function(){return this._far}},{key:"left",get:function(){return this._left}},{key:"right",get:function(){return this._right}},{key:"top",get:function(){return this._top}},{key:"bottom",get:function(){return this._bottom}}],[{key:"_getPlanesFromMatrix",value:function(e,t,n,i,a,r,o){var s=e.elements,l=s[0],h=s[1],u=s[2],d=s[3],c=s[4],_=s[5],f=s[6],g=s[7],y=s[8],v=s[9],p=s[10],m=s[11],w=s[12],x=s[13],k=s[14],e=s[15],s=t.normal;s.x=d+u,s.y=g+f,s.z=m+p,t.distance=e+k,t.normalize();t=n.normal;t.x=d-u,t.y=g-f,t.z=m-p,n.distance=e-k,n.normalize();n=i.normal;n.x=d+l,n.y=g+c,n.z=m+y,i.distance=e+w,i.normalize();i=a.normal;i.x=d-l,i.y=g-c,i.z=m-y,a.distance=e-w,a.normalize();a=r.normal;a.x=d-h,a.y=g-_,a.z=m-v,r.distance=e-x,r.normalize();r=o.normal;r.x=d+h,r.y=g+_,r.z=m+v,o.distance=e+x,o.normalize()}},{key:"_get3PlaneInterPoint",value:function(e,t,n){var i=e.normal,a=t.normal,r=n.normal;vn.cross(a,r,h._tempV30),vn.cross(r,i,h._tempV31),vn.cross(i,a,h._tempV32);i=vn.dot(i,h._tempV30),a=vn.dot(a,h._tempV31),r=vn.dot(r,h._tempV32);return vn.scale(h._tempV30,-e.distance/i,h._tempV33),vn.scale(h._tempV31,-t.distance/a,h._tempV34),vn.scale(h._tempV32,-n.distance/r,h._tempV35),vn.add(h._tempV33,h._tempV34,h._tempV36),vn.add(h._tempV35,h._tempV36,h._tempV37),h._tempV37}}]),h}();Fa._tempV30=new vn,Fa._tempV31=new vn,Fa._tempV32=new vn,Fa._tempV33=new vn,Fa._tempV34=new vn,Fa._tempV35=new vn,Fa._tempV36=new vn,Fa._tempV37=new vn;var Ba=function(){function r(e,t,n,i){S(this,r),this.minDepth=0,this.maxDepth=1,this.x=e,this.y=t,this.width=n,this.height=i}return C(r,[{key:"project",value:function(e,t,n){var i=e.x,a=e.y,r=e.z;vn.transformV3ToV3(e,t,n);t=t.elements,t=i*t[3]+a*t[7]+r*t[11]+t[15];1!==t&&(n.x=n.x/t,n.y=n.y/t,n.z=n.z/t),n.x=.5*(n.x+1)*this.width+this.x,n.y=.5*(1-n.y)*this.height+this.y,n.z=n.z*(this.maxDepth-this.minDepth)+this.minDepth}},{key:"unprojectFromMat",value:function(e,t,n){var i=t.elements;n.x=(e.x-this.x)/this.width*2-1,n.y=-((e.y-this.y)/this.height*2-1);var a=(this.maxDepth-this.minDepth)/2;n.z=(e.z-this.minDepth-a)/a;i=n.x*i[3]+n.y*i[7]+n.z*i[11]+i[15];vn.transformV3ToV3(n,t,n),1!==i&&(n.x=n.x/i,n.y=n.y/i,n.z=n.z/i)}},{key:"unprojectFromWVP",value:function(e,t,n,i,a){ki.multiply(t,n,r._tempMatrix4x4),i&&ki.multiply(r._tempMatrix4x4,i,r._tempMatrix4x4),r._tempMatrix4x4.invert(r._tempMatrix4x4),this.unprojectFromMat(e,r._tempMatrix4x4,a)}},{key:"cloneTo",value:function(e){e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e.minDepth=this.minDepth,e.maxDepth=this.maxDepth}}]),r}();Ba._tempMatrix4x4=new ki;var Va=function(){T(h,U);var a=b(h);function h(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:H.R8G8B8,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Y.DEPTH_16;return S(this,h),(n=a.call(this,n,!1))._inPool=!1,n._glTextureType=P.instance.TEXTURE_2D,n._width=e,n._height=t,n._depthStencilFormat=i,n._create(e,t),n}return C(h,[{key:"_texImage2D",value:function(e,t,n,i){switch(this._format){case H.R8G8B8:e.texImage2D(t,0,e.RGB,n,i,0,e.RGB,e.UNSIGNED_BYTE,null);break;case H.R8G8B8A8:e.texImage2D(t,0,e.RGBA,n,i,0,e.RGBA,e.UNSIGNED_BYTE,null);break;case H.Alpha8:e.texImage2D(t,0,e.ALPHA,n,i,0,e.ALPHA,e.UNSIGNED_BYTE,null);break;case H.R16G16B16A16:P.layaGPUInstance._isWebGL2?e.texImage2D(this._glTextureType,0,e.RGBA16F,n,i,0,e.RGBA,e.HALF_FLOAT,null):e.texImage2D(this._glTextureType,0,e.RGBA,n,i,0,e.RGBA,P.layaGPUInstance._oesTextureHalfFloat.HALF_FLOAT_OES,null)}}},{key:"_create",value:function(e,t){var n=P.instance;if(this._frameBuffer=n.createFramebuffer(),y.bindTexture(n,this._glTextureType,this._glTexture),this._texImage2D(n,this._glTextureType,e,t),this._setGPUMemory(e*t*4),n.bindFramebuffer(n.FRAMEBUFFER,this._frameBuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this._glTexture,0),this._depthStencilFormat!==Y.DEPTHSTENCIL_NONE)switch(this._depthStencilBuffer=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this._depthStencilBuffer),this._depthStencilFormat){case Y.DEPTH_16:n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this._depthStencilBuffer);break;case Y.STENCIL_8:n.renderbufferStorage(n.RENDERBUFFER,n.STENCIL_INDEX8,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,this._depthStencilBuffer);break;case Y.DEPTHSTENCIL_16_8:n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this._depthStencilBuffer);break;default:throw"RenderTexture: unkonw depth format."}n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindRenderbuffer(n.RENDERBUFFER,null),this._setWarpMode(n.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(n.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()}},{key:"_start",value:function(){var e=P.instance;e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),(h._currentActive=this)._readyed=!1}},{key:"_end",value:function(){var e=P.instance;e.bindFramebuffer(e.FRAMEBUFFER,null),h._currentActive=null,this._readyed=!0}},{key:"getData",value:function(e,t,n,i,a){if(yt.isConchApp&&2==window.conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var r=P.instance;return r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE?(r.readPixels(e,t,n,i,r.RGBA,r.UNSIGNED_BYTE,a),r.bindFramebuffer(r.FRAMEBUFFER,null),a):(r.bindFramebuffer(r.FRAMEBUFFER,null),null)}},{key:"getDataAsync",value:function(e,t,n,i,a){var r=P.instance;r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),r.readPixelsAsync(e,t,n,i,r.RGBA,r.UNSIGNED_BYTE,function(e){a(new Uint8Array(e))}),r.bindFramebuffer(r.FRAMEBUFFER,null)}},{key:"_disposeResource",value:function(){var e;this._frameBuffer&&((e=P.instance).deleteTexture(this._glTexture),e.deleteFramebuffer(this._frameBuffer),e.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0))}},{key:"depthStencilFormat",get:function(){return this._depthStencilFormat}},{key:"defaulteTexture",get:function(){return X.grayTexture}}],[{key:"createFromPool",value:function(e,t){for(var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:H.R8G8B8,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Y.DEPTH_16,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:U.FILTERMODE_BILINEAR,o=0,s=h._pool.length;o<s;o++)if((n=h._pool[o])._width==e&&n._height==t&&n._format==i&&n._depthStencilFormat==a&&n._filterMode==r){n._inPool=!1;var l=h._pool[s-1];return h._pool[o]=l,--h._pool.length,n}return(n=new h(e,t,i,a)).filterMode=r,n.lock=!0,n}},{key:"recoverToPool",value:function(e){e._inPool||(h._pool.push(e),e._inPool=!0)}},{key:"currentActive",get:function(){return h._currentActive}}]),h}();Va._pool=[];var Ua=function(){function u(){S(this,u)}return C(u,null,[{key:"calculateCursorRay",value:function(e,t,n,i,a,r){var o=e.x,s=e.y,l=u._tempVector30,h=l;h.x=o,h.y=s,h.z=t.minDepth;e=u._tempVector31,h=e;h.x=o,h.y=s,h.z=t.maxDepth;s=r.origin,h=u._tempVector32;t.unprojectFromWVP(l,n,i,a,s),t.unprojectFromWVP(e,n,i,a,h);a=r.direction;a.x=h.x-s.x,a.y=h.y-s.y,a.z=h.z-s.z,vn.normalize(r.direction,r.direction)}},{key:"rayIntersectsTriangle",value:function(e,t,n,i){var a=u._tempVector30,r=u._tempVector31;vn.subtract(n,t,a),vn.subtract(i,t,r);var o=u._tempVector32;if(vn.cross(e.direction,r,o),(n=vn.dot(a,o))>-Number.MIN_VALUE&&n<Number.MIN_VALUE)return Number.NaN;i=1/n,n=u._tempVector33;if(vn.subtract(e.origin,t,n),t=vn.dot(n,o),(t*=i)<0||1<t)return Number.NaN;o=u._tempVector34;return vn.cross(n,a,o),e=vn.dot(e.direction,o),(e*=i)<0||1<t+e?Number.NaN:(o=vn.dot(r,o),(o*=i)<0?Number.NaN:o)}}]),u}();Ua._tempVector30=new vn,Ua._tempVector31=new vn,Ua._tempVector32=new vn,Ua._tempVector33=new vn,Ua._tempVector34=new vn;var za=function(){function e(){S(this,e)}return C(e,null,[{key:"supportTextureFormat",value:function(e){return e!==f.R32G32B32A32||!(!P.layaGPUInstance._isWebGL2&&!P.layaGPUInstance._oesTextureFloat)}},{key:"supportRenderTextureFormat",value:function(e){return e!==H.R16G16B16A16||!!(P.layaGPUInstance._isWebGL2||P.layaGPUInstance._oesTextureHalfFloat||P.layaGPUInstance._oesTextureHalfFloatLinear)}}]),e}(),Ga=function(){T(t,Se);var e=b(t);function t(){return S(this,t),e.call(this)}return C(t,[{key:"applyVertexBuffer",value:function(e){if(Se._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";var t,n=P.instance,i=e.vertexDeclaration,a=i._shaderValues.getData();for(t in this.vertexDeclaration=i,e.bind(),a){var r=parseInt(t),o=a[t];n.enableVertexAttribArray(r),n.vertexAttribPointer(r,o[0],o[1],!!o[2],o[3],o[4])}}},{key:"applyVertexBuffers",value:function(e){if(Se._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";for(var t=P.instance,n=0,i=e.length;n<i;n++){var a,r=e[n],o=r.vertexDeclaration._shaderValues.getData();for(a in r.bind(),o){var s=parseInt(a),l=o[a];t.enableVertexAttribArray(s),t.vertexAttribPointer(s,l[0],l[1],!!l[2],l[3],l[4])}}}},{key:"applyInstanceVertexBuffer",value:function(e){if(P.layaGPUInstance.supportInstance()){if(Se._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";var t,n=P.instance,i=e.vertexDeclaration._shaderValues.getData();for(t in e.bind(),i){var a=parseInt(t),r=i[t];n.enableVertexAttribArray(a),n.vertexAttribPointer(a,r[0],r[1],!!r[2],r[3],r[4]),P.layaGPUInstance.vertexAttribDivisor(a,1)}}}},{key:"applyIndexBuffer",value:function(e){if(Se._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";this._bindedIndexBuffer!==e&&(e._bindForVAO(),this._bindedIndexBuffer=e)}}]),t}(),Xa=function(){T(s,Ne);var o=b(s);function s(e,t){var n,i,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:35044,r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(S(this,s),(n=o.call(this))._indexType=e,n._indexCount=t,n._bufferUsage=a,n._bufferType=P.instance.ELEMENT_ARRAY_BUFFER,n._canRead=r,e==s.INDEXTYPE_USHORT)n._indexTypeByteCount=2;else{if(e!=s.INDEXTYPE_UBYTE)throw new Error("unidentification index type.");n._indexTypeByteCount=1}i=n._indexTypeByteCount*t,n._byteLength=i;a=Se._curBindedBufferState;return a?a._bindedIndexBuffer===u(n)?P.instance.bufferData(n._bufferType,i,n._bufferUsage):(a.unBind(),n.bind(),P.instance.bufferData(n._bufferType,i,n._bufferUsage),a.bind()):(n.bind(),P.instance.bufferData(n._bufferType,i,n._bufferUsage)),r&&(e==s.INDEXTYPE_USHORT?n._buffer=new Uint16Array(t):e==s.INDEXTYPE_UBYTE&&(n._buffer=new Uint8Array(t))),n}return C(s,[{key:"_bindForVAO",value:function(){if(!Se._curBindedBufferState)throw"IndexBuffer3D: must bind current BufferState.";var e=P.instance;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._glBuffer)}},{key:"bind",value:function(){if(Se._curBindedBufferState)throw"IndexBuffer3D: must unbind current BufferState.";if(Ne._bindedIndexBuffer===this._glBuffer)return!1;var e=P.instance;return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._glBuffer),Ne._bindedIndexBuffer=this._glBuffer,!0}},{key:"setData",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:4294967295;this._indexType==s.INDEXTYPE_USHORT?(t=2,0===i&&4294967295===a||(e=new Uint16Array(e.buffer,i*t,a))):this._indexType==s.INDEXTYPE_UBYTE&&(t=1,0===i&&4294967295===a||(e=new Uint8Array(e.buffer,i*t,a)));var r=Se._curBindedBufferState;if(r?r._bindedIndexBuffer===this?P.instance.bufferSubData(this._bufferType,n*t,e):(r.unBind(),this.bind(),P.instance.bufferSubData(this._bufferType,n*t,e),r.bind()):(this.bind(),P.instance.bufferSubData(this._bufferType,n*t,e)),this._canRead)if(0!==n||0!==i||4294967295!==a){i=this._buffer.length-n;i<a&&(a=i);for(var o=0;o<a;o++)this._buffer[n+o]=e[o]}else this._buffer=e}},{key:"getData",value:function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")}},{key:"destroy",value:function(){G(z(s.prototype),"destroy",this).call(this),this._buffer=null}},{key:"indexType",get:function(){return this._indexType}},{key:"indexTypeByteCount",get:function(){return this._indexTypeByteCount}},{key:"indexCount",get:function(){return this._indexCount}},{key:"canRead",get:function(){return this._canRead}}]),s}();Xa.INDEXTYPE_UBYTE="ubyte",Xa.INDEXTYPE_USHORT="ushort";var Ha=function(){function e(){S(this,e)}return C(e,[{key:"_render",value:function(e){}}]),e}(),Ya=function(){T(o,Ha);var r=b(o);function o(){var e;S(this,o),e=r.call(this);var t=P.instance,n=new Float32Array([-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1]),i=new Uint8Array([0,1,2,2,3,0,4,7,6,6,5,4,0,3,7,7,4,0,1,5,6,6,2,1,3,2,6,6,7,3,0,4,5,5,1,0]),a=wa.getVertexDeclaration("POSITION");e._vertexBuffer=new Na(8*a.vertexStride,t.STATIC_DRAW,!1),e._vertexBuffer.vertexDeclaration=a,e._indexBuffer=new Xa(Xa.INDEXTYPE_UBYTE,36,t.STATIC_DRAW,!1),e._vertexBuffer.setData(n.buffer),e._indexBuffer.setData(i);i=new Ga;return i.bind(),i.applyVertexBuffer(e._vertexBuffer),i.applyIndexBuffer(e._indexBuffer),i.unBind(),e._bufferState=i,e}return C(o,[{key:"_render",value:function(e){var t=P.instance;t.drawElements(t.TRIANGLES,36,t.UNSIGNED_BYTE,0),J.trianglesFaces+=12,J.renderBatches++}}],[{key:"__init__",value:function(){o.instance=new o}}]),o}(),Wa=function(){function c(){S(this,c),this._mesh=Ya.instance}return C(c,[{key:"_isAvailable",value:function(){return!(!this._material||!this._mesh)}},{key:"_render",value:function(e){var t,n,i,a,r,o,s,l,h,u,d;this._material&&this._mesh&&(t=P.instance,u=e.scene,n=e.camera,i=va._SET_RUNTIME_VALUE_MODE_REFERENCE_,M.Render.supportWebGLPlusRendering&&va.setRuntimeValueMode(!1),y.setCullFace(t,!1),y.setDepthFunc(t,t.LEQUAL),y.setDepthMask(t,!1),l=c._compileDefine,this._material._shaderValues._defineDatas.cloneTo(l),r=(a=e.shader=this._material._shader.getSubShaderAt(0)._passes[0].withCompile(l)).bind(),d=J.loopCount!==a._uploadMark,((h=a._uploadScene!==u||d)||r)&&(a.uploadUniforms(a._sceneUniformParamsMap,u._shaderValues,h),a._uploadScene=u),o=n._getInternalRenderTexture(),((s=a._uploadCamera!==n||d)||r)&&(l=c._tempMatrix0,h=c._tempMatrix1,n.viewMatrix.cloneTo(l),n.projectionMatrix.cloneTo(h),l.setTranslationVector(vn._ZERO),n.orthographic&&ki.createPerspective(n.fieldOfView,n.aspectRatio,n.nearPlane,n.farPlane,h),u=1/Math.tan(3.1416*n.fieldOfView/180*.5),h.elements[0]=u/n.aspectRatio,h.elements[5]=u,h.elements[10]=1e-6-1,h.elements[11]=-1,h.elements[14]=-0,n._applyViewProject(e,l,h,!!o),a.uploadUniforms(a._cameraUniformParamsMap,n._shaderValues,s),a._uploadCamera=n),((d=a._uploadMaterial!==this._material||d)||r)&&(a.uploadUniforms(a._materialUniformParamsMap,this._material._shaderValues,d),a._uploadMaterial=this._material),this._mesh._bufferState.bind(),this._mesh._render(e),M.Render.supportWebGLPlusRendering&&va.setRuntimeValueMode(i),y.setDepthFunc(t,t.LESS),y.setDepthMask(t,!0),n._applyViewProject(e,n.viewMatrix,n.projectionMatrix,!!o))}},{key:"destroy",value:function(){this._material&&(this._material._removeReference(),this._material=null)}},{key:"material",get:function(){return this._material},set:function(e){this._material!==e&&(this._material&&this._material._removeReference(),e&&e._addReference(),this._material=e)}},{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh=e)}}]),c}();Wa._tempMatrix0=new ki,Wa._tempMatrix1=new ki,Wa._compileDefine=new da;var ja=function(){T(a,fa);var i=b(a);function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.3,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;return S(this,a),(e=i.call(this))._skyRenderer=new Wa,e._forward=new vn,e._up=new vn,e.clearColor=new yn(100/255,149/255,237/255,1),e._shaderValues=new va(null),e._fieldOfView=60,e._useUserProjectionMatrix=!1,e._orthographic=!1,e._orthographicVerticalSize=10,e.renderingOrder=0,e._nearPlane=t,e._farPlane=n,e.cullingMask=2147483647,e.clearFlag=a.CLEARFLAG_SOLIDCOLOR,e.useOcclusionCulling=!0,e}return C(a,[{key:"_sortCamerasByRenderingOrder",value:function(){if(this.displayedInStage)for(var e,t=this.scene._cameraPool,n=t.length-1,i=0;i<n;i++)t[i].renderingOrder>t[n].renderingOrder&&(e=t[i],t[i]=t[n],t[n]=e)}},{key:"_calculateProjectionMatrix",value:function(){}},{key:"_onScreenSizeChanged",value:function(){this._calculateProjectionMatrix()}},{key:"_prepareCameraToRender",value:function(){var e=this._shaderValues;this.transform.getForward(this._forward),this.transform.getUp(this._up),e.setVector3(a.CAMERAPOS,this.transform.position),e.setVector3(a.CAMERADIRECTION,this._forward),e.setVector3(a.CAMERAUP,this._up)}},{key:"render",value:function(){}},{key:"addLayer",value:function(e){this.cullingMask|=Math.pow(2,e)}},{key:"removeLayer",value:function(e){this.cullingMask&=~Math.pow(2,e)}},{key:"addAllLayers",value:function(){this.cullingMask=2147483647}},{key:"removeAllLayers",value:function(){this.cullingMask=0}},{key:"resetProjectionMatrix",value:function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()}},{key:"_onActive",value:function(){this._scene._addCamera(this),G(z(a.prototype),"_onActive",this).call(this)}},{key:"_onInActive",value:function(){this._scene._removeCamera(this),G(z(a.prototype),"_onInActive",this).call(this)}},{key:"_parse",value:function(e,t){G(z(a.prototype),"_parse",this).call(this,e,t);t=e.clearFlag;void 0!==t&&(this.clearFlag=t),this.orthographic=e.orthographic,void 0!==e.orthographicVerticalSize&&(this.orthographicVerticalSize=e.orthographicVerticalSize),void 0!==e.fieldOfView&&(this.fieldOfView=e.fieldOfView),this.nearPlane=e.nearPlane,this.farPlane=e.farPlane;t=e.clearColor;this.clearColor=new yn(t[0],t[1],t[2],t[3]);e=e.skyboxMaterial;e&&(this._skyRenderer.material=on.getRes(e.path))}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._skyRenderer.destroy(),this._skyRenderer=null,zn.stage.off(Je.RESIZE,this,this._onScreenSizeChanged),G(z(a.prototype),"destroy",this).call(this,e)}},{key:"_create",value:function(){return new a}},{key:"skyRenderer",get:function(){return this._skyRenderer}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._calculateProjectionMatrix()}},{key:"nearPlane",get:function(){return this._nearPlane},set:function(e){this._nearPlane=e,this._calculateProjectionMatrix()}},{key:"farPlane",get:function(){return this._farPlane},set:function(e){this._farPlane=e,this._calculateProjectionMatrix()}},{key:"orthographic",get:function(){return this._orthographic},set:function(e){this._orthographic=e,this._calculateProjectionMatrix()}},{key:"orthographicVerticalSize",get:function(){return this._orthographicVerticalSize},set:function(e){this._orthographicVerticalSize=e,this._calculateProjectionMatrix()}},{key:"renderingOrder",get:function(){return this._renderingOrder},set:function(e){this._renderingOrder=e,this._sortCamerasByRenderingOrder()}}]),a}();function qa(){S(this,qa)}ja._tempMatrix4x40=new ki,ja.CAMERAPOS=ca.propertyNameToID("u_CameraPos"),ja.VIEWMATRIX=ca.propertyNameToID("u_View"),ja.PROJECTMATRIX=ca.propertyNameToID("u_Projection"),ja.VIEWPROJECTMATRIX=ca.propertyNameToID("u_ViewProjection"),ja.CAMERADIRECTION=ca.propertyNameToID("u_CameraDirection"),ja.CAMERAUP=ca.propertyNameToID("u_CameraUp"),ja.VIEWPORT=ca.propertyNameToID("u_Viewport"),ja.PROJECTION_PARAMS=ca.propertyNameToID("u_ProjectionParams"),ja.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",ja.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",ja.CLEARFLAG_SOLIDCOLOR=0,ja.CLEARFLAG_SKY=1,ja.CLEARFLAG_DEPTHONLY=2,ja.CLEARFLAG_NONE=3,ja._invertYScaleMatrix=new ki(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1),ja._invertYProjectionMatrix=new ki,ja._invertYProjectionViewMatrix=new ki,qa._instance=new qa;var Za=function(){T(i,V);var n=b(i);function i(){var e;S(this,i),(e=n.call(this))._bufferState=new Ga,e._bufferStateInvertUV=new Ga;var t=P.instance;return e._vertexBuffer=new Na(64,t.STATIC_DRAW,!1),e._vertexBuffer.vertexDeclaration=i._vertexDeclaration,e._vertexBuffer.setData(i._vertices.buffer),e._bufferState.bind(),e._bufferState.applyVertexBuffer(e._vertexBuffer),e._bufferState.unBind(),e._vertexBufferInvertUV=new Na(64,t.STATIC_DRAW,!1),e._vertexBufferInvertUV.vertexDeclaration=i._vertexDeclaration,e._vertexBufferInvertUV.setData(i._verticesInvertUV.buffer),e._bufferStateInvertUV.bind(),e._bufferStateInvertUV.applyVertexBuffer(e._vertexBufferInvertUV),e._bufferStateInvertUV.unBind(),e._setGPUMemory(e._vertexBuffer._byteLength+e._vertexBufferInvertUV._byteLength),e}return C(i,[{key:"render",value:function(){var e=P.instance;this._bufferState.bind(),e.drawArrays(e.TRIANGLE_STRIP,0,4),J.renderBatches++}},{key:"renderInvertUV",value:function(){var e=P.instance;this._bufferStateInvertUV.bind(),e.drawArrays(e.TRIANGLE_STRIP,0,4),J.renderBatches++}},{key:"destroy",value:function(){G(z(i.prototype),"destroy",this).call(this),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._bufferStateInvertUV.destroy(),this._vertexBufferInvertUV.destroy(),this._setGPUMemory(0)}}],[{key:"__init__",value:function(){i._vertexDeclaration=new pa(16,[new ma(0,ya.Vector4,i.SCREENQUAD_POSITION_UV)]),(i.instance=new i).lock=!0}}]),i}();Za.SCREENQUAD_POSITION_UV=0,Za._vertices=new Float32Array([1,1,1,0,1,-1,1,1,-1,1,0,0,-1,-1,0,1]),Za._verticesInvertUV=new Float32Array([1,1,1,1,1,-1,1,0,-1,1,0,1,-1,-1,0,0]);var Ka=function(){T(i,V);var n=b(i);function i(){var e;S(this,i),(e=n.call(this))._bufferState=new Ga,e._bufferStateInvertUV=new Ga;var t=P.instance;return e._vertexBuffer=new Na(48,t.STATIC_DRAW,!1),e._vertexBuffer.vertexDeclaration=i._vertexDeclaration,e._vertexBuffer.setData(i._vertices.buffer),e._bufferState.bind(),e._bufferState.applyVertexBuffer(e._vertexBuffer),e._bufferState.unBind(),e._vertexBufferInvertUV=new Na(48,t.STATIC_DRAW,!1),e._vertexBufferInvertUV.vertexDeclaration=i._vertexDeclaration,e._vertexBufferInvertUV.setData(i._verticesInvertUV.buffer),e._bufferStateInvertUV.bind(),e._bufferStateInvertUV.applyVertexBuffer(e._vertexBufferInvertUV),e._bufferStateInvertUV.unBind(),e._setGPUMemory(e._vertexBuffer._byteLength+e._vertexBufferInvertUV._byteLength),e}return C(i,[{key:"render",value:function(){var e=P.instance;this._bufferState.bind(),e.drawArrays(e.TRIANGLES,0,3),J.renderBatches++}},{key:"renderInvertUV",value:function(){var e=P.instance;this._bufferStateInvertUV.bind(),e.drawArrays(e.TRIANGLES,0,3),J.renderBatches++}},{key:"destroy",value:function(){G(z(i.prototype),"destroy",this).call(this),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._bufferStateInvertUV.destroy(),this._vertexBufferInvertUV.destroy(),this._setGPUMemory(0)}}],[{key:"__init__",value:function(){i._vertexDeclaration=new pa(16,[new ma(0,ya.Vector4,i.SCREENTRIANGLE_POSITION_UV)]),(i.instance=new i).lock=!0}}]),i}();Ka.SCREENTRIANGLE_POSITION_UV=0,Ka._vertices=new Float32Array([-1,-1,0,1,-1,3,0,-1,3,-1,2,1]),Ka._verticesInvertUV=new Float32Array([-1,-1,0,0,-1,3,0,2,3,-1,2,0]);var Qa=function(){function e(){S(this,e),this._commandBuffer=null}return C(e,[{key:"run",value:function(){}},{key:"recover",value:function(){this._commandBuffer=null}}],[{key:"__init__",value:function(){e._screenShaderData=new va,e._screenShader=ca.find("BlitScreen")}}]),e}();Qa.SCREENTEXTURE_NAME="u_MainTex",Qa.MAINTEXTURE_TEXELSIZE_NAME="u_MainTex_TexelSize",Qa.SCREENTEXTURE_ID=ca.propertyNameToID(Qa.SCREENTEXTURE_NAME),Qa.MAINTEXTURE_TEXELSIZE_ID=ca.propertyNameToID(Qa.MAINTEXTURE_TEXELSIZE_NAME);var Ja=function(){T(s,Qa);var t=b(s);function s(){var e;return S(this,s),(e=t.apply(this,arguments))._source=null,e._dest=null,e._shader=null,e._shaderData=null,e._subShader=0,e._sourceTexelSize=new yn,e._screenType=0,e}return C(s,[{key:"run",value:function(){var e=this._shader||Qa._screenShader,t=this._shaderData||Qa._screenShaderData,n=this._dest;P.instance.viewport(0,0,n?n.width:qa.clientWidth,n?n.height:qa.clientHeight),t.setTexture(Qa.SCREENTEXTURE_ID,this._source),this._sourceTexelSize.setValue(1/this._source.width,1/this._source.height,this._source.width,this._source.height),t.setVector(Qa.MAINTEXTURE_TEXELSIZE_ID,this._sourceTexelSize),n&&n._start();for(var i=e.getSubShaderAt(this._subShader)._passes,a=0,r=i.length;a<r;a++){var o=s._compileDefine;t._defineDatas.cloneTo(o);o=i[a].withCompile(o);switch(o.bind(),o.uploadUniforms(o._materialUniformParamsMap,t,!0),o.uploadRenderStateBlendDepth(t),o.uploadRenderStateFrontFace(t,!1,null),this._screenType){case s._SCREENTYPE_QUAD:n?Za.instance.renderInvertUV():Za.instance.render();break;case s._SCREENTYPE_TRIANGLE:n?Ka.instance.renderInvertUV():Ka.instance.render()}}n&&n._end()}},{key:"recover",value:function(){s._pool.push(this),this._dest=null,this._shader=null,this._shaderData=null,G(z(s.prototype),"recover",this).call(this)}}],[{key:"create",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:s._SCREENTYPE_QUAD,o=0<s._pool.length?s._pool.pop():new s;return o._source=e,o._dest=t,o._shader=n,o._shaderData=i,o._subShader=a,o._screenType=r,o}}]),s}();Ja._SCREENTYPE_QUAD=0,Ja._SCREENTYPE_TRIANGLE=1,Ja._compileDefine=new da,Ja._pool=[];var $a=function(){T(n,Qa);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments))._renderTexture=null,e}return C(n,[{key:"run",value:function(){this._renderTexture._start()}},{key:"recover",value:function(){n._pool.push(this),this._renderTexture=null}}],[{key:"create",value:function(e){var t=0<n._pool.length?n._pool.pop():new n;return t._renderTexture=e,t}}]),n}();$a._pool=[];var er=function(){T(a,Qa);var t=b(a);function a(){var e;return S(this,a),(e=t.apply(this,arguments))._shaderData=null,e._nameID=0,e._texture=null,e}return C(a,[{key:"run",value:function(){this._shaderData.setTexture(this._nameID,this._texture)}},{key:"recover",value:function(){a._pool.push(this),this._shaderData=null,this._nameID=0,this._texture=null}}],[{key:"create",value:function(e,t,n){var i=0<a._pool.length?a._pool.pop():new a;return i._shaderData=e,i._nameID=t,i._texture=n,i}}]),a}();er._pool=[];var tr=function(){function e(){S(this,e),this._camera=null,this._commands=[]}return C(e,[{key:"_apply",value:function(){for(var e=0,t=this._commands.length;e<t;e++)this._commands[e].run()}},{key:"setShaderDataTexture",value:function(e,t,n){this._commands.push(er.create(e,t,n))}},{key:"blitScreenQuad",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;this._commands.push(Ja.create(e,t,n,i,a,Ja._SCREENTYPE_QUAD))}},{key:"blitScreenTriangle",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;this._commands.push(Ja.create(e,t,n,i,a,Ja._SCREENTYPE_TRIANGLE))}},{key:"setRenderTarget",value:function(e){this._commands.push($a.create(e))}},{key:"clear",value:function(){for(var e=0,t=this._commands.length;e<t;e++)this._commands[e].recover();this._commands.length=0}}]),e}(),nr=function e(){S(this,e)},ir=function(){T(c,ja);var i=b(c);function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.3,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1e3;return S(this,c),(n=i.call(this,t,n))._updateViewMatrix=!0,n._postProcess=null,n._enableHDR=!1,n._viewportParams=new yn,n._projectionParams=new yn,n._offScreenRenderTexture=null,n._renderTexture=null,n._postProcessCommandBuffers=[],n._clusterPlaneCacheFlag=new gn(-1,-1),n.enableRender=!0,n._viewMatrix=new ki,n._projectionMatrix=new ki,n._projectionViewMatrix=new ki,n._viewport=new Ba(0,0,0,0),n._normalizedViewport=new Ba(0,0,1,1),n._aspectRatio=e,n._boundFrustum=new Fa(ki.DEFAULT),yt.supportWebGLPlusCulling&&(n._boundFrustumBuffer=new Float32Array(24)),n._calculateProjectionMatrix(),zn.stage.on(Je.RESIZE,u(n),n._onScreenSizeChanged),n.transform.on(Je.TRANSFORM_CHANGED,u(n),n._onTransformChanged),n}return C(c,[{key:"_calculationViewport",value:function(e,t,n){var i=e.x*t,a=e.y*n,r=i+Math.max(e.width*t,0),o=a+Math.max(e.height*n,0),s=Math.ceil(i),t=Math.ceil(a),e=Math.floor(r),n=Math.floor(o),s=.5<=s-i?Math.floor(i):s,t=.5<=t-a?Math.floor(a):t,e=.5<=r-e?Math.ceil(r):e,n=.5<=o-n?Math.ceil(o):n;this._viewport.x=s,this._viewport.y=t,this._viewport.width=e-s,this._viewport.height=n-t}},{key:"_calculateProjectionMatrix",value:function(){var e,t;this._useUserProjectionMatrix||(this._orthographic?(t=(e=.5*this.orthographicVerticalSize)*this.aspectRatio,ki.createOrthoOffCenter(-t,t,-e,e,this.nearPlane,this.farPlane,this._projectionMatrix)):ki.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix))}},{key:"_isLayerVisible",value:function(e){return 0!=(Math.pow(2,e)&this.cullingMask)}},{key:"_onTransformChanged",value:function(e){(e&=_a.TRANSFORM_WORLDMATRIX)&&(this._updateViewMatrix=!0)}},{key:"_parse",value:function(e,t){G(z(c.prototype),"_parse",this).call(this,e,t);t=e.viewport;this.normalizedViewport=new Ba(t[0],t[1],t[2],t[3]);e=e.enableHDR;void 0!==e&&(this.enableHDR=e)}},{key:"_getCanvasHeight",value:function(){return this._offScreenRenderTexture?this._offScreenRenderTexture.height:qa.clientHeight}},{key:"_getInternalRenderTexture",value:function(){return this._renderTexture||this._offScreenRenderTexture}},{key:"_applyPostProcessCommandBuffers",value:function(){for(var e=0,t=this._postProcessCommandBuffers.length;e<t;e++)this._postProcessCommandBuffers[e]._apply()}},{key:"_getRenderTextureFormat",value:function(){return this._enableHDR?H.R16G16B16A16:H.R8G8B8}},{key:"_prepareCameraToRender",value:function(){G(z(c.prototype),"_prepareCameraToRender",this).call(this);var e=this.viewport;this._viewportParams.setValue(e.x,e.y,e.width,e.height),this._projectionParams.setValue(this._nearPlane,this._farPlane,this._getInternalRenderTexture()?-1:1,0),this._shaderValues.setVector(ja.VIEWPORT,this._viewportParams),this._shaderValues.setVector(ja.PROJECTION_PARAMS,this._projectionParams)}},{key:"_applyViewProject",value:function(e,t,n,i){var a=this._shaderValues,i=i?(ki.multiply(ja._invertYScaleMatrix,n,ja._invertYProjectionMatrix),ki.multiply(ja._invertYProjectionMatrix,t,ja._invertYProjectionViewMatrix),n=ja._invertYProjectionMatrix,ja._invertYProjectionViewMatrix):(ki.multiply(n,t,this._projectionViewMatrix),this._projectionViewMatrix);e.viewMatrix=t,e.projectionMatrix=n,e.projectionViewMatrix=i,a.setMatrix4x4(ja.VIEWMATRIX,t),a.setMatrix4x4(ja.PROJECTMATRIX,n),a.setMatrix4x4(ja.VIEWPROJECTMATRIX,i)}},{key:"_updateClusterPlaneXY",value:function(){var e=this.fieldOfView,t=this.aspectRatio;if(this._clusterPlaneCacheFlag.x!==e||this._clusterPlaneCacheFlag.y!==t){var n=ha._config.lightClusterCount,i=n.x,n=n.y,a=i+1,r=n+1,o=this._clusterXPlanes,s=this._clusterYPlanes;if(!o){o=this._clusterXPlanes=new Array(a),s=this._clusterYPlanes=new Array(r);for(var l=0;l<a;l++)o[l]=new vn;for(l=0;l<r;l++)s[l]=new vn}for(var h=Math.tan(this.fieldOfView/2*Math.PI/180),u=this.aspectRatio*h,d=2*h/i,c=2*u/n,l=0;l<a;l++){var _=c*l-u,f=1/Math.sqrt(1+_*_);o[l].setValue(f,0,-_*f)}for(l=0;l<r;l++){var _=h-d*l,g=-1/Math.sqrt(1+_*_);s[l].setValue(0,g,-_*g)}this._clusterPlaneCacheFlag.x=e,this._clusterPlaneCacheFlag.y=t}}},{key:"render",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(this._scene){var n=!(!this._postProcess&&!this._enableHDR);n&&(this._renderTexture=Va.createFromPool(qa.clientWidth,qa.clientHeight,this._getRenderTextureFormat(),Y.DEPTH_16,U.FILTERMODE_BILINEAR));var i=P.instance,a=qa._instance,r=a.scene=this._scene;if(r.parallelSplitShadowMaps[0]){va.setRuntimeValueMode(!1);var o=r.parallelSplitShadowMaps[0];o._calcAllLightCameraInfo(this),r._shaderValues.addDefine(nr.SHADERDEFINE_CAST_SHADOW);for(var s=0,l=o.shadowMapCount;s<l;s++){var h=o.cameras[s];a.camera=h,ba.renderObjectCulling(h,r,a,r._castShadowRenders,e,t);var u=o.cameras[s+1].renderTarget;u._start(),a.camera=h,c._updateMark++,a.viewport=h.viewport,h._prepareCameraToRender(),h._applyViewProject(a,h.viewMatrix,h.projectionMatrix,!1),r._clear(i,a),r._opaqueQueue._render(a,!1),u._end()}r._shaderValues.removeDefine(nr.SHADERDEFINE_CAST_SHADOW),va.setRuntimeValueMode(!0)}a.camera=this,c._updateMark++,r._preRenderScript();var d=this._getInternalRenderTexture();d&&d._start(),a.viewport=this.viewport,this._prepareCameraToRender(),ha._config._multiLighting&&Aa.instance.update(this,this._scene),this._applyViewProject(a,this.viewMatrix,this._projectionMatrix,!!d),r._preCulling(a,this,e,t),r._clear(i,a),r._renderScene(a),r._postRenderScript(),d&&d._end(),n&&(this._postProcess?(this._postProcess._render(),this._applyPostProcessCommandBuffers()):this._enableHDR&&((n=Ja.create(this._renderTexture,this._offScreenRenderTexture||null)).run(),n.recover()),Va.recoverToPool(this._renderTexture))}}},{key:"viewportPointToRay",value:function(e,t){Ua.calculateCursorRay(e,this.viewport,this._projectionMatrix,this.viewMatrix,null,t)}},{key:"normalizedViewportPointToRay",value:function(e,t){var n=c._tempVector20,i=this.viewport;n.x=e.x*i.width,n.y=e.y*i.height,Ua.calculateCursorRay(n,this.viewport,this._projectionMatrix,this.viewMatrix,null,t)}},{key:"worldToViewportPoint",value:function(e,t){ki.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(e,this._projectionViewMatrix,t),t.x=t.x/zn.stage.clientScaleX,t.y=t.y/zn.stage.clientScaleY}},{key:"worldToNormalizedViewportPoint",value:function(e,t){ki.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(e,this._projectionViewMatrix,t),t.x=t.x/zn.stage.clientScaleX,t.y=t.y/zn.stage.clientScaleY}},{key:"convertScreenCoordToOrthographicCoord",value:function(e,t){if(this._orthographic){var n=qa.clientWidth,i=qa.clientHeight,a=this.orthographicVerticalSize*this.aspectRatio/n,r=this.orthographicVerticalSize/i;return t.x=(-n/2+e.x*zn.stage.clientScaleX)*a,t.y=(i/2-e.y*zn.stage.clientScaleY)*r,t.z=(this.nearPlane-this.farPlane)*(e.z+1)/2-this.nearPlane,vn.transformCoordinate(t,this.transform.worldMatrix,t),!0}return!1}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._offScreenRenderTexture=null,this.transform.off(Je.TRANSFORM_CHANGED,this,this._onTransformChanged),G(z(c.prototype),"destroy",this).call(this,e)}},{key:"addCommandBuffer",value:function(e,t){if(e!==c.CAMERAEVENT_POSTPROCESS)throw"Camera:unknown event.";this._postProcessCommandBuffers.push(t),t._camera=this}},{key:"removeCommandBuffer",value:function(e,t){if(e!==c.CAMERAEVENT_POSTPROCESS)throw"Camera:unknown event.";t=this._postProcessCommandBuffers.indexOf(t);-1!==t&&this._postProcessCommandBuffers.splice(t,1)}},{key:"removeCommandBuffers",value:function(e){if(e!==c.CAMERAEVENT_POSTPROCESS)throw"Camera:unknown event.";this._postProcessCommandBuffers.length=0}},{key:"_create",value:function(){return new c}},{key:"aspectRatio",get:function(){if(0!==this._aspectRatio)return this._aspectRatio;var e=this.viewport;return e.width/e.height},set:function(e){if(e<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=e,this._calculateProjectionMatrix()}},{key:"viewport",get:function(){return this._offScreenRenderTexture?this._calculationViewport(this._normalizedViewport,this._offScreenRenderTexture.width,this._offScreenRenderTexture.height):this._calculationViewport(this._normalizedViewport,qa.clientWidth,qa.clientHeight),this._viewport},set:function(e){var t,n=this._offScreenRenderTexture?(t=this._offScreenRenderTexture.width,this._offScreenRenderTexture.height):(t=qa.clientWidth,qa.clientHeight);this._normalizedViewport.x=e.x/t,this._normalizedViewport.y=e.y/n,this._normalizedViewport.width=e.width/t,this._normalizedViewport.height=e.height/n,this._calculationViewport(this._normalizedViewport,t,n),this._calculateProjectionMatrix()}},{key:"normalizedViewport",get:function(){return this._normalizedViewport},set:function(e){var t,n=this._offScreenRenderTexture?(t=this._offScreenRenderTexture.width,this._offScreenRenderTexture.height):(t=qa.clientWidth,qa.clientHeight);this._normalizedViewport!==e&&e.cloneTo(this._normalizedViewport),this._calculationViewport(e,t,n),this._calculateProjectionMatrix()}},{key:"viewMatrix",get:function(){var e,t,n,i;return this._updateViewMatrix&&(e=(i=this.transform.getWorldLossyScale()).x,t=i.y,n=i.z,i=this._viewMatrix.elements,this.transform.worldMatrix.cloneTo(this._viewMatrix),i[0]/=e,i[1]/=e,i[2]/=e,i[4]/=t,i[5]/=t,i[6]/=t,i[8]/=n,i[9]/=n,i[10]/=n,this._viewMatrix.invert(this._viewMatrix),this._updateViewMatrix=!1),this._viewMatrix}},{key:"projectionMatrix",get:function(){return this._projectionMatrix},set:function(e){this._projectionMatrix=e,this._useUserProjectionMatrix=!0}},{key:"projectionViewMatrix",get:function(){return ki.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}},{key:"boundFrustum",get:function(){var e,t,n,i,a,r,o,s,l,h,u,d,c;return this._boundFrustum.matrix=this.projectionViewMatrix,yt.supportWebGLPlusCulling&&(e=this._boundFrustum.near,t=this._boundFrustum.far,n=this._boundFrustum.left,i=this._boundFrustum.right,a=this._boundFrustum.top,r=this._boundFrustum.bottom,o=e.normal,s=t.normal,l=n.normal,h=i.normal,u=a.normal,d=r.normal,(c=this._boundFrustumBuffer)[0]=o.x,c[1]=o.y,c[2]=o.z,c[3]=e.distance,c[4]=s.x,c[5]=s.y,c[6]=s.z,c[7]=t.distance,c[8]=l.x,c[9]=l.y,c[10]=l.z,c[11]=n.distance,c[12]=h.x,c[13]=h.y,c[14]=h.z,c[15]=i.distance,c[16]=u.x,c[17]=u.y,c[18]=u.z,c[19]=a.distance,c[20]=d.x,c[21]=d.y,c[22]=d.z,c[23]=r.distance),this._boundFrustum}},{key:"renderTarget",get:function(){return this._offScreenRenderTexture},set:function(e){this._offScreenRenderTexture!==e&&(this._offScreenRenderTexture=e,this._calculateProjectionMatrix())}},{key:"postProcess",get:function(){return this._postProcess},set:function(e){this._postProcess=e;var t=new tr;this.addCommandBuffer(c.CAMERAEVENT_POSTPROCESS,t),e._init(this,t)}},{key:"enableHDR",get:function(){return this._enableHDR},set:function(e){e?za.supportRenderTextureFormat(H.R16G16B16A16)?this._enableHDR=!0:console.warn("Camera:can't enable HDR in this device."):this._enableHDR=!1}}]),c}();ir.CAMERAEVENT_POSTPROCESS=0,ir._tempVector20=new gn,ir._updateMark=0;var ar=function(){function p(){S(this,p),this.renderSubShader=null,this.renderType=p.RENDERTYPE_NORMAL}return C(p,[{key:"getInvertFront",value:function(){return this._transform._isFrontFaceInvert}},{key:"setTransform",value:function(e){this._transform=e}},{key:"setGeometry",value:function(e){this._geometry=e}},{key:"addToOpaqueRenderQueue",value:function(e,t){t.elements.add(this)}},{key:"addToTransparentRenderQueue",value:function(e,t){t.elements.add(this),t.lastTransparentBatched=!1,t.lastTransparentRenderElement=this}},{key:"_update",value:function(e,t,n,i){if(this.material){var a=this.material._shader.getSubShaderAt(0);if(this.renderSubShader=null,n)if(i){var r=a.getFlag(i);if(!r)return;for(var o=n._subShaders,s=0,l=o.length;s<l;s++){var h=o[s];if(r===h.getFlag(i)){this.renderSubShader=h;break}}if(!this.renderSubShader)return}else this.renderSubShader=n.getSubShaderAt(0);else this.renderSubShader=a;e=e._getRenderQueue(this.material.renderQueue);e.isTransparent?this.addToTransparentRenderQueue(t,e):this.addToOpaqueRenderQueue(t,e)}}},{key:"_render",value:function(e,t){var n,i,a,r=ir._updateMark,o=e.scene,s=e.camera,l=this._transform,h=this._geometry,u=r!==(e.renderElement=this).render._updateMark||this.renderType!==this.render._updateRenderType;if(u&&(this.render._renderUpdate(e,l),this.render._renderUpdateWithCamera(e,l),this.render._updateMark=r,this.render._updateRenderType=this.renderType),h._prepareRender(e))for(var d=this.renderSubShader._passes,c=0,_=d.length;c<_;c++){var f=p._compileDefine;o._shaderValues._defineDatas.cloneTo(f),f.removeDefineDatas(this.material._disablePublicDefineDatas),f.addDefineDatas(this.render._shaderValues._defineDatas),f.addDefineDatas(this.material._shaderValues._defineDatas);var g=e.shader=d[c].withCompile(f),y=g.bind(),v=r!==g._uploadMark,f=g._uploadScene!==o||v;(f||y)&&(g.uploadUniforms(g._sceneUniformParamsMap,o._shaderValues,f),g._uploadScene=o);f=g._uploadRender!==this.render||g._uploadRenderType!==this.renderType||v;(f||y)&&(g.uploadUniforms(g._spriteUniformParamsMap,this.render._shaderValues,f),g._uploadRender=this.render,g._uploadRenderType=this.renderType);f=g._uploadCamera!==s||v;(f||y)&&(g.uploadUniforms(g._cameraUniformParamsMap,s._shaderValues,f),g._uploadCamera=s);v=g._uploadMaterial!==this.material||v;(v||y)&&(g.uploadUniforms(g._materialUniformParamsMap,this.material._shaderValues,v),g._uploadMaterial=this.material);v=this.material._shaderValues;n!==this.material||i!==g?(g.uploadRenderStateBlendDepth(v),g.uploadRenderStateFrontFace(v,t,this.getInvertFront()),n=this.material,i=g,a=this.render):a!==this.render&&(g.uploadRenderStateFrontFace(v,t,this.getInvertFront()),a=this.render),h._render(e),g._uploadMark=r}u&&this.renderType!==p.RENDERTYPE_NORMAL&&this.render._revertBatchRenderUpdate(e)}},{key:"destroy",value:function(){this._transform=null,this._geometry=null,this.material=null,this.render=null}}]),p}();ar.RENDERTYPE_NORMAL=0,ar.RENDERTYPE_STATICBATCH=1,ar.RENDERTYPE_INSTANCEBATCH=2,ar.RENDERTYPE_VERTEXBATCH=3,ar._compileDefine=new da;var rr=function(){T(n,ar);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._dynamicWorldPositionNormalNeedUpdate=!0,e}return C(n,[{key:"_onWorldMatrixChanged",value:function(){this._dynamicWorldPositionNormalNeedUpdate=!0}},{key:"_computeWorldPositionsAndNormals",value:function(e,t,n,i){if(this._dynamicWorldPositionNormalNeedUpdate){for(var a=this._geometry,r=a._vertexBuffer,o=r.vertexDeclaration.vertexStride/4,s=r.getFloat32Data(),l=this._transform.worldMatrix,h=this._transform.rotation,u=a._indices,d=0;d<i;d++){var c=(n?u[d]:d)*o,_=3*d;ia.transformVector3ArrayToVector3ArrayCoordinate(s,c+e,l,this._dynamicWorldPositions,_),-1!==t&&ia.transformVector3ArrayByQuat(s,c+t,h,this._dynamicWorldNormals,_)}this._dynamicWorldPositionNormalNeedUpdate=!1}}},{key:"setTransform",value:function(e){this._transform!==e&&(this._transform&&this._transform.off(Je.TRANSFORM_CHANGED,this,this._onWorldMatrixChanged),e&&e.on(Je.TRANSFORM_CHANGED,this,this._onWorldMatrixChanged),this._dynamicWorldPositionNormalNeedUpdate=!0,this._transform=e)}},{key:"setGeometry",value:function(e){var t,n,i;this._geometry!==e&&((i=e._mesh)&&((n=(t=1<i._subMeshes.length)?e._indexCount:i._vertexCount)<=wi.SubMeshDynamicBatch.maxAllowVertexCount?(i=3*n,this._dynamicVertexBatch=!0,this._dynamicWorldPositions=new Float32Array(i),this._dynamicWorldNormals=new Float32Array(i),this._dynamicVertexCount=n,this._dynamicMultiSubMesh=t):this._dynamicVertexBatch=!1),this._geometry=e)}},{key:"addToOpaqueRenderQueue",value:function(e,t){var n,i,a,r,o,s,l,h,u,d,c,_,f=this.staticBatch,g=t.elements,y=g.elements;f?(o=(n=wi.MeshRenderStaticBatchManager.instance).getBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,f._batchID),n._updateCountMark===o.updateMark?(i=o.indexInList,o.batched?y[i].staticBatchElementList.add(this):(r=(a=y[i]).render,(t=n._getBatchRenderElementFromPool()).renderType=ar.RENDERTYPE_STATICBATCH,t.setGeometry(f),t.material=a.material,f=(f=f.batchOwner)?f._transform:null,t.setTransform(f),t.render=r,t.renderSubShader=a.renderSubShader,(r=t.staticBatchElementList).length=0,r.add(a),r.add(this),y[i]=t,o.batched=!0)):(o.updateMark=n._updateCountMark,o.indexInList=g.length,o.batched=!1,g.add(this))):this.renderSubShader._owner._enableInstancing&&P.layaGPUInstance.supportInstance()&&this.render.lightmapIndex<0?(_=this._geometry,c=(d=wi.MeshRenderDynamicBatchManager.instance).getInstanceBatchOpaquaMark(this.render.receiveShadow,this.material.id,_._id,this._transform._isFrontFaceInvert),d._updateCountMark===c.updateMark?(h=c.indexInList,c.batched?(o=y[h].instanceBatchElementList).length===Ra.instance.maxInstanceCount?(c.updateMark=d._updateCountMark,c.indexInList=g.length,c.batched=!1,g.add(this)):o.add(this):(l=(s=y[h]).render,(u=d._getBatchRenderElementFromPool()).renderType=ar.RENDERTYPE_INSTANCEBATCH,u.setGeometry(Ra.instance),u.material=s.material,u.setTransform(null),u.render=l,u.instanceSubMesh=_,u.renderSubShader=s.renderSubShader,(l=u.instanceBatchElementList).length=0,l.add(s),l.add(this),y[h]=u,c.batched=!0)):(c.updateMark=d._updateCountMark,c.indexInList=g.length,c.batched=!1,g.add(this))):this._dynamicVertexBatch?(_=this._geometry._vertexBuffer.vertexDeclaration,l=(s=wi.MeshRenderDynamicBatchManager.instance).getVertexBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,_.id),s._updateCountMark===l.updateMark?(h=l.indexInList,l.batched?y[h].vertexBatchElementList.add(this):(d=(u=y[h]).render,(c=s._getBatchRenderElementFromPool()).renderType=ar.RENDERTYPE_VERTEXBATCH,c.setGeometry(wi.SubMeshDynamicBatch.instance),c.material=u.material,c.setTransform(null),c.render=d,c.vertexBatchVertexDeclaration=_,c.renderSubShader=u.renderSubShader,(_=c.vertexBatchElementList).length=0,_.add(u),_.add(this),y[h]=c,l.batched=!0)):(l.updateMark=s._updateCountMark,l.indexInList=g.length,l.batched=!1,g.add(this))):g.add(this)}},{key:"addToTransparentRenderQueue",value:function(e,t){var n,i,a,r,o,s,l,h,u,d=this.staticBatch,c=t.elements,_=c.elements;d?(n=wi.MeshRenderStaticBatchManager.instance,(i=t.lastTransparentRenderElement)?(a=i.render,i._geometry._getType()!==this._geometry._getType()||i.staticBatch!==d||i.material!==this.material||a.receiveShadow!==this.render.receiveShadow||a.lightmapIndex!==this.render.lightmapIndex?(c.add(this),t.lastTransparentBatched=!1):(t.lastTransparentBatched?_[c.length-1].staticBatchElementList.add(this):((o=n._getBatchRenderElementFromPool()).renderType=ar.RENDERTYPE_STATICBATCH,o.setGeometry(d),o.material=i.material,r=(r=d.batchOwner)?r._transform:null,o.setTransform(r),o.render=this.render,o.renderSubShader=i.renderSubShader,(r=o.staticBatchElementList).length=0,r.add(i),r.add(this),_[c.length-1]=o),t.lastTransparentBatched=!0)):(c.add(this),t.lastTransparentBatched=!1)):this.renderSubShader._owner._enableInstancing&&P.layaGPUInstance.supportInstance()&&this.render.lightmapIndex<0?(u=this._geometry,r=wi.MeshRenderDynamicBatchManager.instance,(h=t.lastTransparentRenderElement)?(o=h.render,h._geometry._getType()!==this._geometry._getType()||h._geometry!==u||h.material!==this.material||o.receiveShadow!==this.render.receiveShadow?(c.add(this),t.lastTransparentBatched=!1):t.lastTransparentBatched?(o=_[c.length-1].instanceBatchElementList).length===Ra.instance.maxInstanceCount?(c.add(this),t.lastTransparentBatched=!1):(o.add(this),t.lastTransparentBatched=!0):((l=r._getBatchRenderElementFromPool()).renderType=ar.RENDERTYPE_INSTANCEBATCH,l.setGeometry(Ra.instance),l.material=h.material,l.setTransform(null),l.render=this.render,l.instanceSubMesh=u,l.renderSubShader=h.renderSubShader,(s=l.instanceBatchElementList).length=0,s.add(h),s.add(this),_[c.length-1]=l,t.lastTransparentBatched=!0)):(c.add(this),t.lastTransparentBatched=!1)):this._dynamicVertexBatch?(u=this._geometry._vertexBuffer.vertexDeclaration,h=wi.MeshRenderDynamicBatchManager.instance,(s=t.lastTransparentRenderElement)?(l=s.render,s._geometry._getType()!==this._geometry._getType()||s._geometry._vertexBuffer._vertexDeclaration!==u||s.material!==this.material||l.receiveShadow!==this.render.receiveShadow||l.lightmapIndex!==this.render.lightmapIndex?(c.add(this),t.lastTransparentBatched=!1):(t.lastTransparentBatched?_[c.length-1].vertexBatchElementList.add(this):((h=h._getBatchRenderElementFromPool()).renderType=ar.RENDERTYPE_VERTEXBATCH,h.setGeometry(wi.SubMeshDynamicBatch.instance),h.material=s.material,h.setTransform(null),h.render=this.render,h.vertexBatchVertexDeclaration=u,h.renderSubShader=s.renderSubShader,(u=h.vertexBatchElementList).length=0,u.add(s),u.add(this),_[c.length-1]=h),t.lastTransparentBatched=!0)):(c.add(this),t.lastTransparentBatched=!1)):c.add(this),t.lastTransparentRenderElement=this}},{key:"getInvertFront",value:function(){switch(this.renderType){case ar.RENDERTYPE_NORMAL:return this._transform._isFrontFaceInvert;case ar.RENDERTYPE_STATICBATCH:case ar.RENDERTYPE_VERTEXBATCH:return!1;case ar.RENDERTYPE_INSTANCEBATCH:return this.instanceBatchElementList.elements[0]._transform._isFrontFaceInvert;default:throw"SubMeshRenderElement: unknown renderType"}}},{key:"destroy",value:function(){G(z(n.prototype),"destroy",this).call(this),this._dynamicWorldPositions=null,this._dynamicWorldNormals=null,this.staticBatch=null,this.staticBatchElementList=null,this.vertexBatchElementList=null,this.vertexBatchVertexDeclaration=null}}]),n}(),or=function(){T(N,Ia);var i=b(N);function N(e,t){var n;return S(this,N),(n=i.call(this))._bufferState=new Ga,n._batchID=N._batchIDCounter++,n._batchElements=[],n._currentBatchVertexCount=0,n._currentBatchIndexCount=0,n._vertexDeclaration=t,n.batchOwner=e,n}return C(N,[{key:"_getStaticBatchBakedVertexs",value:function(e,t,n,i,a,r){var o,s=r._vertexBuffer,l=s.vertexDeclaration,h=l.getVertexElementByUsage(wa.MESH_POSITION0)._offset/4,u=l.getVertexElementByUsage(wa.MESH_NORMAL0),d=u?u._offset/4:-1,u=l.getVertexElementByUsage(wa.MESH_COLOR0),c=u?u._offset/4:-1,u=l.getVertexElementByUsage(wa.MESH_TEXTURECOORDINATE0),_=u?u._offset/4:-1,u=l.getVertexElementByUsage(wa.MESH_TEXTURECOORDINATE1),f=u?u._offset/4:-1,u=l.getVertexElementByUsage(wa.MESH_TANGENT0),g=u?u._offset/4:-1,y=l.vertexStride/4,v=s.getFloat32Data();n?(n.worldMatrix.invert(N._tempMatrix4x40),o=N._tempMatrix4x41,ki.multiply(N._tempMatrix4x40,i.worldMatrix,o)):o=i.worldMatrix;var p=N._tempQuaternion0;o.decomposeTransRotScale(N._tempVector30,p,N._tempVector31);for(var m=a.lightmapScaleOffset,w=r.vertexCount,x=0;x<w;x++){var k=x*y,T=18*(x+t);ia.transformVector3ArrayToVector3ArrayCoordinate(v,k+h,o,e,0+T),-1!=d&&ia.transformVector3ArrayByQuat(v,k+d,p,e,3+T);var E,M=6+T;if(-1!=c)for(var b=k+c,S=0,I=4;S<I;S++)e[M+S]=v[b+S];else for(S=0,I=4;S<I;S++)e[M+S]=1;-1!=_&&(E=k+_,e[10+T]=v[E],e[11+T]=v[1+E]),m&&(-1!=f?ia.transformLightingMapTexcoordArray(v,k+f,m,e,12+T):ia.transformLightingMapTexcoordArray(v,k+_,m,e,12+T)),-1!=g&&(k=k+g,e[14+T]=v[k],e[15+T]=v[1+k],e[16+T]=v[2+k],e[17+T]=v[3+k])}return w}},{key:"addTest",value:function(e){e=e.meshFilter.sharedMesh.vertexCount;return!(this._currentBatchVertexCount+e>N.maxBatchVertexCount)}},{key:"add",value:function(e){var t=e.meshFilter.sharedMesh,n=t.vertexCount;this._batchElements.push(e);e=e._render;e._isPartOfStaticBatch=!0,e._staticBatch=this;for(var i=e._renderElements,a=0,r=i.length;a<r;a++)i[a].staticBatch=this;this._currentBatchIndexCount+=t._indexBuffer.indexCount,this._currentBatchVertexCount+=n}},{key:"remove",value:function(e){var t=e.meshFilter.sharedMesh,n=this._batchElements.indexOf(e);if(-1!==n){this._batchElements.splice(n,1);for(var i=e._render._renderElements,a=0,r=i.length;a<r;a++)i[a].staticBatch=null;this._currentBatchIndexCount=this._currentBatchIndexCount-t._indexBuffer.indexCount,this._currentBatchVertexCount=this._currentBatchVertexCount-t.vertexCount,e._render._isPartOfStaticBatch=!1}}},{key:"finishInit",value:function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy(),V._addGPUMemory(-(this._vertexBuffer._byteLength+this._indexBuffer._byteLength)));var e=P.instance,t=0,n=0,i=this.batchOwner,a=this._vertexDeclaration.vertexStride/4,r=new Float32Array(a*this._currentBatchVertexCount),o=new Uint16Array(this._currentBatchIndexCount);this._vertexBuffer=new Na(this._vertexDeclaration.vertexStride*this._currentBatchVertexCount,e.STATIC_DRAW),this._vertexBuffer.vertexDeclaration=this._vertexDeclaration,this._indexBuffer=new Xa(Xa.INDEXTYPE_USHORT,this._currentBatchIndexCount,e.STATIC_DRAW);for(var s=0,l=this._batchElements.length;s<l;s++){for(var h,u=this._batchElements[s],d=u.meshFilter.sharedMesh,c=this._getStaticBatchBakedVertexs(r,t,i?i._transform:null,u._transform,u._render,d),_=d._indexBuffer.getData(),f=t,g=n+_.length,y=u._render._renderElements,v=0,p=d.subMeshCount;v<p;v++){var m=d._subMeshes[v],w=n+m._indexStart,x=y[v];x.staticBatchIndexStart=w,x.staticBatchIndexEnd=w+m._indexCount}if(o.set(_,n),i?u._transform._isFrontFaceInvert!==i.transform._isFrontFaceInvert:u._transform._isFrontFaceInvert)for(h=n;h<g;h+=3){o[h]=f+o[h];var k=o[h+1],T=o[h+2];o[h+1]=f+T,o[h+2]=f+k}else for(h=n;h<g;h+=3)o[h]=f+o[h],o[h+1]=f+o[h+1],o[h+2]=f+o[h+2];n+=_.length,t+=c}this._vertexBuffer.setData(r.buffer),this._indexBuffer.setData(o);e=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;V._addGPUMemory(e),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()}},{key:"_render",value:function(e){this._bufferState.bind();for(var t,n,i=P.instance,e=e.renderElement.staticBatchElementList,a=e.elements,r=0,o=0,s=e.length,l=1;l<s;l++)a[l-1].staticBatchIndexEnd!==a[l].staticBatchIndexStart?(t=a[r].staticBatchIndexStart,n=a[o].staticBatchIndexEnd-t,i.drawElements(i.TRIANGLES,n,i.UNSIGNED_SHORT,2*t),r=++o,J.trianglesFaces+=n/3):o++;t=a[r].staticBatchIndexStart,n=a[o].staticBatchIndexEnd-t,i.drawElements(i.TRIANGLES,n,i.UNSIGNED_SHORT,2*t),J.renderBatches++,J.savedRenderBatches+=s-1,J.trianglesFaces+=n/3}},{key:"dispose",value:function(){var e=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;V._addGPUMemory(-e),this._batchElements=null,this.batchOwner=null,this._vertexDeclaration=null,this._bufferState.destroy(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._vertexBuffer=null,this._indexBuffer=null,this._bufferState=null}}]),N}();or._tempVector30=new vn,or._tempVector31=new vn,or._tempQuaternion0=new xi,or._tempMatrix4x40=new ki,or._tempMatrix4x41=new ki,or.maxBatchVertexCount=65535,or._batchIDCounter=0;var sr=function(){function e(){S(this,e),this.elements=[],this.length=0}return C(e,[{key:"_add",value:function(e){this.length===this.elements.length?this.elements.push(e):this.elements[this.length]=e}},{key:"add",value:function(e){this.length===this.elements.length?this.elements.push(e):this.elements[this.length]=e,this.length++}}]),e}(),lr=function(){T(a,Ma);var t=b(a);function a(){var e;return S(this,a),(e=t.call(this))._opaqueBatchMarks=[],e._updateCountMark=0,e}return C(a,[{key:"_compare",value:function(e,t){var n=e._render,i=t._render,a=e.meshFilter.sharedMesh,e=t.meshFilter.sharedMesh,t=n.lightmapIndex-i.lightmapIndex;if(0!=t)return t;t=(n.receiveShadow?1:0)-(i.receiveShadow?1:0);if(0!=t)return t;i=n.sharedMaterial&&i.sharedMaterial?n.sharedMaterial.id-i.sharedMaterial.id:0;if(0!=i)return i;i=a._vertexBuffer.vertexDeclaration.id-e._vertexBuffer.vertexDeclaration.id;return 0==i?e._indexBuffer.indexCount-a._indexBuffer.indexCount:i}},{key:"_getBatchRenderElementFromPool",value:function(){var e=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];return e||(e=new rr,(this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=e).staticBatchElementList=new sr),e}},{key:"_getStaticBatch",value:function(e,t,n){var i=e[n];return i||(i=e[n]=new or(t,a._verDec),this._staticBatches[i._batchID]=i),i}},{key:"_initStaticBatchs",value:function(e){var t=this._initBatchSprites;this._quickSort(t,0,t.length-1);for(var n,i=[],a=!1,r=0,o=0,s=t.length;o<s;o++){var l=t[o];a?n.addTest(l)?n.add(l):(a=!1,r++):o!==s-1&&((n=this._getStaticBatch(i,e,r)).add(l),a=!0)}for(o=0,s=i.length;o<s;o++){var h=i[o];h&&h.finishInit()}this._initBatchSprites.length=0}},{key:"_removeRenderSprite",value:function(e){var t=e._render,n=t._staticBatch,i=n._batchElements,e=i.indexOf(e);if(-1!==e){i.splice(e,1),t._staticBatch=null;for(var a=t._renderElements,r=0,o=a.length;r<o;r++)a[r].staticBatch=null}0===i.length&&(delete this._staticBatches[n._batchID],n.dispose())}},{key:"_clear",value:function(){G(z(a.prototype),"_clear",this).call(this),this._updateCountMark++}},{key:"_garbageCollection",value:function(){for(var e in this._staticBatches){var t=this._staticBatches[e];0===t._batchElements.length&&(t.dispose(),delete this._staticBatches[e])}}},{key:"getBatchOpaquaMark",value:function(e,t,n,i){t=t?1:0,e=this._opaqueBatchMarks[e]||(this._opaqueBatchMarks[e]=[]),t=e[t]||(e[t]=[]),n=t[n]||(t[n]=[]);return n[i]||(n[i]=new Sa)}}],[{key:"__init__",value:function(){a._verDec=wa.getVertexDeclaration("POSITION,NORMAL,COLOR,UV,UV1,TANGENT")}}]),a}();lr.instance=new lr;var hr=function(){T(a,V);var t=b(a);function a(){var e;return S(this,a),(e=t.call(this))._shaderValues=null,e._disablePublicDefineDatas=new da,e._shaderValues=new va(u(e)),e.renderQueue=a.RENDERQUEUE_OPAQUE,e._alphaTest=!1,e}return C(a,[{key:"_removeTetxureReference",value:function(){var e,t=this._shaderValues.getData();for(e in t){var n=t[e];n&&n instanceof U&&n._removeReference()}}},{key:"_addReference",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;G(z(a.prototype),"_addReference",this).call(this,e);var t,n=this._shaderValues.getData();for(t in n){var i=n[t];i&&i instanceof U&&i._addReference()}}},{key:"_removeReference",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;G(z(a.prototype),"_removeReference",this).call(this,e),this._removeTetxureReference()}},{key:"_disposeResource",value:function(){0<this._referenceCount&&this._removeTetxureReference(),this._shaderValues=null}},{key:"setShaderName",value:function(e){if(this._shader=ca.find(e),!this._shader)throw new Error("BaseMaterial: unknown shader name.")}},{key:"cloneTo",value:function(e){e.name=this.name,e.renderQueue=this.renderQueue,this._disablePublicDefineDatas.cloneTo(e._disablePublicDefineDatas),this._shaderValues.cloneTo(e._shaderValues)}},{key:"clone",value:function(){var e=new a;return this.cloneTo(e),e}},{key:"alphaTestValue",get:function(){return this._shaderValues.getNumber(a.ALPHATESTVALUE)},set:function(e){this._shaderValues.setNumber(a.ALPHATESTVALUE,e)}},{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){(this._alphaTest=e)?this._shaderValues.addDefine(a.SHADERDEFINE_ALPHATEST):this._shaderValues.removeDefine(a.SHADERDEFINE_ALPHATEST)}},{key:"_defineDatas",get:function(){return this._shaderValues._defineDatas}}],[{key:"load",value:function(e,t){zn.loader.create(e,t,null,a.MATERIAL)}},{key:"__initDefine__",value:function(){a.SHADERDEFINE_ALPHATEST=ca.getDefineByName("ALPHATEST")}},{key:"_parse",value:function(e){var t,n,i=e,a=i.props,r=a.type,r=Dt.getRegClass(r);if(!r)throw"_getSprite3DHierarchyInnerUrls 错误: "+e.type+" 不是类";switch(t=new r,i.version){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(n in a)switch(n){case"vectors":for(var o=a[n],s=0,l=o.length;s<l;s++){var h=o[s],u=h.value;switch(u.length){case 2:t[h.name]=new gn(u[0],u[1]);break;case 3:t[h.name]=new vn(u[0],u[1],u[2]);break;case 4:t[h.name]=new yn(u[0],u[1],u[2],u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var d=a[n];for(s=0,l=d.length;s<l;s++){var c=d[s],_=c.path;_&&(t[c.name]=on.getRes(_))}break;case"defines":var f=a[n];for(s=0,l=f.length;s<l;s++){var g=ca.getDefineByName(f[s]);t._shaderValues.addDefine(g)}break;case"renderStates":var y=a[n][0],v=t;v.blend=y.blend,v.cull=y.cull,v.depthTest=y.depthTest,v.depthWrite=y.depthWrite,v.blendSrc=y.srcBlend,v.blendDst=y.dstBlend;break;case"cull":t.cull=a[n];break;case"blend":t.blend=a[n];break;case"depthWrite":t.depthWrite=a[n];break;case"srcBlend":t.blendSrc=a[n];break;case"dstBlend":t.blendDst=a[n];break;default:t[n]=a[n]}break;default:throw new Error("BaseMaterial:unkonwn version.")}return t}}]),a}();hr.MATERIAL="MATERIAL",hr.RENDERQUEUE_OPAQUE=2e3,hr.RENDERQUEUE_ALPHATEST=2450,hr.RENDERQUEUE_TRANSPARENT=3e3,hr.ALPHATESTVALUE=ca.propertyNameToID("u_AlphaTestValue"),hr.SHADERDEFINE_ALPHATEST=null;var ur=function(){function t(){S(this,t),this.cull=t.CULL_BACK,this.blend=t.BLEND_DISABLE,this.srcBlend=t.BLENDPARAM_ONE,this.dstBlend=t.BLENDPARAM_ZERO,this.srcBlendRGB=t.BLENDPARAM_ONE,this.dstBlendRGB=t.BLENDPARAM_ZERO,this.srcBlendAlpha=t.BLENDPARAM_ONE,this.dstBlendAlpha=t.BLENDPARAM_ZERO,this.blendConstColor=new yn(1,1,1,1),this.blendEquation=t.BLENDEQUATION_ADD,this.blendEquationRGB=t.BLENDEQUATION_ADD,this.blendEquationAlpha=t.BLENDEQUATION_ADD,this.depthTest=t.DEPTHTEST_LEQUAL,this.depthWrite=!0}return C(t,[{key:"cloneTo",value:function(e){e.cull=this.cull,e.blend=this.blend,e.srcBlend=this.srcBlend,e.dstBlend=this.dstBlend,e.srcBlendRGB=this.srcBlendRGB,e.dstBlendRGB=this.dstBlendRGB,e.srcBlendAlpha=this.srcBlendAlpha,e.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(e.blendConstColor),e.blendEquation=this.blendEquation,e.blendEquationRGB=this.blendEquationRGB,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}}]),t}();ur.CULL_NONE=0,ur.CULL_FRONT=1,ur.CULL_BACK=2,ur.BLEND_DISABLE=0,ur.BLEND_ENABLE_ALL=1,ur.BLEND_ENABLE_SEPERATE=2,ur.BLENDPARAM_ZERO=0,ur.BLENDPARAM_ONE=1,ur.BLENDPARAM_SRC_COLOR=768,ur.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,ur.BLENDPARAM_DST_COLOR=774,ur.BLENDPARAM_ONE_MINUS_DST_COLOR=775,ur.BLENDPARAM_SRC_ALPHA=770,ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,ur.BLENDPARAM_DST_ALPHA=772,ur.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,ur.BLENDPARAM_SRC_ALPHA_SATURATE=776,ur.BLENDEQUATION_ADD=32774,ur.BLENDEQUATION_SUBTRACT=32778,ur.BLENDEQUATION_REVERSE_SUBTRACT=32779,ur.DEPTHTEST_OFF=0,ur.DEPTHTEST_NEVER=512,ur.DEPTHTEST_LESS=513,ur.DEPTHTEST_EQUAL=514,ur.DEPTHTEST_LEQUAL=515,ur.DEPTHTEST_GREATER=516,ur.DEPTHTEST_NOTEQUAL=517,ur.DEPTHTEST_GEQUAL=518,ur.DEPTHTEST_ALWAYS=519;var dr=function(){T(i,hr);var n=b(i);function i(){var e;S(this,i),(e=n.call(this))._enableVertexColor=!1,e.setShaderName("BLINNPHONG"),e._albedoIntensity=1,e._albedoColor=new yn(1,1,1,1);var t=e._shaderValues;return t.setVector(i.ALBEDOCOLOR,new yn(1,1,1,1)),t.setVector(i.MATERIALSPECULAR,new yn(1,1,1,1)),t.setNumber(i.SHININESS,.078125),t.setNumber(hr.ALPHATESTVALUE,.5),t.setVector(i.TILINGOFFSET,new yn(1,1,0,0)),e._enableLighting=!0,e.renderMode=i.RENDERMODE_OPAQUE,e}return C(i,[{key:"clone",value:function(){var e=new i;return this.cloneTo(e),e}},{key:"cloneTo",value:function(e){G(z(i.prototype),"cloneTo",this).call(this,e);e._enableLighting=this._enableLighting,e._albedoIntensity=this._albedoIntensity,e._enableVertexColor=this._enableVertexColor,this._albedoColor.cloneTo(e._albedoColor)}},{key:"_ColorR",get:function(){return this._albedoColor.x},set:function(e){this._albedoColor.x=e,this.albedoColor=this._albedoColor}},{key:"_ColorG",get:function(){return this._albedoColor.y},set:function(e){this._albedoColor.y=e,this.albedoColor=this._albedoColor}},{key:"_ColorB",get:function(){return this._albedoColor.z},set:function(e){this._albedoColor.z=e,this.albedoColor=this._albedoColor}},{key:"_ColorA",get:function(){return this._albedoColor.w},set:function(e){this._albedoColor.w=e,this.albedoColor=this._albedoColor}},{key:"_SpecColorR",get:function(){return this._shaderValues.getVector(i.MATERIALSPECULAR).x},set:function(e){this._shaderValues.getVector(i.MATERIALSPECULAR).x=e}},{key:"_SpecColorG",get:function(){return this._shaderValues.getVector(i.MATERIALSPECULAR).y},set:function(e){this._shaderValues.getVector(i.MATERIALSPECULAR).y=e}},{key:"_SpecColorB",get:function(){return this._shaderValues.getVector(i.MATERIALSPECULAR).z},set:function(e){this._shaderValues.getVector(i.MATERIALSPECULAR).z=e}},{key:"_SpecColorA",get:function(){return this._shaderValues.getVector(i.MATERIALSPECULAR).w},set:function(e){this._shaderValues.getVector(i.MATERIALSPECULAR).w=e}},{key:"_AlbedoIntensity",get:function(){return this._albedoIntensity},set:function(e){var t;this._albedoIntensity!==e&&(t=this._shaderValues.getVector(i.ALBEDOCOLOR),yn.scale(this._albedoColor,e,t),this._albedoIntensity=e,this._shaderValues.setVector(i.ALBEDOCOLOR,t))}},{key:"_Shininess",get:function(){return this._shaderValues.getNumber(i.SHININESS)},set:function(e){e=Math.max(0,Math.min(1,e)),this._shaderValues.setNumber(i.SHININESS,e)}},{key:"_MainTex_STX",get:function(){return this._shaderValues.getVector(i.TILINGOFFSET).x},set:function(e){var t=this._shaderValues.getVector(i.TILINGOFFSET);t.x=e,this.tilingOffset=t}},{key:"_MainTex_STY",get:function(){return this._shaderValues.getVector(i.TILINGOFFSET).y},set:function(e){var t=this._shaderValues.getVector(i.TILINGOFFSET);t.y=e,this.tilingOffset=t}},{key:"_MainTex_STZ",get:function(){return this._shaderValues.getVector(i.TILINGOFFSET).z},set:function(e){var t=this._shaderValues.getVector(i.TILINGOFFSET);t.z=e,this.tilingOffset=t}},{key:"_MainTex_STW",get:function(){return this._shaderValues.getVector(i.TILINGOFFSET).w},set:function(e){var t=this._shaderValues.getVector(i.TILINGOFFSET);t.w=e,this.tilingOffset=t}},{key:"_Cutoff",get:function(){return this.alphaTestValue},set:function(e){this.alphaTestValue=e}},{key:"renderMode",set:function(e){switch(e){case i.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=hr.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS;break;case i.RENDERMODE_CUTOUT:this.renderQueue=hr.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS;break;case i.RENDERMODE_TRANSPARENT:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LESS;break;default:throw new Error("Material:renderMode value error.")}}},{key:"enableVertexColor",get:function(){return this._enableVertexColor},set:function(e){(this._enableVertexColor=e)?this._shaderValues.addDefine(i.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(i.SHADERDEFINE_ENABLEVERTEXCOLOR)}},{key:"tilingOffsetX",get:function(){return this._MainTex_STX},set:function(e){this._MainTex_STX=e}},{key:"tilingOffsetY",get:function(){return this._MainTex_STY},set:function(e){this._MainTex_STY=e}},{key:"tilingOffsetZ",get:function(){return this._MainTex_STZ},set:function(e){this._MainTex_STZ=e}},{key:"tilingOffsetW",get:function(){return this._MainTex_STW},set:function(e){this._MainTex_STW=e}},{key:"tilingOffset",get:function(){return this._shaderValues.getVector(i.TILINGOFFSET)},set:function(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(i.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(i.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(i.TILINGOFFSET,e)}},{key:"albedoColorR",get:function(){return this._ColorR},set:function(e){this._ColorR=e}},{key:"albedoColorG",get:function(){return this._ColorG},set:function(e){this._ColorG=e}},{key:"albedoColorB",get:function(){return this._ColorB},set:function(e){this._ColorB=e}},{key:"albedoColorA",get:function(){return this._ColorA},set:function(e){this._ColorA=e}},{key:"albedoColor",get:function(){return this._albedoColor},set:function(e){var t=this._shaderValues.getVector(i.ALBEDOCOLOR);yn.scale(e,this._albedoIntensity,t),this._albedoColor=e,this._shaderValues.setVector(i.ALBEDOCOLOR,t)}},{key:"albedoIntensity",get:function(){return this._albedoIntensity},set:function(e){this._AlbedoIntensity=e}},{key:"specularColorR",get:function(){return this._SpecColorR},set:function(e){this._SpecColorR=e}},{key:"specularColorG",get:function(){return this._SpecColorG},set:function(e){this._SpecColorG=e}},{key:"specularColorB",get:function(){return this._SpecColorB},set:function(e){this._SpecColorB=e}},{key:"specularColorA",get:function(){return this._SpecColorA},set:function(e){this._SpecColorA=e}},{key:"specularColor",get:function(){return this._shaderValues.getVector(i.MATERIALSPECULAR)},set:function(e){this._shaderValues.setVector(i.MATERIALSPECULAR,e)}},{key:"shininess",get:function(){return this._Shininess},set:function(e){this._Shininess=e}},{key:"albedoTexture",get:function(){return this._shaderValues.getTexture(i.ALBEDOTEXTURE)},set:function(e){e?this._shaderValues.addDefine(i.SHADERDEFINE_DIFFUSEMAP):this._shaderValues.removeDefine(i.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(i.ALBEDOTEXTURE,e)}},{key:"normalTexture",get:function(){return this._shaderValues.getTexture(i.NORMALTEXTURE)},set:function(e){e?this._shaderValues.addDefine(i.SHADERDEFINE_NORMALMAP):this._shaderValues.removeDefine(i.SHADERDEFINE_NORMALMAP),this._shaderValues.setTexture(i.NORMALTEXTURE,e)}},{key:"specularTexture",get:function(){return this._shaderValues.getTexture(i.SPECULARTEXTURE)},set:function(e){e?this._shaderValues.addDefine(i.SHADERDEFINE_SPECULARMAP):this._shaderValues.removeDefine(i.SHADERDEFINE_SPECULARMAP),this._shaderValues.setTexture(i.SPECULARTEXTURE,e)}},{key:"enableLighting",get:function(){return this._enableLighting},set:function(e){this._enableLighting!==e&&(e?(this._disablePublicDefineDatas.remove(nr.SHADERDEFINE_POINTLIGHT),this._disablePublicDefineDatas.remove(nr.SHADERDEFINE_SPOTLIGHT),this._disablePublicDefineDatas.remove(nr.SHADERDEFINE_DIRECTIONLIGHT)):(this._disablePublicDefineDatas.add(nr.SHADERDEFINE_POINTLIGHT),this._disablePublicDefineDatas.add(nr.SHADERDEFINE_SPOTLIGHT),this._disablePublicDefineDatas.add(nr.SHADERDEFINE_DIRECTIONLIGHT)),this._enableLighting=e)}},{key:"depthWrite",get:function(){return this._shaderValues.getBool(i.DEPTH_WRITE)},set:function(e){this._shaderValues.setBool(i.DEPTH_WRITE,e)}},{key:"cull",get:function(){return this._shaderValues.getInt(i.CULL)},set:function(e){this._shaderValues.setInt(i.CULL,e)}},{key:"blend",get:function(){return this._shaderValues.getInt(i.BLEND)},set:function(e){this._shaderValues.setInt(i.BLEND,e)}},{key:"blendSrc",get:function(){return this._shaderValues.getInt(i.BLEND_SRC)},set:function(e){this._shaderValues.setInt(i.BLEND_SRC,e)}},{key:"blendDst",get:function(){return this._shaderValues.getInt(i.BLEND_DST)},set:function(e){this._shaderValues.setInt(i.BLEND_DST,e)}},{key:"depthTest",get:function(){return this._shaderValues.getInt(i.DEPTH_TEST)},set:function(e){this._shaderValues.setInt(i.DEPTH_TEST,e)}}],[{key:"__initDefine__",value:function(){i.SHADERDEFINE_DIFFUSEMAP=ca.getDefineByName("DIFFUSEMAP"),i.SHADERDEFINE_NORMALMAP=ca.getDefineByName("NORMALMAP"),i.SHADERDEFINE_SPECULARMAP=ca.getDefineByName("SPECULARMAP"),i.SHADERDEFINE_TILINGOFFSET=ca.getDefineByName("TILINGOFFSET"),i.SHADERDEFINE_ENABLEVERTEXCOLOR=ca.getDefineByName("ENABLEVERTEXCOLOR")}}]),i}();dr.RENDERMODE_OPAQUE=0,dr.RENDERMODE_CUTOUT=1,dr.RENDERMODE_TRANSPARENT=2,dr.ALBEDOTEXTURE=ca.propertyNameToID("u_DiffuseTexture"),dr.NORMALTEXTURE=ca.propertyNameToID("u_NormalTexture"),dr.SPECULARTEXTURE=ca.propertyNameToID("u_SpecularTexture"),dr.ALBEDOCOLOR=ca.propertyNameToID("u_DiffuseColor"),dr.MATERIALSPECULAR=ca.propertyNameToID("u_MaterialSpecular"),dr.SHININESS=ca.propertyNameToID("u_Shininess"),dr.TILINGOFFSET=ca.propertyNameToID("u_TilingOffset"),dr.CULL=ca.propertyNameToID("s_Cull"),dr.BLEND=ca.propertyNameToID("s_Blend"),dr.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),dr.BLEND_DST=ca.propertyNameToID("s_BlendDst"),dr.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),dr.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite");var cr=function(){function a(e,t){S(this,a),this.min=e,this.max=t}return C(a,[{key:"_rotateExtents",value:function(e,t,n){var i=e.x,a=e.y,e=e.z,t=t.elements;n.x=Math.abs(t[0]*i)+Math.abs(t[4]*a)+Math.abs(t[8]*e),n.y=Math.abs(t[1]*i)+Math.abs(t[5]*a)+Math.abs(t[9]*e),n.z=Math.abs(t[2]*i)+Math.abs(t[6]*a)+Math.abs(t[10]*e)}},{key:"getCorners",value:function(e){e.length=8;var t=this.min.x,n=this.min.y,i=this.min.z,a=this.max.x,r=this.max.y,o=this.max.z;e[0]=new vn(t,r,o),e[1]=new vn(a,r,o),e[2]=new vn(a,n,o),e[3]=new vn(t,n,o),e[4]=new vn(t,r,i),e[5]=new vn(a,r,i),e[6]=new vn(a,n,i),e[7]=new vn(t,n,i)}},{key:"getCenter",value:function(e){vn.add(this.min,this.max,e),vn.scale(e,.5,e)}},{key:"getExtent",value:function(e){vn.subtract(this.max,this.min,e),vn.scale(e,.5,e)}},{key:"setCenterAndExtent",value:function(e,t){vn.subtract(e,t,this.min),vn.add(e,t,this.max)}},{key:"tranform",value:function(e,t){var n=a._tempVector30,i=a._tempVector31;this.getCenter(n),this.getExtent(i),vn.transformCoordinate(n,e,n),this._rotateExtents(i,e,i),t.setCenterAndExtent(n,i)}},{key:"toDefault",value:function(){this.min.toDefault(),this.max.toDefault()}},{key:"cloneTo",value:function(e){this.min.cloneTo(e.min),this.max.cloneTo(e.max)}},{key:"clone",value:function(){var e=new a(new vn,new vn);return this.cloneTo(e),e}}],[{key:"createfromPoints",value:function(e,t){if(null==e)throw new Error("points");var n=t.min,i=t.max;n.x=Number.MAX_VALUE,n.y=Number.MAX_VALUE,n.z=Number.MAX_VALUE,i.x=-Number.MAX_VALUE,i.y=-Number.MAX_VALUE,i.z=-Number.MAX_VALUE;for(var a=0,r=e.length;a<r;++a)vn.min(n,e[a],n),vn.max(i,e[a],i)}},{key:"merge",value:function(e,t,n){vn.min(e.min,t.min,n.min),vn.max(e.max,t.max,n.max)}}]),a}();cr._tempVector30=new vn,cr._tempVector31=new vn;var _r=function(){function n(e,t){S(this,n),this._updateFlag=0,this._center=new vn,this._extent=new vn,this._boundBox=new cr(new vn,new vn),e.cloneTo(this._boundBox.min),t.cloneTo(this._boundBox.max),this._setUpdateFlag(n._UPDATE_CENTER|n._UPDATE_EXTENT,!0)}return C(n,[{key:"setMin",value:function(e){var t=this._boundBox.min;e!==t&&e.cloneTo(t),this._setUpdateFlag(n._UPDATE_CENTER|n._UPDATE_EXTENT,!0),this._setUpdateFlag(n._UPDATE_MIN,!1)}},{key:"getMin",value:function(){var e=this._boundBox.min;return this._getUpdateFlag(n._UPDATE_MIN)&&(this._getMin(this.getCenter(),this.getExtent(),e),this._setUpdateFlag(n._UPDATE_MIN,!1)),e}},{key:"setMax",value:function(e){var t=this._boundBox.max;e!==t&&e.cloneTo(t),this._setUpdateFlag(n._UPDATE_CENTER|n._UPDATE_EXTENT,!0),this._setUpdateFlag(n._UPDATE_MAX,!1)}},{key:"getMax",value:function(){var e=this._boundBox.max;return this._getUpdateFlag(n._UPDATE_MAX)&&(this._getMax(this.getCenter(),this.getExtent(),e),this._setUpdateFlag(n._UPDATE_MAX,!1)),e}},{key:"setCenter",value:function(e){e!==this._center&&e.cloneTo(this._center),this._setUpdateFlag(n._UPDATE_MIN|n._UPDATE_MAX,!0),this._setUpdateFlag(n._UPDATE_CENTER,!1)}},{key:"getCenter",value:function(){return this._getUpdateFlag(n._UPDATE_CENTER)&&(this._getCenter(this.getMin(),this.getMax(),this._center),this._setUpdateFlag(n._UPDATE_CENTER,!1)),this._center}},{key:"setExtent",value:function(e){e!==this._extent&&e.cloneTo(this._extent),this._setUpdateFlag(n._UPDATE_MIN|n._UPDATE_MAX,!0),this._setUpdateFlag(n._UPDATE_EXTENT,!1)}},{key:"getExtent",value:function(){return this._getUpdateFlag(n._UPDATE_EXTENT)&&(this._getExtent(this.getMin(),this.getMax(),this._extent),this._setUpdateFlag(n._UPDATE_EXTENT,!1)),this._extent}},{key:"_getUpdateFlag",value:function(e){return 0!=(this._updateFlag&e)}},{key:"_setUpdateFlag",value:function(e,t){t?this._updateFlag|=e:this._updateFlag&=~e}},{key:"_getCenter",value:function(e,t,n){vn.add(e,t,n),vn.scale(n,.5,n)}},{key:"_getExtent",value:function(e,t,n){vn.subtract(t,e,n),vn.scale(n,.5,n)}},{key:"_getMin",value:function(e,t,n){vn.subtract(e,t,n)}},{key:"_getMax",value:function(e,t,n){vn.add(e,t,n)}},{key:"_rotateExtents",value:function(e,t,n){var i=e.x,a=e.y,e=e.z,t=t.elements;n.x=Math.abs(t[0]*i)+Math.abs(t[4]*a)+Math.abs(t[8]*e),n.y=Math.abs(t[1]*i)+Math.abs(t[5]*a)+Math.abs(t[9]*e),n.z=Math.abs(t[2]*i)+Math.abs(t[6]*a)+Math.abs(t[10]*e)}},{key:"_tranform",value:function(e,t){var n=t._center,i=t._extent;vn.transformCoordinate(this.getCenter(),e,n),this._rotateExtents(this.getExtent(),e,i),t._boundBox.setCenterAndExtent(n,i),t._updateFlag=0}},{key:"_getBoundBox",value:function(){var e;return this._updateFlag&n._UPDATE_MIN&&(e=this._boundBox.min,this._getMin(this.getCenter(),this.getExtent(),e),this._setUpdateFlag(n._UPDATE_MIN,!1)),this._updateFlag&n._UPDATE_MAX&&(e=this._boundBox.max,this._getMax(this.getCenter(),this.getExtent(),e),this._setUpdateFlag(n._UPDATE_MAX,!1)),this._boundBox}},{key:"cloneTo",value:function(e){this.getMin().cloneTo(e._boundBox.min),this.getMax().cloneTo(e._boundBox.max),this.getCenter().cloneTo(e._center),this.getExtent().cloneTo(e._extent),e._updateFlag=0}},{key:"clone",value:function(){var e=new n(new vn,new vn);return this.cloneTo(e),e}}]),n}();_r._UPDATE_MIN=1,_r._UPDATE_MAX=2,_r._UPDATE_CENTER=4,_r._UPDATE_EXTENT=8;var fr=function(){T(s,d);var o=b(s);function s(e){var t,n,i,a,r;return S(this,s),(t=o.call(this))._indexInList=-1,t._indexInCastShadowList=-1,t._boundsChange=!0,t._supportOctree=!0,t._sharedMaterials=[],t._visible=!0,t._indexInOctreeMotionList=-1,t._updateMark=-1,t._updateRenderType=-1,t._isPartOfStaticBatch=!1,t._staticBatch=null,t._id=++s._uniqueIDCounter,t._indexInCastShadowList=-1,t._bounds=new _r(vn._ZERO,vn._ZERO),yt.supportWebGLPlusCulling&&(n=ba._cullingBufferLength,(i=(t._cullingBufferIndex=n)+7)>=(r=ba._cullingBuffer).length&&(a=r,(r=ba._cullingBuffer=new Float32Array(r.length+4096)).set(a,0)),r[n]=2,ba._cullingBufferLength=i),t._renderElements=[],t._owner=e,t._enable=!0,t._materialsInstance=[],t._shaderValues=new va(null),t.lightmapIndex=-1,t._castShadow=!1,t.receiveShadow=!1,t.sortingFudge=0,e&&t._owner.transform.on(Je.TRANSFORM_CHANGED,u(t),t._onWorldMatNeedChange),t}return C(s,[{key:"_getOctreeNode",value:function(){return this._octreeNode}},{key:"_setOctreeNode",value:function(e){this._octreeNode=e}},{key:"_getIndexInMotionList",value:function(){return this._indexInOctreeMotionList}},{key:"_setIndexInMotionList",value:function(e){this._indexInOctreeMotionList=e}},{key:"_changeMaterialReference",value:function(e,t){e&&e._removeReference(),t._addReference()}},{key:"_getInstanceMaterial",value:function(e,t){e=e.clone();return e.name=e.name+"(Instance)",this._materialsInstance[t]=!0,this._changeMaterialReference(this._sharedMaterials[t],e),this._sharedMaterials[t]=e}},{key:"_applyLightMapParams",value:function(){var e;this._scene&&0<=this._lightmapIndex?(e=this._scene.getlightmaps(),this._lightmapIndex<e.length?(this._shaderValues.addDefine(ga.SAHDERDEFINE_LIGHTMAP),this._shaderValues.setTexture(ga.LIGHTMAP,e[this._lightmapIndex])):this._shaderValues.removeDefine(ga.SAHDERDEFINE_LIGHTMAP)):this._shaderValues.removeDefine(ga.SAHDERDEFINE_LIGHTMAP)}},{key:"_onWorldMatNeedChange",value:function(e){this._boundsChange=!0,this._octreeNode&&(e&=_a.TRANSFORM_WORLDPOSITION|_a.TRANSFORM_WORLDQUATERNION|_a.TRANSFORM_WORLDSCALE)&&-1===this._indexInOctreeMotionList&&this._octreeNode._octree.addMotionObject(this)}},{key:"_calculateBoundingBox",value:function(){throw"BaseRender: must override it."}},{key:"_getIndexInList",value:function(){return this._indexInList}},{key:"_setIndexInList",value:function(e){this._indexInList=e}},{key:"_setBelongScene",value:function(e){this._scene!==e&&(this._scene=e,this._applyLightMapParams())}},{key:"_needRender",value:function(e,t){return!0}},{key:"_renderUpdate",value:function(e,t){}},{key:"_renderUpdateWithCamera",value:function(e,t){}},{key:"_revertBatchRenderUpdate",value:function(e){}},{key:"_destroy",value:function(){-1!==this._indexInOctreeMotionList&&this._octreeNode._octree.removeMotionObject(this),this.offAll();for(var e=0,t=0,e=0,t=this._renderElements.length;e<t;e++)this._renderElements[e].destroy();for(e=0,t=this._sharedMaterials.length;e<t;e++)this._sharedMaterials[e].destroyed||this._sharedMaterials[e]._removeReference();this._renderElements=null,this._owner=null,this._sharedMaterials=null,this._bounds=null,this._lightmapScaleOffset=null}},{key:"markAsUnStatic",value:function(){this._isPartOfStaticBatch&&(lr.instance._removeRenderSprite(this._owner),this._isPartOfStaticBatch=!1)}},{key:"id",get:function(){return this._id}},{key:"lightmapIndex",get:function(){return this._lightmapIndex},set:function(e){this._lightmapIndex!==e&&(this._lightmapIndex=e,this._applyLightMapParams())}},{key:"lightmapScaleOffset",get:function(){return this._lightmapScaleOffset},set:function(e){this._lightmapScaleOffset=e,this._shaderValues.setVector(ga.LIGHTMAPSCALEOFFSET,e),this._shaderValues.addDefine(ga.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}},{key:"enable",get:function(){return this._enable},set:function(e){this._enable=!!e}},{key:"material",get:function(){var e,t=this._sharedMaterials[0];return t&&!this._materialsInstance[0]&&(e=this._getInstanceMaterial(t,0),(t=this._renderElements[0])&&(t.material=e)),this._sharedMaterials[0]},set:function(e){this.sharedMaterial=e}},{key:"materials",get:function(){for(var e,t,n=0,i=this._sharedMaterials.length;n<i;n++)this._materialsInstance[n]||(e=this._getInstanceMaterial(this._sharedMaterials[n],n),(t=this._renderElements[n])&&(t.material=e));return this._sharedMaterials.slice()},set:function(e){this.sharedMaterials=e}},{key:"sharedMaterial",get:function(){return this._sharedMaterials[0]},set:function(e){var t=this._sharedMaterials[0];t!==e&&(this._sharedMaterials[0]=e,this._materialsInstance[0]=!1,this._changeMaterialReference(t,e),(t=this._renderElements[0])&&(t.material=e))}},{key:"sharedMaterials",get:function(){return this._sharedMaterials.slice()},set:function(e){for(var t=this._materialsInstance,n=this._sharedMaterials,i=0,a=n.length;i<a;i++){var r=n[i];r&&r._removeReference()}if(!e)throw new Error("BaseRender: shadredMaterials value can't be null.");var o=e.length;for(t.length=o,n.length=o,i=0;i<o;i++){r=n[i];var s,l=e[i];r!==l&&(t[i]=!1,(s=this._renderElements[i])&&(s.material=l)),l&&l._addReference(),n[i]=l}}},{key:"bounds",get:function(){return this._boundsChange&&(this._calculateBoundingBox(),this._boundsChange=!1),this._bounds}},{key:"receiveShadow",set:function(e){this._receiveShadow!==e&&((this._receiveShadow=e)?this._shaderValues.addDefine(ga.SHADERDEFINE_RECEIVE_SHADOW):this._shaderValues.removeDefine(ga.SHADERDEFINE_RECEIVE_SHADOW))},get:function(){return this._receiveShadow}},{key:"castShadow",get:function(){return this._castShadow},set:function(e){this._castShadow!==e&&(this._owner.activeInHierarchy&&(e?this._scene._addShadowCastRenderObject(this):this._scene._removeShadowCastRenderObject(this)),this._castShadow=e)}},{key:"isPartOfStaticBatch",get:function(){return this._isPartOfStaticBatch}}]),s}();fr._tempBoundBoxCorners=[new vn,new vn,new vn,new vn,new vn,new vn,new vn,new vn],fr._uniqueIDCounter=0;var gr=function(){T(n,fr);var t=b(n);function n(e){return S(this,n),(e=t.call(this,e))._revertStaticBatchDefineUV1=!1,e._revertStaticBatchDefineLightMapUV=!1,e._projectionViewWorldMatrix=new ki,e}return C(n,[{key:"_createRenderElement",value:function(){return new rr}},{key:"_onMeshChange",value:function(e){if(e){var t=e.subMeshCount;this._renderElements.length=t;for(var n=0;n<t;n++){var i,a=this._renderElements[n];a||(i=this.sharedMaterials[n],(a=this._renderElements[n]=this._createRenderElement()).setTransform(this._owner._transform),a.render=this,a.material=i||dr.defaultMaterial),a.setGeometry(e.getSubMesh(n))}}else this._renderElements.length=0;this._boundsChange=!0}},{key:"_calculateBoundingBox",value:function(){var e,t,n=this._owner.meshFilter.sharedMesh;n&&(t=this._owner.transform.worldMatrix,n.bounds._tranform(t,this._bounds)),yt.supportWebGLPlusCulling&&(e=this._bounds.getMin(),n=this._bounds.getMax(),(t=ba._cullingBuffer)[this._cullingBufferIndex+1]=e.x,t[this._cullingBufferIndex+2]=e.y,t[this._cullingBufferIndex+3]=e.z,t[this._cullingBufferIndex+4]=n.x,t[this._cullingBufferIndex+5]=n.y,t[this._cullingBufferIndex+6]=n.z)}},{key:"_needRender",value:function(e,t){return!e||e.intersects(this.bounds._getBoundBox())}},{key:"_renderUpdate",value:function(e,t){var n=e.renderElement;switch(n.renderType){case ar.RENDERTYPE_NORMAL:this._shaderValues.setMatrix4x4(fa.WORLDMATRIX,t.worldMatrix);break;case ar.RENDERTYPE_STATICBATCH:t?this._shaderValues.setMatrix4x4(fa.WORLDMATRIX,t.worldMatrix):this._shaderValues.setMatrix4x4(fa.WORLDMATRIX,ki.DEFAULT),this._shaderValues.hasDefine(xa.SHADERDEFINE_UV1)?this._revertStaticBatchDefineUV1=!1:(this._shaderValues.addDefine(xa.SHADERDEFINE_UV1),this._revertStaticBatchDefineUV1=!0),this._shaderValues.hasDefine(ga.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)?(this._shaderValues.removeDefine(ga.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV),this._revertStaticBatchDefineLightMapUV=!0):this._revertStaticBatchDefineLightMapUV=!1;break;case ar.RENDERTYPE_VERTEXBATCH:this._shaderValues.setMatrix4x4(fa.WORLDMATRIX,ki.DEFAULT);break;case ar.RENDERTYPE_INSTANCEBATCH:for(var i=Ra.instance.instanceWorldMatrixData,a=n.instanceBatchElementList,r=a.elements,o=a.length,s=0;s<o;s++)i.set(r[s]._transform.worldMatrix.elements,16*s);Ra.instance.instanceWorldMatrixBuffer.setData(i.buffer,0,0,16*o*4),this._shaderValues.addDefine(xa.SHADERDEFINE_GPU_INSTANCE)}}},{key:"_renderUpdateWithCamera",value:function(e,t){var n=e.projectionViewMatrix,i=e.renderElement;switch(i.renderType){case ar.RENDERTYPE_NORMAL:case ar.RENDERTYPE_STATICBATCH:case ar.RENDERTYPE_VERTEXBATCH:t?(ki.multiply(n,t.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(fa.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(fa.MVPMATRIX,n);break;case ar.RENDERTYPE_INSTANCEBATCH:for(var a=Ra.instance.instanceMVPMatrixData,r=i.instanceBatchElementList,o=r.elements,s=r.length,l=0;l<s;l++){var h=o[l]._transform.worldMatrix;ia.mulMatrixByArray(n.elements,0,h.elements,0,a,16*l)}Ra.instance.instanceMVPMatrixBuffer.setData(a.buffer,0,0,16*s*4)}}},{key:"_revertBatchRenderUpdate",value:function(e){switch(e.renderElement.renderType){case ar.RENDERTYPE_STATICBATCH:this._revertStaticBatchDefineUV1&&this._shaderValues.removeDefine(xa.SHADERDEFINE_UV1),this._revertStaticBatchDefineLightMapUV&&this._shaderValues.addDefine(ga.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV);break;case ar.RENDERTYPE_INSTANCEBATCH:this._shaderValues.removeDefine(xa.SHADERDEFINE_GPU_INSTANCE)}}},{key:"_destroy",value:function(){this._isPartOfStaticBatch&&lr.instance._removeRenderSprite(this._owner),G(z(n.prototype),"_destroy",this).call(this)}}]),n}(),yr=function(){T(c,Ia);var i=b(c);function c(){var e;S(this,c),(e=i.call(this))._bufferState=new Ga;var t=P.instance,n=wa.getVertexDeclaration("POSITION,NORMAL,COLOR,UV,UV1,TANGENT").vertexStride*c.maxIndicesCount;e._vertices=new Float32Array(n/4),e._vertexBuffer=new Na(n,t.DYNAMIC_DRAW),e._indices=new Int16Array(c.maxIndicesCount),e._indexBuffer=new Xa(Xa.INDEXTYPE_USHORT,e._indices.length,t.DYNAMIC_DRAW);t=e._vertexBuffer._byteLength+e._indexBuffer._byteLength;return V._addMemory(t,t),e}return C(c,[{key:"_getBatchVertices",value:function(e,t,n,i,a,r){var o=e.vertexStride/4,s=r._vertexBuffer.getFloat32Data(),l=(a.render.lightmapScaleOffset,a._dynamicMultiSubMesh),h=a._dynamicVertexCount;a._computeWorldPositionsAndNormals(this._positionOffset,this._normalOffset,l,h);for(var u=a._dynamicWorldPositions,d=a._dynamicWorldNormals,c=r._indices,_=0;_<h;_++){var f=(l?c[_]:_)*o,g=(_+n)*o,y=3*_,v=g+this._positionOffset;t[v]=u[y],t[v+1]=u[y+1],t[v+2]=u[y+2],-1!==this._normalOffset&&(t[v=g+this._normalOffset]=d[y],t[v+1]=d[y+1],t[v+2]=d[y+2]),-1!==this._colorOffset&&(v=g+this._colorOffset,y=f+this._colorOffset,t[v]=s[y],t[v+1]=s[y+1],t[v+2]=s[y+2],t[v+3]=s[y+3]),-1!==this._uv0Offset&&(v=g+this._uv0Offset,y=f+this._uv0Offset,t[v]=s[y],t[v+1]=s[y+1]),-1!==this._sTangentOffset&&(v=g+this._sTangentOffset,y=f+this._sTangentOffset,t[v]=s[y],t[v+1]=s[y+1],t[v+2]=s[y+2],t[v+3]=s[y+3],v=g+this._sTangentOffset,y=f+this._sTangentOffset,t[v]=s[y],t[v+1]=s[y+1],t[v+2]=s[y+2],t[v+3]=s[y+3])}}},{key:"_getBatchIndices",value:function(e,t,n,i,a,r){var o,s,l,h=a._indices,i=i._isFrontFaceInvert;if(r)if(i)for(o=0,s=h.length;o<s;o+=3){var u=n+o;e[l=t+o]=u,e[l+1]=u+2,e[l+2]=u+1}else for(o=0,s=h.length;o<s;o+=3)u=n+o,e[l=t+o]=u,e[l+1]=u+1,e[l+2]=u+2;else if(i)for(o=0,s=h.length;o<s;o+=3)e[l=t+o]=n+h[o],e[l+1]=n+h[o+2],e[l+2]=n+h[o+1];else for(o=0,s=h.length;o<s;o+=3)e[l=t+o]=n+h[o],e[l+1]=n+h[o+1],e[l+2]=n+h[o+2]}},{key:"_flush",value:function(e,t){var n=P.instance;this._vertexBuffer.setData(this._vertices.buffer,0,0,e*this._bufferState.vertexDeclaration.vertexStride),this._indexBuffer.setData(this._indices,0,0,t),n.drawElements(n.TRIANGLES,t,n.UNSIGNED_SHORT,0)}},{key:"_prepareRender",value:function(e){var t=e.renderElement.vertexBatchVertexDeclaration;this._bufferState=wi.MeshRenderDynamicBatchManager.instance._getBufferState(t),this._positionOffset=t.getVertexElementByUsage(wa.MESH_POSITION0)._offset/4;e=t.getVertexElementByUsage(wa.MESH_NORMAL0);this._normalOffset=e?e._offset/4:-1;e=t.getVertexElementByUsage(wa.MESH_COLOR0);this._colorOffset=e?e._offset/4:-1;e=t.getVertexElementByUsage(wa.MESH_TEXTURECOORDINATE0);this._uv0Offset=e?e._offset/4:-1;e=t.getVertexElementByUsage(wa.MESH_TEXTURECOORDINATE1);this._uv1Offset=e?e._offset/4:-1;t=t.getVertexElementByUsage(wa.MESH_TANGENT0);return this._sTangentOffset=t?t._offset/4:-1,!0}},{key:"_render",value:function(e){this._bufferState.bind();for(var e=e.renderElement,t=e.vertexBatchVertexDeclaration,e=e.vertexBatchElementList,n=0,i=0,a=(t.vertexStride,0),r=e.length,o=e.elements,s=0;s<r;s++){var l=o[s],h=l._geometry,u=h._indexCount;c.maxIndicesCount<i+u&&(this._flush(n,i),a++,J.trianglesFaces+=i/3,n=i=0);var d=l._transform;this._getBatchVertices(t,this._vertices,n,d,l,h),this._getBatchIndices(this._indices,i,n,d,h,l._dynamicMultiSubMesh),n+=l._dynamicVertexCount,i+=u}this._flush(n,i),a++,J.renderBatches+=a,J.savedRenderBatches+=r-a,J.trianglesFaces+=i/3}}],[{key:"__init__",value:function(){c.instance=new c}}]),c}();yr.maxAllowVertexCount=10,yr.maxAllowAttribueCount=900,yr.maxIndicesCount=32e3;var vr=function(){T(n,Ea);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._instanceBatchOpaqueMarks=[],e._vertexBatchOpaqueMarks=[],e._cacheBufferStates=[],e._updateCountMark=0,e}return C(n,[{key:"getInstanceBatchOpaquaMark",value:function(e,t,n,i){e=this._instanceBatchOpaqueMarks[e?0:1]||(this._instanceBatchOpaqueMarks[e?0:1]=[]),t=e[t]||(e[t]=[]),n=t[n]||(t[n]=[]);return n[i?1:0]||(n[i?1:0]=new Sa)}},{key:"getVertexBatchOpaquaMark",value:function(e,t,n,i){e=this._vertexBatchOpaqueMarks[e]||(this._vertexBatchOpaqueMarks[e]=[]),t=e[t?0:1]||(e[t?0:1]=[]),n=t[n]||(t[n]=[]);return n[i]||(n[i]=new Sa)}},{key:"_getBufferState",value:function(e){var t,n,i=this._cacheBufferStates[e.id];return i||(t=yr.instance,(i=new Ga).bind(),(n=t._vertexBuffer).vertexDeclaration=e,i.applyVertexBuffer(n),i.applyIndexBuffer(t._indexBuffer),i.unBind(),this._cacheBufferStates[e.id]=i),i}},{key:"_getBatchRenderElementFromPool",value:function(){var e=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];return e||(e=new rr,(this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=e).vertexBatchElementList=new sr,e.instanceBatchElementList=new sr),e}},{key:"_clear",value:function(){G(z(n.prototype),"_clear",this).call(this),this._updateCountMark++}}]),n}();vr.instance=new vr;var pr=function(){T(s,ga);var n=b(s);function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return S(this,s),(t=n.call(this,t))._meshFilter=new ka(u(t)),t._render=new gr(u(t)),e&&(t._meshFilter.sharedMesh=e),t}return C(s,[{key:"_parse",value:function(e,t){G(z(s.prototype),"_parse",this).call(this,e,t);var n=this.meshRenderer,t=e.lightmapIndex;null!=t&&(n.lightmapIndex=t);t=e.lightmapScaleOffset;t&&(n.lightmapScaleOffset=new yn(t[0],t[1],t[2],t[3])),null!=e.meshPath&&(this.meshFilter.sharedMesh=on.getRes(e.meshPath)),null!=e.enableRender&&(this.meshRenderer.enable=e.enableRender);var i=e.materials;if(i){var a=n.sharedMaterials,r=i.length;a.length=r;for(var o=0;o<r;o++)a[o]=on.getRes(i[o].path);n.sharedMaterials=a}}},{key:"_addToInitStaticBatchManager",value:function(){this.meshFilter.sharedMesh&&lr.instance._addBatchSprite(this)}},{key:"_cloneTo",value:function(e,t,n){var i=e;i._meshFilter.sharedMesh=this._meshFilter.sharedMesh;var a=this._render,r=i._render;r.enable=a.enable,r.sharedMaterials=a.sharedMaterials,r.castShadow=a.castShadow;i=a.lightmapScaleOffset;i&&(r.lightmapScaleOffset=i.clone()),r.lightmapIndex=a.lightmapIndex,r.receiveShadow=a.receiveShadow,r.sortingFudge=a.sortingFudge,G(z(s.prototype),"_cloneTo",this).call(this,e,t,n)}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.destroyed||(G(z(s.prototype),"destroy",this).call(this,e),this._meshFilter.destroy())}},{key:"_create",value:function(){return new s}},{key:"meshFilter",get:function(){return this._meshFilter}},{key:"meshRenderer",get:function(){return this._render}}],[{key:"__init__",value:function(){xa.SHADERDEFINE_UV0=ca.getDefineByName("UV"),xa.SHADERDEFINE_COLOR=ca.getDefineByName("COLOR"),xa.SHADERDEFINE_UV1=ca.getDefineByName("UV1"),xa.SHADERDEFINE_GPU_INSTANCE=ca.getDefineByName("GPU_INSTANCE"),Ma._registerManager(lr.instance),Ea._registerManager(vr.instance)}}]),s}(),mr=function(){T(i,vi);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return S(this,i),(e=n.call(this)).text=t,e}return C(i,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(i.prototype),"destroy",this).call(this,e),this._tf=null}},{key:"createChildren",value:function(){this.addChild(this._tf=new Ut)}},{key:"changeText",value:function(e){this._tf.changeText(e)}},{key:"measureWidth",value:function(){return this._tf.width}},{key:"measureHeight",value:function(){return this._tf.height}},{key:"text",get:function(){return this._tf.text},set:function(e){this._tf.text!=e&&(e=e&&yi.adptString(e+""),this._tf.text=e,this.event(Je.CHANGE),this._width&&this._height||this.onCompResize())}},{key:"wordWrap",get:function(){return this._tf.wordWrap},set:function(e){this._tf.wordWrap=e}},{key:"color",get:function(){return this._tf.color},set:function(e){this._tf.color=e}},{key:"font",get:function(){return this._tf.font},set:function(e){this._tf.font=e}},{key:"align",get:function(){return this._tf.align},set:function(e){this._tf.align=e}},{key:"valign",get:function(){return this._tf.valign},set:function(e){this._tf.valign=e}},{key:"bold",get:function(){return this._tf.bold},set:function(e){this._tf.bold=e}},{key:"italic",get:function(){return this._tf.italic},set:function(e){this._tf.italic=e}},{key:"leading",get:function(){return this._tf.leading},set:function(e){this._tf.leading=e}},{key:"fontSize",get:function(){return this._tf.fontSize},set:function(e){this._tf.fontSize=e}},{key:"padding",get:function(){return this._tf.padding.join(",")},set:function(e){this._tf.padding=yi.fillArray(ci.labelPadding,e,Number)}},{key:"bgColor",get:function(){return this._tf.bgColor},set:function(e){this._tf.bgColor=e}},{key:"borderColor",get:function(){return this._tf.borderColor},set:function(e){this._tf.borderColor=e}},{key:"stroke",get:function(){return this._tf.stroke},set:function(e){this._tf.stroke=e}},{key:"strokeColor",get:function(){return this._tf.strokeColor},set:function(e){this._tf.strokeColor=e}},{key:"textField",get:function(){return this._tf}},{key:"width",get:function(){return this._width||this._tf.text?G(z(i.prototype),"width",this):0},set:function(e){s(z(i.prototype),"width",e,this,!0),this._tf.width=e}},{key:"height",get:function(){return this._height||this._tf.text?G(z(i.prototype),"height",this):0},set:function(e){s(z(i.prototype),"height",e,this,!0),this._tf.height=e}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.text=e+"":s(z(i.prototype),"dataSource",e,this,!0)},get:function(){return G(z(i.prototype),"dataSource",this)}},{key:"overflow",get:function(){return this._tf.overflow},set:function(e){this._tf.overflow=e}},{key:"underline",get:function(){return this._tf.underline},set:function(e){this._tf.underline=e}},{key:"underlineColor",get:function(){return this._tf.underlineColor},set:function(e){this._tf.underlineColor=e}}]),i}();function wr(){S(this,wr),this.succeeded=!1,this.collider=null,this.point=new vn,this.normal=new vn,this.hitFraction=0}M.regClass(mr),Dt.regClass("laya.ui.Label",mr),Dt.regClass("Laya.Label",mr);var xr=function(){T(t,sr);var e=b(t);function t(){return S(this,t),e.call(this)}return C(t,[{key:"add",value:function(e){if(-1!==e._indexInCastShadowList)throw"CastShadowList:element has  in  CastShadowList.";this._add(e),e._indexInCastShadowList=this.length++}},{key:"remove",value:function(e){var t,n=e._indexInCastShadowList;this.length--,n!==this.length&&(t=this.elements[this.length],(this.elements[n]=t)._indexInCastShadowList=n),e._indexInCastShadowList=-1}}]),t}(),kr=function(){T(t,sr);var e=b(t);function t(){return S(this,t),e.call(this)}return C(t,[{key:"add",value:function(e){e._getIndexInList();this._add(e),e._setIndexInList(this.length++)}},{key:"remove",value:function(e){var t,n=e._getIndexInList();this.length--,n!==this.length&&(t=this.elements[this.length],(this.elements[n]=t)._setIndexInList(n)),e._setIndexInList(-1)}}]),t}(),Tr=function e(){S(this,e),this._pressedSprite=null,this._pressedLoopCount=-1,this.sprite=null,this.mousePositionX=0,this.mousePositionY=0},Er=function(){function e(){S(this,e),this._indexInList=-1,this._identifier=-1,this._position=new gn}return C(e,[{key:"_getIndexInList",value:function(){return this._indexInList}},{key:"_setIndexInList",value:function(e){this._indexInList=e}},{key:"identifier",get:function(){return this._identifier}},{key:"position",get:function(){return this._position}}]),e}(),Mr=function(){function e(){S(this,e)}return C(e,null,[{key:"setColliderCollision",value:function(e,t,n){}},{key:"getIColliderCollision",value:function(e,t){return!1}}]),e}();function br(){S(this,br),this._idCounter=0,this.colliderA=null,this.colliderB=null,this.distance=0,this.normal=new vn,this.positionOnA=new vn,this.positionOnB=new vn,this._id=++this._idCounter}Mr.COLLISIONFILTERGROUP_DEFAULTFILTER=1,Mr.COLLISIONFILTERGROUP_STATICFILTER=2,Mr.COLLISIONFILTERGROUP_KINEMATICFILTER=4,Mr.COLLISIONFILTERGROUP_DEBRISFILTER=8,Mr.COLLISIONFILTERGROUP_SENSORTRIGGER=16,Mr.COLLISIONFILTERGROUP_CHARACTERFILTER=32,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER1=64,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER2=128,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER3=256,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER4=512,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER5=1024,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER6=2048,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER7=4096,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER8=8192,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER9=16384,Mr.COLLISIONFILTERGROUP_CUSTOMFILTER10=32768,Mr.COLLISIONFILTERGROUP_ALLFILTER=-1,Mr.gravity=new vn(0,-9.81,0);var Sr=function(){T(t,sr);var e=b(t);function t(){return S(this,t),e.call(this)}return C(t,[{key:"add",value:function(e){if(-1!==e._inPhysicUpdateListIndex)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(e),e._inPhysicUpdateListIndex=this.length++}},{key:"remove",value:function(e){var t,n=e._inPhysicUpdateListIndex;this.length--,n!==this.length&&(t=this.elements[this.length],(this.elements[n]=t)._inPhysicUpdateListIndex=n),e._inPhysicUpdateListIndex=-1}}]),t}(),Ir=function(){function e(){S(this,e),this._lastUpdateFrame=-2147483648,this._updateFrame=-2147483648,this._isTrigger=!1,this.contacts=[]}return C(e,[{key:"_setUpdateFrame",value:function(e){this._lastUpdateFrame=this._updateFrame,this._updateFrame=e}}]),e}(),Nr=function(){function e(){S(this,e),this._hitResultsPoolIndex=0,this._hitResultsPool=[],this._contactPonintsPoolIndex=0,this._contactPointsPool=[],this._collisionsPool=[],this._collisions={}}return C(e,[{key:"getHitResult",value:function(){var e=this._hitResultsPool[this._hitResultsPoolIndex++];return e||(e=new wr,this._hitResultsPool.push(e)),e}},{key:"recoverAllHitResultsPool",value:function(){this._hitResultsPoolIndex=0}},{key:"getContactPoints",value:function(){var e=this._contactPointsPool[this._contactPonintsPoolIndex++];return e||(e=new br,this._contactPointsPool.push(e)),e}},{key:"recoverAllContactPointsPool",value:function(){this._contactPonintsPoolIndex=0}},{key:"getCollision",value:function(e,t){var n,i=e.id,a=t.id,r=this._collisions[i];return(n=r?r[a]:n)||(r||(r={},this._collisions[i]=r),(n=0===this._collisionsPool.length?new Ir:this._collisionsPool.pop())._colliderA=e,n._colliderB=t,r[a]=n),n}},{key:"recoverCollision",value:function(e){var t=e._colliderA.id,n=e._colliderB.id;this._collisions[t][n]=null,this._collisionsPool.push(e)}},{key:"garbageCollection",value:function(){for(var e in this._hitResultsPoolIndex=0,this._hitResultsPool.length=0,this._contactPonintsPoolIndex=0,this._contactPointsPool.length=0,this._collisionsPool.length=0,this._collisionsPool){var t,n=this._collisionsPool[e],i=!0;for(t in n)n[t]?i=!1:delete n[t];i&&delete this._collisionsPool[e]}}}]),e}(),Rr=function e(){S(this,e)};Rr._physics3D=null,Rr._enbalePhysics=!1;var Cr=function(){function t(){S(this,t),this._scale=new vn(1,1,1),this._centerMatrix=new ki,this._attatched=!1,this._indexInCompound=-1,this._compoundParent=null,this._attatchedCollisionObject=null,this._referenceCount=0,this._localOffset=new vn(0,0,0),this._localRotation=new xi(0,0,0,1),this.needsCustomCollisionCallback=!1}return C(t,[{key:"_setScale",value:function(e){this._compoundParent?this.updateLocalTransformations():(t._nativeScale.setValue(e.x,e.y,e.z),this._nativeShape.setLocalScaling(t._nativeScale))}},{key:"_addReference",value:function(){this._referenceCount++}},{key:"_removeReference",value:function(){this._referenceCount--}},{key:"updateLocalTransformations",value:function(){var e;this._compoundParent?(e=t._tempVector30,vn.multiply(this.localOffset,this._scale,e),t._createAffineTransformation(e,this.localRotation,this._centerMatrix.elements)):t._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)}},{key:"cloneTo",value:function(e){this._localOffset.cloneTo(e.localOffset),this._localRotation.cloneTo(e.localRotation),e.localOffset=e.localOffset,e.localRotation=e.localRotation}},{key:"clone",value:function(){return null}},{key:"destroy",value:function(){this._nativeShape&&(Rr._physics3D.destroy(this._nativeShape),this._nativeShape=null)}},{key:"type",get:function(){return this._type}},{key:"localOffset",get:function(){return this._localOffset},set:function(e){this._localOffset=e,this._compoundParent&&this._compoundParent._updateChildTransform(this)}},{key:"localRotation",get:function(){return this._localRotation},set:function(e){this._localRotation=e,this._compoundParent&&this._compoundParent._updateChildTransform(this)}}],[{key:"__init__",value:function(){t._nativeScale=new Rr._physics3D.btVector3(1,1,1),t._nativeVector30=new Rr._physics3D.btVector3(0,0,0),t._nativQuaternion0=new Rr._physics3D.btQuaternion(0,0,0,1),t._nativeTransform0=new Rr._physics3D.btTransform}},{key:"_createAffineTransformation",value:function(e,t,n){var i=t.x,a=t.y,r=t.z,o=t.w,s=i+i,l=a+a,h=r+r,u=i*s,d=i*l,t=i*h,i=a*l,a=a*h,r=r*h,s=o*s,l=o*l,h=o*h;n[0]=1-(i+r),n[1]=d+h,n[2]=t-l,n[3]=0,n[4]=d-h,n[5]=1-(u+r),n[6]=a+s,n[7]=0,n[8]=t+l,n[9]=a-s,n[10]=1-(u+i),n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1}}]),t}();Cr.SHAPEORIENTATION_UPX=0,Cr.SHAPEORIENTATION_UPY=1,Cr.SHAPEORIENTATION_UPZ=2,Cr.SHAPETYPES_BOX=0,Cr.SHAPETYPES_SPHERE=1,Cr.SHAPETYPES_CYLINDER=2,Cr.SHAPETYPES_CAPSULE=3,Cr.SHAPETYPES_CONVEXHULL=4,Cr.SHAPETYPES_COMPOUND=5,Cr.SHAPETYPES_STATICPLANE=6,Cr.SHAPETYPES_CONE=7,Cr._tempVector30=new vn;var Ar=function(){T(r,Cr);var a=b(r);function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return S(this,r),(e=a.call(this))._sizeX=t,e._sizeY=n,e._sizeZ=i,e._type=Cr.SHAPETYPES_BOX,r._nativeSize.setValue(t/2,n/2,i/2),e._nativeShape=new Rr._physics3D.btBoxShape(r._nativeSize),e}return C(r,[{key:"clone",value:function(){var e=new r(this._sizeX,this._sizeY,this._sizeZ);return this.cloneTo(e),e}},{key:"sizeX",get:function(){return this._sizeX}},{key:"sizeY",get:function(){return this._sizeY}},{key:"sizeZ",get:function(){return this._sizeZ}}],[{key:"__init__",value:function(){r._nativeSize=new Rr._physics3D.btVector3(0,0,0)}}]),r}(),Dr=function(){T(r,Cr);var a=b(r);function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1.25,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Cr.SHAPEORIENTATION_UPY;switch(S(this,r),(e=a.call(this))._radius=t,e._length=n,e._orientation=i,e._type=Cr.SHAPETYPES_CAPSULE,i){case Cr.SHAPEORIENTATION_UPX:e._nativeShape=new Rr._physics3D.btCapsuleShapeX(t,n-2*t);break;case Cr.SHAPEORIENTATION_UPY:e._nativeShape=new Rr._physics3D.btCapsuleShape(t,n-2*t);break;case Cr.SHAPEORIENTATION_UPZ:e._nativeShape=new Rr._physics3D.btCapsuleShapeZ(t,n-2*t);break;default:throw"CapsuleColliderShape:unknown orientation."}return e}return C(r,[{key:"_setScale",value:function(e){var t=r._tempVector30;switch(this.orientation){case Cr.SHAPEORIENTATION_UPX:t.x=e.x,t.y=t.z=Math.max(e.y,e.z);break;case Cr.SHAPEORIENTATION_UPY:t.y=e.y,t.x=t.z=Math.max(e.x,e.z);break;case Cr.SHAPEORIENTATION_UPZ:t.z=e.z,t.x=t.y=Math.max(e.x,e.y);break;default:throw"CapsuleColliderShape:unknown orientation."}G(z(r.prototype),"_setScale",this).call(this,t)}},{key:"clone",value:function(){var e=new r(this._radius,this._length,this._orientation);return this.cloneTo(e),e}},{key:"radius",get:function(){return this._radius}},{key:"length",get:function(){return this._length}},{key:"orientation",get:function(){return this._orientation}}]),r}();Dr._tempVector30=new vn;var Lr=function(){T(i,Cr);var t=b(i);function i(){var e;return S(this,i),(e=t.call(this))._childColliderShapes=[],e._type=Cr.SHAPETYPES_COMPOUND,e._nativeShape=new Rr._physics3D.btCompoundShape,e}return C(i,[{key:"_clearChildShape",value:function(e){e._attatched=!1,e._compoundParent=null,e._indexInCompound=-1}},{key:"_addReference",value:function(){}},{key:"_removeReference",value:function(){}},{key:"_updateChildTransform",value:function(e){var t=e.localOffset,n=e.localRotation,i=Cr._nativeVector30,a=Cr._nativQuaternion0,r=Cr._nativeTransform0;i.setValue(-t.x,t.y,t.z),a.setValue(-n.x,n.y,n.z,-n.w),r.setOrigin(i),r.setRotation(a),this._nativeShape.updateChildTransform(e._indexInCompound,r,!0)}},{key:"addChildShape",value:function(e){if(e._attatched)throw"CompoundColliderShape: this shape has attatched to other entity.";e._attatched=!0,e._compoundParent=this,e._indexInCompound=this._childColliderShapes.length,this._childColliderShapes.push(e);var t=e.localOffset,n=e.localRotation;i._nativeOffset.setValue(-t.x,t.y,t.z),i._nativRotation.setValue(-n.x,n.y,n.z,-n.w),i._nativeTransform.setOrigin(i._nativeOffset),i._nativeTransform.setRotation(i._nativRotation);n=this._nativeShape.getLocalScaling();this._nativeShape.setLocalScaling(i._nativeVector3One),this._nativeShape.addChildShape(i._nativeTransform,e._nativeShape),this._nativeShape.setLocalScaling(n),this._attatchedCollisionObject&&(this._attatchedCollisionObject.colliderShape=this)}},{key:"removeChildShape",value:function(e){var t;e._compoundParent===this&&(t=e._indexInCompound,this._clearChildShape(e),(e=this._childColliderShapes[this._childColliderShapes.length-1])._indexInCompound=t,this._childColliderShapes[t]=e,this._childColliderShapes.pop(),this._nativeShape.removeChildShapeByIndex(t))}},{key:"clearChildShape",value:function(){for(var e=0,t=this._childColliderShapes.length;e<t;e++)this._clearChildShape(this._childColliderShapes[e]),this._nativeShape.removeChildShapeByIndex(0);this._childColliderShapes.length=0}},{key:"getChildShapeCount",value:function(){return this._childColliderShapes.length}},{key:"cloneTo",value:function(e){var t=e;t.clearChildShape();for(var n=0,i=this._childColliderShapes.length;n<i;n++)t.addChildShape(this._childColliderShapes[n].clone())}},{key:"clone",value:function(){var e=new i;return this.cloneTo(e),e}},{key:"destroy",value:function(){G(z(i.prototype),"destroy",this).call(this);for(var e=0,t=this._childColliderShapes.length;e<t;e++){var n=this._childColliderShapes[e];0===n._referenceCount&&n.destroy()}}}],[{key:"__init__",value:function(){i._nativeVector3One=new Rr._physics3D.btVector3(1,1,1),i._nativeTransform=new Rr._physics3D.btTransform,i._nativeOffset=new Rr._physics3D.btVector3(0,0,0),i._nativRotation=new Rr._physics3D.btQuaternion(0,0,0,1)}}]),i}(),Or=function(){T(r,Cr);var a=b(r);function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Cr.SHAPEORIENTATION_UPY;switch(S(this,r),(e=a.call(this))._radius=1,e._height=.5,e._radius=t,e._height=n,e._orientation=i,e._type=Cr.SHAPETYPES_CYLINDER,i){case Cr.SHAPEORIENTATION_UPX:e._nativeShape=new Rr._physics3D.btConeShapeX(t,n);break;case Cr.SHAPEORIENTATION_UPY:e._nativeShape=new Rr._physics3D.btConeShape(t,n);break;case Cr.SHAPEORIENTATION_UPZ:e._nativeShape=new Rr._physics3D.btConeShapeZ(t,n);break;default:throw"ConeColliderShape:unknown orientation."}return e}return C(r,[{key:"clone",value:function(){var e=new r(this._radius,this._height,this._orientation);return this.cloneTo(e),e}},{key:"radius",get:function(){return this._radius}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}}]),r}(),Pr=function(){T(r,Cr);var a=b(r);function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Cr.SHAPEORIENTATION_UPY;switch(S(this,r),(e=a.call(this))._radius=1,e._height=.5,e._radius=t,e._height=n,e._orientation=i,e._type=Cr.SHAPETYPES_CYLINDER,i){case Cr.SHAPEORIENTATION_UPX:r._nativeSize.setValue(n/2,t,t),e._nativeShape=new Rr._physics3D.btCylinderShapeX(r._nativeSize);break;case Cr.SHAPEORIENTATION_UPY:r._nativeSize.setValue(t,n/2,t),e._nativeShape=new Rr._physics3D.btCylinderShape(r._nativeSize);break;case Cr.SHAPEORIENTATION_UPZ:r._nativeSize.setValue(t,t,n/2),e._nativeShape=new Rr._physics3D.btCylinderShapeZ(r._nativeSize);break;default:throw"CapsuleColliderShape:unknown orientation."}return e}return C(r,[{key:"clone",value:function(){var e=new r(this._radius,this._height,this._orientation);return this.cloneTo(e),e}},{key:"radius",get:function(){return this._radius}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}}],[{key:"__init__",value:function(){r._nativeSize=new Rr._physics3D.btVector3(0,0,0)}}]),r}(),Fr=function(){T(n,Cr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._mesh=null,e._convex=!1,e}return C(n,[{key:"_setScale",value:function(e){this._compoundParent?this.updateLocalTransformations():(Cr._nativeScale.setValue(e.x,e.y,e.z),this._nativeShape.setLocalScaling(Cr._nativeScale),this._nativeShape.updateBound())}},{key:"cloneTo",value:function(e){var t=e;t.convex=this._convex,t.mesh=this._mesh,G(z(n.prototype),"cloneTo",this).call(this,e)}},{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"destroy",value:function(){this._nativeShape&&(Rr._physics3D.destroy(this._nativeShape),this._nativeShape=null)}},{key:"mesh",get:function(){return this._mesh},set:function(e){var t;this._mesh!==e&&(t=Rr._physics3D,this._mesh&&t.destroy(this._nativeShape),e&&(this._nativeShape=new Rr._physics3D.btGImpactMeshShape(e._getPhysicMesh()),this._nativeShape.updateBound()),this._mesh=e)}},{key:"convex",get:function(){return this._convex},set:function(e){this._convex=e}}]),n}(),Br=function(){T(i,Cr);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5;return S(this,i),(e=n.call(this))._radius=t,e._type=Cr.SHAPETYPES_SPHERE,e._nativeShape=new Rr._physics3D.btSphereShape(t),e}return C(i,[{key:"clone",value:function(){var e=new i(this._radius);return this.cloneTo(e),e}},{key:"radius",get:function(){return this._radius}}]),i}(),Vr=function(){T(d,wn);var i=b(d);function d(e,t){var n;return S(this,d),(n=i.call(this))._restitution=0,n._friction=.5,n._rollingFriction=0,n._ccdMotionThreshold=0,n._ccdSweptSphereRadius=0,n._collisionGroup=Mr.COLLISIONFILTERGROUP_DEFAULTFILTER,n._canCollideWith=Mr.COLLISIONFILTERGROUP_ALLFILTER,n._colliderShape=null,n._transformFlag=2147483647,n._enableProcessCollisions=!0,n._inPhysicUpdateListIndex=-1,n.canScaleShape=!0,n._collisionGroup=e,n._canCollideWith=t,d._physicObjectsMap[n.id]=u(n),n}return C(d,[{key:"_isValid",value:function(){return this._simulation&&this._colliderShape&&this._enabled}},{key:"_parse",value:function(e){null!=e.collisionGroup&&(this.collisionGroup=e.collisionGroup),null!=e.canCollideWith&&(this.canCollideWith=e.canCollideWith),null!=e.ccdMotionThreshold&&(this.ccdMotionThreshold=e.ccdMotionThreshold),null!=e.ccdSweptSphereRadius&&(this.ccdSweptSphereRadius=e.ccdSweptSphereRadius)}},{key:"_parseShape",value:function(e){var t=e.length;if(1===t){var n=d._creatShape(e[0]);this.colliderShape=n}else{for(var i=new Lr,a=0;a<t;a++)n=d._creatShape(e[a]),i.addChildShape(n);this.colliderShape=i}}},{key:"_onScaleChange",value:function(e){this._colliderShape._setScale(e)}},{key:"_setTransformFlag",value:function(e,t){t?this._transformFlag|=e:this._transformFlag&=~e}},{key:"_getTransformFlag",value:function(e){return 0!=(this._transformFlag&e)}},{key:"_addToSimulation",value:function(){}},{key:"_removeFromSimulation",value:function(){}},{key:"_derivePhysicsTransformation",value:function(e){this._innerDerivePhysicsTransformation(this._nativeColliderObject.getWorldTransform(),e)}},{key:"_innerDerivePhysicsTransformation",value:function(e,t){var n,i,a,r,o=this.owner._transform,s=o.rotation;(t||this._getTransformFlag(_a.TRANSFORM_WORLDPOSITION))&&(n=this._colliderShape.localOffset,a=o.position,r=d._nativeVector30,0!==n.x||0!==n.y||0!==n.z?(i=d._tempVector30,d.physicVector3TransformQuat(n,s.x,s.y,s.z,s.w,i),vn.add(a,i,i),r.setValue(-i.x,i.y,i.z)):r.setValue(-a.x,a.y,a.z),e.setOrigin(r),this._setTransformFlag(_a.TRANSFORM_WORLDPOSITION,!1)),(t||this._getTransformFlag(_a.TRANSFORM_WORLDQUATERNION))&&(i=this._colliderShape.localRotation,a=d._nativeQuaternion0,0!==i.x||0!==i.y||0!==i.z||1!==i.w?(r=d._tempQuaternion0,d.physicQuaternionMultiply(s.x,s.y,s.z,s.w,i,r),a.setValue(-r.x,r.y,r.z,-r.w)):a.setValue(-s.x,s.y,s.z,-s.w),e.setRotation(a),this._setTransformFlag(_a.TRANSFORM_WORLDQUATERNION,!1)),(t||this._getTransformFlag(_a.TRANSFORM_WORLDSCALE))&&(this._onScaleChange(o.getWorldLossyScale()),this._setTransformFlag(_a.TRANSFORM_WORLDSCALE,!1))}},{key:"_updateTransformComponent",value:function(e){var t=this._colliderShape.localOffset,n=this._colliderShape.localRotation,i=this.owner._transform,a=i.position,r=i.rotation,o=e.getOrigin(),s=e.getRotation(),l=-s.x(),h=s.y(),u=s.z(),e=-s.w();0!==t.x||0!==t.y||0!==t.z?(s=d._tempVector30,d.physicVector3TransformQuat(t,l,h,u,e,s),a.x=-o.x()-s.x,a.y=o.y()-s.y,a.z=o.z()-s.z):(a.x=-o.x(),a.y=o.y(),a.z=o.z()),i.position=a,0!==n.x||0!==n.y||0!==n.z||1!==n.w?(a=d._tempQuaternion0,n.invert(a),d.physicQuaternionMultiply(l,h,u,e,a,r)):(r.x=l,r.y=h,r.z=u,r.w=e),i.rotation=r}},{key:"_onEnable",value:function(){this._simulation=this.owner._scene.physicsSimulation,this._nativeColliderObject.setContactProcessingThreshold(1e30),this._colliderShape&&this._enabled&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}},{key:"_onDisable",value:function(){this._colliderShape&&this._enabled&&(this._removeFromSimulation(),-1!==this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.remove(this)),this._simulation=null}},{key:"_onShapeChange",value:function(e){var t=this._nativeColliderObject,n=t.getCollisionFlags();e.needsCustomCollisionCallback?0==(n&d.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)&&t.setCollisionFlags(n|d.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK):0<(n&d.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)&&t.setCollisionFlags(n^d.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)}},{key:"_onAdded",value:function(){this.enabled=this._enabled,this.restitution=this._restitution,this.friction=this._friction,this.rollingFriction=this._rollingFriction,this.ccdMotionThreshold=this._ccdMotionThreshold,this.ccdSweptSphereRadius=this._ccdSweptSphereRadius,this.owner.transform.on(Je.TRANSFORM_CHANGED,this,this._onTransformChanged)}},{key:"_onDestroy",value:function(){var e=Rr._physics3D;delete d._physicObjectsMap[this.id],e.destroy(this._nativeColliderObject),this._colliderShape.destroy(),G(z(d.prototype),"_onDestroy",this).call(this),this._nativeColliderObject=null,this._colliderShape=null,this._simulation=null,this.owner.transform.off(Je.TRANSFORM_CHANGED,this,this._onTransformChanged)}},{key:"_onTransformChanged",value:function(e){d._addUpdateList&&(e&=_a.TRANSFORM_WORLDPOSITION|_a.TRANSFORM_WORLDQUATERNION|_a.TRANSFORM_WORLDSCALE)&&(this._transformFlag|=e,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))}},{key:"_cloneTo",value:function(e){e.restitution=this._restitution,e.friction=this._friction,e.rollingFriction=this._rollingFriction,e.ccdMotionThreshold=this._ccdMotionThreshold,e.ccdSweptSphereRadius=this._ccdSweptSphereRadius,e.collisionGroup=this._collisionGroup,e.canCollideWith=this._canCollideWith,e.canScaleShape=this.canScaleShape,this._colliderShape&&(e.colliderShape=this._colliderShape.clone())}},{key:"restitution",get:function(){return this._restitution},set:function(e){this._restitution=e,this._nativeColliderObject&&this._nativeColliderObject.setRestitution(e)}},{key:"friction",get:function(){return this._friction},set:function(e){this._friction=e,this._nativeColliderObject&&this._nativeColliderObject.setFriction(e)}},{key:"rollingFriction",get:function(){return this._nativeColliderObject.getRollingFriction()},set:function(e){this._rollingFriction=e,this._nativeColliderObject&&this._nativeColliderObject.setRollingFriction(e)}},{key:"ccdMotionThreshold",get:function(){return this._ccdMotionThreshold},set:function(e){this._ccdMotionThreshold=e,this._nativeColliderObject&&this._nativeColliderObject.setCcdMotionThreshold(e)}},{key:"ccdSweptSphereRadius",get:function(){return this._ccdSweptSphereRadius},set:function(e){this._ccdSweptSphereRadius=e,this._nativeColliderObject&&this._nativeColliderObject.setCcdSweptSphereRadius(e)}},{key:"isActive",get:function(){return!!this._nativeColliderObject&&this._nativeColliderObject.isActive()}},{key:"enabled",get:function(){return G(z(d.prototype),"enabled",this)},set:function(e){this._enabled!=e&&(this._simulation&&this._colliderShape&&(e?(this._derivePhysicsTransformation(!0),this._addToSimulation()):this._removeFromSimulation()),s(z(d.prototype),"enabled",e,this,!0))}},{key:"colliderShape",get:function(){return this._colliderShape},set:function(e){var t,n=this._colliderShape;if(n&&(n._attatched=!1,n._attatchedCollisionObject=null),this._colliderShape=e){if(e._attatched)throw"PhysicsComponent: this shape has attatched to other entity.";e._attatched=!0,(e._attatchedCollisionObject=this)._nativeColliderObject&&(this._nativeColliderObject.setCollisionShape(e._nativeShape),(t=this._simulation&&this._enabled)&&n&&this._removeFromSimulation(),this._onShapeChange(e),t&&(this._derivePhysicsTransformation(!0),this._addToSimulation()))}else this._simulation&&this._enabled&&n&&this._removeFromSimulation()}},{key:"simulation",get:function(){return this._simulation}},{key:"collisionGroup",get:function(){return this._collisionGroup},set:function(e){this._collisionGroup!==e&&(this._collisionGroup=e,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}},{key:"canCollideWith",get:function(){return this._canCollideWith},set:function(e){this._canCollideWith!==e&&(this._canCollideWith=e,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}}],[{key:"__init__",value:function(){d._nativeVector30=new Rr._physics3D.btVector3(0,0,0),d._nativeQuaternion0=new Rr._physics3D.btQuaternion(0,0,0,1)}},{key:"_createAffineTransformationArray",value:function(e,t,n,i,a,r,o,s,l){var h=i+i,u=a+a,d=r+r,c=i*h,_=i*u,f=i*d,g=a*u,i=a*d,a=r*d,r=o*h,h=o*u,u=o*d,o=s[0],d=s[1],s=s[2];l[0]=(1-(g+a))*o,l[1]=(_+u)*o,l[2]=(f-h)*o,l[3]=0,l[4]=(_-u)*d,l[5]=(1-(c+a))*d,l[6]=(i+r)*d,l[7]=0,l[8]=(f+h)*s,l[9]=(i-r)*s,l[10]=(1-(c+g))*s,l[11]=0,l[12]=e,l[13]=t,l[14]=n,l[15]=1}},{key:"_creatShape",value:function(e){var t;switch(e.type){case"BoxColliderShape":var n=e.size,i=n?new Ar(n[0],n[1],n[2]):new Ar;break;case"SphereColliderShape":i=new Br(e.radius);break;case"CapsuleColliderShape":i=new Dr(e.radius,e.height,e.orientation);break;case"MeshColliderShape":n=new Fr;e.mesh&&(n.mesh=on.getRes(e.mesh)),i=n;break;case"ConeColliderShape":i=new Or(e.radius,e.height,e.orientation);break;case"CylinderColliderShape":i=new Pr(e.radius,e.height,e.orientation);break;default:throw"unknown shape type."}return e.center&&((t=i.localOffset).fromArray(e.center),i.localOffset=t),i}},{key:"physicVector3TransformQuat",value:function(e,t,n,i,a,r){var o=e.x,s=e.y,l=e.z,h=a*o+n*l-i*s,u=a*s+i*o-t*l,e=a*l+t*s-n*o,l=-t*o-n*s-i*l;r.x=h*a+l*-t+u*-i-e*-n,r.y=u*a+l*-n+e*-t-h*-i,r.z=e*a+l*-i+h*-n-u*-t}},{key:"physicQuaternionMultiply",value:function(e,t,n,i,a,r){var o=a.x,s=a.y,l=a.z,h=a.w,u=t*l-n*s,d=n*o-e*l,c=e*s-t*o,a=e*o+t*s+n*l;r.x=e*h+o*i+u,r.y=t*h+s*i+d,r.z=n*h+l*i+c,r.w=i*h-a}}]),d}();Vr.ACTIVATIONSTATE_ACTIVE_TAG=1,Vr.ACTIVATIONSTATE_ISLAND_SLEEPING=2,Vr.ACTIVATIONSTATE_WANTS_DEACTIVATION=3,Vr.ACTIVATIONSTATE_DISABLE_DEACTIVATION=4,Vr.ACTIVATIONSTATE_DISABLE_SIMULATION=5,Vr.COLLISIONFLAGS_STATIC_OBJECT=1,Vr.COLLISIONFLAGS_KINEMATIC_OBJECT=2,Vr.COLLISIONFLAGS_NO_CONTACT_RESPONSE=4,Vr.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK=8,Vr.COLLISIONFLAGS_CHARACTER_OBJECT=16,Vr.COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT=32,Vr.COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING=64,Vr._tempVector30=new vn,Vr._tempQuaternion0=new xi,Vr._tempQuaternion1=new xi,Vr._tempMatrix4x40=new ki,Vr._physicObjectsMap={},Vr._addUpdateList=!0;var Ur=function(){function M(e){S(this,M),this._gravity=new vn(0,-10,0),this._nativeVector3Zero=new Rr._physics3D.btVector3(0,0,0),this._nativeDefaultQuaternion=new Rr._physics3D.btQuaternion(0,0,0,-1),this._collisionsUtils=new Nr,this._previousFrameCollisions=[],this._currentFrameCollisions=[],this._physicsUpdateList=new Sr,this._characters=[],this._updatedRigidbodies=0,this.maxSubSteps=1,this.fixedTimeStep=1/60,this.maxSubSteps=e.maxSubSteps,this.fixedTimeStep=e.fixedTimeStep;var t=Rr._physics3D;this._nativeCollisionConfiguration=new t.btDefaultCollisionConfiguration,this._nativeDispatcher=new t.btCollisionDispatcher(this._nativeCollisionConfiguration),this._nativeBroadphase=new t.btDbvtBroadphase,this._nativeBroadphase.getOverlappingPairCache().setInternalGhostPairCallback(new t.btGhostPairCallback);e=e.flags;if(e&M.PHYSICSENGINEFLAGS_COLLISIONSONLY)this._nativeCollisionWorld=new t.btCollisionWorld(this._nativeDispatcher,this._nativeBroadphase,this._nativeCollisionConfiguration);else{if(e&M.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT)throw"PhysicsSimulation:SoftBody processing is not yet available";e=new t.btSequentialImpulseConstraintSolver;this._nativeDiscreteDynamicsWorld=new t.btDiscreteDynamicsWorld(this._nativeDispatcher,this._nativeBroadphase,e,this._nativeCollisionConfiguration),this._nativeCollisionWorld=this._nativeDiscreteDynamicsWorld}this._nativeDiscreteDynamicsWorld&&(this._nativeSolverInfo=this._nativeDiscreteDynamicsWorld.getSolverInfo(),this._nativeDispatchInfo=this._nativeDiscreteDynamicsWorld.getDispatchInfo()),this._nativeClosestRayResultCallback=new t.ClosestRayResultCallback(this._nativeVector3Zero,this._nativeVector3Zero),this._nativeAllHitsRayResultCallback=new t.AllHitsRayResultCallback(this._nativeVector3Zero,this._nativeVector3Zero),this._nativeClosestConvexResultCallback=new t.ClosestConvexResultCallback(this._nativeVector3Zero,this._nativeVector3Zero),this._nativeAllConvexResultCallback=new t.AllConvexResultCallback(this._nativeVector3Zero,this._nativeVector3Zero),t._btGImpactCollisionAlgorithm_RegisterAlgorithm(this._nativeDispatcher.a)}return C(M,[{key:"_simulate",value:function(e){this._updatedRigidbodies=0,this._nativeDiscreteDynamicsWorld?this._nativeDiscreteDynamicsWorld.stepSimulation(e,this.maxSubSteps,this.fixedTimeStep):this._nativeCollisionWorld.PerformDiscreteCollisionDetection()}},{key:"_destroy",value:function(){var e=Rr._physics3D;this._nativeDiscreteDynamicsWorld?(e.destroy(this._nativeDiscreteDynamicsWorld),this._nativeDiscreteDynamicsWorld=null):(e.destroy(this._nativeCollisionWorld),this._nativeCollisionWorld=null),e.destroy(this._nativeBroadphase),this._nativeBroadphase=null,e.destroy(this._nativeDispatcher),this._nativeDispatcher=null,e.destroy(this._nativeCollisionConfiguration),this._nativeCollisionConfiguration=null}},{key:"_addPhysicsCollider",value:function(e,t,n){this._nativeCollisionWorld.addCollisionObject(e._nativeColliderObject,t,n)}},{key:"_removePhysicsCollider",value:function(e){this._nativeCollisionWorld.removeCollisionObject(e._nativeColliderObject)}},{key:"_addRigidBody",value:function(e,t,n){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeCollisionWorld.addRigidBody(e._nativeColliderObject,t,n)}},{key:"_removeRigidBody",value:function(e){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeCollisionWorld.removeRigidBody(e._nativeColliderObject)}},{key:"_addCharacter",value:function(e,t,n){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeCollisionWorld.addCollisionObject(e._nativeColliderObject,t,n),this._nativeCollisionWorld.addAction(e._nativeKinematicCharacter)}},{key:"_removeCharacter",value:function(e){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeCollisionWorld.removeCollisionObject(e._nativeColliderObject),this._nativeCollisionWorld.removeAction(e._nativeKinematicCharacter)}},{key:"raycastFromTo",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Mr.COLLISIONFILTERGROUP_ALLFILTER,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Mr.COLLISIONFILTERGROUP_ALLFILTER,r=this._nativeClosestRayResultCallback,o=M._nativeTempVector30,s=M._nativeTempVector31;return o.setValue(-e.x,e.y,e.z),s.setValue(-t.x,t.y,t.z),r.set_m_rayFromWorld(o),r.set_m_rayToWorld(s),r.set_m_collisionFilterGroup(i),r.set_m_collisionFilterMask(a),r.set_m_collisionObject(null),r.set_m_closestHitFraction(1),this._nativeCollisionWorld.rayTest(o,s,r),r.hasHit()?(n&&(n.succeeded=!0,n.collider=Vr._physicObjectsMap[r.get_m_collisionObject().getUserIndex()],n.hitFraction=r.get_m_closestHitFraction(),o=r.get_m_hitPointWorld(),(s=n.point).x=-o.x(),s.y=o.y(),s.z=o.z(),o=r.get_m_hitNormalWorld(),(r=n.normal).x=-o.x(),r.y=o.y(),r.z=o.z()),!0):(n&&(n.succeeded=!1),!1)}},{key:"raycastAllFromTo",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Mr.COLLISIONFILTERGROUP_ALLFILTER,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Mr.COLLISIONFILTERGROUP_ALLFILTER,r=this._nativeAllHitsRayResultCallback,o=M._nativeTempVector30,s=M._nativeTempVector31;n.length=0,o.setValue(-e.x,e.y,e.z),s.setValue(-t.x,t.y,t.z),r.set_m_rayFromWorld(o),r.set_m_rayToWorld(s),r.set_m_collisionFilterGroup(i),r.set_m_collisionFilterMask(a);var l=r.get_m_collisionObjects(),h=r.get_m_hitPointWorld(),u=r.get_m_hitNormalWorld(),d=r.get_m_hitFractions();l.clear(),h.clear(),u.clear(),d.clear(),this._nativeCollisionWorld.rayTest(o,s,r);var c=l.size();if(0<c){this._collisionsUtils.recoverAllHitResultsPool();for(var _=0;_<c;_++){var f=this._collisionsUtils.getHitResult();n.push(f),f.succeeded=!0,f.collider=Vr._physicObjectsMap[l.at(_).getUserIndex()],f.hitFraction=d.at(_);var g=h.at(_),y=f.point;y.x=-g.x(),y.y=g.y(),y.z=g.z();g=u.at(_),f=f.normal;f.x=-g.x(),f.y=g.y(),f.z=g.z()}return!0}return!1}},{key:"rayCast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2147483647,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Mr.COLLISIONFILTERGROUP_ALLFILTER,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Mr.COLLISIONFILTERGROUP_ALLFILTER,r=e.origin,o=M._tempVector30;return vn.normalize(e.direction,o),vn.scale(o,n,o),vn.add(r,o,o),this.raycastFromTo(r,o,t,i,a)}},{key:"rayCastAll",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2147483647,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Mr.COLLISIONFILTERGROUP_ALLFILTER,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Mr.COLLISIONFILTERGROUP_ALLFILTER,r=e.origin,o=M._tempVector30;return vn.normalize(e.direction,o),vn.scale(o,n,o),vn.add(r,o,o),this.raycastAllFromTo(r,o,t,i,a)}},{key:"shapeCast",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:Mr.COLLISIONFILTERGROUP_ALLFILTER,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:Mr.COLLISIONFILTERGROUP_ALLFILTER,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0,h=this._nativeClosestConvexResultCallback,u=M._nativeTempVector30,d=M._nativeTempVector31,c=M._nativeTempQuaternion0,_=M._nativeTempQuaternion1,f=M._nativeTempTransform0,g=M._nativeTempTransform1,e=e._nativeShape;return u.setValue(-t.x,t.y,t.z),d.setValue(-n.x,n.y,n.z),h.set_m_collisionFilterGroup(o),h.set_m_collisionFilterMask(s),f.setOrigin(u),g.setOrigin(d),a?(c.setValue(-a.x,a.y,a.z,-a.w),f.setRotation(c)):f.setRotation(this._nativeDefaultQuaternion),r?(_.setValue(-r.x,r.y,r.z,-r.w),g.setRotation(_)):g.setRotation(this._nativeDefaultQuaternion),h.set_m_hitCollisionObject(null),h.set_m_closestHitFraction(1),this._nativeCollisionWorld.convexSweepTest(e,f,g,h,l),h.hasHit()?(i&&(i.succeeded=!0,i.collider=Vr._physicObjectsMap[h.get_m_hitCollisionObject().getUserIndex()],i.hitFraction=h.get_m_closestHitFraction(),f=h.get_m_hitPointWorld(),g=h.get_m_hitNormalWorld(),l=i.point,h=i.normal,l.x=-f.x(),l.y=f.y(),l.z=f.z(),h.x=-g.x(),h.y=g.y(),h.z=g.z()),!0):(i&&(i.succeeded=!1),!1)}},{key:"shapeCastAll",value:function(e,t,n,i){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:Mr.COLLISIONFILTERGROUP_ALLFILTER,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:Mr.COLLISIONFILTERGROUP_ALLFILTER,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0,h=this._nativeAllConvexResultCallback,u=M._nativeTempVector30,d=M._nativeTempVector31,c=M._nativeTempQuaternion0,_=M._nativeTempQuaternion1,f=M._nativeTempTransform0,g=M._nativeTempTransform1,e=e._nativeShape;i.length=0,u.setValue(-t.x,t.y,t.z),d.setValue(-n.x,n.y,n.z),h.set_m_collisionFilterGroup(o),h.set_m_collisionFilterMask(s),f.setOrigin(u),g.setOrigin(d),a?(c.setValue(-a.x,a.y,a.z,-a.w),f.setRotation(c)):f.setRotation(this._nativeDefaultQuaternion),r?(_.setValue(-r.x,r.y,r.z,-r.w),g.setRotation(_)):g.setRotation(this._nativeDefaultQuaternion);var y=h.get_m_collisionObjects();y.clear(),this._nativeCollisionWorld.convexSweepTest(e,f,g,h,l);var v=y.size();if(0<v){for(var p=h.get_m_hitPointWorld(),m=h.get_m_hitNormalWorld(),w=h.get_m_hitFractions(),x=0;x<v;x++){var k=this._collisionsUtils.getHitResult();i.push(k),k.succeeded=!0,k.collider=Vr._physicObjectsMap[y.at(x).getUserIndex()],k.hitFraction=w.at(x);var T=p.at(x),E=k.point;E.x=-T.x(),E.y=T.y(),E.z=T.z();T=m.at(x),k=k.normal;k.x=-T.x(),k.y=T.y(),k.z=T.z()}return!0}return!1}},{key:"addConstraint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!this._nativeDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeDiscreteDynamicsWorld.addConstraint(e._nativeConstraint,t),e._simulation=this}},{key:"removeConstraint",value:function(e){if(!this._nativeDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeDiscreteDynamicsWorld.removeConstraint(e._nativeConstraint)}},{key:"_updatePhysicsTransformFromRender",value:function(){for(var e=this._physicsUpdateList.elements,t=0,n=this._physicsUpdateList.length;t<n;t++){var i=e[t];i._derivePhysicsTransformation(!1),i._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0}},{key:"_updateCharacters",value:function(){for(var e=0,t=this._characters.length;e<t;e++){var n=this._characters[e];n._updateTransformComponent(n._nativeColliderObject.getWorldTransform())}}},{key:"_updateCollisions",value:function(){this._collisionsUtils.recoverAllContactPointsPool();var e=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions,this._currentFrameCollisions.length=0,this._previousFrameCollisions=e;for(var t=J.loopCount,n=this._nativeDispatcher.getNumManifolds(),i=0;i<n;i++){var a,r,o,s,l=this._nativeDispatcher.getManifoldByIndexInternal(i),h=Vr._physicObjectsMap[l.getBody0().getUserIndex()],u=Vr._physicObjectsMap[l.getBody1().getUserIndex()],d=null,c=null;if((h.isTrigger||u.isTrigger)&&(h.owner._needProcessTriggers||u.owner._needProcessTriggers))for(var _=l.getNumContacts(),f=0;f<_;f++){var g=l.getContactPoint(f),y=g.getDistance();if(y<=0){c=(d=this._collisionsUtils.getCollision(h,u)).contacts,(a=d._updateFrame!==t)&&(d._isTrigger=!0,c.length=0);break}}else if((h.owner._needProcessCollisions||u.owner._needProcessCollisions)&&(h._enableProcessCollisions||u._enableProcessCollisions))for(_=l.getNumContacts(),f=0;f<_;f++)(y=(g=l.getContactPoint(f)).getDistance())<=0&&((r=this._collisionsUtils.getContactPoints()).colliderA=h,r.colliderB=u,r.distance=y,o=g.get_m_normalWorldOnB(),(s=r.normal).x=-o.x(),s.y=o.y(),s.z=o.z(),s=g.get_m_positionWorldOnA(),(o=r.positionOnA).x=-s.x(),o.y=s.y(),o.z=s.z(),o=g.get_m_positionWorldOnB(),(s=r.positionOnB).x=-o.x(),s.y=o.y(),s.z=o.z(),d||(c=(d=this._collisionsUtils.getCollision(h,u)).contacts,(a=d._updateFrame!==t)&&(d._isTrigger=!1,c.length=0)),c.push(r));d&&a&&(this._currentFrameCollisions.push(d),d._setUpdateFrame(t))}}},{key:"_eventScripts",value:function(){for(var e=J.loopCount,t=0,n=this._currentFrameCollisions.length;t<n;t++){var i=this._currentFrameCollisions[t],a=i._colliderA,r=i._colliderB;if(!a.destroyed&&!r.destroyed)if(e-i._lastUpdateFrame==1){var o=a.owner,s=o._scripts;if(s)if(i._isTrigger){if(o._needProcessTriggers)for(var l=0,h=s.length;l<h;l++)s[l].onTriggerStay(r)}else if(o._needProcessCollisions)for(l=0,h=s.length;l<h;l++)i.other=r,s[l].onCollisionStay(i);var u=r.owner,d=u._scripts;if(d)if(i._isTrigger){if(u._needProcessTriggers)for(l=0,h=d.length;l<h;l++)d[l].onTriggerStay(a)}else if(u._needProcessCollisions)for(l=0,h=d.length;l<h;l++)i.other=a,d[l].onCollisionStay(i)}else{if(s=(o=a.owner)._scripts)if(i._isTrigger){if(o._needProcessTriggers)for(l=0,h=s.length;l<h;l++)s[l].onTriggerEnter(r)}else if(o._needProcessCollisions)for(l=0,h=s.length;l<h;l++)i.other=r,s[l].onCollisionEnter(i);if(d=(u=r.owner)._scripts)if(i._isTrigger){if(u._needProcessTriggers)for(l=0,h=d.length;l<h;l++)d[l].onTriggerEnter(a)}else if(u._needProcessCollisions)for(l=0,h=d.length;l<h;l++)i.other=a,d[l].onCollisionEnter(i)}}for(t=0,n=this._previousFrameCollisions.length;t<n;t++){var c=this._previousFrameCollisions[t],_=c._colliderA,f=c._colliderB;if(!_.destroyed&&!f.destroyed&&e-c._updateFrame==1){if(this._collisionsUtils.recoverCollision(c),s=(o=_.owner)._scripts)if(c._isTrigger){if(o._needProcessTriggers)for(l=0,h=s.length;l<h;l++)s[l].onTriggerExit(f)}else if(o._needProcessCollisions)for(l=0,h=s.length;l<h;l++)c.other=f,s[l].onCollisionExit(c);if(d=(u=f.owner)._scripts)if(c._isTrigger){if(u._needProcessTriggers)for(l=0,h=d.length;l<h;l++)d[l].onTriggerExit(_)}else if(u._needProcessCollisions)for(l=0,h=d.length;l<h;l++)c.other=_,d[l].onCollisionExit(c)}}}},{key:"clearForces",value:function(){if(!this._nativeDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeDiscreteDynamicsWorld.clearForces()}},{key:"continuousCollisionDetection",get:function(){return this._nativeDispatchInfo.get_m_useContinuous()},set:function(e){this._nativeDispatchInfo.set_m_useContinuous(e)}},{key:"gravity",get:function(){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity},set:function(e){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=e;var t=M._nativeTempVector30;t.setValue(-e.x,e.y,e.z),this._nativeDiscreteDynamicsWorld.setGravity(t)}},{key:"speculativeContactRestitution",get:function(){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";return this._nativeDiscreteDynamicsWorld.getApplySpeculativeContactRestitution()},set:function(e){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeDiscreteDynamicsWorld.setApplySpeculativeContactRestitution(e)}}],[{key:"__init__",value:function(){M._nativeTempVector30=new Rr._physics3D.btVector3(0,0,0),M._nativeTempVector31=new Rr._physics3D.btVector3(0,0,0),M._nativeTempQuaternion0=new Rr._physics3D.btQuaternion(0,0,0,1),M._nativeTempQuaternion1=new Rr._physics3D.btQuaternion(0,0,0,1),M._nativeTempTransform0=new Rr._physics3D.btTransform,M._nativeTempTransform1=new Rr._physics3D.btTransform}},{key:"createConstraint",value:function(){}}]),M}();Ur.PHYSICSENGINEFLAGS_NONE=0,Ur.PHYSICSENGINEFLAGS_COLLISIONSONLY=1,Ur.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT=2,Ur.PHYSICSENGINEFLAGS_MULTITHREADED=4,Ur.PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE=8,Ur.SOLVERMODE_RANDMIZE_ORDER=1,Ur.SOLVERMODE_FRICTION_SEPARATE=2,Ur.SOLVERMODE_USE_WARMSTARTING=4,Ur.SOLVERMODE_USE_2_FRICTION_DIRECTIONS=16,Ur.SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING=32,Ur.SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION=64,Ur.SOLVERMODE_CACHE_FRIENDLY=128,Ur.SOLVERMODE_SIMD=256,Ur.SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS=512,Ur.SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS=1024,Ur._tempVector30=new vn,Ur.disableSimulation=!1;var zr=function(){function f(){var t=this;S(this,f),this._eventList=[],this._mouseTouch=new Tr,this._touchPool=[],this._touches=new kr,this._multiTouchEnabled=!0,this._pushEventList=function(e){e.cancelable&&e.preventDefault(),t._eventList.push(e)}.bind(this)}return C(f,[{key:"__init__",value:function(e,t){this._scene=t,e.oncontextmenu=function(e){return!1}}},{key:"_onCanvasEvent",value:function(e){e.addEventListener("mousedown",this._pushEventList),e.addEventListener("mouseup",this._pushEventList,!0),e.addEventListener("mousemove",this._pushEventList,!0),e.addEventListener("touchstart",this._pushEventList),e.addEventListener("touchend",this._pushEventList,!0),e.addEventListener("touchmove",this._pushEventList,!0),e.addEventListener("touchcancel",this._pushEventList,!0)}},{key:"_offCanvasEvent",value:function(e){e.removeEventListener("mousedown",this._pushEventList),e.removeEventListener("mouseup",this._pushEventList,!0),e.removeEventListener("mousemove",this._pushEventList,!0),e.removeEventListener("touchstart",this._pushEventList),e.removeEventListener("touchend",this._pushEventList,!0),e.removeEventListener("touchmove",this._pushEventList,!0),e.removeEventListener("touchcancel",this._pushEventList,!0),this._eventList.length=0,this._touches.length=0}},{key:"touchCount",value:function(){return this._touches.length}},{key:"_getTouch",value:function(e){var t=this._touchPool[e];return t||(t=new Er,(this._touchPool[e]=t)._identifier=e),t}},{key:"_mouseTouchDown",value:function(){var e=this._mouseTouch,t=e.sprite;if(e._pressedSprite=t,e._pressedLoopCount=J.loopCount,t){var n=t._scripts;if(n)for(var i=0,a=n.length;i<a;i++)n[i].onMouseDown()}}},{key:"_mouseTouchUp",value:function(){var e,t,n=this._mouseTouch,i=n._pressedSprite;n._pressedSprite=null,n._pressedLoopCount=-1;n=n.sprite;if(n&&n===i){var a=n._scripts;if(a)for(e=0,t=a.length;e<t;e++)a[e].onMouseClick()}if(i){var r=i._scripts;if(r)for(e=0,t=r.length;e<t;e++)r[e].onMouseUp()}}},{key:"_mouseTouchRayCast",value:function(e){var t=f._tempHitResult0,n=f._tempVector20,i=f._tempRay0;t.succeeded=!1;var a=this._mouseTouch.mousePositionX,r=this._mouseTouch.mousePositionY;n.x=a,n.y=r;for(var o=e.length-1;0<=o;o--){var s=e[o],l=s.viewport;if(n.x>=l.x&&n.y>=l.y&&n.x<=l.width&&n.y<=l.height)if(s.viewportPointToRay(n,i),this._scene._physicsSimulation.rayCast(i,t)||s.clearFlag===ja.CLEARFLAG_SOLIDCOLOR||s.clearFlag===ja.CLEARFLAG_SKY)break}a=this._mouseTouch,r=a.sprite;if(t.succeeded){var h=t.collider.owner,u=(a.sprite=h)._scripts;if(r!==h&&u)for(var d=0,c=u.length;d<c;d++)u[d].onMouseEnter()}else a.sprite=null;if(r&&r!==h){var _=r._scripts;if(_)for(d=0,c=_.length;d<c;d++)_[d].onMouseOut()}}},{key:"_changeTouches",value:function(e,t){for(var n=0,i=0,a=this._touches.length,r=0,o=e.length;r<o;r++){var s=e[r],l=s.identifier;if(this._multiTouchEnabled||0===l){var h=this._getTouch(l),u=h._position,l=f._tempPoint;l.setTo(s.pageX,s.pageY),M.stage._canvasTransform.invertTransformPoint(l);var d=l.x,c=l.y;switch(t){case 0:this._touches.add(h),n+=d,i+=c;break;case 1:this._touches.remove(h),n-=d,i-=c;break;case 2:n=d-u.x,i=c-u.y}u.x=d,u.y=c}}var _=this._touches.length;0===_?(this._mouseTouch.mousePositionX=0,this._mouseTouch.mousePositionY=0):(this._mouseTouch.mousePositionX=(this._mouseTouch.mousePositionX*a+n)/_,this._mouseTouch.mousePositionY=(this._mouseTouch.mousePositionY*a+i)/_)}},{key:"_update",value:function(){var e,t,n=Rr._enbalePhysics&&!Ur.disableSimulation,i=this._eventList.length,a=this._scene._cameraPool;if(0<i){for(var r=!1,o=0;o<i;o++){var s=this._eventList[o];switch(s.type){case"mousedown":n&&this._mouseTouchDown();break;case"mouseup":n&&this._mouseTouchUp();break;case"mousemove":var l=f._tempPoint;l.setTo(s.pageX,s.pageY),M.stage._canvasTransform.invertTransformPoint(l),this._mouseTouch.mousePositionX=l.x,this._mouseTouch.mousePositionY=l.y,n&&(r=!0);break;case"touchstart":l=this._touches.length;this._changeTouches(s.changedTouches,0),n&&(r=!0,0===l&&this._mouseTouchDown());break;case"touchend":case"touchcancel":this._changeTouches(s.changedTouches,1),n&&0===this._touches.length&&this._mouseTouchUp();break;case"touchmove":this._changeTouches(s.changedTouches,2),n&&(r=!0);break;default:throw"Input3D:unkonwn event type."}}r&&this._mouseTouchRayCast(a),this._eventList.length=0}if(n){var h=this._mouseTouch,a=h._pressedSprite;if(a&&J.loopCount>h._pressedLoopCount){var u=a._scripts;if(u)for(e=0,t=u.length;e<t;e++)u[e].onMouseDrag()}h=h.sprite;if(h){var d=h._scripts;if(d)for(e=0,t=d.length;e<t;e++)d[e].onMouseOver()}}}},{key:"getTouch",value:function(e){return e<this._touches.length?this._touches.elements[e]:null}},{key:"multiTouchEnabled",get:function(){return this._multiTouchEnabled},set:function(e){this._multiTouchEnabled=e}}]),f}();zr._tempPoint=new L,zr._tempVector20=new gn,zr._tempRay0=new La(new vn,new vn),zr._tempHitResult0=new wr;var Gr=function e(){S(this,e),this.flags=0,this.maxSubSteps=1,this.fixedTimeStep=1/60},Xr=function(){function n(e,t){S(this,n),this._position=e,this._textureCoordinate0=t}return C(n,[{key:"position",get:function(){return this._position}},{key:"textureCoordinate0",get:function(){return this._textureCoordinate0}},{key:"vertexDeclaration",get:function(){return n._vertexDeclaration}}],[{key:"__init__",value:function(){n._vertexDeclaration=new pa(20,[new ma(0,ya.Vector3,wa.MESH_POSITION0),new ma(12,ya.Vector2,wa.MESH_TEXTURECOORDINATE0)])}},{key:"vertexDeclaration",get:function(){return n._vertexDeclaration}}]),n}(),Hr=function(){T(w,Ha);var m=b(w);function w(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:48,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:48;S(this,w),e=m.call(this);var i=P.instance;e._stacks=t,e._slices=n;for(var a=Xr.vertexDeclaration,r=a.vertexStride/4,t=(e._stacks+1)*(e._slices+1),n=3*e._stacks*(e._slices+1)*2,o=new Float32Array(t*r),s=new Uint16Array(n),l=Math.PI/e._stacks,h=2*Math.PI/e._slices,u=0,d=0,c=0,_=0;_<e._stacks+1;_++)for(var f=Math.sin(_*l),g=Math.cos(_*l),y=0;y<e._slices+1;y++){var v=f*Math.sin(y*h),p=f*Math.cos(y*h);o[d+0]=v*w._radius,o[d+1]=g*w._radius,o[d+2]=p*w._radius,o[d+3]=.75-y/e._slices,o[d+4]=_/e._stacks,d+=r,_!=e._stacks-1&&(s[c++]=u+1,s[c++]=u,s[c++]=u+(e._slices+1),s[c++]=u+(e._slices+1),s[c++]=u,s[c++]=u+e._slices,u++)}e._vertexBuffer=new Na(4*o.length,i.STATIC_DRAW,!1),e._vertexBuffer.vertexDeclaration=a,e._indexBuffer=new Xa(Xa.INDEXTYPE_USHORT,s.length,i.STATIC_DRAW,!1),e._vertexBuffer.setData(o.buffer),e._indexBuffer.setData(s);i=new Ga;return i.bind(),i.applyVertexBuffer(e._vertexBuffer),i.applyIndexBuffer(e._indexBuffer),i.unBind(),e._bufferState=i,e}return C(w,[{key:"_render",value:function(e){var t=P.instance,n=this._indexBuffer.indexCount;t.drawElements(t.TRIANGLES,n,t.UNSIGNED_SHORT,0),J.trianglesFaces+=n/3,J.renderBatches++}},{key:"stacks",get:function(){return this._stacks}},{key:"slices",get:function(){return this._slices}}],[{key:"__init__",value:function(){w.instance=new w}}]),w}();Hr._radius=1;var Yr=function(){function e(){S(this,e),this._length=0,this._elements=[]}return C(e,[{key:"add",value:function(e){this._length===this._elements.length?this._elements.push(e):this._elements[this._length]=e,this._length++}},{key:"remove",value:function(e){var t=this._elements.indexOf(e);this._length--,t!==this._length&&(e=this._elements[this._length],this._elements[t]=e)}},{key:"shift",value:function(){return this._length--,this._elements.shift()}}]),e}(),Wr=function(){T(t,Yr);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"getSunLight",value:function(){for(var e,t=-1,n=this._elements,i=0;i<this._length;i++){var a=n[i]._intensity;t<a&&(t=a,e=i)}return e}}]),t}(),jr=function(){T(t,Yr);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"remove",value:function(e){e=this._elements.indexOf(e);this._elements.splice(e,1),this._length--}}]),t}(),qr=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("LineShader"),e._shaderValues.setVector(n.COLOR,new yn(1,1,1,1)),e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"color",get:function(){return this._shaderValues.getVector(n.COLOR)},set:function(e){this._shaderValues.setVector(n.COLOR,e)}},{key:"depthWrite",set:function(e){this._shaderValues.setBool(n.DEPTH_WRITE,e)},get:function(){return this._shaderValues.getBool(n.DEPTH_WRITE)}},{key:"cull",set:function(e){this._shaderValues.setInt(n.CULL,e)},get:function(){return this._shaderValues.getInt(n.CULL)}},{key:"blend",set:function(e){this._shaderValues.setInt(n.BLEND,e)},get:function(){return this._shaderValues.getInt(n.BLEND)}},{key:"blendSrc",set:function(e){this._shaderValues.setInt(n.BLEND_SRC,e)},get:function(){return this._shaderValues.getInt(n.BLEND_SRC)}},{key:"blendDst",set:function(e){this._shaderValues.setInt(n.BLEND_DST,e)},get:function(){return this._shaderValues.getInt(n.BLEND_DST)}},{key:"depthTest",set:function(e){this._shaderValues.setInt(n.DEPTH_TEST,e)},get:function(){return this._shaderValues.getInt(n.DEPTH_TEST)}}],[{key:"__initDefine__",value:function(){}}]),n}();qr.COLOR=ca.propertyNameToID("u_Color"),qr.CULL=ca.propertyNameToID("s_Cull"),qr.BLEND=ca.propertyNameToID("s_Blend"),qr.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),qr.BLEND_DST=ca.propertyNameToID("s_BlendDst"),qr.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),qr.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite");var Zr=function(){function e(){S(this,e)}return C(e,[{key:"vertexDeclaration",get:function(){return e._vertexDeclaration}}],[{key:"__init__",value:function(){e._vertexDeclaration=new pa(28,[new ma(0,ya.Vector3,wa.MESH_POSITION0),new ma(12,ya.Vector4,wa.MESH_COLOR0)])}},{key:"vertexDeclaration",get:function(){return e._vertexDeclaration}}]),e}(),Kr=function(){T(l,Ia);var a=b(l);function l(e,t){var n;S(this,l),(n=a.call(this))._floatCountPerVertices=7,n._minUpdate=Number.MAX_VALUE,n._maxUpdate=Number.MIN_VALUE,n._bufferState=new Ga,n._floatBound=new Float32Array(6),n._calculateBound=!1,n._maxLineCount=0,n._lineCount=0;var i=2*t;n._owner=e,n._maxLineCount=t,n._vertices=new Float32Array(i*n._floatCountPerVertices),n._vertexBuffer=new Na(Zr.vertexDeclaration.vertexStride*i,P.instance.STATIC_DRAW,!1),n._vertexBuffer.vertexDeclaration=Zr.vertexDeclaration,n._bufferState.bind(),n._bufferState.applyVertexBuffer(n._vertexBuffer),n._bufferState.unBind();t=l._tempVector0,i=l._tempVector1;return t.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n._bounds=new _r(t,i),n}return C(l,[{key:"_getType",value:function(){return l._type}},{key:"_resizeLineData",value:function(e){var t=2*e,n=this._vertices;this._vertexBuffer.destroy(),this._maxLineCount=e;e=t*this._floatCountPerVertices;this._vertices=new Float32Array(e),this._vertexBuffer=new Na(Zr.vertexDeclaration.vertexStride*t,P.instance.STATIC_DRAW,!1),this._vertexBuffer.vertexDeclaration=Zr.vertexDeclaration,e<n.length?(this._vertices.set(new Float32Array(n.buffer,0,e)),this._vertexBuffer.setData(this._vertices.buffer,0,0,4*e)):(this._vertices.set(n),this._vertexBuffer.setData(this._vertices.buffer,0,0,4*n.length)),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.unBind()}},{key:"_updateLineVertices",value:function(e,t,n,i,a){t&&(this._vertices[e+0]=t.x,this._vertices[e+1]=t.y,this._vertices[e+2]=t.z),i&&(this._vertices[e+3]=i.r,this._vertices[e+4]=i.g,this._vertices[e+5]=i.b,this._vertices[e+6]=i.a),n&&(this._vertices[e+7]=n.x,this._vertices[e+8]=n.y,this._vertices[e+9]=n.z),a&&(this._vertices[e+10]=a.r,this._vertices[e+11]=a.g,this._vertices[e+12]=a.b,this._vertices[e+13]=a.a),this._minUpdate=Math.min(this._minUpdate,e),this._maxUpdate=Math.max(this._maxUpdate,e+2*this._floatCountPerVertices);var r=this._bounds,i=this._floatBound,a=r.getMin(),e=r.getMax();vn.min(a,t,a),vn.min(a,n,a),vn.max(e,t,e),vn.max(e,n,e),r.setMin(a),r.setMax(e),i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=e.x,i[4]=e.y,i[5]=e.z}},{key:"_reCalculateBound",value:function(){if(this._calculateBound){var e=this._vertices,t=l._tempVector0,n=l._tempVector1;t.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;i<2*this._lineCount;++i){var a=this._floatCountPerVertices*i,r=e[0+a],o=e[1+a],a=e[2+a];t.x=Math.min(r,t.x),t.y=Math.min(o,t.y),t.z=Math.min(a,t.z),n.x=Math.max(r,n.x),n.y=Math.max(o,n.y),n.z=Math.max(a,n.z)}this._bounds.setMin(t),this._bounds.setMax(n);var s=this._floatBound;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=n.x,s[4]=n.y,s[5]=n.z,this._calculateBound=!1}}},{key:"_removeLineData",value:function(e){var t=2*this._floatCountPerVertices,n=e+1,i=e*t,a=this._vertices,r=new Float32Array(a.buffer,n*t*4,(this._lineCount-n)*t);a.set(r,i),this._minUpdate=Math.min(this._minUpdate,i),this._maxUpdate=Math.max(this._maxUpdate,i+r.length),this._lineCount--;var o=this._floatBound,s=a[i],l=a[1+i],h=a[2+i],u=a[7+i],d=a[8+i],e=a[9+i],n=o[0],t=o[1],r=o[2],a=o[3],i=o[4],o=o[5];s!==n&&s!==a&&l!==t&&l!==i&&h!==r&&h!==o&&u!==n&&u!==a&&d!==t&&d!==i&&e!==r&&e!==o||(this._calculateBound=!0)}},{key:"_updateLineData",value:function(e,t,n,i,a){var r=2*this._floatCountPerVertices;this._updateLineVertices(e*r,t,n,i,a)}},{key:"_updateLineDatas",value:function(e,t){for(var n=2*this._floatCountPerVertices,i=t.length,a=0;a<i;a++){var r=t[a];this._updateLineVertices((e+a)*n,r.startPosition,r.endPosition,r.startColor,r.endColor)}}},{key:"_getLineData",value:function(e,t){var n=t.startPosition,i=t.startColor,a=t.endPosition,r=t.endColor,t=this._vertices,e=e*this._floatCountPerVertices*2;n.x=t[0+e],n.y=t[1+e],n.z=t[2+e],i.r=t[3+e],i.g=t[4+e],i.b=t[5+e],i.a=t[6+e],a.x=t[7+e],a.y=t[8+e],a.z=t[9+e],r.r=t[10+e],r.g=t[11+e],r.b=t[12+e],r.a=t[13+e]}},{key:"_prepareRender",value:function(e){return!0}},{key:"_render",value:function(e){var t;this._minUpdate!==Number.MAX_VALUE&&this._maxUpdate!==Number.MIN_VALUE&&(this._vertexBuffer.setData(this._vertices.buffer,4*this._minUpdate,4*this._minUpdate,4*(this._maxUpdate-this._minUpdate)),this._minUpdate=Number.MAX_VALUE,this._maxUpdate=Number.MIN_VALUE),0<this._lineCount&&(this._bufferState.bind(),(t=P.instance).drawArrays(t.LINES,0,2*this._lineCount),J.renderBatches++)}},{key:"destroy",value:function(){this._destroyed||(G(z(l.prototype),"destroy",this).call(this),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._bufferState=null,this._vertexBuffer=null,this._vertices=null)}}]),l}();Kr._tempVector0=new vn,Kr._tempVector1=new vn,Kr._type=Ia._typeCounter++;var Qr=function(){T(n,fr);var t=b(n);function n(e){return S(this,n),(e=t.call(this,e))._projectionViewWorldMatrix=new ki,e}return C(n,[{key:"_calculateBoundingBox",value:function(){var e,t=this._owner.transform.worldMatrix,n=this._owner._geometryFilter;n._reCalculateBound(),n._bounds._tranform(t,this._bounds),yt.supportWebGLPlusCulling&&(e=this._bounds.getMin(),n=this._bounds.getMax(),(t=ba._cullingBuffer)[this._cullingBufferIndex+1]=e.x,t[this._cullingBufferIndex+2]=e.y,t[this._cullingBufferIndex+3]=e.z,t[this._cullingBufferIndex+4]=n.x,t[this._cullingBufferIndex+5]=n.y,t[this._cullingBufferIndex+6]=n.z)}},{key:"_renderUpdateWithCamera",value:function(e,t){var n=e.projectionViewMatrix,e=this._shaderValues;t?(t=t.worldMatrix,e.setMatrix4x4(fa.WORLDMATRIX,t),ki.multiply(n,t,this._projectionViewWorldMatrix),e.setMatrix4x4(fa.MVPMATRIX,this._projectionViewWorldMatrix)):(e.setMatrix4x4(fa.WORLDMATRIX,ki.DEFAULT),e.setMatrix4x4(fa.MVPMATRIX,n))}}]),n}(),Jr=function(){T(i,ga);var n=b(i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return S(this,i),(t=n.call(this,t))._geometryFilter=new Kr(u(t),e),t._render=new Qr(u(t)),t._changeRenderObjects(t._render,0,qr.defaultMaterial),t}return C(i,[{key:"_changeRenderObjects",value:function(e,t,n){var i=this._render._renderElements;n=n||qr.defaultMaterial;var a=i[t];(a=a||(i[t]=new ar)).setTransform(this._transform),a.setGeometry(this._geometryFilter),a.render=this._render,a.material=n}},{key:"addLine",value:function(e,t,n,i){if(this._geometryFilter._lineCount===this._geometryFilter._maxLineCount)throw"PixelLineSprite3D: lineCount has equal with maxLineCount.";this._geometryFilter._updateLineData(this._geometryFilter._lineCount++,e,t,n,i)}},{key:"addLines",value:function(e){var t=this._geometryFilter._lineCount,n=e.length;if(t+n>this._geometryFilter._maxLineCount)throw"PixelLineSprite3D: lineCount plus lines count must less than maxLineCount.";this._geometryFilter._updateLineDatas(t,e),this._geometryFilter._lineCount+=n}},{key:"removeLine",value:function(e){if(!(e<this._geometryFilter._lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._removeLineData(e)}},{key:"setLine",value:function(e,t,n,i,a){if(!(e<this._geometryFilter._lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._updateLineData(e,t,n,i,a)}},{key:"getLine",value:function(e,t){if(!(e<this.lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._getLineData(e,t)}},{key:"clear",value:function(){this._geometryFilter._lineCount=0}},{key:"_create",value:function(){return new i}},{key:"maxLineCount",get:function(){return this._geometryFilter._maxLineCount},set:function(e){this._geometryFilter._resizeLineData(e),this._geometryFilter._lineCount=Math.min(this._geometryFilter._lineCount,e)}},{key:"lineCount",get:function(){return this._geometryFilter._lineCount},set:function(e){if(e>this.maxLineCount)throw"PixelLineSprite3D: lineCount can't large than maxLineCount";this._geometryFilter._lineCount=e}},{key:"pixelLineRenderer",get:function(){return this._render}}]),i}(),$r=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];S(this,t),this.isTransparent=!1,this.elements=new sr,this.lastTransparentRenderElement=null,this.lastTransparentBatched=!1,this.isTransparent=e}return C(t,[{key:"_compare",value:function(e,t){var n=e.material.renderQueue-t.material.renderQueue;return 0!=n?n:(this.isTransparent?t.render._distanceForSort-e.render._distanceForSort:e.render._distanceForSort-t.render._distanceForSort)+t.render.sortingFudge-e.render.sortingFudge}},{key:"_partitionRenderObject",value:function(e,t){for(var n=this.elements.elements,i=n[Math.floor((t+e)/2)];e<=t;){for(;this._compare(n[e],i)<0;)e++;for(;0<this._compare(n[t],i);)t--;if(e<t){var a=n[e];n[e]=n[t],n[t]=a,e++,t--}else if(e===t){e++;break}}return e}},{key:"_quickSort",value:function(e,t){var n,i;1<this.elements.length&&(e<(i=(n=this._partitionRenderObject(e,t))-1)&&this._quickSort(e,i),n<t&&this._quickSort(n,t))}},{key:"_render",value:function(e,t){for(var n=this.elements.elements,i=0,a=this.elements.length;i<a;i++)n[i]._render(e,t)}},{key:"clear",value:function(){this.elements.length=0,this.lastTransparentRenderElement=null,this.lastTransparentBatched=!1}}]),t}(),eo=function(){function u(e,t,n,i){S(this,u),this._bounds=new cr(new vn,new vn),this._objects=[],this._isContaion=!1,this.center=new vn,this.baseLength=0,this._setValues(e,t,n,i)}return C(u,[{key:"_setValues",value:function(e,t,n,i){this._octree=e,this._parent=t,this.baseLength=n,i.cloneTo(this.center);var a=this._bounds.min,t=this._bounds.max,n=e._looseness*n/2;a.setValue(i.x-n,i.y-n,i.z-n),t.setValue(i.x+n,i.y+n,i.z+n)}},{key:"_getChildBound",value:function(e){if(null!=this._children&&this._children[e])return this._children[e]._bounds;var t=this.baseLength/4,n=this.baseLength/2*this._octree._looseness/2,i=u._tempBoundBox,a=i.min,r=i.max;switch(e){case 0:a.x=this.center.x-t-n,a.y=this.center.y+t-n,a.z=this.center.z-t-n,r.x=this.center.x-t+n,r.y=this.center.y+t+n,r.z=this.center.z-t+n;break;case 1:a.x=this.center.x+t-n,a.y=this.center.y+t-n,a.z=this.center.z-t-n,r.x=this.center.x+t+n,r.y=this.center.y+t+n,r.z=this.center.z-t+n;break;case 2:a.x=this.center.x-t-n,a.y=this.center.y+t-n,a.z=this.center.z+t-n,r.x=this.center.x-t+n,r.y=this.center.y+t+n,r.z=this.center.z+t+n;break;case 3:a.x=this.center.x+t-n,a.y=this.center.y+t-n,a.z=this.center.z+t-n,r.x=this.center.x+t+n,r.y=this.center.y+t+n,r.z=this.center.z+t+n;break;case 4:a.x=this.center.x-t-n,a.y=this.center.y-t-n,a.z=this.center.z-t-n,r.x=this.center.x-t+n,r.y=this.center.y-t+n,r.z=this.center.z-t+n;break;case 5:a.x=this.center.x+t-n,a.y=this.center.y-t-n,a.z=this.center.z-t-n,r.x=this.center.x+t+n,r.y=this.center.y-t+n,r.z=this.center.z-t+n;break;case 6:a.x=this.center.x-t-n,a.y=this.center.y-t-n,a.z=this.center.z+t-n,r.x=this.center.x-t+n,r.y=this.center.y-t+n,r.z=this.center.z+t+n;break;case 7:a.x=this.center.x+t-n,a.y=this.center.y-t-n,a.z=this.center.z+t-n,r.x=this.center.x+t+n,r.y=this.center.y-t+n,r.z=this.center.z+t+n}return i}},{key:"_getChildCenter",value:function(e){if(null!=this._children)return this._children[e].center;var t=this.baseLength/4,n=u._tempVector30;switch(e){case 0:n.x=this.center.x-t,n.y=this.center.y+t,n.z=this.center.z-t;break;case 1:n.x=this.center.x+t,n.y=this.center.y+t,n.z=this.center.z-t;break;case 2:n.x=this.center.x-t,n.y=this.center.y+t,n.z=this.center.z+t;break;case 3:n.x=this.center.x+t,n.y=this.center.y+t,n.z=this.center.z+t;break;case 4:n.x=this.center.x-t,n.y=this.center.y-t,n.z=this.center.z-t;break;case 5:n.x=this.center.x+t,n.y=this.center.y-t,n.z=this.center.z-t;break;case 6:n.x=this.center.x-t,n.y=this.center.y-t,n.z=this.center.z+t;break;case 7:n.x=this.center.x+t,n.y=this.center.y-t,n.z=this.center.z+t}return n}},{key:"_getChild",value:function(e){var t=this.baseLength/4;switch(this._children||(this._children=[]),e){case 0:return this._children[0]||(this._children[0]=new u(this._octree,this,this.baseLength/2,new vn(this.center.x+-t,this.center.y+t,this.center.z-t)));case 1:return this._children[1]||(this._children[1]=new u(this._octree,this,this.baseLength/2,new vn(this.center.x+t,this.center.y+t,this.center.z-t)));case 2:return this._children[2]||(this._children[2]=new u(this._octree,this,this.baseLength/2,new vn(this.center.x-t,this.center.y+t,this.center.z+t)));case 3:return this._children[3]||(this._children[3]=new u(this._octree,this,this.baseLength/2,new vn(this.center.x+t,this.center.y+t,this.center.z+t)));case 4:return this._children[4]||(this._children[4]=new u(this._octree,this,this.baseLength/2,new vn(this.center.x-t,this.center.y-t,this.center.z-t)));case 5:return this._children[5]||(this._children[5]=new u(this._octree,this,this.baseLength/2,new vn(this.center.x+t,this.center.y-t,this.center.z-t)));case 6:return this._children[6]||(this._children[6]=new u(this._octree,this,this.baseLength/2,new vn(this.center.x-t,this.center.y-t,this.center.z+t)));case 7:return this._children[7]||(this._children[7]=new u(this._octree,this,this.baseLength/2,new vn(this.center.x+t,this.center.y-t,this.center.z+t)));default:throw"BoundsOctreeNode: unknown index."}}},{key:"_shouldMerge",value:function(){for(var e=this._objects.length,t=0;t<8;t++){var n=this._children[t];if(n){if(null!=n._children)return!1;e+=n._objects.length}}return e<=u._NUM_OBJECTS_ALLOWED}},{key:"_mergeChildren",value:function(){for(var e=0;e<8;e++){var t=this._children[e];if(t){t._parent=null;for(var n=t._objects,i=n.length-1;0<=i;i--){var a=n[i];this._objects.push(a),a._setOctreeNode(this)}}}this._children=null}},{key:"_merge",value:function(){var e;null!==this._children||(e=this._parent)&&e._shouldMerge()&&(e._mergeChildren(),e._merge())}},{key:"_checkAddNode",value:function(e){if(null==this._children){if(this._objects.length<u._NUM_OBJECTS_ALLOWED||this.baseLength/2<this._octree._minSize)return this;for(var t=this._objects.length-1;0<=t;t--){var n=this._objects[t],i=this._bestFitChild(n.bounds.getCenter());u._encapsulates(this._getChildBound(i),n.bounds._getBoundBox())&&(this._objects.splice(this._objects.indexOf(n),1),this._getChild(i)._add(n))}}var a=this._bestFitChild(e.bounds.getCenter());return u._encapsulates(this._getChildBound(a),e.bounds._getBoundBox())?this._getChild(a)._checkAddNode(e):this}},{key:"_add",value:function(e){var t=this._checkAddNode(e);t._objects.push(e),e._setOctreeNode(t)}},{key:"_remove",value:function(e){var t=this._objects.indexOf(e);this._objects.splice(t,1),e._setOctreeNode(null),this._merge()}},{key:"_addUp",value:function(e){return Pa.boxContainsBox(this._bounds,e.bounds._getBoundBox())===Oa.Contains?(this._add(e),!0):!!this._parent&&this._parent._addUp(e)}},{key:"_getCollidingWithFrustum",value:function(e,t,n,i,a,r){if(n){var o=t.containsBoundBox(this._bounds);if(J.octreeNodeCulling++,o===Oa.Disjoint)return;n=o===Oa.Intersects}this._isContaion=!n;for(var s=e.camera,l=e.scene,h=0,u=this._objects.length;h<u;h++){var d=this._objects[h];if(s._isLayerVisible(d._owner.layer)&&d._enable&&(!n||(J.frustumCulling++,d._needRender(t,e)))){d._distanceForSort=vn.distance(d.bounds.getCenter(),i);for(var c=d._renderElements,_=0,f=c.length;_<f;_++)c[_]._update(l,e,a,r)}}if(null!=this._children)for(h=0;h<8;h++){var g=this._children[h];g&&g._getCollidingWithFrustum(e,t,n,i,a,r)}}},{key:"_getCollidingWithBoundBox",value:function(e,t,n){if(t){var i=Pa.boxContainsBox(this._bounds,e);if(i===Oa.Disjoint)return;t=i===Oa.Intersects}if(t)for(var a=0,r=this._objects.length;a<r;a++){var o=this._objects[a];Pa.intersectsBoxAndBox(o.bounds._getBoundBox(),e)&&n.push(o)}if(null!=this._children)for(a=0;a<8;a++)this._children[a]._getCollidingWithBoundBox(e,t,n)}},{key:"_bestFitChild",value:function(e){return(e.x<=this.center.x?0:1)+(e.y>=this.center.y?0:4)+(e.z<=this.center.z?0:2)}},{key:"_update",value:function(e){if(Pa.boxContainsBox(this._bounds,e.bounds._getBoundBox())===Oa.Contains){var t,n=this._checkAddNode(e);return n!==e._getOctreeNode()&&(n._objects.push(e),e._setOctreeNode(n),t=this._objects.indexOf(e),this._objects.splice(t,1),this._merge()),!0}if(this._parent){n=this._parent._addUp(e);return n&&(t=this._objects.indexOf(e),this._objects.splice(t,1),this._merge()),n}return!1}},{key:"add",value:function(e){return!!u._encapsulates(this._bounds,e.bounds._getBoundBox())&&(this._add(e),!0)}},{key:"remove",value:function(e){return e._getOctreeNode()===this&&(this._remove(e),!0)}},{key:"update",value:function(e){return e._getOctreeNode()===this&&this._update(e)}},{key:"shrinkIfPossible",value:function(e){if(this.baseLength<2*e)return this;for(var t=-1,n=0,i=this._objects.length;n<i;n++){var a=this._objects[n],r=this._bestFitChild(a.bounds.getCenter());if(0!=n&&r!=t)return this;var o=this._getChildBound(r);if(!u._encapsulates(o,a.bounds._getBoundBox()))return this;0==n&&(t=r)}if(null==this._children)return-1!=t&&(h=this._getChildCenter(t),this._setValues(this._octree,null,this.baseLength/2,h)),this;for(var s=!1,n=0,i=this._children.length;n<i;n++){var l=this._children[n];if(l&&l.hasAnyObjects()){if(s)return this;if(0<=t&&t!=n)return this;s=!0,t=n}}if(-1==t)return this;var h=this._children[t];return h._parent=null,h}},{key:"hasAnyObjects",value:function(){if(0<this._objects.length)return!0;if(null!=this._children)for(var e=0;e<8;e++){var t=this._children[e];if(t&&t.hasAnyObjects())return!0}return!1}},{key:"getCollidingWithBoundBox",value:function(e,t){this._getCollidingWithBoundBox(e,!0,t)}},{key:"getCollidingWithRay",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE;if(!(-1==(r=Pa.intersectsRayAndBoxRD(e,this._bounds))||n<r)){for(var i=0,a=this._objects.length;i<a;i++){var r,o=this._objects[i];-1!==(r=Pa.intersectsRayAndBoxRD(e,o.bounds._getBoundBox()))&&r<=n&&t.push(o)}if(null!=this._children)for(i=0;i<8;i++)this._children[i].getCollidingWithRay(e,t,n)}}},{key:"getCollidingWithFrustum",value:function(e,t,n){var i=e.camera.transform.position,a=e.camera.boundFrustum;this._getCollidingWithFrustum(e,a,!0,i,t,n)}},{key:"isCollidingWithBoundBox",value:function(e){if(!Pa.intersectsBoxAndBox(this._bounds,e))return!1;for(var t=0,n=this._objects.length;t<n;t++){var i=this._objects[t];if(Pa.intersectsBoxAndBox(i.bounds._getBoundBox(),e))return!0}if(null!=this._children)for(t=0;t<8;t++)if(this._children[t].isCollidingWithBoundBox(e))return!0;return!1}},{key:"isCollidingWithRay",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;if(-1==(a=Pa.intersectsRayAndBoxRD(e,this._bounds))||t<a)return!1;for(var n=0,i=this._objects.length;n<i;n++){var a,r=this._objects[n];if(-1!==(a=Pa.intersectsRayAndBoxRD(e,r.bounds._getBoundBox()))&&a<=t)return!0}if(null!=this._children)for(n=0;n<8;n++)if(this._children[n].isCollidingWithRay(e,t))return!0;return!1}},{key:"getBound",value:function(){return this._bounds}},{key:"drawAllBounds",value:function(e,t,n){if(null!==this._children||0!=this._objects.length){t++;var i,a=u._tempColor0;if(this._isContaion?(a.r=0,a.g=0,a.b=1):(i=n?t/n:0,a.r=1-i,a.g=i,a.b=0),a.a=.3,ia._drawBound(e,this._bounds,a),null!=this._children)for(var r=0;r<8;r++){var o=this._children[r];o&&o.drawAllBounds(e,t,n)}}}},{key:"drawAllObjects",value:function(e,t,n){t++;var i,a=u._tempColor0;this._isContaion?(a.r=0,a.g=0,a.b=1):(i=n?t/n:0,a.r=1-i,a.g=i,a.b=0),a.a=1;for(var r=0,o=this._objects.length;r<o;r++)ia._drawBound(e,this._objects[r].bounds._getBoundBox(),a);if(null!=this._children)for(r=0;r<8;r++){var s=this._children[r];s&&s.drawAllObjects(e,t,n)}}}],[{key:"_encapsulates",value:function(e,t){return Pa.boxContainsBox(e,t)==Oa.Contains}}]),u}();eo._tempVector3=new vn,eo._tempVector30=new vn,eo._tempVector31=new vn,eo._tempColor0=new Ta,eo._tempBoundBox=new cr(new vn,new vn),eo._NUM_OBJECTS_ALLOWED=8;var to=function(){T(t,sr);var e=b(t);function t(){return S(this,t),e.call(this)}return C(t,[{key:"add",value:function(e){if(-1!==e._getIndexInMotionList())throw"OctreeMotionList:element has  in  PhysicsUpdateList.";this._add(e),e._setIndexInMotionList(this.length++)}},{key:"remove",value:function(e){var t,n=e._getIndexInMotionList();this.length--,n!==this.length&&(t=this.elements[this.length],(this.elements[n]=t)._setIndexInMotionList(n)),e._setIndexInMotionList(-1)}}]),t}(),no=function(){function a(e,t,n,i){S(this,a),this._motionObjects=new to,this.count=0,e<n&&(console.warn("Minimum node size must be at least as big as the initial world size. Was: "+n+" Adjusted to: "+e),n=e),this._initialSize=e,this._minSize=n,this._looseness=Math.min(Math.max(i,1),2),this._rootNode=new eo(this,null,e,t)}return C(a,[{key:"_getMaxDepth",value:function(e,t){t++;var n=e._children;if(null!=n)for(var i=t,a=0,r=n.length;a<r;a++){var o=n[a];o&&(t=Math.max(this._getMaxDepth(o,i),t))}return t}},{key:"_grow",value:function(e){var t=0<=e.x?1:-1,n=0<=e.y?1:-1,i=0<=e.z?1:-1,a=this._rootNode,r=this._rootNode.baseLength/2,o=2*this._rootNode.baseLength,e=this._rootNode.center,r=new vn(e.x+t*r,e.y+n*r,e.z+i*r);if(this._rootNode=new eo(this,null,o,r),a.hasAnyObjects()){for(var s=this._rootNode._bestFitChild(a.center),l=[],h=0;h<8;h++)h==s&&(a._parent=this._rootNode,l[h]=a);this._rootNode._children=l}}},{key:"add",value:function(e){for(var t=0;!this._rootNode.add(e);){var n=a._tempVector30;if(vn.subtract(e.bounds.getCenter(),this._rootNode.center,n),this._grow(n),20<++t)throw"Aborted Add operation as it seemed to be going on forever ("+(t-1)+") attempts at growing the octree."}this.count++}},{key:"remove",value:function(e){e=e._getOctreeNode().remove(e);return e&&this.count--,e}},{key:"update",value:function(e){var t=0,n=e._getOctreeNode();if(n){for(;!n._update(e);){var i=a._tempVector30;if(vn.subtract(e.bounds.getCenter(),this._rootNode.center,i),this._grow(i),20<++t)throw"Aborted Add operation as it seemed to be going on forever ("+(t-1)+") attempts at growing the octree."}return!0}return!1}},{key:"shrinkRootIfPossible",value:function(){this._rootNode=this._rootNode.shrinkIfPossible(this._initialSize)}},{key:"addMotionObject",value:function(e){this._motionObjects.add(e)}},{key:"removeMotionObject",value:function(e){this._motionObjects.remove(e)}},{key:"updateMotionObjects",value:function(){for(var e=this._motionObjects.elements,t=0,n=this._motionObjects.length;t<n;t++){var i=e[t];this.update(i),i._setIndexInMotionList(-1)}this._motionObjects.length=0}},{key:"isCollidingWithBoundBox",value:function(e){return this._rootNode.isCollidingWithBoundBox(e)}},{key:"isCollidingWithRay",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;return this._rootNode.isCollidingWithRay(e,t)}},{key:"getCollidingWithBoundBox",value:function(e,t){this._rootNode.getCollidingWithBoundBox(e,t)}},{key:"getCollidingWithRay",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE;this._rootNode.getCollidingWithRay(e,t,n)}},{key:"getCollidingWithFrustum",value:function(e,t,n){this._rootNode.getCollidingWithFrustum(e,t,n)}},{key:"getMaxBounds",value:function(){return this._rootNode.getBound()}},{key:"drawAllBounds",value:function(e){var t=this._getMaxDepth(this._rootNode,-1);this._rootNode.drawAllBounds(e,-1,t)}},{key:"drawAllObjects",value:function(e){var t=this._getMaxDepth(this._rootNode,-1);this._rootNode.drawAllObjects(e,-1,t)}}]),a}();no._tempVector30=new vn;var io=function(){T(x,Bt);var n=b(x);function x(){var e,t;return S(this,x),(e=n.call(this))._lightCount=0,e._pointLights=new Yr,e._spotLights=new Yr,e._directionLights=new Wr,e._alternateLights=new jr,e._lightmaps=[],e._skyRenderer=new Wa,e._reflectionMode=1,e._input=new zr,e._timer=M.timer,e._collsionTestList=[],e._renders=new kr,e._opaqueQueue=new $r(!1),e._transparentQueue=new $r(!0),e._cameraPool=[],e._animatorPool=new kr,e._scriptPool=new Array,e._tempScriptPool=new Array,e._needClearScriptPool=!1,e._castShadowRenders=new xr,e.currentCreationLayer=Math.pow(2,0),e.enableLight=!0,e._key=new te,e._time=0,e._pickIdToSprite=new Object,Rr._enbalePhysics&&(e._physicsSimulation=new Ur(x.physicsSettings)),e._shaderValues=new va(null),e.parallelSplitShadowMaps=[],e.enableFog=!1,e.fogStart=300,e.fogRange=1e3,e.fogColor=new vn(.7,.7,.7),e.ambientColor=new vn(.212,.227,.259),e.reflectionIntensity=1,dt.shaderHighPrecision&&e._shaderValues.addDefine(ca.SHADERDEFINE_HIGHPRECISION),ha._config._multiLighting||e._shaderValues.addDefine(ca.SHADERDEFINE_LEGACYSINGALLIGHTING),yt.supportWebGLPlusCulling&&(e._cullingBufferIndices=new Int32Array(1024),e._cullingBufferResult=new Int32Array(1024)),e._scene=u(e),e._input.__init__(yt.canvas,u(e)),x.octreeCulling&&(e._octree=new no(x.octreeInitialSize,x.octreeInitialCenter,x.octreeMinNodeSize,x.octreeLooseness)),ba.debugFrustumCulling&&(e._debugTool=new Jr,(t=new qr).renderQueue=hr.RENDERQUEUE_TRANSPARENT,t.alphaTest=!1,t.depthWrite=!1,t.cull=ur.CULL_BACK,t.blend=ur.BLEND_ENABLE_ALL,t.blendSrc=ur.BLENDPARAM_SRC_ALPHA,t.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,t.depthTest=ur.DEPTHTEST_LESS,e._debugTool.pixelLineRenderer.sharedMaterial=t),e}return C(x,[{key:"_allotPickColorByID",value:function(e,t){var n=Math.floor(e/65025);e-=255*n*255;var i=Math.floor(e/255),e=e-=255*i;t.x=n/255,t.y=i/255,t.z=e/255,t.w=1}},{key:"_searchIDByPickColor",value:function(e){return 255*e.x*255+255*e.y+e.z}},{key:"_setLightmapToChildNode",value:function(e){e instanceof ga&&e._render._applyLightMapParams();for(var t=e._children,n=0,i=t.length;n<i;n++)this._setLightmapToChildNode(t[n])}},{key:"_update",value:function(){var e=this.timer._delta/1e3;this._time+=e,this._shaderValues.setNumber(x.TIME,this._time);var t=this._physicsSimulation;Rr._enbalePhysics&&!Ur.disableSimulation&&(t._updatePhysicsTransformFromRender(),Vr._addUpdateList=!1,t._simulate(e),t._updateCharacters(),Vr._addUpdateList=!0,t._updateCollisions(),t._eventScripts()),this._input._update(),this._clearScript(),this._updateScript(),la._update(this),this._lateUpdateScript()}},{key:"_binarySearchIndexInCameraPool",value:function(e){for(var t,n=0,i=this._cameraPool.length-1;n<=i;){t=Math.floor((n+i)/2);var a=this._cameraPool[t]._renderingOrder;if(a==e._renderingOrder)return t;a>e._renderingOrder?i=t-1:n=t+1}return n}},{key:"onEnable",value:function(){this._input._onCanvasEvent(yt.canvas)}},{key:"onDisable",value:function(){this._input._offCanvasEvent(yt.canvas)}},{key:"_setCreateURL",value:function(e){this._url=B.formatURL(e)}},{key:"_getGroup",value:function(){return this._group}},{key:"_setGroup",value:function(e){this._group=e}},{key:"_clearScript",value:function(){if(this._needClearScriptPool){for(var e=this._scriptPool,t=0,n=e.length;t<n;t++){var i=e[t];i&&(i._indexInPool=this._tempScriptPool.length,this._tempScriptPool.push(i))}this._scriptPool=this._tempScriptPool,e.length=0,this._tempScriptPool=e,this._needClearScriptPool=!1}}},{key:"_updateScript",value:function(){for(var e=this._scriptPool,t=0,n=e.length;t<n;t++){var i=e[t];i&&i.enabled&&i.onUpdate()}}},{key:"_lateUpdateScript",value:function(){for(var e=this._scriptPool,t=0,n=e.length;t<n;t++){var i=e[t];i&&i.enabled&&i.onLateUpdate()}}},{key:"_addScript",value:function(e){var t=this._scriptPool;e._indexInPool=t.length,t.push(e)}},{key:"_removeScript",value:function(e){this._scriptPool[e._indexInPool]=null,e._indexInPool=-1,this._needClearScriptPool=!0}},{key:"_preRenderScript",value:function(){for(var e=this._scriptPool,t=0,n=e.length;t<n;t++){var i=e[t];i&&i.enabled&&i.onPreRender()}}},{key:"_postRenderScript",value:function(){for(var e=this._scriptPool,t=0,n=e.length;t<n;t++){var i=e[t];i&&i.enabled&&i.onPostRender()}}},{key:"_prepareSceneToRender",value:function(){var e=this._shaderValues;if(ha._config._multiLighting){var t=x._lightTexture,n=x._lightPixles,i=t.width,a=4*i,r=0,o=this._directionLights._length,s=this._directionLights._elements;if(0<o){for(var l=this._directionLights.getSunLight(),h=0;h<o;h++,r++){var u,d=(u=s[h])._direction,c=u._intensityColor,_=a*r;vn.scale(u.color,u._intensity,c),u.transform.worldMatrix.getForward(d),vn.normalize(d,d),n[_]=c.x,n[_+1]=c.y,n[_+2]=c.z,n[_+4]=d.x,n[_+5]=d.y,n[_+6]=d.z,h==l&&(e.setVector3(x.SUNLIGHTDIRCOLOR,c),e.setVector3(x.SUNLIGHTDIRECTION,d))}e.addDefine(nr.SHADERDEFINE_DIRECTIONLIGHT)}else e.removeDefine(nr.SHADERDEFINE_DIRECTIONLIGHT);var f=this._pointLights._length;if(0<f){for(var g=this._pointLights._elements,h=0;h<f;h++,r++){var y,v=(y=g[h]).transform.position,c=y._intensityColor,_=a*r;vn.scale(y.color,y._intensity,c),n[_]=c.x,n[_+1]=c.y,n[_+2]=c.z,n[_+3]=y.range,n[_+4]=v.x,n[_+5]=v.y,n[_+6]=v.z}e.addDefine(nr.SHADERDEFINE_POINTLIGHT)}else e.removeDefine(nr.SHADERDEFINE_POINTLIGHT);var p=this._spotLights._length;if(0<p){for(var m=this._spotLights._elements,h=0;h<p;h++,r++){var w=m[h],d=w._direction,v=w.transform.position,c=w._intensityColor,_=a*r;vn.scale(w.color,w._intensity,c),w.transform.worldMatrix.getForward(d),vn.normalize(d,d),n[_]=c.x,n[_+1]=c.y,n[_+2]=c.z,n[_+3]=w.range,n[_+4]=v.x,n[_+5]=v.y,n[_+6]=v.z,n[_+7]=w.spotAngle*Math.PI/180,n[_+8]=d.x,n[_+9]=d.y,n[_+10]=d.z}e.addDefine(nr.SHADERDEFINE_SPOTLIGHT)}else e.removeDefine(nr.SHADERDEFINE_SPOTLIGHT);0<r&&t.setSubPixels(0,0,i,r,n,0),e.setTexture(x.LIGHTBUFFER,t),e.setInt(x.DIRECTIONLIGHTCOUNT,this._directionLights._length),e.setTexture(x.CLUSTERBUFFER,Aa.instance._clusterTexture)}else 0<this._directionLights._length?(u=this._directionLights._elements[0],vn.scale(u.color,u._intensity,u._intensityColor),u.transform.worldMatrix.getForward(u._direction),vn.normalize(u._direction,u._direction),e.setVector3(x.LIGHTDIRCOLOR,u._intensityColor),e.setVector3(x.LIGHTDIRECTION,u._direction),e.setVector3(x.SUNLIGHTDIRCOLOR,u._intensityColor),e.setVector3(x.SUNLIGHTDIRECTION,u._direction),e.addDefine(nr.SHADERDEFINE_DIRECTIONLIGHT)):e.removeDefine(nr.SHADERDEFINE_DIRECTIONLIGHT),0<this._pointLights._length?(y=this._pointLights._elements[0],vn.scale(y.color,y._intensity,y._intensityColor),e.setVector3(x.POINTLIGHTCOLOR,y._intensityColor),e.setVector3(x.POINTLIGHTPOS,y.transform.position),e.setNumber(x.POINTLIGHTRANGE,y.range),e.addDefine(nr.SHADERDEFINE_POINTLIGHT)):e.removeDefine(nr.SHADERDEFINE_POINTLIGHT),0<this._spotLights._length?(t=this._spotLights._elements[0],vn.scale(t.color,t._intensity,t._intensityColor),e.setVector3(x.SPOTLIGHTCOLOR,t._intensityColor),e.setVector3(x.SPOTLIGHTPOS,t.transform.position),t.transform.worldMatrix.getForward(t._direction),vn.normalize(t._direction,t._direction),e.setVector3(x.SPOTLIGHTDIRECTION,t._direction),e.setNumber(x.SPOTLIGHTRANGE,t.range),e.setNumber(x.SPOTLIGHTSPOTANGLE,t.spotAngle*Math.PI/180),e.addDefine(nr.SHADERDEFINE_SPOTLIGHT)):e.removeDefine(nr.SHADERDEFINE_SPOTLIGHT)}},{key:"_addCamera",value:function(e){for(var t=this._binarySearchIndexInCameraPool(e),n=e._renderingOrder,i=this._cameraPool.length;t<i&&this._cameraPool[t]._renderingOrder<=n;)t++;this._cameraPool.splice(t,0,e)}},{key:"_removeCamera",value:function(e){this._cameraPool.splice(this._cameraPool.indexOf(e),1)}},{key:"_preCulling",value:function(e,t,n,i){ba.renderObjectCulling(t,this,e,this._renders,n,i)}},{key:"_clear",value:function(e,t){var n,i=t.viewport,a=t.camera,r=a._getInternalRenderTexture(),o=i.width,s=i.height,l=i.x,h=a._getCanvasHeight()-i.y-s;e.viewport(l,h,o,s);i=a.clearFlag;switch(i=i===ja.CLEARFLAG_SKY&&!a.skyRenderer._isAvailable()&&!this._skyRenderer._isAvailable()?ja.CLEARFLAG_SOLIDCOLOR:i){case ja.CLEARFLAG_SOLIDCOLOR:var u=a.clearColor;if(e.enable(e.SCISSOR_TEST),e.scissor(l,h,o,s),u?e.clearColor(u.x,u.y,u.z,u.w):e.clearColor(0,0,0,0),r)switch(n=e.COLOR_BUFFER_BIT,r.depthStencilFormat){case Y.DEPTH_16:n|=e.DEPTH_BUFFER_BIT;break;case Y.STENCIL_8:n|=e.STENCIL_BUFFER_BIT;break;case Y.DEPTHSTENCIL_16_8:n|=e.DEPTH_BUFFER_BIT,n|=e.STENCIL_BUFFER_BIT}else n=e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT;y.setDepthMask(e,!0),e.clear(n),e.disable(e.SCISSOR_TEST);break;case ja.CLEARFLAG_SKY:case ja.CLEARFLAG_DEPTHONLY:if(e.enable(e.SCISSOR_TEST),e.scissor(l,h,o,s),r)switch(r.depthStencilFormat){case Y.DEPTH_16:n=e.DEPTH_BUFFER_BIT;break;case Y.STENCIL_8:n=e.STENCIL_BUFFER_BIT;break;case Y.DEPTHSTENCIL_16_8:n=e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT}else n=e.DEPTH_BUFFER_BIT;y.setDepthMask(e,!0),e.clear(n),e.disable(e.SCISSOR_TEST);break;case ja.CLEARFLAG_NONE:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}}},{key:"_renderScene",value:function(e){var t=e.camera,n=t._getInternalRenderTexture();if(n?this._opaqueQueue._render(e,!0):this._opaqueQueue._render(e,!1),t.clearFlag===ja.CLEARFLAG_SKY&&(t.skyRenderer._isAvailable()?t.skyRenderer._render(e):this._skyRenderer._isAvailable()&&this._skyRenderer._render(e)),n?this._transparentQueue._render(e,!0):this._transparentQueue._render(e,!1),ba.debugFrustumCulling)for(var i=this._debugTool._render._renderElements,a=0,r=i.length;a<r;a++)i[a]._update(this,e,null,null),i[a]._render(e,!1)}},{key:"_parse",value:function(e,t){var n=e.lightmaps;if(n){for(var i=n.length,a=[],r=0;r<i;r++)a[r]=on.getRes(n[r].path);this.setlightmaps(a)}var o=e.ambientColor;o&&((s=this.ambientColor).fromArray(o),this.ambientColor=s);var s=e.sky;if(s)switch(this._skyRenderer.material=on.getRes(s.material.path),s.mesh){case"SkyBox":this._skyRenderer.mesh=Ya.instance;break;case"SkyDome":this._skyRenderer.mesh=Hr.instance;break;default:this.skyRenderer.mesh=Ya.instance}s=e.reflectionTexture;s&&(this.customReflection=on.getRes(s)),this.enableFog=e.enableFog,this.fogStart=e.fogStart,this.fogRange=e.fogRange;s=e.fogColor;s&&((e=this.fogColor).fromArray(s),this.fogColor=e)}},{key:"_onActive",value:function(){G(z(x.prototype),"_onActive",this).call(this),M.stage._scene3Ds.push(this)}},{key:"_onInActive",value:function(){G(z(x.prototype),"_onInActive",this).call(this);var e=M.stage._scene3Ds;e.splice(e.indexOf(this),1)}},{key:"_addRenderObject",value:function(e){var t,n,i,a;this._octree&&e._supportOctree?this._octree.add(e):(this._renders.add(e),yt.supportWebGLPlusCulling&&(t=e._getIndexInList(),(n=this._cullingBufferIndices.length)<=t&&(i=this._cullingBufferIndices,a=this._cullingBufferResult,this._cullingBufferIndices=new Int32Array(n+1024),this._cullingBufferResult=new Int32Array(n+1024),this._cullingBufferIndices.set(i,0),this._cullingBufferResult.set(a,0)),this._cullingBufferIndices[t]=e._cullingBufferIndex))}},{key:"_removeRenderObject",value:function(e){var t;this._octree&&e._supportOctree?this._octree.remove(e):(yt.supportWebGLPlusCulling&&(t=this._renders.elements[this._renders.length-1]),this._renders.remove(e),yt.supportWebGLPlusCulling&&(this._cullingBufferIndices[t._getIndexInList()]=t._cullingBufferIndex))}},{key:"_addShadowCastRenderObject",value:function(e){this._octree||this._castShadowRenders.add(e)}},{key:"_removeShadowCastRenderObject",value:function(e){this._octree||this._castShadowRenders.remove(e)}},{key:"_getRenderQueue",value:function(e){return e<=2500?this._opaqueQueue:this._transparentQueue}},{key:"setlightmaps",value:function(e){for(var t=this._lightmaps,n=0,i=t.length;n<i;n++)t[n]._removeReference();if(!e)throw new Error("Scene3D: value value can't be null.");var a=e.length;for(t.length=a,n=0;n<a;n++){var r=e[n];r._addReference(),t[n]=r}for(n=0,i=this._children.length;n<i;n++)this._setLightmapToChildNode(this._children[n])}},{key:"getlightmaps",value:function(){return this._lightmaps.slice()}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.destroyed||(G(z(x.prototype),"destroy",this).call(this,e),this._skyRenderer.destroy(),this._skyRenderer=null,this._directionLights=null,this._pointLights=null,this._spotLights=null,this._alternateLights=null,this._lightmaps=null,this._shaderValues=null,this._renders=null,this._castShadowRenders=null,this._cameraPool=null,this._octree=null,this.parallelSplitShadowMaps=null,this._physicsSimulation&&this._physicsSimulation._destroy(),on.clearRes(this.url))}},{key:"render",value:function(e,t,n){e._curSubmit=we.RENDERBASE,0<this._children.length&&e.addRenderObject(this)}},{key:"renderSubmit",value:function(){var e,t,n;for(this._prepareSceneToRender(),e=0,n=(t=this._cameraPool.length)-1;e<t;e++){yt.supportWebGLPlusRendering&&va.setRuntimeValueMode(e==n);var i=this._cameraPool[e];i.enableRender&&i.render()}return lt.set2DRenderConfig(),1}},{key:"getRenderType",value:function(){return 0}},{key:"releaseRender",value:function(){}},{key:"reUse",value:function(e,t){return 0}},{key:"url",get:function(){return this._url}},{key:"enableFog",get:function(){return this._enableFog},set:function(e){this._enableFog!==e&&((this._enableFog=e)?this._shaderValues.addDefine(nr.SHADERDEFINE_FOG):this._shaderValues.removeDefine(nr.SHADERDEFINE_FOG))}},{key:"fogColor",get:function(){return this._shaderValues.getVector3(x.FOGCOLOR)},set:function(e){this._shaderValues.setVector3(x.FOGCOLOR,e)}},{key:"fogStart",get:function(){return this._shaderValues.getNumber(x.FOGSTART)},set:function(e){this._shaderValues.setNumber(x.FOGSTART,e)}},{key:"fogRange",get:function(){return this._shaderValues.getNumber(x.FOGRANGE)},set:function(e){this._shaderValues.setNumber(x.FOGRANGE,e)}},{key:"ambientColor",get:function(){return this._shaderValues.getVector3(x.AMBIENTCOLOR)},set:function(e){this._shaderValues.setVector3(x.AMBIENTCOLOR,e)}},{key:"skyRenderer",get:function(){return this._skyRenderer}},{key:"customReflection",get:function(){return this._shaderValues.getTexture(x.REFLECTIONTEXTURE)},set:function(e){this._shaderValues.setTexture(x.REFLECTIONTEXTURE,e),e?this._shaderValues.addDefine(nr.SHADERDEFINE_REFLECTMAP):this._shaderValues.removeDefine(nr.SHADERDEFINE_REFLECTMAP)}},{key:"reflectionIntensity",get:function(){return this._shaderValues.getNumber(x.REFLETIONINTENSITY)},set:function(e){e=Math.max(Math.min(e,1),0),this._shaderValues.setNumber(x.REFLETIONINTENSITY,e)}},{key:"physicsSimulation",get:function(){return this._physicsSimulation}},{key:"reflectionMode",get:function(){return this._reflectionMode},set:function(e){this._reflectionMode=e}},{key:"timer",get:function(){return this._timer},set:function(e){this._timer=e}},{key:"input",get:function(){return this._input}}],[{key:"__init__",value:function(){var e,t,n=ha._config;n._multiLighting&&(e=n.maxLightCount,t=n.lightClusterCount,Aa.instance=new Aa(t.x,t.y,t.z,Math.min(n.maxLightCount,n._maxAreaLightCountPerClusterAverage)),(x._lightTexture=ia._createFloatTextureBuffer(4,e)).lock=!0,x._lightPixles=new Float32Array(4*e*4)),nr.SHADERDEFINE_FOG=ca.getDefineByName("FOG"),nr.SHADERDEFINE_DIRECTIONLIGHT=ca.getDefineByName("DIRECTIONLIGHT"),nr.SHADERDEFINE_POINTLIGHT=ca.getDefineByName("POINTLIGHT"),nr.SHADERDEFINE_SPOTLIGHT=ca.getDefineByName("SPOTLIGHT"),nr.SHADERDEFINE_CAST_SHADOW=ca.getDefineByName("CASTSHADOW"),nr.SHADERDEFINE_SHADOW_PSSM1=ca.getDefineByName("SHADOWMAP_PSSM1"),nr.SHADERDEFINE_SHADOW_PSSM2=ca.getDefineByName("SHADOWMAP_PSSM2"),nr.SHADERDEFINE_SHADOW_PSSM3=ca.getDefineByName("SHADOWMAP_PSSM3"),nr.SHADERDEFINE_SHADOW_PCF_NO=ca.getDefineByName("SHADOWMAP_PCF_NO"),nr.SHADERDEFINE_SHADOW_PCF1=ca.getDefineByName("SHADOWMAP_PCF1"),nr.SHADERDEFINE_SHADOW_PCF2=ca.getDefineByName("SHADOWMAP_PCF2"),nr.SHADERDEFINE_SHADOW_PCF3=ca.getDefineByName("SHADOWMAP_PCF3"),nr.SHADERDEFINE_REFLECTMAP=ca.getDefineByName("REFLECTMAP")}},{key:"load",value:function(e,t){M.loader.create(e,t,null,x.HIERARCHY)}}]),x}();io.HIERARCHY="HIERARCHY",io.physicsSettings=new Gr,io.octreeCulling=!1,io.octreeInitialSize=64,io.octreeInitialCenter=new vn(0,0,0),io.octreeMinNodeSize=2,io.octreeLooseness=1.25,io.REFLECTIONMODE_SKYBOX=0,io.REFLECTIONMODE_CUSTOM=1,io.FOGCOLOR=ca.propertyNameToID("u_FogColor"),io.FOGSTART=ca.propertyNameToID("u_FogStart"),io.FOGRANGE=ca.propertyNameToID("u_FogRange"),io.DIRECTIONLIGHTCOUNT=ca.propertyNameToID("u_DirationLightCount"),io.LIGHTBUFFER=ca.propertyNameToID("u_LightBuffer"),io.CLUSTERBUFFER=ca.propertyNameToID("u_LightClusterBuffer"),io.SUNLIGHTDIRECTION=ca.propertyNameToID("u_SunLight.direction"),io.SUNLIGHTDIRCOLOR=ca.propertyNameToID("u_SunLight.color"),io.LIGHTDIRECTION=ca.propertyNameToID("u_DirectionLight.direction"),io.LIGHTDIRCOLOR=ca.propertyNameToID("u_DirectionLight.color"),io.POINTLIGHTPOS=ca.propertyNameToID("u_PointLight.position"),io.POINTLIGHTRANGE=ca.propertyNameToID("u_PointLight.range"),io.POINTLIGHTATTENUATION=ca.propertyNameToID("u_PointLight.attenuation"),io.POINTLIGHTCOLOR=ca.propertyNameToID("u_PointLight.color"),io.SPOTLIGHTPOS=ca.propertyNameToID("u_SpotLight.position"),io.SPOTLIGHTDIRECTION=ca.propertyNameToID("u_SpotLight.direction"),io.SPOTLIGHTSPOTANGLE=ca.propertyNameToID("u_SpotLight.spot"),io.SPOTLIGHTRANGE=ca.propertyNameToID("u_SpotLight.range"),io.SPOTLIGHTCOLOR=ca.propertyNameToID("u_SpotLight.color"),io.SHADOWDISTANCE=ca.propertyNameToID("u_shadowPSSMDistance"),io.SHADOWLIGHTVIEWPROJECT=ca.propertyNameToID("u_lightShadowVP"),io.SHADOWMAPPCFOFFSET=ca.propertyNameToID("u_shadowPCFoffset"),io.SHADOWMAPTEXTURE1=ca.propertyNameToID("u_shadowMap1"),io.SHADOWMAPTEXTURE2=ca.propertyNameToID("u_shadowMap2"),io.SHADOWMAPTEXTURE3=ca.propertyNameToID("u_shadowMap3"),io.AMBIENTCOLOR=ca.propertyNameToID("u_AmbientColor"),io.REFLECTIONTEXTURE=ca.propertyNameToID("u_ReflectTexture"),io.REFLETIONINTENSITY=ca.propertyNameToID("u_ReflectIntensity"),io.TIME=ca.propertyNameToID("u_Time");var ao=function(){T(g,Tn);var t=b(g);function g(){var e;return S(this,g),(e=t.apply(this,arguments))._nodeIDAniDic={},e}return C(g,[{key:"_parseNodeList",value:function(e){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[e.compId]=e.props,e.compId&&this._nodeList.push(e.compId);var t=e.child;if(t)for(var n=t.length,i=0;i<n;i++)this._parseNodeList(t[i])}},{key:"_calGraphicData",value:function(e){if(this._setUp(null,e),this._createGraphicData(),this._nodeIDAniDic)for(var t in this._nodeIDAniDic)this._nodeIDAniDic[t]=null}},{key:"_createGraphicData",value:function(){for(var e,t=[],n=this.count,i=(i=this._usedFrames)||[],a=0;a<n;a++)!i[a]&&e||(e=this._createFrameGraphic(a)),t.push(e);this._gList=t}},{key:"_createFrameGraphic",value:function(e){var t=new St;return g._rootMatrix||(g._rootMatrix=new D),this._updateNodeGraphic(this._rootNode,e,g._rootMatrix,t),t}},{key:"_updateNodeGraphic",value:function(e,t,n,i){var a,r,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,s=this._nodeGDic[e.compId]=this._getNodeGraphicData(e.compId,t,this._nodeGDic[e.compId]);s.resultTransform||(s.resultTransform=new D),a=s.resultTransform,D.mul(s.transform,n,a);var l=s.alpha*o;if(!(l<.01)){s.skin&&(r=this._getTextureByUrl(s.skin))&&(a._checkTransform()?(i.drawTexture(r,0,0,s.width,s.height,a,l),s.resultTransform=null):i.drawTexture(r,a.tx,a.ty,s.width,s.height,null,l));var h=e.child;if(h)for(var u=h.length,d=0;d<u;d++)this._updateNodeGraphic(h[d],t,a,i,l)}}},{key:"_updateNoChilds",value:function(e,t){var n,i;!e.skin||(n=this._getTextureByUrl(e.skin))&&((i=e.transform)._checkTransform(),!i._bTransform?t.drawTexture(n,i.tx,i.ty,e.width,e.height,null,e.alpha):t.drawTexture(n,0,0,e.width,e.height,i.clone(),e.alpha))}},{key:"_updateNodeGraphic2",value:function(e,t,n){var i=this._nodeGDic[e.compId]=this._getNodeGraphicData(e.compId,t,this._nodeGDic[e.compId]);if(e.child){var a,r,o,s=i.transform;s._checkTransform(),r=(a=!s._bTransform)&&(0!=s.tx||0!=s.ty),(o=s._bTransform||1!=i.alpha)&&n.save(),1!=i.alpha&&n.alpha(i.alpha),a?r&&n.translate(s.tx,s.ty):n.transform(s.clone());var l,h=e.child;if(i.skin&&(l=this._getTextureByUrl(i.skin))&&n.drawImage(l,0,0,i.width,i.height),h)for(var u=h.length,d=0;d<u;d++)this._updateNodeGraphic2(h[d],t,n);o?n.restore():a?r&&n.translate(-s.tx,-s.ty):n.transform(s.clone().invert())}else this._updateNoChilds(i,n)}},{key:"_calculateKeyFrames",value:function(e){G(z(g.prototype),"_calculateKeyFrames",this).call(this,e),this._nodeIDAniDic[e.target]=e}},{key:"getNodeDataByID",value:function(e){return this._nodeIDAniDic[e]}},{key:"_getParams",value:function(e,t,n,i){var a=g._temParam;a.length=t.length;for(var r=t.length,o=0;o<r;o++)a[o]=this._getObjVar(e,t[o][0],n,t[o][1],i);return a}},{key:"_getObjVar",value:function(e,t,n,i,a){if(t in e){var r=e[t];return n>=r.length&&(n=r.length-1),e[t][n]}return t in a?a[t]:i}},{key:"_getNodeGraphicData",value:function(e,t,n){(n=n||new ro).transform?n.transform.identity():n.transform=new D;var i=this.getNodeDataByID(e);if(!i)return n;var a=i.frames,r=this._getParams(a,g._drawTextureCmd,t,this._nodeDefaultProps[e]),o=r[0],s=r[5],l=r[6],h=r[13],u=r[14],d=r[7],c=r[8],_=r[9],f=r[11],i=r[12],a=r[3],t=r[4];0!=a&&0!=t||(o=null),-1==a&&(a=0),-1==t&&(t=0),n.skin=o,n.width=a,n.height=t,o&&((e=this._getTextureByUrl(o))?(a=a||e.sourceWidth,t=t||e.sourceHeight):console.warn("lost skin:",o,",you may load pics first")),n.alpha=r[10];o=n.transform;0!=u&&(l=u*t),0==(s=0!=h?h*a:s)&&0==l||o.translate(-s,-l);s=null;return(_||1!==d||1!==c||f||i)&&((s=g._tempMt).identity(),s._bTransform=!0,l=.0174532922222222*(_-f),f=.0174532922222222*(_+i),_=Math.cos(f),i=Math.sin(f),f=Math.sin(l),l=Math.cos(l),s.a=d*_,s.b=d*i,s.c=-c*f,s.d=c*l,s.tx=s.ty=0),(o=s?D.mul(o,s,o):o).translate(r[1],r[2]),n}},{key:"_getTextureByUrl",value:function(e){return on.getRes(e)}},{key:"setAniData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(e.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=e,this._parseNodeList(e);for(var n,i={},a=[],r=e.animations,o=r.length,s=0;s<o;s++)if(n=r[s],this._labels=null,(!t||t==n.name)&&n){try{this._calGraphicData(n)}catch(e){console.warn("parse animation fail:"+n.name+",empty animation created"),this._gList=[]}var l={};l.interval=1e3/n.frameRate,l.frames=this._gList,l.labels=this._labels,l.name=n.name,a.push(l),i[n.name]=l}this.animationList=a,this.animationDic=i}g._temParam.length=0}},{key:"parseByData",value:function(e){var t=e.nodeRoot,n=e.aniO;delete e.nodeRoot,delete e.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=t,this._parseNodeList(t),this._labels=null;try{this._calGraphicData(n)}catch(e){console.warn("parse animation fail:"+n.name+",empty animation created"),this._gList=[]}return e.interval=1e3/n.frameRate,e.frames=this._gList,e.labels=this._labels,e.name=n.name,e}},{key:"setUpAniData",value:function(e){if(e.animations){for(var t,n,i={},a=[],r=e.animations,o=r.length,s=0;s<o;s++)(n=r[s])&&((t={}).name=n.name,t.aniO=n,t.nodeRoot=e,a.push(t),i[n.name]=t);this.animationList=a,this.animationDic=i}}},{key:"_clear",value:function(){this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic=null}}],[{key:"parseAnimationByData",value:function(e){e=(g._I=!g._I?new g:g._I).parseByData(e);return g._I._clear(),e}},{key:"parseAnimationData",value:function(e){return(g._I=!g._I?new g:g._I).setUpAniData(e),(e={}).animationList=g._I.animationList,e.animationDic=g._I.animationDic,g._I._clear(),e}}]),g}();ao._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],ao._temParam=[],ao._tempMt=new D;var ro=function e(){S(this,e),this.alpha=1},oo=function(){T(h,xn);var t=b(h);function h(){var e;return S(this,h),(e=t.call(this))._setControlNode(u(e)),e}return C(h,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.stop(),G(z(h.prototype),"destroy",this).call(this,e),this._frames=null,this._labels=null}},{key:"play",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";n&&this._setFramesFromCache(n,!0),G(z(h.prototype),"play",this).call(this,e,t,n)}},{key:"_setFramesFromCache",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if((e=this._url?this._url+"#"+e:e)&&h.framesMap[e]){var n=h.framesMap[e];return n instanceof Array?(this._frames=h.framesMap[e],this._count=this._frames.length):(n.nodeRoot&&(h.framesMap[e]=ao.parseAnimationByData(n),n=h.framesMap[e]),this._frames=n.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=n.interval),this._labels=this._copyLabels(n.labels)),!0}return t&&console.log("ani not found:",e),!1}},{key:"_copyLabels",value:function(e){if(!e)return null;var t,n={};for(t in e)n[t]=ae.copyArray([],e[t]);return n}},{key:"_frameLoop",value:function(){this._visible&&.01<this._style.alpha&&this._frames&&G(z(h.prototype),"_frameLoop",this).call(this)}},{key:"_displayToIndex",value:function(e){this._frames&&(this.graphics=this._frames[e])}},{key:"clear",value:function(){return G(z(h.prototype),"clear",this).call(this),this.stop(),this.graphics=null,this._frames=null,this._labels=null,this}},{key:"loadImages",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return this._url="",this._setFramesFromCache(t)||(this.frames=h.framesMap[t]||h.createFrames(e,t)),this}},{key:"loadAtlas",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";this._url="";var e,a=this;return a._setFramesFromCache(i)||(e=function(e){t===e&&(a.frames=h.framesMap[i]||h.createFrames(t,i),n&&n.run())},on.getAtlas(t)?e(t):M.loader.load(t,F.create(null,e,[t]),null,on.ATLAS)),this}},{key:"loadAnimation",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this._url=e;return this._actionName||(this._actionName=""),this._setFramesFromCache(this._actionName)?(this._setFramesFromCache(this._actionName,!0),this.index=0,t&&t.run()):!n||on.getAtlas(n)?this._loadAnimationData(e,t,n):M.loader.load(n,F.create(this,this._loadAnimationData,[e,t,n]),null,on.ATLAS),this}},{key:"_loadAnimationData",value:function(o){var s,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;function t(e){if(on.getRes(e)){if(o===e){var t;if(h.framesMap[o+"#"])s._setFramesFromCache(s._actionName,!0),s.index=0,s._resumePlay();else{e=ao.parseAnimationData(on.getRes(o));if(!e)return;for(var n,i=e.animationList,a=i.length,r=0;r<a;r++)t=i[r],h.framesMap[o+"#"+t.name]=t,n=n||t;n&&(h.framesMap[o+"#"]=n,s._setFramesFromCache(s._actionName,!0),s.index=0),s._resumePlay()}l&&l.run()}on.clearRes(o)}else h.framesMap[o+"#"]&&(s._setFramesFromCache(s._actionName,!0),s.index=0,s._resumePlay(),l&&l.run())}!e||on.getAtlas(e)?(s=this,on.getRes(o)?t(o):M.loader.load(o,F.create(null,t,[o]),null,on.JSON)):console.warn("atlas load fail:"+e)}},{key:"frames",get:function(){return this._frames},set:function(e){(this._frames=e)&&(this._count=e.length,this._actionName&&this._setFramesFromCache(this._actionName,!0),this.index=this._index)}},{key:"source",set:function(e){-1<e.indexOf(".ani")?this.loadAnimation(e):-1<e.indexOf(".json")||-1<e.indexOf("als")||-1<e.indexOf("atlas")?this.loadAtlas(e):this.loadImages(e.split(","))}},{key:"autoAnimation",set:function(e){this.play(0,!0,e)}},{key:"autoPlay",set:function(e){e?this.play():this.stop()}}],[{key:"createFrames",value:function(e,t){var n;if("string"==typeof e){var i=on.getAtlas(e);if(i&&i.length){n=[];for(var a=0,r=i.length;a<r;a++){var o=new St;o.drawImage(on.getRes(i[a]),0,0),n.push(o)}}}else if(e instanceof Array)for(n=[],a=0,r=e.length;a<r;a++)(o=new St).loadImage(e[a],0,0),n.push(o);return t&&(h.framesMap[t]=n),n}},{key:"clearCache",value:function(e){var t,n=e+"#";for(t in h.framesMap)t!==e&&0!==t.indexOf(n)||delete h.framesMap[t]}}]),h}();function so(){S(this,so)}oo.framesMap={},M.regClass(oo),Dt.regClass("laya.display.Animation",oo),Dt.regClass("Laya.Animation",oo);var lo=function(){T(n,gr);var t=b(n);function n(e){return S(this,n),t.call(this,e)}return C(n,[{key:"_renderUpdate",value:function(e,t){G(z(n.prototype),"_renderUpdate",this).call(this,e,t)}},{key:"_renderUpdateWithCamera",value:function(e,t){G(z(n.prototype),"_renderUpdateWithCamera",this).call(this,e,t),this._owner._updateShape(e.camera)}}]),n}(),ho=function(){T(s,gr);var t=b(s);function s(e){return S(this,s),(e=t.call(this,e))._bones=[],e._skinnedDataLoopMarks=[],e._localBounds=new _r(vn._ZERO,vn._ZERO),e._cacheAnimationNode=[],e}return C(s,[{key:"_computeSkinnedData",value:function(){if(this._cacheMesh&&this._cacheAvatar||this._cacheMesh&&!this._cacheAvatar)for(var e=this._cacheMesh._inverseBindPoses,t=this._cacheMesh._bindPoseIndices,n=this._cacheMesh._skinDataPathMarks,i=0,a=this._cacheMesh.subMeshCount;i<a;i++)for(var r=this._cacheMesh.getSubMesh(i)._boneIndicesList,o=this._skinnedData[i],s=0,l=r.length;s<l;s++){var h=r[s];this._computeSubSkinnedData(e,h,t,o[s],n)}}},{key:"_computeSubSkinnedData",value:function(e,t,n,i,a){for(var r=0,o=t.length;r<o;r++){var s=t[r];if(this._skinnedDataLoopMarks[s]===J.loopCount)for(var l=a[s],h=this._skinnedData[l[0]][l[1]],u=16*l[2],d=16*r,c=0;c<16;c++)i[d+c]=h[u+c];else this._cacheAvatar?ia._mulMatrixArray(this._cacheAnimationNode[s].transform.getWorldMatrix(),e[n[s]],i,16*r):(l=n[s],ia._mulMatrixArray(this._bones[l].transform.worldMatrix.elements,e[l],i,16*r)),this._skinnedDataLoopMarks[s]=J.loopCount}}},{key:"_onWorldMatNeedChange",value:function(e){this._boundsChange=!0,this._octreeNode&&(this._cacheAvatar?-1===this._indexInOctreeMotionList&&this._octreeNode._octree.addMotionObject(this):(e&=_a.TRANSFORM_WORLDPOSITION|_a.TRANSFORM_WORLDQUATERNION|_a.TRANSFORM_WORLDSCALE)&&-1===this._indexInOctreeMotionList&&this._octreeNode._octree.addMotionObject(this))}},{key:"_createRenderElement",value:function(){return new ar}},{key:"_onMeshChange",value:function(e){G(z(s.prototype),"_onMeshChange",this).call(this,e);var t=(this._cacheMesh=e).subMeshCount;this._skinnedData=[],this._skinnedDataLoopMarks.length=e._bindPoseIndices.length;for(var n=0;n<t;n++)for(var i=e.getSubMesh(n)._boneIndicesList,a=i.length,r=this._skinnedData[n]=[],o=0;o<a;o++)r[o]=new Float32Array(16*i[o].length);this._cacheAvatar&&e&&this._getCacheAnimationNodes()}},{key:"_setCacheAnimator",value:function(e){this._cacheAnimator=e,this._shaderValues.addDefine(so.SHADERDEFINE_BONE),this._setRootNode()}},{key:"_calculateBoundingBox",value:function(){var e,t,n;this._cacheAvatar?this._cacheAnimator&&this._rootBone?(n=s._tempMatrix4x4,ia.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheRootAnimationNode.transform.getWorldMatrix(),n),this._localBounds._tranform(n,this._bounds)):G(z(s.prototype),"_calculateBoundingBox",this).call(this):this._cacheRootBone?this._localBounds._tranform(this._cacheRootBone.transform.worldMatrix,this._bounds):this._localBounds._tranform(this._owner.transform.worldMatrix,this._bounds),yt.supportWebGLPlusCulling&&(e=this._bounds.getMin(),t=this._bounds.getMax(),(n=ba._cullingBuffer)[this._cullingBufferIndex+1]=e.x,n[this._cullingBufferIndex+2]=e.y,n[this._cullingBufferIndex+3]=e.z,n[this._cullingBufferIndex+4]=t.x,n[this._cullingBufferIndex+5]=t.y,n[this._cullingBufferIndex+6]=t.z)}},{key:"_renderUpdate",value:function(e,t){var n;this._cacheAnimator?(this._computeSkinnedData(),this._cacheAvatar?(n=this._cacheAnimator.owner._transform,this._shaderValues.setMatrix4x4(fa.WORLDMATRIX,n.worldMatrix)):this._shaderValues.setMatrix4x4(fa.WORLDMATRIX,ki.DEFAULT)):this._shaderValues.setMatrix4x4(fa.WORLDMATRIX,t.worldMatrix)}},{key:"_renderUpdateWithCamera",value:function(e,t){var n=e.projectionViewMatrix;this._cacheAnimator?this._cacheAvatar?(e=this._cacheAnimator.owner._transform,ki.multiply(n,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(fa.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(fa.MVPMATRIX,n):(ki.multiply(n,t.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(fa.MVPMATRIX,this._projectionViewWorldMatrix))}},{key:"_destroy",value:function(){G(z(s.prototype),"_destroy",this).call(this),this._cacheAvatar?this._cacheRootAnimationNode&&this._cacheRootAnimationNode.transform.off(Je.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange):this._cacheRootBone?this._cacheRootBone.destroyed||this._cacheRootBone.transform.off(Je.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange):this._owner&&!this._owner.destroyed&&this._owner.transform.off(Je.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange)}},{key:"_setRootBone",value:function(e){this._rootBone=e,this._setRootNode()}},{key:"_setRootNode",value:function(){var e=this._cacheAnimator&&this._rootBone&&this._cacheAvatar?this._cacheAnimator._avatarNodeMap[this._rootBone]:null;this._cacheRootAnimationNode!=e&&(this._onWorldMatNeedChange(_a.TRANSFORM_WORLDPOSITION|_a.TRANSFORM_WORLDQUATERNION|_a.TRANSFORM_WORLDSCALE),this._owner.transform.off(Je.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),this._cacheRootAnimationNode&&this._cacheRootAnimationNode.transform.off(Je.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),e&&e.transform.on(Je.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),this._cacheRootAnimationNode=e)}},{key:"_getCacheAnimationNodes",value:function(){var e=this._cacheMesh._boneNames,t=this._cacheMesh._bindPoseIndices,n=t.length;if(yt.supportWebGLPlusAnimation){this._cacheAnimationNodeIndices=new Uint16Array(n);for(var i=this._cacheAnimator._avatarNodeMap,a=0;a<n;a++){var r=i[e[t[a]]];this._cacheAnimationNodeIndices[a]=r?r._worldMatrixIndex:0}}else{this._cacheAnimationNode.length=n;for(var o=this._cacheAnimator._avatarNodeMap,a=0;a<n;a++){var s=o[e[t[a]]];this._cacheAnimationNode[a]=s}}}},{key:"_setCacheAvatar",value:function(e){this._cacheAvatar!==e&&(this._cacheMesh?(this._cacheAvatar=e)&&(this._shaderValues.addDefine(so.SHADERDEFINE_BONE),this._getCacheAnimationNodes()):this._cacheAvatar=e,this._setRootNode())}},{key:"_computeSubSkinnedDataNative",value:function(e,t,n,i,a,r){P.instance.computeSubSkinnedData(e,t,n,i,a,r)}},{key:"_computeSkinnedDataForNative",value:function(){if(this._cacheMesh&&this._cacheAvatar||this._cacheMesh&&!this._cacheAvatar)for(var e=this._cacheMesh._inverseBindPoses,t=this._cacheMesh._bindPoseIndices,n=this._cacheMesh._skinDataPathMarks,i=0,a=this._cacheMesh.subMeshCount;i<a;i++)for(var r=this._cacheMesh.getSubMesh(i)._boneIndicesList,o=this._skinnedData[i],s=0,l=r.length;s<l;s++){var h=r[s];this._cacheAvatar&&yt.supportWebGLPlusAnimation?this._computeSubSkinnedDataNative(this._cacheAnimator._animationNodeWorldMatrixs,this._cacheAnimationNodeIndices,this._cacheMesh._inverseBindPosesBuffer,h,t,o[s]):this._computeSubSkinnedData(e,h,t,o[s],n)}}},{key:"localBounds",get:function(){return this._localBounds},set:function(e){this._localBounds=e}},{key:"rootBone",get:function(){return this._cacheRootBone},set:function(e){this._cacheRootBone!=e&&((this._cacheRootBone||this._owner).transform.off(Je.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),(e||this._owner).transform.on(Je.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),this._cacheRootBone=e,this._onWorldMatNeedChange(_a.TRANSFORM_WORLDPOSITION|_a.TRANSFORM_WORLDQUATERNION|_a.TRANSFORM_WORLDSCALE))}},{key:"bones",get:function(){return this._bones}},{key:"bounds",get:function(){return(this._boundsChange||this._cacheAvatar)&&(this._calculateBoundingBox(),this._boundsChange=!1),this._bounds}}]),s}();ho._tempMatrix4x4=new ki;var uo=function(){T(d,ga);var n=b(d);function d(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return S(this,d),(t=n.call(this,t))._meshFilter=new ka(u(t)),t._render=new ho(u(t)),e&&(t._meshFilter.sharedMesh=e),t}return C(d,[{key:"_parse",value:function(e,t){G(z(d.prototype),"_parse",this).call(this,e,t);var n=this.skinnedMeshRenderer,i=e.lightmapIndex;null!=i&&(n.lightmapIndex=i);i=e.lightmapScaleOffset;i&&(n.lightmapScaleOffset=new yn(i[0],i[1],i[2],i[3])),!(i=e.meshPath)||(l=on.getRes(i))&&(this.meshFilter.sharedMesh=l);var a=e.materials;if(a){var r=n.sharedMaterials,o=a.length;r.length=o;for(var s=0;s<o;s++)r[s]=on.getRes(a[s].path);n.sharedMaterials=r}var i=e.boundBox,l=i.min,i=i.max;if(n.localBounds.setMin(new vn(l[0],l[1],l[2])),n.localBounds.setMax(new vn(i[0],i[1],i[2])),t){i=e.rootBone;n.rootBone=t[i];for(var h=e.bones,s=0,u=h.length;s<u;s++)n.bones.push(t[h[s]])}else e.rootBone&&n._setRootBone(e.rootBone)}},{key:"_changeHierarchyAnimator",value:function(e){G(z(d.prototype),"_changeHierarchyAnimator",this).call(this,e),this.skinnedMeshRenderer._setCacheAnimator(e)}},{key:"_changeAnimatorAvatar",value:function(e){this.skinnedMeshRenderer._setCacheAvatar(e)}},{key:"_cloneTo",value:function(e,t,n){var i=e;i.meshFilter.sharedMesh=this.meshFilter.sharedMesh;var a=this._render,r=i._render;r.enable=a.enable,r.sharedMaterials=a.sharedMaterials,r.castShadow=a.castShadow;i=a.lightmapScaleOffset;i&&(r.lightmapScaleOffset=i.clone()),r.receiveShadow=a.receiveShadow,r.sortingFudge=a.sortingFudge,r._rootBone=a._rootBone;var o=a.bones,s=r.bones,i=o.length;s.length=i;var l,i=a.rootBone;i&&(l=ia._getHierarchyPath(t,i,d._tempArray0),r.rootBone=l?ia._getNodeByHierarchyPath(n,l):i);for(var h=0;h<o.length;h++)l=ia._getHierarchyPath(t,o[h],d._tempArray0),s[h]=l?ia._getNodeByHierarchyPath(n,l):o[h];a=a.localBounds;a&&a.cloneTo(r.localBounds),G(z(d.prototype),"_cloneTo",this).call(this,e,t,n)}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.destroyed||(G(z(d.prototype),"destroy",this).call(this,e),this._meshFilter.destroy())}},{key:"_create",value:function(){return new d}},{key:"meshFilter",get:function(){return this._meshFilter}},{key:"skinnedMeshRenderer",get:function(){return this._render}}],[{key:"__init__",value:function(){so.SHADERDEFINE_BONE=ca.getDefineByName("BONE")}}]),d}();uo._tempArray0=[],uo.BONES=ca.propertyNameToID("u_Bones");var co=function(){T(i,Ia);var n=b(i);function i(e){var t;return S(this,i),(t=n.call(this))._id=++i._uniqueIDCounter,t._mesh=e,t._boneIndicesList=[],t._subIndexBufferStart=[],t._subIndexBufferCount=[],t}return C(i,[{key:"_setIndexRange",value:function(e,t){this._indexStart=e,this._indexCount=t,this._indices=new Uint16Array(this._indexBuffer.getData().buffer,2*e,t)}},{key:"_getType",value:function(){return i._type}},{key:"_prepareRender",value:function(e){return this._mesh._uploadVerticesData(),!0}},{key:"_render",value:function(e){var t=P.instance;this._mesh._bufferState.bind();var n=e.renderElement.render._skinnedData;if(n)for(var i=n[this._indexInMesh],a=this._boneIndicesList.length,r=0;r<a;r++)e.shader.uploadCustomUniform(uo.BONES,i[r]),t.drawElements(t.TRIANGLES,this._subIndexBufferCount[r],t.UNSIGNED_SHORT,2*this._subIndexBufferStart[r]);else t.drawElements(t.TRIANGLES,this._indexCount,t.UNSIGNED_SHORT,2*this._indexStart);J.trianglesFaces+=this._indexCount/3,J.renderBatches++}},{key:"getIndices",value:function(){if(this._mesh._isReadable)return this._indices.slice();throw"SubMesh:can't get indices on subMesh,mesh's isReadable must be true."}},{key:"setIndices",value:function(e){this._indexBuffer.setData(e,this._indexStart,0,this._indexCount)}},{key:"destroy",value:function(){this._destroyed||(G(z(i.prototype),"destroy",this).call(this),this._indexBuffer.destroy(),this._indexBuffer=null,this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null)}},{key:"indexCount",get:function(){return this._indexCount}}]),i}();co._uniqueIDCounter=0,co._type=Ia._typeCounter++;var _o=function(){function x(){S(this,x)}return C(x,null,[{key:"parse",value:function(e,t,n,i){x._mesh=n,x._subMeshes=i,x._version=t,x._readData=e,x.READ_DATA(),x.READ_BLOCK(),x.READ_STRINGS();for(var a=0,r=x._BLOCK.count;a<r;a++){x._readData.pos=x._BLOCK.blockStarts[a];var o=x._readData.getUint16(),s=x._strings[o],l=x["READ_"+s];if(null==l)throw new Error("model file err,no this function:"+o+" "+s);l.call(null)}x._mesh._bindPoseIndices=new Uint16Array(x._bindPoseIndices),x._bindPoseIndices.length=0,x._strings.length=0,x._readData=null,x._version=null,x._mesh=null,x._subMeshes=null}},{key:"_readString",value:function(){return x._strings[x._readData.getUint16()]}},{key:"READ_DATA",value:function(){x._DATA.offset=x._readData.getUint32(),x._DATA.size=x._readData.getUint32()}},{key:"READ_BLOCK",value:function(){for(var e=x._BLOCK.count=x._readData.getUint16(),t=x._BLOCK.blockStarts=[],n=x._BLOCK.blockLengths=[],i=0;i<e;i++)t.push(x._readData.getUint32()),n.push(x._readData.getUint32())}},{key:"READ_STRINGS",value:function(){var e=x._readData.getUint32(),t=x._readData.getUint16(),n=x._readData.pos;x._readData.pos=e+x._DATA.offset;for(var i=0;i<t;i++)x._strings[i]=x._readData.readUTFString();x._readData.pos=n}},{key:"READ_MESH",value:function(){for(var e=P.instance,t=(x._readString(),x._readData.__getBuffer()),n=0,i=x._readData.getInt16(),a=x._DATA.offset,r=0;r<i;r++){var o,s=a+x._readData.getUint32(),l=x._readData.getUint32(),s=t.slice(s,s+l),l=new Float32Array(s),h=x._readString();switch(x._version){case"LAYAMODEL:0301":case"LAYAMODEL:0400":o=wa.getVertexDeclaration(h);break;case"LAYAMODEL:0401":o=wa.getVertexDeclaration(h,!1);break;default:throw new Error("LoadModelV03: unknown version.")}if(!o)throw new Error("LoadModelV03: unknown vertexDeclaration.");s=new Na(4*l.length,e.STATIC_DRAW,!0);s.vertexDeclaration=o,s.setData(l.buffer),x._mesh._vertexBuffer=s,x._mesh._vertexCount+=s._byteLength/o.vertexStride,n+=4*l.length}var u=a+x._readData.getUint32(),d=x._readData.getUint32(),u=new Uint16Array(t.slice(u,u+d)),d=new Xa(Xa.INDEXTYPE_USHORT,d/2,e.STATIC_DRAW,!0);d.setData(u),n+=2*(x._mesh._indexBuffer=d).indexCount,x._mesh._setBuffer(x._mesh._vertexBuffer,d),x._mesh._setCPUMemory(n),x._mesh._setGPUMemory(n);var c=x._mesh._boneNames=[],_=x._readData.getUint16();for(c.length=_,r=0;r<_;r++)c[r]=x._strings[x._readData.getUint16()];x._readData.pos+=8;var u=x._readData.getUint32(),d=x._readData.getUint32(),f=new Float32Array(t.slice(a+u,a+u+d)),g=f.length,y=x._mesh._inverseBindPosesBuffer=new ArrayBuffer(4*g);for(x._mesh._inverseBindPoses=[],r=0;r<g;r+=16){var v=new ki(f[r+0],f[r+1],f[r+2],f[r+3],f[r+4],f[r+5],f[r+6],f[r+7],f[r+8],f[r+9],f[r+10],f[r+11],f[r+12],f[r+13],f[r+14],f[r+15],new Float32Array(y,4*r,16));x._mesh._inverseBindPoses[r/16]=v}return!0}},{key:"READ_SUBMESH",value:function(){var e=x._readData.__getBuffer(),t=new co(x._mesh);x._readData.getInt16(),x._readData.getUint32(),x._readData.getUint32();var n=x._readData.getUint32(),i=x._readData.getUint32(),a=x._mesh._indexBuffer;t._indexBuffer=a,t._setIndexRange(n,i);i=x._mesh._vertexBuffer;t._vertexBuffer=i;var r=x._DATA.offset,o=t._subIndexBufferStart,s=t._subIndexBufferCount,l=t._boneIndicesList,h=x._readData.getUint16();o.length=h,s.length=h,l.length=h;for(var u=x._mesh._skinDataPathMarks,d=x._bindPoseIndices,c=x._subMeshes.length,_=0;_<h;_++){o[_]=x._readData.getUint32(),s[_]=x._readData.getUint32();for(var f=x._readData.getUint32(),g=x._readData.getUint32(),y=l[_]=new Uint16Array(e.slice(r+f,r+f+g)),v=0,p=y.length;v<p;v++){var m=y[v],w=d.indexOf(m);-1===w?(y[v]=d.length,d.push(m),u.push([c,_,v])):y[v]=w}}return x._subMeshes.push(t),!0}}]),x}();_o._BLOCK={count:0},_o._DATA={offset:0,size:0},_o._strings=[],_o._bindPoseIndices=[];var fo=function(){function i(){S(this,i)}return C(i,null,[{key:"__init__",value:function(){for(var e=0;e<256;++e){var t=e-127;t<-27?(i._baseTable[0|e]=0,i._baseTable[256|e]=32768,i._shiftTable[0|e]=24,i._shiftTable[256|e]=24):t<-14?(i._baseTable[0|e]=1024>>-t-14,i._baseTable[256|e]=1024>>-t-14|32768,i._shiftTable[0|e]=-t-1,i._shiftTable[256|e]=-t-1):t<=15?(i._baseTable[0|e]=t+15<<10,i._baseTable[256|e]=t+15<<10|32768,i._shiftTable[0|e]=13,i._shiftTable[256|e]=13):t<128?(i._baseTable[0|e]=31744,i._baseTable[256|e]=64512,i._shiftTable[0|e]=24,i._shiftTable[256|e]=24):(i._baseTable[0|e]=31744,i._baseTable[256|e]=64512,i._shiftTable[0|e]=13,i._shiftTable[256|e]=13)}for(i._mantissaTable[0]=0,e=1;e<1024;++e){for(var n=e<<13,t=0;0==(8388608&n);)t-=8388608,n<<=1;n&=-8388609,t+=947912704,i._mantissaTable[e]=n|t}for(e=1024;e<2048;++e)i._mantissaTable[e]=939524096+(e-1024<<13);for(i._exponentTable[0]=0,e=1;e<31;++e)i._exponentTable[e]=e<<23;for(i._exponentTable[31]=1199570944,i._exponentTable[32]=2147483648,e=33;e<63;++e)i._exponentTable[e]=2147483648+(e-32<<23);for(i._exponentTable[63]=3347054592,i._offsetTable[0]=0,e=1;e<64;++e)i._offsetTable[e]=32===e?0:1024}},{key:"roundToFloat16Bits",value:function(e){i._floatView[0]=e;var t=i._uint32View[0],e=t>>23&511;return i._baseTable[e]+((8388607&t)>>i._shiftTable[e])}},{key:"convertToNumber",value:function(e){var t=e>>10;return i._uint32View[0]=i._mantissaTable[i._offsetTable[t]+(1023&e)]+i._exponentTable[t],i._floatView[0]}}]),i}();fo._buffer=new ArrayBuffer(4),fo._floatView=new Float32Array(fo._buffer),fo._uint32View=new Uint32Array(fo._buffer),fo._baseTable=new Uint32Array(512),fo._shiftTable=new Uint32Array(512),fo._mantissaTable=new Uint32Array(2048),fo._exponentTable=new Uint32Array(64),fo._offsetTable=new Uint32Array(64);var go=function(){function N(){S(this,N)}return C(N,null,[{key:"parse",value:function(e,t,n,i){N._mesh=n,N._subMeshes=i,N._version=t,N._readData=e,N.READ_DATA(),N.READ_BLOCK(),N.READ_STRINGS();for(var a=0,r=N._BLOCK.count;a<r;a++){N._readData.pos=N._BLOCK.blockStarts[a];var o=N._readData.getUint16(),s=N._strings[o],l=N["READ_"+s];if(null==l)throw new Error("model file err,no this function:"+o+" "+s);l.call(null)}N._mesh._bindPoseIndices=new Uint16Array(N._bindPoseIndices),N._bindPoseIndices.length=0,N._strings.length=0,N._readData=null,N._version=null,N._mesh=null,N._subMeshes=null}},{key:"_readString",value:function(){return N._strings[N._readData.getUint16()]}},{key:"READ_DATA",value:function(){N._DATA.offset=N._readData.getUint32(),N._DATA.size=N._readData.getUint32()}},{key:"READ_BLOCK",value:function(){for(var e=N._BLOCK.count=N._readData.getUint16(),t=N._BLOCK.blockStarts=[],n=N._BLOCK.blockLengths=[],i=0;i<e;i++)t.push(N._readData.getUint32()),n.push(N._readData.getUint32())}},{key:"READ_STRINGS",value:function(){var e=N._readData.getUint32(),t=N._readData.getUint16(),n=N._readData.pos;N._readData.pos=e+N._DATA.offset;for(var i=0;i<t;i++)N._strings[i]=N._readData.readUTFString();N._readData.pos=n}},{key:"READ_MESH",value:function(){for(var e=P.instance,t=0,n=(N._readString(),N._readData.__getBuffer()),i=N._readData.getInt16(),a=N._DATA.offset,r=0;r<i;r++){var o,s,l,h=a+N._readData.getUint32(),u=N._readData.getUint32(),d=N._readString(),c=wa.getVertexDeclaration(d,!1),_=c.vertexStride,f=d.split(","),g=f.length;switch(N._version){case"LAYAMODEL:05":o=n.slice(h,h+u*_),s=new Float32Array(o),l=new Uint8Array(o);break;case"LAYAMODEL:COMPRESSION_05":o=new ArrayBuffer(_*u),s=new Float32Array(o),l=new Uint8Array(o);var y=N._readData.pos;N._readData.pos=h;for(var v=0;v<u;v++)for(var p,m=v*_,w=0;w<g;w++)switch(f[w]){case"POSITION":s[p=m/4]=fo.convertToNumber(N._readData.getUint16()),s[p+1]=fo.convertToNumber(N._readData.getUint16()),s[p+2]=fo.convertToNumber(N._readData.getUint16()),m+=12;break;case"NORMAL":s[p=m/4]=N._readData.getUint8()/127.5-1,s[p+1]=N._readData.getUint8()/127.5-1,s[p+2]=N._readData.getUint8()/127.5-1,m+=12;break;case"COLOR":s[p=m/4]=N._readData.getUint8()/255,s[p+1]=N._readData.getUint8()/255,s[p+2]=N._readData.getUint8()/255,s[p+3]=N._readData.getUint8()/255,m+=16;break;case"UV":case"UV1":s[p=m/4]=fo.convertToNumber(N._readData.getUint16()),s[p+1]=fo.convertToNumber(N._readData.getUint16()),m+=8;break;case"BLENDWEIGHT":s[p=m/4]=N._readData.getUint8()/255,s[p+1]=N._readData.getUint8()/255,s[p+2]=N._readData.getUint8()/255,s[p+3]=N._readData.getUint8()/255,m+=16;break;case"BLENDINDICES":l[m]=N._readData.getUint8(),l[m+1]=N._readData.getUint8(),l[m+2]=N._readData.getUint8(),l[m+3]=N._readData.getUint8(),m+=4;break;case"TANGENT":s[p=m/4]=N._readData.getUint8()/127.5-1,s[p+1]=N._readData.getUint8()/127.5-1,s[p+2]=N._readData.getUint8()/127.5-1,s[p+3]=N._readData.getUint8()/127.5-1,m+=16}N._readData.pos=y}d=new Na(o.byteLength,e.STATIC_DRAW,!0);d.vertexDeclaration=c,d.setData(o),N._mesh._vertexBuffer=d,N._mesh._vertexCount+=d._byteLength/c.vertexStride,t+=4*s.length}var x=a+N._readData.getUint32(),k=N._readData.getUint32(),x=new Uint16Array(n.slice(x,x+k)),k=new Xa(Xa.INDEXTYPE_USHORT,k/2,e.STATIC_DRAW,!0);k.setData(x),N._mesh._indexBuffer=k,N._mesh._setBuffer(N._mesh._vertexBuffer,k),t+=2*k.indexCount,N._mesh._setCPUMemory(t),N._mesh._setGPUMemory(t);var T=N._mesh._boneNames=[],E=N._readData.getUint16();for(T.length=E,r=0;r<E;r++)T[r]=N._strings[N._readData.getUint16()];var x=N._readData.getUint32(),k=N._readData.getUint32(),M=new Float32Array(n.slice(a+x,a+x+k)),b=M.length,S=N._mesh._inverseBindPosesBuffer=new ArrayBuffer(4*b);for(N._mesh._inverseBindPoses=[],r=0;r<b;r+=16){var I=new ki(M[r+0],M[r+1],M[r+2],M[r+3],M[r+4],M[r+5],M[r+6],M[r+7],M[r+8],M[r+9],M[r+10],M[r+11],M[r+12],M[r+13],M[r+14],M[r+15],new Float32Array(S,4*r,16));N._mesh._inverseBindPoses[r/16]=I}return!0}},{key:"READ_SUBMESH",value:function(){var e=N._readData.__getBuffer(),t=new co(N._mesh);N._readData.getInt16();var n=N._readData.getUint32(),i=N._readData.getUint32(),a=N._mesh._indexBuffer;t._indexBuffer=a,t._setIndexRange(n,i);i=N._mesh._vertexBuffer;t._vertexBuffer=i;var r=N._DATA.offset,o=t._subIndexBufferStart,s=t._subIndexBufferCount,l=t._boneIndicesList,h=N._readData.getUint16();o.length=h,s.length=h,l.length=h;for(var u=N._mesh._skinDataPathMarks,d=N._bindPoseIndices,c=N._subMeshes.length,_=0;_<h;_++){o[_]=N._readData.getUint32(),s[_]=N._readData.getUint32();for(var f=N._readData.getUint32(),g=N._readData.getUint32(),y=l[_]=new Uint16Array(e.slice(r+f,r+f+g)),v=0,p=y.length;v<p;v++){var m=y[v],w=d.indexOf(m);-1===w?(y[v]=d.length,d.push(m),u.push([c,_,v])):y[v]=w}}return N._subMeshes.push(t),!0}}]),N}();go._BLOCK={count:0},go._DATA={offset:0,size:0},go._strings=[],go._bindPoseIndices=[];var yo=function(){function e(){S(this,e)}return C(e,null,[{key:"read",value:function(e,t,n){var i=new nn(e);i.pos=0;var a=i.readUTFString();switch(a){case"LAYAMODEL:0301":case"LAYAMODEL:0400":case"LAYAMODEL:0401":_o.parse(i,a,t,n);break;case"LAYAMODEL:05":case"LAYAMODEL:COMPRESSION_05":go.parse(i,a,t,n);break;default:throw new Error("MeshReader: unknown mesh version.")}t._setSubMeshes(n)}}]),e}(),vo=function(){T(p,V);var n=b(p);function p(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return S(this,p),(e=n.call(this))._tempVector30=new vn,e._tempVector31=new vn,e._tempVector32=new vn,e._minVerticesUpdate=-1,e._maxVerticesUpdate=-1,e._needUpdateBounds=!0,e._bounds=new _r(new vn,new vn),e._bufferState=new Ga,e._instanceBufferState=new Ga,e._vertexBuffer=null,e._indexBuffer=null,e._vertexCount=0,e._isReadable=t,e._subMeshes=[],e._skinDataPathMarks=[],e}return C(p,[{key:"_getPositionElement",value:function(e){for(var t=e.vertexDeclaration._vertexElements,n=0,i=t.length;n<i;n++){var a=t[n];if(a._elementFormat===ya.Vector3&&a._elementUsage===wa.MESH_POSITION0)return a}return null}},{key:"_getVerticeElementData",value:function(e,t){e.length=this._vertexCount;var n=this._vertexBuffer.vertexDeclaration,i=n.getVertexElementByUsage(t);if(i){var a=this._vertexBuffer.getUint8Data(),r=this._vertexBuffer.getFloat32Data(),o=n.vertexStride,s=o/4,l=i._offset,h=l/4;switch(t){case wa.MESH_TEXTURECOORDINATE0:case wa.MESH_TEXTURECOORDINATE1:for(var u=0;u<this._vertexCount;u++){var d=s*u+h;e[u]=new gn(r[d],r[d+1])}break;case wa.MESH_POSITION0:case wa.MESH_NORMAL0:for(u=0;u<this._vertexCount;u++){d=s*u+h;e[u]=new vn(r[d],r[d+1],r[d+2])}break;case wa.MESH_TANGENT0:case wa.MESH_BLENDWEIGHT0:for(u=0;u<this._vertexCount;u++){d=s*u+h;e[u]=new yn(r[d],r[d+1],r[d+2],r[d+3])}break;case wa.MESH_COLOR0:for(u=0;u<this._vertexCount;u++){d=s*u+h;e[u]=new Ta(r[d],r[d+1],r[d+2],r[d+3])}break;case wa.MESH_BLENDINDICES0:for(u=0;u<this._vertexCount;u++){d=o*u+l;e[u]=new yn(a[d],a[d+1],a[d+2],a[d+3])}break;default:throw"Mesh:Unknown elementUsage."}}}},{key:"_setVerticeElementData",value:function(e,t){var n=this._vertexBuffer.vertexDeclaration,i=n.getVertexElementByUsage(t);if(i){var a=this._vertexBuffer.getUint8Data(),r=this._vertexBuffer.getFloat32Data(),o=n.vertexStride,s=o/4,l=i._offset,h=l/4;switch(t){case wa.MESH_TEXTURECOORDINATE0:case wa.MESH_TEXTURECOORDINATE1:for(var u=0,d=e.length;u<d;u++){var c=s*u+h,_=e[u];r[c]=_.x,r[c+1]=_.y}break;case wa.MESH_POSITION0:case wa.MESH_NORMAL0:for(u=0,d=e.length;u<d;u++){var c=s*u+h,f=e[u];r[c]=f.x,r[c+1]=f.y,r[c+2]=f.z}break;case wa.MESH_TANGENT0:case wa.MESH_BLENDWEIGHT0:for(u=0,d=e.length;u<d;u++){var c=s*u+h,g=e[u];r[c]=g.x,r[c+1]=g.y,r[c+2]=g.z,r[c+3]=g.w}break;case wa.MESH_COLOR0:for(u=0,d=e.length;u<d;u++){var c=s*u+h,y=e[u];r[c]=y.r,r[c+1]=y.g,r[c+2]=y.b,r[c+2]=y.a}break;case wa.MESH_BLENDINDICES0:for(u=0,d=e.length;u<d;u++){c=o*u+l,g=e[u];a[c]=g.x,a[c+1]=g.y,a[c+2]=g.z,a[c+3]=g.w}break;default:throw"Mesh:Unknown elementUsage."}this._minVerticesUpdate=0,this._maxVerticesUpdate=Number.MAX_SAFE_INTEGER}else console.warn("Mesh: the mesh don't have  this VertexElement.")}},{key:"_disposeResource",value:function(){for(var e=0,t=this._subMeshes.length;e<t;e++)this._subMeshes[e].destroy();this._nativeTriangleMesh&&window.Physics3D.destroy(this._nativeTriangleMesh),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._setCPUMemory(0),this._setGPUMemory(0),this._bufferState.destroy(),this._instanceBufferState.destroy(),this._bufferState=null,this._instanceBufferState=null,this._vertexBuffer=null,this._indexBuffer=null,this._subMeshes=null,this._nativeTriangleMesh=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null}},{key:"_setSubMeshes",value:function(e){for(var t=0,n=(this._subMeshes=e).length;t<n;t++)e[t]._indexInMesh=t;this.calculateBounds()}},{key:"_setBuffer",value:function(e,t){var n=this._bufferState;n.bind(),n.applyVertexBuffer(e),n.applyIndexBuffer(t),n.unBind();n=this._instanceBufferState;n.bind(),n.applyVertexBuffer(e),n.applyInstanceVertexBuffer(Ra.instance.instanceWorldMatrixBuffer),n.applyInstanceVertexBuffer(Ra.instance.instanceMVPMatrixBuffer),n.applyIndexBuffer(t),n.unBind()}},{key:"_getPhysicMesh",value:function(){if(!this._nativeTriangleMesh){for(var e=new window.Physics3D.btTriangleMesh,t=p._nativeTempVector30,n=p._nativeTempVector31,i=p._nativeTempVector32,a=this._tempVector30,r=this._tempVector31,o=this._tempVector32,s=this._vertexBuffer,l=this._getPositionElement(s),h=s.getFloat32Data(),u=s.vertexDeclaration.vertexStride/4,d=l._offset/4,c=this._indexBuffer.getData(),_=0,f=c.length;_<f;_+=3){var g=c[_]*u+d,y=c[_+1]*u+d,v=c[_+2]*u+d;a.setValue(h[g],h[1+g],h[2+g]),r.setValue(h[y],h[1+y],h[2+y]),o.setValue(h[v],h[1+v],h[2+v]),ia._convertToBulletVec3(a,t,!0),ia._convertToBulletVec3(r,n,!0),ia._convertToBulletVec3(o,i,!0),e.addTriangle(t,n,i,!0)}this._nativeTriangleMesh=e}return this._nativeTriangleMesh}},{key:"_uploadVerticesData",value:function(){var e,t=this._minVerticesUpdate,n=this._maxVerticesUpdate;-1!==t&&-1!==n&&(e=t,this._vertexBuffer.setData(this._vertexBuffer.getUint8Data().buffer,e,e,n-t),this._minVerticesUpdate=-1,this._maxVerticesUpdate=-1)}},{key:"getSubMesh",value:function(e){return this._subMeshes[e]}},{key:"getPositions",value:function(e){if(!this._isReadable)throw"Mesh:can't get positions on mesh,isReadable must be true.";this._getVerticeElementData(e,wa.MESH_POSITION0)}},{key:"setPositions",value:function(e){if(!this._isReadable)throw"Mesh:setPosition() need isReadable must be true or use setVertices().";this._setVerticeElementData(e,wa.MESH_POSITION0),this._needUpdateBounds=!0}},{key:"getColors",value:function(e){if(!this._isReadable)throw"Mesh:can't get colors on mesh,isReadable must be true.";this._getVerticeElementData(e,wa.MESH_COLOR0)}},{key:"setColors",value:function(e){if(!this._isReadable)throw"Mesh:setColors() need isReadable must be true or use setVertices().";this._setVerticeElementData(e,wa.MESH_COLOR0)}},{key:"getUVs",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!this._isReadable)throw"Mesh:can't get uvs on mesh,isReadable must be true.";switch(t){case 0:this._getVerticeElementData(e,wa.MESH_TEXTURECOORDINATE0);break;case 1:this._getVerticeElementData(e,wa.MESH_TEXTURECOORDINATE1);break;default:throw"Mesh:Invalid channel."}}},{key:"setUVs",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!this._isReadable)throw"Mesh:setUVs() need isReadable must be true or use setVertices().";switch(t){case 0:this._setVerticeElementData(e,wa.MESH_TEXTURECOORDINATE0);break;case 1:this._setVerticeElementData(e,wa.MESH_TEXTURECOORDINATE1);break;default:throw"Mesh:Invalid channel."}}},{key:"getNormals",value:function(e){if(!this._isReadable)throw"Mesh:can't get colors on mesh,isReadable must be true.";this._getVerticeElementData(e,wa.MESH_NORMAL0)}},{key:"setNormals",value:function(e){if(!this._isReadable)throw"Mesh:setNormals() need must be true or use setVertices().";this._setVerticeElementData(e,wa.MESH_NORMAL0)}},{key:"getTangents",value:function(e){if(!this._isReadable)throw"Mesh:can't get colors on mesh,isReadable must be true.";this._getVerticeElementData(e,wa.MESH_TANGENT0)}},{key:"setTangents",value:function(e){if(!this._isReadable)throw"Mesh:setTangents() need isReadable must be true or use setVertices().";this._setVerticeElementData(e,wa.MESH_TANGENT0)}},{key:"getBoneWeights",value:function(e){if(!this._isReadable)throw"Mesh:can't get boneWeights on mesh,isReadable must be true.";this._getVerticeElementData(e,wa.MESH_BLENDWEIGHT0)}},{key:"setBoneWeights",value:function(e){if(!this._isReadable)throw"Mesh:setBoneWeights() need isReadable must be true or use setVertices().";this._setVerticeElementData(e,wa.MESH_BLENDWEIGHT0)}},{key:"getBoneIndices",value:function(e){if(!this._isReadable)throw"Mesh:can't get boneIndices on mesh,isReadable must be true.";this._getVerticeElementData(e,wa.MESH_BLENDINDICES0)}},{key:"setBoneIndices",value:function(e){if(!this._isReadable)throw"Mesh:setBoneIndices() need isReadable must be true or use setVertices().";this._setVerticeElementData(e,wa.MESH_BLENDINDICES0)}},{key:"markAsUnreadbale",value:function(){this._uploadVerticesData(),this._vertexBuffer.markAsUnreadbale(),this._isReadable=!1}},{key:"getVertexDeclaration",value:function(){return this._vertexBuffer._vertexDeclaration}},{key:"getVertices",value:function(){if(this._isReadable)return this._vertexBuffer.getUint8Data().buffer.slice(0);throw"Mesh:can't get vertices on mesh,isReadable must be true."}},{key:"setVertices",value:function(e){this._vertexBuffer.setData(e),this._needUpdateBounds=!0}},{key:"getIndices",value:function(){if(this._isReadable)return this._indexBuffer.getData().slice();throw"Mesh:can't get indices on subMesh,mesh's isReadable must be true."}},{key:"setIndices",value:function(e){this._indexBuffer.setData(e)}},{key:"calculateBounds",value:function(){if(!this._isReadable)throw"Mesh:can't calculate bounds on subMesh,mesh's isReadable must be true.";if(this._needUpdateBounds){var e=this._tempVector30,t=this._tempVector31;e.x=e.y=e.z=Number.MAX_VALUE,t.x=t.y=t.z=-Number.MAX_VALUE;for(var n=this._vertexBuffer,i=this._getPositionElement(n),a=n.getFloat32Data(),r=n.vertexDeclaration.vertexStride/4,o=i._offset/4,s=0,l=a.length;s<l;s+=r){var h=s+o,u=a[h],d=a[h+1],h=a[h+2];e.x=Math.min(e.x,u),e.y=Math.min(e.y,d),e.z=Math.min(e.z,h),t.x=Math.max(t.x,u),t.y=Math.max(t.y,d),t.z=Math.max(t.z,h)}this._bounds.setMin(e),this._bounds.setMax(t),this._needUpdateBounds=!1}}},{key:"cloneTo",value:function(e){var t=e,n=this._vertexBuffer,e=new Na(n._byteLength,n.bufferUsage,n.canRead);e.vertexDeclaration=n.vertexDeclaration,e.setData(n.getUint8Data().slice().buffer),t._vertexBuffer=e,t._vertexCount=this._vertexCount;var e=this._indexBuffer,i=new Xa(Xa.INDEXTYPE_USHORT,e.indexCount,e.bufferUsage,e.canRead);i.setData(e.getData().slice()),t._indexBuffer=i,t._setBuffer(t._vertexBuffer,i),t._setCPUMemory(this.cpuMemory),t._setGPUMemory(this.gpuMemory);for(var a=this._boneNames,r=t._boneNames=[],o=0;o<a.length;o++)r[o]=a[o];var s=this._inverseBindPoses,l=t._inverseBindPoses=[];for(o=0;o<s.length;o++)l[o]=s[o];for(t._bindPoseIndices=new Uint16Array(this._bindPoseIndices),o=0;o<this._skinDataPathMarks.length;o++)t._skinDataPathMarks[o]=this._skinDataPathMarks[o].slice();for(o=0;o<this.subMeshCount;o++){var h=this._subMeshes[o],u=h._subIndexBufferStart,d=h._subIndexBufferCount,c=h._boneIndicesList,_=new co(t);_._subIndexBufferStart.length=u.length,_._subIndexBufferCount.length=d.length,_._boneIndicesList.length=c.length;for(var f=0;f<u.length;f++)_._subIndexBufferStart[f]=u[f];for(f=0;f<d.length;f++)_._subIndexBufferCount[f]=d[f];for(f=0;f<c.length;f++)_._boneIndicesList[f]=new Uint16Array(c[f]);_._indexBuffer=i,_._indexStart=h._indexStart,_._indexCount=h._indexCount,_._indices=new Uint16Array(i.getData().buffer,2*h._indexStart,h._indexCount);h=t._vertexBuffer;_._vertexBuffer=h,t._subMeshes.push(_)}t._setSubMeshes(t._subMeshes)}},{key:"clone",value:function(){var e=new p;return this.cloneTo(e),e}},{key:"inverseAbsoluteBindPoses",get:function(){return this._inverseBindPoses}},{key:"vertexCount",get:function(){return this._vertexCount}},{key:"indexCount",get:function(){return this._indexBuffer.indexCount}},{key:"subMeshCount",get:function(){return this._subMeshes.length}},{key:"bounds",get:function(){return this._bounds},set:function(e){this._bounds!==e&&e.cloneTo(this._bounds)}}],[{key:"__init__",value:function(){var e=Rr._physics3D;e&&(p._nativeTempVector30=new e.btVector3(0,0,0),p._nativeTempVector31=new e.btVector3(0,0,0),p._nativeTempVector32=new e.btVector3(0,0,0))}},{key:"_parse",value:function(e){var t=new p;return yo.read(e,t,t._subMeshes),t}},{key:"load",value:function(e,t){M.loader.create(e,t,null,p.MESH)}}]),p}();vo.MESH="MESH";var po=function(){function R(){S(this,R)}return C(R,null,[{key:"__init__",value:function(){}},{key:"_createMesh",value:function(e,t,n){var i=P.instance,a=new vo,r=new co(a),o=new Na(4*t.length,i.STATIC_DRAW,!0);o.vertexDeclaration=e,o.setData(t.buffer),a._vertexBuffer=o,a._vertexCount=o._byteLength/e.vertexStride;t=new Xa(Xa.INDEXTYPE_USHORT,n.length,i.STATIC_DRAW,!0);t.setData(n),a._indexBuffer=t,a._setBuffer(o,t),r._vertexBuffer=o,r._indexBuffer=t,r._setIndexRange(0,t.indexCount);e=r._subIndexBufferStart,i=r._subIndexBufferCount,n=r._boneIndicesList;e.length=1,i.length=1,n.length=1,i[e[0]=0]=t.indexCount;e=[];e.push(r),a._setSubMeshes(e);t=o._byteLength+t._byteLength;return a._setCPUMemory(t),a._setGPUMemory(t),a}},{key:"createBox",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=wa.getVertexDeclaration("POSITION,NORMAL,UV"),e=e/2,t=t/2,n=n/2,t=new Float32Array([-e,t,-n,0,1,0,0,0,e,t,-n,0,1,0,1,0,e,t,n,0,1,0,1,1,-e,t,n,0,1,0,0,1,-e,-t,-n,0,-1,0,0,1,e,-t,-n,0,-1,0,1,1,e,-t,n,0,-1,0,1,0,-e,-t,n,0,-1,0,0,0,-e,t,-n,-1,0,0,0,0,-e,t,n,-1,0,0,1,0,-e,-t,n,-1,0,0,1,1,-e,-t,-n,-1,0,0,0,1,e,t,-n,1,0,0,1,0,e,t,n,1,0,0,0,0,e,-t,n,1,0,0,0,1,e,-t,-n,1,0,0,1,1,-e,t,n,0,0,1,0,0,e,t,n,0,0,1,1,0,e,-t,n,0,0,1,1,1,-e,-t,n,0,0,1,0,1,-e,t,-n,0,0,-1,1,0,e,t,-n,0,0,-1,0,0,e,-t,-n,0,0,-1,0,1,-e,-t,-n,0,0,-1,1,1]),n=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);return R._createMesh(i,t,n)}},{key:"createCapsule",value:function(){for(var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:16,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:32,r=(i+1)*(a+1)*2+2*(a+1),o=3*i*(a+1)*2*2+2*a*3,s=wa.getVertexDeclaration("POSITION,NORMAL,UV"),l=s.vertexStride/4,h=new Float32Array(r*l),u=new Uint16Array(o),d=Math.PI/2/i,c=2*Math.PI/a,_=n/2-t,f=0,g=0,y=0,v=0,p=0,m=0,w=0;w<=i;w++)for(e=0;e<=a;e++)f=t*Math.cos(w*d)*Math.cos(e*c+Math.PI),g=t*Math.sin(w*d),y=t*Math.cos(w*d)*Math.sin(e*c+Math.PI),h[v++]=f,h[v++]=g+_,h[v++]=y,h[v++]=f,h[v++]=g,h[v++]=y,h[v++]=1-e/a,h[v++]=(1-w/i)*(Math.PI*t/2/(n+Math.PI*t)),w<i&&(u[p++]=w*(a+1)+e+(a+1),u[p++]=w*(a+1)+e,u[p++]=w*(a+1)+e+1,u[p++]=w*(a+1)+e+a,u[p++]=w*(a+1)+e,u[p++]=w*(a+1)+e+(a+1));for(m+=(i+1)*(a+1),w=0;w<=i;w++)for(e=0;e<=a;e++)f=t*Math.cos(w*d)*Math.cos(e*c+Math.PI),g=t*Math.sin(-w*d),y=t*Math.cos(w*d)*Math.sin(e*c+Math.PI),h[v++]=f,h[v++]=g-_,h[v++]=y,h[v++]=f,h[v++]=g,h[v++]=y,h[v++]=1-e/a,h[v++]=(w/i*(Math.PI*t/2)+(n+Math.PI*t/2))/(n+Math.PI*t),w<i&&(u[p++]=m+w*(a+1)+e,u[p++]=m+w*(a+1)+e+(a+1),u[p++]=m+w*(a+1)+e+1,u[p++]=m+w*(a+1)+e,u[p++]=m+w*(a+1)+e+a,u[p++]=m+w*(a+1)+e+(a+1));for(m+=(i+1)*(a+1),e=0;e<=a;e++)f=t*Math.cos(e*c+Math.PI),g=_,y=t*Math.sin(e*c+Math.PI),h[v++]=f,h[v+8*(a+1)-1]=f,h[v++]=g,h[v+8*(a+1)-1]=-g,h[v++]=y,h[v+8*(a+1)-1]=y,h[v++]=f,h[v+8*(a+1)-1]=f,h[v++]=0,h[v+8*(a+1)-1]=0,h[v++]=y,h[v+8*(a+1)-1]=y,h[v++]=1-+e/a,h[v+8*(a+1)-1]=1-+e/a,h[v++]=Math.PI*t/2/(n+Math.PI*t),h[v+8*(a+1)-1]=(Math.PI*t/2+n)/(n+Math.PI*t);for(e=0;e<a;e++)u[p++]=e+m+(a+1),u[p++]=e+m+1,u[p++]=e+m,u[p++]=e+m+(a+1),u[p++]=e+m+(a+1)+1,u[p++]=e+m+1;return m+=2*(a+1),R._createMesh(s,h,u)}},{key:"createCone",value:function(){for(var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:32,a=i+1+1+2*(i+1),r=6*i+3*i,o=wa.getVertexDeclaration("POSITION,NORMAL,UV"),s=o.vertexStride/4,l=new Float32Array(a*s),h=new Uint16Array(r),u=2*Math.PI/i,d=n/2,c=0,_=0,f=0,g=0,y=0,v=new vn,p=new vn(0,-1,0),m=new vn(0,d,0),w=new vn,x=new vn,k=new xi,T=new vn,E=0,M=0,b=0;b<=i;b++)c=b*u,f=Math.cos(c+Math.PI)*t,g=d,y=Math.sin(c+Math.PI)*t,l[E++]=0,l[E+8*(i+1)-1]=f,l[E++]=g,l[E+8*(i+1)-1]=-g,l[E++]=0,l[E+8*(i+1)-1]=y,v.x=f,v.y=0,v.z=y,w.x=f,w.y=-g,w.z=y,vn.subtract(w,m,x),vn.normalize(x,x),e=Math.acos(vn.dot(p,x)),vn.cross(p,x,T),vn.normalize(T,T),xi.createFromAxisAngle(T,e,k),vn.normalize(v,v),vn.transformQuat(v,k,v),vn.normalize(v,v),l[E++]=v.x,l[E+8*(i+1)-1]=v.x,l[E++]=v.y,l[E+8*(i+1)-1]=v.y,l[E++]=v.z,l[E+8*(i+1)-1]=v.z,l[E++]=1-+b/i,l[E+8*(i+1)-1]=1-+b/i,l[E++]=0,l[E+8*(i+1)-1]=1;E+=8*(i+1);for(var S=0;S<i;S++)h[M++]=S+_+(i+1),h[M++]=S+_+1,h[M++]=S+_,h[M++]=S+_+(i+1),h[M++]=S+_+(i+1)+1,h[M++]=S+_+1;_+=2*(i+1);for(var I=0;I<=i;I++)0===I&&(l[E++]=0,l[E++]=-d,l[E++]=0,l[E++]=0,l[E++]=-1,l[E++]=0,l[E++]=.5,l[E++]=.5),c=I*u,f=Math.cos(c+Math.PI)*t,g=-d,y=Math.sin(c+Math.PI)*t,l[E++]=f,l[E++]=g,l[E++]=y,l[E++]=0,l[E++]=-1,l[E++]=0,l[E++]=.5+.5*Math.cos(c),l[E++]=.5+.5*Math.sin(c);for(var N=0;N<i;N++)h[M++]=0+_,h[M++]=N+2+_,h[M++]=N+1+_;return _+=i+1+1,R._createMesh(o,l,h)}},{key:"createCylinder",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:32,i=n+1+1+2*(n+1)+(n+1+1),a=3*n+6*n+3*n,r=wa.getVertexDeclaration("POSITION,NORMAL,UV"),o=r.vertexStride/4,s=new Float32Array(i*o),l=new Uint16Array(a),h=2*Math.PI/n,u=t/2,d=0,c=0,_=0,f=0,g=0,y=0,v=0,p=0;p<=n;p++)0===p&&(s[y++]=0,s[y++]=u,s[y++]=0,s[y++]=0,s[y++]=1,s[y++]=0,s[y++]=.5,s[y++]=.5),d=p*h,_=Math.cos(d)*e,f=u,g=Math.sin(d)*e,s[y++]=_,s[y++]=f,s[y++]=g,s[y++]=0,s[y++]=1,s[y++]=0,s[y++]=.5+.5*Math.cos(d),s[y++]=.5+.5*Math.sin(d);for(var m=0;m<n;m++)l[v++]=0,l[v++]=m+1,l[v++]=m+2;c+=n+1+1;for(var w=0;w<=n;w++)d=w*h,_=Math.cos(d+Math.PI)*e,f=u,g=Math.sin(d+Math.PI)*e,s[y++]=_,s[y+8*(n+1)-1]=_,s[y++]=f,s[y+8*(n+1)-1]=-f,s[y++]=g,s[y+8*(n+1)-1]=g,s[y++]=_,s[y+8*(n+1)-1]=_,s[y++]=0,s[y+8*(n+1)-1]=0,s[y++]=g,s[y+8*(n+1)-1]=g,s[y++]=1-+w/n,s[y+8*(n+1)-1]=1-+w/n,s[y++]=0,s[y+8*(n+1)-1]=1;y+=8*(n+1);for(var x=0;x<n;x++)l[v++]=x+c+(n+1),l[v++]=x+c+1,l[v++]=x+c,l[v++]=x+c+(n+1),l[v++]=x+c+(n+1)+1,l[v++]=x+c+1;c+=2*(n+1);for(var k=0;k<=n;k++)0===k&&(s[y++]=0,s[y++]=-u,s[y++]=0,s[y++]=0,s[y++]=-1,s[y++]=0,s[y++]=.5,s[y++]=.5),d=k*h,_=Math.cos(d+Math.PI)*e,f=-u,g=Math.sin(d+Math.PI)*e,s[y++]=_,s[y++]=f,s[y++]=g,s[y++]=0,s[y++]=-1,s[y++]=0,s[y++]=.5+.5*Math.cos(d),s[y++]=.5+.5*Math.sin(d);for(var T=0;T<n;T++)l[v++]=0+c,l[v++]=T+2+c,l[v++]=T+1+c;return c+=n+1+1,R._createMesh(r,s,l)}},{key:"createPlane",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:10,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:10,a=(n+1)*(i+1),r=new Uint16Array(n*i*2*3),o=wa.getVertexDeclaration("POSITION,NORMAL,UV"),s=o.vertexStride/4,l=new Float32Array(a*s),h=e/2,u=t/2,d=e/n,c=t/i,_=0,f=0;f<=i;f++)for(var g=0;g<=n;g++)l[_++]=g*d-h,l[_++]=0,l[_++]=f*c-u,l[_++]=0,l[_++]=1,l[_++]=0,l[_++]=+g/n,l[_++]=+f/i;for(var y=0,f=0;f<i;f++)for(g=0;g<n;g++)r[y++]=(f+1)*(n+1)+g,r[y++]=f*(n+1)+g,r[y++]=(f+1)*(n+1)+g+1,r[y++]=f*(n+1)+g,r[y++]=f*(n+1)+g+1,r[y++]=(f+1)*(n+1)+g+1;return R._createMesh(o,l,r)}},{key:"createQuad",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=wa.getVertexDeclaration("POSITION,NORMAL,UV"),e=(n.vertexStride,e/2),t=t/2,e=new Float32Array([e,t,0,0,0,1,0,0,e,t,0,0,0,1,1,0,-e,-t,0,0,0,1,0,1,e,-t,0,0,0,1,1,1]),t=new Uint16Array([0,1,2,3,2,1]);return R._createMesh(n,e,t)}},{key:"createSphere",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:32,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:32,i=(t+1)*(n+1),a=3*t*(n+1)*2,r=new Uint16Array(a),o=wa.getVertexDeclaration("POSITION,NORMAL,UV"),s=o.vertexStride/4,l=new Float32Array(i*s),h=Math.PI/t,u=2*Math.PI/n,d=0,i=0,a=0,c=0;c<t+1;c++)for(var _=Math.sin(c*h),f=Math.cos(c*h),g=0;g<n+1;g++){var y=_*Math.sin(g*u+ +Math.PI/2),v=_*Math.cos(g*u+ +Math.PI/2);l[i+0]=y*e,l[i+1]=f*e,l[i+2]=v*e,l[i+3]=y,l[i+4]=f,l[i+5]=v,l[i+6]=g/n,l[i+7]=c/t,i+=s,c!=t-1&&(r[a++]=d+(n+1),r[a++]=d,r[a++]=d+1,r[a++]=d+n,r[a++]=d,r[a++]=d+(n+1),d++)}return R._createMesh(o,l,r)}}]),R}(),mo=function(){T(i,pr);var t=b(i);function i(){var e;return S(this,i),(e=t.call(this,po.createPlane(1,1)))._width=1,e._startPoint=new vn,e._endPoint=new vn,e._temp0Vector3=new vn,e._temp1Vector3=new vn,e._temp2Vector3=new vn,e._temp3Vector3=new vn,e._delta=0,e._interval=50,e._render=new lo(u(e)),e}return C(i,[{key:"_parse",value:function(e,t){G(z(i.prototype),"_parse",this).call(this,e,t),this._width=e.widthMultiplier}},{key:"_cloneTo",value:function(e,t,n){e._width=this._width,G(z(i.prototype),"_cloneTo",this).call(this,e,t,n)}},{key:"setStartPoint",value:function(e){1e-6<vn.distanceSquared(e,this._startPoint)&&(e.cloneTo(this._startPoint),this._delta=this._interval)}},{key:"setEndPoint",value:function(e){1e-6<vn.distanceSquared(e,this._endPoint)&&(e.cloneTo(this._endPoint),this._delta=this._interval)}},{key:"setFollow",value:function(e,t){this._target1=e,this._target2=t}},{key:"_updateShape",value:function(e){this._delta+=zn.timer.delta,this._delta>=this._interval&&(this._delta-=this._interval,(s=this._render.material).tilingOffsetW+=.25,1<=s.tilingOffsetW&&(s.tilingOffsetW=0)),this._target1&&this._target2&&(this._startPoint=this._target1.position,this._endPoint=this._target2.position);var t=this.transform.worldMatrix.elements,n=this._temp0Vector3,i=this._temp1Vector3,a=this._temp2Vector3,r=this._temp3Vector3;vn.subtract(this._endPoint,this._startPoint,i);var o=vn.scalarLength(i);if(o<1e-6){var s=this._temp1Vector3;vn.lerp(this._startPoint,this._endPoint,.5,s),this.transform.position=s;s=this._temp2Vector3;return s.x=0,s.y=this._width,s.z=1,void(this.transform.scale=s)}n.x=i.x/o,n.y=i.y/o,n.z=i.z/o,e?(e.transform.getForward(a),a.x=-a.x,a.y=-a.y,a.z=-a.z,vn.cross(n,a,r)):vn.cross(n,vn._ForwardRH,r),vn.normalize(r,r),vn.cross(r,n,a),t[12]=.5*(this._startPoint.x+this._endPoint.x),t[13]=.5*(this._startPoint.y+this._endPoint.y),t[14]=.5*(this._startPoint.z+this._endPoint.z),t[15]=1,t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=0,t[4]=a.x,t[5]=a.y,t[6]=a.z,t[7]=0,t[8]=r.x*this._width,t[9]=r.y*this._width,t[10]=r.z*this._width,t[11]=0}},{key:"_create",value:function(){return new i}},{key:"width",get:function(){return this._width},set:function(e){this._width=e,this._delta=this._interval}},{key:"interval",get:function(){return this._interval},set:function(e){this._interval=e}}]),i}(),wo=function(){T(t,g);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,null,[{key:"getItemWithType",value:function(e,t){if(e&&t){var n=this.getItem(e);if(!n)if(t.toString()==pi.toString())n=new pi(e);else if(t.toString()==oo.toString())(n=new oo).source=e;else if(t.toString()==ea.toString())(n=new ea(zn.loader.getRes(e))).source=e;else if(t.toString()==ta.toString())n=new ta(e);else if(t.toString()==fa.toString())(n=zn.loader.getRes(e))?n=n.clone():console.warn("please load file: "+e);else if(t.toString()==pr.toString())(n=zn.loader.getRes(e))?n=n.clone():console.warn("please load file: "+e);else if(t.toString()==mo.toString())(n=zn.loader.getRes(e))?n=n.clone():console.warn("please load file: "+e);else if(t.toString()==io.toString()){if(n=zn.loader.getRes(e))return n;console.warn("please load file: "+e)}else t.toString()==mr.toString()?(n=new mr).font=e:t.toString()==Bt.toString()&&((n=new Bt).skin=e);return n}console.warn("empty url or type")}},{key:"recycle",value:function(e,t,n,i){e&&(void 0===n&&(n=!0),i?zn.timer.once(i,this,this.doRecycle,[e,t,n],!1):this.doRecycle(e,t,n))}},{key:"doRecycle",value:function(e,t,n){e.destroyed||(e.removeSelf(),e.offAll(),n&&e._destroyAllComponent(),e instanceof fa?(e.transform.position=new vn(0,0,0),e.transform.rotation=new xi,this.recover(t,e)):e instanceof io?this.recover(t,e):e instanceof oo?(e.stop(),e.rotation=0,e.scale(1,1),e.pos(0,0),e.zOrder=0,e.visible=!0,this.recover(e._url||t,e)):e instanceof ea?(e.stop(),e.destroy()):e instanceof mr?(e.rotation=0,e.scale(1,1),e.pos(0,0),e.zOrder=0,e.visible=!0,e.alpha=1,this.recover(e.font||t,e)):(e.alpha=1,e.rotation=0,e.scale(1,1),e.pos(0,0),e.zOrder=0,e.visible=!0,this.recover(e.recycleKey||e.skin||t,e)))}}]),t}(),xo=function(){T(i,d);var t=b(i);function i(){var e;return S(this,i),(e=t.call(this))._completeHandler=new F(u(e),e.onOneLoadComplete),e.reset(),e}return C(i,[{key:"reset",value:function(){this._toLoadList=[],this._isLoading=!1,this.totalCount=0}},{key:"load",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(e instanceof Array)for(var i=e.length,a=0;a<i;a++)this._addToLoadList(e[a],t);else this._addToLoadList(e,t);n&&this._checkNext()}},{key:"_addToLoadList",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];0<=this._toLoadList.indexOf(e)||on.getRes(e)||(t?this._toLoadList.push({url:e}):this._toLoadList.push(e),this.totalCount++)}},{key:"_checkNext",value:function(){var e;this._isLoading||(0!=this._toLoadList.length?"string"==typeof(e=this._toLoadList.pop())?this.loadOne(e):this.loadOne(e.url,!0):this.event(Je.COMPLETE))}},{key:"loadOne",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this._curUrl=e;var n=ae.getFileExtension(this._curUrl);t?M.loader.create(e,this._completeHandler):i.LoadableExtensions[n]?M.loader.load(e,this._completeHandler,null,i.LoadableExtensions[n]):e!=sn.getFileLoadPath(e)||i.No3dLoadTypes[n]||!ln.createMap[n]?M.loader.load(e,this._completeHandler):M.loader.create(e,this._completeHandler)}},{key:"onOneLoadComplete",value:function(){this._isLoading=!1,on.getRes(this._curUrl)||console.log("Fail to load:",this._curUrl);var e,t=ae.getFileExtension(this._curUrl);!i.LoadableExtensions[t]||(e=(e=on.getRes(this._curUrl))&&e instanceof tn?e.json:e)&&(e.loadList&&this.load(e.loadList,!1,!1),e.loadList3D&&this.load(e.loadList3D,!0,!1)),"sk"==t&&this.load(this._curUrl.replace(".sk",".png"),!1,!1),this.event(Je.PROGRESS,this.getProgress()),this._checkNext()}},{key:"getProgress",value:function(){return this.loadedCount/this.totalCount}},{key:"leftCount",get:function(){return this._isLoading?this._toLoadList.length+1:this._toLoadList.length}},{key:"loadedCount",get:function(){return this.totalCount-this.leftCount}}]),i}();xo.LoadableExtensions={scene:on.JSON,scene3d:on.JSON,ani:on.JSON,ui:on.JSON,prefab:on.PREFAB},xo.No3dLoadTypes={png:!0,jpg:!0,txt:!0};var ko=function(){T(l,Bt);var n=b(l);function l(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return S(this,l),(e=n.call(this)).autoDestroyAtClosed=!1,e.url=null,e._viewCreated=!1,e._$componentType="Scene",e._setBit(It.NOT_READY,!0),l.unDestroyedScenes.push(u(e)),e._scene=u(e),t&&e.createChildren(),e}return C(l,[{key:"createChildren",value:function(){}},{key:"loadScene",value:function(e){var t=-1<e.indexOf(".")?e:e+".scene",e=M.loader.getRes(t);e?this.createView(e):(M.loader.resetProgress(),(e=new xo).on(Je.COMPLETE,this,this._onSceneLoaded,[t]),e.load(t))}},{key:"_onSceneLoaded",value:function(e){this.createView(M.Loader.getRes(e))}},{key:"createView",value:function(e){e&&!this._viewCreated&&(this._viewCreated=!0,bn.createByData(this,e))}},{key:"getNodeByID",value:function(e){return this._idMap?this._idMap[e]:null}},{key:"open",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e&&l.closeAll(),l.root.addChild(this),this.onOpened(t)}},{key:"onOpened",value:function(e){}},{key:"close",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.onClosed(e),this.autoDestroyAtClosed?this.destroy():this.removeSelf()}},{key:"onClosed",value:function(){}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._idMap=null,G(z(l.prototype),"destroy",this).call(this,e);for(var t=l.unDestroyedScenes,n=t.length-1;-1<n;n--)if(t[n]===this)return void t.splice(n,1)}},{key:"_sizeChanged",value:function(){this.event(Je.RESIZE)}},{key:"scaleX",set:function(e){G(z(l.prototype),"get_scaleX",this).call(this)!=e&&(G(z(l.prototype),"set_scaleX",this).call(this,e),this.event(Je.RESIZE))},get:function(){return G(z(l.prototype),"scaleX",this)}},{key:"scaleY",set:function(e){G(z(l.prototype),"get_scaleY",this).call(this)!=e&&(G(z(l.prototype),"set_scaleY",this).call(this,e),this.event(Je.RESIZE))},get:function(){return G(z(l.prototype),"scaleY",this)}},{key:"width",get:function(){if(this._width)return this._width;for(var e=0,t=this.numChildren-1;-1<t;t--){var n=this.getChildAt(t);n._visible&&(e=Math.max(n._x+n.width*n.scaleX,e))}return e},set:function(e){G(z(l.prototype),"get_width",this).call(this)!=e&&(G(z(l.prototype),"set_width",this).call(this,e),this.callLater(this._sizeChanged))}},{key:"height",get:function(){if(this._height)return this._height;for(var e=0,t=this.numChildren-1;-1<t;t--){var n=this.getChildAt(t);n._visible&&(e=Math.max(n._y+n.height*n.scaleY,e))}return e},set:function(e){G(z(l.prototype),"get_height",this).call(this)!=e&&(G(z(l.prototype),"set_height",this).call(this,e),this.callLater(this._sizeChanged))}},{key:"timer",get:function(){return this._timer||M.timer},set:function(e){this._timer=e}}],[{key:"setUIMap",value:function(e){var t,n=M.loader.getRes(e);if(!n)throw"请提前加载uimap的json，再使用该接口设置！";for(t in n)M.Loader.loadedMap[B.formatURL(t+".scene")]=n[t]}},{key:"load",value:function(a){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;M.loader.resetProgress();var o=new xo;function s(e){l._loadPage&&l._loadPage.event("progress",e),t&&t.runWith(e)}o.on(Je.PROGRESS,null,s),o.once(Je.COMPLETE,null,function(){o.off(Je.PROGRESS,null,s);var e=M.Loader.getRes(a);if(!e)throw"Can not find scene:"+a;if(!e.props)throw"Scene data is error:"+a;var t=e.props.runtime||e.type,n=M.ClassUtils.getClass(t);{var i;i="instance"==e.props.renderType?n.instance||(n.instance=new n):new n}{if(!(i&&i instanceof Ft))throw"Can not find scene:"+t;i.url=a,i._getBit(It.NOT_READY)?(i.on("onViewCreated",null,function(){r&&r.runWith(i)}),i.createView(e)):r&&r.runWith(i),l.hideLoadingPage()}}),o.load(a)}},{key:"open",value:function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;i instanceof F&&(t=a,a=i,i=t),l.showLoadingPage(),l.load(e,F.create(null,this._onSceneLoaded,[n,a,i]),r)}},{key:"_onSceneLoaded",value:function(e,t,n,i){i.open(e,n),t&&t.runWith(i)}},{key:"close",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=!1,i=l.unDestroyedScenes,a=0,r=i.length;a<r;a++){var o=i[a];o&&o.parent&&o.url===e&&o.name==t&&(o.close(),n=!0)}return n}},{key:"closeAll",value:function(){for(var e=l.root,t=0,n=e.numChildren;t<n;t++){var i=e.getChildAt(0);i instanceof l?i.close():i.removeSelf()}}},{key:"destroy",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=!1,i=l.unDestroyedScenes,a=0,r=i.length;a<r;a++){var o=i[a];o.url===e&&o.name==t&&(o.destroy(),n=!0)}return n}},{key:"gc",value:function(){V.destroyUnusedResources()}},{key:"setLoadingPage",value:function(e){l._loadPage!=e&&(l._loadPage=e)}},{key:"showLoadingPage",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;l._loadPage&&(M.systemTimer.clear(null,l._showLoading),M.systemTimer.clear(null,l._hideLoading),M.systemTimer.once(t,null,l._showLoading,[e],!1))}},{key:"_showLoading",value:function(e){M.stage.addChild(l._loadPage),l._loadPage.onOpened(e)}},{key:"_hideLoading",value:function(){l._loadPage.close()}},{key:"hideLoadingPage",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:500;l._loadPage&&(M.systemTimer.clear(null,l._showLoading),M.systemTimer.clear(null,l._hideLoading),M.systemTimer.once(e,null,l._hideLoading))}},{key:"root",get:function(){return l._root||(l._root=M.stage.addChild(new Bt),l._root.name="root",M.stage.on("resize",null,function(){l._root.size(M.stage.width,M.stage.height),l._root.event(Je.RESIZE)}),l._root.size(M.stage.width,M.stage.height),l._root.event(Je.RESIZE)),l._root}}]),l}();ko.unDestroyedScenes=[],M.regClass(ko),Dt.regClass("laya.display.Scene",ko),Dt.regClass("Laya.Scene",ko);var To=function(){T(t,vi);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"_onResize",value:function(e){this.graphics.clear(),this.graphics.drawRect(0,0,this.width,this.height,this._bgColor)}},{key:"dataSource",set:function(e){for(var t in this._dataSource=e){var n=this.getChildByName(t);n?n.dataSource=e[t]:t in this&&!(this[t]instanceof Function)&&(this[t]=e[t])}},get:function(){return G(z(t.prototype),"dataSource",this)}},{key:"bgColor",get:function(){return this._bgColor},set:function(e){(this._bgColor=e)?(this._onResize(null),this.on(Je.RESIZE,this,this._onResize)):(this.graphics.clear(),this.off(Je.RESIZE,this,this._onResize))}}]),t}();M.regClass(To),Dt.regClass("laya.ui.Box",To),Dt.regClass("Laya.Box",To);var Eo=function(){T(a,vi);var i=b(a);function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return S(this,a),(e=i.call(this))._labelColors=ci.buttonLabelColors,e._state=0,e._autoSize=!0,e._stateNum=ci.buttonStateNum,e._stateChanged=!1,e.skin=t,e.label=n,e}return C(a,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(a.prototype),"destroy",this).call(this,e),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(e),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null}},{key:"createChildren",value:function(){this.graphics=this._bitmap=new _i}},{key:"createText",value:function(){this._text||(this._text=new Ut,this._text.overflow=Ut.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)}},{key:"initialize",value:function(){1!==this._mouseState&&(this.mouseEnabled=!0,this._setBit(It.HAS_MOUSE,!0)),this._createListener(Je.MOUSE_OVER,this,this.onMouse,null,!1,!1),this._createListener(Je.MOUSE_OUT,this,this.onMouse,null,!1,!1),this._createListener(Je.MOUSE_DOWN,this,this.onMouse,null,!1,!1),this._createListener(Je.MOUSE_UP,this,this.onMouse,null,!1,!1),this._createListener(Je.CLICK,this,this.onMouse,null,!1,!1)}},{key:"onMouse",value:function(e){if(!1!==this.toggle||!this._selected)return e.type===Je.CLICK?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(this._selected||(this.state=a.stateMap[e.type]))}},{key:"_skinLoaded",value:function(){this.callLater(this.changeClips),this._setStateChanged(),this._sizeChanged(),this.event(Je.LOADED)}},{key:"changeClips",value:function(){var e=on.getRes(this._skin);if(e){var t=e.sourceWidth,n=e.sourceHeight/this._stateNum;e.$_GID||(e.$_GID=ae.getGID());var i=e.$_GID+"-"+this._stateNum,a=Mn.I.get(i);if(a=!ae.isOkTextureList(a)?null:a)this._sources=a;else{if(this._sources=[],1===this._stateNum)this._sources.push(e);else for(var r=0;r<this._stateNum;r++)this._sources.push($e.createFromTexture(e,0,n*r,t,n));Mn.I.set(i,this._sources)}this._autoSize?(this._bitmap.width=this._width||t,this._bitmap.height=this._height||n,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=t)}}},{key:"measureWidth",value:function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}},{key:"measureHeight",value:function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}},{key:"changeState",value:function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var e=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[e]),this.label&&(this._text.color=this._labelColors[e],this._strokeColors&&(this._text.strokeColor=this._strokeColors[e]))}},{key:"_setStateChanged",value:function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin!=e&&(!(this._skin=e)||on.getRes(e)?this._skinLoaded():M.loader.load(this._skin,F.create(this,this._skinLoaded),null,on.IMAGE,1))}},{key:"stateNum",get:function(){return this._stateNum},set:function(e){"string"==typeof e&&(e=parseInt(e)),this._stateNum!=e&&(this._stateNum=e<1?1:3<e?3:e,this.callLater(this.changeClips))}},{key:"label",get:function(){return this._text?this._text.text:null},set:function(e){(this._text||e)&&(this.createText(),this._text.text!=e&&(e&&!this._text.parent&&this.addChild(this._text),this._text.text=(e+"").replace(/\\n/g,"\n"),this._setStateChanged()))}},{key:"selected",get:function(){return this._selected},set:function(e){this._selected!=e&&(this._selected=e,this.state=this._selected?2:0,this.event(Je.CHANGE))}},{key:"state",get:function(){return this._state},set:function(e){this._state!=e&&(this._state=e,this._setStateChanged())}},{key:"labelColors",get:function(){return this._labelColors.join(",")},set:function(e){this._labelColors=yi.fillArray(ci.buttonLabelColors,e,String),this._setStateChanged()}},{key:"strokeColors",get:function(){return this._strokeColors?this._strokeColors.join(","):""},set:function(e){this._strokeColors=yi.fillArray(ci.buttonLabelColors,e,String),this._setStateChanged()}},{key:"labelPadding",get:function(){return this.createText(),this._text.padding.join(",")},set:function(e){this.createText(),this._text.padding=yi.fillArray(ci.labelPadding,e,Number)}},{key:"labelSize",get:function(){return this.createText(),this._text.fontSize},set:function(e){this.createText(),this._text.fontSize=e}},{key:"labelStroke",get:function(){return this.createText(),this._text.stroke},set:function(e){this.createText(),this._text.stroke=e}},{key:"labelStrokeColor",get:function(){return this.createText(),this._text.strokeColor},set:function(e){this.createText(),this._text.strokeColor=e}},{key:"labelBold",get:function(){return this.createText(),this._text.bold},set:function(e){this.createText(),this._text.bold=e}},{key:"labelFont",get:function(){return this.createText(),this._text.font},set:function(e){this.createText(),this._text.font=e}},{key:"labelAlign",get:function(){return this.createText(),this._text.align},set:function(e){this.createText(),this._text.align=e}},{key:"clickHandler",get:function(){return this._clickHandler},set:function(e){this._clickHandler=e}},{key:"text",get:function(){return this.createText(),this._text}},{key:"sizeGrid",get:function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},set:function(e){this._bitmap.sizeGrid=yi.fillArray(ci.defaultSizeGrid,e,Number)}},{key:"width",set:function(e){G(z(a.prototype),"set_width",this).call(this,e),this._autoSize&&(this._bitmap.width=e,this._text&&(this._text.width=e))},get:function(){return G(z(a.prototype),"get_width",this).call(this)}},{key:"height",set:function(e){G(z(a.prototype),"set_height",this).call(this,e),this._autoSize&&(this._bitmap.height=e,this._text&&(this._text.height=e))},get:function(){return G(z(a.prototype),"get_height",this).call(this)}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.label=e+"":G(z(a.prototype),"set_dataSource",this).call(this,e)},get:function(){return G(z(a.prototype),"get_dataSource",this).call(this)}},{key:"iconOffset",get:function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},set:function(e){this._bitmap._offset=e?yi.fillArray([1,1],e,Number):[]}}]),a}();Eo.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0},M.regClass(Eo),Dt.regClass("laya.ui.Button",Eo),Dt.regClass("Laya.Button",Eo);var Mo=function(){T(i,Eo);var n=b(i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return S(this,i),(t=n.call(this,e,t)).toggle=!0,t._autoSize=!1,t}return C(i,[{key:"preinitialize",value:function(){G(z(i.prototype),"preinitialize",this).call(this),this.toggle=!0,this._autoSize=!1}},{key:"initialize",value:function(){G(z(i.prototype),"initialize",this).call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0}},{key:"dataSource",set:function(e){(this._dataSource=e)instanceof Boolean?this.selected=e:"string"==typeof e?this.selected="true"===e:s(z(i.prototype),"dataSource",e,this,!0)},get:function(){return G(z(i.prototype),"dataSource",this)}}]),i}();M.regClass(Mo),Dt.regClass("laya.ui.CheckBox",Mo),Dt.regClass("Laya.CheckBox",Mo);var bo=function(){T(i,vi);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return S(this,i),(e=n.call(this))._value=.5,e.skin=t,e}return C(i,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(i.prototype),"destroy",this).call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._bg=this._bar=null,this.changeHandler=null}},{key:"createChildren",value:function(){this.addChild(this._bg=new pi),this.addChild(this._bar=new pi),this._bar._bitmap.autoCacheCmd=!1}},{key:"_skinLoaded",value:function(){this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue),this._sizeChanged(),this.event(Je.LOADED)}},{key:"measureWidth",value:function(){return this._bg.width}},{key:"measureHeight",value:function(){return this._bg.height}},{key:"changeValue",value:function(){var e,t,n;this.sizeGrid?(n=this.sizeGrid.split(","),e=Number(n[3]),t=Number(n[1]),n=(this.width-e-t)*this._value,this._bar.width=e+t+n,this._bar.visible=this._bar.width>e+t):this._bar.width=this.width*this._value}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin!=e&&(this._skin=e,this._skin&&!on.getRes(this._skin)?M.loader.load(this._skin,F.create(this,this._skinLoaded),null,on.IMAGE,1):this._skinLoaded())}},{key:"value",get:function(){return this._value},set:function(e){this._value!=e&&(e=1<e?1:e<0?0:e,this._value=e,this.callLater(this.changeValue),this.event(Je.CHANGE),this.changeHandler&&this.changeHandler.runWith(e))}},{key:"bar",get:function(){return this._bar}},{key:"bg",get:function(){return this._bg}},{key:"sizeGrid",get:function(){return this._bg.sizeGrid},set:function(e){this._bg.sizeGrid=this._bar.sizeGrid=e}},{key:"width",set:function(e){s(z(i.prototype),"width",e,this,!0),this._bg.width=this._width,this.callLater(this.changeValue)},get:function(){return G(z(i.prototype),"width",this)}},{key:"height",set:function(e){s(z(i.prototype),"height",e,this,!0),this._bg.height=this._height,this._bar.height=this._height},get:function(){return G(z(i.prototype),"height",this)}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.value=Number(e):s(z(i.prototype),"dataSource",e,this,!0)},get:function(){return G(z(i.prototype),"dataSource",this)}}]),i}();M.regClass(bo),Dt.regClass("laya.ui.ProgressBar",bo),Dt.regClass("Laya.ProgressBar",bo);var So=function(){T(i,Eo);var n=b(i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return S(this,i),(t=n.call(this,e,t)).toggle=!1,t._autoSize=!1,t}return C(i,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(i.prototype),"destroy",this).call(this,e),this._value=null}},{key:"preinitialize",value:function(){G(z(i.prototype),"preinitialize",this).call(this),this.toggle=!1,this._autoSize=!1}},{key:"initialize",value:function(){G(z(i.prototype),"initialize",this).call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on(Je.CLICK,this,this.onClick)}},{key:"onClick",value:function(e){this.selected=!0}},{key:"value",get:function(){return null!=this._value?this._value:this.label},set:function(e){this._value=e}}]),i}();M.regClass(So),Dt.regClass("laya.ui.Radio",So),Dt.regClass("Laya.Radio",So);var Io=function(){T(a,To);var i=b(a);function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return S(this,a),(e=i.call(this))._selectedIndex=-1,e._direction="horizontal",e._space=0,e.skin=n,e.labels=t,e}return C(a,[{key:"preinitialize",value:function(){this.mouseEnabled=!0}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(a.prototype),"destroy",this).call(this,e),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null}},{key:"addItem",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e,i=this._items.length;return n.name="item"+i,this.addChild(n),this.initItems(),t&&0<i?(e=this._items[i-1],"horizontal"==this._direction?n.x=e._x+e.width+this._space:n.y=e._y+e.height+this._space):t&&(n.x=0,n.y=0),i}},{key:"delItem",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this._items.indexOf(e);if(-1!=n){var i=e;this.removeChild(i);for(var a=n+1,r=this._items.length;a<r;a++){var o=this._items[a];o.name="item"+(a-1),t&&("horizontal"==this._direction?o.x-=i.width+this._space:o.y-=i.height+this._space)}this.initItems(),-1<this._selectedIndex&&(n=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=n)}}},{key:"_afterInited",value:function(){this.initItems()}},{key:"initItems",value:function(){this._items||(this._items=[]);for(var e=this._items.length=0;e<1e4;e++){var t=this.getChildByName("item"+e);if(null==t)break;this._items.push(t),t.selected=e===this._selectedIndex,t.clickHandler=F.create(this,this.itemClick,[e],!1)}}},{key:"itemClick",value:function(e){this.selectedIndex=e}},{key:"setSelect",value:function(e,t){this._items&&-1<e&&e<this._items.length&&(this._items[e].selected=t)}},{key:"_skinLoaded",value:function(){this._setLabelChanged(),this.event(Je.LOADED)}},{key:"createItem",value:function(e,t){return null}},{key:"changeLabels",value:function(){if(this._labelChanged=!1,this._items)for(var e=0,t=0,n=this._items.length;t<n;t++){var i=this._items[t];this._skin&&(i.skin=this._skin),this._labelColors&&(i.labelColors=this._labelColors),this._labelSize&&(i.labelSize=this._labelSize),this._labelStroke&&(i.labelStroke=this._labelStroke),this._labelStrokeColor&&(i.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(i.strokeColors=this._strokeColors),this._labelBold&&(i.labelBold=this._labelBold),this._labelPadding&&(i.labelPadding=this._labelPadding),this._labelAlign&&(i.labelAlign=this._labelAlign),this._stateNum&&(i.stateNum=this._stateNum),this._labelFont&&(i.labelFont=this._labelFont),"horizontal"===this._direction?(i.y=0,i.x=e,e+=i.width+this._space):(i.x=0,i.y=e,e+=i.height+this._space)}this._sizeChanged()}},{key:"commitMeasure",value:function(){this.runCallLater(this.changeLabels)}},{key:"_setLabelChanged",value:function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))}},{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(e){this._selectedIndex!=e&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=e,this.setSelect(e,!0),this.event(Je.CHANGE),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin!=e&&(this._skin=e,this._skin&&!on.getRes(this._skin)?M.loader.load(this._skin,F.create(this,this._skinLoaded),null,on.IMAGE,1):this._skinLoaded())}},{key:"labels",get:function(){return this._labels},set:function(e){if(this._labels!=e){if(this._labels=e,this.removeChildren(),this._setLabelChanged(),this._labels)for(var t=this._labels.split(","),n=0,i=t.length;n<i;n++){var a=this.createItem(this._skin,t[n]);a.name="item"+n,this.addChild(a)}this.initItems()}}},{key:"labelColors",get:function(){return this._labelColors},set:function(e){this._labelColors!=e&&(this._labelColors=e,this._setLabelChanged())}},{key:"labelStroke",get:function(){return this._labelStroke},set:function(e){this._labelStroke!=e&&(this._labelStroke=e,this._setLabelChanged())}},{key:"labelStrokeColor",get:function(){return this._labelStrokeColor},set:function(e){this._labelStrokeColor!=e&&(this._labelStrokeColor=e,this._setLabelChanged())}},{key:"strokeColors",get:function(){return this._strokeColors},set:function(e){this._strokeColors!=e&&(this._strokeColors=e,this._setLabelChanged())}},{key:"labelSize",get:function(){return this._labelSize},set:function(e){this._labelSize!=e&&(this._labelSize=e,this._setLabelChanged())}},{key:"stateNum",get:function(){return this._stateNum},set:function(e){this._stateNum!=e&&(this._stateNum=e,this._setLabelChanged())}},{key:"labelBold",get:function(){return this._labelBold},set:function(e){this._labelBold!=e&&(this._labelBold=e,this._setLabelChanged())}},{key:"labelFont",get:function(){return this._labelFont},set:function(e){this._labelFont!=e&&(this._labelFont=e,this._setLabelChanged())}},{key:"labelPadding",get:function(){return this._labelPadding},set:function(e){this._labelPadding!=e&&(this._labelPadding=e,this._setLabelChanged())}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=e,this._setLabelChanged()}},{key:"space",get:function(){return this._space},set:function(e){this._space=e,this._setLabelChanged()}},{key:"items",get:function(){return this._items}},{key:"selection",get:function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},set:function(e){this.selectedIndex=this._items.indexOf(e)}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.labels=e.join(","):s(z(a.prototype),"dataSource",e,this,!0)},get:function(){return G(z(a.prototype),"dataSource",this)}}]),a}();M.regClass(Io),Dt.regClass("laya.ui.UIGroup",Io),Dt.regClass("Laya.UIGroup",Io);var No=function(){T(t,Io);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"createItem",value:function(e,t){return new So(e,t)}}]),t}();M.regClass(No),Dt.regClass("laya.ui.RadioGroup",No),Dt.regClass("Laya.RadioGroup",No);var Ro=function(){T(t,Io);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"createItem",value:function(e,t){return new Eo(e,t)}}]),t}();M.regClass(Ro),Dt.regClass("laya.ui.Tab",Ro),Dt.regClass("Laya.Tab",Ro);var Co=function(){T(n,To);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments))._setIndexHandler=F.create(u(e),e.setIndex,null,!1),e}return C(n,[{key:"setItems",value:function(e){this.removeChildren();for(var t=0,n=0,i=e.length;n<i;n++){var a=e[n];a&&(a.name="item"+t,this.addChild(a),t++)}this.initItems()}},{key:"addItem",value:function(e){e.name="item"+this._items.length,this.addChild(e),this.initItems()}},{key:"_afterInited",value:function(){this.initItems()}},{key:"initItems",value:function(){this._items=[];for(var e=0;e<1e4;e++){var t=this.getChildByName("item"+e);if(null==t)break;this._items.push(t),t.visible=e==this._selectedIndex}}},{key:"setSelect",value:function(e,t){this._items&&-1<e&&e<this._items.length&&(this._items[e].visible=t)}},{key:"setIndex",value:function(e){this.selectedIndex=e}},{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(e){this._selectedIndex!=e&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=e,this.setSelect(this._selectedIndex,!0))}},{key:"selection",get:function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},set:function(e){this.selectedIndex=this._items.indexOf(e)}},{key:"setIndexHandler",get:function(){return this._setIndexHandler},set:function(e){this._setIndexHandler=e}},{key:"items",get:function(){return this._items}},{key:"dataSource",set:function(e){if("number"==typeof(this._dataSource=e)||"string"==typeof e)this.selectedIndex=parseInt(e);else for(var t in this._dataSource)t in this&&(this[t]=this._dataSource[t])},get:function(){return G(z(n.prototype),"dataSource",this)}}]),n}();M.regClass(Co),Dt.regClass("laya.ui.ViewStack",Co),Dt.regClass("Laya.ViewStack",Co);var Ao=function(){T(i,mr);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return S(this,i),(e=n.call(this)).text=t,e.skin=e.skin,e}return C(i,[{key:"preinitialize",value:function(){this.mouseEnabled=!0}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(i.prototype),"destroy",this).call(this,e),this._bg&&this._bg.destroy(),this._bg=null}},{key:"createChildren",value:function(){this.addChild(this._tf=new zt),this._tf.padding=ci.inputLabelPadding,this._tf.on(Je.INPUT,this,this._onInput),this._tf.on(Je.ENTER,this,this._onEnter),this._tf.on(Je.BLUR,this,this._onBlur),this._tf.on(Je.FOCUS,this,this._onFocus)}},{key:"_onFocus",value:function(){this.event(Je.FOCUS,this)}},{key:"_onBlur",value:function(){this.event(Je.BLUR,this)}},{key:"_onInput",value:function(){this.event(Je.INPUT,this)}},{key:"_onEnter",value:function(){this.event(Je.ENTER,this)}},{key:"initialize",value:function(){this.width=128,this.height=22}},{key:"_skinLoaded",value:function(){this._bg||(this.graphics=this._bg=new _i),this._bg.source=on.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height),this._sizeChanged(),this.event(Je.LOADED)}},{key:"select",value:function(){this._tf.select()}},{key:"setSelection",value:function(e,t){this._tf.setSelection(e,t)}},{key:"bg",get:function(){return this._bg},set:function(e){this.graphics=this._bg=e}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin!=e&&(this._skin=e,this._skin&&!on.getRes(this._skin)?M.loader.load(this._skin,F.create(this,this._skinLoaded),null,on.IMAGE,1):this._skinLoaded())}},{key:"sizeGrid",get:function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},set:function(e){this._bg||(this.graphics=this._bg=new _i),this._bg.sizeGrid=yi.fillArray(ci.defaultSizeGrid,e,Number)}},{key:"text",set:function(e){this._tf.text!=e&&(e+="",this._tf.text=e,this.event(Je.CHANGE))},get:function(){return G(z(i.prototype),"text",this)}},{key:"width",set:function(e){s(z(i.prototype),"width",e,this,!0),this._bg&&(this._bg.width=e)},get:function(){return G(z(i.prototype),"width",this)}},{key:"height",set:function(e){s(z(i.prototype),"height",e,this,!0),this._bg&&(this._bg.height=e)},get:function(){return G(z(i.prototype),"height",this)}},{key:"multiline",get:function(){return this._tf.multiline},set:function(e){this._tf.multiline=e}},{key:"editable",set:function(e){this._tf.editable=e},get:function(){return this._tf.editable}},{key:"restrict",get:function(){return this._tf.restrict},set:function(e){this._tf.restrict=e}},{key:"prompt",get:function(){return this._tf.prompt},set:function(e){this._tf.prompt=e}},{key:"promptColor",get:function(){return this._tf.promptColor},set:function(e){this._tf.promptColor=e}},{key:"maxChars",get:function(){return this._tf.maxChars},set:function(e){this._tf.maxChars=e}},{key:"focus",get:function(){return this._tf.focus},set:function(e){this._tf.focus=e}},{key:"type",get:function(){return this._tf.type},set:function(e){this._tf.type=e}}]),i}();M.regClass(Ao),Dt.regClass("laya.ui.TextInput",Ao),Dt.regClass("Laya.TextInput",Ao);var Do=function(){T(i,vi);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return S(this,i),(e=n.call(this)).isVertical=!0,e.showLabel=!0,e._max=100,e._min=0,e._tick=1,e._value=0,i.label||(i.label=new mr),e.skin=t,e}return C(i,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(i.prototype),"destroy",this).call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._progress&&this._progress.destroy(e),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null}},{key:"createChildren",value:function(){this.addChild(this._bg=new pi),this.addChild(this._bar=new Eo)}},{key:"initialize",value:function(){this._bar.on(Je.MOUSE_DOWN,this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0}},{key:"onBarMouseDown",value:function(e){var t=M;this._globalSacle||(this._globalSacle=new L),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=t.stage.mouseX,this._ty=t.stage.mouseY,t.stage.on(Je.MOUSE_MOVE,this,this.mouseMove),t.stage.once(Je.MOUSE_UP,this,this.mouseUp),t.stage.once(Je.MOUSE_OUT,this,this.mouseUp),this.showValueText()}},{key:"showValueText",value:function(){var e;this.showLabel&&(e=i.label,this.addChild(e),e.textField.changeText(this._value+""),this.isVertical?(e.x=this._bar._x+20,e.y=.5*(this._bar.height-e.height)+this._bar._y):(e.y=this._bar._y-20,e.x=.5*(this._bar.width-e.width)+this._bar._x))}},{key:"hideValueText",value:function(){i.label&&i.label.removeSelf()}},{key:"mouseUp",value:function(e){var t=M.stage;t.off(Je.MOUSE_MOVE,this,this.mouseMove),t.off(Je.MOUSE_UP,this,this.mouseUp),t.off(Je.MOUSE_OUT,this,this.mouseUp),this.sendChangeEvent(Je.CHANGED),this.hideValueText()}},{key:"mouseMove",value:function(e){var t=M.stage,n=this._value;this.isVertical?(this._bar.y+=(t.mouseY-this._ty)/this._globalSacle.y,this._bar._y>this._maxMove?this._bar.y=this._maxMove:this._bar._y<0&&(this._bar.y=0),this._value=this._bar._y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar._y+.5*this._bar.height)):(this._bar.x+=(t.mouseX-this._tx)/this._globalSacle.x,this._bar._x>this._maxMove?this._bar.x=this._maxMove:this._bar._x<0&&(this._bar.x=0),this._value=this._bar._x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar._x+.5*this._bar.width)),this._tx=t.mouseX,this._ty=t.mouseY,0!=this._tick&&(t=Math.pow(10,(this._tick+"").length-1),this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t),this._value!=n&&this.sendChangeEvent(),this.showValueText()}},{key:"sendChangeEvent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Je.CHANGE;this.event(e),this.changeHandler&&this.changeHandler.runWith(this._value)}},{key:"_skinLoaded",value:function(){this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var e=this._skin.replace(".png","$progress.png");on.getRes(e)&&(this._progress||(this.addChild(this._progress=new pi),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=e),this.setBarPoint(),this.callLater(this.changeValue),this._sizeChanged(),this.event(Je.LOADED)}},{key:"setBarPoint",value:function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))}},{key:"measureWidth",value:function(){return Math.max(this._bg.width,this._bar.width)}},{key:"measureHeight",value:function(){return Math.max(this._bg.height,this._bar.height)}},{key:"_sizeChanged",value:function(){G(z(i.prototype),"_sizeChanged",this).call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()}},{key:"setSlider",value:function(e,t,n){this._value=-1,this._min=e,this._max=e<t?t:e,this.value=n<e?e:t<n?t:n}},{key:"changeValue",value:function(){0!=this.tick&&(e=Math.pow(10,(this._tick+"").length-1),this._value=Math.round(Math.round(this._value/this._tick)*this._tick*e)/e),this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var e=this._max-this._min;0===e&&(e=1),this.isVertical?(this._bar.y=(this._value-this._min)/e*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar._y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/e*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar._x+.5*this._bar.width))}},{key:"onBgMouseDown",value:function(e){var t=this._bg.getMousePoint();this.isVertical?this.value=t.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=t.x/(this.width-this._bar.width)*(this._max-this._min)+this._min}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin!=e&&(this._skin=e,this._skin&&!on.getRes(this._skin)?M.loader.load([this._skin,this._skin.replace(".png","$bar.png")],F.create(this,this._skinLoaded)):this._skinLoaded())}},{key:"sizeGrid",get:function(){return this._bg.sizeGrid},set:function(e){this._bg.sizeGrid=e,this._bar.sizeGrid=e,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}},{key:"tick",get:function(){return this._tick},set:function(e){this._tick!=e&&(this._tick=e,this.callLater(this.changeValue))}},{key:"max",get:function(){return this._max},set:function(e){this._max!=e&&(this._max=e,this.callLater(this.changeValue))}},{key:"min",get:function(){return this._min},set:function(e){this._min!=e&&(this._min=e,this.callLater(this.changeValue))}},{key:"value",get:function(){return this._value},set:function(e){var t;this._value!=e&&(t=this._value,this._value=e,this.changeValue(),this._value!=t&&this.sendChangeEvent())}},{key:"allowClickBack",get:function(){return this._allowClickBack},set:function(e){this._allowClickBack!=e&&((this._allowClickBack=e)?this._bg.on(Je.MOUSE_DOWN,this,this.onBgMouseDown):this._bg.off(Je.MOUSE_DOWN,this,this.onBgMouseDown))}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.value=Number(e):s(z(i.prototype),"dataSource",e,this,!0)},get:function(){return G(z(i.prototype),"dataSource",this)}},{key:"bar",get:function(){return this._bar}}]),i}();Do.label=null,M.regClass(Do),Dt.regClass("laya.ui.Slider",Do),Dt.regClass("Laya.Slider",Do);var Lo=function e(){S(this,e)};Lo.touchScrollEnable=!0,Lo.mouseWheelEnable=!0,Lo.showButtons=!0,Lo.popupBgColor="#000000",Lo.popupBgAlpha=.5,Lo.closeDialogOnSide=!0,window.UIConfig=Lo;var Oo=function(){T(i,vi);var n=b(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return S(this,i),(e=n.call(this)).rollRatio=.97,e.scaleBar=!0,e.autoHide=!1,e.elasticDistance=0,e.elasticBackTime=500,e._showButtons=Lo.showButtons,e._scrollSize=1,e._thumbPercent=1,e._lastOffset=0,e._checkElastic=!1,e._isElastic=!1,e._hide=!1,e._clickOnly=!0,e._touchScrollEnable=Lo.touchScrollEnable,e._mouseWheelEnable=Lo.mouseWheelEnable,e.skin=t,e.max=1,e}return C(i,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.stopScroll(),this.target=null,G(z(i.prototype),"destroy",this).call(this,e),this.upButton&&this.upButton.destroy(e),this.downButton&&this.downButton.destroy(e),this.slider&&this.slider.destroy(e),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null}},{key:"createChildren",value:function(){this.addChild(this.slider=new Do),this.addChild(this.upButton=new Eo),this.addChild(this.downButton=new Eo)}},{key:"initialize",value:function(){this.slider.showLabel=!1,this.slider.tick=0,this.slider.on(Je.CHANGE,this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on(Je.MOUSE_DOWN,this,this.onButtonMouseDown),this.downButton.on(Je.MOUSE_DOWN,this,this.onButtonMouseDown)}},{key:"onSliderChange",value:function(){this._value!=this.slider.value&&(this.value=this.slider.value)}},{key:"onButtonMouseDown",value:function(e){e=e.currentTarget===this.upButton;this.slide(e),M.timer.once(ci.scrollBarDelayTime,this,this.startLoop,[e]),M.stage.once(Je.MOUSE_UP,this,this.onStageMouseUp)}},{key:"startLoop",value:function(e){M.timer.frameLoop(1,this,this.slide,[e])}},{key:"slide",value:function(e){e?this.value-=this._scrollSize:this.value+=this._scrollSize}},{key:"onStageMouseUp",value:function(e){M.timer.clear(this,this.startLoop),M.timer.clear(this,this.slide)}},{key:"_skinLoaded",value:function(){this.slider.skin=this._skin,this.callLater(this.changeScrollBar),this._sizeChanged(),this.event(Je.LOADED)}},{key:"changeScrollBar",value:function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()}},{key:"_sizeChanged",value:function(){G(z(i.prototype),"_sizeChanged",this).call(this),this.repaint(),this.resetPositions(),this.event(Je.CHANGE),this.changeHandler&&this.changeHandler.runWith(this.value)}},{key:"resetPositions",value:function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()}},{key:"resetButtonPosition",value:function(){this.slider.isVertical?this.downButton.y=this.slider._y+this.slider.height:this.downButton.x=this.slider._x+this.slider.width}},{key:"measureWidth",value:function(){return this.slider.isVertical?this.slider.width:100}},{key:"measureHeight",value:function(){return this.slider.isVertical?100:this.slider.height}},{key:"setScroll",value:function(e,t,n){this.runCallLater(this._sizeChanged),this.slider.setSlider(e,t,n),this.slider.bar.visible=0<t,!this._hide&&this.autoHide&&(this.visible=!1)}},{key:"onTargetMouseWheel",value:function(e){this.value-=e.delta*this._scrollSize,this.target=this._target}},{key:"onTargetMouseDown",value:function(e){this.isLockedFun&&!this.isLockedFun(e)||(this.event(Je.END),this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new L),this._lastPoint.setTo(M.stage.mouseX,M.stage.mouseY),M.timer.clear(this,this.tweenMove),pn.clearTween(this),M.stage.once(Je.MOUSE_UP,this,this.onStageMouseUp2),M.stage.once(Je.MOUSE_OUT,this,this.onStageMouseUp2),M.timer.frameLoop(1,this,this.loop))}},{key:"startDragForce",value:function(){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new L),this._lastPoint.setTo(M.stage.mouseX,M.stage.mouseY),M.timer.clear(this,this.tweenMove),pn.clearTween(this),M.stage.once(Je.MOUSE_UP,this,this.onStageMouseUp2),M.stage.once(Je.MOUSE_OUT,this,this.onStageMouseUp2),M.timer.frameLoop(1,this,this.loop)}},{key:"cancelDragOp",value:function(){M.stage.off(Je.MOUSE_UP,this,this.onStageMouseUp2),M.stage.off(Je.MOUSE_OUT,this,this.onStageMouseUp2),M.timer.clear(this,this.tweenMove),M.timer.clear(this,this.loop),this._target.mouseEnabled=!0}},{key:"checkTriggers",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return 0<=this.value&&this.value-this._lastOffset<=0&&this.triggerDownDragLimit&&this.triggerDownDragLimit(e)?(this.cancelDragOp(),!(this.value=0)):!!(this.value<=this.max&&this.value-this._lastOffset>=this.max&&this.triggerUpDragLimit&&this.triggerUpDragLimit(e))&&(this.cancelDragOp(),this.value=this.max,!0)}},{key:"startTweenMoveForce",value:function(e){this._lastOffset=e,M.timer.frameLoop(1,this,this.tweenMove,[200])}},{key:"loop",value:function(){var e=M.stage.mouseY,t=M.stage.mouseX;if(this._lastOffset=this.isVertical?e-this._lastPoint.y:t-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?M.stage._canvasTransform.getScaleY():M.stage._canvasTransform.getScaleX()))))return;if(this._clickOnly=!1,this.checkTriggers())return;this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event(Je.START)}else if(this.checkTriggers())return;this._offsets.push(this._lastOffset),this._lastPoint.x=t,this._lastPoint.y=e,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?0<this._lastOffset?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):(this.value-=.5*this._lastOffset,this._value>=this.min&&(this._checkElastic=!1)):this._value>=this.max&&(this._lastOffset<0?this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance):(this.value-=.5*this._lastOffset,this._value<=this.max&&(this._checkElastic=!1))):this.value-=this._lastOffset)}},{key:"onStageMouseUp2",value:function(e){if(M.stage.off(Je.MOUSE_UP,this,this.onStageMouseUp2),M.stage.off(Je.MOUSE_OUT,this,this.onStageMouseUp2),M.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?pn.to(this,{value:this.min},this.elasticBackTime,_n.sineOut,F.create(this,this.elasticOver)):this._value>this.max&&pn.to(this,{value:this.max},this.elasticBackTime,_n.sineOut,F.create(this,this.elasticOver));else if(this._offsets){this._offsets.length<1&&(this._offsets[0]=this.isVertical?M.stage.mouseY-this._lastPoint.y:M.stage.mouseX-this._lastPoint.x);for(var t,n=0,i=Math.min(this._offsets.length,3),a=0;a<i;a++)n+=this._offsets[this._offsets.length-1-a];this._lastOffset=n/i,(n=Math.abs(this._lastOffset))<2?this.event(Je.END):(250<n&&(this._lastOffset=0<this._lastOffset?250:-250),t=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/150))),M.timer.frameLoop(1,this,this.tweenMove,[t]))}}},{key:"elasticOver",value:function(){this._isElastic=!1,!this.hide&&this.autoHide&&pn.to(this,{alpha:0},500),this.event(Je.END)}},{key:"tweenMove",value:function(e){var t;this._lastOffset*=this.rollRatio,this.checkTriggers(!0)||(0<e&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,t=.5*-(this.min-e-this.value),this._lastOffset>t&&(this._lastOffset=t)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,t=.5*-(this.max+e-this.value),this._lastOffset<t&&(this._lastOffset=t))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<.1&&(M.timer.clear(this,this.tweenMove),this._isElastic?this._value<this.min?pn.to(this,{value:this.min},this.elasticBackTime,_n.sineOut,F.create(this,this.elasticOver)):this._value>this.max?pn.to(this,{value:this.max},this.elasticBackTime,_n.sineOut,F.create(this,this.elasticOver)):this.elasticOver():(this.event(Je.END),!this.hide&&this.autoHide&&pn.to(this,{alpha:0},500))))}},{key:"stopScroll",value:function(){this.onStageMouseUp2(null),M.timer.clear(this,this.tweenMove),pn.clearTween(this)}},{key:"skin",get:function(){return this._skin},set:function(e){" "!=e&&this._skin!=e&&(this._skin=e,this._skin&&!on.getRes(this._skin)?M.loader.load([this._skin,this._skin.replace(".png","$up.png"),this._skin.replace(".png","$down.png"),this._skin.replace(".png","$bar.png")],F.create(this,this._skinLoaded)):this._skinLoaded())}},{key:"max",get:function(){return this.slider.max},set:function(e){this.slider.max=e}},{key:"min",get:function(){return this.slider.min},set:function(e){this.slider.min=e}},{key:"value",get:function(){return this._value},set:function(e){e!==this._value&&(this._value=e,this._isElastic||(this.slider._value!=e&&(this.slider._value=e,this.slider.changeValue()),this._value=this.slider._value),this.event(Je.CHANGE),this.changeHandler&&this.changeHandler.runWith(this._value))}},{key:"isVertical",get:function(){return this.slider.isVertical},set:function(e){this.slider.isVertical=e}},{key:"sizeGrid",get:function(){return this.slider.sizeGrid},set:function(e){this.slider.sizeGrid=e}},{key:"scrollSize",get:function(){return this._scrollSize},set:function(e){this._scrollSize=e}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.value=Number(e):s(z(i.prototype),"dataSource",e,this,!0)},get:function(){return G(z(i.prototype),"dataSource",this)}},{key:"thumbPercent",get:function(){return this._thumbPercent},set:function(e){this.runCallLater(this.changeScrollBar),this.runCallLater(this._sizeChanged),e=1<=e?.99:e,this._thumbPercent=e,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*e,ci.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*e,ci.scrollBarMinNum))}},{key:"target",get:function(){return this._target},set:function(e){this._target&&(this._target.off(Je.MOUSE_WHEEL,this,this.onTargetMouseWheel),this._target.off(Je.MOUSE_DOWN,this,this.onTargetMouseDown)),(this._target=e)&&(this._mouseWheelEnable&&this._target.on(Je.MOUSE_WHEEL,this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on(Je.MOUSE_DOWN,this,this.onTargetMouseDown))}},{key:"hide",get:function(){return this._hide},set:function(e){this._hide=e,this.visible=!e}},{key:"showButtons",get:function(){return this._showButtons},set:function(e){this._showButtons=e,this.callLater(this.changeScrollBar)}},{key:"touchScrollEnable",get:function(){return this._touchScrollEnable},set:function(e){this._touchScrollEnable=e,this.target=this._target}},{key:"mouseWheelEnable",get:function(){return this._mouseWheelEnable},set:function(e){this._mouseWheelEnable=e,this.target=this._target}},{key:"lastOffset",get:function(){return this._lastOffset}},{key:"tick",get:function(){return this.slider.tick},set:function(e){this.slider.tick=e}}]),i}();M.regClass(Oo),Dt.regClass("laya.ui.ScrollBar",Oo),Dt.regClass("Laya.ScrollBar",Oo);var Po=function(){T(t,Oo);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}();M.regClass(Po),Dt.regClass("laya.ui.VScrollBar",Po),Dt.regClass("Laya.VScrollBar",Po);var Fo=function(){T(t,Oo);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"initialize",value:function(){G(z(t.prototype),"initialize",this).call(this),this.slider.isVertical=!1}}]),t}();M.regClass(Fo),Dt.regClass("laya.ui.HScrollBar",Fo),Dt.regClass("Laya.HScrollBar",Fo);var Bo=function(){T(n,Ao);var t=b(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return S(this,n),(e=t.call(this,e)).on(Je.CHANGE,u(e),e._onTextChange),e}return C(n,[{key:"_onTextChange",value:function(){this.callLater(this.changeScroll)}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(n.prototype),"destroy",this).call(this,e),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null}},{key:"initialize",value:function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0}},{key:"onVBarChanged",value:function(e){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)}},{key:"onHBarChanged",value:function(e){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)}},{key:"changeScroll",value:function(){var e=this._vScrollBar&&0<this._tf.maxScrollY,t=this._hScrollBar&&0<this._tf.maxScrollX,n=e?this._width-this._vScrollBar.width:this._width,i=t?this._height-this._hScrollBar.height:this._height,a=this._tf.padding||ci.labelPadding;this._tf.width=n,this._tf.height=i,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-a[2],this._vScrollBar.y=a[1],this._vScrollBar.height=this._height-(t?this._hScrollBar.height:0)-a[1]-a[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=i/Math.max(this._tf.textHeight,i),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=e),this._hScrollBar&&(this._hScrollBar.x=a[0],this._hScrollBar.y=this._height-this._hScrollBar.height-a[3],this._hScrollBar.width=this._width-(e?this._vScrollBar.width:0)-a[0]-a[2],this._hScrollBar.scrollSize=Math.max(.033*n,1),this._hScrollBar.thumbPercent=n/Math.max(this._tf.textWidth,n),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=t)}},{key:"scrollTo",value:function(e){this.commitMeasure(),this._tf.scrollY=e}},{key:"width",set:function(e){s(z(n.prototype),"width",e,this,!0),this.callLater(this.changeScroll)},get:function(){return G(z(n.prototype),"width",this)}},{key:"height",set:function(e){s(z(n.prototype),"height",e,this,!0),this.callLater(this.changeScroll)},get:function(){return G(z(n.prototype),"height",this)}},{key:"vScrollBarSkin",get:function(){return this._vScrollBar?this._vScrollBar.skin:null},set:function(e){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new Po),this._vScrollBar.on(Je.CHANGE,this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=e}},{key:"hScrollBarSkin",get:function(){return this._hScrollBar?this._hScrollBar.skin:null},set:function(e){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new Fo),this._hScrollBar.on(Je.CHANGE,this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=e}},{key:"vScrollBar",get:function(){return this._vScrollBar}},{key:"hScrollBar",get:function(){return this._hScrollBar}},{key:"maxScrollY",get:function(){return this._tf.maxScrollY}},{key:"scrollY",get:function(){return this._tf.scrollY}},{key:"maxScrollX",get:function(){return this._tf.maxScrollX}},{key:"scrollX",get:function(){return this._tf.scrollX}}]),n}();M.regClass(Bo),Dt.regClass("laya.ui.TextArea",Bo),Dt.regClass("Laya.TextArea",Bo);var Vo=function(){T(n,vi);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments))._gridSize=11,e._bgColor="#ffffff",e._borderColor="#000000",e._inputColor="#000000",e._inputBgColor="#efefef",e._colors=[],e._selectedColor="#000000",e}return C(n,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(n.prototype),"destroy",this).call(this,e),this._colorPanel&&this._colorPanel.destroy(e),this._colorButton&&this._colorButton.destroy(e),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null}},{key:"createChildren",value:function(){this.addChild(this._colorButton=new Eo),this._colorPanel=new To,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new Bt),this._colorPanel.addChild(this._colorBlock=new Bt),this._colorPanel.addChild(this._colorInput=new zt)}},{key:"initialize",value:function(){this._colorButton.on(Je.CLICK,this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on(Je.CHANGE,this,this.onColorInputChange),this._colorInput.on(Je.KEY_DOWN,this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on(Je.MOUSE_MOVE,this,this.onColorTilesMouseMove),this._colorTiles.on(Je.CLICK,this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on(Je.MOUSE_DOWN,this,this.onPanelMouseDown),this.bgColor=this._bgColor}},{key:"onPanelMouseDown",value:function(e){e.stopPropagation()}},{key:"changePanel",value:function(){this._panelChanged=!1;var e=this._colorPanel.graphics;e.clear(!0),e.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(e=this._colorTiles.graphics).clear(!0);for(var t=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],n=0;n<12;n++)for(var i=0;i<20;i++){var a=0===i?t[n]:1===i?0:51*(((3*n+i/6)%3<<0)+3*(n/6<<0))<<16|i%6*51<<8|(n<<0)%6*51,r=yi.toColor(a);this._colors.push(r);var o=i*this._gridSize,a=n*this._gridSize;e.drawRect(o,a,this._gridSize,this._gridSize,r,"#000000")}}},{key:"onColorButtonClick",value:function(e){this._colorPanel.parent?this.close():this.open()}},{key:"open",value:function(){var e=M.stage,t=this.localToGlobal(new L),n=t.x+this._colorPanel.width<=e.width?t.x:e.width-this._colorPanel.width,i=(i=t.y+this._colorButton.height)+this._colorPanel.height<=e.height?i:t.y-this._colorPanel.height;this._colorPanel.pos(n,i),this._colorPanel.zOrder=1001,e.addChild(this._colorPanel),e.on(Je.MOUSE_DOWN,this,this.removeColorBox)}},{key:"close",value:function(){M.stage.off(Je.MOUSE_DOWN,this,this.removeColorBox),this._colorPanel.removeSelf()}},{key:"removeColorBox",value:function(){this.close()}},{key:"onColorFieldKeyDown",value:function(e){13==e.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),e.stopPropagation())}},{key:"onColorInputChange",value:function(){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")}},{key:"onColorTilesClick",value:function(e){this.selectedColor=this.getColorByMouse(),this.close()}},{key:"onColorTilesMouseMove",value:function(e){this._colorInput.focus=!1;var t=this.getColorByMouse();this._colorInput.text=t,this.drawBlock(t)}},{key:"getColorByMouse",value:function(){var e=this._colorTiles.getMousePoint(),t=Math.floor(e.x/this._gridSize),e=Math.floor(e.y/this._gridSize);return this._colors[20*e+t]}},{key:"drawBlock",value:function(e){var t=this._colorBlock.graphics;t.clear(!0);var n=e||"#ffffff";t.drawRect(0,0,50,20,n,this._borderColor),e||t.drawLine(0,0,50,20,"#ff0000")}},{key:"changeColor",value:function(){var e=this.graphics;e.clear(!0);var t=this._selectedColor||"#000000";e.drawRect(0,0,this._colorButton.width,this._colorButton.height,t)}},{key:"_setPanelChanged",value:function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))}},{key:"selectedColor",get:function(){return this._selectedColor},set:function(e){this._selectedColor!=e&&(this._selectedColor=this._colorInput.text=e,this.drawBlock(e),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event(Je.CHANGE,Je.EMPTY.setTo(Je.CHANGE,this,this)))}},{key:"skin",get:function(){return this._colorButton.skin},set:function(e){this._colorButton.once(Je.LOADED,this,this.changeColor),this._colorButton.skin=e}},{key:"bgColor",get:function(){return this._bgColor},set:function(e){this._bgColor=e,this._setPanelChanged()}},{key:"borderColor",get:function(){return this._borderColor},set:function(e){this._borderColor=e,this._setPanelChanged()}},{key:"inputColor",get:function(){return this._inputColor},set:function(e){this._inputColor=e,this._setPanelChanged()}},{key:"inputBgColor",get:function(){return this._inputBgColor},set:function(e){this._inputBgColor=e,this._setPanelChanged()}}]),n}();M.regClass(Vo),Dt.regClass("laya.ui.ColorPicker",Vo),Dt.regClass("Laya.ColorPicker",Vo);var Uo=function(){T(n,To);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments))._oldW=0,e._oldH=0,e}return C(n,[{key:"onEnable",value:function(){M.stage.on("resize",this,this.onResize),this.onResize()}},{key:"onDisable",value:function(){M.stage.off("resize",this,this.onResize)}},{key:"onResize",value:function(){var e,t=M.stage;0<this.width&&0<this.height&&(e=Math.min(t.width/this._oldW,t.height/this._oldH),s(z(n.prototype),"width",t.width,this,!0),s(z(n.prototype),"height",t.height,this,!0),this.scale(e,e))}},{key:"width",set:function(e){s(z(n.prototype),"width",e,this,!0),this._oldW=e},get:function(){return G(z(n.prototype),"width",this)}},{key:"height",set:function(e){s(z(n.prototype),"height",e,this,!0),this._oldH=e},get:function(){return G(z(n.prototype),"height",this)}}]),n}();M.regClass(Uo),Dt.regClass("laya.ui.ScaleBox",Uo),Dt.regClass("Laya.ScaleBox",Uo);var zo=function(){T(n,To);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).selectEnable=!1,e.totalPage=0,e._$componentType="List",e._repeatX=0,e._repeatY=0,e._repeatX2=0,e._repeatY2=0,e._spaceX=0,e._spaceY=0,e._cells=[],e._startIndex=0,e._selectedIndex=-1,e._page=0,e._isVertical=!0,e._cellSize=20,e._cellOffset=0,e._createdLine=0,e._offset=new L,e._usedCache=null,e._elasticEnabled=!1,e._preLen=0,e}return C(n,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._content&&this._content.destroy(e),this._scrollBar&&this._scrollBar.destroy(e),G(z(n.prototype),"destroy",this).call(this,e),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null}},{key:"createChildren",value:function(){this.addChild(this._content=new To)}},{key:"onScrollStart",value:function(){this._usedCache||(this._usedCache=G(z(n.prototype),"cacheAs",this)),s(z(n.prototype),"cacheAs","none",this,!0),this._scrollBar.once(Je.END,this,this.onScrollEnd)}},{key:"onScrollEnd",value:function(){s(z(n.prototype),"cacheAs",this._usedCache,this,!0)}},{key:"_removePreScrollBar",value:function(){var e=this.removeChildByName("scrollBar");e&&e.destroy(!0)}},{key:"changeCells",value:function(){var e,t,n,i;this._cellChanged=!1,this._itemRender&&(this.scrollBar=this.getChildByName("scrollBar"),e=(i=this._getOneCell()).width+this._spaceX||1,t=i.height+this._spaceY||1,0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/t):Math.round(this._height/t)),n=this._width||e*this.repeatX-this._spaceX,i=this._height||t*this.repeatY-this._spaceY,this._cellSize=this._isVertical?t:e,this._cellOffset=this._isVertical?t*Math.max(this._repeatY2,this._repeatY)-i-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-n-this._spaceX,this._isVertical&&this.vScrollBarSkin?this._scrollBar.height=i:!this._isVertical&&this.hScrollBarSkin&&(this._scrollBar.width=n),this.setContentSize(n,i),n=this._isVertical?this.repeatX:this.repeatY,i=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0),this._createItems(0,n,i),this._createdLine=i,this._array&&(this.array=this._array,this.runCallLater(this.renderItems)))}},{key:"_getOneCell",value:function(){if(0===this._cells.length){var e=this.createItem();if(this._offset.setTo(e._x,e._y),this.cacheContent)return e;this._cells.push(e)}return this._cells[0]}},{key:"_createItems",value:function(e,t,n){var i=this._content,a=this._getOneCell(),r=a.width+this._spaceX,o=a.height+this._spaceY;if(this.cacheContent){var s=new To;s.cacheAs="normal",s.pos((this._isVertical?0:e)*r,(this._isVertical?e:0)*o),this._content.addChild(s),i=s}else{for(var l=[],h=this._cells.length-1;-1<h;h--){var u=this._cells[h];u.removeSelf(),l.push(u)}this._cells.length=0}for(var d=e;d<n;d++)for(var c=0;c<t;c++)(a=l&&l.length?l.pop():this.createItem()).x=(this._isVertical?c:d)*r-i._x,a.y=(this._isVertical?d:c)*o-i._y,a.name="item"+(d*t+c),i.addChild(a),this.addCell(a)}},{key:"createItem",value:function(){var e=[],t="function"==typeof this._itemRender?new this._itemRender:bn.createComp(this._itemRender,null,null,e);if(0==e.length&&t._watchMap){var n,i=t._watchMap;for(n in i)for(var a=i[n],r=0;r<a.length;r++){var o=a[r];e.push(o.comp,o.prop,o.value)}}return e.length&&(t._$bindData=e),t}},{key:"addCell",value:function(e){e.on(Je.CLICK,this,this.onCellMouse),e.on(Je.RIGHT_CLICK,this,this.onCellMouse),e.on(Je.MOUSE_OVER,this,this.onCellMouse),e.on(Je.MOUSE_OUT,this,this.onCellMouse),e.on(Je.MOUSE_DOWN,this,this.onCellMouse),e.on(Je.MOUSE_UP,this,this.onCellMouse),this._cells.push(e)}},{key:"_afterInited",value:function(){this.initItems()}},{key:"initItems",value:function(){if(!this._itemRender&&null!=this.getChildByName("item0")){var e;this.repeatX=1;for(var t=e=0;t<1e4;t++){var n=this.getChildByName("item"+t);if(!n)break;this.addCell(n),e++}this.repeatY=e}}},{key:"setContentSize",value:function(e,t){this._content.width=e,this._content.height=t,!this._scrollBar&&0==this._offset.x&&0==this._offset.y||(this._content._style.scrollRect||(this._content.scrollRect=O.create()),this._content._style.scrollRect.setTo(-this._offset.x,-this._offset.y,e,t),this._content.scrollRect=this._content.scrollRect),this.event(Je.RESIZE)}},{key:"onCellMouse",value:function(e){e.type===Je.MOUSE_DOWN&&(this._isMoved=!1);var t=e.currentTarget,n=this._startIndex+this._cells.indexOf(t);n<0||(e.type===Je.CLICK||e.type===Je.RIGHT_CLICK?this.selectEnable&&!this._isMoved?this.selectedIndex=n:this.changeCellState(t,!0,0):e.type!==Je.MOUSE_OVER&&e.type!==Je.MOUSE_OUT||this._selectedIndex===n||this.changeCellState(t,e.type===Je.MOUSE_OVER,0),this.mouseHandler&&this.mouseHandler.runWith([e,n]))}},{key:"changeCellState",value:function(e,t,n){e=e.getChildByName("selectBox");e&&(this.selectEnable=!0,e.visible=t,e.index=n)}},{key:"_sizeChanged",value:function(){G(z(n.prototype),"_sizeChanged",this).call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)}},{key:"onScrollBarChange",value:function(){this.runCallLater(this.changeCells);var e=this._scrollBar.value,t=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,i=Math.floor(e/this._cellSize);if(this.cacheContent)s=n+1,this._createdLine-i<s&&(this._createItems(this._createdLine,t,this._createdLine+s),this.renderItems(this._createdLine*t,0),this._createdLine+=s);else{var a,r,o=i*t,s=0;o>this._startIndex?(s=o-this._startIndex,a=!0,r=this._startIndex+t*(n+1),this._isMoved=!0):o<this._startIndex&&(s=this._startIndex-o,a=!1,r=this._startIndex-1,this._isMoved=!0);for(var l=0;l<s;l++){var h,u=a?(h=this._cells.shift(),this._cells[this._cells.length]=h,r+l):(h=this._cells.pop(),this._cells.unshift(h),r-l),d=Math.floor(u/t)*this._cellSize;this._isVertical?h.y=d:h.x=d,this.renderItem(h,u)}this._startIndex=o,this.changeSelectStatus()}o=this._content._style.scrollRect;this._isVertical?(o.y=e-this._offset.y,o.x=-this._offset.x):(o.y=-this._offset.y,o.x=e-this._offset.x),this._content.scrollRect=o}},{key:"posCell",value:function(e,t){var n;this._scrollBar&&(n=this._isVertical?this.repeatX:this.repeatY,this._isVertical?this.repeatY:this.repeatX,n=Math.floor(t/n)*this._cellSize,this._isVertical?e._y=n:e.x=n)}},{key:"changeSelectStatus",value:function(){for(var e=0,t=this._cells.length;e<t;e++)this.changeCellState(this._cells[e],this._selectedIndex===this._startIndex+e,1)}},{key:"renderItems",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:0)||this._cells.length;e<t;e++)this.renderItem(this._cells[e],this._startIndex+e);this.changeSelectStatus()}},{key:"renderItem",value:function(e,t){this._array&&0<=t&&t<this._array.length?(e.visible=!0,e._$bindData?(e._dataSource=this._array[t],this._bindData(e,this._array[t])):e.dataSource=this._array[t],this.cacheContent||this.posCell(e,t),this.hasListener(Je.RENDER)&&this.event(Je.RENDER,[e,t]),this.renderHandler&&this.renderHandler.runWith([e,t])):(e.visible=!1,e.dataSource=null)}},{key:"_bindData",value:function(e,t){for(var n=e._$bindData,i=0,a=n.length;i<a;i++){var r=n[i++],o=n[i++],s=n[i],s=yi.getBindFun(s);r[o]=s.call(this,t)}}},{key:"updateArray",value:function(e){var t,n;this._array=e,this._array&&(0<=(n=this._preLen-this._startIndex)&&this.renderItems(n),this._preLen=this._array.length),this._scrollBar&&(t=e.length,n=this._isVertical?this.repeatX:this.repeatY,(e=this._isVertical?this.repeatY:this.repeatX)<=(n=Math.ceil(t/n))&&(this._scrollBar.thumbPercent=e/n,this._scrollBar.slider._max=(n-e)*this._cellSize+this._cellOffset))}},{key:"refresh",value:function(){this.array=this._array}},{key:"getItem",value:function(e){return-1<e&&e<this._array.length?this._array[e]:null}},{key:"changeItem",value:function(e,t){-1<e&&e<this._array.length&&(this._array[e]=t,e>=this._startIndex&&e<this._startIndex+this._cells.length&&this.renderItem(this.getCell(e),e))}},{key:"setItem",value:function(e,t){this.changeItem(e,t)}},{key:"addItem",value:function(e){this._array.push(e),this.array=this._array}},{key:"addItemAt",value:function(e,t){this._array.splice(t,0,e),this.array=this._array}},{key:"deleteItem",value:function(e){this._array.splice(e,1),this.array=this._array}},{key:"getCell",value:function(e){return this.runCallLater(this.changeCells),-1<e&&this._cells?this._cells[(e-this._startIndex)%this._cells.length]:null}},{key:"scrollTo",value:function(e){var t;this._scrollBar?(t=this._isVertical?this.repeatX:this.repeatY,this._scrollBar.value=Math.floor(e/t)*this._cellSize):this.startIndex=e}},{key:"tweenTo",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:200,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this._scrollBar?(this._scrollBar.stopScroll(),t=this._isVertical?this.repeatX:this.repeatY,pn.to(this._scrollBar,{value:Math.floor(e/t)*this._cellSize},n,null,i,0,!0)):(this.startIndex=e,i&&i.run())}},{key:"_setCellChanged",value:function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))}},{key:"commitMeasure",value:function(){this.runCallLater(this.changeCells)}},{key:"cacheAs",set:function(e){s(z(n.prototype),"cacheAs",e,this,!0),this._scrollBar&&(this._usedCache=null,"none"!==e?this._scrollBar.on(Je.START,this,this.onScrollStart):this._scrollBar.off(Je.START,this,this.onScrollStart))},get:function(){return G(z(n.prototype),"cacheAs",this)}},{key:"content",get:function(){return this._content}},{key:"vScrollBarSkin",get:function(){return this._scrollBar?this._scrollBar.skin:null},set:function(e){this._removePreScrollBar();var t=new Po;t.name="scrollBar",t.right=0,t.skin=e,t.elasticDistance=this._elasticEnabled?200:0,this.scrollBar=t,this.addChild(t),this._setCellChanged()}},{key:"hScrollBarSkin",get:function(){return this._scrollBar?this._scrollBar.skin:null},set:function(e){this._removePreScrollBar();var t=new Fo;t.name="scrollBar",t.bottom=0,t.skin=e,t.elasticDistance=this._elasticEnabled?200:0,this.scrollBar=t,this.addChild(t),this._setCellChanged()}},{key:"scrollBar",get:function(){return this._scrollBar},set:function(e){this._scrollBar!=e&&(this._scrollBar=e)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on(Je.CHANGE,this,this.onScrollBarChange))}},{key:"itemRender",get:function(){return this._itemRender},set:function(e){if(this._itemRender!=e){this._itemRender=e;for(var t=this._cells.length-1;-1<t;t--)this._cells[t].destroy();this._cells.length=0,this._setCellChanged()}}},{key:"width",set:function(e){e!=this._width&&(s(z(n.prototype),"width",e,this,!0),this._setCellChanged())},get:function(){return G(z(n.prototype),"width",this)}},{key:"height",set:function(e){e!=this._height&&(s(z(n.prototype),"height",e,this,!0),this._setCellChanged())},get:function(){return G(z(n.prototype),"height",this)}},{key:"repeatX",get:function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},set:function(e){this._repeatX=e,this._setCellChanged()}},{key:"repeatY",get:function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},set:function(e){this._repeatY=e,this._setCellChanged()}},{key:"spaceX",get:function(){return this._spaceX},set:function(e){this._spaceX=e,this._setCellChanged()}},{key:"spaceY",get:function(){return this._spaceY},set:function(e){this._spaceY=e,this._setCellChanged()}},{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(e){this._selectedIndex!=e&&(this._selectedIndex=e,this.changeSelectStatus(),this.event(Je.CHANGE),this.selectHandler&&this.selectHandler.runWith(e),this.startIndex=this._startIndex)}},{key:"selectedItem",get:function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},set:function(e){this.selectedIndex=this._array.indexOf(e)}},{key:"selection",get:function(){return this.getCell(this._selectedIndex)},set:function(e){this.selectedIndex=this._startIndex+this._cells.indexOf(e)}},{key:"startIndex",get:function(){return this._startIndex},set:function(e){this._startIndex=0<e?e:0,this.callLater(this.renderItems)}},{key:"array",get:function(){return this._array},set:function(e){this.runCallLater(this.changeCells),this._array=e||[],this._preLen=this._array.length;var t,n=this._array.length;this.totalPage=Math.ceil(n/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<n?this._selectedIndex:n-1,this.startIndex=this._startIndex,this._scrollBar&&(this._scrollBar.stopScroll(),t=this._isVertical?this.repeatX:this.repeatY,e=this._isVertical?this.repeatY:this.repeatX,t=Math.ceil(n/t),1<(0<this._cellOffset?this.totalPage+1:this.totalPage)&&e<=t?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=e/t,this._scrollBar.setScroll(0,(t-e)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content)}},{key:"page",get:function(){return this._page},set:function(e){this._page=e,this._array&&(this._page=0<e?e:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}},{key:"length",get:function(){return this._array?this._array.length:0}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.array=e:s(z(n.prototype),"dataSource",e,this,!0)},get:function(){return G(z(n.prototype),"dataSource",this)}},{key:"cells",get:function(){return this.runCallLater(this.changeCells),this._cells}},{key:"elasticEnabled",get:function(){return this._elasticEnabled},set:function(e){this._elasticEnabled=e,this._scrollBar&&(this._scrollBar.elasticDistance=e?200:0)}}]),n}();M.regClass(zo),Dt.regClass("laya.ui.List",zo),Dt.regClass("Laya.List",zo);var Go=function(){T(a,vi);var i=b(a);function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return S(this,a),(e=i.call(this))._visibleNum=6,e._itemColors=ci.comboBoxItemColors,e._itemSize=12,e._labels=[],e._selectedIndex=-1,e.itemRender=null,e.skin=t,e.labels=n,e}return C(a,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(a.prototype),"destroy",this).call(this,e),this._button&&this._button.destroy(e),this._list&&this._list.destroy(e),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null}},{key:"createChildren",value:function(){this.addChild(this._button=new Eo),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on(Je.MOUSE_DOWN,this,this.onButtonMouseDown)}},{key:"_createList",value:function(){this._list=new zo,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)}},{key:"_setListEvent",value:function(e){this._list.selectEnable=!0,this._list.on(Je.MOUSE_DOWN,this,this.onListDown),this._list.mouseHandler=F.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on(Je.MOUSE_DOWN,this,this.onScrollBarDown)}},{key:"onListDown",value:function(e){e.stopPropagation()}},{key:"onScrollBarDown",value:function(e){e.stopPropagation()}},{key:"onButtonMouseDown",value:function(e){this.callLater(this.switchTo,[!this._isOpen])}},{key:"measureWidth",value:function(){return this._button.width}},{key:"measureHeight",value:function(){return this._button.height}},{key:"changeList",value:function(){this._listChanged=!1;var e=this.width-2,t=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:e,height:this._itemHeight,fontSize:this._itemSize,color:t}}]},this._list.repeatY=this._visibleNum,this._list.refresh()}},{key:"onlistItemMouse",value:function(e,t){var n=e.type;n===Je.MOUSE_OVER||n===Je.MOUSE_OUT?this._isCustomList||(!(e=this._list.getCell(t))||(e=e.getChildByName("label"))&&(n===Je.ROLL_OVER?(e.bgColor=this._itemColors[0],e.color=this._itemColors[1]):(e.bgColor=null,e.color=this._itemColors[2]))):n===Je.CLICK&&(this.selectedIndex=t,this.isOpen=!1)}},{key:"switchTo",value:function(e){this.isOpen=e}},{key:"changeOpen",value:function(){this.isOpen=!this._isOpen}},{key:"changeItem",value:function(){var e;this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,this._isCustomList||((e=this._list.graphics).clear(!0),e.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3]));for(var t=this._list.array||[],n=t.length=0,i=this._labels.length;n<i;n++)t.push({label:this._labels[n]});this._list.height=this._listHeight,this._list.array=t}},{key:"changeSelected",value:function(){this._button.label=this.selectedLabel}},{key:"_onStageMouseWheel",value:function(e){this._list&&!this._list.contains(e.target)&&this.removeList(null)}},{key:"removeList",value:function(e){M.stage.off(Je.MOUSE_DOWN,this,this.removeList),M.stage.off(Je.MOUSE_WHEEL,this,this._onStageMouseWheel),this.isOpen=!1}},{key:"skin",get:function(){return this._button.skin},set:function(e){this._button.skin!=e&&(this._button.skin=e,this._listChanged=!0)}},{key:"width",set:function(e){s(z(a.prototype),"width",e,this,!0),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0},get:function(){return G(z(a.prototype),"width",this)}},{key:"height",set:function(e){s(z(a.prototype),"height",e,this,!0),this._button.height=this._height},get:function(){return G(z(a.prototype),"height",this)}},{key:"labels",get:function(){return this._labels.join(",")},set:function(e){0<this._labels.length&&(this.selectedIndex=-1),e?this._labels=e.split(","):this._labels.length=0,this._itemChanged=!0}},{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(e){this._selectedIndex!=e&&(this._selectedIndex=e,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event(Je.CHANGE,[Je.EMPTY.setTo(Je.CHANGE,this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}},{key:"selectHandler",get:function(){return this._selectHandler},set:function(e){this._selectHandler=e}},{key:"selectedLabel",get:function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},set:function(e){this.selectedIndex=this._labels.indexOf(e)}},{key:"visibleNum",get:function(){return this._visibleNum},set:function(e){this._visibleNum=e,this._listChanged=!0}},{key:"itemColors",get:function(){return String(this._itemColors)},set:function(e){this._itemColors=yi.fillArray(this._itemColors,e,String),this._listChanged=!0}},{key:"itemSize",get:function(){return this._itemSize},set:function(e){this._itemSize=e,this._listChanged=!0}},{key:"isOpen",get:function(){return this._isOpen},set:function(e){var t;this._isOpen!=e&&(this._isOpen=e,this._button.selected=this._isOpen,this._isOpen?(this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem(),e=(e=(t=this.localToGlobal(L.TEMP.setTo(0,0))).y+this._button.height)+this._listHeight<=M.stage.height?e:t.y-this._listHeight,this._list.pos(t.x,e),this._list.zOrder=1001,M.stage.addChild(this._list),M.stage.once(Je.MOUSE_DOWN,this,this.removeList),M.stage.on(Je.MOUSE_WHEEL,this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex):this._list&&this._list.removeSelf())}},{key:"scrollBarSkin",get:function(){return this._scrollBarSkin},set:function(e){this._scrollBarSkin=e}},{key:"sizeGrid",get:function(){return this._button.sizeGrid},set:function(e){this._button.sizeGrid=e}},{key:"scrollBar",get:function(){return this.list.scrollBar}},{key:"button",get:function(){return this._button}},{key:"list",get:function(){return this._list||this._createList(),this._list},set:function(e){e&&(e.removeSelf(),this._isCustomList=!0,this._list=e,this._setListEvent(e),this._itemHeight=e.getCell(0).height+e.spaceY)}},{key:"dataSource",set:function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.labels=e.join(","):s(z(a.prototype),"dataSource",e,this,!0)},get:function(){return G(z(a.prototype),"dataSource",this)}},{key:"labelColors",get:function(){return this._button.labelColors},set:function(e){this._button.labelColors!=e&&(this._button.labelColors=e)}},{key:"labelPadding",get:function(){return this._button.text.padding.join(",")},set:function(e){this._button.text.padding=yi.fillArray(ci.labelPadding,e,Number)}},{key:"labelSize",get:function(){return this._button.text.fontSize},set:function(e){this._button.text.fontSize=e}},{key:"labelBold",get:function(){return this._button.text.bold},set:function(e){this._button.text.bold=e}},{key:"labelFont",get:function(){return this._button.text.font},set:function(e){this._button.text.font=e}},{key:"stateNum",get:function(){return this._button.stateNum},set:function(e){this._button.stateNum=e}}]),a}();M.regClass(Go),Dt.regClass("laya.ui.ComboBox",Go),Dt.regClass("Laya.ComboBox",Go);var Xo=function(){T(n,Do);var t=b(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return S(this,n),(e=t.call(this,e)).isVertical=!1,e}return n}();M.regClass(Xo),Dt.regClass("laya.ui.HSlider",Xo),Dt.regClass("Laya.HSlider",Xo);var Ho=function(){T(n,To);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._usedCache=null,e._elasticEnabled=!1,e.width=e.height=100,e}return C(n,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(n.prototype),"destroy",this).call(this,e),this._content&&this._content.destroy(e),this._vScrollBar&&this._vScrollBar.destroy(e),this._hScrollBar&&this._hScrollBar.destroy(e),this._vScrollBar=null,this._hScrollBar=null,this._content=null}},{key:"destroyChildren",value:function(){this._content.destroyChildren()}},{key:"createChildren",value:function(){G(z(n.prototype),"addChild",this).call(this,this._content=new To)}},{key:"addChild",value:function(e){return e.on(Je.RESIZE,this,this.onResize),this._setScrollChanged(),this._content.addChild(e)}},{key:"onResize",value:function(){this._setScrollChanged()}},{key:"addChildAt",value:function(e,t){return e.on(Je.RESIZE,this,this.onResize),this._setScrollChanged(),this._content.addChildAt(e,t)}},{key:"removeChild",value:function(e){return e.off(Je.RESIZE,this,this.onResize),this._setScrollChanged(),this._content.removeChild(e)}},{key:"removeChildAt",value:function(e){return this.getChildAt(e).off(Je.RESIZE,this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(e)}},{key:"removeChildren",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2147483647;return this._content.removeChildren(e,t),this._setScrollChanged(),this}},{key:"getChildAt",value:function(e){return this._content.getChildAt(e)}},{key:"getChildByName",value:function(e){return this._content.getChildByName(e)}},{key:"getChildIndex",value:function(e){return this._content.getChildIndex(e)}},{key:"changeScroll",value:function(){this._scrollChanged=!1;var e=this.contentWidth||1,t=this.contentHeight||1,n=this._vScrollBar,i=this._hScrollBar,a=n&&t>this._height,r=i&&e>this._width,o=a?this._width-n.width:this._width,s=r?this._height-i.height:this._height;n&&(n.x=this._width-n.width,n.y=0,n.height=this._height-(r?i.height:0),n.scrollSize=Math.max(.033*this._height,1),n.thumbPercent=s/t,n.setScroll(0,t-s,n.value)),i&&(i.x=0,i.y=this._height-i.height,i.width=this._width-(a?n.width:0),i.scrollSize=Math.max(.033*this._width,1),i.thumbPercent=o/e,i.setScroll(0,e-o,i.value))}},{key:"_sizeChanged",value:function(){G(z(n.prototype),"_sizeChanged",this).call(this),this.setContentSize(this._width,this._height)}},{key:"setContentSize",value:function(e,t){var n=this._content;n.width=e,n.height=t,n._style.scrollRect||(n.scrollRect=O.create()),n._style.scrollRect.setTo(0,0,e,t),n.scrollRect=n.scrollRect}},{key:"onScrollBarChange",value:function(e){var t,n=this._content._style.scrollRect;n&&(t=Math.round(e.value),e.isVertical?n.y=t:n.x=t,this._content.scrollRect=n)}},{key:"scrollTo",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.vScrollBar&&(this.vScrollBar.value=t),this.hScrollBar&&(this.hScrollBar.value=e)}},{key:"refresh",value:function(){this.changeScroll()}},{key:"onScrollStart",value:function(){this._usedCache||(this._usedCache=G(z(n.prototype),"cacheAs",this)),s(z(n.prototype),"cacheAs","none",this,!0),this._hScrollBar&&this._hScrollBar.once(Je.END,this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once(Je.END,this,this.onScrollEnd)}},{key:"onScrollEnd",value:function(){s(z(n.prototype),"cacheAs",this._usedCache,this,!0)}},{key:"_setScrollChanged",value:function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))}},{key:"numChildren",get:function(){return this._content.numChildren}},{key:"contentWidth",get:function(){for(var e=0,t=this._content.numChildren-1;-1<t;t--)var n=this._content.getChildAt(t),e=Math.max(n._x+n.width*n.scaleX-n.pivotX,e);return e}},{key:"contentHeight",get:function(){for(var e=0,t=this._content.numChildren-1;-1<t;t--)var n=this._content.getChildAt(t),e=Math.max(n._y+n.height*n.scaleY-n.pivotY,e);return e}},{key:"width",set:function(e){s(z(n.prototype),"width",e,this,!0),this._setScrollChanged()},get:function(){return G(z(n.prototype),"width",this)}},{key:"height",set:function(e){s(z(n.prototype),"height",e,this,!0),this._setScrollChanged()},get:function(){return G(z(n.prototype),"height",this)}},{key:"vScrollBarSkin",get:function(){return this._vScrollBar?this._vScrollBar.skin:null},set:function(e){null==this._vScrollBar&&(G(z(n.prototype),"addChild",this).call(this,this._vScrollBar=new Po),this._vScrollBar.on(Je.CHANGE,this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._vScrollBar.elasticDistance=this._elasticEnabled?200:0,this._setScrollChanged()),this._vScrollBar.skin=e}},{key:"hScrollBarSkin",get:function(){return this._hScrollBar?this._hScrollBar.skin:null},set:function(e){null==this._hScrollBar&&(G(z(n.prototype),"addChild",this).call(this,this._hScrollBar=new Fo),this._hScrollBar.on(Je.CHANGE,this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._hScrollBar.elasticDistance=this._elasticEnabled?200:0,this._setScrollChanged()),this._hScrollBar.skin=e}},{key:"vScrollBar",get:function(){return this._vScrollBar}},{key:"hScrollBar",get:function(){return this._hScrollBar}},{key:"content",get:function(){return this._content}},{key:"cacheAs",set:function(e){s(z(n.prototype),"cacheAs",e,this,!0),this._usedCache=null,"none"!==e?(this._hScrollBar&&this._hScrollBar.on(Je.START,this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on(Je.START,this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off(Je.START,this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off(Je.START,this,this.onScrollStart))},get:function(){return G(z(n.prototype),"cacheAs",this)}},{key:"elasticEnabled",get:function(){return this._elasticEnabled},set:function(e){this._elasticEnabled=e,this._vScrollBar&&(this._vScrollBar.elasticDistance=e?200:0),this._hScrollBar&&(this._hScrollBar.elasticDistance=e?200:0)}}]),n}();M.regClass(Ho),Dt.regClass("laya.ui.Panel",Ho),Dt.regClass("Laya.Panel",Ho);var Yo=function(){T(t,Do);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}();M.regClass(Yo),Dt.regClass("laya.ui.VSlider",Yo),Dt.regClass("Laya.VSlider",Yo);var Wo=function(){T(n,To);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._spaceLeft=10,e._spaceBottom=0,e._keepStatus=!0,e.width=e.height=200,e}return C(n,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];G(z(n.prototype),"destroy",this).call(this,e),this._list&&this._list.destroy(e),this._list=null,this._source=null,this._renderHandler=null}},{key:"createChildren",value:function(){this.addChild(this._list=new zo),this._list.renderHandler=F.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on(Je.CHANGE,this,this.onListChange)}},{key:"onListChange",value:function(){this.event(Je.CHANGE)}},{key:"getArray",value:function(){var e=[],t=c(this._source);try{for(t.s();!(n=t.n()).done;){var n=n.value;this.getParentOpenStatus(n)&&(n.x=this._spaceLeft*this.getDepth(n),e.push(n))}}catch(e){t.e(e)}finally{t.f()}return e}},{key:"getDepth",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return null==e.nodeParent?t:this.getDepth(e.nodeParent,t+1)}},{key:"getParentOpenStatus",value:function(e){e=e.nodeParent;return null==e||!!e.isOpen&&(null==e.nodeParent||this.getParentOpenStatus(e))}},{key:"renderItem",value:function(e,t){var n,i=e.dataSource;i&&(e.left=i.x,(n=e.getChildByName("arrow"))&&(i.hasChild?(n.visible=!0,n.index=i.isOpen?1:0,n.tag=t,n.off(Je.CLICK,this,this.onArrowClick),n.on(Je.CLICK,this,this.onArrowClick)):n.visible=!1),(n=e.getChildByName("folder"))&&(2==n.clipY?n.index=i.isDirectory?0:1:n.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([e,t]))}},{key:"onArrowClick",value:function(e){e=e.currentTarget.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen,this.event(Je.OPEN),this._list.array=this.getArray()}},{key:"setItemState",value:function(e,t){this._list.array[e]&&(this._list.array[e].isOpen=t,this._list.array=this.getArray())}},{key:"fresh",value:function(){this._list.array=this.getArray(),this.repaint()}},{key:"parseXml",value:function(e,t,n,i){var a,r=e.childNodes,o=r.length;if(!i){a={};var s=c(e.attributes);try{for(s.s();!(h=s.n()).done;){var l=h.value,h=l.nodeName,l=l.nodeValue;a[h]="true"==l||"false"!=l&&l}}catch(e){s.e(e)}finally{s.f()}a.nodeParent=n,0<o&&(a.isDirectory=!0),a.hasChild=0<o,t.push(a)}for(var u=0;u<o;u++){var d=r[u];this.parseXml(d,t,a,!1)}}},{key:"parseOpenStatus",value:function(e,t){for(var n=0,i=t.length;n<i;n++){var a=t[n];if(a.isDirectory)for(var r=0,o=e.length;r<o;r++){var s=e[r];if(s.isDirectory&&this.isSameParent(s,a)&&a.label==s.label){a.isOpen=s.isOpen;break}}}}},{key:"isSameParent",value:function(e,t){return null==e.nodeParent&&null==t.nodeParent||null!=e.nodeParent&&null!=t.nodeParent&&(e.nodeParent.label==t.nodeParent.label&&this.isSameParent(e.nodeParent,t.nodeParent))}},{key:"filter",value:function(e){var t;Boolean(e)?(t=[],this.getFilterSource(this._source,t,e),this._list.array=t):this._list.array=this.getArray()}},{key:"getFilterSource",value:function(e,t,n){n=n.toLocaleLowerCase();var i=c(e);try{for(i.s();!(a=i.n()).done;){var a=a.value;!a.isDirectory&&-1<String(a.label).toLowerCase().indexOf(n)&&(a.x=0,t.push(a)),a.child&&0<a.child.length&&this.getFilterSource(a.child,t,n)}}catch(e){i.e(e)}finally{i.f()}}},{key:"keepStatus",get:function(){return this._keepStatus},set:function(e){this._keepStatus=e}},{key:"array",get:function(){return this._list.array},set:function(e){this._keepStatus&&this._list.array&&e&&this.parseOpenStatus(this._list.array,e),this._source=e,this._list.array=this.getArray()}},{key:"source",get:function(){return this._source}},{key:"list",get:function(){return this._list}},{key:"itemRender",get:function(){return this._list.itemRender},set:function(e){this._list.itemRender=e}},{key:"scrollBarSkin",get:function(){return this._list.vScrollBarSkin},set:function(e){this._list.vScrollBarSkin=e}},{key:"scrollBar",get:function(){return this._list.scrollBar}},{key:"mouseHandler",get:function(){return this._list.mouseHandler},set:function(e){this._list.mouseHandler=e}},{key:"renderHandler",get:function(){return this._renderHandler},set:function(e){this._renderHandler=e}},{key:"spaceLeft",get:function(){return this._spaceLeft},set:function(e){this._spaceLeft=e}},{key:"spaceBottom",get:function(){return this._list.spaceY},set:function(e){this._list.spaceY=e}},{key:"selectedIndex",get:function(){return this._list.selectedIndex},set:function(e){this._list.selectedIndex=e}},{key:"selectedItem",get:function(){return this._list.selectedItem},set:function(e){this._list.selectedItem=e}},{key:"width",set:function(e){s(z(n.prototype),"width",e,this,!0),this._list.width=e},get:function(){return G(z(n.prototype),"width",this)}},{key:"height",set:function(e){s(z(n.prototype),"height",e,this,!0),this._list.height=e},get:function(){return G(z(n.prototype),"height",this)}},{key:"dataSource",set:function(e){this._dataSource=e,s(z(n.prototype),"dataSource",e,this,!0)},get:function(){return G(z(n.prototype),"dataSource",this)}},{key:"xml",set:function(e){var t=[];this.parseXml(e.childNodes[0],t,null,!0),this.array=t}},{key:"selectedPath",get:function(){return this._list.selectedItem?this._list.selectedItem.path:null}}]),n}();M.regClass(Wo),Dt.regClass("laya.ui.Tree",Wo),Dt.regClass("Laya.Tree",Wo);var jo=function(){T(n,To);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments))._space=0,e._align="none",e._itemChanged=!1,e}return C(n,[{key:"addChild",value:function(e){return e.on(Je.RESIZE,this,this.onResize),this._setItemChanged(),G(z(n.prototype),"addChild",this).call(this,e)}},{key:"onResize",value:function(e){this._setItemChanged()}},{key:"addChildAt",value:function(e,t){return e.on(Je.RESIZE,this,this.onResize),this._setItemChanged(),G(z(n.prototype),"addChildAt",this).call(this,e,t)}},{key:"removeChildAt",value:function(e){return this.getChildAt(e).off(Je.RESIZE,this,this.onResize),this._setItemChanged(),G(z(n.prototype),"removeChildAt",this).call(this,e)}},{key:"refresh",value:function(){this._setItemChanged()}},{key:"changeItems",value:function(){this._itemChanged=!1}},{key:"sortItem",value:function(e){e&&e.sort(function(e,t){return e.y-t.y})}},{key:"_setItemChanged",value:function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))}},{key:"space",get:function(){return this._space},set:function(e){this._space=e,this._setItemChanged()}},{key:"align",get:function(){return this._align},set:function(e){this._align=e,this._setItemChanged()}}]),n}();M.regClass(jo),Dt.regClass("laya.ui.LayoutBox",jo),Dt.regClass("Laya.LayoutBox",jo);var qo=function(){T(o,jo);var e=b(o);function o(){return S(this,o),e.apply(this,arguments)}return C(o,[{key:"sortItem",value:function(e){e&&e.sort(function(e,t){return e.x-t.x})}},{key:"changeItems",value:function(){this._itemChanged=!1;for(var e=[],t=0,n=0,i=this.numChildren;n<i;n++){var a=this.getChildAt(n);a&&(e.push(a),t=this._height||Math.max(t,a.height*a.scaleY))}this.sortItem(e);for(var r=0,n=0,i=e.length;n<i;n++)(a=e[n]).x=r,r+=a.width*a.scaleX+this._space,this._align==o.TOP?a.y=0:this._align==o.MIDDLE?a.y=.5*(t-a.height*a.scaleY):this._align==o.BOTTOM&&(a.y=t-a.height*a.scaleY);this._sizeChanged()}},{key:"height",set:function(e){this._height!=e&&(s(z(o.prototype),"height",e,this,!0),this.callLater(this.changeItems))},get:function(){return G(z(o.prototype),"height",this)}}]),o}();qo.NONE="none",qo.TOP="top",qo.MIDDLE="middle",qo.BOTTOM="bottom",M.regClass(qo),Dt.regClass("laya.ui.HBox",qo),Dt.regClass("Laya.HBox",qo);var Zo=function(){T(o,jo);var e=b(o);function o(){return S(this,o),e.apply(this,arguments)}return C(o,[{key:"changeItems",value:function(){this._itemChanged=!1;for(var e=[],t=0,n=0,i=this.numChildren;n<i;n++){var a=this.getChildAt(n);a&&(e.push(a),t=this._width||Math.max(t,a.width*a.scaleX))}this.sortItem(e);for(var r=0,n=0,i=e.length;n<i;n++)(a=e[n]).y=r,r+=a.height*a.scaleY+this._space,this._align==o.LEFT?a.x=0:this._align==o.CENTER?a.x=.5*(t-a.width*a.scaleX):this._align==o.RIGHT&&(a.x=t-a.width*a.scaleX);this._sizeChanged()}},{key:"width",set:function(e){this._width!=e&&(s(z(o.prototype),"width",e,this,!0),this.callLater(this.changeItems))},get:function(){return G(z(o.prototype),"width",this)}}]),o}();Zo.NONE="none",Zo.LEFT="left",Zo.CENTER="center",Zo.RIGHT="right",M.regClass(Zo),Dt.regClass("laya.ui.VBox",Zo),Dt.regClass("Laya.VBox",Zo);var Ko=function(){T(a,ta);var i=b(a);function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return S(this,a),(e=i.call(this))._valueArr="",e._indexMap=null,e._sheet=null,e._direction="horizontal",e._spaceX=0,e._spaceY=0,e._align="left",e._wordsW=0,e._wordsH=0,t&&(e.skin=t),n&&(e.sheet=n),e}return C(a,[{key:"createChildren",value:function(){this._bitmap=new _i,this.on(Je.LOADED,this,this._onClipLoaded)}},{key:"_onClipLoaded",value:function(){this.callLater(this.changeValue)}},{key:"changeValue",value:function(){var e;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),e=this._sources[0]))){var t="horizontal"===this._direction;t?(this._wordsW=this._valueArr.length*(e.sourceWidth+this.spaceX),this._wordsH=e.sourceHeight):(this._wordsW=e.sourceWidth,this._wordsH=(e.sourceHeight+this.spaceY)*this._valueArr.length);var n=0;if(this._width)switch(this._align){case"center":n=.5*(this._width-this._wordsW);break;case"right":n=this._width-this._wordsW;break;default:n=0}for(var i=0,a=this._valueArr.length;i<a;i++){var r=this._indexMap[this._valueArr.charAt(i)];this.sources[r]&&(e=this.sources[r],t?this.graphics.drawImage(e,n+i*(e.sourceWidth+this.spaceX),0,e.sourceWidth,e.sourceHeight):this.graphics.drawImage(e,0+n,i*(e.sourceHeight+this.spaceY),e.sourceWidth,e.sourceHeight))}this._width||(this._widget.resetLayoutX(),this.callLater(this._sizeChanged)),this._height||(this._widget.resetLayoutY(),this.callLater(this._sizeChanged))}}},{key:"measureWidth",value:function(){return this._wordsW}},{key:"measureHeight",value:function(){return this._wordsH}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off(Je.LOADED,this,this._onClipLoaded),G(z(a.prototype),"destroy",this).call(this,e)}},{key:"sheet",get:function(){return this._sheet},set:function(e){e+="";var t=(this._sheet=e).split(" ");this._clipX=String(t[0]).length,this.clipY=t.length,this._indexMap={};for(var n=0;n<this._clipY;n++)for(var i=t[n].split(""),a=0,r=i.length;a<r;a++)this._indexMap[i[a]]=n*this._clipX+a}},{key:"value",get:function(){return this._valueArr||""},set:function(e){e+="",this._valueArr=e,this.callLater(this.changeValue)}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=e,this.callLater(this.changeValue)}},{key:"spaceX",get:function(){return this._spaceX},set:function(e){this._spaceX=e,"horizontal"===this._direction&&this.callLater(this.changeValue)}},{key:"spaceY",get:function(){return this._spaceY},set:function(e){this._spaceY=e,"horizontal"!==this._direction&&this.callLater(this.changeValue)}},{key:"align",set:function(e){this._align=e,this.callLater(this.changeValue)},get:function(){return this._align}},{key:"width",set:function(e){s(z(a.prototype),"width",e,this,!0),this.callLater(this.changeValue)},get:function(){return G(z(a.prototype),"width",this)}},{key:"height",set:function(e){s(z(a.prototype),"height",e,this,!0),this.callLater(this.changeValue)},get:function(){return G(z(a.prototype),"height",this)}}]),a}();M.regClass(Ko),Dt.regClass("laya.ui.FontClip",Ko),Dt.regClass("Laya.FontClip",Ko);var Qo=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this,!1))._watchMap={},e._anchorX=NaN,e._anchorY=NaN,e._widget=fi.EMPTY,e.createChildren(),e}return C(n,[{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._watchMap=null,G(z(n.prototype),"destroy",this).call(this,e)}},{key:"changeData",value:function(e){var t=this._watchMap[e];if(t)for(var n=0,i=t.length;n<i;n++)t[n].exe(this)}},{key:"_sizeChanged",value:function(){isNaN(this._anchorX)||(this.pivotX=this.anchorX*this.width),isNaN(this._anchorY)||(this.pivotY=this.anchorY*this.height),this.event(Je.RESIZE)}},{key:"_getWidget",value:function(){return this._widget===fi.EMPTY&&(this._widget=this.addComponent(fi)),this._widget}},{key:"loadUI",value:function(e){e=n.uiMap[e];n.uiMap&&this.createView(e)}},{key:"top",get:function(){return this._widget.top},set:function(e){e!=this._widget.top&&(this._getWidget().top=e)}},{key:"bottom",get:function(){return this._widget.bottom},set:function(e){e!=this._widget.bottom&&(this._getWidget().bottom=e)}},{key:"left",get:function(){return this._widget.left},set:function(e){e!=this._widget.left&&(this._getWidget().left=e)}},{key:"right",get:function(){return this._widget.right},set:function(e){e!=this._widget.right&&(this._getWidget().right=e)}},{key:"centerX",get:function(){return this._widget.centerX},set:function(e){e!=this._widget.centerX&&(this._getWidget().centerX=e)}},{key:"centerY",get:function(){return this._widget.centerY},set:function(e){e!=this._widget.centerY&&(this._getWidget().centerY=e)}},{key:"anchorX",get:function(){return this._anchorX},set:function(e){this._anchorX!=e&&(this._anchorX=e,this.callLater(this._sizeChanged))}},{key:"anchorY",get:function(){return this._anchorY},set:function(e){this._anchorY!=e&&(this._anchorY=e,this.callLater(this._sizeChanged))}},{key:"dataSource",get:function(){return this._dataSource},set:function(e){for(var t in this._dataSource=e){var n=this.getChildByName(t);n instanceof vi?n.dataSource=e[t]:t in this&&!(this[t]instanceof Function)&&(this[t]=e[t])}}}],[{key:"__init__",value:function(){M.ClassUtils.regShortClassName([Co,Eo,Bo,Vo,To,Uo,Mo,ta,Go,vi,Fo,Xo,pi,mr,zo,Ho,bo,So,No,Oo,Do,Ro,Ao,n,Po,Yo,Wo,qo,Zo,oo,Ut,Ko])}},{key:"regComponent",value:function(e,t){M.ClassUtils.regClass(e,t)}},{key:"regViewRuntime",value:function(e,t){M.ClassUtils.regClass(e,t)}},{key:"regUI",value:function(e,t){M.loader.cacheRes(e,t)}}]),n}();function Jo(){S(this,Jo)}Qo.uiMap={},M.regClass(Qo),Dt.regClass("laya.ui.View",Qo),Dt.regClass("Laya.View",Qo),Jo.Dialog=null;var $o=function(){T(n,Bt);var e=b(n);function n(){var t;return S(this,n),(t=e.call(this)).maskLayer=new Bt,t.popupEffect=function(e){e.scale(1,1),e._effectTween=pn.from(e,{x:M.stage.width/2,y:M.stage.height/2,scaleX:0,scaleY:0},300,_n.backOut,F.create(u(t),t.doOpen,[e]),0,!1,!1)},t.closeEffect=function(e){e._effectTween=pn.to(e,{x:M.stage.width/2,y:M.stage.height/2,scaleX:0,scaleY:0},300,_n.strongOut,F.create(u(t),t.doClose,[e]),0,!1,!1)},t.popupEffectHandler=new F(u(t),t.popupEffect),t.closeEffectHandler=new F(u(t),t.closeEffect),t.mouseEnabled=t.maskLayer.mouseEnabled=!0,t.zOrder=1e3,M.stage.addChild(u(t)),M.stage.on(Je.RESIZE,u(t),t._onResize),Lo.closeDialogOnSide&&t.maskLayer.on("click",u(t),t._closeOnSide),t._onResize(null),t}return C(n,[{key:"_closeOnSide",value:function(){var e=this.getChildAt(this.numChildren-1);e instanceof Jo.Dialog&&e.closeDialogOnSide&&e.close()}},{key:"setLockView",value:function(e){this.lockLayer||(this.lockLayer=new To,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(M.stage.width,M.stage.height)),this.lockLayer.removeChildren(),e&&(e.centerX=e.centerY=0,this.lockLayer.addChild(e))}},{key:"_onResize",value:function(){var e=this.maskLayer.width=M.stage.width,t=this.maskLayer.height=M.stage.height;this.lockLayer&&this.lockLayer.size(e,t),this.maskLayer.graphics.clear(!0),this.maskLayer.graphics.drawRect(0,0,e,t,Lo.popupBgColor),this.maskLayer.alpha=Lo.popupBgAlpha;for(var n=this.numChildren-1;-1<n;n--){var i=this.getChildAt(n);i.isPopupCenter&&this._centerDialog(i)}}},{key:"_centerDialog",value:function(e){e.x=Math.round((M.stage.width-e.width>>1)+e.pivotX),e.y=Math.round((M.stage.height-e.height>>1)+e.pivotY)}},{key:"open",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];t&&this._closeAll(),this._clearDialogEffect(e),e.isPopupCenter&&this._centerDialog(e),this.addChild(e),(e.isModal||this._getBit(It.HAS_ZORDER))&&M.timer.callLater(this,this._checkMask),n&&null!=e.popupEffect?e.popupEffect.runWith(e):this.doOpen(e),this.event(Je.OPEN)}},{key:"_clearDialogEffect",value:function(e){e._effectTween&&(pn.clear(e._effectTween),e._effectTween=null)}},{key:"doOpen",value:function(e){e.onOpened(e._param)}},{key:"lock",value:function(e){this.lockLayer&&(e?this.addChild(this.lockLayer):this.lockLayer.removeSelf())}},{key:"close",value:function(e){this._clearDialogEffect(e),e.isShowEffect&&null!=e.closeEffect?e.closeEffect.runWith([e]):this.doClose(e),this.event(Je.CLOSE)}},{key:"doClose",value:function(e){e.removeSelf(),e.isModal&&this._checkMask(),e.closeHandler&&e.closeHandler.runWith(e.closeType),e.onClosed(e.closeType),e.autoDestroyAtClosed&&e.destroy()}},{key:"closeAll",value:function(){this._closeAll(),this.event(Je.CLOSE)}},{key:"_closeAll",value:function(){for(var e=this.numChildren-1;-1<e;e--){var t=this.getChildAt(e);t&&null!=t.close&&this.doClose(t)}}},{key:"getDialogsByGroup",value:function(e){for(var t=[],n=this.numChildren-1;-1<n;n--){var i=this.getChildAt(n);i&&i.group===e&&t.push(i)}return t}},{key:"closeByGroup",value:function(e){for(var t=[],n=this.numChildren-1;-1<n;n--){var i=this.getChildAt(n);i&&i.group===e&&(i.close(),t.push(i))}return t}},{key:"_checkMask",value:function(){this.maskLayer.removeSelf();for(var e=this.numChildren-1;-1<e;e--){var t=this.getChildAt(e);if(t&&t.isModal)return void this.addChildAt(this.maskLayer,e)}}}]),n}();Dt.regClass("laya.ui.DialogManager",$o),Dt.regClass("Laya.DialogManager",$o);var es=function(){T(i,Qo);var t=b(i);function i(){var e;return S(this,i),(e=t.call(this)).isShowEffect=!0,e.isPopupCenter=!0,e.closeDialogOnSide=!0,e.popupEffect=i.manager.popupEffectHandler,e.closeEffect=i.manager.closeEffectHandler,e._dealDragArea(),e.on(Je.CLICK,u(e),e._onClick),e}return C(i,[{key:"_dealDragArea",value:function(){var e=this.getChildByName("drag");e&&(this.dragArea=e._x+","+e._y+","+e.width+","+e.height,e.removeSelf())}},{key:"_onMouseDown",value:function(e){var t=this.getMousePoint();this._dragArea.contains(t.x,t.y)?this.startDrag():this.stopDrag()}},{key:"_onClick",value:function(e){var t=e.target;if(t)switch(t.name){case i.CLOSE:case i.CANCEL:case i.SURE:case i.NO:case i.OK:case i.YES:return void this.close(t.name)}}},{key:"open",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._dealDragArea(),this._param=t,i.manager.open(this,e,this.isShowEffect),i.manager.lock(!1)}},{key:"close",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.closeType=e,i.manager.close(this)}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this._dragArea=null,G(z(i.prototype),"destroy",this).call(this,e)}},{key:"show",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._open(!1,e,t)}},{key:"popup",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._open(!0,e,t)}},{key:"_open",value:function(e,t,n){this.isModal=e,this.isShowEffect=n,i.manager.lock(!0),this.open(t)}},{key:"dragArea",get:function(){return this._dragArea?this._dragArea.toString():null},set:function(e){e?(e=yi.fillArray([0,0,0,0],e,Number),this._dragArea=new O(e[0],e[1],e[2],e[3]),this.on(Je.MOUSE_DOWN,this,this._onMouseDown)):(this._dragArea=null,this.off(Je.MOUSE_DOWN,this,this._onMouseDown))}},{key:"isPopup",get:function(){return null!=this.parent}},{key:"zOrder",set:function(e){s(z(i.prototype),"zOrder",e,this,!0),i.manager._checkMask()},get:function(){return G(z(i.prototype),"zOrder",this)}}],[{key:"setLockView",value:function(e){i.manager.setLockView(e)}},{key:"lock",value:function(e){i.manager.lock(e)}},{key:"closeAll",value:function(){i.manager.closeAll()}},{key:"getDialogsByGroup",value:function(e){return i.manager.getDialogsByGroup(e)}},{key:"closeByGroup",value:function(e){return i.manager.closeByGroup(e)}},{key:"manager",get:function(){return i._manager=i._manager||new $o},set:function(e){i._manager=e}}]),i}();es.CLOSE="close",es.CANCEL="cancel",es.SURE="sure",es.NO="no",es.YES="yes",es.OK="ok",Jo.Dialog=es,M.regClass(es),Dt.regClass("laya.ui.Dialog",es),Dt.regClass("Laya.Dialog",es);var ts,ns,e=Dt.regClass;ns=ts=ts||{},ns=(bi=ns.fishdld||(ns.fishdld={})).animation||(bi.animation={}),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{y:200,x:300,anchorY:.5,anchorX:.5},compId:2,child:[{type:"Image",props:{},compId:31},{type:"Image",props:{},compId:32},{type:"Image",props:{},compId:33},{type:"Image",props:{},compId:34},{type:"Image",props:{},compId:35}],animations:[{nodes:[{target:31,keyframes:{y:[{value:66,tweenMethod:"linearNone",tween:!0,target:31,key:"y",index:0},{value:43,tweenMethod:"linearNone",tween:!0,target:31,key:"y",index:1}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:31,key:"x",index:0}],width:[{value:68,tweenMethod:"linearNone",tween:!0,target:31,key:"width",index:0}],skin:[{value:"fishdld/animation/coin/04.png",tweenMethod:"linearNone",tween:!1,target:31,key:"skin",index:0}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:31,key:"scaleY",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:31,key:"scaleY",index:1}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:31,key:"scaleX",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:31,key:"scaleX",index:1}],pivotY:[{value:34,tweenMethod:"linearNone",tween:!0,target:31,key:"pivotY",index:0}],pivotX:[{value:34,tweenMethod:"linearNone",tween:!0,target:31,key:"pivotX",index:0}],height:[{value:68,tweenMethod:"linearNone",tween:!0,target:31,key:"height",index:0}],alpha:[{value:.6,tweenMethod:"linearNone",tween:!0,target:31,key:"alpha",index:0},{value:.75,tweenMethod:"linearNone",tween:!0,target:31,key:"alpha",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:31,key:"alpha",index:2}]}},{target:32,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:32,key:"y",index:0},{value:11,tweenMethod:"linearNone",tween:!0,target:32,key:"y",index:2},{value:-21,tweenMethod:"linearNone",tween:!0,target:32,key:"y",index:3}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:32,key:"x",index:0}],width:[{value:68,tweenMethod:"linearNone",tween:!0,target:32,key:"width",index:0}],skin:[{value:"fishdld/animation/coin/03.png",tweenMethod:"linearNone",tween:!1,target:32,key:"skin",index:0}],scaleY:[{value:.7,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleY",index:0},{value:.7,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleY",index:2},{value:.85,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleY",index:3},{value:.75,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleY",index:4}],scaleX:[{value:.7,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleX",index:0},{value:.7,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleX",index:2},{value:.85,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleX",index:3},{value:.75,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleX",index:4}],pivotY:[{value:34,tweenMethod:"linearNone",tween:!0,target:32,key:"pivotY",index:0}],pivotX:[{value:34,tweenMethod:"linearNone",tween:!0,target:32,key:"pivotX",index:0}],height:[{value:68,tweenMethod:"linearNone",tween:!0,target:32,key:"height",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:32,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:32,key:"alpha",index:1},{value:.7,tweenMethod:"linearNone",tween:!0,target:32,key:"alpha",index:2},{value:.8,tweenMethod:"linearNone",tween:!0,target:32,key:"alpha",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:32,key:"alpha",index:4}]}},{target:33,keyframes:{y:[{value:-49,tweenMethod:"linearNone",tween:!0,target:33,key:"y",index:0},{value:-49,tweenMethod:"linearNone",tween:!0,target:33,key:"y",index:3},{value:-58,tweenMethod:"linearNone",tween:!0,target:33,key:"y",index:5}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:33,key:"x",index:0}],width:[{value:68,tweenMethod:"linearNone",tween:!0,target:33,key:"width",index:0}],skin:[{value:"fishdld/animation/coin/02.png",tweenMethod:"linearNone",tween:!1,target:33,key:"skin",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleY",index:0},{value:.96,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleY",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleY",index:5}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleX",index:0},{value:.96,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleX",index:5}],pivotY:[{value:34,tweenMethod:"linearNone",tween:!0,target:33,key:"pivotY",index:0}],pivotX:[{value:34,tweenMethod:"linearNone",tween:!0,target:33,key:"pivotX",index:0}],height:[{value:68,tweenMethod:"linearNone",tween:!0,target:33,key:"height",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:33,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:33,key:"alpha",index:3},{value:.9,tweenMethod:"linearNone",tween:!0,target:33,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"alpha",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:33,key:"alpha",index:6}]}},{target:34,keyframes:{y:[{value:-22,tweenMethod:"linearNone",tween:!0,target:34,key:"y",index:0},{value:-23,tweenMethod:"linearNone",tween:!0,target:34,key:"y",index:6},{value:10,tweenMethod:"linearNone",tween:!0,target:34,key:"y",index:7}],x:[{value:1,tweenMethod:"linearNone",tween:!0,target:34,key:"x",index:0}],width:[{value:68,tweenMethod:"linearNone",tween:!0,target:34,key:"width",index:0}],skin:[{value:"fishdld/animation/coin/01.png",tweenMethod:"linearNone",tween:!1,target:34,key:"skin",index:0}],pivotY:[{value:34,tweenMethod:"linearNone",tween:!0,target:34,key:"pivotY",index:0}],pivotX:[{value:34,tweenMethod:"linearNone",tween:!0,target:34,key:"pivotX",index:0}],height:[{value:68,tweenMethod:"linearNone",tween:!0,target:34,key:"height",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:34,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:34,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:34,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:34,key:"alpha",index:7},{value:0,tweenMethod:"linearNone",tween:!0,target:34,key:"alpha",index:8}]}},{target:35,keyframes:{y:[{value:-1,tweenMethod:"linearNone",tween:!0,target:35,key:"y",index:0},{value:-2,tweenMethod:"linearNone",tween:!0,target:35,key:"y",index:8},{value:-6,tweenMethod:"linearNone",tween:!0,target:35,key:"y",index:9},{value:0,tweenMethod:"linearNone",tween:!0,target:35,key:"y",index:11}],x:[{value:1,tweenMethod:"linearNone",tween:!0,target:35,key:"x",index:0}],width:[{value:68,tweenMethod:"linearNone",tween:!0,target:35,key:"width",index:0}],skin:[{value:"fishdld/animation/coin/00.png",tweenMethod:"linearNone",tween:!1,target:35,key:"skin",index:0}],pivotY:[{value:34,tweenMethod:"linearNone",tween:!0,target:35,key:"pivotY",index:0}],pivotX:[{value:34,tweenMethod:"linearNone",tween:!0,target:35,key:"pivotX",index:0}],height:[{value:68,tweenMethod:"linearNone",tween:!0,target:35,key:"height",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:35,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:35,key:"alpha",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:35,key:"alpha",index:8}]}}],name:"ani",id:1,frameRate:21,action:0}],loadList:["fishdld/animation/coin/04.png","fishdld/animation/coin/03.png","fishdld/animation/coin/02.png","fishdld/animation/coin/01.png","fishdld/animation/coin/00.png"],loadList3D:[]},ns.coin_rotationUI=bi,e("ui.fishdld.animation.coin_rotationUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,To,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Box",props:{name:"pos"},compId:6,child:[{type:"Image",props:{y:0,x:0,width:885,skin:"fishdld/animation/aniui/fish_array_coming/img_dldby_yuzhenchuchang_uibg.png",pivotY:77,pivotX:443,name:"bg",height:153},compId:3},{type:"Image",props:{y:0,x:0,width:687,skin:"fishdld/animation/aniui/fish_array_coming/img_dldby_yuzhenchuchang_uinb2.png",pivotY:57,pivotX:344,name:"nb2",height:113},compId:5},{type:"Image",props:{y:0,x:0,width:512,skin:"fishdld/animation/aniui/fish_array_coming/img_dldby_yuzhenchuchang_uinb1.png",pivotY:58,pivotX:256,name:"nb1",height:116},compId:4}]}],animations:[{nodes:[{target:4,keyframes:{alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:7}]}},{target:5,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:7}]}}],name:"ani1",id:1,frameRate:24,action:0},{nodes:[{target:4,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"alpha",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"alpha",index:7}]}},{target:5,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"alpha",index:4},{value:0,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"alpha",index:7}]}}],name:"ani2",id:2,frameRate:24,action:0}],loadList:["fishdld/animation/aniui/fish_array_coming/img_dldby_yuzhenchuchang_uibg.png","fishdld/animation/aniui/fish_array_coming/img_dldby_yuzhenchuchang_uinb2.png","fishdld/animation/aniui/fish_array_coming/img_dldby_yuzhenchuchang_uinb1.png"],loadList3D:[]},ns.dldby_array_comingUI=bi,e("ui.fishdld.animation.dldby_array_comingUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:2,x:0,width:50,skin:"fishdld/animation/anibullet/bullet_6/img_bullet601.png",rotation:90,pivotY:25,pivotX:25,height:159},compId:3}],animations:[{nodes:[{target:3,keyframes:{skin:[{value:"fishdld/animation/anibullet/bullet_6/img_bullet601.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:0},{value:"fishdld/animation/anibullet/bullet_6/img_bullet602.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:1},{value:"fishdld/animation/anibullet/bullet_6/img_bullet603.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:2},{value:"fishdld/animation/anibullet/bullet_6/img_bullet604.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:3},{value:"fishdld/animation/anibullet/bullet_6/img_bullet605.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:4},{value:"fishdld/animation/anibullet/bullet_6/img_bullet606.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:5},{value:"fishdld/animation/anibullet/bullet_6/img_bullet607.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:6},{value:"fishdld/animation/anibullet/bullet_6/img_bullet608.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:7}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anibullet/bullet_6/img_bullet601.png","fishdld/animation/anibullet/bullet_6/img_bullet602.png","fishdld/animation/anibullet/bullet_6/img_bullet603.png","fishdld/animation/anibullet/bullet_6/img_bullet604.png","fishdld/animation/anibullet/bullet_6/img_bullet605.png","fishdld/animation/anibullet/bullet_6/img_bullet606.png","fishdld/animation/anibullet/bullet_6/img_bullet607.png","fishdld/animation/anibullet/bullet_6/img_bullet608.png"],loadList3D:[]},ns.Dldby_bullet_6UI=bi,e("ui.fishdld.animation.Dldby_bullet_6UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:0,x:122,width:65,skin:"fishdld/animation/anibullet/bullet_7/img_bullet_bg.png",scaleY:7.8,scaleX:7.2,rotation:90,pivotY:167,pivotX:33,name:"bulet_bg",height:194,alpha:1},compId:6},{type:"Image",props:{y:0,x:0,width:512,visible:!0,skin:"fishdld/animation/anibullet/bullet_7/img_bullet724.png",scaleY:3.5,scaleX:6,rotation:90,pivotY:457,pivotX:247,height:512,blendMode:"lighter"},compId:3}],animations:[{nodes:[{target:3,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:1},{value:!1,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:37}],skin:[{value:"fishdld/animation/anibullet/bullet_7/img_bullet700.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:0},{value:"fishdld/animation/anibullet/bullet_7/img_bullet700.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:1},{value:"fishdld/animation/anibullet/bullet_7/img_bullet701.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:2},{value:"fishdld/animation/anibullet/bullet_7/img_bullet702.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:7},{value:"fishdld/animation/anibullet/bullet_7/img_bullet703.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:8},{value:"fishdld/animation/anibullet/bullet_7/img_bullet704.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:9},{value:"fishdld/animation/anibullet/bullet_7/img_bullet705.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:10},{value:"fishdld/animation/anibullet/bullet_7/img_bullet706.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:11},{value:"fishdld/animation/anibullet/bullet_7/img_bullet707.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:12},{value:"fishdld/animation/anibullet/bullet_7/img_bullet708.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:13},{value:"fishdld/animation/anibullet/bullet_7/img_bullet709.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:14},{value:"fishdld/animation/anibullet/bullet_7/img_bullet710.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:15},{value:"fishdld/animation/anibullet/bullet_7/img_bullet711.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:16},{value:"fishdld/animation/anibullet/bullet_7/img_bullet712.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:17},{value:"fishdld/animation/anibullet/bullet_7/img_bullet713.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:18},{value:"fishdld/animation/anibullet/bullet_7/img_bullet714.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:19},{value:"fishdld/animation/anibullet/bullet_7/img_bullet715.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:20},{value:"fishdld/animation/anibullet/bullet_7/img_bullet716.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:21},{value:"fishdld/animation/anibullet/bullet_7/img_bullet717.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:22},{value:"fishdld/animation/anibullet/bullet_7/img_bullet718.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:23},{value:"fishdld/animation/anibullet/bullet_7/img_bullet719.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:24},{value:"fishdld/animation/anibullet/bullet_7/img_bullet720.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:25},{value:"fishdld/animation/anibullet/bullet_7/img_bullet721.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:26},{value:"fishdld/animation/anibullet/bullet_7/img_bullet722.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:27},{value:"fishdld/animation/anibullet/bullet_7/img_bullet723.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:28},{value:"fishdld/animation/anibullet/bullet_7/img_bullet724.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:29},{value:"fishdld/animation/anibullet/bullet_7/img_bullet725.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:30},{value:"fishdld/animation/anibullet/bullet_7/img_bullet726.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:31},{value:"fishdld/animation/anibullet/bullet_7/img_bullet727.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:32},{value:"fishdld/animation/anibullet/bullet_7/img_bullet728.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:33},{value:"fishdld/animation/anibullet/bullet_7/img_bullet729.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:34},{value:"fishdld/animation/anibullet/bullet_7/img_bullet730.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:35},{value:"fishdld/animation/anibullet/bullet_7/img_bullet731.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:36}]}},{target:2,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:2},{value:.5,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:5},{value:.9,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleY",index:7}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:0},{value:.9,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:2},{value:.9,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:5},{value:.9,tweenMethod:"linearNone",tween:!0,target:2,key:"scaleX",index:7}]}},{target:6,keyframes:{x:[{value:122,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0}],scaleX:[{value:7.2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0},{value:4.1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:13},{value:10,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:15},{value:10,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:26},{value:5.3999999999999995,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:29},{value:1.6999999999999993,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:37}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:7},{value:.4,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:15},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"alpha",index:26},{value:.5,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:29},{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:37}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anibullet/bullet_7/img_bullet_bg.png","fishdld/animation/anibullet/bullet_7/img_bullet724.png","fishdld/animation/anibullet/bullet_7/img_bullet700.png","fishdld/animation/anibullet/bullet_7/img_bullet701.png","fishdld/animation/anibullet/bullet_7/img_bullet702.png","fishdld/animation/anibullet/bullet_7/img_bullet703.png","fishdld/animation/anibullet/bullet_7/img_bullet704.png","fishdld/animation/anibullet/bullet_7/img_bullet705.png","fishdld/animation/anibullet/bullet_7/img_bullet706.png","fishdld/animation/anibullet/bullet_7/img_bullet707.png","fishdld/animation/anibullet/bullet_7/img_bullet708.png","fishdld/animation/anibullet/bullet_7/img_bullet709.png","fishdld/animation/anibullet/bullet_7/img_bullet710.png","fishdld/animation/anibullet/bullet_7/img_bullet711.png","fishdld/animation/anibullet/bullet_7/img_bullet712.png","fishdld/animation/anibullet/bullet_7/img_bullet713.png","fishdld/animation/anibullet/bullet_7/img_bullet714.png","fishdld/animation/anibullet/bullet_7/img_bullet715.png","fishdld/animation/anibullet/bullet_7/img_bullet716.png","fishdld/animation/anibullet/bullet_7/img_bullet717.png","fishdld/animation/anibullet/bullet_7/img_bullet718.png","fishdld/animation/anibullet/bullet_7/img_bullet719.png","fishdld/animation/anibullet/bullet_7/img_bullet720.png","fishdld/animation/anibullet/bullet_7/img_bullet721.png","fishdld/animation/anibullet/bullet_7/img_bullet722.png","fishdld/animation/anibullet/bullet_7/img_bullet723.png","fishdld/animation/anibullet/bullet_7/img_bullet725.png","fishdld/animation/anibullet/bullet_7/img_bullet726.png","fishdld/animation/anibullet/bullet_7/img_bullet727.png","fishdld/animation/anibullet/bullet_7/img_bullet728.png","fishdld/animation/anibullet/bullet_7/img_bullet729.png","fishdld/animation/anibullet/bullet_7/img_bullet730.png","fishdld/animation/anibullet/bullet_7/img_bullet731.png"],loadList3D:[]},ns.Dldby_bullet_7UI=bi,e("ui.fishdld.animation.Dldby_bullet_7UI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{},compId:2,child:[{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aniui/big_bg/img_add430_guang.png",scaleY:7,scaleX:7,name:"add430guang",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:14},{type:"Image",props:{y:0,x:0,width:124,skin:"fishdld/animation/aniui/big_bg/img_add429.png",name:"add429",height:124,blendMode:"lighter",anchorY:.5,anchorX:.5},compId:4},{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aniui/big_bg/img_addsg.png",name:"addsg",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:5},{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aniui/big_bg/img_add430_st.png",scaleY:.5,scaleX:.5,name:"add430st",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:8},{type:"Image",props:{y:-89,x:62,skin:"fishdld/animation/anigun/gun6/img_gun6_xin xin.png",rotation:45,name:"xing",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:9},{type:"Image",props:{y:-78,x:-64,skin:"fishdld/animation/anigun/gun6/img_gun6_xin xin.png",rotation:45,name:"xing",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:10},{type:"Image",props:{y:39,x:-66,skin:"fishdld/animation/anigun/gun6/img_gun6_xin xin.png",rotation:45,name:"xing",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:11},{type:"Image",props:{y:85,x:28,skin:"fishdld/animation/anigun/gun6/img_gun6_xin xin.png",rotation:45,name:"xing",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:12},{type:"Image",props:{y:-14,x:79,skin:"fishdld/animation/anigun/gun6/img_gun6_xin xin.png",rotation:45,name:"xing",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:13},{type:"Image",props:{y:0,x:0,width:124,skin:"fishdld/animation/aniui/big_bg/img_add429.png",name:"add429",height:124,blendMode:"lighter",anchorY:.5,anchorX:.5},compId:15}],animations:[{nodes:[{target:14,keyframes:{alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:12}]}},{target:4,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0},{value:3,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:9}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0},{value:3,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:9}],alpha:[{value:.7,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:9}]}},{target:5,keyframes:{scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:7},{value:2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:24}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:7},{value:2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:24}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0},{value:20,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:24}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:24}]}},{target:9,keyframes:{y:[{value:-89,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:0},{value:-89,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"y",index:20},{value:-100,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:30}],x:[{value:62,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:0},{value:62,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:20},{value:79,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:30}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleY",index:20},{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleY",index:30}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleX",index:20},{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"scaleX",index:30}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:20},{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:24},{value:1,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"alpha",index:26},{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:30}]}},{target:10,keyframes:{y:[{value:-78,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:0},{value:-78,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"y",index:21},{value:-89,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:31}],x:[{value:-64,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0},{value:-64,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:21},{value:-73.5,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:31}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleY",index:21},{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleY",index:31}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleX",index:21},{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleX",index:31}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:21},{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:25},{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:27},{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:31}]}},{target:11,keyframes:{y:[{value:39,tweenMethod:"linearNone",tween:!0,target:11,key:"y",index:0},{value:39,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"y",index:22},{value:40,tweenMethod:"linearNone",tween:!0,target:11,key:"y",index:32}],x:[{value:-66,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:0},{value:-66,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:22},{value:-86,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:32}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleY",index:22},{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleY",index:32}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleX",index:22},{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleX",index:32}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:22},{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:26},{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:28},{value:0,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:32}]}},{target:12,keyframes:{y:[{value:85,tweenMethod:"linearNone",tween:!0,target:12,key:"y",index:0},{value:85,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"y",index:23},{value:104,tweenMethod:"linearNone",tween:!0,target:12,key:"y",index:33}],x:[{value:28,tweenMethod:"linearNone",tween:!0,target:12,key:"x",index:0},{value:28,tweenMethod:"linearNone",tween:!0,target:12,key:"x",index:23},{value:42,tweenMethod:"linearNone",tween:!0,target:12,key:"x",index:33}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:23},{value:1,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:33}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:23},{value:1,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:33}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"alpha",index:23},{value:1,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"alpha",index:26},{value:1,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"alpha",index:29},{value:0,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"alpha",index:33}]}},{target:13,keyframes:{y:[{value:-14,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:0},{value:-14,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"y",index:24},{value:-8,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:34}],x:[{value:79,tweenMethod:"linearNone",tween:!0,target:13,key:"x",index:0},{value:79,tweenMethod:"linearNone",tween:!0,target:13,key:"x",index:24},{value:91,tweenMethod:"linearNone",tween:!0,target:13,key:"x",index:34}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:24},{value:1,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:34}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:24},{value:1,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:34}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:24},{value:1,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:27},{value:1,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:29},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:34}]}},{target:8,keyframes:{scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:18},{value:.55,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:34}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:18},{value:.55,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:34}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:18},{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:21},{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:34}]}},{target:15,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:15,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:5},{value:3,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:17}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:15,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:5},{value:3,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:17}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:15,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:15,key:"alpha",index:4},{value:.7,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:17}]}}],name:"ani1",id:1,frameRate:24,action:1}],loadList:["fishdld/animation/aniui/big_bg/img_add430_guang.png","fishdld/animation/aniui/big_bg/img_add429.png","fishdld/animation/aniui/big_bg/img_addsg.png","fishdld/animation/aniui/big_bg/img_add430_st.png","fishdld/animation/anigun/gun6/img_gun6_xin xin.png"],loadList3D:[]},ns.dldby_crab_dieUI=bi,e("ui.fishdld.animation.dldby_crab_dieUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,mr,Bt,To],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:-47,x:-1,width:57,skin:"fishdld/animation/anigun/img_dldby_gun_tx1.png",pivotY:65,pivotX:29,name:"ef",height:65},compId:10},{type:"Image",props:{y:-81,x:0,width:29,skin:"fishdld/animation/anigun/img_gun_1po.png",pivotX:15,name:"po",height:43},compId:9},{type:"Image",props:{y:13,x:0,width:26,skin:"fishdld/animation/anigun/img_gun_1b.png",pivotY:17,pivotX:13,name:"b",height:17},compId:3},{type:"Image",props:{y:-58,x:0,width:36,skin:"fishdld/animation/anigun/img_gun_1f.png",pivotX:18,name:"t",height:20},compId:4},{type:"Image",props:{y:9,x:0,width:33,skin:"fishdld/animation/anigun/img_gun_1l.png",pivotY:62,pivotX:33,name:"l",height:62},compId:5},{type:"Image",props:{y:9,x:0,width:34,skin:"fishdld/animation/anigun/img_gun_1r.png",pivotY:62,name:"r",height:62},compId:6},{type:"Image",props:{y:-38,x:-1,width:41,skin:"fishdld/animation/anigun/img_gun_1t.png",pivotX:21,name:"nb",height:37},compId:7,child:[{type:"Label",props:{y:19.5,x:21.5,width:80,text:"9999",scaleY:.7,scaleX:.7,name:"cannon_level",height:26,fontSize:25,font:"fnt_gun_com",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:17}]},{type:"Sprite",props:{y:-74,x:0,name:"muzzle"},compId:15},{type:"Box",props:{y:-30.5,x:0,name:"indicator"},compId:16}],animations:[{nodes:[{target:10,keyframes:{y:[{value:-44,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:0},{value:-73,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:4}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0},{value:-5,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:4}],width:[{value:57,tweenMethod:"linearNone",tween:!0,target:10,key:"width",index:0},{value:65,tweenMethod:"linearNone",tween:!0,target:10,key:"width",index:4}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:10,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:10,key:"visible",index:1}],name:[{value:"ef",tweenMethod:"linearNone",tween:!1,target:10,key:"name",index:0}],height:[{value:65,tweenMethod:"linearNone",tween:!0,target:10,key:"height",index:0},{value:88,tweenMethod:"linearNone",tween:!0,target:10,key:"height",index:4}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:1},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:4},{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:5}]}},{target:6,keyframes:{y:[{value:9,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:0},{value:11,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:2},{value:9,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:5}],skin:[{value:"fishdld/animation/anigun/img_gun_1r.png",tweenMethod:"linearNone",tween:!1,target:6,key:"skin",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"rotation",index:0},{value:7,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"rotation",index:5}],name:[{value:"r",tweenMethod:"linearNone",tween:!1,target:6,label:null,key:"name",index:0},{value:"l",tweenMethod:"linearNone",tween:!1,target:6,label:null,key:"name",index:5}]}},{target:5,keyframes:{y:[{value:9,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:11,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:2},{value:9,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:5}],skin:[{value:"fishdld/animation/anigun/img_gun_1l.png",tweenMethod:"linearNone",tween:!1,target:5,key:"skin",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0},{value:-7,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"rotation",index:5}],name:[{value:"l",tweenMethod:"linearNone",tween:!1,target:5,key:"name",index:0},{value:"l",tweenMethod:"linearNone",tween:!1,target:5,label:null,key:"name",index:5}]}},{target:4,keyframes:{y:[{value:-58,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0},{value:-49,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:2},{value:-58,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"y",index:5}],skin:[{value:"fishdld/animation/anigun/img_gun_1f.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:0}],name:[{value:"t",tweenMethod:"linearNone",tween:!1,target:4,key:"name",index:0},{value:"t",tweenMethod:"linearNone",tween:!1,target:4,label:null,key:"name",index:5}]}},{target:9,keyframes:{y:[{value:-81,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:0},{value:-57.5,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:2},{value:-81,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"y",index:5}],skin:[{value:"fishdld/animation/anigun/img_gun_1po.png",tweenMethod:"linearNone",tween:!1,target:9,key:"skin",index:0}],name:[{value:"po",tweenMethod:"linearNone",tween:!1,target:9,key:"name",index:0},{value:"po",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"name",index:5}]}},{target:7,keyframes:{y:[{value:-38,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0},{value:-35,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:2},{value:-38,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"y",index:5}],skin:[{value:"fishdld/animation/anigun/img_gun_1t.png",tweenMethod:"linearNone",tween:!1,target:7,key:"skin",index:0}]}},{target:3,keyframes:{y:[{value:12.5,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0},{value:18,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:2},{value:12.5,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"y",index:5}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:5}],width:[{value:26,tweenMethod:"linearNone",tween:!0,target:3,key:"width",index:0},{value:26,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"width",index:5}],skin:[{value:"fishdld/animation/anigun/img_gun_1b.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:0}],pivotX:[{value:13,tweenMethod:"linearNone",tween:!0,target:3,key:"pivotX",index:0},{value:13,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"pivotX",index:5}],name:[{value:"b",tweenMethod:"linearNone",tween:!1,target:3,key:"name",index:0},{value:"b",tweenMethod:"linearNone",tween:!1,target:3,label:null,key:"name",index:5}],height:[{value:17,tweenMethod:"linearNone",tween:!0,target:3,key:"height",index:0},{value:17,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"height",index:5}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"alpha",index:5}]}}],name:"attack",id:1,frameRate:24,action:0},{nodes:[{target:10,keyframes:{y:[{value:-44,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:0}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0}],width:[{value:57,tweenMethod:"linearNone",tween:!0,target:10,key:"width",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:10,key:"visible",index:0}],name:[{value:"ef",tweenMethod:"linearNone",tween:!1,target:10,key:"name",index:0}],height:[{value:65,tweenMethod:"linearNone",tween:!0,target:10,key:"height",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:0}]}},{target:6,keyframes:{y:[{value:9,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"rotation",index:0}],name:[{value:"r",tweenMethod:"linearNone",tween:!1,target:6,label:null,key:"name",index:0}]}},{target:5,keyframes:{y:[{value:9,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0}],name:[{value:"l",tweenMethod:"linearNone",tween:!1,target:5,key:"name",index:0}]}},{target:4,keyframes:{y:[{value:-58,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0}],name:[{value:"t",tweenMethod:"linearNone",tween:!1,target:4,key:"name",index:0}]}},{target:9,keyframes:{y:[{value:-81,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:0}],name:[{value:"po",tweenMethod:"linearNone",tween:!1,target:9,key:"name",index:0}]}},{target:7,keyframes:{y:[{value:-38,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0}]}},{target:3,keyframes:{y:[{value:12.5,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"y",index:0}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:0}],width:[{value:26,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"width",index:0}],pivotX:[{value:13,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"pivotX",index:0}],name:[{value:"b",tweenMethod:"linearNone",tween:!1,target:3,label:null,key:"name",index:0}],height:[{value:17,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"height",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"alpha",index:0}]}}],name:"default",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anigun/img_dldby_gun_tx1.png","fishdld/animation/anigun/img_gun_1po.png","fishdld/animation/anigun/img_gun_1b.png","fishdld/animation/anigun/img_gun_1f.png","fishdld/animation/anigun/img_gun_1l.png","fishdld/animation/anigun/img_gun_1r.png","fishdld/animation/anigun/img_gun_1t.png"],loadList3D:[]},ns.Dldby_gun_1UI=bi,e("ui.fishdld.animation.Dldby_gun_1UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,mr,Bt,To],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:-48.5,x:-1,width:57,visible:!1,skin:"fishdld/animation/anigun/img_dldby_gun_tx1.png",pivotY:65,pivotX:29,name:"ef",height:65},compId:10},{type:"Image",props:{y:-82,x:0,width:39,skin:"fishdld/animation/anigun/img_gun_2t.png",pivotX:20,name:"po",height:51},compId:8},{type:"Image",props:{y:-56,x:-1,width:68,skin:"fishdld/animation/anigun/img_gun_2f.png",pivotX:34,name:"f",height:56},compId:4},{type:"Image",props:{y:13,x:-7,width:29,skin:"fishdld/animation/anigun/img_gun_2l.png",pivotY:41,pivotX:29,name:"l",height:41},compId:5},{type:"Image",props:{y:14,x:5,width:29,skin:"fishdld/animation/anigun/img_gun_2r.png",pivotY:41,name:"r",height:41},compId:7},{type:"Image",props:{y:20,x:-1,width:37,skin:"fishdld/animation/anigun/img_gun_2b.png",pivotY:29,pivotX:19,name:"b",height:29},compId:3},{type:"Image",props:{y:-35,x:-1,width:43,skin:"fishdld/animation/anigun/img_gun_2nb.png",pivotX:22,name:"nb",height:38},compId:6,child:[{type:"Label",props:{y:20,x:22,width:80,text:"9999",scaleY:.7,scaleX:.7,name:"cannon_level",height:26,fontSize:25,font:"fnt_gun_com",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:15}]},{type:"Sprite",props:{y:-62,x:0,name:"muzzle"},compId:13},{type:"Box",props:{y:-19,x:0,name:"indicator"},compId:14}],animations:[{nodes:[{target:10,keyframes:{y:[{value:-48.5,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:0},{value:-52.5,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:4}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0},{value:-1,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:4}],width:[{value:57,tweenMethod:"linearNone",tween:!0,target:10,key:"width",index:0},{value:70,tweenMethod:"linearNone",tween:!0,target:10,key:"width",index:4}],pivotY:[{value:65,tweenMethod:"linearNone",tween:!0,target:10,key:"pivotY",index:0},{value:87,tweenMethod:"linearNone",tween:!0,target:10,key:"pivotY",index:4}],pivotX:[{value:29,tweenMethod:"linearNone",tween:!0,target:10,key:"pivotX",index:0},{value:35,tweenMethod:"linearNone",tween:!0,target:10,key:"pivotX",index:4}],height:[{value:65,tweenMethod:"linearNone",tween:!0,target:10,key:"height",index:0},{value:87,tweenMethod:"linearNone",tween:!0,target:10,key:"height",index:4}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:4}]}},{target:8,keyframes:{y:[{value:-82,tweenMethod:"linearNone",tween:!0,target:8,key:"y",index:0},{value:-57,tweenMethod:"linearNone",tween:!0,target:8,key:"y",index:2},{value:-82,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"y",index:5}]}},{target:4,keyframes:{y:[{value:-56,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0},{value:-45,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:2},{value:-56,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"y",index:5}]}},{target:5,keyframes:{y:[{value:13,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:19,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:2},{value:13,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0},{value:-11,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"rotation",index:5}]}},{target:7,keyframes:{y:[{value:14,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0},{value:20,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:2},{value:14,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"y",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:0},{value:11,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"rotation",index:5}]}},{target:3,keyframes:{y:[{value:20,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0},{value:26,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:2},{value:20,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"y",index:5}]}},{target:6,keyframes:{y:[{value:-35,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0},{value:-30,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:2},{value:-35,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:5}]}}],name:"attack",id:1,frameRate:24,action:0},{nodes:[{target:10,keyframes:{y:[{value:-48.5,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:0}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0}],width:[{value:57,tweenMethod:"linearNone",tween:!0,target:10,key:"width",index:0}],pivotY:[{value:65,tweenMethod:"linearNone",tween:!0,target:10,key:"pivotY",index:0}],pivotX:[{value:29,tweenMethod:"linearNone",tween:!0,target:10,key:"pivotX",index:0}],height:[{value:65,tweenMethod:"linearNone",tween:!0,target:10,key:"height",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:0}]}},{target:8,keyframes:{y:[{value:-82,tweenMethod:"linearNone",tween:!0,target:8,key:"y",index:0}]}},{target:4,keyframes:{y:[{value:-56,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0}]}},{target:5,keyframes:{y:[{value:13,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0}]}},{target:7,keyframes:{y:[{value:14,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:0}]}},{target:3,keyframes:{y:[{value:20,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0}]}},{target:6,keyframes:{y:[{value:-35,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0}]}}],name:"default",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anigun/img_dldby_gun_tx1.png","fishdld/animation/anigun/img_gun_2t.png","fishdld/animation/anigun/img_gun_2f.png","fishdld/animation/anigun/img_gun_2l.png","fishdld/animation/anigun/img_gun_2r.png","fishdld/animation/anigun/img_gun_2b.png","fishdld/animation/anigun/img_gun_2nb.png"],loadList3D:[]},ns.Dldby_gun_2UI=bi,e("ui.fishdld.animation.Dldby_gun_2UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,mr,Bt,To],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:-79,x:0,width:57,skin:"fishdld/animation/anigun/img_dldby_gun_tx1.png",pivotY:33,pivotX:29,name:"ef",height:65},compId:9},{type:"Image",props:{y:-70.5,x:1,width:37,skin:"fishdld/animation/anigun/img_gun_3f.png",pivotX:19,name:"po",height:20},compId:4},{type:"Image",props:{y:16,x:0,width:47,skin:"fishdld/animation/anigun/img_gun_3l.png",pivotY:90,pivotX:47,name:"l",height:90},compId:5},{type:"Image",props:{y:16,x:-2.5,width:47,skin:"fishdld/animation/anigun/img_gun_3r.png",pivotY:90,name:"r",height:90},compId:7},{type:"Image",props:{y:15,x:0,width:40,skin:"fishdld/animation/anigun/img_gun_3b.png",pivotY:31,pivotX:20,name:"b",height:31},compId:3},{type:"Image",props:{y:-29,x:-1,width:42,skin:"fishdld/animation/anigun/img_gun_3nb.png",pivotY:19,pivotX:21,name:"nb",height:37},compId:6,child:[{type:"Label",props:{y:18.5,x:21,width:80,text:"9999",scaleY:.7,scaleX:.7,name:"cannon_level",height:26,fontSize:25,font:"fnt_gun_com",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:13}]},{type:"Sprite",props:{y:-62,x:1,name:"muzzle"},compId:11},{type:"Box",props:{y:-18,x:1,name:"indicator"},compId:12}],animations:[{nodes:[{target:7,keyframes:{y:[{value:16,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0},{value:25,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:2},{value:16,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"y",index:5}],x:[{value:-2,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:0},{value:-2,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"x",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:0},{value:11,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"rotation",index:5}]}},{target:3,keyframes:{y:[{value:15,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0},{value:24,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:2},{value:15,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"y",index:5}]}},{target:6,keyframes:{y:[{value:-29,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0},{value:-20,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:2},{value:-29,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:5}]}},{target:5,keyframes:{y:[{value:16,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:25,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:2},{value:16,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0},{value:-8,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"rotation",index:5}]}},{target:4,keyframes:{y:[{value:-70.5,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0},{value:-49.5,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:2},{value:-70.5,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"y",index:5}],x:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"x",index:5}]}},{target:9,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:2},{value:!1,tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"visible",index:5}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"alpha",index:5}]}}],name:"attack",id:1,frameRate:24,action:0},{nodes:[{target:7,keyframes:{y:[{value:16,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0}],x:[{value:-2,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:0}]}},{target:3,keyframes:{y:[{value:15,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0}]}},{target:6,keyframes:{y:[{value:-29,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0}]}},{target:5,keyframes:{y:[{value:16,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0}]}},{target:4,keyframes:{y:[{value:-70.5,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0}],x:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:0}]}},{target:9,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:0}]}}],name:"default",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anigun/img_dldby_gun_tx1.png","fishdld/animation/anigun/img_gun_3f.png","fishdld/animation/anigun/img_gun_3l.png","fishdld/animation/anigun/img_gun_3r.png","fishdld/animation/anigun/img_gun_3b.png","fishdld/animation/anigun/img_gun_3nb.png"],loadList3D:[]},ns.Dldby_gun_3UI=bi,e("ui.fishdld.animation.Dldby_gun_3UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,mr,Bt,To],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:-54,x:-1,width:57,skin:"fishdld/animation/anigun/img_dldby_gun_tx1.png",pivotY:65,pivotX:29,name:"ef",height:65},compId:7},{type:"Image",props:{y:-38,x:46,width:29,skin:"fishdld/animation/anigun/img_gun_4r.png",pivotY:50,pivotX:29,name:"l",height:50},compId:5},{type:"Image",props:{y:-39,x:-46,width:29,skin:"fishdld/animation/anigun/img_gun_4l.png",pivotY:50,name:"r",height:50},compId:4},{type:"Image",props:{y:-91,x:0,width:30,skin:"fishdld/animation/anigun/img_gun_4t.png",pivotX:15,name:"po",height:51},compId:6},{type:"Image",props:{y:-62,x:0,width:101,skin:"fishdld/animation/anigun/img_gun_4f.png",pivotX:51,name:"f",height:74},compId:3},{type:"Image",props:{y:-18.5,x:0,width:42,skin:"fishdld/animation/anigun/img_gun_4nb.png",pivotY:19,pivotX:21,name:"nb",height:37},compId:9,child:[{type:"Label",props:{y:18.5,x:21,width:80,text:"9999",scaleY:.7,scaleX:.7,name:"cannon_level",height:26,fontSize:25,font:"fnt_gun_com",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:13}]},{type:"Sprite",props:{y:-69,x:0,name:"muzzle"},compId:11},{type:"Box",props:{y:-24,x:2,name:"indicator"},compId:12}],animations:[{nodes:[{target:7,keyframes:{y:[{value:-54,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0},{value:-54,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:4}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:4}],width:[{value:57,tweenMethod:"linearNone",tween:!0,target:7,key:"width",index:0},{value:77,tweenMethod:"linearNone",tween:!0,target:7,key:"width",index:4}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:2}],pivotY:[{value:65,tweenMethod:"linearNone",tween:!0,target:7,key:"pivotY",index:0},{value:102,tweenMethod:"linearNone",tween:!0,target:7,key:"pivotY",index:4}],pivotX:[{value:29,tweenMethod:"linearNone",tween:!0,target:7,key:"pivotX",index:0},{value:39,tweenMethod:"linearNone",tween:!0,target:7,key:"pivotX",index:4}],height:[{value:65,tweenMethod:"linearNone",tween:!0,target:7,key:"height",index:0},{value:102,tweenMethod:"linearNone",tween:!0,target:7,key:"height",index:4}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:4}]}},{target:5,keyframes:{y:[{value:-38,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:-21,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:2},{value:-38,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:5}],x:[{value:46,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:0},{value:36,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:2},{value:46,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"x",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0},{value:65,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"rotation",index:5}]}},{target:4,keyframes:{y:[{value:-39,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0},{value:-18,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:2},{value:-39,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"y",index:5}],x:[{value:-46,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:0},{value:-36,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:2},{value:-46,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"x",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"rotation",index:0},{value:-64,tweenMethod:"linearNone",tween:!0,target:4,key:"rotation",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"rotation",index:5}]}},{target:6,keyframes:{y:[{value:-91,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0},{value:-57,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:2},{value:-91,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:5}]}},{target:3,keyframes:{y:[{value:-62,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0},{value:-55,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:2},{value:-62,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"y",index:5}]}},{target:9,keyframes:{y:[{value:-18.5,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:0},{value:-11.5,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:2},{value:-18.5,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"y",index:5}]}}],name:"attack",id:1,frameRate:24,action:0},{nodes:[{target:7,keyframes:{y:[{value:-54,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:0}],width:[{value:57,tweenMethod:"linearNone",tween:!0,target:7,key:"width",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:0}],pivotY:[{value:65,tweenMethod:"linearNone",tween:!0,target:7,key:"pivotY",index:0}],pivotX:[{value:29,tweenMethod:"linearNone",tween:!0,target:7,key:"pivotX",index:0}],height:[{value:65,tweenMethod:"linearNone",tween:!0,target:7,key:"height",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0}]}},{target:5,keyframes:{y:[{value:-38,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0}],x:[{value:46,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"rotation",index:0}]}},{target:4,keyframes:{y:[{value:-39,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0}],x:[{value:-46,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"rotation",index:0}]}},{target:6,keyframes:{y:[{value:-91,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0}]}},{target:3,keyframes:{y:[{value:-62,tweenMethod:"linearNone",tween:!0,target:3,key:"y",index:0}]}},{target:9,keyframes:{y:[{value:-18.5,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:0}]}}],name:"default",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anigun/img_dldby_gun_tx1.png","fishdld/animation/anigun/img_gun_4r.png","fishdld/animation/anigun/img_gun_4l.png","fishdld/animation/anigun/img_gun_4t.png","fishdld/animation/anigun/img_gun_4f.png","fishdld/animation/anigun/img_gun_4nb.png"],loadList3D:[]},ns.Dldby_gun_4UI=bi,e("ui.fishdld.animation.Dldby_gun_4UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,mr,Bt,To],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:-54,x:-1,width:57,skin:"fishdld/animation/anigun/img_dldby_gun_tx1.png",pivotY:65,pivotX:29,name:"ef",height:65},compId:11},{type:"Image",props:{y:-84,x:-46,skin:"fishdld/animation/anigun/img_gun_5bg.png",name:"bg"},compId:3},{type:"Image",props:{y:-4,x:-9,width:38,skin:"fishdld/animation/anigun/img_gun_5l.png",pivotY:72,pivotX:38,name:"l",height:72},compId:5},{type:"Image",props:{y:-6,x:8,width:38,skin:"fishdld/animation/anigun/img_gun_5r.png",pivotY:72,name:"r",height:72},compId:7},{type:"Image",props:{y:20,x:0,width:69,skin:"fishdld/animation/anigun/img_gun_5f.png",pivotY:56,pivotX:35,name:"nb",height:56},compId:4,child:[{type:"Label",props:{y:30,x:34.5,width:80,text:"9999",scaleY:.7,scaleX:.7,name:"cannon_level",height:26,fontSize:25,font:"fnt_gun_com",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:16}]},{type:"Image",props:{y:-53,x:43,width:40,skin:"fishdld/animation/anigun/img_gun_5ld.png",pivotX:20,name:"d1",height:32},compId:6},{type:"Image",props:{y:-51,x:-43,width:40,skin:"fishdld/animation/anigun/img_gun_5rd.png",pivotX:20,name:"d2",height:32},compId:8},{type:"Image",props:{y:-57,x:0,width:40,skin:"fishdld/animation/anigun/img_gun_5t2.png",pivotX:20,name:"t2",height:35},compId:9},{type:"Sprite",props:{y:-54,x:2,name:"muzzle"},compId:14},{type:"Box",props:{y:-10,x:2,name:"indicator"},compId:15}],animations:[{nodes:[{target:11,keyframes:{y:[{value:-54,tweenMethod:"linearNone",tween:!0,target:11,key:"y",index:0},{value:-71,tweenMethod:"linearNone",tween:!0,target:11,key:"y",index:2},{value:-69,tweenMethod:"linearNone",tween:!0,target:11,key:"y",index:4},{value:-71,tweenMethod:"linearNone",tween:!0,target:11,key:"y",index:5}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:0},{value:-1,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:2},{value:-1,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:4},{value:-2,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:5}],width:[{value:57,tweenMethod:"linearNone",tween:!0,target:11,key:"width",index:0},{value:69,tweenMethod:"linearNone",tween:!0,target:11,key:"width",index:2},{value:80,tweenMethod:"linearNone",tween:!0,target:11,key:"width",index:4}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:11,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,key:"visible",index:2}],pivotY:[{value:65,tweenMethod:"linearNone",tween:!0,target:11,key:"pivotY",index:0},{value:80,tweenMethod:"linearNone",tween:!0,target:11,key:"pivotY",index:2},{value:89,tweenMethod:"linearNone",tween:!0,target:11,key:"pivotY",index:4}],pivotX:[{value:29,tweenMethod:"linearNone",tween:!0,target:11,key:"pivotX",index:0},{value:35,tweenMethod:"linearNone",tween:!0,target:11,key:"pivotX",index:2},{value:40,tweenMethod:"linearNone",tween:!0,target:11,key:"pivotX",index:4}],height:[{value:65,tweenMethod:"linearNone",tween:!0,target:11,key:"height",index:0},{value:80,tweenMethod:"linearNone",tween:!0,target:11,key:"height",index:2},{value:89,tweenMethod:"linearNone",tween:!0,target:11,key:"height",index:4}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:11,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:11,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:11,key:"alpha",index:4}]}},{target:5,keyframes:{y:[{value:-4,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:-9,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:2},{value:-8,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:3},{value:-4,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:5}],x:[{value:-9,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:0},{value:-9.5,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:2},{value:-9.5,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:3},{value:-9,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"x",index:5}]}},{target:7,keyframes:{y:[{value:-6,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0},{value:-10,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:2},{value:-9,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:3},{value:-6,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"y",index:5}],x:[{value:8,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:0},{value:11,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:2},{value:11,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:3},{value:8,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"x",index:5}]}},{target:6,keyframes:{y:[{value:-53.5,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0},{value:-58.5,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:2},{value:-53.5,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:5}],x:[{value:43,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0},{value:46,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:2},{value:43,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"x",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:0},{value:-6,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:2},{value:4,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:4},{value:0,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"rotation",index:5}]}},{target:8,keyframes:{y:[{value:-51,tweenMethod:"linearNone",tween:!0,target:8,key:"y",index:0},{value:-57,tweenMethod:"linearNone",tween:!0,target:8,key:"y",index:2},{value:-51,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"y",index:5}],x:[{value:-43,tweenMethod:"linearNone",tween:!0,target:8,key:"x",index:0},{value:-44,tweenMethod:"linearNone",tween:!0,target:8,key:"x",index:2},{value:-43,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"x",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0},{value:7,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:2},{value:-3,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:4},{value:0,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:5}]}}],name:"attack",id:1,frameRate:24,action:0},{nodes:[{target:11,keyframes:{y:[{value:-54,tweenMethod:"linearNone",tween:!0,target:11,key:"y",index:0}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:0}],width:[{value:57,tweenMethod:"linearNone",tween:!0,target:11,key:"width",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:11,key:"visible",index:0}],pivotY:[{value:65,tweenMethod:"linearNone",tween:!0,target:11,key:"pivotY",index:0}],pivotX:[{value:29,tweenMethod:"linearNone",tween:!0,target:11,key:"pivotX",index:0}],height:[{value:65,tweenMethod:"linearNone",tween:!0,target:11,key:"height",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:11,key:"alpha",index:0}]}},{target:5,keyframes:{y:[{value:-4,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0}],x:[{value:-9,tweenMethod:"linearNone",tween:!0,target:5,key:"x",index:0}]}},{target:7,keyframes:{y:[{value:-6,tweenMethod:"linearNone",tween:!0,target:7,key:"y",index:0}],x:[{value:8,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:0}]}},{target:6,keyframes:{y:[{value:-53.5,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0}],x:[{value:43,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:0}]}},{target:8,keyframes:{y:[{value:-51,tweenMethod:"linearNone",tween:!0,target:8,key:"y",index:0}],x:[{value:-43,tweenMethod:"linearNone",tween:!0,target:8,key:"x",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0}]}},{target:9,keyframes:{skin:[{value:"fishdld/animation/anigun/img_gun_5t1.png",tweenMethod:"linearNone",tween:!1,target:9,key:"skin",index:0}]}}],name:"default",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anigun/img_dldby_gun_tx1.png","fishdld/animation/anigun/img_gun_5bg.png","fishdld/animation/anigun/img_gun_5l.png","fishdld/animation/anigun/img_gun_5r.png","fishdld/animation/anigun/img_gun_5f.png","fishdld/animation/anigun/img_gun_5ld.png","fishdld/animation/anigun/img_gun_5rd.png","fishdld/animation/anigun/img_gun_5t2.png","fishdld/animation/anigun/img_gun_5t1.png"],loadList3D:[]},ns.Dldby_gun_5UI=bi,e("ui.fishdld.animation.Dldby_gun_5UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,Bt,pi,mr,To],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Sprite",props:{y:0,x:0,name:"fire"},compId:19,child:[{type:"Image",props:{y:-21,x:-71,width:64,visible:!0,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",scaleY:1,scaleX:1,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:20},{type:"Image",props:{y:-75,x:0,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",scaleY:1,scaleX:1,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:21},{type:"Image",props:{y:-50,x:53.5,width:64,visible:!0,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",scaleY:1,scaleX:1,rotation:228,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:22},{type:"Image",props:{y:-11,x:59.499999999999986,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",scaleY:1,scaleX:1,rotation:-2,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:23},{type:"Image",props:{y:-41.90270965928646,x:-55,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",scaleY:1,scaleX:1,rotation:87,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:24},{type:"Image",props:{y:-64,x:27.499999999999986,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",scaleY:1.2,scaleX:1.2,rotation:169,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:25},{type:"Image",props:{y:-64,x:-32,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",scaleY:1,scaleX:1,rotation:96,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:26},{type:"Image",props:{y:-28,x:66,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",scaleY:1.2,scaleX:1.2,rotation:145,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:28},{type:"Image",props:{y:-34,x:-64,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",scaleY:1.2,scaleX:1.2,rotation:31,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:29},{type:"Image",props:{y:-28,x:-71,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",scaleY:1,scaleX:1,rotation:77,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:30},{type:"Image",props:{y:-30.5,x:-71,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",scaleY:1,scaleX:1,rotation:47,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:31},{type:"Image",props:{y:-66,x:35.69281397953165,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",rotation:-49,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:32},{type:"Image",props:{y:-14,x:-76,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",rotation:174,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:33},{type:"Image",props:{y:0,x:0,width:128,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_gung.png",scaleY:1.4,scaleX:1.4,pivotY:64,pivotX:64,height:128,blendMode:"lighter",alpha:.5},compId:34},{type:"Image",props:{y:-55,x:-49,width:64,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",rotation:1,pivotY:32,pivotX:32,height:64,blendMode:"lighter"},compId:36}]},{type:"Image",props:{y:-4,x:-1,width:147,skin:"fishdld/animation/anigun/img_mfyx_qq.png",scaleY:1.2,scaleX:1.2,height:136,anchorY:.5,anchorX:.535},compId:8},{type:"Sprite",props:{y:-2,x:0,width:118,rotation:0,pivotY:110,pivotX:59,name:"gun",height:154},compId:41,child:[{type:"Image",props:{y:40.5,x:59,width:57,visible:!1,skin:"fishdld/animation/anigun/img_dldby_gun_tx1.png",name:"ef",height:65,anchorY:1,anchorX:.5,alpha:1},compId:5},{type:"Image",props:{y:154,x:59,width:118,skin:"fishdld/animation/anigun/img_dldby_gun_6.png",pivotY:142,pivotX:59,name:"bg",height:142},compId:4},{type:"Image",props:{y:154,x:59,width:118,skin:"fishdld/animation/anigun/img_dldby_gun_01.png",pivotY:142,pivotX:59,name:"01",height:142},compId:3},{type:"Sprite",props:{y:65,x:59,name:"muzzle"},compId:6}]},{type:"Image",props:{y:-7,x:0,width:197,skin:"fishdld/animation/anigun/gun6/img_gun6_ui.png",scaleY:.8,scaleX:.8,pivotY:32,pivotX:99,name:"ui",height:64},compId:15,child:[{type:"Label",props:{y:24,x:31,width:53,text:"x1",pivotY:13,pivotX:27,name:"rate",height:25,fontSize:25,font:"fnt_freegun_double",color:"#ffffff",align:"center"},compId:16},{type:"Label",props:{y:22,x:166,width:53,text:"30.0",pivotY:13,pivotX:27,name:"remain",height:25,fontSize:25,font:"fnt_freegun_time",color:"#ffffff",align:"center"},compId:17},{type:"Label",props:{y:41,x:98,width:80,text:"50",name:"cannon_level",height:26,fontSize:25,font:"fnt_gun_com",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:18}]},{type:"Box",props:{y:-3,x:0,name:"indicator"},compId:7},{type:"Image",props:{y:-132,x:0,width:232,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_free30s.png",scaleY:.7,scaleX:.7,pivotY:67,pivotX:116,name:"start",height:134},compId:37},{type:"Image",props:{y:-130,x:-3,width:204,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_end.png",scaleY:.7,scaleX:.7,pivotY:68,pivotX:102,name:"end",height:118},compId:40},{type:"Image",props:{y:-123,x:0,width:124,visible:!1,skin:"fishdld/animation/aniui/big_bg/img_add429.png",pivotY:62,pivotX:62,name:"add429",height:124,blendMode:"lighter"},compId:38},{type:"Image",props:{y:-123,x:0,width:128,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_xin xin.png",scaleY:2.6,scaleX:2.6,pivotY:64,pivotX:64,name:"xin",height:128,blendMode:"lighter"},compId:39}],animations:[{nodes:[{target:5,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:1},{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:3}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:3}]}},{target:3,keyframes:{skin:[{value:"fishdld/animation/anigun/img_dldby_gun_01.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:0},{value:"fishdld/animation/anigun/img_dldby_gun_02.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:1},{value:"fishdld/animation/anigun/img_dldby_gun_03.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:2},{value:"fishdld/animation/anigun/img_dldby_gun_04.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:3},{value:"fishdld/animation/anigun/img_dldby_gun_05.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:4},{value:"fishdld/animation/anigun/img_dldby_gun_06.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:5},{value:"fishdld/animation/anigun/img_dldby_gun_01.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:6}]}}],name:"attack",id:1,frameRate:24,action:0},{nodes:[{target:3,keyframes:{skin:[{value:"fishdld/animation/anigun/img_dldby_gun_01.png",tweenMethod:"linearNone",tween:!1,target:3,key:"skin",index:0}]}}],name:"default",id:1,frameRate:24,action:0},{nodes:[{target:8,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:80}]}}],name:"circle",id:2,frameRate:24,action:2},{nodes:[{target:20,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:20,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:20,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:20,key:"skin",index:1},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:20,key:"skin",index:2},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:20,key:"skin",index:3},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:20,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:20,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:20,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:20,key:"skin",index:7}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:7}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:7}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:20,label:null,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:20,label:null,key:"alpha",index:2}]}},{target:21,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:21,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"skin",index:2},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"skin",index:3},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:21,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"skin",index:9}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleY",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleY",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleY",index:9}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleX",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleX",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleX",index:9}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:21,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"alpha",index:9},{value:0,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"alpha",index:10}]}},{target:22,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:22,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"skin",index:1},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"skin",index:2},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"skin",index:3},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"skin",index:7}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:22,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleY",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleY",index:7}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:22,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleX",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleX",index:7}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:22,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"alpha",index:7},{value:0,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"alpha",index:8}]}},{target:23,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:23,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:23,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"skin",index:3},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"skin",index:10}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:10}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:10}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:23,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"alpha",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"alpha",index:10}]}},{target:24,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:24,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:24,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"skin",index:2},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"skin",index:3},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"skin",index:9}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:9}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:9}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:24,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"alpha",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:24,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"alpha",index:9},{value:0,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"alpha",index:10}]}},{target:25,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:25,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:25,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:25,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:25,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:25,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:25,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:25,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:25,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:25,label:null,key:"skin",index:10}],scaleY:[{value:1.2,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:4}],scaleX:[{value:1.2,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:4}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:25,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:25,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"alpha",index:10}]}},{target:26,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:26,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:26,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:26,label:null,key:"skin",index:3},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:26,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:26,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:26,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:26,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:26,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:26,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:26,label:null,key:"skin",index:10}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:10}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:4},{value:1.2,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:10}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:26,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"alpha",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"alpha",index:10}]}},{target:28,keyframes:{y:[{value:-28,tweenMethod:"linearNone",tween:!0,target:28,key:"y",index:0},{value:-29,tweenMethod:"linearNone",tween:!0,target:28,key:"y",index:10}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:28,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:28,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:28,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:28,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:28,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:28,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:28,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:28,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:28,label:null,key:"skin",index:10}],scaleY:[{value:1.2,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:4}],scaleX:[{value:1.2,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:4}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:28,key:"alpha",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:6}]}},{target:29,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:29,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:29,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:29,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:29,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:29,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:29,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:29,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:29,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:29,label:null,key:"skin",index:10}],scaleY:[{value:1.2,tweenMethod:"linearNone",tween:!0,target:29,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:29,label:null,key:"scaleY",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:29,label:null,key:"scaleY",index:10}],scaleX:[{value:1.2,tweenMethod:"linearNone",tween:!0,target:29,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:29,label:null,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:29,label:null,key:"scaleX",index:10}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:29,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:29,key:"alpha",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:29,key:"alpha",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:29,label:null,key:"alpha",index:4}]}},{target:30,keyframes:{y:[{value:-28,tweenMethod:"linearNone",tween:!0,target:30,key:"y",index:0},{value:-29,tweenMethod:"linearNone",tween:!0,target:30,key:"y",index:10}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:30,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:30,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"skin",index:1},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"skin",index:10}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:1},{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleY",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:10}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:1},{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:10}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"alpha",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:30,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"alpha",index:6}]}},{target:31,keyframes:{y:[{value:-30.5,tweenMethod:"linearNone",tween:!0,target:31,key:"y",index:0},{value:-31.5,tweenMethod:"linearNone",tween:!0,target:31,key:"y",index:10}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:31,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:31,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:31,label:null,key:"skin",index:1},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:31,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:31,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:31,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:31,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:31,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:31,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:31,label:null,key:"skin",index:10}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:31,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:31,label:null,key:"scaleY",index:1},{value:1,tweenMethod:"linearNone",tween:!0,target:31,key:"scaleY",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:31,label:null,key:"scaleY",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:31,label:null,key:"scaleY",index:9}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:31,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:31,label:null,key:"scaleX",index:1},{value:1,tweenMethod:"linearNone",tween:!0,target:31,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:31,label:null,key:"scaleX",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:31,label:null,key:"scaleX",index:9}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:31,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:31,key:"alpha",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:31,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:31,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:31,label:null,key:"alpha",index:6}]}},{target:32,keyframes:{y:[{value:-66,tweenMethod:"linearNone",tween:!0,target:32,key:"y",index:0},{value:-67,tweenMethod:"linearNone",tween:!0,target:32,key:"y",index:10}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:32,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:32,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:32,label:null,key:"skin",index:1},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:32,label:null,key:"skin",index:2},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:32,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:32,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:32,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:32,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:32,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:32,label:null,key:"skin",index:10}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:32,label:null,key:"scaleY",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleY",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:32,label:null,key:"scaleY",index:6}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:32,label:null,key:"scaleX",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:32,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:32,label:null,key:"scaleX",index:6}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:32,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:32,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:32,key:"alpha",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:32,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:32,label:null,key:"alpha",index:6}]}},{target:33,keyframes:{y:[{value:-14,tweenMethod:"linearNone",tween:!0,target:33,key:"y",index:0},{value:-15,tweenMethod:"linearNone",tween:!0,target:33,key:"y",index:10}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:33,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:33,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:33,label:null,key:"skin",index:1},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:33,label:null,key:"skin",index:2},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:33,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:33,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:33,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:33,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:33,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:33,label:null,key:"skin",index:10}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:33,label:null,key:"scaleY",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleY",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:33,label:null,key:"scaleY",index:6}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:33,label:null,key:"scaleX",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:33,label:null,key:"scaleX",index:6}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:33,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:33,key:"alpha",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:33,label:null,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:33,label:null,key:"alpha",index:8}]}},{target:34,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:34,key:"visible",index:0}],alpha:[{value:.5,tweenMethod:"linearNone",tween:!0,target:34,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:34,key:"alpha",index:5},{value:.4,tweenMethod:"linearNone",tween:!0,target:34,key:"alpha",index:10}]}},{target:36,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:36,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:36,key:"skin",index:0},{value:"fishdld/animation/anigun/gun6/img_gun6_huo06.png",tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"skin",index:1},{value:"fishdld/animation/anigun/gun6/img_gun6_huo07.png",tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"skin",index:2},{value:"fishdld/animation/anigun/gun6/img_gun6_huo08.png",tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"skin",index:3},{value:"fishdld/animation/anigun/gun6/img_gun6_huo05.png",tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun6/img_gun6_huo01.png",tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun6/img_gun6_huo02.png",tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun6/img_gun6_huo03.png",tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun6/img_gun6_huo04.png",tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"skin",index:10}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:36,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleY",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:36,key:"scaleY",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleY",index:7}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:36,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleX",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:36,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleX",index:7}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:36,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:4},{value:0,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:9}]}}],name:"fire",id:3,frameRate:24,action:2},{nodes:[{target:39,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:39,key:"visible",index:0}],scaleY:[{value:2.5,tweenMethod:"linearNone",tween:!0,target:39,key:"scaleY",index:0},{value:4,tweenMethod:"linearNone",tween:!0,target:39,key:"scaleY",index:12}],scaleX:[{value:2.5,tweenMethod:"linearNone",tween:!0,target:39,key:"scaleX",index:0},{value:4,tweenMethod:"linearNone",tween:!0,target:39,key:"scaleX",index:12}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:39,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:39,key:"alpha",index:7},{value:0,tweenMethod:"linearNone",tween:!0,target:39,key:"alpha",index:12}]}},{target:37,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:37,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:37,key:"visible",index:37}],scaleY:[{value:.7,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:3},{value:.7,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:7},{value:.9,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:11},{value:.7,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:15},{value:.8,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:19},{value:.7,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:24},{value:.6,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:32},{value:1,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleY",index:36}],scaleX:[{value:.7,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:3},{value:.7,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:7},{value:.9,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:11},{value:.7,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:15},{value:.8,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:19},{value:.7,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:24},{value:.6,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:32},{value:1,tweenMethod:"linearNone",tween:!0,target:37,key:"scaleX",index:36}]}},{target:38,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:38,key:"visible",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:38,key:"scaleY",index:0},{value:3,tweenMethod:"linearNone",tween:!0,target:38,key:"scaleY",index:5}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:38,key:"scaleX",index:0},{value:3,tweenMethod:"linearNone",tween:!0,target:38,key:"scaleX",index:5}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:38,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:38,key:"alpha",index:5}]}}],name:"start",id:4,frameRate:24,action:0},{nodes:[{target:40,keyframes:{x:[{value:-3,tweenMethod:"linearNone",tween:!0,target:40,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:40,label:null,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:40,label:null,key:"visible",index:37}],scaleY:[{value:.7,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:3},{value:.7,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:7},{value:.9,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:11},{value:.7,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:15},{value:.8,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:19},{value:.7,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:24},{value:.6,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:32},{value:1,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleY",index:36}],scaleX:[{value:.7,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:3},{value:.7,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:7},{value:.9,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:11},{value:.7,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:15},{value:.8,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:19},{value:.7,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:24},{value:.6,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:32},{value:1,tweenMethod:"linearNone",tween:!0,target:40,label:null,key:"scaleX",index:36}]}},{target:38,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:38,label:null,key:"visible",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:38,label:null,key:"scaleY",index:0},{value:3,tweenMethod:"linearNone",tween:!0,target:38,label:null,key:"scaleY",index:5}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:38,label:null,key:"scaleX",index:0},{value:3,tweenMethod:"linearNone",tween:!0,target:38,label:null,key:"scaleX",index:5}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:38,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:38,label:null,key:"alpha",index:5}]}},{target:39,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:39,label:null,key:"visible",index:0}],scaleY:[{value:2.5,tweenMethod:"linearNone",tween:!0,target:39,label:null,key:"scaleY",index:0},{value:4,tweenMethod:"linearNone",tween:!0,target:39,label:null,key:"scaleY",index:10}],scaleX:[{value:2.5,tweenMethod:"linearNone",tween:!0,target:39,label:null,key:"scaleX",index:0},{value:4,tweenMethod:"linearNone",tween:!0,target:39,label:null,key:"scaleX",index:10}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:39,label:null,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:39,label:null,key:"alpha",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:39,label:null,key:"alpha",index:10}]}}],name:"end",id:5,frameRate:24,action:0},{nodes:[{target:17,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleY",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleY",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleY",index:8}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleX",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleX",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleX",index:8}]}}],name:"add_time",id:6,frameRate:24,action:0},{nodes:[{target:16,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleY",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleY",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleY",index:8}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleX",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleX",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleX",index:8}]}}],name:"add_rate",id:7,frameRate:24,action:0}],loadList:["fishdld/animation/anigun/gun6/img_gun6_huo01.png","fishdld/animation/anigun/gun6/img_gun6_huo08.png","fishdld/animation/anigun/gun6/img_gun6_huo07.png","fishdld/animation/anigun/gun6/img_gun6_gung.png","fishdld/animation/anigun/img_mfyx_qq.png","fishdld/animation/anigun/img_dldby_gun_tx1.png","fishdld/animation/anigun/img_dldby_gun_6.png","fishdld/animation/anigun/img_dldby_gun_01.png","fishdld/animation/anigun/gun6/img_gun6_ui.png","fishdld/animation/anigun/gun6/img_gun6_free30s.png","fishdld/animation/anigun/gun6/img_gun6_end.png","fishdld/animation/aniui/big_bg/img_add429.png","fishdld/animation/anigun/gun6/img_gun6_xin xin.png","fishdld/animation/anigun/img_dldby_gun_02.png","fishdld/animation/anigun/img_dldby_gun_03.png","fishdld/animation/anigun/img_dldby_gun_04.png","fishdld/animation/anigun/img_dldby_gun_05.png","fishdld/animation/anigun/img_dldby_gun_06.png","fishdld/animation/anigun/gun6/img_gun6_huo02.png","fishdld/animation/anigun/gun6/img_gun6_huo03.png","fishdld/animation/anigun/gun6/img_gun6_huo04.png","fishdld/animation/anigun/gun6/img_gun6_huo06.png","fishdld/animation/anigun/gun6/img_gun6_huo05.png"],loadList3D:[]},ns.Dldby_gun_6UI=bi,e("ui.fishdld.animation.Dldby_gun_6UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,Bt,To,mr],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:-80,x:0,visible:!1,skin:"fishdld/animation/anigun/gun7/img_electric_gun_range.png",name:"area",anchorY:1,anchorX:.5},compId:6},{type:"Image",props:{y:17,x:0,width:86,visible:!0,skin:"fishdld/animation/anigun/img_gun_7.png",pivotY:102,pivotX:43,name:"pao",height:102},compId:3},{type:"Sprite",props:{y:-82,x:0,visible:!1,name:"muzzle"},compId:4},{type:"Box",props:{y:-11,x:0,name:"indicator"},compId:5},{type:"Sprite",props:{y:-80,x:0,visible:!0,name:"gun7power"},compId:8,child:[{type:"Image",props:{y:0,x:0,width:400,visible:!0,skin:"fishdld/animation/anigun/gun7/img_gun_7power_03.png",pivotY:129,pivotX:200,name:"ef",height:240},compId:9}]},{type:"Image",props:{y:-80,x:0,width:256,visible:!0,skin:"fishdld/animation/anigun/gun7/img_gun7bomb.png",scaleY:.790909090909091,scaleX:.790909090909091,pivotY:128,pivotX:128,name:"gun7bomb",height:256,blendMode:"lighter",alpha:.06666666666666668},compId:15},{type:"Image",props:{y:-74,x:0,width:256,visible:!0,skin:"fishdld/animation/anigun/gun7/img_gun7bomb.png",scaleY:1.7272727272727273,scaleX:1.7272727272727273,pivotY:128,pivotX:128,name:"gun7bomb2",height:256,blendMode:"lighter",alpha:.02727272727272728},compId:16},{type:"Label",props:{y:-10,x:0,width:80,text:"9999",scaleY:.7,scaleX:.7,name:"cannon_level",height:26,fontSize:25,font:"fnt_gun_com",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:18}],animations:[{nodes:[{target:8,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0}]}},{target:15,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:15,key:"visible",index:0}]}},{target:16,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:16,key:"visible",index:0}]}}],name:"default",id:1,frameRate:24,action:0},{nodes:[{target:8,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0}]}},{target:15,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:0}],scaleY:[{value:2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:22}],scaleX:[{value:2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:22}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:22}]}},{target:16,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:16,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:10},{value:2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:22}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:10},{value:2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:22}],alpha:[{value:.1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:11},{value:.1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:22}]}},{target:9,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"x",index:11},{value:0,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"x",index:22}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:0}],skin:[{value:"fishdld/animation/anigun/gun7/img_gun_7power_00.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:0},{value:"fishdld/animation/anigun/gun7/img_gun_7power_01.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:1},{value:"fishdld/animation/anigun/gun7/img_gun_7power_02.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:2},{value:"fishdld/animation/anigun/gun7/img_gun_7power_03.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:3},{value:"fishdld/animation/anigun/gun7/img_gun_7power_04.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:4},{value:"fishdld/animation/anigun/gun7/img_gun_7power_05.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:5},{value:"fishdld/animation/anigun/gun7/img_gun_7power_06.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:6},{value:"fishdld/animation/anigun/gun7/img_gun_7power_07.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:7},{value:"fishdld/animation/anigun/gun7/img_gun_7power_08.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:8},{value:"fishdld/animation/anigun/gun7/img_gun_7power_09.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:9},{value:"fishdld/animation/anigun/gun7/img_gun_7power_10.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:10},{value:"fishdld/animation/anigun/gun7/img_gun_7power_00.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:11},{value:"fishdld/animation/anigun/gun7/img_gun_7power_01.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:12},{value:"fishdld/animation/anigun/gun7/img_gun_7power_02.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:13},{value:"fishdld/animation/anigun/gun7/img_gun_7power_03.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:14},{value:"fishdld/animation/anigun/gun7/img_gun_7power_04.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:15},{value:"fishdld/animation/anigun/gun7/img_gun_7power_05.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:16},{value:"fishdld/animation/anigun/gun7/img_gun_7power_06.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:17},{value:"fishdld/animation/anigun/gun7/img_gun_7power_07.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:18},{value:"fishdld/animation/anigun/gun7/img_gun_7power_08.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:19},{value:"fishdld/animation/anigun/gun7/img_gun_7power_09.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:20},{value:"fishdld/animation/anigun/gun7/img_gun_7power_10.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:21},{value:"fishdld/animation/anigun/gun7/img_gun_7power_00.png",tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"skin",index:22}]}}],name:"attack",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anigun/gun7/img_electric_gun_range.png","fishdld/animation/anigun/img_gun_7.png","fishdld/animation/anigun/gun7/img_gun_7power_03.png","fishdld/animation/anigun/gun7/img_gun7bomb.png","fishdld/animation/anigun/gun7/img_gun_7power_00.png","fishdld/animation/anigun/gun7/img_gun_7power_01.png","fishdld/animation/anigun/gun7/img_gun_7power_02.png","fishdld/animation/anigun/gun7/img_gun_7power_04.png","fishdld/animation/anigun/gun7/img_gun_7power_05.png","fishdld/animation/anigun/gun7/img_gun_7power_06.png","fishdld/animation/anigun/gun7/img_gun_7power_07.png","fishdld/animation/anigun/gun7/img_gun_7power_08.png","fishdld/animation/anigun/gun7/img_gun_7power_09.png","fishdld/animation/anigun/gun7/img_gun_7power_10.png"],loadList3D:[]},ns.Dldby_gun_7UI=bi,e("ui.fishdld.animation.Dldby_gun_7UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,Bt,mr],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:19,x:2,width:71,skin:"fishdld/animation/anigun/img_gun_8.png",pivotY:101,pivotX:36,name:"rocket",height:101},compId:3},{type:"Sprite",props:{y:-35,x:2,name:"muzzle"},compId:4},{type:"Label",props:{y:-13,x:0,width:80,text:"9999",scaleY:.7,scaleX:.7,name:"cannon_level",height:26,fontSize:25,font:"fnt_gun_com",color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:5}],animations:[{nodes:[{target:3,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:0}]}}],name:"attack",id:1,frameRate:24,action:0},{nodes:[{target:3,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:0}]}}],name:"default",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/anigun/img_gun_8.png"],loadList3D:[]},ns.Dldby_gun_8UI=bi,e("ui.fishdld.animation.Dldby_gun_8UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,Bt],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:-167,x:0,width:50,skin:"fishdld/animation/aniui/location/img_location_03.png",pivotX:25,name:"zt",height:38},compId:5},{type:"Image",props:{y:-169,x:0,width:151,skin:"fishdld/animation/aniui/location/img_location_04.png",pivotY:40,pivotX:76,name:"nb",height:40},compId:6},{type:"Sprite",props:{},compId:18,child:[{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aniui/location/img_location_02.png",pivotY:128,pivotX:128,name:"hc"},compId:4},{type:"Image",props:{y:0,x:0,width:256,skin:"fishdld/animation/aniui/location/img_location_01.png",pivotY:128,pivotX:128,name:"sc",height:256},compId:3}]}],animations:[{nodes:[{target:3,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:0},{value:180,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:60}]}},{target:4,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"rotation",index:0},{value:-180,tweenMethod:"linearNone",tween:!0,target:4,key:"rotation",index:60}]}},{target:18,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:0},{value:.85,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:30},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:60}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:0},{value:.85,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:30},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:60}]}},{target:5,keyframes:{y:[{value:-167,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:-172,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:7},{value:-164,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:14},{value:-169,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:20},{value:-167,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:25},{value:-167,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:30},{value:-172,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:37},{value:-164,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:44},{value:-169,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:50},{value:-167,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"y",index:55}],height:[{value:38,tweenMethod:"linearNone",tween:!0,target:5,key:"height",index:0},{value:35,tweenMethod:"linearNone",tween:!0,target:5,key:"height",index:7},{value:49,tweenMethod:"linearNone",tween:!0,target:5,key:"height",index:14},{value:38,tweenMethod:"linearNone",tween:!0,target:5,key:"height",index:20},{value:38,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"height",index:25},{value:38,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"height",index:30},{value:35,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"height",index:37},{value:49,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"height",index:44},{value:38,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"height",index:50},{value:38,tweenMethod:"linearNone",tween:!0,target:5,label:null,key:"height",index:55}]}},{target:6,keyframes:{y:[{value:-169,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0},{value:-165,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:7},{value:-189.6,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:14},{value:-166,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:20},{value:-171,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:25},{value:-169,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:30},{value:-165,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:37},{value:-189.6,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:44},{value:-166,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:50},{value:-171,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:55},{value:-169,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:60}],height:[{value:40,tweenMethod:"linearNone",tween:!0,target:6,key:"height",index:0},{value:37,tweenMethod:"linearNone",tween:!0,target:6,key:"height",index:7},{value:48,tweenMethod:"linearNone",tween:!0,target:6,key:"height",index:14},{value:38,tweenMethod:"linearNone",tween:!0,target:6,key:"height",index:20},{value:42,tweenMethod:"linearNone",tween:!0,target:6,key:"height",index:25},{value:40,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"height",index:30},{value:37,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"height",index:37},{value:48,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"height",index:44},{value:38,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"height",index:50},{value:42,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"height",index:55},{value:40,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"height",index:60}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aniui/location/img_location_03.png","fishdld/animation/aniui/location/img_location_04.png","fishdld/animation/aniui/location/img_location_02.png","fishdld/animation/aniui/location/img_location_01.png"],loadList3D:[]},ns.Dldby_location_uiUI=bi,e("ui.fishdld.animation.Dldby_location_uiUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi,Qo],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aniui/location/img_lock.png",rotation:184,anchorY:.5,anchorX:.5},compId:3},{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aniui/location/img_lock2.png",rotation:-184,anchorY:.5,anchorX:.5},compId:4},{type:"Image",props:{y:-118,x:-31,var:"txt",skin:"fishdld/animation/aniui/location/img_lock_txt.png",alpha:0},compId:5}],animations:[{nodes:[{target:3,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:0},{value:180,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:90},{value:360,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:180}]}},{target:4,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"rotation",index:0},{value:-180,tweenMethod:"linearNone",tween:!0,target:4,key:"rotation",index:90},{value:-360,tweenMethod:"linearNone",tween:!0,target:4,key:"rotation",index:180}]}}],name:"ani1",id:1,frameRate:24,action:2},{nodes:[{target:5,keyframes:{alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:25},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:30}]}}],name:"ani2",id:2,frameRate:24,action:0}],loadList:["fishdld/animation/aniui/location/img_lock.png","fishdld/animation/aniui/location/img_lock2.png","fishdld/animation/aniui/location/img_lock_txt.png"],loadList3D:[]},ns.Dldby_lock_uiUI=bi,e("ui.fishdld.animation.Dldby_lock_uiUI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{width:1136,height:640,blendMode:"lighter"},compId:2,child:[{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_00.png",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:49}],animations:[{nodes:[{target:49,keyframes:{skin:[{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_00.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:0},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_01.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:1},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_02.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:2},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_03.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:3},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_04.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:4},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_05.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:5},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_06.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:6},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_07.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:7},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_08.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:8},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_09.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:9},{value:"fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_10.png",tweenMethod:"linearNone",tween:!1,target:49,key:"skin",index:10}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_00.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_01.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_02.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_03.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_04.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_05.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_06.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_07.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_08.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_09.png","fishdld/animation/aninet/net_1/dldby_net_1_newAnimation_10.png"],loadList3D:[]},ns.dldby_net_1UI=bi,e("ui.fishdld.animation.dldby_net_1UI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{width:1136,height:640},compId:2,child:[{type:"Image",props:{y:0,x:0,width:321,skin:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_00.png",pivotY:159,pivotX:171,height:317,blendMode:"lighter"},compId:22}],animations:[{nodes:[{target:22,keyframes:{skin:[{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_00.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:0},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_01.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:1},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_02.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:2},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_03.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:3},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_04.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:4},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_05.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:5},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_06.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:6},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_07.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:7},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_08.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:8},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_09.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:9},{value:"fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_10.png",tweenMethod:"linearNone",tween:!1,target:22,key:"skin",index:10}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_00.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_01.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_02.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_03.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_04.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_05.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_06.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_07.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_08.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_09.png","fishdld/animation/aninet/net_2/dldby_net_2_newAnimation_10.png"],loadList3D:[]},ns.dldby_net_2UI=bi,e("ui.fishdld.animation.dldby_net_2UI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{width:1136,height:640},compId:2,child:[{type:"Image",props:{y:0,x:0,width:301,skin:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_01.png",pivotY:159,pivotX:170,height:317,blendMode:"lighter"},compId:16}],animations:[{nodes:[{target:16,keyframes:{skin:[{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_01.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:0},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_02.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:1},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_03.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:2},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_04.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:3},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_05.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:4},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_06.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:5},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_07.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:6},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_08.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:7},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_09.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:8},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_10.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:9},{value:"fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_11.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:10}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_01.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_02.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_03.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_04.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_05.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_06.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_07.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_08.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_09.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_10.png","fishdld/animation/aninet/net_3/dldby_net_3_newAnimation_11.png"],loadList3D:[]},ns.dldby_net_3UI=bi,e("ui.fishdld.animation.dldby_net_3UI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{width:1136,height:640},compId:2,child:[{type:"Image",props:{y:0,x:0,width:321,skin:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_00.png",pivotY:159,pivotX:161,height:318,blendMode:"lighter"},compId:16}],animations:[{nodes:[{target:16,keyframes:{skin:[{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_00.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:0},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_01.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:1},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_02.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:2},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_03.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:3},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_04.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:4},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_05.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:5},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_06.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:6},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_07.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:7},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_08.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:8},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_09.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:9},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_10.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:10},{value:"fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_11.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:11}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_00.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_01.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_02.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_03.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_04.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_05.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_06.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_07.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_08.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_09.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_10.png","fishdld/animation/aninet/net_4/dldby_net_4_newAnimation_11.png"],loadList3D:[]},ns.dldby_net_4UI=bi,e("ui.fishdld.animation.dldby_net_4UI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{width:1136,height:640},compId:2,child:[{type:"Image",props:{y:1,x:1,width:385,visible:!0,skin:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_0.png",pivotY:211,pivotX:218,name:"spark",height:403,blendMode:"lighter"},compId:4},{type:"Image",props:{y:0,x:0,width:64,skin:"fishdld/animation/aninet/net_5/img_addnet5.png",scaleY:3,scaleX:3,pivotY:32,pivotX:32,name:"add",height:64,blendMode:"lighter",alpha:1},compId:14},{type:"Image",props:{y:0,x:-3,visible:!0,skin:"fishdld/animation/aninet/net_5/dldby_net_5_fu_05.png",name:"fu",anchorY:.5,anchorX:.5,alpha:1},compId:13}],animations:[{nodes:[{target:4,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:4,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:4,key:"visible",index:10}],skin:[{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_0.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:0},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_1.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:1},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_2.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:2},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_3.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:3},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_4.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:4},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_5.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:5},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_6.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:6},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_7.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:7},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_8.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:8},{value:"fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_9.png",tweenMethod:"linearNone",tween:!1,target:4,key:"skin",index:9}]}},{target:14,keyframes:{scaleY:[{value:3,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleY",index:0},{value:4,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleY",index:5}],scaleX:[{value:3,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleX",index:0},{value:4,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleX",index:5}],name:[{value:"add",tweenMethod:"linearNone",tween:!1,target:14,key:"name",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:5}]}},{target:13,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:13,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,key:"visible",index:11}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:10}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:10}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:10}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_0.png","fishdld/animation/aninet/net_5/img_addnet5.png","fishdld/animation/aninet/net_5/dldby_net_5_fu_05.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_1.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_2.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_3.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_4.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_5.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_6.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_7.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_8.png","fishdld/animation/aninet/net_5/dldby_net_5_newAnimation_9.png"],loadList3D:[]},ns.dldby_net_5UI=bi,e("ui.fishdld.animation.dldby_net_5UI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{width:1136,height:640},compId:2,child:[{type:"Image",props:{y:0,x:0,width:246,skin:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_00.png",pivotY:113,pivotX:123,height:226,blendMode:"lighter"},compId:17}],animations:[{nodes:[{target:17,keyframes:{skin:[{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_00.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:0},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_01.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:1},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_02.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:2},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_03.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:3},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_04.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:4},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_05.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:5},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_06.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:6},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_07.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:7},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_08.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:8},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_09.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:9},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_10.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:10},{value:"fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_11.png",tweenMethod:"linearNone",tween:!1,target:17,key:"skin",index:11}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_00.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_01.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_02.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_03.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_04.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_05.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_06.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_07.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_08.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_09.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_10.png","fishdld/animation/aninet/net_6/dldby_net_6_newAnimation_11.png"],loadList3D:[]},ns.dldby_net_6UI=bi,e("ui.fishdld.animation.dldby_net_6UI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Bt],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{width:1136,height:640},compId:2,child:[{type:"Sprite",props:{y:0,x:0,width:211,texture:"fishdld/animation/aninet/net_8/dldby_net_8star.png",pivotY:106,pivotX:106,name:"star",height:212,blendMode:"lighter"},compId:3},{type:"Sprite",props:{y:0,x:0,width:256,texture:"fishdld/animation/aninet/net_8/dldby_net_8gl.png",pivotY:128,pivotX:128,name:"gl",height:256,blendMode:"lighter"},compId:4},{type:"Sprite",props:{y:0,x:0,width:256,scaleY:4,scaleX:4,pivotY:128,pivotX:128,height:256},compId:6,child:[{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810004.png"},compId:7},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810006.png"},compId:8},{type:"Sprite",props:{y:0,x:0,visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810008.png"},compId:9},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810010.png"},compId:10},{type:"Sprite",props:{y:0,x:0,visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810012.png"},compId:11},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810014.png"},compId:12},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810016.png"},compId:13},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810018.png"},compId:14},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810020.png"},compId:15},{type:"Sprite",props:{y:0,x:0,visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810022.png"},compId:16},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810024.png"},compId:17},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810025.png"},compId:18},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810026.png"},compId:19},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810027.png"},compId:20},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810028.png"},compId:21},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810029.png"},compId:22},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810030.png"},compId:23},{type:"Sprite",props:{visible:!1,texture:"fishdld/animation/aninet/net_8/dldby_net_810031.png"},compId:24}]}],animations:[{nodes:[{target:7,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:2}],blendMode:[{value:"lighter",tweenMethod:"linearNone",tween:!1,target:7,key:"blendMode",index:0}]}},{target:8,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:8,label:null,key:"visible",index:2},{value:!1,tweenMethod:"linearNone",tween:!1,target:8,label:null,key:"visible",index:3}]}},{target:9,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"visible",index:3},{value:!1,tweenMethod:"linearNone",tween:!1,target:9,label:null,key:"visible",index:4}]}},{target:10,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:10,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:10,label:null,key:"visible",index:4},{value:!1,tweenMethod:"linearNone",tween:!1,target:10,label:null,key:"visible",index:5}]}},{target:11,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:11,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:11,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:5},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:6}]}},{target:12,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:12,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:12,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:6},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:7}]}},{target:13,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:13,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:7},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:8}]}},{target:14,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:14,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:8},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:9}]}},{target:15,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:15,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:15,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:9},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:10}]}},{target:16,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:16,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:16,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:10},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:11}]}},{target:17,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:17,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:17,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:11},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:12}]}},{target:18,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:18,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:12},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:13}]}},{target:19,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:19,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:19,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:13},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:14}]}},{target:20,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:20,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:20,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:14},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:15}]}},{target:21,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:21,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:15},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:16}]}},{target:22,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:22,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:22,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:16},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:17}]}},{target:23,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:23,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:23,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"visible",index:17},{value:!1,tweenMethod:"linearNone",tween:!1,target:23,label:null,key:"visible",index:18}]}},{target:24,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:24,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:24,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"visible",index:18},{value:!1,tweenMethod:"linearNone",tween:!1,target:24,label:null,key:"visible",index:19}]}},{target:6,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0}],scaleY:[{value:4,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:0},{value:5,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:19}],scaleX:[{value:4,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0},{value:5,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:19}]}},{target:4,keyframes:{scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0},{value:6,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:10}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0},{value:8,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:10}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:10}]}},{target:3,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0},{value:2.5,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:8},{value:3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:30}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0},{value:2.5,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:8},{value:3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:30}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:13},{value:.2,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:22},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:30}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aninet/net_8/dldby_net_8star.png","fishdld/animation/aninet/net_8/dldby_net_8gl.png","fishdld/animation/aninet/net_8/dldby_net_810004.png","fishdld/animation/aninet/net_8/dldby_net_810006.png","fishdld/animation/aninet/net_8/dldby_net_810008.png","fishdld/animation/aninet/net_8/dldby_net_810010.png","fishdld/animation/aninet/net_8/dldby_net_810012.png","fishdld/animation/aninet/net_8/dldby_net_810014.png","fishdld/animation/aninet/net_8/dldby_net_810016.png","fishdld/animation/aninet/net_8/dldby_net_810018.png","fishdld/animation/aninet/net_8/dldby_net_810020.png","fishdld/animation/aninet/net_8/dldby_net_810022.png","fishdld/animation/aninet/net_8/dldby_net_810024.png","fishdld/animation/aninet/net_8/dldby_net_810025.png","fishdld/animation/aninet/net_8/dldby_net_810026.png","fishdld/animation/aninet/net_8/dldby_net_810027.png","fishdld/animation/aninet/net_8/dldby_net_810028.png","fishdld/animation/aninet/net_8/dldby_net_810029.png","fishdld/animation/aninet/net_8/dldby_net_810030.png","fishdld/animation/aninet/net_8/dldby_net_810031.png"],loadList3D:[]},ns.dldby_net_8UI=bi,e("ui.fishdld.animation.dldby_net_8UI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Bt],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{},compId:2,child:[{type:"Sprite",props:{y:0,x:0,width:76,texture:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_00.png",pivotY:38,pivotX:38,height:76},compId:3}],animations:[{nodes:[{target:3,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:4},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:6},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:7},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:8},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:9},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:11},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:12},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:13},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:14},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:15},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:16},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:17},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:18},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:19},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:20},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:21},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:22},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"x",index:23}],texture:[{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_00.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:0},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_01.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:1},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_02.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:2},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_03.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:3},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_04.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:4},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_05.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:5},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_06.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:6},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_07.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:7},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_08.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:8},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_09.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:9},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_10.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:10},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_11.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:11},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_12.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:12},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_13.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:13},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_14.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:14},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_15.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:15},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_16.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:16},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_17.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:17},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_18.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:18},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_19.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:19},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_20.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:20},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_21.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:21},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_22.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:22},{value:"fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_23.png",tweenMethod:"linearNone",tween:!1,target:3,key:"texture",index:23}]}}],name:"ani1",id:1,frameRate:24,action:2}],loadList:["fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_00.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_01.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_02.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_03.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_04.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_05.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_06.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_07.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_08.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_09.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_10.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_11.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_12.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_13.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_14.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_15.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_16.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_17.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_18.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_19.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_20.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_21.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_22.png","fishdld/animation/aniui/dldby_quxiao_ui/dldby_quxiao_ui_23.png"],loadList3D:[]},ns.dldby_radarUI=bi,e("ui.fishdld.animation.dldby_radarUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,mr],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:0,x:0,width:256,skin:"fishdld/animation/aniui/img_yu428_add.png",scaleY:1.5333333333333334,scaleX:1.5333333333333334,rotation:-35.75,pivotY:128,pivotX:128,name:"add",height:256,blendMode:"lighter",alpha:0},compId:3},{type:"Image",props:{y:-7,x:0,width:180,skin:"fishdld/animation/aniui/img_yu429_rgb.png",scaleY:1.3333333333333335,scaleX:1.3333333333333335,pivotY:87,pivotX:90,name:"rbg_b",height:175,alpha:.6666666666666666},compId:4,child:[{type:"Image",props:{y:88,x:71,width:180,skin:"fishdld/animation/aniui/img_yu429_den.png",pivotY:88,pivotX:70,name:"de",height:175,alpha:0},compId:7}]},{type:"Image",props:{y:0,x:0,width:132,visible:!1,skin:"fishdld/animation/aniui/img_yu428_gols.png",scaleY:.14,scaleX:.14,pivotY:17,pivotX:66,name:"gold",height:34},compId:5},{type:"Image",props:{y:33,x:0,width:229,skin:"fishdld/animation/aniui/img_yu428_nb.png",scaleY:2,scaleX:2,pivotY:30,pivotX:115,name:"nb",height:60,alpha:0},compId:6,child:[{type:"Label",props:{y:8,x:63,width:375,valign:"middle",text:"0",scaleY:.4,scaleX:.4,pivotY:13,pivotX:61,height:54,font:"coin_number",align:"center"},compId:12}]},{type:"Image",props:{y:-28,x:0,width:100,name:"all_fzts",height:100},compId:9,child:[{type:"Image",props:{y:-50,x:-65,skin:"fishdld/animation/aniui/img_yu429_fzts1.png",scaleY:.30000000000000004,scaleX:.30000000000000004,rotation:-7.2,pivotY:40,pivotX:44,name:"fzts1"},compId:13},{type:"Image",props:{y:-43.333333333333336,x:-25,width:82,skin:"fishdld/animation/aniui/img_yu429_fzts2.png",scaleY:.18333333333333335,scaleX:.18333333333333335,rotation:-3,pivotY:41,pivotX:41,name:"fzts2",height:82},compId:14},{type:"Image",props:{y:-40,x:18,width:91,skin:"fishdld/animation/aniui/img_yu429_fzts3.png",scaleY:.1,scaleX:.1,rotation:0,pivotY:40,pivotX:46,name:"fzts3",height:80},compId:15},{type:"Image",props:{y:-38,x:62,width:79,skin:"fishdld/animation/aniui/img_yu429_fzts4.png",scaleY:.1,scaleX:.1,rotation:0,pivotY:41,pivotX:40,name:"fzts4",height:82},compId:16}]},{type:"Image",props:{y:-82,x:-10.5,width:277,visible:!1,skin:"fishdld/fight/fishicon/fish_29.png",scaleY:.3,scaleX:.3,rotation:-2,pivotY:125,pivotX:124,name:"fish_icon",height:250},compId:8},{type:"Image",props:{y:0,x:0,width:124,visible:!0,skin:"fishdld/animation/aniui/big_bg/img_add429.png",scaleY:1.8888888888888888,scaleX:1.8888888888888888,pivotY:62,pivotX:62,name:"add429",height:124,blendMode:"lighter",alpha:.7777777777777778},compId:18},{type:"Image",props:{y:0,x:0,width:124,visible:!1,skin:"fishdld/animation/aniui/big_bg/img_add429.png",scaleY:1,scaleX:1,pivotY:62,pivotX:62,name:"add430",height:124,blendMode:"lighter",alpha:0},compId:19},{type:"Image",props:{y:0,x:0,width:64,visible:!0,skin:"fishdld/animation/aniui/big_bg/img_add430_guang.png",scaleY:5.333333333333333,scaleX:5.333333333333333,pivotY:32,pivotX:32,name:"add430guang",height:64,blendMode:"lighter",alpha:.33333333333333337},compId:20}],animations:[{nodes:[{target:6,keyframes:{scaleY:[{value:2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:6}],scaleX:[{value:2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:6}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"alpha",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:6}]}},{target:5,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:5},{value:-9,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:6},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:8},{value:-3,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:12}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:5}],scaleY:[{value:.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:5},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:8}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:5},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:8}]}},{target:4,keyframes:{scaleY:[{value:2,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:3}],scaleX:[{value:2,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:3}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:3}]}},{target:9,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:0}]}},{target:8,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:6},{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:7}],scaleY:[{value:.3,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:0}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0},{value:-12,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:12},{value:0,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:24}]}},{target:3,keyframes:{scaleY:[{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:6},{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:10}],scaleX:[{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:6},{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:10}],rotation:[{value:-39,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"rotation",index:24}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:10}]}},{target:7,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:13}]}},{target:13,keyframes:{y:[{value:-30,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:0},{value:-50,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:5},{value:-10,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:8},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:11},{value:-5,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:14},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:17},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:20}],x:[{value:-65,tweenMethod:"linearNone",tween:!0,target:13,key:"x",index:0}],scaleY:[{value:.1,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:5}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:5}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:0},{value:-18,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:5},{value:18,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:11},{value:-9,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:14},{value:9,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:17},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:20}]}},{target:14,keyframes:{y:[{value:-30,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:0},{value:-50,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:7},{value:-10,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:13},{value:-5,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:16},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:19},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:22}],x:[{value:-25,tweenMethod:"linearNone",tween:!0,target:14,key:"x",index:0}],scaleY:[{value:.1,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleY",index:1},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:7}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleX",index:1},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:7}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:1},{value:-18,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:7},{value:18,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:13},{value:-9,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:16},{value:9,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:19},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:22}]}},{target:15,keyframes:{y:[{value:-30,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:0},{value:-50,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:4},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:8},{value:-10,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:11},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:14},{value:-5,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:17},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:20},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:23}],x:[{value:18,tweenMethod:"linearNone",tween:!0,target:15,key:"x",index:0}],scaleY:[{value:.1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:2},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:8}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:2},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:8}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:15,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:2},{value:-18,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:8},{value:18,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:14},{value:-9,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:17},{value:9,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:20},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:23}]}},{target:16,keyframes:{y:[{value:-30,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:0},{value:-50,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:9},{value:-10,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:12},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:15},{value:-5,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:18},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:21},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:24}],x:[{value:62,tweenMethod:"linearNone",tween:!0,target:16,key:"x",index:0}],scaleY:[{value:.1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:3},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:9}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:3},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:9}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:16,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:3},{value:-18,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:9},{value:18,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:15},{value:-9,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:18},{value:9,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:21},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:24}]}},{target:18,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:0},{value:5,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:9}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:0},{value:5,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:9}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:9}]}},{target:19,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:19,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:19,key:"x",index:5}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:19,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:5}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:19,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:19,label:null,key:"scaleY",index:5},{value:5,tweenMethod:"linearNone",tween:!0,target:19,label:null,key:"scaleY",index:18}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:19,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:19,label:null,key:"scaleX",index:5},{value:5,tweenMethod:"linearNone",tween:!0,target:19,label:null,key:"scaleX",index:18}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:19,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:19,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:19,label:null,key:"alpha",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:19,label:null,key:"alpha",index:18}]}},{target:20,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:20,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:20,key:"visible",index:0}],scaleY:[{value:4,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:0},{value:6,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:3}],scaleX:[{value:4,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:0},{value:6,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:3}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:20,key:"alpha",index:3}]}}],name:"ani2",id:1,frameRate:24,action:0},{nodes:[{target:6,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:0}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:0}]}},{target:5,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0}]}},{target:4,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0}]}},{target:9,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:0}]}},{target:8,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0}],scaleY:[{value:.3,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:0}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0},{value:-12,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:11},{value:0,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:24}]}},{target:3,keyframes:{scaleY:[{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0}],scaleX:[{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0}],rotation:[{value:-39,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:24}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0}]}},{target:7,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0}]}},{target:13,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:4},{value:-20,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:6},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:8}],x:[{value:-65,tweenMethod:"linearNone",tween:!0,target:13,key:"x",index:0}],scaleY:[{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:4},{value:.7,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:6},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:11}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:4},{value:.7,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:6},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:11}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:0},{value:-9,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:6},{value:5,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:11},{value:-5,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"rotation",index:17},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"rotation",index:24}]}},{target:14,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:5},{value:-20,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:7},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"y",index:9}],x:[{value:-25,tweenMethod:"linearNone",tween:!0,target:14,key:"x",index:0}],scaleY:[{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:1},{value:.3,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:5},{value:.7,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:7},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:12}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:1},{value:.3,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:5},{value:.7,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:7},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:12}],rotation:[{value:-1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:1},{value:-9,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:7},{value:5,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:12},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:16},{value:-5,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:21},{value:-1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"rotation",index:24}]}},{target:15,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:6},{value:-20,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:8},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"y",index:10}],x:[{value:18,tweenMethod:"linearNone",tween:!0,target:15,key:"x",index:0}],scaleY:[{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:2},{value:.3,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:6},{value:.7,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:8},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:13}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:2},{value:.3,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:6},{value:.7,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:8},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:13}],rotation:[{value:-3,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:2},{value:-9,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:8},{value:5,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:13},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:17},{value:-5,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:22},{value:-3,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"rotation",index:24}]}},{target:16,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:7},{value:-20,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:9},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"y",index:11}],x:[{value:62,tweenMethod:"linearNone",tween:!0,target:16,key:"x",index:0}],scaleY:[{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:3},{value:.3,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:7},{value:.7,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:9},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:14}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:3},{value:.3,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:7},{value:.7,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:9},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:14}],rotation:[{value:-4,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:3},{value:-9,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:9},{value:5,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:14},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:18},{value:-5,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:23},{value:-4,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"rotation",index:24}]}}],name:"ani1",id:1,frameRate:24,action:2}],loadList:["fishdld/animation/aniui/img_yu428_add.png","fishdld/animation/aniui/img_yu429_rgb.png","fishdld/animation/aniui/img_yu429_den.png","fishdld/animation/aniui/img_yu428_gols.png","fishdld/animation/aniui/img_yu428_nb.png","fishdld/animation/aniui/img_yu429_fzts1.png","fishdld/animation/aniui/img_yu429_fzts2.png","fishdld/animation/aniui/img_yu429_fzts3.png","fishdld/animation/aniui/img_yu429_fzts4.png","fishdld/fight/fishicon/fish_29.png","fishdld/animation/aniui/big_bg/img_add429.png","fishdld/animation/aniui/big_bg/img_add430_guang.png"],loadList3D:[]},ns.fish_die_29UI=bi,e("ui.fishdld.animation.fish_die_29UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,mr],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{y:0,x:0,visible:!0,scaleY:1.2,scaleX:1.2},compId:2,child:[{type:"Image",props:{y:0,x:0,width:256,visible:!0,skin:"fishdld/animation/aniui/img_yu428_add.png",scaleY:1.3,scaleX:1.3,rotation:0,pivotY:128,pivotX:128,name:"add",height:256,blendMode:"lighter",alpha:1},compId:3},{type:"Image",props:{y:0,x:0,width:163,visible:!0,skin:"fishdld/animation/aniui/img_fish_die_color_3.png",scaleY:1,scaleX:1,pivotY:108,pivotX:82,name:"rbg_b",height:215,alpha:1},compId:4,child:[{type:"Image",props:{y:88,x:71,width:163,visible:!0,skin:"fishdld/animation/aniui/img_yu435_den.png",pivotY:88,pivotX:70,name:"de",height:215,alpha:0},compId:7}]},{type:"Image",props:{y:0,x:0,width:132,visible:!0,skin:"fishdld/animation/aniui/img_yu428_gols.png",scaleY:1,scaleX:1,pivotY:17,pivotX:66,name:"gold",height:34,alpha:1},compId:5},{type:"Image",props:{y:33,x:0,width:229,visible:!0,skin:"fishdld/animation/aniui/img_yu428_nb.png",scaleY:1,scaleX:1,pivotY:30,pivotX:115,name:"nb",height:60,alpha:1},compId:6,child:[{type:"Label",props:{y:14,x:114,width:375,valign:"middle",text:"0",scaleY:.4,scaleX:.4,pivotY:27,pivotX:188,height:54,font:"coin_number",align:"center"},compId:12}]},{type:"Image",props:{y:-12,x:1,width:277,visible:!0,skin:"fishdld/fight/fishicon/fish_30_2.png",scaleY:.5,scaleX:.5,rotation:-6,pivotY:250,pivotX:139,name:"yu",height:250,alpha:1},compId:8},{type:"Image",props:{y:-28,x:0,width:100,visible:!0,name:"all_fzts",height:100},compId:9,child:[{type:"Image",props:{y:1,x:0,width:216,visible:!0,skin:"fishdld/animation/aniui/img_yu430_ttxy.png",scaleY:.8,scaleX:.8,pivotY:30,pivotX:108,name:"ttxy",height:59,alpha:1},compId:25},{type:"Image",props:{y:2,x:-59.5,visible:!0,skin:"fishdld/animation/aniui/img_yu430_tjxy1.png",scaleY:1.2,scaleX:1.2,rotation:0,pivotY:40,pivotX:44,name:"fzts1",alpha:0},compId:13},{type:"Image",props:{y:2,x:-19,width:77,visible:!0,skin:"fishdld/animation/aniui/img_yu430_tjxy2.png",scaleY:1.2,scaleX:1.2,rotation:0,pivotY:41,pivotX:41,name:"fzts2",height:74,alpha:0},compId:14},{type:"Image",props:{y:.33333333333333304,x:28,width:76,visible:!0,skin:"fishdld/animation/aniui/img_yu430_tjxy3.png",scaleY:1.2,scaleX:1.2,rotation:0,pivotY:40,pivotX:46,name:"fzts3",height:74,alpha:0},compId:15},{type:"Image",props:{y:2.6666666666666665,x:66,width:72,visible:!0,skin:"fishdld/animation/aniui/img_yu430_tjxy4.png",scaleY:1.2,scaleX:1.2,rotation:0,pivotY:41,pivotX:40,name:"fzts4",height:74,alpha:0},compId:16}]},{type:"Image",props:{y:0,x:0,width:64,visible:!1,skin:"fishdld/animation/aniui/big_bg/img_add430_guang.png",scaleY:6,scaleX:6,pivotY:32,pivotX:32,name:"add430_guang",height:64,blendMode:"lighter",alpha:0},compId:18},{type:"Image",props:{y:0,x:0,width:256,visible:!1,skin:"fishdld/animation/aniui/img_add430_long.png",scaleY:.5,scaleX:.5,rotation:180,pivotY:128,pivotX:128,name:"add430_long",height:256,alpha:1},compId:19},{type:"Image",props:{y:0,x:0,width:512,visible:!0,skin:"fishdld/animation/aniui/big_bg/img_add430_st.png",scaleY:1.6,scaleX:1.6,pivotY:256,pivotX:256,name:"add430_st",height:512,blendMode:"lighter",alpha:0},compId:20},{type:"Image",props:{y:0,x:0,width:256,visible:!1,skin:"fishdld/animation/aniui/img_add430_ef1.png",skewY:1,scaleY:.5,scaleX:.5,rotation:270,pivotY:128,pivotX:128,name:"add430_ef1",height:256,blendMode:"lighter",alpha:.2},compId:17},{type:"Image",props:{y:0,x:0,width:124,visible:!1,skin:"fishdld/animation/aniui/big_bg/img_add429.png",scaleY:5,scaleX:5,pivotY:62,pivotX:62,name:"add429",height:124,blendMode:"lighter",alpha:0},compId:21},{type:"Image",props:{y:0,x:0,width:124,visible:!1,skin:"fishdld/animation/aniui/big_bg/img_add429.png",scaleY:5,scaleX:5,pivotY:62,pivotX:62,name:"add429",height:124,blendMode:"lighter",alpha:0},compId:22},{type:"Image",props:{y:-9,x:0,width:282,visible:!0,skin:"fishdld/animation/aniui/big_bg/img_add429_st2.png",scaleY:.5,scaleX:.5,pivotY:96,pivotX:141,name:"add429_st2",height:295,blendMode:"lighter",alpha:0},compId:23}],animations:[{nodes:[{target:6,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:6,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:6,key:"visible",index:26}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:26},{value:2,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:28},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:32}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:26},{value:2,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:28},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:32}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:26},{value:0,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"alpha",index:28},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:32}]}},{target:5,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:23},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:28},{value:-9,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:29},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:31},{value:-3,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:33},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:35}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:23},{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:28}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:23},{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:28},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:29},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:31}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:23},{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:28},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:29},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:31}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:28},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:29}]}},{target:4,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:4,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:4,key:"visible",index:23}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:23},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:26}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:23},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:26}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:23},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:26}]}},{target:9,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:26}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:20}]}},{target:8,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:26},{value:!1,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:32},{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:33}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:26},{value:.1,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:32},{value:.55,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:37},{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:42}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:26}],rotation:[{value:-6,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0},{value:-6,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:42},{value:6,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:60},{value:-6,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:80},{value:6,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:99},{value:-6,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:120},{value:12,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:139},{value:-6,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:158},{value:12,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:177},{value:-6,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:192}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:32},{value:1,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:37}]}},{target:3,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:49}],scaleY:[{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0},{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:49},{value:2,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:55},{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:59}],scaleX:[{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0},{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:49},{value:2,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:55},{value:1.3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:59}],rotation:[{value:-359,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"rotation",index:0},{value:-359,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"rotation",index:59},{value:0,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"rotation",index:192}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:49},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:54},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:59}]}},{target:7,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:26}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:26},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:32},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:34},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:36},{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:39},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:45},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:47},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:49},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:52},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:62},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:64},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:66},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:69},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:79},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:81},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:83},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:86},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:96},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:98},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:100},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:103},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:109},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:111},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:113},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:116},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:125},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:127},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:129},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:132},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:143},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:145},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:147},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:150},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:158},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:160},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:162},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:165},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:175},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:177},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:179},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:182}]}},{target:12,keyframes:{x:[{value:114,tweenMethod:"linearNone",tween:!0,target:12,key:"x",index:0},{value:114,tweenMethod:"linearNone",tween:!0,target:12,key:"x",index:16}],scaleY:[{value:.4,tweenMethod:"linearNone",tween:!0,target:12,key:"scaleY",index:0},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,key:"scaleY",index:16},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:48},{value:.8,tweenMethod:"linearNone",tween:!0,target:12,key:"scaleY",index:50},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,key:"scaleY",index:65},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:83},{value:.8,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:85},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:100},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:120},{value:.8,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:122},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleY",index:137}],scaleX:[{value:.4,tweenMethod:"linearNone",tween:!0,target:12,key:"scaleX",index:0},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,key:"scaleX",index:16},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:48},{value:.8,tweenMethod:"linearNone",tween:!0,target:12,key:"scaleX",index:50},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,key:"scaleX",index:65},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:83},{value:.8,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:85},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:100},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:120},{value:.8,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:122},{value:.4,tweenMethod:"linearNone",tween:!0,target:12,label:null,key:"scaleX",index:137}]}},{target:17,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:17,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:17,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,key:"visible",index:16}],skewY:[{value:0,tweenMethod:"linearNone",tween:!0,target:17,key:"skewY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:17,key:"skewY",index:10}],scaleY:[{value:2.5,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleY",index:16}],scaleX:[{value:2.5,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:17,key:"scaleX",index:16}],rotation:[{value:-180,tweenMethod:"linearNone",tween:!0,target:17,key:"rotation",index:0},{value:180,tweenMethod:"linearNone",tween:!0,target:17,key:"rotation",index:13},{value:270,tweenMethod:"linearNone",tween:!0,target:17,key:"rotation",index:16}],alpha:[{value:.2,tweenMethod:"linearNone",tween:!0,target:17,key:"alpha",index:0},{value:.8,tweenMethod:"linearNone",tween:!0,target:17,key:"alpha",index:4},{value:.2,tweenMethod:"linearNone",tween:!0,target:17,key:"alpha",index:16}]}},{target:19,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:19,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:19,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,key:"visible",index:16}],scaleY:[{value:1.5,tweenMethod:"linearNone",tween:!0,target:19,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:19,key:"scaleY",index:16}],scaleX:[{value:1.5,tweenMethod:"linearNone",tween:!0,target:19,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:19,key:"scaleX",index:16}],rotation:[{value:-180,tweenMethod:"linearNone",tween:!0,target:19,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:19,key:"rotation",index:10},{value:180,tweenMethod:"linearNone",tween:!0,target:19,key:"rotation",index:16}],alpha:[{value:.2,tweenMethod:"linearNone",tween:!0,target:19,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:19,key:"alpha",index:4}]}},{target:18,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:16},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:26},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:48},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:53},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:83},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:88},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:120},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:125}],scaleY:[{value:4,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:0},{value:4,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:48},{value:6,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:53},{value:4,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"scaleY",index:83},{value:6,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"scaleY",index:88},{value:4,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"scaleY",index:120},{value:6,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"scaleY",index:125}],scaleX:[{value:4,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:0},{value:4,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:48},{value:6,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:53},{value:4,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"scaleX",index:83},{value:6,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"scaleX",index:88},{value:4,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"scaleX",index:120},{value:6,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"scaleX",index:125}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:16},{value:0,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:21},{value:0,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:26},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:48},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:50},{value:0,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:53},{value:1,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"alpha",index:83},{value:1,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"alpha",index:85},{value:0,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"alpha",index:88},{value:1,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"alpha",index:120},{value:1,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"alpha",index:122},{value:0,tweenMethod:"linearNone",tween:!0,target:18,label:null,key:"alpha",index:125}]}},{target:20,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:20,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,key:"visible",index:16}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:0},{value:.15,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:16},{value:1.6,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:23}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:0},{value:.15,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:16},{value:1.6,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:23}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"alpha",index:16},{value:1,tweenMethod:"linearNone",tween:!0,target:20,key:"alpha",index:17},{value:0,tweenMethod:"linearNone",tween:!0,target:20,key:"alpha",index:23}]}},{target:21,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:16},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:26},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:48},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:56},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:83},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:91},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:120},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:128}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleY",index:16},{value:5,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleY",index:26},{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleY",index:48},{value:5,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleY",index:56},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleY",index:83},{value:5,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleY",index:91},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleY",index:120},{value:5,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleY",index:128}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleX",index:16},{value:5,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleX",index:26},{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleX",index:48},{value:5,tweenMethod:"linearNone",tween:!0,target:21,key:"scaleX",index:56},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleX",index:83},{value:5,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleX",index:91},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleX",index:120},{value:5,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"scaleX",index:128}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:21,key:"alpha",index:26},{value:1,tweenMethod:"linearNone",tween:!0,target:21,key:"alpha",index:48},{value:0,tweenMethod:"linearNone",tween:!0,target:21,key:"alpha",index:56},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"alpha",index:83},{value:0,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"alpha",index:91},{value:1,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"alpha",index:120},{value:0,tweenMethod:"linearNone",tween:!0,target:21,label:null,key:"alpha",index:128}]}},{target:22,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:22,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:22,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,key:"visible",index:51},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,key:"visible",index:60},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:86},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:95},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:123},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:132}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:22,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:22,key:"scaleY",index:51},{value:5,tweenMethod:"linearNone",tween:!0,target:22,key:"scaleY",index:60},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleY",index:86},{value:5,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleY",index:95},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleY",index:123},{value:5,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleY",index:132}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:22,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:22,key:"scaleX",index:51},{value:5,tweenMethod:"linearNone",tween:!0,target:22,key:"scaleX",index:60},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleX",index:86},{value:5,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleX",index:95},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleX",index:123},{value:5,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"scaleX",index:132}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:22,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:22,key:"alpha",index:51},{value:0,tweenMethod:"linearNone",tween:!0,target:22,key:"alpha",index:60},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"alpha",index:86},{value:0,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"alpha",index:95},{value:1,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"alpha",index:123},{value:0,tweenMethod:"linearNone",tween:!0,target:22,label:null,key:"alpha",index:132}]}},{target:23,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:23,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:23,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:23,key:"visible",index:16}],scaleY:[{value:.8,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:16},{value:.5,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:26}],scaleX:[{value:.8,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:16},{value:.5,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:26}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"alpha",index:16},{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"alpha",index:18},{value:0,tweenMethod:"linearNone",tween:!0,target:23,key:"alpha",index:26}]}},{target:25,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:25,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:25,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:25,key:"visible",index:42}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:25,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:25,key:"alpha",index:42},{value:1,tweenMethod:"linearNone",tween:!0,target:25,key:"alpha",index:48}]}},{target:13,keyframes:{scaleY:[{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:20},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:25},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:49},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:53},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleY",index:70},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:74},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:86},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:90},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:105},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:109},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:123},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:127},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:140},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleY",index:144}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:20},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:25},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:49},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:53},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,key:"scaleX",index:70},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:74},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:86},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:90},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:105},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:109},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:123},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:127},{value:.6,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:140},{value:1.2,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"scaleX",index:144}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:20},{value:1,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:25},{value:1,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:49},{value:.8,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:50},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:53},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:70},{value:.8,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:71},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:74},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:86},{value:.8,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:87},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:90},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:105},{value:.8,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:106},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:109},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:123},{value:.8,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:124},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:127},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:140},{value:.8,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:141},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:144}]}},{target:14,keyframes:{x:[{value:-19,tweenMethod:"linearNone",tween:!0,target:14,key:"x",index:0},{value:-19,tweenMethod:"linearNone",tween:!0,target:14,key:"x",index:22}],scaleY:[{value:.6,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:22},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:27},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:52},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:56},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:73},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:77},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:89},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:93},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:108},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:112},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:126},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:130},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:143},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleY",index:147}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:22},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:27},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:52},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:56},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,key:"scaleX",index:71},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:73},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:77},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:87},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:89},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:93},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:106},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:108},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:112},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:124},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:126},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:130},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:141},{value:.6,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:143},{value:1.2,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"scaleX",index:147}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:22},{value:1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:27},{value:1,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:49},{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:50},{value:1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:52},{value:.8,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:53},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:56},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:71},{value:1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:73},{value:.8,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:74},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:77},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:87},{value:1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:89},{value:.8,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:90},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:93},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:106},{value:1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:108},{value:.8,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:109},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:112},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:124},{value:1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:126},{value:.8,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:127},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:130},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:141},{value:1,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:143},{value:.8,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:144},{value:0,tweenMethod:"linearNone",tween:!0,target:14,label:null,key:"alpha",index:147}]}},{target:15,keyframes:{x:[{value:28,tweenMethod:"linearNone",tween:!0,target:15,key:"x",index:0},{value:28,tweenMethod:"linearNone",tween:!0,target:15,key:"x",index:24}],scaleY:[{value:.6,tweenMethod:"linearNone",tween:!0,target:15,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:24},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:29},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:55},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:59},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,key:"scaleY",index:71},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:76},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:80},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:87},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:92},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:96},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:106},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:111},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:115},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:124},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:129},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:133},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:141},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:146},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleY",index:150}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!0,target:15,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:24},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:29},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:55},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:59},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,key:"scaleX",index:71},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:76},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:80},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:87},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:92},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:96},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:106},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:111},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:115},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:124},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:129},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:133},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:141},{value:.6,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:146},{value:1.2,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"scaleX",index:150}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:15,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:24},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:29},{value:1,tweenMethod:"linearNone",tween:!0,target:15,key:"alpha",index:49},{value:0,tweenMethod:"linearNone",tween:!0,target:15,key:"alpha",index:50},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:55},{value:.8,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:56},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:59},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:71},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:76},{value:.8,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:77},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:80},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:87},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:92},{value:.8,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:93},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:96},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:106},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:111},{value:.8,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:112},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:115},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:124},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:129},{value:.8,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:130},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:133},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:141},{value:1,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:146},{value:.8,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:147},{value:0,tweenMethod:"linearNone",tween:!0,target:15,label:null,key:"alpha",index:150}]}},{target:16,keyframes:{x:[{value:66,tweenMethod:"linearNone",tween:!0,target:16,key:"x",index:0}],scaleY:[{value:.6,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:26},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:31},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:58},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:62},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleY",index:71},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:79},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:83},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:87},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:95},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:99},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:106},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:114},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:118},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:124},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:132},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:136},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:141},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:149},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleY",index:153}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:26},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:31},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:58},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:62},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,key:"scaleX",index:71},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:79},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:83},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:87},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:95},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:99},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:106},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:114},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:118},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:124},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:132},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:136},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:141},{value:.6,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:149},{value:1.2,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"scaleX",index:153}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:16,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:26},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:31},{value:1,tweenMethod:"linearNone",tween:!0,target:16,key:"alpha",index:49},{value:0,tweenMethod:"linearNone",tween:!0,target:16,key:"alpha",index:50},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:58},{value:.8,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:59},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:62},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:71},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:79},{value:.8,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:80},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:83},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:87},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:95},{value:.8,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:96},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:99},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:106},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:114},{value:.8,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:115},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:118},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:124},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:132},{value:.8,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:133},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:136},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:141},{value:1,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:149},{value:.8,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:150},{value:0,tweenMethod:"linearNone",tween:!0,target:16,label:null,key:"alpha",index:153}]}}],name:"main",id:1,frameRate:24,action:1}],loadList:["fishdld/animation/aniui/img_yu428_add.png","fishdld/animation/aniui/img_fish_die_color_3.png","fishdld/animation/aniui/img_yu435_den.png","fishdld/animation/aniui/img_yu428_gols.png","fishdld/animation/aniui/img_yu428_nb.png","fishdld/fight/fishicon/fish_30_2.png","fishdld/animation/aniui/img_yu430_ttxy.png","fishdld/animation/aniui/img_yu430_tjxy1.png","fishdld/animation/aniui/img_yu430_tjxy2.png","fishdld/animation/aniui/img_yu430_tjxy3.png","fishdld/animation/aniui/img_yu430_tjxy4.png","fishdld/animation/aniui/big_bg/img_add430_guang.png","fishdld/animation/aniui/img_add430_long.png","fishdld/animation/aniui/big_bg/img_add430_st.png","fishdld/animation/aniui/img_add430_ef1.png","fishdld/animation/aniui/big_bg/img_add429.png","fishdld/animation/aniui/big_bg/img_add429_st2.png"],loadList3D:[]},ns.fish_die_30UI=bi,e("ui.fishdld.animation.fish_die_30UI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi,Qo,Bt,mr],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{scaleY:.6,scaleX:.6},compId:2,child:[{type:"Image",props:{y:0,x:0,width:124,skin:"fishdld/animation/aniui/img_yu414_add.png",scaleY:.1,scaleX:.1,pivotY:62,pivotX:62,name:"add",height:124,alpha:1},compId:8},{type:"Sprite",props:{scaleY:.1,scaleX:.1,name:"yu414"},compId:11},{type:"Image",props:{y:-117,x:-114,skin:"fishdld/animation/aniui/img_yu414_bg.png",name:"bhbg"},compId:9},{type:"Image",props:{y:0,x:0,width:188,skin:"fishdld/animation/aniui/img_yu414_360.png",rotation:0,pivotY:94,pivotX:94,name:"360",height:188},compId:7},{type:"Image",props:{y:29,x:13,width:120,skin:"fishdld/animation/aniui/img_yu414_d1.png",pivotX:120,name:"d1",height:86,alpha:1},compId:10},{type:"Image",props:{y:12,x:-28,width:120,skin:"fishdld/animation/aniui/img_yu414_d1.png",rotation:89,pivotX:120,name:"d2",height:86,alpha:.8},compId:12},{type:"Image",props:{y:-72,x:48,width:120,skin:"fishdld/animation/aniui/img_yu414_d1.png",rotation:180,pivotY:43,pivotX:60,name:"d3",height:86,alpha:0},compId:13},{type:"Image",props:{y:46,x:72,width:120,skin:"fishdld/animation/aniui/img_yu414_d1.png",rotation:-88,pivotY:43,pivotX:60,name:"d4",height:86,alpha:0},compId:14},{type:"Sprite",props:{y:55,x:-53,width:127,rotation:0,name:"nb",height:40},compId:18,child:[{type:"Label",props:{y:-17,x:52,width:298,valign:"middle",text:"0",scaleY:.7,scaleX:.7,height:57,font:"coin_number",anchorY:.5,anchorX:.5,align:"center"},compId:19}]},{type:"Image",props:{y:-42,x:-1,width:150,var:"fish_icon",skin:"fishdld/fight/fishicon/fish_14.png",rotation:0,height:150,anchorY:.5,anchorX:.5},compId:16}],animations:[{nodes:[{target:10,keyframes:{alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:12}]}},{target:12,keyframes:{alpha:[{value:.8,tweenMethod:"linearNone",tween:!0,target:12,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:12,key:"alpha",index:2},{value:0,tweenMethod:"linearNone",tween:!0,target:12,key:"alpha",index:4}]}},{target:13,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:13,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:6},{value:0,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:8}]}},{target:14,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:14,key:"alpha",index:12}]}},{target:8,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"y",index:0}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"x",index:0}],scaleY:[{value:1.8,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:0},{value:2.8,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:12}],scaleX:[{value:1.8,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:0},{value:2.8,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:12}],pivotY:[{value:62,tweenMethod:"linearNone",tween:!0,target:8,key:"pivotY",index:0}],pivotX:[{value:62,tweenMethod:"linearNone",tween:!0,target:8,key:"pivotX",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:12}]}},{target:16,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:16,key:"rotation",index:0},{value:-4,tweenMethod:"linearNone",tween:!0,target:16,key:"rotation",index:3},{value:4,tweenMethod:"linearNone",tween:!0,target:16,key:"rotation",index:12},{value:0,tweenMethod:"linearNone",tween:!0,target:16,key:"rotation",index:15}]}},{target:7,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:15}]}}],name:"ani1",id:1,frameRate:24,action:2}],loadList:["fishdld/animation/aniui/img_yu414_add.png","fishdld/animation/aniui/img_yu414_bg.png","fishdld/animation/aniui/img_yu414_360.png","fishdld/animation/aniui/img_yu414_d1.png","fishdld/fight/fishicon/fish_14.png"],loadList3D:[]},ns.fish_die_lotteryUI=bi,e("ui.fishdld.animation.fish_die_lotteryUI",bi),(bi=function(){T(n,ko);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Scene",props:{width:1136,height:640},compId:2,child:[{type:"Image",props:{y:0,x:0,width:128,skin:"fishdld/animation/aniui/img_efmini_yuanquan.png",scaleY:2.25,scaleX:2.25,name:"yq",height:128,anchorY:.5,anchorX:.5,alpha:0},compId:4},{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aniui/big_bg/img_efmini_bgguang.png",scaleY:1,scaleX:1,name:"guang",blendMode:"lighter",anchorY:.5,anchorX:.5,alpha:1},compId:5},{type:"Image",props:{y:0,x:0,visible:!0,skin:"fishdld/animation/aniui/big_bg/img_efmini_bgguang2.png",scaleY:1,scaleX:1,name:"guang2",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:6},{type:"Image",props:{y:0,x:0,width:128,skin:"fishdld/animation/aniui/img_efmini_yuanquan.png",scaleY:2.25,scaleX:2.25,name:"yq2",height:128,anchorY:.5,anchorX:.5,alpha:0},compId:7},{type:"Image",props:{y:-19,x:48,skin:"fishdld/animation/aniui/img_efmini_xin.png",scaleY:1,scaleX:1,name:"xin",blendMode:"lighter",anchorY:.5,anchorX:.5,alpha:0},compId:8},{type:"Image",props:{y:-19,x:48,skin:"fishdld/animation/aniui/img_efmini_xin.png",scaleY:1,scaleX:1,name:"xin2",blendMode:"lighter",anchorY:.5,anchorX:.5,alpha:0},compId:9},{type:"Image",props:{y:-32,x:68,skin:"fishdld/animation/aniui/img_efmini_xin.png",name:"xin3",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:10},{type:"Image",props:{y:-32,x:68,skin:"fishdld/animation/aniui/img_efmini_xin.png",name:"xin4",blendMode:"lighter",anchorY:.5,anchorX:.5},compId:11}],animations:[{nodes:[{target:5,keyframes:{scaleY:[{value:.9,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:3}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:3}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:3}]}},{target:6,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:6,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:6,key:"visible",index:5},{value:!1,tweenMethod:"linearNone",tween:!1,target:6,label:null,key:"visible",index:20}],skin:[{value:"fishdld/animation/aniui/big_bg/img_efmini_bgguang2.png",tweenMethod:"linearNone",tween:!1,target:6,key:"skin",index:0},{value:"fishdld/animation/aniui/big_bg/img_efmini_bgguang3.png",tweenMethod:"linearNone",tween:!1,target:6,key:"skin",index:4}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:5}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:5}]}},{target:4,keyframes:{x:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"x",index:1}],scaleY:[{value:2.25,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:2},{value:3,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:14}],scaleX:[{value:2.25,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:2},{value:3,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:14}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"alpha",index:2},{value:.5,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:14}]}},{target:7,keyframes:{scaleY:[{value:2.25,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"scaleY",index:11},{value:1.5,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"scaleY",index:17}],scaleX:[{value:2.25,tweenMethod:"linearNone",tween:!0,target:7,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"scaleX",index:11},{value:1.5,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"scaleX",index:17}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:11},{value:.2,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:13},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:17}]}},{target:8,keyframes:{y:[{value:-19,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"y",index:0},{value:-14.333333333333329,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"y",index:6},{value:-134,tweenMethod:"linearNone",tween:!0,target:8,key:"y",index:12}],x:[{value:48,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"x",index:0},{value:-10.285714285714285,tweenMethod:"linearNone",tween:!0,target:8,key:"x",index:6},{value:-19.5,tweenMethod:"linearNone",tween:!0,target:8,key:"x",index:12}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:6},{value:1.5,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"scaleY",index:8},{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:12}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:6},{value:1.5,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"scaleX",index:8},{value:.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:12}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:8,key:"alpha",index:8},{value:0,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"alpha",index:12}]}},{target:9,keyframes:{y:[{value:-19,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"y",index:0},{value:18.444444444444443,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"y",index:7},{value:128,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"y",index:13}],x:[{value:48,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"x",index:0},{value:-11.821428571428571,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"x",index:7},{value:-43,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"x",index:13}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"scaleY",index:7},{value:1.5,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"scaleY",index:9},{value:.5,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"scaleY",index:13}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"scaleX",index:7},{value:1.5,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"scaleX",index:9},{value:.5,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"scaleX",index:13}],rotation:[{value:7,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"alpha",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"alpha",index:9},{value:0,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"alpha",index:13}]}},{target:10,keyframes:{y:[{value:-19,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"y",index:9},{value:22,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"y",index:15}],x:[{value:48,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"x",index:0},{value:17.107142857142858,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"x",index:9},{value:136,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"x",index:15}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleY",index:9},{value:1.5,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleY",index:11},{value:.5,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleY",index:15}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleX",index:9},{value:1.5,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleX",index:11},{value:.5,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"scaleX",index:15}],rotation:[{value:21,tweenMethod:"linearNone",tween:!0,target:10,key:"rotation",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:11},{value:0,tweenMethod:"linearNone",tween:!0,target:10,label:null,key:"alpha",index:15}]}},{target:11,keyframes:{y:[{value:-19,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"y",index:7},{value:-17.333333333333336,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"y",index:14}],x:[{value:48,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"x",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"x",index:7},{value:-83.5,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"x",index:14}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleY",index:7},{value:1.5,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleY",index:10},{value:.5,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleY",index:14}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleX",index:7},{value:1.5,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleX",index:10},{value:.5,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"scaleX",index:14}],rotation:[{value:28,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"rotation",index:0}],name:[{value:"xin4",tweenMethod:"linearNone",tween:!1,target:11,key:"name",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:11,label:null,key:"alpha",index:14}]}}],name:"ani1",id:1,frameRate:24,action:1}],loadList:["fishdld/animation/aniui/img_efmini_yuanquan.png","fishdld/animation/aniui/big_bg/img_efmini_bgguang.png","fishdld/animation/aniui/big_bg/img_efmini_bgguang2.png","fishdld/animation/aniui/img_efmini_xin.png","fishdld/animation/aniui/big_bg/img_efmini_bgguang3.png"],loadList3D:[]},ns.fish_die_mini_explodeUI=bi,e("ui.fishdld.animation.fish_die_mini_explodeUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,Qo,pi,mr],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:0,x:0,width:256,skin:"fishdld/animation/aniui/img_yu428_add.png",scaleY:.8,scaleX:.8,pivotY:128,pivotX:128,name:"add",height:256},compId:3},{type:"Image",props:{y:0,x:0,width:120,skin:"fishdld/animation/aniui/img_fish_die_color_0.png",pivotY:61,pivotX:60,name:"color",height:122},compId:4,child:[{type:"Image",props:{y:60,x:60,width:103,skin:"fishdld/animation/aniui/img_yu428_1.png",pivotY:53,pivotX:52,name:"de",height:106},compId:7}]},{type:"Image",props:{y:0,x:0,width:132,skin:"fishdld/animation/aniui/img_yu428_gols.png",pivotY:17,pivotX:66,name:"gold",height:34},compId:5},{type:"Image",props:{y:25,x:0,width:191,skin:"fishdld/animation/aniui/img_yu428_nb.png",pivotY:26,pivotX:96,name:"nb",height:51},compId:6,child:[{type:"Label",props:{y:5,x:44,width:375,valign:"middle",text:"0",scaleY:.4,scaleX:.4,pivotY:13,pivotX:61,height:54,font:"coin_number",align:"center"},compId:10}]},{type:"Image",props:{y:-22,x:-3,skin:"fishdld/animation/aniui/img_fish_die_title_0.png",scaleY:.7,scaleX:.7,name:"type",anchorY:.5,anchorX:.5},compId:9},{type:"Image",props:{y:-63,x:-6,width:76,skin:"fishdld/fight/fishicon/fish_28.png",name:"fish_icon",height:75,anchorY:.5,anchorX:.5},compId:8}],animations:[{nodes:[{target:6,keyframes:{scaleY:[{value:2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:6}],scaleX:[{value:2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:6}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"alpha",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:6}]}},{target:5,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:5},{value:-9,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:6},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:8},{value:-3,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:12}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:5}],scaleY:[{value:.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:5},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:8}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:5},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:8}]}},{target:4,keyframes:{scaleY:[{value:2,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:3}],scaleX:[{value:2,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:3}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:3}]}},{target:9,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:0},{value:12,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:10},{value:-12,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:20},{value:12,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"rotation",index:30},{value:-12,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"rotation",index:40},{value:12,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"rotation",index:50},{value:-12,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:60},{value:12,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:70},{value:-12,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:80},{value:12,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:90}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:15}]}},{target:8,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:7}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0},{value:-12,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:10},{value:12,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:20},{value:-12,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:30},{value:12,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:40},{value:-12,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:50},{value:12,tweenMethod:"linearNone",tween:!0,target:8,label:null,key:"rotation",index:60},{value:-12,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:70},{value:12,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:80},{value:-12,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:90}]}},{target:3,keyframes:{scaleY:[{value:.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:6},{value:.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:10}],scaleX:[{value:.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:6},{value:.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:10}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:0},{value:60,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:13},{value:120,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"rotation",index:38},{value:180,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:63},{value:240,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:90}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:10}]}},{target:7,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:16},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:18},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:20},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:23},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:33},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:36},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:38},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:41},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:48},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:51},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:53},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:56},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:63},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:66},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:68},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:71}]}}],name:"ani1",id:1,frameRate:24,action:2}],loadList:["fishdld/animation/aniui/img_yu428_add.png","fishdld/animation/aniui/img_fish_die_color_0.png","fishdld/animation/aniui/img_yu428_1.png","fishdld/animation/aniui/img_yu428_gols.png","fishdld/animation/aniui/img_yu428_nb.png","fishdld/animation/aniui/img_fish_die_title_0.png","fishdld/fight/fishicon/fish_28.png"],loadList3D:[]},ns.fish_die_typeUI=bi,e("ui.fishdld.animation.fish_die_typeUI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,mr,es,To,pi,Bt],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{rotation:360},compId:2,child:[{type:"Box",props:{width:1,height:1,centerY:0,centerX:0},compId:37,child:[{type:"Image",props:{y:3,x:0,visible:!0,skin:"fishdld/animation/aniui/big_prize/img_ywjc_Black.png",scaleY:3,scaleX:3,name:"Black",anchorY:.5,anchorX:.5,alpha:.45},compId:4},{type:"Image",props:{y:34,x:0,visible:!1,skin:"fishdld/animation/aniui/big_bg/img_addsg.png",scaleY:1.6438709677419356,scaleX:1.8,rotation:0,name:"addsg",anchorY:.5,anchorX:.5},compId:3},{type:"Sprite",props:{y:-13.666666666666668,x:0,visible:!0,scaleY:1.125,scaleX:1.025,name:"bsbg_all",alpha:1},compId:10,child:[{type:"Image",props:{y:0,x:0,skin:"fishdld/animation/aniui/big_prize/img_ywjc_bsbg.png",name:"bsbg",anchorY:.5,anchorX:.5},compId:5},{type:"Image",props:{y:-10,x:-129,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding01.png",name:"1"},compId:11},{type:"Image",props:{y:-36,x:-129,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding02.png",name:"2"},compId:12},{type:"Image",props:{y:-54,x:-121,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding03.png",name:"3"},compId:13},{type:"Image",props:{y:-66,x:-103,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding04.png",name:"4"},compId:14},{type:"Image",props:{y:-73,x:-77,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding05.png",name:"5"},compId:15},{type:"Image",props:{y:-74,x:-52,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding06.png",name:"6"},compId:16},{type:"Image",props:{y:-74,x:-17.5,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding07.png",name:"7"},compId:17},{type:"Image",props:{y:-73,x:16.5,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding08.png",name:"8"},compId:18},{type:"Image",props:{y:-37,x:88,width:49,visible:!0,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding09.png",rotation:-6,pivotY:32,pivotX:39,name:"9",height:41},compId:19},{type:"Image",props:{y:-14,x:107,width:39,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding10.png",rotation:-10,pivotY:44,pivotX:29,name:"10",height:53},compId:22},{type:"Image",props:{y:-34,x:91,width:23,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding11.png",rotation:-15,name:"11",height:62},compId:21},{type:"Image",props:{y:23,x:103.5,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_ding12.png",name:"12"},compId:20}]},{type:"Image",props:{y:102,x:-80,width:113,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_stL1.png",scaleY:.26363636363636367,scaleX:.26363636363636367,pivotY:118,pivotX:113,name:"L1",height:118},compId:23},{type:"Image",props:{y:113,x:-53,width:123,visible:!0,skin:"fishdld/animation/aniui/big_prize/img_ywjc_stL2.png",scaleY:.1,scaleX:.1,pivotY:77,pivotX:123,name:"L2",height:77},compId:24},{type:"Image",props:{y:103,x:75,width:114,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_stR1.png",scaleY:.32500000000000007,scaleX:.32500000000000007,pivotY:118,name:"R1",height:118},compId:25},{type:"Image",props:{y:113,x:44,width:123,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_stR2.png",scaleY:.19000000000000006,scaleX:.19000000000000006,pivotY:77,name:"R2",height:77},compId:26},{type:"Sprite",props:{y:116,x:-10,width:120,visible:!0,scaleY:1,scaleX:1,pivotY:69,name:"bs_all",height:108,alpha:1},compId:6,child:[{type:"Image",props:{y:0,x:0,visible:!0,skin:"fishdld/animation/aniui/big_prize/img_ywjc_bs1.png",name:"bs",anchorY:.5,anchorX:.5},compId:7},{type:"Image",props:{y:-4,x:113.5,width:211,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_bs2_2.png",pivotY:115,pivotX:190,name:"bs2",height:115},compId:9},{type:"Image",props:{y:89,x:-3,width:235,visible:!1,skin:"fishdld/animation/aniui/big_prize/img_ywjc_bs2_1.png",pivotY:135,pivotX:118,name:"bs1",height:154},compId:8}]},{type:"Image",props:{y:-51.3,x:-.17880794701986755,width:554,visible:!0,skin:"fishdld/animation/aniui/big_prize/img_ywjc_text.png",scaleY:.74,scaleX:1,pivotY:137,pivotX:277,name:"ywjc_text",height:137,alpha:.6},compId:28},{type:"Sprite",props:{y:183,x:-1,width:538,visible:!1,scaleY:1,scaleX:1,pivotY:38,pivotX:269,height:76},compId:30,child:[{type:"Image",props:{y:38,x:269,width:269,skin:"fishdld/animation/aniui/big_prize/img_ywjc_textbg.png",scaleX:2,name:"textbg",height:76,anchorY:.5,anchorX:.5},compId:27},{type:"Label",props:{y:-15,x:0,width:540,var:"money",valign:"middle",text:"0",height:73,font:"coin_number",color:"#ffffff",align:"center"},compId:29}]},{type:"Image",props:{y:34,x:-44,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_xin xin.png",scaleY:1,scaleX:1,name:"xing",anchorY:.5,anchorX:.5,alpha:.7804878048780488},compId:35},{type:"Image",props:{y:12,x:41.5,visible:!1,skin:"fishdld/animation/anigun/gun6/img_gun6_xin xin.png",scaleY:1,scaleX:1,name:"xing",anchorY:.5,anchorX:.5,alpha:.7906976744186046},compId:36}]}],animations:[{nodes:[{target:11,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:11,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,key:"visible",index:2},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,key:"visible",index:3},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:25},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:26},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:48},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:49},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:71},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:72},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:94},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:95},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:117},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:118},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:140},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:141},{value:!0,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:163},{value:!1,tweenMethod:"linearNone",tween:!1,target:11,label:null,key:"visible",index:164}]}},{target:12,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:12,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,key:"visible",index:3},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,key:"visible",index:5},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:26},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:28},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:49},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:51},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:72},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:74},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:95},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:97},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:118},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:120},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:141},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:143},{value:!0,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:164},{value:!1,tweenMethod:"linearNone",tween:!1,target:12,label:null,key:"visible",index:166}]}},{target:13,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:13,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,key:"visible",index:5},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,key:"visible",index:7},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:28},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:30},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:51},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:53},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:74},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:76},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:97},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:99},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:120},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:122},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:143},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:145},{value:!0,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:166},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,label:null,key:"visible",index:168}]}},{target:14,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:14,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,key:"visible",index:7},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,key:"visible",index:9},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:30},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:32},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:53},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:55},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:76},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:78},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:99},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:101},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:122},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:124},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:145},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:147},{value:!0,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:168},{value:!1,tweenMethod:"linearNone",tween:!1,target:14,label:null,key:"visible",index:170}]}},{target:15,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:15,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,key:"visible",index:9},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,key:"visible",index:11},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:32},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:34},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:55},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:57},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:78},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:80},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:101},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:103},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:124},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:126},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:147},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:149},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:170},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:172}]}},{target:16,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:16,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,key:"visible",index:11},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,key:"visible",index:13},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:34},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:36},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:57},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:59},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:80},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:82},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:103},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:105},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:126},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:128},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:149},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:151},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:172},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:174}]}},{target:17,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:17,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,key:"visible",index:13},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,key:"visible",index:15},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:36},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:38},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:59},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:61},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:82},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:84},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:105},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:107},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:128},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:130},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:151},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:153},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:174},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:176}]}},{target:18,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:15},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:17},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:38},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:40},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:61},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:63},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:84},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:86},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:107},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:109},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:130},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:132},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:153},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:155},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:176},{value:!1,tweenMethod:"linearNone",tween:!1,target:18,label:null,key:"visible",index:178}]}},{target:19,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:19,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,key:"visible",index:17},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,key:"visible",index:19},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:40},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:42},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:63},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:65},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:86},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:88},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:109},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:111},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:132},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:134},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:155},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:157},{value:!0,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:178},{value:!1,tweenMethod:"linearNone",tween:!1,target:19,label:null,key:"visible",index:180}]}},{target:22,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:22,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,key:"visible",index:19},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,key:"visible",index:21},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:42},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:44},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:65},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:67},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:88},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:90},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:111},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:113},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:134},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:136},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:157},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:159},{value:!0,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:180},{value:!1,tweenMethod:"linearNone",tween:!1,target:22,label:null,key:"visible",index:182}]}},{target:21,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:21},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,key:"visible",index:23},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:44},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:46},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:67},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:69},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:90},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:92},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:113},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:115},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:136},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:138},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:159},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:161},{value:!0,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:182},{value:!1,tweenMethod:"linearNone",tween:!1,target:21,label:null,key:"visible",index:184}]}},{target:20,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:20,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,key:"visible",index:23},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,key:"visible",index:25},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:46},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:48},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:69},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:71},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:92},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:94},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:115},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:117},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:138},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:140},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:161},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:163},{value:!0,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:184},{value:!1,tweenMethod:"linearNone",tween:!1,target:20,label:null,key:"visible",index:186}]}},{target:30,keyframes:{y:[{value:183,tweenMethod:"linearNone",tween:!0,target:30,key:"y",index:0},{value:183,tweenMethod:"linearNone",tween:!0,target:30,key:"y",index:169},{value:73,tweenMethod:"linearNone",tween:!0,target:30,key:"y",index:176}],x:[{value:-1,tweenMethod:"linearNone",tween:!0,target:30,key:"x",index:0},{value:-1,tweenMethod:"linearNone",tween:!0,target:30,key:"x",index:169}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:30,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"visible",index:62},{value:!0,tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"visible",index:98},{value:!0,tweenMethod:"linearNone",tween:!1,target:30,label:null,key:"visible",index:135}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleY",index:62},{value:1.6,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:63},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:78},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:98},{value:1.6,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:99},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:114},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:135},{value:1.6,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:136},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleY",index:151}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:62},{value:1.6,tweenMethod:"linearNone",tween:!0,target:30,key:"scaleX",index:63},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:78},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:98},{value:1.6,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:99},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:114},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:135},{value:1.6,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:136},{value:1,tweenMethod:"linearNone",tween:!0,target:30,label:null,key:"scaleX",index:151}]}},{target:28,keyframes:{y:[{value:-36,tweenMethod:"linearNone",tween:!0,target:28,key:"y",index:0},{value:-53,tweenMethod:"linearNone",tween:!0,target:28,key:"y",index:20},{value:-34,tweenMethod:"linearNone",tween:!0,target:28,key:"y",index:23},{value:-37,tweenMethod:"linearNone",tween:!0,target:28,key:"y",index:25},{value:-36,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:27},{value:-36,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:62},{value:-40,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:63},{value:-36,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:95},{value:-36,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:98},{value:-40,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:99},{value:-36,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:131},{value:-36,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:135},{value:-40,tweenMethod:"linearNone",tween:!0,target:28,key:"y",index:136},{value:-36,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:140},{value:-36,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:149},{value:-61.5,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:151},{value:-68,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:154},{value:107.5,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"y",index:157}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:28,key:"x",index:0},{value:-1.5,tweenMethod:"linearNone",tween:!0,target:28,key:"x",index:151},{value:-1.5,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"x",index:154},{value:-9,tweenMethod:"linearNone",tween:!0,target:28,key:"x",index:157}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:28,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:28,key:"visible",index:15}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleY",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleY",index:15},{value:1.1,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleY",index:20},{value:.9,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleY",index:23},{value:1.01,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleY",index:25},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:27},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:62},{value:1.1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:63},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:95},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:98},{value:1.1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:99},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:131},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:135},{value:1.1,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleY",index:136},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:140},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:149},{value:1.1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:151},{value:1.15,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:154},{value:1.2,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleY",index:157}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleX",index:15},{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleX",index:20},{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleX",index:23},{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleX",index:25},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:27},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:62},{value:.9,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:63},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:95},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:98},{value:.9,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:99},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:131},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:135},{value:.9,tweenMethod:"linearNone",tween:!0,target:28,key:"scaleX",index:136},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:140},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:149},{value:.9,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:151},{value:.85,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:154},{value:.5,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"scaleX",index:157}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:28,key:"alpha",index:15},{value:1,tweenMethod:"linearNone",tween:!0,target:28,key:"alpha",index:20},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:27},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:62},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:95},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:98},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:131},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:135},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:140},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:149},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:151},{value:1,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:154},{value:0,tweenMethod:"linearNone",tween:!0,target:28,label:null,key:"alpha",index:157}]}},{target:6,keyframes:{y:[{value:116,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:0},{value:28,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:5},{value:118,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:8},{value:71,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:11},{value:116,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:14},{value:116,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:36},{value:104,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:38},{value:112,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:40},{value:128,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:42},{value:104,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:44},{value:105,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:46},{value:103,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:48},{value:94,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:50},{value:83.5,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:52},{value:97,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:54},{value:86,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:55},{value:84,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:56},{value:94,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:57},{value:82,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:58},{value:90,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:59},{value:95,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:60},{value:116,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:61},{value:90,tweenMethod:"linearNone",tween:!0,target:6,key:"y",index:62},{value:116,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:72},{value:116,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:98},{value:90,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:99},{value:116,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:109},{value:116,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:135},{value:90,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:136},{value:116,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:146},{value:116,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"y",index:172}],x:[{value:-10,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0},{value:-10,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:36},{value:-23.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:38},{value:2.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:40},{value:-29.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:42},{value:-16,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:44},{value:-28,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:46},{value:9,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:48},{value:-13.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:50},{value:-.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:52},{value:-15.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:54},{value:-18,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:55},{value:1.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:56},{value:-16.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:57},{value:-23.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:58},{value:.5,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:59},{value:-19,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:60},{value:-10,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"x",index:61}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:6,key:"visible",index:0}],scaleY:[{value:.2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:5},{value:.8,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:8},{value:1.1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:14},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:61},{value:1.2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleY",index:62},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:72},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:98},{value:1.2,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:99},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:109},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:135},{value:1.2,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:136},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:146},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleY",index:172}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:0},{value:.9,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:5},{value:1.2,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:8},{value:.9,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:14},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:61},{value:.9,tweenMethod:"linearNone",tween:!0,target:6,key:"scaleX",index:62},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:72},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:98},{value:.9,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:99},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:109},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:135},{value:.9,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:136},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:146},{value:1,tweenMethod:"linearNone",tween:!0,target:6,label:null,key:"scaleX",index:172}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:5}]}},{target:26,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:26,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:26,key:"visible",index:20}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:20},{value:1.1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:23},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:26},{value:1.05,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:29},{value:1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:32},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:65},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:66},{value:1.1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:69},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:72},{value:1.05,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:75},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:78},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:101},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:102},{value:1.1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:105},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:108},{value:1.05,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:111},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:114},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:138},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:139},{value:1.1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:142},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:145},{value:1.05,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:148},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:151},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleY",index:156},{value:1.2,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:160},{value:.1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleY",index:162}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:20},{value:1.1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:23},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:26},{value:1.05,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:29},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:32},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:65},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:66},{value:1.1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:69},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:72},{value:1.05,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:75},{value:1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:78},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:101},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:102},{value:1.1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:105},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:108},{value:1.05,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:111},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:114},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:138},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:139},{value:1.1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:142},{value:.9,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:145},{value:1.05,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:148},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:151},{value:1,tweenMethod:"linearNone",tween:!0,target:26,label:null,key:"scaleX",index:156},{value:1.2,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:160},{value:.1,tweenMethod:"linearNone",tween:!0,target:26,key:"scaleX",index:162}]}},{target:25,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:25,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:25,key:"visible",index:24}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:24},{value:1.1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:27},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:30},{value:1.05,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:33},{value:1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:36},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:69},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:70},{value:1.1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:73},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:76},{value:1.05,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:79},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:82},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:105},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:106},{value:1.1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:109},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:112},{value:1.05,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:115},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:118},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:142},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:143},{value:1.1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:146},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:149},{value:1.05,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:152},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:155},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleY",index:158},{value:1.2,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:162},{value:.1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleY",index:164}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:24},{value:1.1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:27},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:30},{value:1.05,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:33},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:36},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:69},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:70},{value:1.1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:73},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:76},{value:1.05,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:79},{value:1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:82},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:105},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:106},{value:1.1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:109},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:112},{value:1.05,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:115},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:118},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:142},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:143},{value:1.1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:146},{value:.9,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:149},{value:1.05,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:152},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:155},{value:1,tweenMethod:"linearNone",tween:!0,target:25,label:null,key:"scaleX",index:158},{value:1.2,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:162},{value:.1,tweenMethod:"linearNone",tween:!0,target:25,key:"scaleX",index:164}]}},{target:24,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:24,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:24,key:"visible",index:18}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:18},{value:1.1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:21},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:24},{value:1.05,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:27},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:30},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:63},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:64},{value:1.1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:67},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:70},{value:1.05,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:73},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:76},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:99},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:100},{value:1.1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:103},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:106},{value:1.05,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:109},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:112},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:136},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:137},{value:1.1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:140},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:143},{value:1.05,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:146},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:149},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleY",index:160},{value:1.2,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:164},{value:.1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleY",index:166}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:18},{value:1.1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:21},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:24},{value:1.05,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:27},{value:1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:30},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:63},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:64},{value:1.1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:67},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:70},{value:1.05,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:73},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:76},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:99},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:100},{value:1.1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:103},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:106},{value:1.05,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:109},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:112},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:136},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:137},{value:1.1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:140},{value:.9,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:143},{value:1.05,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:146},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:149},{value:1,tweenMethod:"linearNone",tween:!0,target:24,label:null,key:"scaleX",index:160},{value:1.2,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:164},{value:.1,tweenMethod:"linearNone",tween:!0,target:24,key:"scaleX",index:166}]}},{target:23,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:23,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:23,key:"visible",index:22}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:22},{value:1.1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:25},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:28},{value:1.05,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:31},{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:34},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:67},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:68},{value:1.1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:71},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:74},{value:1.05,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:77},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:80},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:103},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:104},{value:1.1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:107},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:110},{value:1.05,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:113},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:116},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:140},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:141},{value:1.1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:144},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:147},{value:1.05,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:150},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:153},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleY",index:162},{value:1.2,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:166},{value:.1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleY",index:168}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:22},{value:1.1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:25},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:28},{value:1.05,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:31},{value:1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:34},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:67},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:68},{value:1.1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:71},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:74},{value:1.05,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:77},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:80},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:103},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:104},{value:1.1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:107},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:110},{value:1.05,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:113},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:116},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:140},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:141},{value:1.1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:144},{value:.9,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:147},{value:1.05,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:150},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:153},{value:1,tweenMethod:"linearNone",tween:!0,target:23,label:null,key:"scaleX",index:162},{value:1.2,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:166},{value:.1,tweenMethod:"linearNone",tween:!0,target:23,key:"scaleX",index:168}]}},{target:10,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:0},{value:40,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:14},{value:-30,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:17},{value:19,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:20},{value:-5,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:23},{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"y",index:25}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:10,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:10,key:"visible",index:14}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleY",index:14},{value:1.2,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleY",index:17},{value:.9,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleY",index:21},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleY",index:25}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleX",index:14},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleX",index:17},{value:1.1,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleX",index:21},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"scaleX",index:25}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:14},{value:1,tweenMethod:"linearNone",tween:!0,target:10,key:"alpha",index:18}]}},{target:3,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:3,key:"visible",index:63}],scaleY:[{value:1.58,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:62},{value:3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:63},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:68},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:97},{value:3,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:98},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:103},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:134},{value:3,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:135},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleY",index:140}],scaleX:[{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:62},{value:3,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:63},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:68},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:97},{value:3,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:98},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:103},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:134},{value:3,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:135},{value:1.8,tweenMethod:"linearNone",tween:!0,target:3,label:null,key:"scaleX",index:140}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:63},{value:360,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:175}]}},{target:4,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:4,key:"visible",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:40},{value:1,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"alpha",index:170},{value:0,tweenMethod:"linearNone",tween:!0,target:4,label:null,key:"alpha",index:188}]}},{target:9,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:62}]}},{target:8,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:62}]}},{target:7,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:7,key:"visible",index:62}]}},{target:35,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:35,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:35,key:"visible",index:82},{value:!0,tweenMethod:"linearNone",tween:!1,target:35,label:null,key:"visible",index:122},{value:!0,tweenMethod:"linearNone",tween:!1,target:35,label:null,key:"visible",index:158}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:35,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:35,key:"scaleY",index:82},{value:1.5,tweenMethod:"linearNone",tween:!0,target:35,key:"scaleY",index:92},{value:1,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"scaleY",index:122},{value:1.5,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"scaleY",index:132},{value:1,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"scaleY",index:158},{value:1.5,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"scaleY",index:166}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:35,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:35,key:"scaleX",index:82},{value:1.5,tweenMethod:"linearNone",tween:!0,target:35,key:"scaleX",index:92},{value:1,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"scaleX",index:122},{value:1.5,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"scaleX",index:132},{value:1,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"scaleX",index:158},{value:1.5,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"scaleX",index:166}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:35,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:35,key:"alpha",index:82},{value:1,tweenMethod:"linearNone",tween:!0,target:35,key:"alpha",index:87},{value:0,tweenMethod:"linearNone",tween:!0,target:35,key:"alpha",index:92},{value:0,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"alpha",index:122},{value:1,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"alpha",index:127},{value:0,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"alpha",index:132},{value:0,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"alpha",index:158},{value:1,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"alpha",index:163},{value:0,tweenMethod:"linearNone",tween:!0,target:35,label:null,key:"alpha",index:166}]}},{target:36,keyframes:{x:[{value:41.5,tweenMethod:"linearNone",tween:!0,target:36,key:"x",index:0},{value:41.5,tweenMethod:"linearNone",tween:!0,target:36,key:"x",index:86},{value:41.5,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"x",index:126},{value:41.5,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"x",index:162}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:36,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"visible",index:86},{value:!0,tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"visible",index:126},{value:!0,tweenMethod:"linearNone",tween:!1,target:36,label:null,key:"visible",index:162}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:36,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleY",index:86},{value:1.5,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleY",index:96},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleY",index:126},{value:1.5,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleY",index:136},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleY",index:162},{value:1.5,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleY",index:166}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:36,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleX",index:86},{value:1.5,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleX",index:96},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleX",index:126},{value:1.5,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleX",index:136},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleX",index:162},{value:1.5,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"scaleX",index:166}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:36,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:86},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:91},{value:0,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:96},{value:0,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:126},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:131},{value:0,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:136},{value:0,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:162},{value:1,tweenMethod:"linearNone",tween:!0,target:36,label:null,key:"alpha",index:166}]}}],name:"ani1",id:1,frameRate:24,action:0}],loadList:["fishdld/animation/aniui/big_prize/img_ywjc_Black.png","fishdld/animation/aniui/big_bg/img_addsg.png","fishdld/animation/aniui/big_prize/img_ywjc_bsbg.png","fishdld/animation/aniui/big_prize/img_ywjc_ding01.png","fishdld/animation/aniui/big_prize/img_ywjc_ding02.png","fishdld/animation/aniui/big_prize/img_ywjc_ding03.png","fishdld/animation/aniui/big_prize/img_ywjc_ding04.png","fishdld/animation/aniui/big_prize/img_ywjc_ding05.png","fishdld/animation/aniui/big_prize/img_ywjc_ding06.png","fishdld/animation/aniui/big_prize/img_ywjc_ding07.png","fishdld/animation/aniui/big_prize/img_ywjc_ding08.png","fishdld/animation/aniui/big_prize/img_ywjc_ding09.png","fishdld/animation/aniui/big_prize/img_ywjc_ding10.png","fishdld/animation/aniui/big_prize/img_ywjc_ding11.png","fishdld/animation/aniui/big_prize/img_ywjc_ding12.png","fishdld/animation/aniui/big_prize/img_ywjc_stL1.png","fishdld/animation/aniui/big_prize/img_ywjc_stL2.png","fishdld/animation/aniui/big_prize/img_ywjc_stR1.png","fishdld/animation/aniui/big_prize/img_ywjc_stR2.png","fishdld/animation/aniui/big_prize/img_ywjc_bs1.png","fishdld/animation/aniui/big_prize/img_ywjc_bs2_2.png","fishdld/animation/aniui/big_prize/img_ywjc_bs2_1.png","fishdld/animation/aniui/big_prize/img_ywjc_text.png","fishdld/animation/aniui/big_prize/img_ywjc_textbg.png","fishdld/animation/anigun/gun6/img_gun6_xin xin.png"],loadList3D:[]},ns.get_ywhj_effectUI=bi,e("ui.fishdld.animation.get_ywhj_effectUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,mr,pi,Qo,Bt],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:0,x:0,width:256,skin:"fishdld/animation/aniui/img_yu428_add.png",scaleY:1,scaleX:1,rotation:0,pivotY:128,pivotX:128,name:"add",height:256,alpha:1},compId:3},{type:"Image",props:{y:-5,x:0,width:140,skin:"fishdld/animation/aniui/img_fish_die_color_3.png",scaleY:1,scaleX:1,pivotY:88,pivotX:70,name:"rbg_b",height:176,alpha:1},compId:4,child:[{type:"Image",props:{y:88,x:71,width:140,skin:"fishdld/animation/aniui/img_yu435_den.png",pivotY:88,pivotX:70,name:"de",height:176,alpha:0},compId:7}]},{type:"Image",props:{y:0,x:0,width:132,visible:!0,skin:"fishdld/animation/aniui/img_yu428_gols.png",scaleY:1,scaleX:1,pivotY:17,pivotX:66,name:"gold",height:34},compId:5},{type:"Image",props:{y:25,x:0,width:191,skin:"fishdld/animation/aniui/img_yu428_nb.png",pivotY:26,pivotX:96,name:"nb",height:51},compId:19,child:[{type:"Label",props:{y:11,x:95.5,width:375,var:"score",valign:"middle",text:"0",scaleY:.4,scaleX:.4,height:54,font:"coin_number",anchorY:.5,anchorX:.5,align:"center"},compId:20}]},{type:"Image",props:{y:-20,x:0,width:225,visible:!0,var:"title",skin:"fishdld/animation/aniui/gun_title_freegame.png",scaleY:.8,scaleX:.8,rotation:-6,pivotY:34,pivotX:113,height:67,alpha:1},compId:9},{type:"Image",props:{y:-78,x:-10,width:115,visible:!0,var:"icon",skin:"fishdld/animation/aniui/gun_icon_freegame.png",scaleY:.8,scaleX:.8,rotation:70,pivotY:75,pivotX:58,height:149},compId:8},{type:"Image",props:{y:0,x:0,width:124,visible:!0,skin:"fishdld/animation/aniui/big_bg/img_add429.png",scaleY:4,scaleX:4,pivotY:62,pivotX:62,name:"add429",height:124,blendMode:"lighter",alpha:0},compId:18},{type:"Sprite",props:{y:0,x:0,visible:!0,name:"ef_thunder",blendMode:"lighter"},compId:14,child:[{type:"Image",props:{y:17,x:48,width:256,visible:!0,skin:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",scaleY:.5,scaleX:.5,rotation:33,pivotY:171,pivotX:128,height:341},compId:13},{type:"Image",props:{y:-84,x:20.241553480253742,width:256,visible:!0,skin:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",scaleY:.4,scaleX:-.4,rotation:-59,pivotY:171,pivotX:128,height:341},compId:15},{type:"Image",props:{y:0,x:-66,width:256,visible:!0,skin:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",scaleY:-.5,scaleX:.5,rotation:3,pivotY:171,pivotX:128,height:341},compId:16},{type:"Image",props:{y:-41,x:-41,width:256,visible:!0,skin:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",scaleY:.5,scaleX:-.5,rotation:-412,pivotY:171,pivotX:128,height:423},compId:17}]}],animations:[{nodes:[{target:5,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:5},{value:-9,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:6},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:8},{value:-3,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:12}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:5}],scaleY:[{value:.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:5},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:8}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:5},{value:1.1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:8}]}},{target:4,keyframes:{scaleY:[{value:2,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:10}],scaleX:[{value:2,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:10}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:10}]}},{target:9,keyframes:{y:[{value:-20,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:0},{value:-20,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"y",index:10},{value:-49,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:12},{value:-20,tweenMethod:"linearNone",tween:!0,target:9,label:null,key:"y",index:17}],x:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:0}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:9},{value:!0,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:10}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:10},{value:6,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:13},{value:-6,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:20}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:13}]}},{target:8,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0}],scaleY:[{value:2.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:0},{value:.8,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleY",index:8}],scaleX:[{value:2.5,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:0},{value:.8,tweenMethod:"linearNone",tween:!0,target:8,key:"scaleX",index:8}],rotation:[{value:65,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0},{value:65,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:10},{value:60,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:13},{value:70,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:20}]}},{target:3,keyframes:{scaleY:[{value:.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:10}],scaleX:[{value:.8,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:10}],rotation:[{value:-45,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:20}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:10}]}},{target:7,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:13}]}},{target:18,keyframes:{visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:18,key:"visible",index:10}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:10},{value:4,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleY",index:18}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:10},{value:4,tweenMethod:"linearNone",tween:!0,target:18,key:"scaleX",index:18}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:13},{value:0,tweenMethod:"linearNone",tween:!0,target:18,key:"alpha",index:18}]}}],name:"start",id:1,frameRate:24,action:1},{nodes:[{target:5,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"y",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:5,key:"visible",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleY",index:0}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"scaleX",index:0}]}},{target:4,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0}]}},{target:9,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:9,key:"visible",index:0}],rotation:[{value:-6,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:0},{value:6,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:15},{value:-6,tweenMethod:"linearNone",tween:!0,target:9,key:"rotation",index:30}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:9,key:"alpha",index:0}]}},{target:8,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:8,key:"visible",index:0}],rotation:[{value:66,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:0},{value:56,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:15},{value:66,tweenMethod:"linearNone",tween:!0,target:8,key:"rotation",index:30}]}},{target:3,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleY",index:0}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"scaleX",index:0}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:0},{value:80,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:30}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"alpha",index:0}]}},{target:7,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:8},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:18},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:21},{value:1,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:23},{value:0,tweenMethod:"linearNone",tween:!0,target:7,label:null,key:"alpha",index:26}]}}],name:"loop",id:1,frameRate:24,action:2},{nodes:[{target:14,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:14,key:"visible",index:0}]}},{target:13,keyframes:{y:[{value:17,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:0},{value:30,tweenMethod:"linearNone",tween:!0,target:13,key:"y",index:12}],x:[{value:48,tweenMethod:"linearNone",tween:!0,target:13,key:"x",index:0},{value:62,tweenMethod:"linearNone",tween:!0,target:13,key:"x",index:12}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:13,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:13,key:"visible",index:11}],skin:[{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_01.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:0},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_02.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:1},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_03.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:2},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:3},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_05.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:4},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_06.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:5},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_07.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:6},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_08.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:7},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_09.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:8},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:9},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png",tweenMethod:"linearNone",tween:!1,target:13,key:"skin",index:10}]}},{target:15,keyframes:{x:[{value:20.241553480253742,tweenMethod:"linearNone",tween:!0,target:15,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:5},{value:!0,tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"visible",index:15}],skin:[{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_07.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:0},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_08.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:1},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_09.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:2},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:3},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:4},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_01.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:15},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_02.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:16},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_03.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:17},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:18},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_05.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:19},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_06.png",tweenMethod:"linearNone",tween:!1,target:15,label:null,key:"skin",index:20}]}},{target:16,keyframes:{y:[{value:0,tweenMethod:"linearNone",tween:!0,target:16,key:"y",index:0},{value:-9,tweenMethod:"linearNone",tween:!0,target:16,key:"y",index:18}],x:[{value:-66,tweenMethod:"linearNone",tween:!0,target:16,key:"x",index:0},{value:-66,tweenMethod:"linearNone",tween:!0,target:16,key:"x",index:7},{value:-75.55056024045012,tweenMethod:"linearNone",tween:!0,target:16,key:"x",index:18}],visible:[{value:!1,tweenMethod:"linearNone",tween:!1,target:16,key:"visible",index:0},{value:!0,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:7},{value:!1,tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"visible",index:18}],skin:[{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",tweenMethod:"linearNone",tween:!1,target:16,key:"skin",index:0},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_01.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:7},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_02.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:8},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_03.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:9},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:10},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_05.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:11},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_06.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:12},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_07.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:13},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_08.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:14},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_09.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:15},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:16},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png",tweenMethod:"linearNone",tween:!1,target:16,label:null,key:"skin",index:17}]}},{target:17,keyframes:{x:[{value:-41,tweenMethod:"linearNone",tween:!0,target:17,key:"x",index:0}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:17,key:"visible",index:0},{value:!1,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:3},{value:!0,tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"visible",index:13}],skin:[{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_09.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:0},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:1},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:2},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_01.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:13},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_02.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:14},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_03.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:15},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:16},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_05.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:17},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_06.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:18},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_07.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:19},{value:"fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_08.png",tweenMethod:"linearNone",tween:!1,target:17,label:null,key:"skin",index:20}]}}],name:"thunder",id:3,frameRate:24,action:2},{nodes:[{target:20,keyframes:{scaleY:[{value:.4,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:2},{value:.4,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleY",index:4}],scaleX:[{value:.4,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:2},{value:.4,tweenMethod:"linearNone",tween:!0,target:20,key:"scaleX",index:4}]}}],name:"add_score",id:4,frameRate:24,action:0}],loadList:["fishdld/animation/aniui/img_yu428_add.png","fishdld/animation/aniui/img_fish_die_color_3.png","fishdld/animation/aniui/img_yu435_den.png","fishdld/animation/aniui/img_yu428_gols.png","fishdld/animation/aniui/img_yu428_nb.png","fishdld/animation/aniui/gun_title_freegame.png","fishdld/animation/aniui/gun_icon_freegame.png","fishdld/animation/aniui/big_bg/img_add429.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_04.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_01.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_02.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_03.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_05.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_06.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_07.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_08.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_09.png","fishdld/animation/aniui/img_gun6_thunder/img_gun6_thunder_10.png"],loadList3D:[]},ns.gun_comboUI=bi,e("ui.fishdld.animation.gun_comboUI",bi),ns=ts=ts||{},ns=(bi=ns.fishdld||(ns.fishdld={})).fight||(bi.fight={}),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Eo,mr,es,To,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{},compId:2,child:[{type:"Box",props:{y:2,x:0,name:"bg"},compId:3,child:[{type:"Image",props:{y:24,x:0,width:663,skin:"fishdld/fight/dialog/img_dialog_bg1.png",height:333},compId:12},{type:"Image",props:{y:1,x:12,width:632,skin:"fishdld/fight/dialog/img_dialog_bg2.png",sizeGrid:"0,95,0,88",height:78},compId:13},{type:"Button",props:{y:-2,x:597,stateNum:1,skin:"fishdld/fight/dialog/btn_dialog_close.png",name:"close"},compId:14,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:15}]},{type:"Label",props:{y:25,x:266.828125,text:"温馨提示",fontSize:30,color:"#ffffff",bold:!0},compId:16}]},{type:"Button",props:{y:244,x:226,var:"ok",stateNum:1,skin:"fishdld/fight/dialog/btn_ok.png",name:"ok"},compId:17,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:20}]},{type:"Label",props:{y:138,x:17,wordWrap:!0,width:620,var:"info_label",text:"您距离青铜抽奖仅差19271金币\\n您确定继续抽奖吗？",leading:5,height:60,fontSize:25,color:"#52c3d9",align:"center"},compId:18}],loadList:["fishdld/fight/dialog/img_dialog_bg1.png","fishdld/fight/dialog/img_dialog_bg2.png","fishdld/fight/dialog/btn_dialog_close.png","fishdld/fight/dialog/btn_ok.png"],loadList3D:[]},ns.AlertDialog1UI=bi,e("ui.fishdld.fight.AlertDialog1UI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Eo,mr,es,To,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{},compId:2,child:[{type:"Box",props:{y:2,x:0,name:"bg"},compId:3,child:[{type:"Image",props:{y:24,x:0,width:663,skin:"fishdld/fight/dialog/img_dialog_bg1.png",height:444},compId:12},{type:"Image",props:{y:1,x:12,width:632,skin:"fishdld/fight/dialog/img_dialog_bg2.png",sizeGrid:"0,95,0,88",height:78},compId:13},{type:"Button",props:{y:-2,x:597,stateNum:1,skin:"fishdld/fight/dialog/btn_dialog_close.png",name:"close"},compId:14,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:15}]},{type:"Label",props:{y:25,x:266.828125,text:"温馨提示",fontSize:30,color:"#ffffff",bold:!0},compId:16}]},{type:"Button",props:{y:371,x:222,var:"ok",stateNum:1,skin:"fishdld/fight/dialog/btn_ok.png",name:"ok"},compId:17,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:20}]},{type:"Label",props:{y:169,x:21,wordWrap:!0,width:620,var:"info1_label",text:"您距离青铜抽奖仅差19271金币\\n您确定继续抽奖吗？",leading:5,height:60,fontSize:25,color:"#52c3d9",align:"center"},compId:18},{type:"Label",props:{y:281,x:17,wordWrap:!0,width:620,var:"info2_label",text:"关闭僵持开关后，击杀奖金鱼将不会有10%的金币进入奖池",leading:5,fontSize:20,color:"#d9b852",align:"center"},compId:19}],loadList:["fishdld/fight/dialog/img_dialog_bg1.png","fishdld/fight/dialog/img_dialog_bg2.png","fishdld/fight/dialog/btn_dialog_close.png","fishdld/fight/dialog/btn_ok.png"],loadList3D:[]},ns.AlertDialog2UI=bi,e("ui.fishdld.fight.AlertDialog2UI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[zo,mr,ta,es,To,pi,Eo],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{},compId:2,child:[{type:"Box",props:{y:-4,x:-19,name:"bg"},compId:3,child:[{type:"Image",props:{y:24,x:0,width:925,skin:"fishdld/fight/dialog/img_dialog_bg1.png",height:574},compId:4},{type:"Image",props:{y:1,x:19,width:879,skin:"fishdld/fight/dialog/img_dialog_bg2.png",sizeGrid:"0,95,0,88",height:78},compId:5},{type:"Button",props:{y:-5,x:848,stateNum:1,skin:"fishdld/fight/dialog/btn_dialog_close.png",name:"close"},compId:6,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:7}]},{type:"Label",props:{y:24,x:401.328125,text:"大奖记录",fontSize:30,color:"#ffffff",bold:!0},compId:8},{type:"Label",props:{y:547,x:161.376953125,text:"使用的炮台倍数越高，获得奖金池金币越多，显示最近50条大奖记录",fontSize:20,color:"#7ec5d2",bold:!0},compId:9}]},{type:"Box",props:{y:128,x:81},compId:12,child:[{type:"Image",props:{y:0,x:0,width:725,skin:"fishdld/fight/dialog/img_ejtk_btdd.png",height:53},compId:13},{type:"Label",props:{y:14,x:91,text:"时间",fontSize:25,color:"#52c3d9",bold:!0},compId:14},{type:"Label",props:{y:14,x:320,text:"昵称",fontSize:25,color:"#52c3d9",bold:!0},compId:15},{type:"Label",props:{y:14,x:570,text:"奖金",fontSize:25,color:"#52c3d9",bold:!0},compId:16}]},{type:"List",props:{y:181,x:0,width:878,var:"all_list",height:356},compId:17,child:[{type:"Box",props:{renderType:"render",height:47},compId:18,child:[{type:"Image",props:{y:0,x:0,width:878,skin:"fishdld/fight/dialog/img_ejtk_btdd.png",name:"bg",height:47},compId:19},{type:"Label",props:{y:11,x:86,width:232.14111328125,name:"award_time",height:25,fontSize:25,color:"#52c3d9",align:"center"},compId:20},{type:"Label",props:{y:11,x:375,name:"nickname",fontSize:25,color:"#d4b512"},compId:21},{type:"Label",props:{y:11,x:664,width:83.4228515625,name:"award_money",height:25,fontSize:25,color:"#d4b512",align:"left"},compId:22},{type:"Image",props:{y:11,x:637,skin:"fishdld/fight/dialog/img_icon_jq.png"},compId:24}]}]},{type:"List",props:{y:181,x:0,width:878,visible:!1,var:"my_list",height:356},compId:37,child:[{type:"Box",props:{renderType:"render",height:47},compId:38,child:[{type:"Image",props:{y:0,x:0,width:878,skin:"fishdld/fight/dialog/img_ejtk_btdd.png",name:"bg",height:47},compId:39},{type:"Label",props:{y:11,x:86,width:232.14111328125,name:"award_time",height:25,fontSize:25,color:"#52c3d9",align:"center"},compId:40},{type:"Label",props:{y:11,x:375,name:"nickname",fontSize:25,color:"#d4b512"},compId:41},{type:"Label",props:{y:11,x:664,width:83.4228515625,name:"award_money",height:25,fontSize:25,color:"#d4b512",align:"left"},compId:42},{type:"Image",props:{y:11,x:637,skin:"fishdld/fight/dialog/img_icon_jq.png"},compId:43}]}]},{type:"Label",props:{y:320,x:364,visible:!1,var:"no_record",text:"暂无新的获奖",fontSize:25,color:"#52c3d9",bold:!0},compId:29},{type:"Clip",props:{y:68,x:-6,width:457,var:"tab_all",skin:"fishdld/fight/dialog/clip_ejtk_tab.png",index:1,height:77,clipY:2},compId:25,child:[{type:"Label",props:{y:17.5,x:178.5,text:"所有记录",fontSize:25,color:"#1a5864",bold:!0},compId:26}]},{type:"Clip",props:{y:68,x:435,width:450,var:"tab_my",skin:"fishdld/fight/dialog/clip_ejtk_tab.png",index:0,height:77,clipY:2},compId:27,child:[{type:"Label",props:{y:17.5,x:150,text:"我的获奖记录",fontSize:25,color:"#1a5864",bold:!0},compId:28}]}],loadList:["fishdld/fight/dialog/img_dialog_bg1.png","fishdld/fight/dialog/img_dialog_bg2.png","fishdld/fight/dialog/btn_dialog_close.png","fishdld/fight/dialog/img_ejtk_btdd.png","fishdld/fight/dialog/img_icon_jq.png","fishdld/fight/dialog/clip_ejtk_tab.png"],loadList3D:[]},ns.BigPrizeRecordDialogUI=bi,e("ui.fishdld.fight.BigPrizeRecordDialogUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,To,Eo,mr,ta,Ho,Qo,pi,Bt],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Box",props:{var:"fight_layer",top:0,right:0,left:0,bottom:0},compId:34},{type:"Box",props:{var:"user_layer",top:0,right:0,mouseThrough:!0,left:0,bottom:0},compId:10,child:[{type:"Box",props:{x:194,width:385,name:"seat_0",mouseThrough:!0,height:130,bottom:-3,anchorY:1,anchorX:.5},compId:11,child:[{type:"Image",props:{y:62,x:0,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui1.png",name:"bg"},compId:59},{type:"Box",props:{y:76,x:27,visible:!1,name:"user_info"},compId:130,child:[{type:"Image",props:{y:20,x:3,width:156,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui3.png",sizeGrid:"0,19,0,22",height:27},compId:63},{type:"Image",props:{y:34,x:12,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui2.png",name:"coin",anchorY:.5,anchorX:.5},compId:66},{type:"Label",props:{x:32,width:107,text:"小狗粮",name:"nickname",height:20,fontSize:18,color:"#ffffff"},compId:69},{type:"Label",props:{y:24,x:81,width:101,text:"0.0",name:"money",fontSize:20,color:"#f9f900",anchorX:.5},compId:68}]},{type:"Dldby_location_ui",props:{y:106,x:285.5,visible:!1,scaleY:1,scaleX:1,name:"location",runtime:"ui.fishdld.animation.Dldby_location_uiUI"},compId:236},{type:"Dldby_lock_ui",props:{y:107,x:285.5,visible:!1,scaleY:1.4,scaleX:1.4,name:"lock",runtime:"ui.fishdld.animation.Dldby_lock_uiUI"},compId:339},{type:"Sprite",props:{y:-8,x:107,name:"win_ui_pos"},compId:281},{type:"Box",props:{y:0,x:186,width:199,visible:!1,name:"weapon",height:130},compId:12,child:[{type:"Image",props:{y:78,x:45,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui4.png"},compId:67},{type:"Button",props:{y:129,x:154,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_gunjia_ui.png",scaleY:1.3,scaleX:1.3,name:"add_gun_btn",anchorY:1},compId:39,child:[{type:"Script",props:{zoom:1.2,runtime:"framework/view/ui/ScaleButton.ts"},compId:49}]},{type:"Button",props:{y:129,x:47,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_gunjian_ui.png",scaleY:1.3,scaleX:1.3,name:"sub_gun_btn",anchorY:1,anchorX:1},compId:40,child:[{type:"Script",props:{zoom:1.2,runtime:"framework/view/ui/ScaleButton.ts"},compId:50}]},{type:"Dldby_gun_1",props:{y:112,x:99,width:56,rotation:0,name:"gun",height:71,runtime:"ui.fishdld.animation.Dldby_gun_1UI"},compId:13}]},{type:"Box",props:{y:78,x:107,name:"waiting"},compId:205,child:[{type:"Sprite",props:{y:0,x:0,texture:"fishdld/fight/mainui/dldby_dengdaijiaru_ui.png"},compId:206},{type:"Label",props:{y:8,x:46,text:"等待中...",fontSize:25,color:"#ffffff"},compId:207}]},{type:"Box",props:{y:-71,x:177,visible:!1,name:"count_down_fire"},compId:341,child:[{type:"Image",props:{y:35,x:118,skin:"fishdld/fight/mainui/img_gun_7_tips.png",name:"type",anchorY:.5,anchorX:.5},compId:342},{type:"Label",props:{y:72,x:34,text:"剩余发射时间：",fontSize:20,color:"#f6ad13"},compId:343},{type:"Label",props:{y:72,x:174,width:22.24609375,text:"30",name:"time",height:20,fontSize:20,color:"#fd0905",align:"center"},compId:344}]},{type:"Script",props:{y:63,runtime:"games/fishdld/scenes/fight/user/UserSeatScript.ts"},compId:26}]},{type:"Box",props:{x:944,width:384,name:"seat_1",mouseThrough:!0,height:130,bottom:-3,anchorY:1,anchorX:.5},compId:147,child:[{type:"Image",props:{y:62,x:11,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui1.png",name:"bg"},compId:148},{type:"Box",props:{y:79,x:200,visible:!1,name:"user_info"},compId:149,child:[{type:"Image",props:{y:20,x:3,width:156,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui3.png",sizeGrid:"0,19,0,22",height:27},compId:150},{type:"Image",props:{y:34,x:12,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui2.png",name:"coin",anchorY:.5,anchorX:.5},compId:151},{type:"Label",props:{x:32,width:107,text:"小狗粮",name:"nickname",height:20,fontSize:18,color:"#ffffff"},compId:152},{type:"Label",props:{y:24,x:82,width:101,text:"0.0",name:"money",fontSize:20,color:"#f9f900",anchorX:.5},compId:153}]},{type:"Dldby_location_ui",props:{y:111,x:98,visible:!1,scaleY:1,scaleX:1,name:"location",runtime:"ui.fishdld.animation.Dldby_location_uiUI"},compId:237},{type:"Dldby_lock_ui",props:{y:110,x:99.5,visible:!1,scaleY:1.4,scaleX:1.4,name:"lock",runtime:"ui.fishdld.animation.Dldby_lock_uiUI"},compId:340},{type:"Sprite",props:{y:-19,x:280.5,name:"win_ui_pos"},compId:282},{type:"Box",props:{y:0,x:0,width:199,visible:!1,name:"weapon",height:130},compId:154,child:[{type:"Image",props:{y:78,x:45,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui4.png"},compId:155},{type:"Button",props:{y:129,x:143,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_gunjia_ui.png",scaleY:1.3,scaleX:1.3,name:"add_gun_btn",anchorY:1},compId:157,child:[{type:"Script",props:{zoom:1.2,runtime:"framework/view/ui/ScaleButton.ts"},compId:158}]},{type:"Button",props:{y:129,x:55,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_gunjian_ui.png",scaleY:1.3,scaleX:1.3,name:"sub_gun_btn",anchorY:1,anchorX:1},compId:159,child:[{type:"Script",props:{zoom:1.2,runtime:"framework/view/ui/ScaleButton.ts"},compId:160}]},{type:"Dldby_gun_1",props:{y:112,x:99,name:"gun",runtime:"ui.fishdld.animation.Dldby_gun_1UI"},compId:156}]},{type:"Box",props:{y:78,x:129.081298828125,name:"waiting"},compId:208,child:[{type:"Sprite",props:{y:0,x:0,texture:"fishdld/fight/mainui/dldby_dengdaijiaru_ui.png"},compId:209},{type:"Label",props:{y:8,x:46,text:"等待中...",fontSize:25,color:"#ffffff"},compId:210}]},{type:"Box",props:{y:-71,x:-8,visible:!1,name:"count_down_fire"},compId:345,child:[{type:"Image",props:{y:35,x:118,skin:"fishdld/fight/mainui/img_gun_7_tips.png",name:"type",anchorY:.5,anchorX:.5},compId:346},{type:"Label",props:{y:72,x:34,text:"剩余发射时间：",fontSize:20,color:"#f6ad13"},compId:347},{type:"Label",props:{y:72,x:174,width:22.24609375,text:"30",name:"time",height:20,fontSize:20,color:"#fd0905",align:"center"},compId:348}]},{type:"Script",props:{y:63,x:11,runtime:"games/fishdld/scenes/fight/user/UserSeatScript.ts"},compId:162}]},{type:"Box",props:{x:944,width:384,top:0,scaleY:1,scaleX:1,rotation:0,name:"seat_2",mouseThrough:!0,height:130,anchorX:.5},compId:163,child:[{type:"Image",props:{x:9,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui0.png",name:"bg"},compId:164},{type:"Box",props:{y:2,x:200,visible:!1,name:"user_info"},compId:165,child:[{type:"Image",props:{y:0,x:3,width:156,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui3.png",sizeGrid:"0,19,0,22",height:27},compId:166},{type:"Image",props:{y:14,x:12,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui2.png",name:"coin",anchorY:.5,anchorX:.5},compId:167},{type:"Label",props:{y:29,x:15.5,width:107,text:"小狗粮",rotation:0,name:"nickname",height:20,fontSize:18,color:"#ffffff"},compId:168},{type:"Label",props:{y:24,x:82,width:101,text:"0.0",name:"money",fontSize:20,color:"#f9f900",anchorY:1,anchorX:.5},compId:169}]},{type:"Sprite",props:{y:176,x:277.5,name:"win_ui_pos"},compId:283},{type:"Box",props:{y:0,x:0,width:199,visible:!1,name:"weapon",height:130},compId:170,child:[{type:"Image",props:{y:-52,x:43,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui4.png"},compId:171},{type:"Button",props:{y:0,x:153.5,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_gunjia_ui.png",scaleY:1.3,scaleX:1.3,name:"add_gun_btn"},compId:173,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:174}]},{type:"Button",props:{y:0,x:45,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_gunjian_ui.png",scaleY:1.3,scaleX:1.3,name:"sub_gun_btn",anchorX:1},compId:175,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:176}]},{type:"Dldby_gun_1",props:{y:19,x:97,width:56,rotation:180,name:"gun",height:71,runtime:"ui.fishdld.animation.Dldby_gun_1UI"},compId:172}]},{type:"Box",props:{y:5,x:128.081298828125,name:"waiting"},compId:211,child:[{type:"Sprite",props:{y:0,x:0,texture:"fishdld/fight/mainui/dldby_dengdaijiaru_ui.png"},compId:212},{type:"Label",props:{y:8,x:46,text:"等待中...",fontSize:25,color:"#ffffff"},compId:213}]},{type:"Script",props:{y:63,x:20,runtime:"games/fishdld/scenes/fight/user/UserSeatScript.ts"},compId:178}]},{type:"Box",props:{y:0,x:194,name:"seat_3",mouseThrough:!0,height:130,anchorX:.5},compId:179,child:[{type:"Image",props:{x:0,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui0.png",name:"bg"},compId:180},{type:"Box",props:{y:4,x:28,visible:!1,name:"user_info"},compId:181,child:[{type:"Image",props:{y:0,x:3,width:156,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui3.png",sizeGrid:"0,19,0,22",height:27},compId:182},{type:"Image",props:{y:14,x:12,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui2.png",name:"coin",anchorY:.5,anchorX:.5},compId:183},{type:"Label",props:{y:27,x:15.5,width:107,text:"小狗粮",rotation:0,name:"nickname",height:20,fontSize:18,color:"#ffffff"},compId:184},{type:"Label",props:{y:24,x:82,width:101,text:"0.0",name:"money",fontSize:20,color:"#f9f900",anchorY:1,anchorX:.5},compId:185}]},{type:"Sprite",props:{y:174,x:119.5,name:"win_ui_pos"},compId:284},{type:"Box",props:{y:-2,x:187,width:199,visible:!1,name:"weapon",height:91},compId:186,child:[{type:"Image",props:{y:-50,x:43,skin:"fishdld/fight/mainui/img_dldby_gunwenzhi_ui4.png"},compId:187},{type:"Button",props:{y:0,x:153.5,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_gunjia_ui.png",scaleY:1.3,scaleX:1.3,name:"add_gun_btn"},compId:189,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:190}]},{type:"Button",props:{y:0,x:45,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_gunjian_ui.png",scaleY:1.3,scaleX:1.3,name:"sub_gun_btn",anchorX:1},compId:191,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:192}]},{type:"Dldby_gun_1",props:{y:21,x:97,width:56,rotation:180,name:"gun",height:71,runtime:"ui.fishdld.animation.Dldby_gun_1UI"},compId:188}]},{type:"Box",props:{y:5,x:111.081298828125,name:"waiting"},compId:214,child:[{type:"Sprite",props:{y:0,x:0,texture:"fishdld/fight/mainui/dldby_dengdaijiaru_ui.png"},compId:215},{type:"Label",props:{y:8,x:46,text:"等待中...",fontSize:25,color:"#ffffff"},compId:216}]},{type:"Script",props:{y:63,x:11,runtime:"games/fishdld/scenes/fight/user/UserSeatScript.ts"},compId:194}]}]},{type:"Box",props:{y:0,x:0,var:"ui_effect_layer"},compId:369},{type:"Box",props:{top:0,right:0,name:"ui_layer",mouseThrough:!0,left:0,bottom:0},compId:195,child:[{type:"Box",props:{y:-2,name:"top_box",centerX:15},compId:290,child:[{type:"Button",props:{y:6.8,x:288,var:"big_prize_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_big_prize.png"},compId:256,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:257}]},{type:"Box",props:{y:1.8,var:"ywhj_btn",scaleY:.9,scaleX:1},compId:291,child:[{type:"Image",props:{y:0,x:0,skin:"fishdld/fight/mainui/img_ywhj_bg.png"},compId:293},{type:"Image",props:{y:3,x:80.5,skin:"fishdld/fight/mainui/img_ywhj.png"},compId:292},{type:"Label",props:{y:52,x:145,width:187,visible:!1,var:"ywhj_label",scaleY:.7,scaleX:.7,height:34,font:"fnt_ywhj",anchorY:.5,anchorX:.5,align:"center"},compId:305},{type:"Image",props:{y:13,x:21,skin:"fishdld/fight/mainui/img_ywhj_pao1.png",anchorY:.5,anchorX:.5},compId:294},{type:"Image",props:{y:43,x:21,width:26,skin:"fishdld/fight/mainui/img_ywhj_pao2.png",rotation:0,height:26,anchorY:.5,anchorX:.5},compId:295},{type:"Image",props:{y:71,x:42,skin:"fishdld/fight/mainui/img_ywhj_pao1.png",anchorY:.5,anchorX:.5},compId:296},{type:"Image",props:{y:71,x:85,skin:"fishdld/fight/mainui/img_ywhj_pao2.png",anchorY:.5,anchorX:.5},compId:297},{type:"Image",props:{y:71,x:124,skin:"fishdld/fight/mainui/img_ywhj_pao1.png",anchorY:.5,anchorX:.5},compId:298},{type:"Image",props:{y:71,x:168,skin:"fishdld/fight/mainui/img_ywhj_pao2.png",anchorY:.5,anchorX:.5},compId:299},{type:"Image",props:{y:71,x:207,skin:"fishdld/fight/mainui/img_ywhj_pao1.png",anchorY:.5,anchorX:.5},compId:300},{type:"Image",props:{y:71,x:250,skin:"fishdld/fight/mainui/img_ywhj_pao2.png",anchorY:.5,anchorX:.5},compId:301},{type:"Image",props:{y:13,x:270,skin:"fishdld/fight/mainui/img_ywhj_pao2.png",anchorY:.5,anchorX:.5},compId:302},{type:"Image",props:{y:43,x:270,width:30,skin:"fishdld/fight/mainui/img_ywhj_pao1.png",height:30,anchorY:.5,anchorX:.5},compId:303}]}]},{type:"Box",props:{scaleY:.8,scaleX:.8,right:19,name:"bottom_box",centerY:58},compId:196,child:[{type:"Button",props:{y:4,x:6,width:"",var:"speed_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_kuangbao0_ui.png",height:""},compId:202,child:[{type:"dldby_radar",props:{y:45,x:45,visible:!1,scaleY:1.3,scaleX:1.3,name:"effect",runtime:"ui.fishdld.animation.dldby_radarUI"},compId:360},{type:"Clip",props:{y:71.5,x:1,var:"fire_speed_clip",skin:"fishdld/fight/mainui/clip_fire_speed.png",index:0,clipY:3},compId:218},{type:"Script",props:{y:0,x:0,runtime:"framework/view/ui/ScaleButton.ts"},compId:203}]},{type:"Button",props:{y:112,x:6,width:"",var:"auto_fire_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_auto_fire.png",height:""},compId:361,child:[{type:"dldby_radar",props:{y:45,x:45,visible:!1,scaleY:1.3,scaleX:1.3,name:"effect",runtime:"ui.fishdld.animation.dldby_radarUI"},compId:362},{type:"Image",props:{y:77.5,x:22,skin:"fishdld/fight/mainui/f_5.png",index:0,clipY:3},compId:363},{type:"Script",props:{y:0,x:0,runtime:"framework/view/ui/ScaleButton.ts"},compId:364}]},{type:"Button",props:{y:220,x:6,width:"",var:"lock_special_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_lock_special.png",height:""},compId:197,child:[{type:"dldby_radar",props:{y:45.5,x:45.5,visible:!1,scaleY:1.3,scaleX:1.3,name:"effect",runtime:"ui.fishdld.animation.dldby_radarUI"},compId:275},{type:"Sprite",props:{y:70,x:8,texture:"fishdld/fight/mainui/f_8.png"},compId:358},{type:"Script",props:{y:0,x:0,runtime:"framework/view/ui/ScaleButton.ts"},compId:199}]},{type:"Button",props:{y:328,x:6,width:"",var:"lock_big_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_lock_big.png",height:""},compId:200,child:[{type:"dldby_radar",props:{y:45.5,x:45.5,visible:!1,scaleY:1.3,scaleX:1.3,name:"effect",runtime:"ui.fishdld.animation.dldby_radarUI"},compId:274},{type:"Sprite",props:{y:70,x:20,texture:"fishdld/fight/mainui/f_1.png"},compId:359},{type:"Script",props:{y:0,x:0,runtime:"framework/view/ui/ScaleButton.ts"},compId:201}]},{type:"Button",props:{y:436,x:6,width:"",var:"lock_cancel_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_cancel_lock.png",height:"",disabled:!0},compId:365,child:[{type:"Image",props:{y:69,x:-4,skin:"fishdld/fight/mainui/f_6.png",index:0,clipY:3},compId:367},{type:"Script",props:{y:0,x:0,runtime:"framework/view/ui/ScaleButton.ts"},compId:368}]}]},{type:"Box",props:{zOrder:100,top:75,right:-290,name:"right_box",mouseThrough:!0},compId:243,child:[{type:"Box",props:{y:-15,x:62,width:"",var:"right_box",height:"",anchorY:"",anchorX:""},compId:204,child:[{type:"Image",props:{y:0,x:0,width:295,skin:"fishdld/fight/mainui/img_button_dq.png",sizeGrid:"0,54,0,54",height:104},compId:239},{type:"Button",props:{y:15,x:28,var:"help_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_right_help.png"},compId:248,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:253}]},{type:"Button",props:{y:15,x:201,var:"exit_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_right_exit.png"},compId:249,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:252}]},{type:"Button",props:{y:15,x:115,var:"setting_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_right_setting.png"},compId:250,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:251}]}]},{type:"Button",props:{y:0,x:0,width:"",visible:!1,var:"hide_group_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_right_hide.png",height:"",anchorY:"",anchorX:""},compId:241,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:289}]},{type:"Button",props:{y:0,x:0,width:"",var:"show_group_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_left_show.png",height:"",anchorY:"",anchorX:""},compId:246,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:247}]}]},{type:"Box",props:{name:"left_box",left:80,centerY:-97},compId:258,child:[{type:"Button",props:{y:0,x:0,var:"free_prize_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_free_prize_pool.png"},compId:259,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:260}]},{type:"Button",props:{y:108,x:2,var:"callup_btn",stateNum:1,skin:"fishdld/fight/mainui/btn_callup.png"},compId:335,child:[{type:"Label",props:{y:1,x:2,width:66,var:"callup_num",height:16,fontSize:15,color:"#ffffff",align:"center"},compId:338},{type:"Script",props:{y:0,x:0,runtime:"framework/view/ui/ScaleButton.ts"},compId:337}]}]},{type:"Box",props:{zOrder:100,y:96,visible:!1,name:"notice_box",centerX:0},compId:267,child:[{type:"Image",props:{y:0,x:0,width:393,skin:"fishdld/fight/mainui/img_notice_bg.png",sizeGrid:"7,22,10,19",height:30},compId:266},{type:"Panel",props:{y:0,x:10,width:373,var:"notice_panel",height:30},compId:269}]}]}],animations:[{nodes:[{target:294,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:294,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:294,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:294,key:"skin",index:20}]}},{target:296,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:296,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:296,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:296,key:"skin",index:20}]}},{target:298,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:298,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:298,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:298,key:"skin",index:20}]}},{target:300,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:300,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:300,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:300,key:"skin",index:20}]}},{target:303,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:303,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:303,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:303,key:"skin",index:20}]}},{target:295,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:295,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:295,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:295,key:"skin",index:20}]}},{target:297,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:297,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:297,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:297,key:"skin",index:20}]}},{target:299,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:299,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:299,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:299,key:"skin",index:20}]}},{target:301,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:301,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:301,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:301,key:"skin",index:20}]}},{target:302,keyframes:{skin:[{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:302,key:"skin",index:0},{value:"fishdld/fight/mainui/img_ywhj_pao1.png",tweenMethod:"linearNone",tween:!1,target:302,key:"skin",index:10},{value:"fishdld/fight/mainui/img_ywhj_pao2.png",tweenMethod:"linearNone",tween:!1,target:302,key:"skin",index:20}]}}],name:"ani1",id:1,frameRate:24,action:2}],loadList:["fishdld/fight/mainui/img_dldby_gunwenzhi_ui1.png","fishdld/fight/mainui/img_dldby_gunwenzhi_ui3.png","fishdld/fight/mainui/img_dldby_gunwenzhi_ui2.png","fishdld/fight/mainui/img_dldby_gunwenzhi_ui4.png","fishdld/fight/mainui/btn_dldby_gunjia_ui.png","fishdld/fight/mainui/btn_dldby_gunjian_ui.png","fishdld/fight/mainui/dldby_dengdaijiaru_ui.png","fishdld/fight/mainui/img_gun_7_tips.png","fishdld/fight/mainui/img_dldby_gunwenzhi_ui0.png","fishdld/fight/mainui/btn_big_prize.png","fishdld/fight/mainui/img_ywhj_bg.png","fishdld/fight/mainui/img_ywhj.png","fishdld/fight/mainui/img_ywhj_pao1.png","fishdld/fight/mainui/img_ywhj_pao2.png","fishdld/fight/mainui/btn_dldby_kuangbao0_ui.png","fishdld/fight/mainui/clip_fire_speed.png","fishdld/fight/mainui/btn_auto_fire.png","fishdld/fight/mainui/f_5.png","fishdld/fight/mainui/btn_lock_special.png","fishdld/fight/mainui/f_8.png","fishdld/fight/mainui/btn_lock_big.png","fishdld/fight/mainui/f_1.png","fishdld/fight/mainui/btn_cancel_lock.png","fishdld/fight/mainui/f_6.png","fishdld/fight/mainui/img_button_dq.png","fishdld/fight/mainui/btn_right_help.png","fishdld/fight/mainui/btn_right_exit.png","fishdld/fight/mainui/btn_right_setting.png","fishdld/fight/mainui/btn_right_hide.png","fishdld/fight/mainui/btn_left_show.png","fishdld/fight/mainui/btn_free_prize_pool.png","fishdld/fight/mainui/btn_callup.png","fishdld/fight/mainui/img_notice_bg.png"],loadList3D:[]},ns.FightSceneUI=bi,e("ui.fishdld.fight.FightSceneUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[mr,pi,Qo],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{width:100,height:100},compId:2,child:[{type:"Image",props:{y:0,x:4,width:373,skin:"fishdld/fight/mainui/img_fish_coming.png",pivotY:32,pivotX:187,name:"bg",height:64},compId:3},{type:"Label",props:{y:-1,x:4,width:241,var:"fish_name",valign:"middle",text:"label",pivotY:24,pivotX:121,height:43,fontSize:30,color:"#ffffff",align:"center"},compId:6},{type:"Image",props:{y:0,x:-149,width:147,var:"fish_icon",skin:"fishdld/fight/fishicon/fish_30.png",pivotY:83,pivotX:92,height:133},compId:4}],loadList:["fishdld/fight/mainui/img_fish_coming.png","fishdld/fight/fishicon/fish_30.png"],loadList3D:[]},ns.FishCommingUI=bi,e("ui.fishdld.fight.FishCommingUI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[To,mr,es,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{height:640},compId:2,child:[{type:"Image",props:{x:89,skin:"fishdld/fight/dialog/img_preview_bg.png",centerY:-7},compId:4},{type:"Box",props:{y:0,x:0,var:"fish_point"},compId:18},{type:"Box",props:{x:0,bottom:0},compId:17,child:[{type:"Image",props:{y:0,x:0,width:643,skin:"fishdld/fight/dialog/img_dialog_bg1.png",sizeGrid:"70,59,137,88",height:196},compId:12},{type:"Label",props:{y:31,x:69,var:"fish_name",text:"金蝉",fontSize:23,color:"#00ffe0"},compId:5},{type:"Label",props:{y:31,x:161,var:"kind",text:"（特殊）",fontSize:23,color:"#31f80b"},compId:6},{type:"Label",props:{y:31,x:309,text:"分值：",fontSize:23,color:"#52c3d9"},compId:7},{type:"Label",props:{y:31,x:376,var:"rate",text:"150",fontSize:23,color:"#f9dc08"},compId:8},{type:"Label",props:{y:81,x:49,text:"鱼介绍：",fontSize:23,color:"#52c3d9"},compId:13},{type:"Label",props:{y:108,x:48,wordWrap:!0,width:536,var:"desc",text:"闪电发货是封锁费购水电费是大佛桑搜灯f发几个发几个披萨打飞机扫风格低价时代峻峰",height:59,fontSize:23,color:"#52c3d9"},compId:14}]}],loadList:["fishdld/fight/dialog/img_preview_bg.png","fishdld/fight/dialog/img_dialog_bg1.png"],loadList3D:[]},ns.FishPreviewDialogUI=bi,e("ui.fishdld.fight.FishPreviewDialogUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[pi,mr,Qo],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{y:0,x:0,var:"time",skin:"fishdld/animation/anigun/gun6/add_time.png",anchorY:.5,anchorX:.5},compId:3},{type:"Image",props:{y:-44,x:-62.5,var:"rate",skin:"fishdld/animation/anigun/gun6/add_rate.png"},compId:5},{type:"Label",props:{y:-6,x:-6,width:52,var:"num",text:"+6",scaleY:1.3,scaleX:1.3,height:26,font:"fnt_gun_com",anchorY:.5,anchorX:.5,align:"center"},compId:4}],loadList:["fishdld/animation/anigun/gun6/add_time.png","fishdld/animation/anigun/gun6/add_rate.png"],loadList3D:[]},ns.FreeGunAddUI=bi,e("ui.fishdld.fight.FreeGunAddUI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[To,mr,ta,Ho,Eo,es,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{},compId:2,child:[{type:"Image",props:{y:0,x:0,skin:"fishdld/fight/dialog/img_free_prize_bg.png"},compId:3},{type:"Box",props:{y:132,x:312,width:693,var:"levels",mouseEnabled:!0,height:69},compId:13,child:[{type:"Clip",props:{y:0,x:0,skin:"fishdld/fight/dialog/clip_draw_level_0.png",clipX:2},compId:7},{type:"Clip",props:{y:0,x:118,skin:"fishdld/fight/dialog/clip_draw_level_1.png",clipX:2},compId:8},{type:"Clip",props:{y:0,x:235,skin:"fishdld/fight/dialog/clip_draw_level_2.png",clipX:2},compId:9},{type:"Clip",props:{y:0,x:353,skin:"fishdld/fight/dialog/clip_draw_level_3.png",clipX:2},compId:10},{type:"Clip",props:{y:0,x:505,visible:!1,skin:"fishdld/fight/dialog/clip_draw_level_4.png",clipX:2},compId:11},{type:"Clip",props:{y:-2,x:620,visible:!1,skin:"fishdld/fight/dialog/clip_draw_level_5.png",clipX:2},compId:12}]},{type:"Box",props:{y:441,x:186,mouseEnabled:!0},compId:17,child:[{type:"Image",props:{y:0,x:0,width:135,skin:"fishdld/fight/dialog/img_mfcj_jjc.png",sizeGrid:"33,30,28,31",height:78},compId:14},{type:"Label",props:{y:8,x:44,text:"当前奖池",fontSize:15,color:"#ffe35b"},compId:18},{type:"Image",props:{y:25,x:19,width:21,skin:"fishdld/fight/dialog/img_icon_jq.png",height:23},compId:19},{type:"Label",props:{y:28,x:43,width:83,var:"cur_prize",text:"245,656",height:15,fontSize:15,color:"#ffe35b"},compId:20},{type:"Label",props:{y:53,x:10,text:"奖池开关",fontSize:15,color:"#ffffff"},compId:21},{type:"Clip",props:{y:51,x:77,width:50,var:"switch",skin:"fishdld/fight/dialog/clip_switch.png",index:1,height:21,clipY:2},compId:22}]},{type:"Box",props:{y:445,x:356},compId:23,child:[{type:"Label",props:{text:"炮台倍数越高，奖金积累越快！",fontSize:15,color:"#ffe35b"},compId:24},{type:"Label",props:{y:23,x:0,text:"击杀奖金鱼会有1%的金币进入奖池，用来抽奖",fontSize:15,color:"#ffffff"},compId:25},{type:"Label",props:{y:52,x:0,var:"level_name",text:"普通抽奖",fontSize:15,color:"#ffe35b"},compId:26},{type:"Box",props:{y:47,x:70,width:221,name:"progress",height:26},compId:32,child:[{type:"Image",props:{y:0,x:0,width:221,skin:"fishdld/fight/dialog/img_pro_bg.png",sizeGrid:"0,18,0,19",height:26},compId:29},{type:"Panel",props:{y:2,x:2,width:1e-4,var:"progress_bar",height:23},compId:31,child:[{type:"Image",props:{y:0,x:0,width:217,skin:"fishdld/fight/dialog/img_pro_bar.png",sizeGrid:"0,18,0,17",height:22},compId:30}]},{type:"Label",props:{y:5.5,x:40.5,width:140,var:"progress_value",height:15,fontSize:15,color:"#ffffff",align:"center"},compId:33}]}]},{type:"Button",props:{y:78,x:859.5,stateNum:1,skin:"fishdld/fight/dialog/btn_close.png",name:"close"},compId:75,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:76}]},{type:"Button",props:{y:67,x:784,var:"help_btn",stateNum:1,skin:"fishdld/fight/dialog/btn_help.png"},compId:73,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:74}]},{type:"Button",props:{y:444,x:701,var:"lottery_btn",stateNum:1,skin:"fishdld/fight/dialog/btn_lottry.png"},compId:34,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:35}]},{type:"Box",props:{y:213,x:165,width:697,var:"shell_box",height:198},compId:36,child:[{type:"Shell",props:{y:-12,x:0,runtime:"ui.fishdld.fight.ShellUI"},compId:67},{type:"Shell",props:{y:86,x:104,runtime:"ui.fishdld.fight.ShellUI"},compId:68},{type:"Shell",props:{y:-12,x:213,runtime:"ui.fishdld.fight.ShellUI"},compId:69},{type:"Shell",props:{y:89,x:341,runtime:"ui.fishdld.fight.ShellUI"},compId:70},{type:"Shell",props:{y:-12,x:444,runtime:"ui.fishdld.fight.ShellUI"},compId:71},{type:"Shell",props:{y:86,x:570,runtime:"ui.fishdld.fight.ShellUI"},compId:72}]}],loadList:["fishdld/fight/dialog/img_free_prize_bg.png","fishdld/fight/dialog/clip_draw_level_0.png","fishdld/fight/dialog/clip_draw_level_1.png","fishdld/fight/dialog/clip_draw_level_2.png","fishdld/fight/dialog/clip_draw_level_3.png","fishdld/fight/dialog/clip_draw_level_4.png","fishdld/fight/dialog/clip_draw_level_5.png","fishdld/fight/dialog/img_mfcj_jjc.png","fishdld/fight/dialog/img_icon_jq.png","fishdld/fight/dialog/clip_switch.png","fishdld/fight/dialog/img_pro_bg.png","fishdld/fight/dialog/img_pro_bar.png","fishdld/fight/dialog/btn_close.png","fishdld/fight/dialog/btn_help.png","fishdld/fight/dialog/btn_lottry.png"],loadList3D:[]},ns.FreePrizeDialogUI=bi,e("ui.fishdld.fight.FreePrizeDialogUI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[es,To,pi,Eo,mr],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{},compId:2,child:[{type:"Box",props:{y:4,x:0,name:"bg"},compId:3,child:[{type:"Image",props:{y:24,x:0,width:760,skin:"fishdld/fight/dialog/img_dialog_bg1.png",height:335},compId:12},{type:"Image",props:{y:1,x:12,width:725,skin:"fishdld/fight/dialog/img_dialog_bg2.png",sizeGrid:"0,95,0,88",height:78},compId:13},{type:"Button",props:{y:-6,x:682,stateNum:1,skin:"fishdld/fight/dialog/btn_dialog_close.png",name:"close"},compId:14,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:15}]},{type:"Label",props:{y:21,x:318.828125,text:"玩法说明",fontSize:30,color:"#ffffff",bold:!0},compId:16}]},{type:"Label",props:{y:108,x:37,text:"1、玩家在游戏内击杀奖金鱼：金蝉、锤头金鲨、大金鲨、宝藏章鱼、金炸弹鱼，",fontSize:20,color:"#4cd1ea"},compId:17},{type:"Label",props:{y:138,x:37,text:"会有1%的金币进入奖池，用来抽奖；",fontSize:20,color:"#4cd1ea"},compId:18},{type:"Label",props:{y:168,x:37,text:"2、关闭奖池开关后，击杀奖金鱼将不会有1%的金币进入奖池；",fontSize:20,color:"#4cd1ea"},compId:19},{type:"Label",props:{y:198,x:37,text:"3、免费抽奖分为4档：普通抽奖、青铜抽奖、白银抽奖、黄金抽奖；",fontSize:20,color:"#4cd1ea"},compId:20},{type:"Label",props:{y:228,x:37,text:"4、消耗对应档次的奖池金币进行免费抽奖，获得对应奖品。奖品：召唤卷、",fontSize:20,color:"#4cd1ea"},compId:22},{type:"Label",props:{y:258,x:37,text:"金币等。",fontSize:20,color:"#4cd1ea"},compId:23}],loadList:["fishdld/fight/dialog/img_dialog_bg1.png","fishdld/fight/dialog/img_dialog_bg2.png","fishdld/fight/dialog/btn_dialog_close.png"],loadList3D:[]},ns.FreePrizeHelpDialogUI=bi,e("ui.fishdld.fight.FreePrizeHelpDialogUI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[zo,es,To,pi,Eo,mr,Ho,Bt,ta],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{},compId:2,child:[{type:"Box",props:{y:-4,x:-18,name:"bg"},compId:6,child:[{type:"Image",props:{y:24,x:0,width:925,skin:"fishdld/fight/dialog/img_dialog_bg1.png",height:574},compId:4},{type:"Image",props:{y:1,x:19,width:879,skin:"fishdld/fight/dialog/img_dialog_bg2.png",sizeGrid:"0,95,0,88",height:78},compId:5},{type:"Button",props:{y:-5,x:848,stateNum:1,skin:"fishdld/fight/dialog/btn_dialog_close.png",name:"close"},compId:7,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:27}]},{type:"Label",props:{y:24,x:397.328125,text:"游戏帮助",fontSize:30,color:"#ffffff",bold:!0},compId:28}]},{type:"Panel",props:{y:131,x:2,width:876,vScrollBarSkin:" ",name:"panel_0",height:432,elasticEnabled:!0},compId:29,child:[{type:"Sprite",props:{y:11,x:356,texture:"fishdld/fight/dialog/ejtk_yqbtr.png",height:35},compId:30},{type:"Label",props:{y:16,x:403,text:"普通鱼",fontSize:25,color:"#52c3d9"},compId:36},{type:"Label",props:{y:18.5,x:573,text:"点击图鉴可详细了解具体介绍",fontSize:20,color:"#52c3d9"},compId:201},{type:"List",props:{y:62,x:45,width:799,var:"normal_fish_list",spaceY:5,spaceX:12,repeatY:4,height:413},compId:55,child:[{type:"Box",props:{renderType:"render"},compId:56,child:[{type:"Sprite",props:{y:-1,x:0,width:103,texture:"fishdld/fight/dialog/fish_item_bg.png",height:134},compId:57},{type:"Image",props:{y:11,x:-.5,width:104,name:"icon",height:104},compId:58},{type:"Image",props:{y:104,x:0,width:103,skin:"fishdld/fight/dialog/img_fish_item_mask.png",sizeGrid:"0,53,0,44",height:26},compId:59},{type:"Label",props:{y:106,x:8,width:89,text:"50",strokeColor:"#138e84",stroke:1,name:"rate",height:20,fontSize:20,color:"#ffcc20",align:"center"},compId:60},{type:"Label",props:{y:2,x:5,width:93,text:"金蝉",name:"fish_name",height:20,fontSize:20,color:"#fdfdfd",align:"center"},compId:61}]}]},{type:"Sprite",props:{y:642,x:356.5,texture:"fishdld/fight/dialog/ejtk_yqbtr.png",height:35},compId:63},{type:"Label",props:{y:647,x:402,text:"大型鱼",fontSize:25,color:"#52c3d9"},compId:54},{type:"Label",props:{y:649,x:573,text:"点击图鉴可详细了解具体介绍",fontSize:20,color:"#52c3d9"},compId:202},{type:"List",props:{y:702,x:45,width:799,var:"big_fish_list",spaceY:5,spaceX:12,repeatY:2,height:274},compId:37,child:[{type:"Box",props:{renderType:"render"},compId:38,child:[{type:"Sprite",props:{y:-1,x:0,width:103,texture:"fishdld/fight/dialog/fish_item_bg.png",height:134},compId:39},{type:"Image",props:{y:11,x:-.5,width:104,name:"icon",height:104},compId:40},{type:"Image",props:{y:105,x:0,width:103,skin:"fishdld/fight/dialog/img_fish_item_mask.png",sizeGrid:"0,53,0,44",height:26},compId:41},{type:"Label",props:{y:107,x:8,width:89,text:"50",strokeColor:"#138e84",stroke:1,name:"rate",height:20,fontSize:20,color:"#f3d87c",align:"center"},compId:42},{type:"Label",props:{y:2,x:5,width:93,text:"金蝉",name:"fish_name",height:20,fontSize:20,color:"#fdfdfd",align:"center"},compId:46}]}]},{type:"Sprite",props:{y:1003,x:358,texture:"fishdld/fight/dialog/ejtk_yqbtr.png",height:35},compId:192},{type:"Label",props:{y:1007,x:404,text:"特殊鱼",fontSize:25,color:"#52c3d9"},compId:193},{type:"Label",props:{y:1010,x:573,text:"点击图鉴可详细了解具体介绍",fontSize:20,color:"#52c3d9"},compId:203},{type:"List",props:{y:1062,x:47,width:799,var:"special_fish_list",spaceY:5,spaceX:12,repeatY:1,height:268},compId:194,child:[{type:"Box",props:{renderType:"render"},compId:195,child:[{type:"Sprite",props:{y:-1,x:0,width:103,texture:"fishdld/fight/dialog/fish_item_bg.png",height:134},compId:196},{type:"Image",props:{y:11,x:-.5,width:104,name:"icon",height:104},compId:197},{type:"Image",props:{y:105,x:0,width:103,skin:"fishdld/fight/dialog/img_fish_item_mask.png",sizeGrid:"0,53,0,44",height:26},compId:198},{type:"Label",props:{y:107,x:8,width:89,text:"50",strokeColor:"#138e84",stroke:1,name:"rate",height:20,fontSize:20,color:"#f3d87c",align:"center"},compId:199},{type:"Label",props:{y:2,x:5,width:93,text:"金蝉",name:"fish_name",height:20,fontSize:20,color:"#fdfdfd",align:"center"},compId:200}]}]}]},{type:"Panel",props:{y:131,x:2,width:876,visible:!1,vScrollBarSkin:" ",name:"panel_1",height:423,elasticEnabled:!0},compId:87,child:[{type:"Sprite",props:{y:23,x:355.5,texture:"fishdld/fight/dialog/ejtk_yqbtr.png"},compId:88},{type:"Label",props:{y:27,x:390,text:"加速射击",fontSize:25,color:"#52c3d9"},compId:89},{type:"Label",props:{y:71,x:26,text:"点击“",fontSize:22,color:"#52c3d9",bold:!0},compId:106},{type:"Sprite",props:{y:119,x:356.5,texture:"fishdld/fight/dialog/ejtk_yqbtr.png"},compId:97},{type:"Label",props:{y:123,x:390,text:"连续射击",fontSize:25,color:"#52c3d9"},compId:98},{type:"Label",props:{y:71,x:138,text:"”，玩家可自由切换速度，分别为1倍速、2倍速、4倍速",fontSize:22,color:"#52c3d9",bold:!0},compId:107},{type:"Button",props:{y:64,x:91,width:38,stateNum:1,skin:"fishdld/fight/mainui/btn_dldby_kuangbao0_ui.png",height:39},compId:108},{type:"Label",props:{y:161.5,x:26,text:"点击“",fontSize:22,color:"#52c3d9",bold:!0},compId:109},{type:"Label",props:{y:162,x:138.75,text:"”，可自动发射子弹。",fontSize:22,color:"#52c3d9",bold:!0},compId:110},{type:"Button",props:{y:155,x:91.75,width:38,stateNum:1,skin:"fishdld/fight/mainui/btn_auto_fire.png",height:39},compId:111},{type:"Sprite",props:{y:200,x:357.5,texture:"fishdld/fight/dialog/ejtk_yqbtr.png"},compId:112},{type:"Label",props:{y:204,x:378,text:"锁定特殊鱼",fontSize:25,color:"#52c3d9"},compId:113},{type:"Label",props:{y:248,x:27,text:"点击“",fontSize:22,color:"#52c3d9",bold:!0},compId:114},{type:"Label",props:{y:248,x:139,text:"”，可自动锁定屏幕中的特殊鱼，点击按钮可自动切换锁定不同的特殊鱼。",fontSize:22,color:"#52c3d9",bold:!0},compId:115},{type:"Button",props:{y:240,x:92,width:38,stateNum:1,skin:"fishdld/fight/mainui/btn_lock_special.png",height:39},compId:116},{type:"Sprite",props:{y:289,x:358,texture:"fishdld/fight/dialog/ejtk_yqbtr.png"},compId:175},{type:"Label",props:{y:293,x:391,text:"锁定大鱼",fontSize:25,color:"#52c3d9"},compId:176},{type:"Label",props:{y:340,x:27,text:"点击“",fontSize:22,color:"#52c3d9",bold:!0},compId:180},{type:"Label",props:{y:338,x:139,text:"”，可自动锁定屏幕中的大鱼，点击按钮可自动切换锁定不同的大鱼。",fontSize:22,color:"#52c3d9",bold:!0},compId:181},{type:"Button",props:{y:329,x:92,width:38,stateNum:1,skin:"fishdld/fight/mainui/btn_lock_big.png",height:39},compId:182},{type:"Sprite",props:{y:379,x:358,texture:"fishdld/fight/dialog/ejtk_yqbtr.png"},compId:204},{type:"Label",props:{y:383,x:405,text:"召唤券",fontSize:25,color:"#52c3d9"},compId:205},{type:"Label",props:{y:426,x:26,text:"点击“",fontSize:22,color:"#52c3d9",bold:!0},compId:206},{type:"Label",props:{y:424,x:138,text:"”，可任意召唤金蝉、锤头金鲨、大金鲨、宝藏章鱼、金炸弹鱼5种鱼类，",fontSize:22,color:"#52c3d9",bold:!0},compId:207},{type:"Button",props:{y:415,x:91,width:38,stateNum:1,skin:"fishdld/fight/mainui/yxjm_zhicon.png",height:39},compId:208},{type:"Label",props:{y:463,x:26,text:"召唤券免费奖池抽奖可获得。",fontSize:22,color:"#52c3d9",bold:!0},compId:209}]},{type:"Panel",props:{y:131,x:2,width:876,visible:!1,name:"panel_2",height:414,hScrollBarSkin:" ",elasticEnabled:!0},compId:133,child:[{type:"Image",props:{x:0,skin:"fishdld/fight/dialog/img_weapon_bg.png"},compId:151,child:[{type:"Sprite",props:{y:39.5,x:77,width:122,texture:"fishdld/fight/dialog/select_battery_1.png",height:176},compId:156},{type:"Label",props:{y:237,x:93,text:"初级炮",fontSize:30,color:"#ffffff"},compId:157},{type:"Label",props:{y:299,x:38,wordWrap:!0,width:201,text:"威力弱小，打鱼能力一般",leading:10,height:74,fontSize:25,color:"#ffffff"},compId:158}]},{type:"Image",props:{y:0,x:256,skin:"fishdld/fight/dialog/img_weapon_bg.png"},compId:159,child:[{type:"Sprite",props:{y:39.5,x:77,width:122,texture:"fishdld/fight/dialog/select_battery_2.png",height:176},compId:160},{type:"Label",props:{y:237,x:93,text:"普通炮",fontSize:30,color:"#ffffff"},compId:161},{type:"Label",props:{y:299,x:38,wordWrap:!0,width:201,text:"火力普通，小投入小回报",leading:10,height:74,fontSize:25,color:"#ffffff"},compId:162}]},{type:"Image",props:{y:0,x:513,skin:"fishdld/fight/dialog/img_weapon_bg.png"},compId:163,child:[{type:"Sprite",props:{y:40.5,x:54,width:169,texture:"fishdld/fight/dialog/select_battery_6.png",height:169},compId:164},{type:"Label",props:{y:237,x:93,text:"中级炮",fontSize:30,color:"#ffffff"},compId:165},{type:"Label",props:{y:299,x:38,wordWrap:!0,width:201,text:"小鱼克星，大鱼也不容易错过",leading:10,height:74,fontSize:25,color:"#ffffff"},compId:166}]},{type:"Image",props:{y:0,x:769,skin:"fishdld/fight/dialog/img_weapon_bg.png"},compId:167,child:[{type:"Sprite",props:{y:43.5,x:59,width:158,texture:"fishdld/fight/dialog/select_battery_7.png",height:166},compId:168},{type:"Label",props:{y:237,x:93,text:"高级炮",fontSize:30,color:"#ffffff"},compId:169},{type:"Label",props:{y:299,x:38,wordWrap:!0,width:201,text:"火力加强，捕鱼回报率直线飙升",leading:10,height:74,fontSize:25,color:"#ffffff"},compId:170}]},{type:"Image",props:{y:0,x:1025,skin:"fishdld/fight/dialog/img_weapon_bg.png"},compId:171,child:[{type:"Sprite",props:{y:40.5,x:43.5,width:190,texture:"fishdld/fight/dialog/select_battery_8.png",height:169},compId:172},{type:"Label",props:{y:237,x:93,text:"特级炮",fontSize:30,color:"#ffffff"},compId:173},{type:"Label",props:{y:299,x:35,wordWrap:!0,width:205,text:"威力爆棚，boss也能轻松应对",leading:10,height:74,fontSize:25,color:"#ffffff"},compId:174}]}]},{type:"Clip",props:{y:68,x:-2,width:298,skin:"fishdld/fight/dialog/clip_ejtk_tab.png",name:"tab_0",index:0,height:77,clipY:2},compId:33,child:[{type:"Label",props:{y:14.5,x:98.0234375,text:"鱼种图鉴",fontSize:25,color:"#1a5864",bold:!0},compId:64}]},{type:"Clip",props:{y:68,x:292,width:298,skin:"fishdld/fight/dialog/clip_ejtk_tab.png",name:"tab_1",height:77,clipY:2},compId:34,child:[{type:"Label",props:{y:15,x:98,text:"操作说明",fontSize:25,color:"#1a5864",bold:!0},compId:65}]},{type:"Clip",props:{y:68,x:586,width:298,skin:"fishdld/fight/dialog/clip_ejtk_tab.png",name:"tab_2",height:77,clipY:2},compId:35,child:[{type:"Label",props:{y:15,x:98,text:"武器说明",fontSize:25,color:"#1a5864",bold:!0},compId:67}]}],loadList:["fishdld/fight/dialog/img_dialog_bg1.png","fishdld/fight/dialog/img_dialog_bg2.png","fishdld/fight/dialog/btn_dialog_close.png","fishdld/fight/dialog/ejtk_yqbtr.png","fishdld/fight/dialog/fish_item_bg.png","fishdld/fight/dialog/img_fish_item_mask.png","fishdld/fight/mainui/btn_dldby_kuangbao0_ui.png","fishdld/fight/mainui/btn_auto_fire.png","fishdld/fight/mainui/btn_lock_special.png","fishdld/fight/mainui/btn_lock_big.png","fishdld/fight/mainui/yxjm_zhicon.png","fishdld/fight/dialog/img_weapon_bg.png","fishdld/fight/dialog/select_battery_1.png","fishdld/fight/dialog/select_battery_2.png","fishdld/fight/dialog/select_battery_6.png","fishdld/fight/dialog/select_battery_7.png","fishdld/fight/dialog/select_battery_8.png","fishdld/fight/dialog/clip_ejtk_tab.png"],loadList3D:[]},ns.HelpDialogUI=bi,e("ui.fishdld.fight.HelpDialogUI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[es],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{y:0,x:0,width:1136,height:640},compId:2,child:[{type:"Shell",props:{y:191,x:287,scaleY:1.7,scaleX:1.7,anchorY:.5,anchorX:.5,runtime:"ui.fishdld.fight.ShellUI"},compId:3},{type:"Shell",props:{y:191,x:570,scaleY:1.7,scaleX:1.7,anchorY:.5,anchorX:.5,runtime:"ui.fishdld.fight.ShellUI"},compId:6},{type:"Shell",props:{y:191,x:853,scaleY:1.7,scaleX:1.7,anchorY:.5,anchorX:.5,runtime:"ui.fishdld.fight.ShellUI"},compId:7},{type:"Shell",props:{y:413,x:287,scaleY:1.7,scaleX:1.7,anchorY:.5,anchorX:.5,runtime:"ui.fishdld.fight.ShellUI"},compId:8},{type:"Shell",props:{y:413,x:570,scaleY:1.7,scaleX:1.7,anchorY:.5,anchorX:.5,runtime:"ui.fishdld.fight.ShellUI"},compId:9},{type:"Shell",props:{y:413,x:853,scaleY:1.7,scaleX:1.7,anchorY:.5,anchorX:.5,runtime:"ui.fishdld.fight.ShellUI"},compId:10}],loadList:[],loadList3D:[]},ns.LotteryDialogUI=bi,e("ui.fishdld.fight.LotteryDialogUI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[mr,es,To,pi],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{},compId:2,child:[{type:"Box",props:{y:2,x:0,name:"bg"},compId:3,child:[{type:"Image",props:{y:24,x:0,width:573,skin:"fishdld/fight/dialog/img_dialog_bg1.png",height:285},compId:7},{type:"Image",props:{y:1,x:12,width:545,skin:"fishdld/fight/dialog/img_dialog_bg2.png",sizeGrid:"0,95,0,88",height:78},compId:8},{type:"Label",props:{y:25,x:241.328125,text:"温馨提示",fontSize:30,color:"#ffffff",bold:!0},compId:11}]},{type:"Label",props:{y:120,x:79.5,wordWrap:!0,width:414,text:"您长时间未发射子弹，倒计时结束后将会被系统请出房间",leading:5,height:73,fontSize:30,color:"#52c3d9",align:"center"},compId:5},{type:"Label",props:{y:214,x:250.5,wordWrap:!0,width:72,var:"timer_label",text:"15",leading:5,height:25,fontSize:30,color:"#ef5f5f",bold:!0,align:"center"},compId:6}],loadList:["fishdld/fight/dialog/img_dialog_bg1.png","fishdld/fight/dialog/img_dialog_bg2.png"],loadList3D:[]},ns.NoActionCountDownDilaogUI=bi,e("ui.fishdld.fight.NoActionCountDownDilaogUI",bi),(bi=function(){T(n,es);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[ta,es,To,pi,Eo,mr,Bt],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"Dialog",props:{},compId:2,child:[{type:"Box",props:{y:6,x:-8,name:"bg"},compId:3,child:[{type:"Image",props:{y:24,x:0,width:598,skin:"fishdld/fight/dialog/img_dialog_bg1.png",height:285},compId:4},{type:"Image",props:{y:1,x:12,width:569,skin:"fishdld/fight/dialog/img_dialog_bg2.png",sizeGrid:"0,95,0,88",height:78},compId:5},{type:"Button",props:{y:-4,x:525,stateNum:1,skin:"fishdld/fight/dialog/btn_dialog_close.png",name:"close"},compId:6,child:[{type:"Script",props:{runtime:"framework/view/ui/ScaleButton.ts"},compId:7}]},{type:"Label",props:{y:25,x:237.828125,text:"游戏设置",fontSize:30,color:"#ffffff",bold:!0},compId:8}]},{type:"Image",props:{y:93,x:18,width:540,skin:"fishdld/fight/dialog/img_item_bg.png",sizeGrid:"21,19,23,22",height:80},compId:9},{type:"Label",props:{y:118,x:60,text:"音效",fontSize:30,color:"#ffffff"},compId:10},{type:"Sprite",props:{y:107,x:136,texture:"fishdld/fight/dialog/ty_yl.png"},compId:11},{type:"Clip",props:{y:101.5,x:372,var:"effect_btn",stateNum:2,skin:"fishdld/fight/dialog/clip_switch.png",selected:!0,index:1,clipY:2},compId:12},{type:"Image",props:{y:193,x:18,width:540,skin:"fishdld/fight/dialog/img_item_bg.png",sizeGrid:"21,19,23,22",height:80},compId:13},{type:"Label",props:{y:219,x:60,text:"音乐",fontSize:30,color:"#ffffff"},compId:14},{type:"Sprite",props:{y:204,x:136,texture:"fishdld/fight/dialog/ty_yyy.png"},compId:15},{type:"Clip",props:{y:202,x:372,var:"music_btn",stateNum:2,skin:"fishdld/fight/dialog/clip_switch.png",selected:!0,index:1,clipY:2},compId:16}],loadList:["fishdld/fight/dialog/img_dialog_bg1.png","fishdld/fight/dialog/img_dialog_bg2.png","fishdld/fight/dialog/btn_dialog_close.png","fishdld/fight/dialog/img_item_bg.png","fishdld/fight/dialog/ty_yl.png","fishdld/fight/dialog/clip_switch.png","fishdld/fight/dialog/ty_yyy.png"],loadList3D:[]},ns.SettingDialogUI=bi,e("ui.fishdld.fight.SettingDialogUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[Tn,pi,mr,Qo,ta],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{width:120,height:118},compId:2,child:[{type:"Image",props:{y:49,x:62,width:188,skin:"fishdld/fight/dialog/img_shell_bg.png",height:188,anchorY:.5,anchorX:.5,alpha:0},compId:7},{type:"Clip",props:{y:59,x:62,width:114,skin:"fishdld/fight/dialog/clip_shell.png",index:0,height:118,clipX:2,anchorY:.5,anchorX:.5},compId:3},{type:"Image",props:{y:56,x:62,width:63,var:"prize_icon",skin:"fishdld/fight/dialog/prize_1.png",scaleY:0,scaleX:0,height:63,anchorY:.5,anchorX:.5,alpha:0},compId:4},{type:"Image",props:{y:84,x:8,width:101,skin:"fishdld/fight/dialog/img_xui_yclxd.png",height:19,alpha:0},compId:5},{type:"Label",props:{y:88,x:0,width:117,var:"prize_name",text:"1000金币",strokeColor:"#3e3a3a",stroke:1,fontSize:13,color:"#efdede",alpha:0,align:"center"},compId:6}],animations:[{nodes:[{target:3,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:0},{value:13,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:1},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:2},{value:-13,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:4},{value:13,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:5},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:6},{value:0,tweenMethod:"linearNone",tween:!0,target:3,key:"rotation",index:7}],index:[{value:0,tweenMethod:"linearNone",tween:!1,target:3,key:"index",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:3,key:"index",index:7}]}},{target:4,keyframes:{scaleY:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:0},{value:0,tweenMethod:"elasticOut",tween:!0,target:4,key:"scaleY",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleY",index:13}],scaleX:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:0},{value:0,tweenMethod:"elasticOut",tween:!0,target:4,key:"scaleX",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"scaleX",index:13}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:4,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:13}]}},{target:5,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:5,key:"alpha",index:17}]}},{target:6,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:6,key:"alpha",index:17}]}}],name:"ani1",id:1,frameRate:24,action:0},{nodes:[{target:7,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:15},{value:5040,tweenMethod:"linearNone",tween:!0,target:7,key:"rotation",index:215}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:7,key:"alpha",index:15}]}}],name:"ani2",id:2,frameRate:24,action:0}],loadList:["fishdld/fight/dialog/img_shell_bg.png","fishdld/fight/dialog/clip_shell.png","fishdld/fight/dialog/prize_1.png","fishdld/fight/dialog/img_xui_yclxd.png"],loadList3D:[]},ns.ShellUI=bi,e("ui.fishdld.fight.ShellUI",bi),ns=ts=ts||{},ns=(bi=ns.fishdld||(ns.fishdld={})).loading||(bi.loading={}),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[pi,mr,Ho,To,Qo,Bt,oo],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{var:"bg",top:0,skin:"fishdld/loading/loading_bg.jpg",right:0,left:0,bottom:0},compId:3},{type:"Label",props:{width:379,visible:!1,var:"txt",text:"加载中  0%",height:22,fontSize:18,color:"#ffffff",centerX:-28,bottom:600,bold:!0,align:"center"},compId:9},{type:"Box",props:{centerX:0,bottom:40},compId:26,child:[{type:"Sprite",props:{y:0,x:0,texture:"fishdld/loading/xui_loadingdi.png"},compId:12},{type:"Panel",props:{y:21,x:8,width:892,var:"water_mask",height:33},compId:25,child:[{type:"Image",props:{x:0,var:"water",skin:"fishdld/loading/shuibowen_1.png"},compId:11}]},{type:"Image",props:{y:5,x:55,var:"bubble",skin:"fishdld/loading/paopao_1.png"},compId:13},{type:"Box",props:{y:13,x:8,width:892,var:"coin_box",height:39},compId:15,child:[{type:"Animation",props:{y:18.5,x:83,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:14},{type:"Animation",props:{y:19,x:174,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:17},{type:"Animation",props:{y:19,x:265,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:18},{type:"Animation",props:{y:19,x:356,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:19},{type:"Animation",props:{y:19,x:447,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:20},{type:"Animation",props:{y:19,x:538,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:21},{type:"Animation",props:{y:19,x:629,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:22},{type:"Animation",props:{y:19,x:720,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:23},{type:"Animation",props:{y:19,x:811,width:"",source:"fishdld/loading/CoinAnimation.ani",height:"",autoPlay:!0},compId:24}]},{type:"Image",props:{y:33,x:0,width:68,var:"puffer",skin:"fishdld/loading/puffer_0.png",height:63,anchorY:.5,anchorX:.5},compId:27}]}],loadList:["fishdld/loading/loading_bg.jpg","fishdld/loading/xui_loadingdi.png","fishdld/loading/shuibowen_1.png","fishdld/loading/paopao_1.png","fishdld/loading/CoinAnimation.ani","fishdld/loading/puffer_0.png"],loadList3D:[]},ns.LoadingSceneUI=bi,e("ui.fishdld.loading.LoadingSceneUI",bi),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[pi,bo,mr,Qo],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"Image",props:{width:1136,var:"bg",skin:"fishdld/loading/loading_bg.jpg",height:640,centerY:0,centerX:0},compId:3},{type:"ProgressBar",props:{width:823,var:"progress",value:0,skin:"fishdld/loading/progress.png",sizeGrid:"10,20,10,10",height:18,centerX:0,bottom:55},compId:5},{type:"Label",props:{width:379,var:"txt",text:"加载中  0%",height:22,fontSize:18,color:"#ffffff",centerX:10,bottom:78,bold:!0,align:"center"},compId:9}],loadList:["fishdld/loading/loading_bg.jpg","fishdld/loading/progress.png"],loadList3D:[]},ns.LoadingViewUI=bi,e("ui.fishdld.loading.LoadingViewUI",bi),ns=ts=ts||{},ns=(bi=ns.fishdld||(ns.fishdld={})).lobby||(bi.lobby={}),(bi=function(){T(n,Qo);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).referenceClass=[zo,Qo,To,mr],e}return C(n,[{key:"createChildren",value:function(){G(z(n.prototype),"createChildren",this).call(this),this.createView(n.uiView)}}]),n}()).uiView={type:"View",props:{},compId:2,child:[{type:"List",props:{width:290,visible:!1,var:"room_list",spaceY:20,repeatX:1,height:549,centerY:0,centerX:0},compId:3,child:[{type:"Box",props:{name:"render",bgColor:"#322626"},compId:4,child:[{type:"Label",props:{y:0,x:0,width:290,name:"name",height:50,fontSize:25,color:"#ffffff"},compId:5}]}]}],loadList:[],loadList3D:[]},ns.LobbySceneUI=bi,e("ui.fishdld.lobby.LobbySceneUI",bi);var is=function(){function e(){S(this,e)}return C(e,null,[{key:"init",value:function(){var e=this;zn.stage.on(Je.FOCUS,this,function(){e.curMusic&&0==en.musicPosition&&e.playMusic(e.curMusic,!0)})}},{key:"playMusic",value:function(e,t){this.curMusic==e&&!t||(this.curMusic=e,en.playMusic("res/fishdld/sound/"+e,0))}},{key:"playBeHit",value:function(e){var t=this;this.isPlayingBeHited||(this.isPlayingBeHited=!0,en.playSound("res/fishdld/sound/"+e,1,F.create(this,function(){t.isPlayingBeHited=!1})))}},{key:"playSound",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length?arguments[2]:void 0;en.playSound("res/fishdld/sound/"+e,t,n)}},{key:"musicVolume",set:function(e){en.musicMuted=1!=e}},{key:"soundVolume",set:function(e){en.setSoundVolume(e)}}]),e}();is.isPlayingBeHited=!1;var as=function(){function e(){S(this,e),this.timer=new Cn,this.hitedFishUniqueIds=new Array}return C(e,[{key:"init",value:function(e,t,n){this.specialFishUniqueId=n,this.type=e,this.user=t,this.fight=t.fight,this.isRecover=!1,this.hitedFishUniqueIds=[],this.initGun()}},{key:"stop",value:function(){this.recycleComboUI(),this.timer.clearAll(this)}},{key:"initGun",value:function(){this.gunView=this.createGunView(),this.playAnimation("default")}},{key:"lockFish",value:function(e){}},{key:"playAnimation",value:function(e,t,n,i){"default"==e?(this.gunView.attack.stop(),this.gunView.default.play(t,n,i)):"attack"==e?(this.gunView.default.stop(),this.gunView.attack.play(t,n,i)):this.gunView[e].play(t,n,i)}},{key:"stopAnimation",value:function(e){this.gunView[e].stop()}},{key:"getComboUIInfo",value:function(){return null}},{key:"createComboUI",value:function(){var e=new ts.fishdld.animation.gun_comboUI;return e.score.font="coin_number.fnt",e.loop.play(0,!0),e.thunder.play(0,!0),e}},{key:"showComboUI",value:function(){var e=this.user.owner.getChildByName("win_ui_pos");Ti.temp0Point.setTo(e.x,e.y),this.user.owner.localToGlobal(Ti.temp0Point),this.combo.pos(Ti.temp0Point.x,Ti.temp0Point.y),this.combo.icon.skin=this.getComboUIInfo().icon,this.combo.title.skin=this.getComboUIInfo().title,this.combo.score.text="0",this.combo.scale(1,1),this.combo.start.play(0,!1),this.fight.view.ui_effect_layer.addChild(this.combo)}},{key:"addComboScore",value:function(e,t){null!=this.getComboUIInfo()?this.hitedFishUniqueIds.indexOf(e)<0||(this.combo||(this.combo=this.createComboUI()),this.combo.displayedInStage||this.showComboUI(),this.combo.score.text=(Number(this.combo.score.text)+t).toFixed(2),this.combo.add_score.play(0,!1),this.user.isSelf&&is.playSound("F4BY_SpineAward3.wav")):this.combo&&this.combo.parent&&this.recycleComboUI()}},{key:"recycleComboUI",value:function(){var e=this;this.combo&&pn.to(this.combo,{scaleX:0,scaleY:0},300,_n.backIn,F.create(this,function(){e.combo.removeSelf()}))}},{key:"getRotationComponent",value:function(){return this.gunView}},{key:"setDiretion",value:function(e,t){Ti.temp0Point.setTo(e,t),this.getRotationComponent().parent.globalToLocal(Ti.temp0Point);t=kn.getRotation(this.getRotationComponent().x,this.getRotationComponent().y,Ti.temp0Point.x,Ti.temp0Point.y);this.getRotationComponent().rotation=t+90}},{key:"pos",value:function(e,t){this.gunView.pos(e,t)}},{key:"addTo",value:function(e){e.addChild(this.gunView)}},{key:"setIndex",value:function(e){this.gunView.parent.setChildIndex(this.gunView,e)}},{key:"recover",value:function(){this.isRecover=!0,this.gunView.removeSelf(),g.recover("gun_type_"+this.type,this)}},{key:"muzzleWorldPos",get:function(){var e=this.getRotationComponent().getChildByName("muzzle");return Ti.temp0Point.setTo(e.x,e.y),this.getRotationComponent().localToGlobal(Ti.temp0Point)}},{key:"serverRotation",get:function(){return this.user.member.position<2?90-this.getRotationComponent().rotation:this.getRotationComponent().rotation-90},set:function(e){this.user.member.position<2?this.getRotationComponent().rotation=90-e:this.getRotationComponent().rotation=e+90}},{key:"rotation",get:function(){return this.user.member.position<2?-this.serverRotation:this.serverRotation}},{key:"name",set:function(e){this.gunView.name=e},get:function(){return this.gunView.name}}]),e}();(bi=rs=rs||{}).Init="FishInit",bi.EnterScene="FishEnterScene",bi.EnterScreen="FishEnterScreen",bi.OutScreen="FishOutScreen",bi.Died="FishDied",bi.Destroy="FishDestroy";var rs,os=rs,ss=function(){T(t,as);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"onMouseDown",value:function(){this.user.status.isMouseDown=!0,this.user.status.lockKind||this.setDiretion(this.user.mousePoint.x,this.user.mousePoint.y)}},{key:"onMouseMove",value:function(){this.user.status.isMouseDown&&!this.user.status.lockKind&&this.setDiretion(this.user.mousePoint.x,this.user.mousePoint.y)}},{key:"onUpdate",value:function(){if(this.user.status.targetFish&&this.user.status.targetFish.lifeState!=os.EnterScreen&&(this.user.status.targetFish=null),this.user.status.lockKind&&!this.user.status.targetFish){this.fight.fishScene.fishes.sort(function(){return.5<Math.random()?1:-1});var t=c(this.fight.fishScene.fishes);try{for(t.s();!(e=t.n()).done;){var e=e.value;if(e.lifeState==os.EnterScreen&&e.define.kind==this.user.status.lockKind){this.lockFish(e);break}}}catch(e){t.e(e)}finally{t.f()}}10<=this.user.status.curBuletCount||Date.now()-this.user.status.lastShootTime<Js.FIRE_SPEED/this.user.status.fireSpeed||(this.user.status.lockKind?this.user.status.targetFish&&(this.user.status.isAutoFire||this.user.status.isMouseDown)&&(this.user.isSelf||0<this.fight.fishScene.enterScreenFishes.length)&&this.shoot():(this.user.status.isAutoFire||this.user.status.isMouseDown)&&(this.user.isSelf||0<this.fight.fishScene.enterScreenFishes.length)&&this.shoot())}},{key:"shoot",value:function(){this.playAnimation("attack",0,!1),this.gunView.attack.once(Je.STOPPED,this,this.playAnimation,["default"]);var e=this.createBullet();this.fight.view.fight_layer.addChild(e),this.isFree()||this.user.addMoney(-this.user.member.cannon_level),this.user.status.curBuletCount++,this.user.status.lastShootTime=Date.now(),this.user.isSelf&&this.user.startNoActionCountDown()}},{key:"lockFish",value:function(e){this.user.status.targetFish&&this.user.status.targetFish==e||this.user.playTargetCross(),this.user.status.targetFish=e,this.user.isSelf&&zi.I.noticeLockFish(this.user.member.uid,e.uniqueId)}}]),t}();(rs=ls=ls||{})[rs.Level=0]="Level",rs[rs.Free=1]="Free",rs[rs.Electric=2]="Electric",rs[rs.Rocket=3]="Rocket";var ls,hs=ls,us=function(){T(t,qn);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"hit",value:function(e){if(this.user.isSelf){var t=[],n=c(e);try{for(n.s();!(i=n.n()).done;){var i=i.value;i.hit(this.user),t.push(i.uniqueId)}}catch(e){n.e(e)}finally{n.f()}this.hitFish(t)}else if(this.user.member.is_dummy&&this.fight.isMaster){var a=c(e);try{for(a.s();!(r=a.n()).done;){var r=r.value;r.hit(this.user),r.hp--,0===r.hp&&this.hitFish([r.uniqueId])}}catch(e){a.e(e)}finally{a.f()}}}},{key:"hitFish",value:function(e){var t=new di.FishHitContinuouslyReq;switch(t.uid=this.user.member.uid,t.fishId=e,t.bulletValue=this.user.member.cannon_level,this.getBulletType()){case hs.Level:t.freeFishId=[0];break;case hs.Free:case hs.Electric:case hs.Rocket:this.user.gun.hitedFishUniqueIds=this.user.gun.hitedFishUniqueIds.concat(e),t.freeFishId=[this.user.gun.specialFishUniqueId]}zi.I.send(t)}}]),t}(),ds=function(){T(n,us);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).direction=new L,e.speed=new L,e.radius=30,e}return C(n,[{key:"setData",value:function(e,t,n){this.node=this.owner,this.fight=e.fight,this.direction.setTo(0,0),this.speed.setTo(0,0),this.user=e,this.target=n,this.gunType=t,this.fight.view.fight_layer.addChild(this.node),this.calSpeed()}},{key:"calSpeed",value:function(){this.target&&(this.node.rotation=Ti.getRotation(this.node.x,this.node.y,this.target.getFishScreenPosistion().x,this.target.getFishScreenPosistion().y)),this.direction.x=this.node.rotation<-90||90<this.node.rotation?-1:1,this.direction.y=Math.tan(this.node.rotation*Math.PI/180)*this.direction.x,this.direction.normalize(),this.speed.x=this.direction.x,this.speed.y=this.direction.y}},{key:"onUpdate",value:function(){this.checkTarget(),this.bounce(),this.checkCrash(),this.updateTransform()}},{key:"getBulletType",value:function(){return hs.Level}},{key:"checkTarget",value:function(){this.target&&this.target.lifeState!=os.EnterScreen&&(this.target=null)}},{key:"updateTransform",value:function(){this.target&&this.calSpeed(),this.node.x+=this.speed.x*Gn.timer.delta*1.5,this.node.y+=this.speed.y*Gn.timer.delta*1.5}},{key:"bounce",value:function(){(this.node.x<0||this.node.x>Gn.width)&&(this.node.x=this.node.x<0?0:Gn.width,this.node.rotation=180*Ti.getSign(this.node.rotation)-this.node.rotation,this.calSpeed()),(this.node.y<0||this.node.y>Gn.height)&&(this.node.y=this.node.y<0?0:Gn.height,this.node.rotation=-this.node.rotation,this.calSpeed())}},{key:"checkCrash",value:function(){if(this.target&&this.target.lifeState==os.EnterScreen)this.checkFish(this.target);else{var t=c(this.fight.fishScene.fishes);try{for(t.s();!(e=t.n()).done;){var e=e.value;if(e.lifeState==os.EnterScreen&&this.checkFish(e))return}}catch(e){t.e(e)}finally{t.f()}}}},{key:"checkFish",value:function(e){var t=c(e.fishColliderArr);try{for(t.s();!(n=t.n()).done;){var n=n.value;if(n.screenProjectPosition.distance(this.node.x,this.node.y)<=n.screenProjectRadius+this.radius)return this.hit([e]),this.createNet(),this.recover(),!0}}catch(e){t.e(e)}finally{t.f()}}},{key:"createNet",value:function(){var e=Math.floor(this.gunType/2)+1,t="dldby_net_"+e+"UI",n=(n=wo.getItem(t))||new ts.fishdld.animation[t];"dldby_net_5UI"==t&&(n.getChildByName("fu").skin="fishdld/animation/aninet/net_5/dldby_net_5_fu_0"+Ti.randInt(1,6)+".png"),this.fight.view.fight_layer.addChild(n),5==e?n.getChildByName("spark").rotation=Ti.randInt(0,360):n.rotation=Ti.randInt(0,360),n.pos(this.node.x,this.node.y);e=n.ani1;e.play(0,!1),e.offAll(Je.COMPLETE),e.once(Je.COMPLETE,this,function(){n.removeSelf(),wo.recover(t,n)})}},{key:"recover",value:function(){this.node.removeSelf(),wo.recover(this.node.skin,this.node),this.user.status.curBuletCount--,this.target=null}}]),n}();function cs(e,t,n){S(this,cs),this.url=e,this.preload=t,this.addInfo=n}function _s(){S(this,_s),this.textureID=-1}(ls=xs=xs||{})[ls.Level_0=0]="Level_0",ls[ls.Level_1=1]="Level_1",ls[ls.Level_2=2]="Level_2",ls[ls.Level_3=3]="Level_3",ls[ls.Level_4=4]="Level_4",ls[ls.Level_5=5]="Level_5",ls[ls.Level_6=6]="Level_6",ls[ls.Level_7=7]="Level_7",ls[ls.Level_8=8]="Level_8",ls[ls.Level_9=9]="Level_9",ls[ls.Free=10]="Free",ls[ls.Electric=11]="Electric",ls[ls.Rocket=12]="Rocket";var fs=xs,gs=function(){T(t,ss);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"onMouseUp",value:function(){this.user.status.isMouseDown&&(this.user.status.isMouseDown=!1)}},{key:"initGun",value:function(){G(z(t.prototype),"initGun",this).call(this),this.cannon_level_label=this.gunView.getChildByName("nb").getChildAt(0),this.cannon_level_label.font="fnt_gun_com.fnt",this.cannon_level_label.text=this.user.member.cannon_level.toString(),2!=this.user.member.position&&3!=this.user.member.position||(this.cannon_level_label.rotation=180)}},{key:"createBullet",value:function(){this.user.isSelf&&is.playSound("F4BY_Shoot.wav");var e="fishdld/fight/mainui/bullet_"+(Math.floor(this.type/2)+1)+".png",e=wo.getItemWithType(e,pi);return e.anchorX=e.anchorY=.5,e.scale(.5,.5),e.rotation=this.rotation,e.pos(this.muzzleWorldPos.x,this.muzzleWorldPos.y),(e.getComponent(ds)||e.addComponent(ds)).setData(this.user,this.type,this.user.status.targetFish),e}},{key:"createGunView",value:function(){var e;return this.type==fs.Level_0||this.type==fs.Level_1?e=new ts.fishdld.animation.Dldby_gun_1UI:this.type==fs.Level_2||this.type==fs.Level_3?e=new ts.fishdld.animation.Dldby_gun_2UI:this.type==fs.Level_4||this.type==fs.Level_5?e=new ts.fishdld.animation.Dldby_gun_3UI:this.type==fs.Level_6||this.type==fs.Level_7?e=new ts.fishdld.animation.Dldby_gun_4UI:this.type!=fs.Level_8&&this.type!=fs.Level_9||(e=new ts.fishdld.animation.Dldby_gun_5UI),e}},{key:"isFree",value:function(){return!1}},{key:"canLockTarget",get:function(){return!0}},{key:"canUserChangeFireSpeed",get:function(){return!0}}]),t}(),ys=function(){function e(){S(this,e)}return C(e,null,[{key:"uploadShaderUniforms",value:function(e,t,n,i){for(var a=n._data,r=t.getArrayData(),o=0,s=0,l=r.length;s<l;s++){var h,u=r[s];!i&&-1===u.textureID||null!=(h=a[u.dataOffset])&&(o+=u.fun.call(u.caller,u,h))}return o}},{key:"uploadCustomUniform",value:function(e,t,n,i){var a=0,n=t[n];return n&&null!=i&&(a+=n.fun.call(n.caller,n,i)),a}},{key:"uploadShaderUniformsForNative",value:function(e,t,n){var i=P.UPLOAD_SHADER_UNIFORM_TYPE_ID;0<n._runtimeCopyValues.length&&(i=P.UPLOAD_SHADER_UNIFORM_TYPE_DATA);n=n._data;return P.instance.uploadShaderUniforms(t,n,i)}}]),e}(),vs=function(){T(s,V);var o=b(s);function s(e,t,n,i,a){var r;return S(this,s),(r=o.call(this))._stateParamsMap=[],r._uploadMark=-1,r._uploadRenderType=-1,r._vs=e,r._ps=t,r._attributeMap=n,r._uniformMap=i,r._shaderPass=a,r._create(),r.lock=!0,r}return C(s,[{key:"_create",value:function(){var e,t=P.instance;for(e in this._program=t.createProgram(),this._vshader=this._createShader(t,this._vs,t.VERTEX_SHADER),this._pshader=this._createShader(t,this._ps,t.FRAGMENT_SHADER),t.attachShader(this._program,this._vshader),t.attachShader(this._program,this._pshader),this._attributeMap)t.bindAttribLocation(this._program,this._attributeMap[e],e);if(t.linkProgram(this._program),!yt.isConchApp&&ca.debugMode&&!t.getProgramParameter(this._program,t.LINK_STATUS))throw t.getProgramInfoLog(this._program);var n=[],i=[],a=[],r=[],o=[];this._customUniformParamsMap=[];var s,l,h=t.getProgramParameter(this._program,t.ACTIVE_UNIFORMS);for(y.useProgram(t,this._program),s=this._curActTexIndex=0;s<h;s++){var u,d=t.getActiveUniform(this._program,s),c=d.name;(u=new _s).location=t.getUniformLocation(this._program,c),0<c.indexOf("[0]")?(u.name=c=c.substr(0,c.length-3),u.isArray=!0):(u.name=c,u.isArray=!1),u.type=d.type,this._addShaderUnifiormFun(u);d=this._uniformMap[c];if(null!=d)switch(u.dataOffset=ca.propertyNameToID(c),d){case ca.PERIOD_CUSTOM:o.push(u);break;case ca.PERIOD_MATERIAL:r.push(u);break;case ca.PERIOD_SPRITE:a.push(u);break;case ca.PERIOD_CAMERA:i.push(u);break;case ca.PERIOD_SCENE:n.push(u);break;default:throw new Error("Shader3D: period is unkonw.")}}for(this._sceneUniformParamsMap=P.instance.createCommandEncoder(4*n.length*5+4,64,!0),s=0,l=n.length;s<l;s++)this._sceneUniformParamsMap.addShaderUniform(n[s]);for(this._cameraUniformParamsMap=P.instance.createCommandEncoder(4*i.length*5+4,64,!0),s=0,l=i.length;s<l;s++)this._cameraUniformParamsMap.addShaderUniform(i[s]);for(this._spriteUniformParamsMap=P.instance.createCommandEncoder(4*a.length*5+4,64,!0),s=0,l=a.length;s<l;s++)this._spriteUniformParamsMap.addShaderUniform(a[s]);for(this._materialUniformParamsMap=P.instance.createCommandEncoder(4*r.length*5+4,64,!0),s=0,l=r.length;s<l;s++)this._materialUniformParamsMap.addShaderUniform(r[s]);for(this._customUniformParamsMap.length=o.length,s=0,l=o.length;s<l;s++){var _=o[s];this._customUniformParamsMap[_.dataOffset]=_}var f,g=this._shaderPass._stateMap;for(f in g)this._stateParamsMap[g[f]]=ca.propertyNameToID(f)}},{key:"_getRenderState",value:function(e,t){t=this._stateParamsMap[t];return null==t?null:e[t]}},{key:"_disposeResource",value:function(){P.instance.deleteShader(this._vshader),P.instance.deleteShader(this._pshader),P.instance.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._setGPUMemory(0),this._curActTexIndex=0}},{key:"_addShaderUnifiormFun",value:function(e){var t=P.instance;e.caller=this;var n=e.isArray;switch(e.type){case t.BOOL:e.fun=this._uniform1i,e.uploadedValue=new Array(1);break;case t.INT:e.fun=n?this._uniform1iv:this._uniform1i,e.uploadedValue=new Array(1);break;case t.FLOAT:e.fun=n?this._uniform1fv:this._uniform1f,e.uploadedValue=new Array(1);break;case t.FLOAT_VEC2:e.fun=n?this._uniform_vec2v:this._uniform_vec2,e.uploadedValue=new Array(2);break;case t.FLOAT_VEC3:e.fun=n?this._uniform_vec3v:this._uniform_vec3,e.uploadedValue=new Array(3);break;case t.FLOAT_VEC4:e.fun=n?this._uniform_vec4v:this._uniform_vec4,e.uploadedValue=new Array(4);break;case t.FLOAT_MAT2:e.fun=this._uniformMatrix2fv;break;case t.FLOAT_MAT3:e.fun=this._uniformMatrix3fv;break;case t.FLOAT_MAT4:e.fun=n?this._uniformMatrix4fv:this._uniformMatrix4f;break;case t.SAMPLER_2D:t.uniform1i(e.location,this._curActTexIndex),e.textureID=y._glTextureIDs[this._curActTexIndex++],e.fun=this._uniform_sampler2D;break;case 35679:t.uniform1i(e.location,this._curActTexIndex),e.textureID=y._glTextureIDs[this._curActTexIndex++],e.fun=this._uniform_sampler3D;break;case t.SAMPLER_CUBE:t.uniform1i(e.location,this._curActTexIndex),e.textureID=y._glTextureIDs[this._curActTexIndex++],e.fun=this._uniform_samplerCube;break;default:throw new Error("compile shader err!")}}},{key:"_createShader",value:function(e,t,n){n=e.createShader(n);if(e.shaderSource(n,t),e.compileShader(n),ca.debugMode&&!e.getShaderParameter(n,e.COMPILE_STATUS))throw e.getShaderInfoLog(n);return n}},{key:"_uniform1f",value:function(e,t){var n=e.uploadedValue;return n[0]!==t?(P.instance.uniform1f(e.location,n[0]=t),1):0}},{key:"_uniform1fv",value:function(e,t){if(t.length<4){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(P.instance.uniform1fv(e.location,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],1):0}return P.instance.uniform1fv(e.location,t),1}},{key:"_uniform_vec2",value:function(e,t){var n=e.uploadedValue;return n[0]!==t.x||n[1]!==t.y?(P.instance.uniform2f(e.location,n[0]=t.x,n[1]=t.y),1):0}},{key:"_uniform_vec2v",value:function(e,t){if(t.length<2){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(P.instance.uniform2fv(e.location,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],1):0}return P.instance.uniform2fv(e.location,t),1}},{key:"_uniform_vec3",value:function(e,t){var n=e.uploadedValue;return n[0]!==t.x||n[1]!==t.y||n[2]!==t.z?(P.instance.uniform3f(e.location,n[0]=t.x,n[1]=t.y,n[2]=t.z),1):0}},{key:"_uniform_vec3v",value:function(e,t){return P.instance.uniform3fv(e.location,t),1}},{key:"_uniform_vec4",value:function(e,t){var n=e.uploadedValue;return n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w?(P.instance.uniform4f(e.location,n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w),1):0}},{key:"_uniform_vec4v",value:function(e,t){return P.instance.uniform4fv(e.location,t),1}},{key:"_uniformMatrix2fv",value:function(e,t){return P.instance.uniformMatrix2fv(e.location,!1,t),1}},{key:"_uniformMatrix3fv",value:function(e,t){return P.instance.uniformMatrix3fv(e.location,!1,t),1}},{key:"_uniformMatrix4f",value:function(e,t){t=t.elements;return P.instance.uniformMatrix4fv(e.location,!1,t),1}},{key:"_uniformMatrix4fv",value:function(e,t){return P.instance.uniformMatrix4fv(e.location,!1,t),1}},{key:"_uniform1i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t?(P.instance.uniform1i(e.location,n[0]=t),1):0}},{key:"_uniform1iv",value:function(e,t){return P.instance.uniform1iv(e.location,t),1}},{key:"_uniform_ivec2",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]?(P.instance.uniform2i(e.location,n[0]=t[0],n[1]=t[1]),1):0}},{key:"_uniform_ivec2v",value:function(e,t){return P.instance.uniform2iv(e.location,t),1}},{key:"_uniform_vec3i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]?(P.instance.uniform3i(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2]),1):0}},{key:"_uniform_vec3vi",value:function(e,t){return P.instance.uniform3iv(e.location,t),1}},{key:"_uniform_vec4i",value:function(e,t){var n=e.uploadedValue;return n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]||n[3]!==t[3]?(P.instance.uniform4i(e.location,n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),1):0}},{key:"_uniform_vec4vi",value:function(e,t){return P.instance.uniform4iv(e.location,t),1}},{key:"_uniform_sampler2D",value:function(e,t){var n=t._getSource()||t.defaulteTexture._getSource(),t=P.instance;return y.activeTexture(t,e.textureID),y.bindTexture(t,t.TEXTURE_2D,n),0}},{key:"_uniform_sampler3D",value:function(e,t){var n=t._getSource()||t.defaulteTexture._getSource(),t=P.instance;return y.activeTexture(t,e.textureID),y.bindTexture(t,WebGL2RenderingContext.TEXTURE_3D,n),0}},{key:"_uniform_samplerCube",value:function(e,t){var n=t._getSource()||t.defaulteTexture._getSource(),t=P.instance;return y.activeTexture(t,e.textureID),y.bindTexture(t,t.TEXTURE_CUBE_MAP,n),0}},{key:"bind",value:function(){return y.useProgram(P.instance,this._program)}},{key:"uploadUniforms",value:function(e,t,n){J.shaderCall+=ys.uploadShaderUniforms(P.instance,e,t,n)}},{key:"uploadRenderStateBlendDepth",value:function(e){var t=P.instance,n=this._shaderPass.renderState,i=e.getData(),a=this._getRenderState(i,ca.RENDER_STATE_DEPTH_WRITE),r=this._getRenderState(i,ca.RENDER_STATE_DEPTH_TEST),e=this._getRenderState(i,ca.RENDER_STATE_BLEND);switch(null==a&&(a=n.depthWrite),null==r&&(r=n.depthTest),null==e&&(e=n.blend),y.setDepthMask(t,a),r===ur.DEPTHTEST_OFF?y.setDepthTest(t,!1):(y.setDepthTest(t,!0),y.setDepthFunc(t,r)),e){case ur.BLEND_DISABLE:y.setBlend(t,!1);break;case ur.BLEND_ENABLE_ALL:var o=this._getRenderState(i,ca.RENDER_STATE_BLEND_EQUATION),s=this._getRenderState(i,ca.RENDER_STATE_BLEND_SRC),l=this._getRenderState(i,ca.RENDER_STATE_BLEND_DST);null==o&&(o=n.blendEquation),null==s&&(s=n.srcBlend),null==l&&(l=n.dstBlend),y.setBlend(t,!0),y.setBlendEquation(t,o),y.setBlendFunc(t,s,l);break;case ur.BLEND_ENABLE_SEPERATE:var h=this._getRenderState(i,ca.RENDER_STATE_BLEND_EQUATION_RGB),u=this._getRenderState(i,ca.RENDER_STATE_BLEND_EQUATION_ALPHA),d=this._getRenderState(i,ca.RENDER_STATE_BLEND_SRC_RGB),o=this._getRenderState(i,ca.RENDER_STATE_BLEND_DST_RGB),s=this._getRenderState(i,ca.RENDER_STATE_BLEND_SRC_ALPHA),l=this._getRenderState(i,ca.RENDER_STATE_BLEND_DST_ALPHA);null==h&&(h=n.blendEquationRGB),null==u&&(u=n.blendEquationAlpha),null==d&&(d=n.srcBlendRGB),null==o&&(o=n.dstBlendRGB),null==s&&(s=n.srcBlendAlpha),null==l&&(l=n.dstBlendAlpha),y.setBlend(t,!0),y.setBlendEquationSeparate(t,h,u),y.setBlendFuncSeperate(t,d,o,s,l)}}},{key:"uploadRenderStateFrontFace",value:function(e,t,n){var i,a=P.instance,r=this._shaderPass.renderState,e=e.getData(),e=this._getRenderState(e,ca.RENDER_STATE_CULL);switch(e=null==e?r.cull:e){case ur.CULL_NONE:y.setCullFace(a,!1);break;case ur.CULL_FRONT:y.setCullFace(a,!0),i=t?n?a.CCW:a.CW:n?a.CW:a.CCW,y.setFrontFace(a,i);break;case ur.CULL_BACK:y.setCullFace(a,!0),i=t?n?a.CW:a.CCW:n?a.CCW:a.CW,y.setFrontFace(a,i)}}},{key:"uploadCustomUniform",value:function(e,t){J.shaderCall+=ys.uploadCustomUniform(P.instance,this._customUniformParamsMap,e,t)}},{key:"_uniformMatrix2fvForNative",value:function(e,t){return P.instance.uniformMatrix2fvEx(e.location,!1,t),1}},{key:"_uniformMatrix3fvForNative",value:function(e,t){return P.instance.uniformMatrix3fvEx(e.location,!1,t),1}},{key:"_uniformMatrix4fvForNative",value:function(e,t){return P.instance.uniformMatrix4fvEx(e.location,!1,t),1}}]),s}(),ps=function(){T(x,Bn);var o=b(x);function x(e,t,n,i){var a,r;for(r in S(this,x),(a=o.call(this,t,n,null))._cacheSharders={},a._cacheShaderHierarchy=1,a._renderState=new ur,a._validDefine=new da,a._owner=e,a._stateMap=i,a.defs)a._validDefine.add(ca.getDefineByName(r));return a}return C(x,[{key:"_compileToTree",value:function(e,t,n,i,a){for(var r,o,s,l,h,u,d,c,_,f=n;f<t.length;f++)if(s=t[f],!(s.length<1)&&0!==(h=s.indexOf("//"))){if(0<=h&&(s=s.substr(0,h)),r=d||new Fn(i),d=null,0<=(h=(r.text=s).indexOf("#"))){for(l="#",_=h+1,c=s.length;_<c;_++){var g=s.charAt(_);if(" "===g||"\t"===g||"?"===g)break;l+=g}switch(r.name=l){case"#ifdef":case"#ifndef":if(r.setParent(e),e=r,a)for(u=s.substr(_).split(Bn._splitToWordExps3),_=0;_<u.length;_++)(s=u[_]).length&&(a[s]=!0);continue;case"#if":case"#elif":if(r.setParent(e),e=r,a)for(u=s.substr(_).split(Bn._splitToWordExps3),_=0;_<u.length;_++)(s=u[_]).length&&"defined"!=s&&(a[s]=!0);continue;case"#else":o=(e=e.parent).childs[e.childs.length-1],r.setParent(e),e=r;continue;case"#endif":o=(e=e.parent).childs[e.childs.length-1],r.setParent(e);continue;case"#include":u=Bn.splitToWords(s,null);var y=Bn.includes[u[1]];if(!y)throw"ShaderCompile error no this include file:"+u[1];if((h=u[0].indexOf("?"))<0){r.setParent(e),s=y.getWith("with"==u[2]?u[3]:null),this._compileToTree(r,s.split("\n"),0,i,a),r.text="";continue}r.setCondition(u[0].substr(h+1),Bn.IFDEF_YES),r.text=y.getWith("with"==u[2]?u[3]:null);break;case"#import":y=(u=Bn.splitToWords(s,null))[1],i.push({node:r,file:Bn.includes[y],ofs:r.text.length});continue}}else{if((o=e.childs[e.childs.length-1])&&!o.name){0<i.length&&Bn.splitToWords(s,o),d=r,o.text+="\n"+s;continue}0<i.length&&Bn.splitToWords(s,r)}r.setParent(e)}}},{key:"_resizeCacheShaderMap",value:function(e,t,n){var i=this._cacheShaderHierarchy-1;if(t==i){for(var a in e)for(var r=e[a],o=0,s=n-i;o<s;o++)o==s-1?e[0]=r:e=e[0==o?a:0]={};this._cacheShaderHierarchy=n}else for(var a in e)this._resizeCacheShaderMap(e[a],++t,n)}},{key:"withCompile",value:function(e){e._intersectionDefineDatas(this._validDefine);var t=this._cacheSharders,n=e._length;n>this._cacheShaderHierarchy&&(this._resizeCacheShaderMap(t,0,n),this._cacheShaderHierarchy=n);for(var i=e._mask,a=e._length-1,r=this._cacheShaderHierarchy-1,o=0;o<r;o++){var s=a<o?0:i[o],l=t[s];l||(t[s]=l={}),t=l}var h=a<r?0:i[r],u=t[h];if(u)return u;var d=x._defineString;ca._getNamesByDefineData(e,d);var c=ha._config,_=c.lightClusterCount,f={},g="#define MAX_LIGHT_COUNT "+c.maxLightCount+"\n";g+="#define MAX_LIGHT_COUNT_PER_CLUSTER "+c._maxAreaLightCountPerClusterAverage+"\n",g+="#define CLUSTER_X_COUNT "+_.x+"\n",g+="#define CLUSTER_Y_COUNT "+_.y+"\n",g+="#define CLUSTER_Z_COUNT "+_.z+"\n";for(var o=0,y=d.length;o<y;o++){var v=d[o];g+="#define "+v+"\n",f[v]=!0}var p=this._VS.toscript(f,[]),m="";0==p[0].indexOf("#version")&&(m=p[0]+"\n",p.shift());n=this._PS.toscript(f,[]),_="";if(0==n[0].indexOf("#version")&&(_=n[0]+"\n",n.shift()),u=new vs(m+g+p.join("\n"),_+g+n.join("\n"),this._owner._attributeMap||this._owner._owner._attributeMap,this._owner._uniformMap||this._owner._owner._uniformMap,this),t[h]=u,ca.debugMode){var w;dt.shaderHighPrecision&&(e.remove(ca.SHADERDEFINE_HIGHPRECISION),-1!==(w=d.indexOf("HIGHPRECISION"))&&d.splice(w,1)),c._multiLighting||(e.remove(ca.SHADERDEFINE_LEGACYSINGALLIGHTING),-1!==(w=d.indexOf("LEGACYSINGLELIGHTING"))&&d.splice(w,1));for(o=0,y=e._length;o<y;o++)o==y-1?i[o]:i[o];for(o=0,y=d.length;o<y;o++)o==y-1?d[o]:d[o]}return u}},{key:"renderState",get:function(){return this._renderState}}]),x}();ps._defineString=[];var ms=function(){function n(e,t){S(this,n),this._flags={},this._passes=[],this._attributeMap=e,this._uniformMap=t}return C(n,[{key:"setFlag",value:function(e,t){t?this._flags[e]=t:delete this._flags[e]}},{key:"getFlag",value:function(e){return this._flags[e]}},{key:"addShaderPass",value:function(e,t){t=new ps(this,e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null);return this._passes.push(t),t}}]),n}(),ws=function(){T(r,hr);var t=b(r);function r(){var e;return S(this,r),(e=t.call(this)).initShader(),e.setShaderName(r.BaseMaterialName),e}return C(r,[{key:"initShader",value:function(){var e,t,n,i,a;r.isLoadShader||(r.isLoadShader=!0,e={a_Position:wa.MESH_POSITION0,a_Normal:wa.MESH_NORMAL0,a_Texcoord:wa.MESH_TEXTURECOORDINATE0,a_BoneWeights:wa.MESH_BLENDWEIGHT0,a_BoneIndices:wa.MESH_BLENDINDICES0},a={u_Bones:ca.PERIOD_CUSTOM,u_DiffuseColor:ca.PERIOD_MATERIAL,u_DiffuseTexture:ca.PERIOD_MATERIAL,u_MarginalColor:ca.PERIOD_MATERIAL,u_WaterLightTexture:ca.PERIOD_MATERIAL,u_MapTexture:ca.PERIOD_MATERIAL,u_MvpMatrix:ca.PERIOD_SPRITE,u_WorldMat:ca.PERIOD_SPRITE,u_CameraPos:ca.PERIOD_CAMERA,u_View:ca.PERIOD_CAMERA},t=zn.loader.getRes("res/fishdld/fish/shader/fishbase.vs"),n=zn.loader.getRes("res/fishdld/fish/shader/fishbase.fs"),r.DEFINE_FISH_WATERLIGHT=ca.getDefineByName("FISH_WATERLIGHT"),r.DEFINE_FISH_TOON=ca.getDefineByName("FISH_TOON"),r.DEFINE_FISH_COLORFUL=ca.getDefineByName("FISH_COLORFUL"),i=ca.add(r.BaseMaterialName),a=new ms(e,a),i.addSubShader(a),a.addShaderPass(t,n,{s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13}),r.COLOR_DIFFUSE=ca.propertyNameToID("u_DiffuseColor"),r.TEXTURE_DIFFUSE=ca.propertyNameToID("u_DiffuseTexture"),r.COLOR_MARGINAL=ca.propertyNameToID("u_MarginalColor"),r.TEXTURE_WATERLIGHT=ca.propertyNameToID("u_WaterLightTexture"),r.TEXTURE_MAP=ca.propertyNameToID("u_MapTexture"),r.BLEND=ca.propertyNameToID("s_Blend"),r.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),r.BLEND_DST=ca.propertyNameToID("s_BlendDst"),r.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),r.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite"),(r.textureWaterLight=zn.loader.getRes("res/fishdld/fish/material/caustics.jpg"))&&(r.textureWaterLight.wrapModeU=U.WARPMODE_REPEAT,r.textureWaterLight.wrapModeV=U.WARPMODE_REPEAT),r.textureToony=zn.loader.getRes("res/fishdld/fish/material/toony_lighting.jpg"),r.textureColorful=zn.loader.getRes("res/fishdld/fish/material/colorful.jpg"))}},{key:"initMaterial",value:function(e,t){this.blinMaterial=e,this.configer=t,null!=e&&null!=e.albedoTexture&&this.setDiffuseTexture(e.albedoTexture),"Custom.FishBase"==t.szShaderName?(this.addDefine(r.DEFINE_FISH_WATERLIGHT),this.setLightTexture(r.textureWaterLight)):"Custom.FishToon"==t.szShaderName?(this.addDefine(r.DEFINE_FISH_WATERLIGHT),this.addDefine(r.DEFINE_FISH_TOON),this.setLightTexture(r.textureWaterLight),this.setToonTexture(r.textureToony)):"Custom.FishColorful"==t.szShaderName?(this.addDefine(r.DEFINE_FISH_WATERLIGHT),this.addDefine(r.DEFINE_FISH_COLORFUL),this.setLightTexture(r.textureWaterLight),this.setColorfulTexture(r.textureColorful)):"Custom.FishJelly"==t.szShaderName&&(this.setBlendSrc(ur.BLENDPARAM_SRC_ALPHA),this.setBlendDst(ur.BLENDPARAM_ONE),this.setBlend(ur.BLENDPARAM_ONE),this.setDepthWrite(!1),this.renderQueue=hr.RENDERQUEUE_TRANSPARENT),this.setDiffuseColor(new yn(t.mainColor[0],t.mainColor[1],t.mainColor[2],t.mainColor[3])),this.setMarginalColor(new yn(t.marginalColor[0],t.marginalColor[1],t.marginalColor[2],1))}},{key:"getDiffuseColor",value:function(){return this._shaderValues.getVector(r.COLOR_DIFFUSE)}},{key:"setDiffuseColor",value:function(e){this._shaderValues.setVector(r.COLOR_DIFFUSE,e)}},{key:"getDiffuseTexture",value:function(){return this._shaderValues.getTexture(r.TEXTURE_DIFFUSE)}},{key:"setDiffuseTexture",value:function(e){this._shaderValues.setTexture(r.TEXTURE_DIFFUSE,e)}},{key:"getLightTexture",value:function(){return this._shaderValues.getTexture(r.TEXTURE_WATERLIGHT)}},{key:"setLightTexture",value:function(e){null!=e&&this._shaderValues.setTexture(r.TEXTURE_WATERLIGHT,e)}},{key:"getToonTexture",value:function(){return this._shaderValues.getTexture(r.TEXTURE_MAP)}},{key:"setToonTexture",value:function(e){null!=e&&this._shaderValues.setTexture(r.TEXTURE_MAP,e)}},{key:"getColorfulTexture",value:function(){return this._shaderValues.getTexture(r.TEXTURE_MAP)}},{key:"setColorfulTexture",value:function(e){null!=e&&this._shaderValues.setTexture(r.TEXTURE_MAP,e)}},{key:"getMarginalColor",value:function(){return this._shaderValues.getVector(r.COLOR_MARGINAL)}},{key:"setMarginalColor",value:function(e){this.originalMarginalColor||(this.originalMarginalColor=this.getMarginalColor()),this._shaderValues.setVector(r.COLOR_MARGINAL,e)}},{key:"getBlendSrc",value:function(){return this._shaderValues.getInt(r.BLEND_SRC)}},{key:"setBlendSrc",value:function(e){this._shaderValues.setInt(r.BLEND_SRC,e)}},{key:"getBlendDst",value:function(){return this._shaderValues.getInt(r.BLEND_DST)}},{key:"setBlendDst",value:function(e){this._shaderValues.setInt(r.BLEND_DST,e)}},{key:"getBlend",value:function(){return this._shaderValues.getInt(r.BLEND)}},{key:"setBlend",value:function(e){this._shaderValues.setInt(r.BLEND,e)}},{key:"getDepthWrite",value:function(){return this._shaderValues.getBool(r.DEPTH_WRITE)}},{key:"setDepthWrite",value:function(e){this._shaderValues.setBool(r.DEPTH_WRITE,e)}},{key:"addDefine",value:function(e){this._shaderValues.addDefine(e)}},{key:"clone",value:function(){var e=new r;return e.initMaterial(this.blinMaterial,this.configer),e}}]),r}();ws.res=[new cs("res/fishdld/fish/material/fish_material.json"),new cs("res/fishdld/fish/material/caustics.jpg"),new cs("res/fishdld/fish/material/toony_lighting.jpg"),new cs("res/fishdld/fish/material/colorful.jpg"),new cs("res/fishdld/fish/shader/fishbase.vs"),new cs("res/fishdld/fish/shader/fishbase.fs")],ws.BaseMaterialName="Custom.FishBase",ws.COLOR_DIFFUSE=0,ws.TEXTURE_DIFFUSE=1,ws.COLOR_MARGINAL=2,ws.TEXTURE_WATERLIGHT=3,ws.TEXTURE_MAP=4,ws.BLEND=5,ws.BLEND_SRC=6,ws.BLEND_DST=7,ws.DEPTH_TEST=8,ws.DEPTH_WRITE=9,ws.textureWaterLight=null,ws.textureToony=null,ws.textureColorful=null,ws.isLoadShader=!1;var xs,ks=function(){function o(e,t){if(S(this,o),this.materials=new Array,null!=t){var n=c(t);try{for(n.s();!(r=n.n()).done;){var i,a=r.value,r=this.getNodeByName(e,a.szNodeName);r instanceof uo?i=r.skinnedMeshRenderer:r instanceof pr&&(i=r.meshRenderer),i&&(i.material instanceof ws||((r=new ws).initMaterial(i.material,a),i.material=r),this.materials.push(i.material))}}catch(e){n.e(e)}finally{n.f()}}}return C(o,[{key:"setMarginalColor",value:function(e){if(this.materials&&0!=this.materials.length){var t,n=c(this.materials);try{for(n.s();!(t=n.n()).done;)t.value.setMarginalColor(e)}catch(e){n.e(e)}finally{n.f()}}}},{key:"recoverMarginalColor",value:function(){if(this.materials&&0!=this.materials.length){var t=c(this.materials);try{for(t.s();!(e=t.n()).done;){var e=e.value;e.originalMarginalColor&&e.setMarginalColor(e.originalMarginalColor)}}catch(e){t.e(e)}finally{t.f()}}}},{key:"getMaterialConfig",value:function(e){return(o.jsonFishMaterial=null==o.jsonFishMaterial?zn.loader.getRes("res/fishdld/fish/material/fish_material.json"):o.jsonFishMaterial)[e]}},{key:"getNodeByName",value:function(e,t){for(var n=0;n<e.numChildren;n++){var i=e.getChildAt(n);if(i.name==t)return i;if(null!=(i=this.getNodeByName(i,t)))return i}return null}}]),o}();ks.isLoadShader=!1,(xs=Ts=Ts||{})[xs.If=1]="If",xs[xs.IfNot=2]="IfNot",xs[xs.Greater=3]="Greater",xs[xs.Less=4]="Less",xs[xs.Equals=6]="Equals",xs[xs.NotEqual=7]="NotEqual",xs[xs.Trigger=9]="Trigger";var Ts,Es=Ts,Ms=function(){function l(){S(this,l)}return C(l,null,[{key:"getComponent",value:function(e,t){var n=e.getComponents(t);if(n)return n[0];for(var i=e.numChildren,a=0;a<i;a++){var r=l.getComponent(e.getChildAt(a),t);if(r)return r}}},{key:"getAllComponent",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=e.getComponents(t);if(i){var a=c(i);try{for(a.s();!(r=a.n()).done;){var r=r.value;n.push(r)}}catch(e){a.e(e)}finally{a.f()}}for(var o=e.numChildren,s=0;s<o;s++)l.getAllComponent(e.getChildAt(s),t,n);return n}},{key:"getChildByType",value:function(e,t){for(var n=0;n<e.numChildren;n++)if(e.getChildAt(n)instanceof t)return e.getChildAt(n);for(n=0;n<e.numChildren;n++){var i=this.getChildByType(e.getChildAt(n),t);if(i)return i}}},{key:"getAllChildByType",value:function(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];if(!e)return i;for(var a=0;a<e.numChildren;a++)(n=e.getChildAt(a))instanceof t&&i.push(n),this.getAllChildByType(n,t,i);return i}},{key:"getChildByName",value:function(e,t){if(e)for(var n,i=0;i<e.numChildren;i++){if((n=e.getChildAt(i)).name==t)return n;if(n=this.getChildByName(n,t))return n}}},{key:"getAllChidByName",value:function(e,t,n){for(var i,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],r=0;r<e.numChildren;r++)i=e.getChildAt(r),(!n&&i.name==t||n&&0<=i.name.indexOf(t))&&a.push(i);for(r=0;r<e.numChildren;r++)i=e.getChildAt(r),this.getAllChidByName(i,t,n,a);return a}}]),l}();(Ts=Rs=Rs||{})[Ts.Float=1]="Float",Ts[Ts.Int=3]="Int",Ts[Ts.Bool=4]="Bool",Ts[Ts.Trigger=9]="Trigger";var bs=Rs,Ss=function(){T(a,d);var i=b(a);function a(e,t){var n;return S(this,a),(n=i.call(this)).layaAni=Ms.getComponent(e,la),n.controller=Ei.deepClone(t),n.stateMachine=t.layers[0].stateMachine,n.timer=new Cn,n.stop(),n.init(),n}return C(a,[{key:"init",value:function(){this.animationStartTime=0,this.animationCompleteTime=0,this.resetAllParameter(),this.setCurrentAnimatorState(this.stateMachine.defaultState.name),this.play(this.stateMachine.defaultState.name),this.timer.frameLoop(1,this,this.update)}},{key:"setCurrentAnimatorState",value:function(e){this.currentAnimatorState=this.getAnimatorState(e),this.animationStartTime=0,this.animationCompleteTime=1e3*this.currentAnimatorState.motion.averageDuration,this.resetAllTrigger()}},{key:"play",value:function(e,t){this.layaAni.enabled=!0,this.layaAni.play(e,t),this.setCurrentAnimatorState(e)}},{key:"setTrigger",value:function(e){this.setValue(e,!0)}},{key:"setValue",value:function(t,e){var n=this.controller.parameters.find(function(e){return e.name==t});n&&(n.value=e)}},{key:"crossFade",value:function(e){var t=e.hasFixedDuration?e.duration/this.currentAnimatorState.motion.averageDuration:e.duration;this.layaAni.crossFade(e.destinationState.name,t,0,e.offset),this.layaAni.crossFade(e.destinationState.name,t,0,e.offset),this.setCurrentAnimatorState(e.destinationState.name)}},{key:"setSpeed",value:function(e){this.layaAni.speed=e}},{key:"getSpeed",value:function(){return this.layaAni.speed}},{key:"update",value:function(){this.animationStartTime+=this.timer.delta*this.layaAni.speed;var t=c(this.currentAnimatorState.transitions);try{for(t.s();!(e=t.n()).done;){var e=e.value;if(this.isTransitionTrue(e))return e.hasExitTime?void(this.animationStartTime/this.animationCompleteTime>=e.exitTime&&this.crossFade(e)):void this.crossFade(e)}}catch(e){t.e(e)}finally{t.f()}this.checkAnimationComplete()}},{key:"checkAnimationComplete",value:function(){this.animationStartTime>=this.animationCompleteTime&&this.onAnimationComplete()}},{key:"onAnimationComplete",value:function(){if(this.currentAnimatorState.motion.isLooping)this.play(this.currentAnimatorState.name);else{var t=c(this.currentAnimatorState.transitions);try{for(t.s();!(e=t.n()).done;){var e=e.value;if(0==e.conditions.length){this.play(e.destinationState.name);break}if(this.isTransitionTrue(e)){this.play(e.destinationState.name);break}}}catch(e){t.e(e)}finally{t.f()}}this.event(Je.COMPLETE)}},{key:"isTransitionTrue",value:function(e){var n=this;return e.conditions.every(function(t){var e=n.controller.parameters.find(function(e){return e.name==t.parameter});switch(t.mode){case Es.If:return!!e.value;case Es.IfNot:return!e.value;case Es.Greater:return t.threshold>e.value;case Es.Less:return t.threshold<e.value;case Es.Equals:return t.threshold==e.value;case Es.NotEqual:return t.threshold!=e.value}})}},{key:"resetAllParameter",value:function(){var e,t=c(this.controller.parameters);try{for(t.s();!(e=t.n()).done;)e.value.value=void 0}catch(e){t.e(e)}finally{t.f()}}},{key:"resetAllTrigger",value:function(){var t=c(this.controller.parameters);try{for(t.s();!(e=t.n()).done;){var e=e.value;e.type==bs.Trigger&&(e.value=void 0)}}catch(e){t.e(e)}finally{t.f()}}},{key:"getAnimatorState",value:function(e){var t=c(this.stateMachine.states);try{for(t.s();!(n=t.n()).done;){var n=n.value;if(n.state.name==e)return n.state}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){this.layaAni.enabled=!1,this.timer&&this.timer.clearAll(this)}}]),a}(),Is=function(){function e(){S(this,e),this.screenProjectPosition=new L}return C(e,[{key:"isInScreen",get:function(){if(0<this.screenProjectPosition.x+this.screenProjectRadius&&0<this.screenProjectPosition.y+this.screenProjectRadius&&this.screenProjectPosition.x-this.screenProjectRadius<Gn.width&&this.screenProjectPosition.y-this.screenProjectRadius<Gn.height)return!0}}]),e}(),Ns=function(){function e(){S(this,e)}return C(e,null,[{key:"getFishIcon",value:function(e){return"fishdld/fight/fishicon/fish_"+e+".png"}},{key:"getSceneBackground",value:function(e){return at.onIOS?"res/fishdld/effect/Conventional/dldby_scene_ios_"+e+".lh":"res/fishdld/effect/Conventional/dldby_scene_"+e+".lh"}}]),e}();Ns.COIN_BOOM_EFFECT="res/fishdld/effect/Conventional/dldby_jinchan_eff.lh",Ns.COIN_BREAK_OUT_EFFECT="res/fishdld/effect/Conventional/dldby_coin_break_out.lh",Ns.ROCKET_TRAIL_EFFECT="res/fishdld/effect/Conventional/dldby_trailRenderer.lh",Ns.EEL_BUBBLE_EFFECT="res/fishdld/effect/Conventional/dldby_dianman_die.lh",Ns.EEL_LINE_EFFECT="res/fishdld/effect/Conventional/dldby_lightning_eff1.lh",Ns.SWITCH_SCENE_WATER_EFFECT="res/fishdld/effect/Conventional/dldby_chuchang_eff.lh",Ns.CALLUP_VORTEX_EFFECT="res/fishdld/effect/Conventional/dldby_callup_vertex.lh",Ns.FISH_MODEL_RES="res/fishdld/fish/models/Conventional/",Ns.SCENE_RES="res/fishdld/scene/Conventional/scene.ls",Ns.FISH_DEFINE_CONF="res/fishdld/fish_define.json",Ns.FISH_MATERIAL_CONF="res/fishdld/fish/material/fish_material.json",Ns.FISH_ANIMATOR_CONF="res/fishdld/fish_animator.json",Ns.SCENE_ANIMATOR_CONF="res/fishdld/scene_animator.json",Ns.EFFECT_MATERIAL_CONF="res/fishdld/effect_material.json";var Rs,Cs=function(){function l(){var e=this;S(this,l),this.labelQueue=[[],[],[],[]],this.labelLast=[9999,9999,9999,9999],this.timer=new Cn,this.labelPool=new Array,this.registerFont("coin_number.fnt"),this.registerFont("F4BY_Font8.fnt"),this.registerFont("F4BY_Font9.fnt"),this.registerFont("fnt_freegun_double.fnt"),this.registerFont("fnt_freegun_time.fnt"),this.registerFont("fnt_gun_com.fnt"),this.registerFont("fnt_ywhj.fnt",F.create(this,function(){e.fight.view.ywhj_label.font="fnt_ywhj.fnt",e.fight.view.ywhj_label.visible=!0}))}return C(l,[{key:"init",value:function(e){this.fight=e,this.fish_define=zn.loader.getRes(Ns.FISH_DEFINE_CONF),this.timer.frameLoop(1,this,this.updateShowLabel2)}},{key:"showFishComing",value:function(e){var t=this,n=wo.getItem("fish_coming");(n=n||new ts.fishdld.fight.FishCommingUI).fish_icon.skin=Ns.getFishIcon(e.define.fishid),n.fish_name.text="“"+e.define.name+"”来袭",n.pos(Gn.width+250,200),this.fight.view.ui_effect_layer.addChild(n),pn.to(n,{x:Gn.width/2},500,_n.elasticOut),this.timer.once(3e3,this,function(){pn.to(n,{x:-250},300,null,F.create(t,function(){n.removeSelf(),wo.recover("fish_coming",n)}))})}},{key:"showFishArrayComing",value:function(){var e=this,t=wo.getItem("fish_array_coming");(t=t||new ts.fishdld.animation.dldby_array_comingUI).pos(Gn.width+250,Gn.height/2),this.fight.view.ui_effect_layer.addChild(t),t.ani1.play(0,!1),pn.to(t,{x:Gn.width/2},8/24*1e3,_n.elasticOut),this.timer.once(3e3,this,function(){t.ani2.play(0,!1),pn.to(t,{x:-250},8/24*1e3,_n.elasticIn,F.create(e,function(){t.removeSelf(),wo.recover("fish_array_coming",t)}))})}},{key:"showFishLotteryUI",value:function(e,t){var n=this,i=wo.getItem("fish_die_circle");(i=i||new ts.fishdld.animation.fish_die_lotteryUI).pos(e.getFishScreenPosistion().x,e.getFishScreenPosistion().y),i.fish_icon.skin=Ns.getFishIcon(e.define.fishid);var a=i.getChildByName("nb").getChildAt(0);a.font="coin_number.fnt",a.text=e.money.toString(),a.gray=!t.isSelf,Ci.tweenNumber(a,0,e.money);var r=t.coinGlobalPosition.distance(i.x,i.y);i.ani1.play(0,!0),i.ani1.timerOnce(2e3,this,function(){(new As).curveTweenDo(i,new L(i.x,i.y),t.coinGlobalPosition,r,0),pn.to(i,{scaleX:0,scaleY:0},r,null,F.create(n,function(){l.I.showLabel2(t,e.money.toString()),i.removeSelf(),wo.recover("fish_die_circle",i)}))}),this.fight.view.ui_effect_layer.addChild(i)}},{key:"showMiniExplode",value:function(e){var t=wo.getItem("mini_explode");(t=t||new ts.fishdld.animation.fish_die_mini_explodeUI).ani1.play(0,!1),t.ani1.once(Je.COMPLETE,this,function(){t.removeSelf(),wo.recover("mini_explode",t)}),t.pos(e.getFishScreenPosistion().x,e.getFishScreenPosistion().y),this.fight.view.fight_layer.addChild(t)}},{key:"showUserTopFishUI",value:function(e,t,n){var i=this,a="fish_die_typeUI",r=wo.getItem(a);(r=r||new ts.fishdld.animation[a]).x=t.coinLabelGlobalPosition.x-1,r.y=1<t.member.position?t.coinLabelGlobalPosition.y+100:t.coinLabelGlobalPosition.y-100,r.scale(1,1),r.getChildByName("fish_icon").skin=Ns.getFishIcon(e.define.fishid),r.getChildByName("type").skin="fishdld/animation/aniui/img_fish_die_title_"+n+".png",r.getChildByName("color").skin="fishdld/animation/aniui/img_fish_die_color_"+n+".png";n=r.getChildByName("nb").getChildAt(0);n.font="coin_number.fnt",n.text=e.money.toString(),Ci.tweenNumber(n,0,e.money);var o=t.coinLabelGlobalPosition.distance(r.x,r.y),s=r.ani1;s.play(0,!1),s.timer.once(3e3,this,function(){(new As).curveTweenDo(r,new L(r.x,r.y),t.coinLabelGlobalPosition,o,0),pn.to(r,{scaleX:0,scaleY:0},o,null,F.create(i,function(){l.I.showLabel2(t,e.money.toString()),r.removeSelf(),s.stop(),wo.recover(a,r)}))}),this.fight.view.ui_effect_layer.addChild(r)}},{key:"createCoinLabel",value:function(){var e;return 0<this.labelPool.length?(e=this.labelPool.shift()).alpha=1:e=new mr,e.anchorX=.5,e.anchorY=.5,e.zOrder=1200,e}},{key:"recoverCoinLabel",value:function(e){e.removeSelf(),this.labelPool.push(e)}},{key:"showLabel2",value:function(e,t){this.labelQueue[e.member.position].push({user:e,content:t})}},{key:"updateShowLabel2",value:function(){for(var e,t,n,i,a=0;a<4;a++)this.labelLast[a]+=this.timer.delta,500<=this.labelLast[a]&&0<this.labelQueue[a].length&&(this.labelLast[a]=0,e=this.labelQueue[a].shift(),(t=this.createCoinLabel()).scale(.5,.5),t.text="+"+Ci.tofixNumber(e.content),t.font=e.user.isSelf?"F4BY_Font8.fnt":"F4BY_Font9.fnt",n=e.user.member.position<2?e.user.coinLabelGlobalPosition.y-50:e.user.coinLabelGlobalPosition.y+50,i=e.user.member.position<2?-30:30,t.pos(e.user.coinLabelGlobalPosition.x,n),this.fight.view.fight_layer.addChild(t),pn.to(t,{y:t.y+i},700),pn.to(t,{alpha:0},450,null,F.create(this,this.recoverCoinLabel,[t]),400))}},{key:"showCoin",value:function(i,a){var r=this,o=[-25,0,25,0],e=o.length,s=!1,l=[];if(i.getFishScreenPosistion().x<a.coinGlobalPosition.x){for(var t=e;0<t;t--){var n=200/e*(t-1);l.push(n)}s=!0}for(var h=0,u=0;u<e/2;u++)!function(t){var n=t*(200/e);r.timer.once(n,r,function(){var e=0;h=(e=(s&&(e=l[t]-n),r.createCoinSingle(a,i.money,i.getFishScreenPosistion().x+.7*o[2*t],i.getFishScreenPosistion().y+.7*o[2*t+1],e,a.coinGlobalPosition.x,a.coinGlobalPosition.y,t)),Math.max(e,h))})}(u);var d=this.createCoinLabel();d.text="+"+Ci.tofixNumber(i.money),d.font=a.isSelf?"F4BY_Font8.fnt":"F4BY_Font9.fnt",d.pos(i.getFishScreenPosistion().x,i.getFishScreenPosistion().y),pn.to(d,{scaleX:1,scaleY:1},200),pn.to(d,{y:d.y-40},700,null,null,200),pn.to(d,{alpha:0},450,null,F.create(this,this.recoverCoinLabel,[d]),400),this.fight.view.fight_layer.addChild(d),this.timer.once(h,this,function(){r.showLabel2(a,i.money.toString()),a.isSelf&&!r.isPlayingGetCoinSound&&(r.isPlayingGetCoinSound=!0,is.playSound("F4BY_GetCoin.wav",1,F.create(r,function(){return r.isPlayingGetCoinSound=!1})))})}},{key:"createCoinSingle",value:function(e,t,n,i,a,r,o,s){var l=this,h=wo.getItemWithType("fishdld/fight/animation/coin_rotation.scene",ts.fishdld.animation.coin_rotationUI);h||((h=new ts.fishdld.animation.coin_rotationUI).recycleKey="fishdld/fight/animation/coin_rotation.scene");for(var u=!e.isSelf,d=0;d<h.numChildren;d++)h.getChildAt(d).gray=u;h.ani.play(0,!1),h.zOrder=600,h.pos(n,i),h.scale(.5,.5),this.fight.view.ui_effect_layer.addChild(h);var c=new As,_=new L,f=new L;_.x=n,_.y=i,f.x=r,f.y=o;var r=_.x-f.x,o=_.y-f.y,g=Math.sqrt(r*r+o*o),y=200+.5*g;return this.timer.once(250+a,this,function(){u||l.createCoinTrail(h,y),y=200+.5*g,c.curveTweenDo(h,_,f,y,0)}),250+a+y}},{key:"createCoinTrail",value:function(t,e){var n=this;t.timer.loop(30,t,function(){var e=wo.getItemWithType("fishdld/fight/mainui/coin_trail.png",pi);e.y=-20,e.zOrder=t.zOrder-1,e.anchorX=e.anchorY=.5,e.scale(.3,.3),e.pos(t.x,t.y),pn.to(e,{scaleX:0,scaleY:0},1e3,null,F.create(wo,wo.recycle,[e])),n.fight.view.fight_layer.addChild(e)}),t.timer.once(e,this,function(){t.timer.clearAll(t)})}},{key:"showCoinBoom3DEffect",value:function(t){var n=this,i=Ns.COIN_BOOM_EFFECT;zn.loader.create(i,F.create(this,function(){var e=wo.getItemWithType(i,fa);--t.z,e.transform.position=t,n.fight.fishScene.view.addChild(e),wo.recycle(e,i,!1,3e3)}))}},{key:"registerFont",value:function(e,t){var n=new an;n.loadFont("fishdld/bitmapFont/"+e,t),Ut.registerBitmapFont(e,n)}},{key:"destroy",value:function(){this.timer.clearAll(this),l._instance=null}}],[{key:"I",get:function(){return l._instance=null==l._instance?new l:l._instance}}]),l}(),As=function(){function e(){S(this,e),this.isTweenDoing=!1,this.islastOne=!1}return C(e,[{key:"curveTweenDo",value:function(e,t,n,i,a){var r=this;this.isTweenDoing||(this.startPoint=t,this.endPoint=n,this.isTweenDoing=!0,this.tweenTarge=e,this.curveRate(.7,.3),this.tweenTarge.x=this.startPoint.x,this.tweenTarge.y=this.startPoint.y,Cs.I.timer.once(a,this,function(){return pn.to(r,{factor:1},i,_n.sineIn,F.create(r,r.disPose))}))}},{key:"curveRate",value:function(e,t){this.endPoint.y>this.startPoint.y&&this.endPoint.x>this.startPoint.x?(this.p1X=this.startPoint.x+Math.abs(this.endPoint.x-this.startPoint.x)*e,this.p1Y=this.startPoint.y+Math.abs(this.endPoint.y-this.startPoint.y)*t):this.endPoint.y>this.startPoint.y&&this.endPoint.x<this.startPoint.x?(this.p1X=this.startPoint.x-Math.abs(this.endPoint.x-this.startPoint.x)*e,this.p1Y=this.startPoint.y+Math.abs(this.endPoint.y-this.startPoint.y)*t):this.endPoint.y<this.startPoint.y&&this.endPoint.x>this.startPoint.x?(this.p1X=this.startPoint.x+Math.abs(this.endPoint.x-this.startPoint.x)*e,this.p1Y=this.startPoint.y-Math.abs(this.endPoint.y-this.startPoint.y)*t):this.endPoint.y<this.startPoint.y&&this.endPoint.x<this.startPoint.x&&(this.p1X=this.startPoint.x-Math.abs(this.endPoint.x-this.startPoint.x)*e,this.p1Y=this.startPoint.y-Math.abs(this.endPoint.y-this.startPoint.y)*t)}},{key:"disPose",value:function(){this.islastOne,wo.recycle(this.tweenTarge)}},{key:"factor",get:function(){return 0},set:function(e){var t=this.tweenTarge;t&&(t.destroyed||(t.x=(1-e)*(1-e)*this.startPoint.x+2*e*(1-e)*this.p1X+e*e*this.endPoint.x,t.y=(1-e)*(1-e)*this.startPoint.y+2*e*(1-e)*this.p1Y+e*e*this.endPoint.y))}}]),e}(),Ds=function(){T(n,qn);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).alreadyShowComing=!1,e.colors=new Array,e.shapes=new Array,e}return C(n,[{key:"init",value:function(e){this.fish=e,this.alreadyShowComing=!1,this.testTimer=0}},{key:"onUpdate",value:function(){this.updateLifeState(),this.updateScale()}},{key:"updateScale",value:function(){this.fish.model.transform.scale.x=this.fish.pathScale.x*this.fish.callupScale,this.fish.model.transform.scale.y=this.fish.pathScale.y*this.fish.callupScale,this.fish.model.transform.scale.z=this.fish.pathScale.z*this.fish.callupScale,this.fish.model.transform.scale=this.fish.model.transform.scale,this.fish.shadow.transform.scale=this.fish.model.transform.scale}},{key:"updateLifeState",value:function(){var t=this;this.fish.lifeState==os.Init?(this.fish.lifeState=os.EnterScene,Si.event.event(os.EnterScene,this.fish),this.fish.event(os.EnterScene,this.fish)):this.fish.lifeState==os.EnterScene||this.fish.lifeState==os.OutScreen?this.isInnerScreen()&&(this.fish.lifeState=os.EnterScreen,this.fish.fishScene.enterScreenFishes.push(this.fish),Si.event.event(os.EnterScreen,this.fish),this.fish.event(os.EnterScreen,this.fish),this.alreadyShowComing||(this.fish.define.show_coming&&Cs.I.showFishComing(this.fish),this.fish.define.coming_sound&&is.playSound(this.fish.define.coming_sound),this.alreadyShowComing=!0)):this.fish.lifeState==os.EnterScreen&&this.isOutSideScreen()&&(this.fish.lifeState=os.OutScreen,this.fish.fishScene.enterScreenFishes.remove(function(e){return e.uniqueId==t.fish.uniqueId}),Si.event.event(os.OutScreen,this.fish),this.fish.event(os.OutScreen,this.fish))}},{key:"isOutSideScreen",value:function(){var e,t=c(this.fish.fishColliderArr);try{for(t.s();!(e=t.n()).done;)if(e.value.isInScreen)return!1}catch(e){t.e(e)}finally{t.f()}return!0}},{key:"isInnerScreen",value:function(){var e,t=c(this.fish.fishColliderArr);try{for(t.s();!(e=t.n()).done;)if(e.value.isInScreen)return!0}catch(e){t.e(e)}finally{t.f()}}},{key:"showColliderShape",value:function(){this.testTimer+=Gn.timer.delta;for(var e=this.fish.fishColliderArr,t=0;t<e.length;t++)this.createTestShape(t,e[t].screenProjectPosition.x,e[t].screenProjectPosition.y,this.fish.model.transform.position.z,e[t].screenProjectRadius)}},{key:"createTestShape",value:function(e,t,n,i,a){var r;this.shapes[e]||((r=Gn.addChild(new Bt)).pos(t,n),this.colors[e]="#"+Math.floor(2677216*Math.random()),r.graphics.drawCircle(0,0,a,this.colors[e]),this.shapes.push(r)),this.shapes[e].graphics.clear(!0),this.shapes[e].graphics.save(),this.shapes[e].graphics.alpha(.5),this.shapes[e].graphics.drawCircle(0,0,a,this.colors[e]),this.shapes[e].graphics.fillText("x=".concat(this.shapes[e].x.toFixed(2),", y=").concat(this.shapes[e].y.toFixed(2),", z=").concat(i.toFixed(2)),0,0,"20px Arial","#ff0000","center"),this.shapes[e].graphics.restore(),this.shapes[e].pos(t,n)}},{key:"clearTestShape",value:function(){var e,t=c(this.shapes);try{for(t.s();!(e=t.n()).done;)e.value.graphics.clear()}catch(e){t.e(e)}finally{t.f()}}},{key:"onDestroy",value:function(){this.fish=null,this.clearTestShape()}}]),n}(),Ls=function(){function e(){S(this,e)}return C(e,null,[{key:"split2Number",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:",",n=new Array;if(e){var i,a=e.split(t);for(i in a)n.push(Number(a[i]));return n}return n}},{key:"map2Array",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"value",i=new Array;for(t in e)"length"!=t&&("value"==n?i.push(e[t]):i.push(t));return i}},{key:"deleteArrItem",value:function(e,t,n){for(var i=0;i<e.length;i++)e[i][t]==n&&(e.splice(i,1),i--)}},{key:"getArrItem",value:function(e,t,n,i){for(var a=0;a<e.length;a++)if(e[a][t]==n)return e[a];return i}},{key:"getAllArrItem",value:function(e,t,n){for(var i=[],a=0;a<e.length;a++)e[a][t]==n&&i.push(e[a]);return i}},{key:"indexOf",value:function(e,t,n){for(var i=0;i<e.length;i++)if(e[i]&&e[i][t]==n)return i;return-1}},{key:"removeDuplicate",value:function(e,t){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],a=e.concat(),r=0;r<a.length;r++)r+n<a.length&&a[r][t]==a[r+n][t]&&(i?a.splice(r,1):a.splice(r+n,1),r--);return a}}]),e}();(Rs=Os=Os||{}).Electric="Electric",Rs.BulletHit="BulletHit";var Os,Ps=Os;(Os=Fs=Fs||{})[Os.Lobster=20]="Lobster",Os[Os.WhiteShark=21]="WhiteShark",Os[Os.KillerWhale=22]="KillerWhale",Os[Os.Mermaid=23]="Mermaid",Os[Os.DeepSeaWhales=24]="DeepSeaWhales",Os[Os.Octopus=26]="Octopus",Os[Os.GoldenShark=27]="GoldenShark",Os[Os.HammerShark=28]="HammerShark",Os[Os.GoldenCicada=29]="GoldenCicada",Os[Os.Dragon=30]="Dragon",Os[Os.Puffer=31]="Puffer",Os[Os.ElectricCrab=32]="ElectricCrab",Os[Os.RocketCrab=33]="RocketCrab",Os[Os.FreeCrab=34]="FreeCrab",Os[Os.Electric=35]="Electric",Os[Os.ButterflyFlyBoss=36]="ButterflyFlyBoss",Os[Os.DragonFlyBoss=37]="DragonFlyBoss";var Fs,Bs=Fs,Vs=function(){T(n,Mi);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).money=0,e.alreadyPlayHitSound=!1,e.electricDuration=1e3,e.mainColliderIndex={0:[Bs.WhiteShark,Bs.Lobster,Bs.HammerShark,Bs.Mermaid,Bs.GoldenShark],1:[Bs.KillerWhale,Bs.Electric],2:[Bs.DeepSeaWhales],3:[]},e}return C(n,[{key:"load",value:function(e,t){var n=this;this.define=e,this.timer=new Cn,zn.loader.create([Ns.FISH_MODEL_RES+this.define.fishid+".lh",Ns.FISH_MODEL_RES+this.define.fishid+"_shadow.lh"],F.create(this,function(){var e;n.model=wo.getItemWithType(Ns.FISH_MODEL_RES+n.define.fishid+".lh",fa),n.model?(n.shadow=wo.getItemWithType(Ns.FISH_MODEL_RES+n.define.fishid+"_shadow.lh",fa),n.shadow.transform.position=n.shadow.transform.position,e=Ls.getArrItem(zn.loader.getRes(Ns.FISH_ANIMATOR_CONF),"id",n.define.fishid),n.ani=new Ss(n.model,e),e=zn.loader.getRes(Ns.FISH_MATERIAL_CONF)[n.define.fishid],n.material=new ks(n.model,e),n.script=n.model.addComponent(Ds),t.runWith(n)):console.warn("不存在模型："+n.define.fishid)}))}},{key:"init",value:function(e){this.fishScene=e,this.fishScene.view.addChild(this.model),this.fishScene.view.addChild(this.shadow),this.camera=e.camera,this.lifeState=os.Init,this.pathScale=new vn(1,1,1),this.callupScale=1,this.money=0,this.alreadyPlayHitSound=!1,this.setUnCalculate(),this.resetModel(),this.script.init(this)}},{key:"resetModel",value:function(){this.ani.init(),this.ani.setSpeed(1),this.model.transform.position=new vn,this.model.transform.scale=new vn(this.define.scale,this.define.scale,this.define.scale),this.model.transform.rotation=new xi}},{key:"setCurveClip",value:function(e){this.curveClip=e}},{key:"hit",value:function(e){var t,n=this;!this.alreadyPlayHitSound&&this.define.first_hit_sound&&(this.alreadyPlayHitSound=!0,t=this.define.first_hit_sound[Ti.randInt(0,this.define.first_hit_sound.length)],is.playBeHit(t)),this.material.setMarginalColor(new yn(1,0,0,1)),this.timer.once(100,this,function(){n.material.recoverMarginalColor()},null,!0)}},{key:"stopMove",value:function(){this.curveClip&&(this.curveClip.onTargetDestroy(),this.curveClip=null)}},{key:"die",value:function(e,t){this.setDie(),this.playDieAndDestroy(),this.playDieSound(t),this.showDieEffect(e,t),this.showGunCombo(t)}},{key:"setDie",value:function(){this.lifeState=os.Died,this.event(os.Died),this.ani.setSpeed(1),this.stopMove()}},{key:"playDieAndDestroy",value:function(){var e=this;this.ani.setValue("die",!0),this.ani.once(Je.COMPLETE,this,function(){pn.to(e.model.transform,{localScaleX:0,localScaleY:0,localScaleZ:0},200,null,F.create(e,e.destroy)),pn.to(e.shadow.transform,{localScaleX:0,localScaleY:0,localScaleZ:0},200)})}},{key:"playDieSound",value:function(e){e.isSelf&&is.playSound(this.define.die_sound)}},{key:"showDieEffect",value:function(e,t){switch(this.define.die_effect){case"explode":this.fishScene.playCameraShake(),Cs.I.showCoinBoom3DEffect(this.model.transform.position),Cs.I.showUserTopFishUI(this,t,Ti.randInt(0,3)),t.isSelf&&is.playSound("F4BY_cc127.wav"),t.isSelf&&is.playSound("F4BY_SpineAward2.wav");break;case"combo_ui":e!=Ps.Electric&&Cs.I.showUserTopFishUI(this,t,3);break;case"lottery_ui":Cs.I.showFishLotteryUI(this,t),t.isSelf&&is.playSound("F4BY_Wheel.wav");break;case"normal":Cs.I.showMiniExplode(this),Cs.I.showCoin(this,t)}}},{key:"showGunCombo",value:function(e){e.gun.addComboScore(this.uniqueId,this.money)}},{key:"setUnCalculate",value:function(){this.curFrameHasCalFishCollider=!1}},{key:"calScreenProjectPosition",value:function(e,t){this.camera.worldToViewportPoint(e.transform.position,Ti.temp0Vector3),t.setTo(Ti.temp0Vector3.x,Ti.temp0Vector3.y)}},{key:"calScreenProjectRadius",value:function(e){e.parent;return e.transform.scale.z/this.fishScene.camera.orthographicVerticalSize*Gn.height}},{key:"isPointInFish",value:function(e,t){var n=c(this.fishColliderArr);try{for(n.s();!(i=n.n()).done;){var i=i.value;if(i.screenProjectPosition.distance(e,t)<i.screenProjectRadius)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"getMainCollider",value:function(){var e,t;for(t in this.mainColliderIndex)0<=this.mainColliderIndex[t].indexOf(this.define.fishid)&&(e=this.fishColliderArr[t]);if(!(e=e||this.fishColliderArr[this.fishColliderArr.length-1]).isInScreen){var n=c(this.fishColliderArr);try{for(n.s();!(i=n.n()).done;){var i=i.value;if(i.isInScreen)return i}}catch(e){n.e(e)}finally{n.f()}}return e}},{key:"getFishScreenPosistion",value:function(){return this.getMainCollider().screenProjectPosition}},{key:"getTransform",value:function(){return this.model.transform}},{key:"onCallup",value:function(t){var n=this;this.callupScale=0,this.model.transform.scale.setValue(0,0,0),this.model.transform.scale=this.model.transform.scale,this.shadow.transform.scale=this.model.transform.scale,zn.loader.create(Ns.CALLUP_VORTEX_EFFECT,F.create(this,function(){n.timer.callLater(n,function(){is.playSound("F4BY_Summon.wav");var e=wo.getItemWithType(Ns.CALLUP_VORTEX_EFFECT,fa);n.model.transform.position.cloneTo(e.transform.position),e.transform.position.z=100,e.transform.position=e.transform.position,Ms.getComponent(e,la).play(null,0,0),n.fishScene.view.addChild(e),pn.to(n,{callupScale:1},3e3,null,F.create(n,function(){wo.recycle(e,Ns.CALLUP_VORTEX_EFFECT,!1),t.run()}))})}))}},{key:"afterUpdateTransform",value:function(e,t){var n=this.fishScene.camera.aspectRatio/($s.width/$s.height);this.model.transform.position.x=e.x*n,this.model.transform.position=this.model.transform.position,n<1?(this.pathScale.x=t.x*n,this.pathScale.y=t.y*n,this.pathScale.z=t.z*n):(this.pathScale.x=t.x,this.pathScale.y=t.y,this.pathScale.z=t.z),this.shadow.transform.rotation=this.model.transform.rotation,this.shadow.transform.position.x=this.model.transform.position.x+this.define.shadow_offset[0],this.shadow.transform.position.y=this.model.transform.position.y+this.define.shadow_offset[1],this.shadow.transform.position.z=100,this.shadow.transform.position=this.shadow.transform.position}},{key:"SetAniBool",value:function(e,t){this.ani.setValue(e,t)}},{key:"showBubble",value:function(){var t=this,n=Ns.EEL_BUBBLE_EFFECT;zn.loader.create(n,F.create(this,function(){var e=wo.getItemWithType(n,fa);e.transform.scale=new vn(t.define.bubble_size,t.define.bubble_size,t.define.bubble_size),e.transform.position=new vn(-t.define.bubble_pos,0,0),t.model.addChild(e),wo.recycle(e,n,!1,t.electricDuration)}))}},{key:"showLineRender",value:function(t){var n=this,i=Ns.EEL_LINE_EFFECT;zn.loader.create(i,F.create(this,function(){var e=wo.getItemWithType(i,mo);e.width=1,e.setFollow(n.model.transform,t.model.transform),n.fishScene.view.addChild(e),wo.recycle(e,i,!1,n.electricDuration)}))}},{key:"pathOver",value:function(){this.destroy()}},{key:"setFishMoveSpeed",value:function(e){this.ani.setSpeed(e)}},{key:"destroy",value:function(){var e=this;this.fishScene.removeFish(this),this.lifeState=os.Destroy,this.event(os.Destroy,this),this.offAll(),Si.event.event(os.Destroy,this),Si.event.offAllCaller(this),this.ani.stop(),this.curveClip=null,this.timer.clearAll(this),this.material.recoverMarginalColor(),this.model.removeSelf(),this.shadow.removeSelf(),this.timer.once(5e3,this,function(){e.fishScene.recycleFish(e)})}},{key:"fishColliderArr",get:function(){if(!this._fishColliderArr){this._fishColliderArr=[];var t=c(Ms.getAllChidByName(this.model,"SphereCollider_",!0));try{for(t.s();!(n=t.n()).done;){var e=n.value,n=new Is;n.collider=e,this._fishColliderArr.push(n)}}catch(e){t.e(e)}finally{t.f()}}if(!this.curFrameHasCalFishCollider){var i=c(this._fishColliderArr);try{for(i.s();!(a=i.n()).done;){var a=a.value;this.calScreenProjectPosition(a.collider,a.screenProjectPosition),a.screenProjectRadius=this.calScreenProjectRadius(a.collider)}}catch(e){i.e(e)}finally{i.f()}this.curFrameHasCalFishCollider=!0,this.timer.callLater(this,this.setUnCalculate)}return this._fishColliderArr}}]),n}(),Us=function(){T(n,Vs);var e=b(n);function n(){return S(this,n),e.apply(this,arguments)}return C(n,[{key:"die",value:function(e,t){G(z(n.prototype),"die",this).call(this,e,t),this.showBlinlinEffect(t),this.showGunEffect(t)}},{key:"showBlinlinEffect",value:function(e){var t=g.getItem("dldby_crab_dieUI");(t=t||new ts.fishdld.animation.dldby_crab_dieUI).pos(this.getFishScreenPosistion().x,this.getFishScreenPosistion().y),t.ani1.play(0,!1),t.ani1.offAll(Je.COMPLETE),t.ani1.once(Je.COMPLETE,this,function(){t.removeSelf(),g.recover("dldby_crab_dieUI",t)}),this.fishScene.fight.view.fight_layer.addChild(t)}},{key:"showGunEffect",value:function(n){var i,a,r=this;this.define.fishid==Bs.FreeCrab?((i=new pi("fishdld/fight/mainui/free_gun.png")).scale(.7,.7),a=fs.Free):this.define.fishid==Bs.ElectricCrab?(i=new pi("fishdld/fight/mainui/electric_gun.png"),a=fs.Electric):this.define.fishid==Bs.RocketCrab&&(i=new pi("fishdld/fight/mainui/bullet_8.png"),a=fs.Rocket),i.anchorX=i.anchorY=.5,i.pos(this.getFishScreenPosistion().x,this.getFishScreenPosistion().y),pn.from(i,{scaleX:0,scaleY:0,alpha:0},1e3,null,F.create(this,function(){var e=n.gunGlobalPosition,t=e.distance(i.x,i.y);pn.to(i,{x:e.x,y:e.y,rotation:n.gun.rotation},1.3*t,null,F.create(r,function(){n.status.isLevelGame||(i.destroy(),n.changeGunByType(a,r.uniqueId))}))})),this.fishScene.fight.view.fight_layer.addChild(i)}}]),n}(),zs=function(){T(n,us);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).direction=new L,e.speed=new L,e.radius=30,e}return C(n,[{key:"setData",value:function(e,t){this.node=this.owner,this.fight=e.fight,this.direction.setTo(0,0),this.speed.setTo(0,0),this.user=e,this.target=t instanceof Us?null:t,this.fight.view.fight_layer.addChild(this.node),this.calSpeed()}},{key:"calSpeed",value:function(){this.target&&(this.node.rotation=Ti.getRotation(this.node.x,this.node.y,this.target.getFishScreenPosistion().x,this.target.getFishScreenPosistion().y)),this.direction.x=this.node.rotation<-90||90<this.node.rotation?-1:1,this.direction.y=Math.tan(this.node.rotation*Math.PI/180)*this.direction.x,this.direction.normalize(),this.speed.x=this.direction.x,this.speed.y=this.direction.y}},{key:"onUpdate",value:function(){this.checkTarget(),this.bounce(),this.checkCrash(),this.updateTransform()}},{key:"getBulletType",value:function(){return hs.Free}},{key:"checkTarget",value:function(){this.target&&this.target.lifeState!=os.EnterScreen&&(this.target=null)}},{key:"updateTransform",value:function(){this.target&&this.calSpeed(),this.node.x+=this.speed.x*Gn.timer.delta*1.5,this.node.y+=this.speed.y*Gn.timer.delta*1.5}},{key:"bounce",value:function(){(this.node.x<0||this.node.x>Gn.width)&&(this.node.x=this.node.x<0?0:Gn.width,this.node.rotation=180*Ti.getSign(this.node.rotation)-this.node.rotation,this.calSpeed()),(this.node.y<0||this.node.y>Gn.height)&&(this.node.y=this.node.y<0?0:Gn.height,this.node.rotation=-this.node.rotation,this.calSpeed())}},{key:"checkCrash",value:function(){if(this.target&&this.target.lifeState==os.EnterScreen)this.checkFish(this.target);else{var t=c(this.fight.fishScene.fishes);try{for(t.s();!(e=t.n()).done;){var e=e.value;if(e.lifeState==os.EnterScreen&&!(e instanceof Us)&&this.checkFish(e))return}}catch(e){t.e(e)}finally{t.f()}}}},{key:"checkFish",value:function(e){var t=c(e.fishColliderArr);try{for(t.s();!(n=t.n()).done;){var n=n.value;if(n.screenProjectPosition.distance(this.node.x,this.node.y)<=n.screenProjectRadius+this.radius)return this.hit([e]),this.createNet(),this.recover(),!0}}catch(e){t.e(e)}finally{t.f()}}},{key:"createNet",value:function(){var e="dldby_net_6UI",t=(t=wo.getItem(e))||new ts.fishdld.animation[e];this.fight.view.fight_layer.addChild(t),t.pos(this.node.x,this.node.y),t.rotation=Ti.randInt(0,360);var n=t.ani1;n.play(0,!1),n.offAll(Je.COMPLETE),n.once(Je.COMPLETE,this,function(){t.removeSelf(),wo.recover(e,t)})}},{key:"recover",value:function(){this.node.removeSelf(),wo.recover("Dldby_bullet_6UI",this.node),this.user.status.curBuletCount--,this.target=null}}]),n}(),Gs=function(){T(i,ss);var e=b(i);function i(){return S(this,i),e.apply(this,arguments)}return C(i,[{key:"onMouseUp",value:function(){}},{key:"init",value:function(e,t,n){G(z(i.prototype),"init",this).call(this,e,t,n),this.initUI(),this.startCountdown(),this.rate=1,Si.event.on(di.UpdateAdventureInfoResp,this,this.addTime),this.user.isSelf&&is.playMusic("F4BY_FreeBG.mp3"),this.oldFireSpeed=this.user.status.fireSpeed,this.user.isSelf?(this.user.status.fireSpeed=2,this.onMouseDown(),this.user.noticeSyncMyStatus()):((n=new di.FishDummyFastShootResp).isFast=1,n.uid=this.user.member.uid,Si.event.event(di.FishDummyFastShootResp,n))}},{key:"initUI",value:function(){this.gunView.getChildByName("fire").rotation=2<=this.user.member.position?180:0,this.gunView.getChildByName("ui").y=2<=this.user.member.position?8:-7,this.rate_label=this.gunView.getChildByName("ui").getChildByName("rate"),this.rate_label.font="fnt_freegun_double.fnt",this.cannon_level_label=this.gunView.getChildByName("ui").getChildByName("cannon_level"),this.cannon_level_label.font="fnt_gun_com.fnt",this.cannon_level_label.text=this.user.member.cannon_level.toString(),this.remain_label=this.gunView.getChildByName("ui").getChildByName("remain"),this.remain_label.font="fnt_freegun_time.fnt",this.end_ani=this.gunView.end,this.playAnimation("circle",0,!0),this.playAnimation("start",0,!1)}},{key:"startCountdown",value:function(){this.remain=3e4,this.timer.frameLoop(1,this,this.udpate)}},{key:"addTime",value:function(e){var t,n,i,a=this;this.user.member.uid==e.uid&&((t=wo.getItem("free_gun_add"))||((t=new ts.fishdld.fight.FreeGunAddUI).num.font="fnt_freegun_double.fnt"),t.time.visible=0<e.add_time,t.rate.visible=0<e.add_multiple,t.num.text=0<e.add_time?"+"+e.add_time:"+"+e.add_multiple,n=this.fight.fishScene.getFishByUniqueId(e.fish_id),t.pos(n.getFishScreenPosistion().x,n.getFishScreenPosistion().y),this.fight.view.ui_effect_layer.addChild(t),i=new L,0<e.add_time?i.setTo(this.remain_label.x,this.remain_label.y):i.setTo(this.rate_label.x,this.rate_label.y),this.cannon_level_label.parent.localToGlobal(i),t.scale(1,1),pn.from(t,{scaleX:0,scaleY:0},500,_n.backOut),t.timer.once(1e3,this,function(){pn.to(t,{scaleX:.4,scaleY:.4,x:i.x,y:i.y},500,_n.circOut,F.create(a,function(){t.removeSelf(),wo.recover("free_gun_add",t),a.isRecover||(0<e.add_time?(a.remain=1e3*e.end_time,a.remain_label.text="+"+e.end_time.toFixed(1),a.playAnimation("add_time",0,!1)):(a.rate=e.multiple,a.playAnimation("add_rate",0,!1)))}))}))}},{key:"udpate",value:function(){var e=this;this.remain-=this.timer.delta,0<=this.remain&&(this.remain_label.text=(this.remain/1e3).toFixed(1)),this.remain<=1500&&!this.end_ani.isPlaying&&(this.end_ani.play(0,!1),this.end_ani.once(Je.COMPLETE,this,function(){e.user.changeToNormalGun()}))}},{key:"createBullet",value:function(){this.user.isSelf&&is.playSound("F4BY_FreeShoot.wav");var e=wo.getItem("Dldby_bullet_6UI");return(e=e||new ts.fishdld.animation.Dldby_bullet_6UI).ani1.play(0,!0),e.rotation=this.rotation,e.pos(this.muzzleWorldPos.x,this.muzzleWorldPos.y),(e.getComponent(zs)||e.addComponent(zs)).setData(this.user,this.user.status.targetFish),e}},{key:"getComboUIInfo",value:function(){return{icon:"fishdld/animation/aniui/gun_icon_freegame.png",title:"fishdld/animation/aniui/gun_title_freegame.png"}}},{key:"getRotationComponent",value:function(){return this.gunView.getChildByName("gun")}},{key:"recover",value:function(){this.user.isSelf&&is.playMusic("F4BY_BG.mp3"),this.end_ani.offAllCaller(this),this.timer.clearAll(this),Si.event.off(di.UpdateAdventureInfoResp,this,this.addTime),G(z(i.prototype),"recover",this).call(this),this.user.status.fireSpeed=this.oldFireSpeed,this.user.status.isMouseDown=!1}},{key:"createGunView",value:function(){return new ts.fishdld.animation.Dldby_gun_6UI}},{key:"isFree",value:function(){return!0}},{key:"rate",get:function(){return this._rate},set:function(e){this._rate=e,this.rate_label.text="x"+this._rate}},{key:"canLockTarget",get:function(){return!0}},{key:"canUserChangeFireSpeed",get:function(){return!1}}]),i}(),Xs=function(){T(n,us);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).width=470,e}return C(n,[{key:"setData",value:function(e){this.node=this.owner,this.ani=this.node.ani1,this.fight=e.fight,this.user=e,this.fight.view.fight_layer.addChild(this.node),this.ani.play(0,!1),this.ani.once(Je.COMPLETE,this,this.onComplete),this.ani.timerLoop(800,this,this.checkCrash)}},{key:"onUpdate",value:function(){}},{key:"getBulletType",value:function(){return hs.Electric}},{key:"checkCrash",value:function(){var e=new Array,t=c(this.fight.fishScene.fishes);try{for(t.s();!(n=t.n()).done;){var n=n.value;n.lifeState!=os.EnterScreen||n instanceof Us||!this.checkFish(n)||e.push(n)}}catch(e){t.e(e)}finally{t.f()}0<e.length&&this.hit(e)}},{key:"checkFish",value:function(e){var t=c(e.fishColliderArr);try{for(t.s();!(r=t.n()).done;){var n=r.value,i=Gn.height-this.node.y,a=n.screenProjectPosition;a.y=Gn.height-a.y;var r=Math.tan(-this.node.rotation/180*Math.PI),i=i-r*this.node.x;if(Math.abs((r*a.x+-1*a.y+i)/Math.sqrt(Math.pow(r,2)+Math.pow(-1,2)))<=this.width/2+n.screenProjectRadius)return!0}}catch(e){t.e(e)}finally{t.f()}}},{key:"onComplete",value:function(){var e=this;this.ani.offAllCaller(this),this.ani.timer.clear(this,this.checkCrash),this.node.removeSelf(),wo.recover("Dldby_bullet_7UI",this.node),this.user.status.curBuletCount--,this.node.timer.once(1e3,this,function(){e.user.changeToNormalGun()})}}]),n}(),Hs=function(){T(i,as);var t=b(i);function i(){var e;return S(this,i),(e=t.apply(this,arguments)).alreadyFire=!1,e.isMouseDown=!1,e}return C(i,[{key:"init",value:function(e,t,n){G(z(i.prototype),"init",this).call(this,e,t,n),this.area=this.gunView.getChildByName("area"),this.gunView.getChildByName("cannon_level").font="fnt_gun_com.fnt",this.gunView.getChildByName("cannon_level").text=this.user.member.cannon_level.toString(),t.member.is_dummy&&this.fight.isMaster&&this.timer.once(2e3,this,this.shoot),t.isSelf&&(this.countDownFireTime=30,this.user.setCountDownFireTime(this.countDownFireTime),this.user.setCountDownFireType(fs.Electric),this.timer.loop(1e3,this,this.countDownFire)),zn.loader.load("fishdld/animation/anibullet/bullet_7.atlas")}},{key:"countDownFire",value:function(){this.countDownFireTime--,this.countDownFireTime<0?this.shoot():this.user.setCountDownFireTime(this.countDownFireTime)}},{key:"onUpdate",value:function(){}},{key:"onMouseDown",value:function(){this.alreadyFire||(this.isMouseDown=!0,this.area.visible=!0,this.setDiretion(this.user.mousePoint.x,this.user.mousePoint.y),this.playAnimation("attack",0,!0))}},{key:"onMouseUp",value:function(){!this.alreadyFire&&this.isMouseDown&&(this.isMouseDown=!1,this.shoot())}},{key:"onMouseMove",value:function(){this.isMouseDown&&this.setDiretion(this.user.mousePoint.x,this.user.mousePoint.y)}},{key:"shoot",value:function(){this.playAnimation("default",0,!1),this.alreadyFire=!0,this.area.visible=!1,this.createBullet(),is.playSound("F4BY_ElectricContinues.wav",5),this.user.isSelf&&(this.user.startNoActionCountDown(),this.user.hideCountDownFire(),this.timer.clear(this,this.countDownFire),is.playSound("F4BY_ElectricShoot.wav"))}},{key:"createBullet",value:function(){var e=wo.getItem("Dldby_bullet_7UI");return(e=e||new ts.fishdld.animation.Dldby_bullet_7UI).rotation=this.rotation,e.pos(this.muzzleWorldPos.x,this.muzzleWorldPos.y),(e.getComponent(Xs)||e.addComponent(Xs)).setData(this.user),e}},{key:"getComboUIInfo",value:function(){return{icon:"fishdld/animation/aniui/gun_icon_electric.png",title:"fishdld/animation/aniui/gun_title_electric.png"}}},{key:"isFree",value:function(){return!0}},{key:"createGunView",value:function(){return new ts.fishdld.animation.Dldby_gun_7UI}},{key:"recover",value:function(){this.area.visible=!1,this.isMouseDown=!1,this.alreadyFire=!1,this.timer.clear(this,this.countDownFire),G(z(i.prototype),"recover",this).call(this)}},{key:"canLockTarget",get:function(){return!1}},{key:"canUserChangeFireSpeed",get:function(){return!1}}]),i}(),Ys=function(){T(n,us);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).direction=new L,e.speed=new L,e.catchedFish=new Array,e.lifeTime=0,e.radius=30,e}return C(n,[{key:"setData",value:function(e){this.node=this.owner,this.fight=e.fight,this.direction.setTo(0,0),this.speed.setTo(0,0),this.user=e,this.fight.view.fight_layer.addChild(this.node),this.initTrail(),this.calSpeed()}},{key:"initTrail",value:function(){this.trail=wo.getItemWithType(Ns.ROCKET_TRAIL_EFFECT,fa),this.tempPos=new vn,this.fight.fishScene.view.addChild(this.trail)}},{key:"calSpeed",value:function(){this.direction.x=this.node.rotation<-90||90<this.node.rotation?-1:1,this.direction.y=Math.tan(this.node.rotation*Math.PI/180)*this.direction.x,this.direction.normalize(),this.speed.x=this.direction.x,this.speed.y=this.direction.y}},{key:"onUpdate",value:function(){this.bounce(),this.checkCrash(),this.updateTransform(),this.checkLife()}},{key:"getBulletType",value:function(){return hs.Rocket}},{key:"checkLife",value:function(){this.lifeTime+=Gn.timer.delta}},{key:"updateTransform",value:function(){this.node.x+=this.speed.x*Gn.timer.delta*1.5,this.node.y+=this.speed.y*Gn.timer.delta*1.5,this.tempPos.setValue(this.node.x,this.node.y,-50),Ti.sceenPointToWorld(this.fight.fishScene.camera,this.tempPos,this.tempPos),this.trail.transform.position=this.tempPos,(this.node.x<-135||this.node.x>Gn.width+135||this.node.y<-135||this.node.y>Gn.height+135)&&this.recover()}},{key:"bounce",value:function(){1e4<=this.lifeTime||((this.node.x<0||this.node.x>Gn.width)&&(this.node.x=this.node.x<0?0:Gn.width,this.node.rotation=180*Ti.getSign(this.node.rotation)-this.node.rotation,this.calSpeed(),this.catchedFish=[]),(this.node.y<0||this.node.y>Gn.height)&&(this.node.y=this.node.y<0?0:Gn.height,this.node.rotation=-this.node.rotation,this.calSpeed(),this.catchedFish=[]))}},{key:"checkCrash",value:function(){var t=c(this.fight.fishScene.fishes);try{for(t.s();!(e=t.n()).done;){var e=e.value;e.lifeState!=os.EnterScreen||-1!=this.catchedFish.indexOf(e.uniqueId)||e instanceof Us||!this.checkFish(e)||this.catchedFish.push(e.uniqueId)}}catch(e){t.e(e)}finally{t.f()}}},{key:"checkFish",value:function(e){var t=c(e.fishColliderArr);try{for(t.s();!(n=t.n()).done;){var n=n.value;if(n.screenProjectPosition.distance(this.node.x,this.node.y)<=n.screenProjectRadius+this.radius)return this.hit([e]),this.createNet(),!0}}catch(e){t.e(e)}finally{t.f()}}},{key:"createNet",value:function(){this.user.isSelf&&is.playSound("F4BY_DrillHitFish.wav");var e="dldby_net_8UI",t=wo.getItem(e);t||(t=new ts.fishdld.animation[e]).scale(.5,.5),this.fight.view.fight_layer.addChild(t),t.pos(this.node.x,this.node.y),t.rotation=Ti.randInt(0,360);var n=t.ani1;n.play(0,!1),n.offAll(Je.COMPLETE),n.once(Je.COMPLETE,this,function(){t.removeSelf(),wo.recover(e,t)})}},{key:"recover",value:function(){this.node.removeSelf(),wo.recover(this.node.skin,this.node),wo.recover(Ns.ROCKET_TRAIL_EFFECT,this.trail),this.lifeTime=0,this.catchedFish=[],this.user.status.curBuletCount--,this.user.changeToNormalGun()}}]),n}(),Ws=function(){T(i,as);var t=b(i);function i(){var e;return S(this,i),(e=t.apply(this,arguments)).alreadyFire=!1,e.isMouseDown=!1,e}return C(i,[{key:"init",value:function(e,t,n){G(z(i.prototype),"init",this).call(this,e,t,n),this.gunView.getChildByName("cannon_level").font="fnt_gun_com.fnt",this.gunView.getChildByName("cannon_level").text=this.user.member.cannon_level.toString(),t.member.is_dummy&&this.fight.isMaster&&this.timer.once(2e3,this,this.shoot),t.isSelf&&(this.countDownFireTime=30,this.user.setCountDownFireTime(this.countDownFireTime),this.user.setCountDownFireType(fs.Rocket),this.timer.loop(1e3,this,this.countDownFire))}},{key:"countDownFire",value:function(){this.countDownFireTime--,this.countDownFireTime<0?this.shoot():this.user.setCountDownFireTime(this.countDownFireTime)}},{key:"onUpdate",value:function(){}},{key:"onMouseDown",value:function(){this.alreadyFire||(this.isMouseDown=!0,this.setDiretion(this.user.mousePoint.x,this.user.mousePoint.y))}},{key:"onMouseUp",value:function(){!this.alreadyFire&&this.isMouseDown&&(this.isMouseDown=!1,this.shoot())}},{key:"onMouseMove",value:function(){this.isMouseDown&&this.setDiretion(this.user.mousePoint.x,this.user.mousePoint.y)}},{key:"shoot",value:function(){this.alreadyFire=!0,this.playAnimation("attack",0,!1),this.createBullet(),this.user.isSelf&&(this.user.startNoActionCountDown(),this.user.hideCountDownFire(),this.timer.clear(this,this.countDownFire),is.playSound("F4BY_DrillShoot.wav"))}},{key:"createBullet",value:function(){var e=wo.getItemWithType("fishdld/fight/mainui/bullet_8.png",pi);return e.anchorX=e.anchorY=.5,e.rotation=this.rotation,e.pos(this.muzzleWorldPos.x,this.muzzleWorldPos.y),(e.getComponent(Ys)||e.addComponent(Ys)).setData(this.user),e}},{key:"getComboUIInfo",value:function(){return{icon:"fishdld/animation/aniui/gun_icon_rocket.png",title:"fishdld/animation/aniui/gun_title_rocket.png"}}},{key:"createGunView",value:function(){return new ts.fishdld.animation.Dldby_gun_8UI}},{key:"recover",value:function(){this.isMouseDown=!1,this.alreadyFire=!1,this.timer.clear(this,this.countDownFire),G(z(i.prototype),"recover",this).call(this)}},{key:"isFree",value:function(){return!0}},{key:"canLockTarget",get:function(){return!1}},{key:"canUserChangeFireSpeed",get:function(){return!1}}]),i}(),js=function(){T(i,ts.fishdld.fight.AlertDialog1UI);var e=b(i);function i(){return S(this,i),e.apply(this,arguments)}return C(i,[{key:"showInfo",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length?arguments[1]:void 0;Si.defaultLoadingView.show(),zn.loader.load("fishdld/fight/dialog.atlas",F.create(this,function(){e.info_label.text=t,e.ok.on(Je.CLICK,e,function(){n instanceof F&&(n.run(),e.close())}),G(z(i.prototype),"popup",e).call(e),Si.defaultLoadingView.hide()}))}}],[{key:"I",get:function(){return i._instance=!i._instance?new i:i._instance}}]),i}(),qs=function(){T(i,ts.fishdld.fight.NoActionCountDownDilaogUI);var e=b(i);function i(){return S(this,i),e.apply(this,arguments)}return C(i,[{key:"popup",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];Si.defaultLoadingView.show(),zn.loader.load("fishdld/fight/dialog.atlas",F.create(this,function(){e.init(),G(z(i.prototype),"popup",e).call(e,t,n),Si.defaultLoadingView.hide()}))}},{key:"init",value:function(){Gn.offAllCaller(this),Gn.once(Je.CLICK,this,this.close),this.closeHandler=F.create(this,this.stopTimer),this.timer_label.text="15",Gn.timerLoop(1e3,this,this.countDown)}},{key:"countDown",value:function(){"0"==this.timer_label.text?this.stopTimer():this.timer_label.text=(Number(this.timer_label.text)-1).toString()}},{key:"stopTimer",value:function(){Gn.timer.clearAll(this)}}],[{key:"I",get:function(){return i._instance=!i._instance?new i:i._instance}}]),i}();(Fs=rl=rl||{})[Fs.Normal=1]="Normal",Fs[Fs.Large=4]="Large",Fs[Fs.Special=9]="Special";var Zs=rl,Ks=function(){function t(e){S(this,t),this.curBuletCount=0,this.lastShootTime=0,this._fireSpeed=1,this.user=e}return C(t,[{key:"resetStatus",value:function(){this._lockKind=null,this._isMouseDown=!1,this.targetFish=null}},{key:"clone",value:function(){var e=new t(this.user);return e.lastShootTime=this.lastShootTime,e.targetFish=this.targetFish,e.canShoot=this.canShoot,e.gunRotation=this.user.gun.serverRotation,e._fireSpeed=this._fireSpeed,e._isMouseDown=this._isMouseDown,e._isAutoFire=this._isAutoFire,e._lockKind=this._lockKind,e}},{key:"fireSpeed",set:function(e){this.user.gun&&(this._fireSpeed=-1!=e?e:2*this._fireSpeed,5<this._fireSpeed&&(this._fireSpeed=1),this.user.isSelf&&(this.user.fight.view.fire_speed_clip.index=Math.floor(this._fireSpeed/2),this.user.fight.view.speed_btn.getChildByName("effect").visible=0<this.user.fight.view.fire_speed_clip.index))},get:function(){return this._fireSpeed}},{key:"isMouseDown",set:function(e){this._isMouseDown=e},get:function(){return this._isMouseDown}},{key:"isAutoFire",set:function(e){this._isAutoFire=e,this.user.isSelf&&(this.user.fight.view.auto_fire_btn.getChildByName("effect").visible=e)},get:function(){return this._isAutoFire}},{key:"lockKind",set:function(e){this.user.status.targetFish=null,this._lockKind=e,this.user.isSelf&&(this.user.fight.view.lock_big_btn.getChildByName("effect").visible=e==Zs.Large,this.user.fight.view.lock_special_btn.getChildByName("effect").visible=e==Zs.Special,this.user.fight.view.lock_cancel_btn.disabled=null==e)},get:function(){return this._lockKind}}]),t}(),Qs=function(){function s(){S(this,s)}return C(s,null,[{key:"isContainChinese",value:function(e){return/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(e)}},{key:"getStringWidth",value:function(e,t){var n,i,a;30===t&&(n=17,i=19,a=30);for(var r=0,o=0;o<e.length;o++)s.isContainChinese(e[o])?r+=a:e[o].toUpperCase()==e[o]?r+=i:r+=n;return r}},{key:"getStringLength",value:function(e){for(var t=0,n=0;n<e.length;n++)s.isContainChinese(e[n])?t+=2:t+=1;return t}},{key:"briefString",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"...";if(!e)return"";var i="",a=0,r=c(e.split(""));try{for(r.s();!(o=r.n()).done;){var o=o.value;if(t<a){i+=n;break}i+=o,s.isContainChinese(o)?a+=2:a+=1}}catch(e){r.e(e)}finally{r.f()}return i}},{key:"endWith",value:function(e,t){var n=e.length-t.length;return 0<=n&&e.lastIndexOf(t)==n}},{key:"getCenterStarString",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:9;return"1"!=Ai.getUrlParam("bb",Ai.getParentUrl())&&e==Si.data.account.nickname?t<e.length?e.substr(0,t)+"...":e:"****"+e.substr(Math.max(e.length-4,0),4)}}]),s}(),Js=function(){T(n,qn);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).status=new Ks(u(e)),e.noActionExitCountDown=0,e.noActionExitTimer=new Cn,e._coinGlobalPosition=new L,e._coinLabelGlobalPosition=new L,e._gunGlobalPosition=new L,e._selfGlobalPosition=new L,e.mousePoint=new L,e}return C(n,[{key:"setData",value:function(e,t){this.fight=e,this.member=t,this.money_lab=this.owner.getChildByName("user_info").getChildByName("money"),this.owner.getChildByName("user_info").getChildByName("nickname").text=Qs.getCenterStarString(t.nickname),this.lock_ui=this.owner.getChildByName("lock"),this.showWaitting(!1),this.showLoaction(),this.updateUserMoney(t.into_money),this.initGun(),this.initCross(),this.gun.serverRotation=this.member.lock_angle,this.bindEvent(),this.status.isLevelGame=!1,this.status.canShoot=!0,this.isSelf&&(this.startNoActionCountDown(),this.noticeSyncMyStatus())}},{key:"noticeSyncMyStatus",value:function(){var e,t,n=this.member.uid,i=this.status.fireSpeed,a=this.status.isMouseDown,r=this.status.lockKind,o=this.member.cannon_type,s=this.status.targetFish?this.status.targetFish.uniqueId:null,l=Vi.SyncMyUserStatus;this.member.cannon_type==fs.Free&&(e=this.gun.remain,t=this.gun.rate),zi.I.noticeSyncMyStatus({op:l,uid:n,fireSpeedLevel:i,isMouseDown:a,lockKind:r,cannon_type:o,freeGunRemainTime:e,freeGunRate:t,target:s})}},{key:"syncMyStatus",value:function(e){this.status.fireSpeed=e.fireSpeedLevel,this.status.isMouseDown=e.isMouseDown,this.status.isAutoFire=e.isAutoFire,this.status.lockKind=e.lockKind;var t=this.fight.fishScene.getFishByUniqueId(e.target);t&&this.gun.lockFish(t),e.cannon_type>=fs.Free&&(this.changeGunByType(e.cannon_type),e.cannon_type==fs.Free&&(this.gun.remain=e.freeGunRemainTime,this.gun.rate=e.freeGunRate))}},{key:"bindEvent",value:function(){Si.event.on(di.FishSwitchCannonResp,this,this.onSwitchCannonResp),Si.event.on(di.FishCustomEventResp,this,this.onCustomEventResp),Si.event.on(di.FishDummyShootStartResp,this,this.onDummyShootStartResp),Si.event.on(di.FishDummyShootStopResp,this,this.onDummyShootStopResp),Si.event.on(di.FishDummyFastShootResp,this,this.onDummyFastShootResp),Si.event.on(di.FishDummyLockFishResp,this,this.onDummyLockFishResp)}},{key:"initGun",value:function(){this.initGunLevelBtn(),this.changeGunByPrice(this.member.cannon_level),!this.member.is_shoot_stop&&this.member.is_dummy&&this.fight.isMaster&&(this.status.isMouseDown=!0)}},{key:"changeGunByPrice",value:function(e){this.gun&&this.gun.stop(),this.member.cannon_level=e;for(var t=0;t<this.fight.gameEnterResp.cannon_doubles.length;t++)this.fight.gameEnterResp.cannon_doubles[t]==this.member.cannon_level&&(this.member.cannon_type=t);this.checkGunTypeBtn(),this.changeGunSkin(this.member.cannon_type)}},{key:"changeGunByType",value:function(e,t){e!=this.member.cannon_type&&(this.gun&&this.gun.stop(),this.member.cannon_type=e,this.add_gun_btn.visible=!1,this.sub_gun_btn.visible=!1,this.changeGunSkin(e,t))}},{key:"changeGunSkin",value:function(e,t){var n=this.owner.getChildByName("weapon").getChildByName("gun"),i=n.parent,a=this.gun?this.gun.serverRotation:n.rotation,r=new L(n.x,n.y),o=n.parent.getChildIndex(n);this.gun?this.gun.recover():n.removeSelf(),this.gun=this.createGun(e),this.gun.init(e,this,t),this.gun.name="gun",this.gun.addTo(i),this.gun.setIndex(o),this.gun.serverRotation=a,this.gun.pos(r.x,r.y)}},{key:"createGun",value:function(e){var t=wo.getItem("gun_type_"+e);return t||(e<=fs.Level_9?new gs:e==fs.Free?new Gs:e==fs.Electric?new Hs:e==fs.Rocket?new Ws:void 0)}},{key:"changeToNormalGun",value:function(){this.changeGunByPrice(this.member.cannon_level),this.noticeSyncMyStatus()}},{key:"initGunLevelBtn",value:function(){this.add_gun_btn=this.owner.getChildByName("weapon").getChildByName("add_gun_btn"),this.sub_gun_btn=this.owner.getChildByName("weapon").getChildByName("sub_gun_btn"),this.add_gun_btn.on(Je.CLICK,this,this.addGun),this.sub_gun_btn.on(Je.CLICK,this,this.subGun),this.sub_gun_btn.visible=this.isSelf,this.add_gun_btn.visible=this.isSelf}},{key:"checkGunTypeBtn",value:function(){this.isSelf&&(this.add_gun_btn.visible=!0,this.sub_gun_btn.visible=!0)}},{key:"addGun",value:function(){var e=this.member.cannon_type>=this.fight.gameEnterResp.cannon_doubles.length-1?0:this.member.cannon_type+1,t=new di.FishSwitchCannonReq;t.bulletPrice=0,t.bulletLv=this.fight.gameEnterResp.cannon_doubles[e],zi.I.send(t)}},{key:"subGun",value:function(){var e=0==this.member.cannon_type?this.fight.gameEnterResp.cannon_doubles.length-1:this.member.cannon_type-1,t=new di.FishSwitchCannonReq;t.bulletPrice=0,t.bulletLv=this.fight.gameEnterResp.cannon_doubles[e],zi.I.send(t)}},{key:"onSwitchCannonResp",value:function(e){e.uid==this.member.uid&&(this.changeGunByPrice(e.bulletPrice),this.member.cannon_level<=Si.data.account.bag_money&&(this.status.canShoot=!0))}},{key:"onDummyLockFishResp",value:function(e){this.member.uid==e.uid&&(0!=e.fishId?(this.status.isMouseDown=!0,this.status.lockKind=1==e.fishId?Zs.Large:Zs.Special):(this.status.isMouseDown=!0,this.gun.serverRotation=e.fishAngle))}},{key:"onDummyShootStartResp",value:function(e){this.member.uid==e.uid&&(this.status.isMouseDown=!0)}},{key:"onDummyShootStopResp",value:function(e){this.member.uid==e.uid&&(this.status.isMouseDown=!1)}},{key:"onDummyFastShootResp",value:function(e){this.member.uid==e.uid&&(this.status.fireSpeed=e.isFast?2:1,this.status.isMouseDown=!0)}},{key:"onCustomEventResp",value:function(e){var t=JSON.parse(e.info);if(t.op==Vi.RequestOtherUserStatus&&this.isSelf&&this.noticeSyncMyStatus(),t.uid==this.member.uid&&!this.isSelf)switch(t.op){case Vi.MouseDown:this.mousePoint.x=t.mouseX,this.mousePoint.y=t.mouseY,this.gun.onMouseDown();break;case Vi.MouseUp:this.mousePoint.x=t.mouseX,this.mousePoint.y=t.mouseY,this.gun.onMouseUp();break;case Vi.MouseMove:this.mousePoint.x=t.mouseX,this.mousePoint.y=t.mouseY,this.gun.onMouseMove();break;case Vi.ChangeSpeed:this.status.fireSpeed=t.speed;break;case Vi.ClickLockFishKindBtn:this.status.lockKind=t.value;break;case Vi.LockFish:var n=this.fight.fishScene.getFishByUniqueId(t.fishUniqueId);n&&this.gun.lockFish(n);break;case Vi.SyncMyUserStatus:this.syncMyStatus(t)}}},{key:"onUpdate",value:function(){if(this.member&&(!Si.DEBUG||this.member.uid==Si.data.account.userid)&&(this.gun.canLockTarget&&this.status.targetFish&&this.status.targetFish.lifeState==os.EnterScreen?this.updateTargetCorssPosition():this.hideTargetCross(),this.status.canShoot)){if(this.member.bag_money<this.member.cannon_level&&!this.gun.isFree()){if(this.status.canShoot=!1,this.isSelf)return void js.I.showInfo("您的金币不足");var e;this.member.is_dummy&&this.fight.isMaster&&((e=new di.FishNpcLeaveReq).npc_uid=this.member.uid,zi.I.send(e))}else this.status.canShoot=!0;10<=this.status.curBuletCount||this.gun.onUpdate()}}},{key:"startNoActionCountDown",value:function(){this.noActionExitCountDown=0,this.noActionExitTimer.clearAll(this),this.noActionExitTimer.loop(1e3,this,this.loopNoActionCountDown)}},{key:"loopNoActionCountDown",value:function(){this.status.lockKind?this.noActionExitCountDown=0:(this.noActionExitCountDown++,165==this.noActionExitCountDown&&qs.I.popup(),180==this.noActionExitCountDown&&(this.noActionExitTimer.clearAll(this),this.fight.exitGame()))}},{key:"stopNoActionCountDown",value:function(){this.noActionExitTimer.clearAll(this)}},{key:"initCross",value:function(){this.targetCross?this.hideTargetCross():this.targetCross=this.createTargetCross(),this.targetCross.skin=this.isSelf?"fishdld/fight/mainui/img_cross_1.png":"fishdld/fight/mainui/img_cross_2.png"}},{key:"createTargetCross",value:function(){var e=new pi;return e.zOrder=this.isSelf?2:1,e.anchorX=e.anchorY=.5,e.scale(1,1),e.visible=!1,this.fight.view.fight_layer.addChild(e),e}},{key:"playTargetCross",value:function(){var e=this;this.targetCross.frameOnce(1,this,function(){e.targetCross.visible=!0,e.targetCross.scale(3,3),pn.to(e.targetCross,{scaleX:1,scaleY:1},300,_n.sineInOut)})}},{key:"updateTargetCorssPosition",value:function(){Ti.temp0Vector2.setValue(this.status.targetFish.getFishScreenPosistion().x,this.status.targetFish.getFishScreenPosistion().y),this.gun.setDiretion(Ti.temp0Vector2.x,Ti.temp0Vector2.y),this.targetCross.pos(Ti.temp0Vector2.x,Ti.temp0Vector2.y),this.targetCross.visible=!0}},{key:"hideTargetCross",value:function(){this.targetCross.visible=!1}},{key:"showLockAnimation",value:function(){this.lock_ui.visible=!0,this.lock_ui.ani2.play(0,!1)}},{key:"hideLockAnimation",value:function(){this.isSelf&&(this.lock_ui.visible=!1)}},{key:"showLoaction",value:function(){var e,t;this.isSelf&&((e=this.owner.getChildByName("location")).visible=!0,e.ani1.play(0,!0),t=0,e.ani1.on(Je.COMPLETE,this,function(){2==++t&&(e.ani1.stop(),e.visible=!1)}))}},{key:"showWaitting",value:function(e){this.owner.getChildByName("weapon").visible=!e,this.owner.getChildByName("waiting").visible=e,this.owner.getChildByName("user_info").visible=!e}},{key:"setCountDownFireType",value:function(e){e==fs.Electric?this.owner.getChildByName("count_down_fire").getChildByName("type").skin="fishdld/fight/mainui/img_gun_7_tips.png":e==fs.Rocket&&(this.owner.getChildByName("count_down_fire").getChildByName("type").skin="fishdld/fight/mainui/img_gun_8_tips.png"),this.owner.getChildByName("count_down_fire").visible=!0}},{key:"setCountDownFireTime",value:function(e){this.owner.getChildByName("count_down_fire").getChildByName("time").text=e.toString()}},{key:"hideCountDownFire",value:function(){this.owner.getChildByName("count_down_fire").visible=!1}},{key:"addMoney",value:function(e){this.member.bag_money+=e,0<=this.member.bag_money&&(this.money_lab.text=this.member.bag_money.toFixed(2),this.isSelf&&(Si.data.account.bag_money=this.member.bag_money),1e3<e&&console.log("add",e))}},{key:"updateUserMoney",value:function(e){this.member.bag_money=e,this.money_lab.text=e.toFixed(2),this.isSelf&&(Si.data.account.bag_money=e)}},{key:"leaveGame",value:function(){var t=this;this.showWaitting(!0),Si.event.offAllCaller(this),this.status.resetStatus(),this.hideLockAnimation(),this.member&&(this.status.isLevelGame=!0,this.status.canShoot=!1,this.fight.users.remove(function(e){return e.member.uid==t.member.uid}),this.isSelf&&this.noActionExitTimer.clearAll(this))}},{key:"offLine",value:function(){this.status.canShoot=!1,this.member&&this.isSelf&&this.noActionExitTimer.clearAll(this)}},{key:"isSelf",get:function(){return this.member&&this.member.uid==Si.data.account.userid}},{key:"coinLabelGlobalPosition",get:function(){var e=this.owner.getChildByName("user_info").getChildByName("money");return this._coinLabelGlobalPosition.setTo(e.x,e.y),e.parent.localToGlobal(this._coinLabelGlobalPosition),this._coinLabelGlobalPosition}},{key:"coinGlobalPosition",get:function(){var e=this.owner.getChildByName("user_info").getChildByName("coin");return this._coinGlobalPosition.setTo(e.x,e.y),e.parent.localToGlobal(this._coinGlobalPosition),this._coinGlobalPosition}},{key:"globalPosition",get:function(){var e=this.owner;return this._selfGlobalPosition.setTo(e.x,e.y),e.parent.localToGlobal(this._selfGlobalPosition),this._selfGlobalPosition}},{key:"gunGlobalPosition",get:function(){var e=this.owner.getChildByName("weapon").getChildByName("gun");return this._gunGlobalPosition.setTo(e.x,e.y),e.parent.localToGlobal(this._gunGlobalPosition),this._gunGlobalPosition}}]),n}();Js.FIRE_SPEED=400;var $s=function(){function e(){S(this,e)}return C(e,null,[{key:"init",value:function(){var e=Dt.regClass;e("ui",ts),e("framework/view/ui/ScaleButton.ts",Zn),e("games/fishdld/scenes/fight/user/UserSeatScript.ts",Js)}}]),e}();$s.width=1136,$s.height=640,$s.scaleMode="fixedheight",$s.screenMode="horizontal",$s.alignV="middle",$s.alignH="center",$s.startScene="fishdld/animation/coin_rotation.scene",$s.sceneRoot="",$s.debug=!1,$s.stat=!1,$s.physicsDebug=!1,$s.exportSceneToJson=!0,$s.init();var el=function(){function e(){S(this,e),this._ownerPath=[],this._propertys=[],this._keyFrames=[]}return C(e,[{key:"_setOwnerPathCount",value:function(e){this._ownerPath.length=e}},{key:"_setOwnerPathByIndex",value:function(e,t){this._ownerPath[e]=t}},{key:"_joinOwnerPath",value:function(e){return this._ownerPath.join(e)}},{key:"_setPropertyCount",value:function(e){this._propertys.length=e}},{key:"_setPropertyByIndex",value:function(e,t){this._propertys[e]=t}},{key:"_joinProperty",value:function(e){return this._propertys.join(e)}},{key:"_setKeyframeCount",value:function(e){this._keyFrames.length=e}},{key:"_setKeyframeByIndex",value:function(e,t){this._keyFrames[e]=t}},{key:"getOwnerPathByIndex",value:function(e){return this._ownerPath[e]}},{key:"getPropertyByIndex",value:function(e){return this._propertys[e]}},{key:"getKeyframeByIndex",value:function(e){return this._keyFrames[e]}},{key:"ownerPathCount",get:function(){return this._ownerPath.length}},{key:"propertyCount",get:function(){return this._propertys.length}},{key:"keyFramesCount",get:function(){return this._keyFrames.length}}]),e}();function tl(){S(this,tl)}window.conch&&window.conchKeyframeNode&&(el=window.conchKeyframeNode),window.qq&&window.qq.webglPlus&&(el=window.qq.webglPlus.conchKeyframeNode);var nl=function(){function t(){S(this,t)}return C(t,[{key:"cloneTo",value:function(e){e.time=this.time}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}}]),t}(),il=function(){T(t,nl);var e=b(t);function t(){return S(this,t),e.call(this)}return C(t,[{key:"cloneTo",value:function(e){G(z(t.prototype),"cloneTo",this).call(this,e);e.inTangent=this.inTangent,e.outTangent=this.outTangent,e.value=this.value}}]),t}();window.conch&&window.conchFloatKeyframe&&(il=window.conchFloatKeyframe),window.qq&&window.qq.webglPlus&&(il=window.qq.webglPlus.conchFloatKeyframe);var al=function(){T(n,nl);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).inTangent=new yn,e.outTangent=new yn,e.value=new xi,e}return C(n,[{key:"cloneTo",value:function(e){G(z(n.prototype),"cloneTo",this).call(this,e);this.inTangent.cloneTo(e.inTangent),this.outTangent.cloneTo(e.outTangent),this.value.cloneTo(e.value)}}]),n}();window.conch&&window.conchFloatArrayKeyframe&&(al=window.conchFloatArrayKeyframe),window.qq&&window.qq.webglPlus&&(al=window.qq.webglPlus.conchFloatArrayKeyframe);var rl,ol=function(){T(n,nl);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).inTangent=new vn,e.outTangent=new vn,e.value=new vn,e}return C(n,[{key:"cloneTo",value:function(e){G(z(n.prototype),"cloneTo",this).call(this,e);this.inTangent.cloneTo(e.inTangent),this.outTangent.cloneTo(e.outTangent),this.value.cloneTo(e.value)}}]),n}();window.conch&&window.conchFloatArrayKeyframe&&(ol=window.conchFloatArrayKeyframe),window.qq&&window.qq.webglPlus&&(ol=window.qq.webglPlus.conchFloatArrayKeyframe),(rl=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;S(this,r);var a=this.elements=new Float32Array(4);a[0]=e,a[1]=t,a[2]=n,a[3]=i}return C(r,[{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.elements[0]=e[t+0],this.elements[1]=e[t+1],this.elements[2]=e[t+2],this.elements[3]=e[t+3]}},{key:"cloneTo",value:function(e){var t=e.elements,e=this.elements;t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]}},{key:"clone",value:function(){var e=new r;return this.cloneTo(e),e}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"x",get:function(){return this.elements[0]},set:function(e){this.elements[0]=e}},{key:"y",get:function(){return this.elements[1]},set:function(e){this.elements[1]=e}},{key:"z",get:function(){return this.elements[2]},set:function(e){this.elements[2]=e}},{key:"w",get:function(){return this.elements[3]},set:function(e){this.elements[3]=e}}],[{key:"lerp",value:function(e,t,n,i){var a=i.elements,r=e.elements,o=t.elements,i=r[0],e=r[1],t=r[2],r=r[3];a[0]=i+n*(o[0]-i),a[1]=e+n*(o[1]-e),a[2]=t+n*(o[2]-t),a[3]=r+n*(o[3]-r)}},{key:"transformByM4x4",value:function(e,t,n){var i=e.elements,a=i[0],r=i[1],e=i[2],i=i[3],t=t.elements,n=n.elements;n[0]=a*t[0]+r*t[4]+e*t[8]+i*t[12],n[1]=a*t[1]+r*t[5]+e*t[9]+i*t[13],n[2]=a*t[2]+r*t[6]+e*t[10]+i*t[14],n[3]=a*t[3]+r*t[7]+e*t[11]+i*t[15]}},{key:"equals",value:function(e,t){e=e.elements,t=t.elements;return fn.nearEqual(Math.abs(e[0]),Math.abs(t[0]))&&fn.nearEqual(Math.abs(e[1]),Math.abs(t[1]))&&fn.nearEqual(Math.abs(e[2]),Math.abs(t[2]))&&fn.nearEqual(Math.abs(e[3]),Math.abs(t[3]))}},{key:"normalize",value:function(e,t){var n=e.elements,t=t.elements,e=e.length();0<e&&(t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e)}},{key:"add",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3]}},{key:"subtract",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3]}},{key:"multiply",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n[3]=e[3]*t[3]}},{key:"scale",value:function(e,t,n){n=n.elements,e=e.elements;n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t}},{key:"Clamp",value:function(e,t,n,i){var a=e.elements,r=a[0],o=a[1],s=a[2],l=a[3],h=t.elements,u=h[0],d=h[1],c=h[2],e=h[3],a=n.elements,t=a[0],h=a[1],n=a[2],a=a[3],i=i.elements;r=(r=t<r?t:r)<u?u:r,o=(o=h<o?h:o)<d?d:o,s=(s=n<s?n:s)<c?c:s,l=(l=a<l?a:l)<e?e:l,i[0]=r,i[1]=o,i[2]=s,i[3]=l}},{key:"distanceSquared",value:function(e,t){var n=e.elements,i=t.elements,a=n[0]-i[0],e=n[1]-i[1],t=n[2]-i[2],i=n[3]-i[3];return a*a+e*e+t*t+i*i}},{key:"distance",value:function(e,t){var n=e.elements,i=t.elements,a=n[0]-i[0],e=n[1]-i[1],t=n[2]-i[2],i=n[3]-i[3];return Math.sqrt(a*a+e*e+t*t+i*i)}},{key:"dot",value:function(e,t){e=e.elements,t=t.elements;return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}},{key:"min",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n[3]=Math.min(e[3],t[3])}},{key:"max",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n[3]=Math.max(e[3],t[3])}}]),r}()).ZERO=new rl,rl.ONE=new rl(1,1,1,1),rl.UnitX=new rl(1,0,0,0),rl.UnitY=new rl(0,1,0,0),rl.UnitZ=new rl(0,0,1,0),rl.UnitW=new rl(0,0,0,1);var sl=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;S(this,a),i=i||new Float32Array(3),(this.elements=i)[0]=e,i[1]=t,i[2]=n}return C(a,[{key:"setValue",value:function(e,t,n){this.elements[0]=e,this.elements[1]=t,this.elements[2]=n}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.elements[0]=e[t+0],this.elements[1]=e[t+1],this.elements[2]=e[t+2]}},{key:"cloneTo",value:function(e){var t=e.elements,e=this.elements;t[0]=e[0],t[1]=e[1],t[2]=e[2]}},{key:"clone",value:function(){var e=new a;return this.cloneTo(e),e}},{key:"toDefault",value:function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0}},{key:"x",get:function(){return this.elements[0]},set:function(e){this.elements[0]=e}},{key:"y",get:function(){return this.elements[1]},set:function(e){this.elements[1]=e}},{key:"z",get:function(){return this.elements[2]},set:function(e){this.elements[2]=e}}],[{key:"distanceSquared",value:function(e,t){var n=e.elements,i=t.elements,e=n[0]-i[0],t=n[1]-i[1],i=n[2]-i[2];return e*e+t*t+i*i}},{key:"distance",value:function(e,t){var n=e.elements,i=t.elements,e=n[0]-i[0],t=n[1]-i[1],i=n[2]-i[2];return Math.sqrt(e*e+t*t+i*i)}},{key:"min",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2])}},{key:"max",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2])}},{key:"transformQuat",value:function(e,t,n){var i=n.elements,a=e.elements,r=t.elements,o=a[0],s=a[1],l=a[2],h=r[0],u=r[1],n=r[2],e=r[3],t=e*o+u*l-n*s,a=e*s+n*o-h*l,r=e*l+h*s-u*o,l=-h*o-u*s-n*l;i[0]=t*e+l*-h+a*-n-r*-u,i[1]=a*e+l*-u+r*-h-t*-n,i[2]=r*e+l*-n+t*-u-a*-h}},{key:"scalarLength",value:function(e){var t=e.elements,n=t[0],e=t[1],t=t[2];return Math.sqrt(n*n+e*e+t*t)}},{key:"scalarLengthSquared",value:function(e){var t=e.elements,n=t[0],e=t[1],t=t[2];return n*n+e*e+t*t}},{key:"normalize",value:function(e,t){var n=e.elements,i=t.elements,a=n[0],e=n[1],t=n[2],t=a*a+e*e+t*t;0<t&&(t=1/Math.sqrt(t),i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t)}},{key:"multiply",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2]}},{key:"scale",value:function(e,t,n){n=n.elements,e=e.elements;n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t}},{key:"lerp",value:function(e,t,n,i){var a=i.elements,r=e.elements,i=t.elements,e=r[0],t=r[1],r=r[2];a[0]=e+n*(i[0]-e),a[1]=t+n*(i[1]-t),a[2]=r+n*(i[2]-r)}},{key:"transformV3ToV3",value:function(e,t,n){var i=a._tempVector4;a.transformV3ToV4(e,t,i);i=i.elements,n=n.elements;n[0]=i[0],n[1]=i[1],n[2]=i[2]}},{key:"transformV3ToV4",value:function(e,t,n){var i=e.elements,a=i[0],e=i[1],i=i[2],t=t.elements,n=n.elements;n[0]=a*t[0]+e*t[4]+i*t[8]+t[12],n[1]=a*t[1]+e*t[5]+i*t[9]+t[13],n[2]=a*t[2]+e*t[6]+i*t[10]+t[14],n[3]=a*t[3]+e*t[7]+i*t[11]+t[15]}},{key:"TransformNormal",value:function(e,t,n){var i=e.elements,a=i[0],e=i[1],i=i[2],t=t.elements,n=n.elements;n[0]=a*t[0]+e*t[4]+i*t[8],n[1]=a*t[1]+e*t[5]+i*t[9],n[2]=a*t[2]+e*t[6]+i*t[10]}},{key:"transformCoordinate",value:function(e,t,n){var i=e.elements,a=i[0],r=i[1],e=i[2],i=t.elements,t=a*i[3]+r*i[7]+e*i[11]+i[15],n=n.elements;n[0]=a*i[0]+r*i[4]+e*i[8]+i[12]/t,n[1]=a*i[1]+r*i[5]+e*i[9]+i[13]/t,n[2]=a*i[2]+r*i[6]+e*i[10]+i[14]/t}},{key:"Clamp",value:function(e,t,n,i){var a=e.elements,r=a[0],o=a[1],s=a[2],l=t.elements,h=l[0],e=l[1],a=l[2],t=n.elements,l=t[0],n=t[1],t=t[2],i=i.elements;r=(r=l<r?l:r)<h?h:r,o=(o=n<o?n:o)<e?e:o,s=(s=t<s?t:s)<a?a:s,i[0]=r,i[1]=o,i[2]=s}},{key:"add",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2]}},{key:"subtract",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2]}},{key:"cross",value:function(e,t,n){var i=e.elements,a=t.elements,r=n.elements,o=i[0],e=i[1],t=i[2],n=a[0],i=a[1],a=a[2];r[0]=e*a-t*i,r[1]=t*n-o*a,r[2]=o*i-e*n}},{key:"dot",value:function(e,t){e=e.elements,t=t.elements;return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}},{key:"equals",value:function(e,t){e=e.elements,t=t.elements;return fn.nearEqual(e[0],t[0])&&fn.nearEqual(e[1],t[1])&&fn.nearEqual(e[2],t[2])}}]),a}();sl._tempVector4=new rl,sl.ZERO=new sl(0,0,0),sl.ONE=new sl(1,1,1),sl.NegativeUnitX=new sl(-1,0,0),sl.UnitX=new sl(1,0,0),sl.UnitY=new sl(0,1,0),sl.UnitZ=new sl(0,0,1),sl.ForwardRH=new sl(0,0,-1),sl.ForwardLH=new sl(0,0,1),sl.Up=new sl(0,1,0),sl.NAN=new sl(NaN,NaN,NaN);var ll=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;S(this,r),(a=a||new Float32Array(4))[0]=e,a[1]=t,a[2]=n,a[3]=i,this.elements=a}return C(r,[{key:"scaling",value:function(e,t){var n=t.elements,t=this.elements;n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e}},{key:"normalize",value:function(e){r._normalizeArray(this.elements,e.elements)}},{key:"length",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],e=e[3];return Math.sqrt(t*t+n*n+i*i+e*e)}},{key:"rotateX",value:function(e,t){var n=t.elements,i=this.elements;e*=.5;var a=i[0],r=i[1],o=i[2],t=i[3],i=Math.sin(e),e=Math.cos(e);n[0]=a*e+t*i,n[1]=r*e+o*i,n[2]=o*e-r*i,n[3]=t*e-a*i}},{key:"rotateY",value:function(e,t){var n=t.elements,i=this.elements;e*=.5;var a=i[0],r=i[1],o=i[2],t=i[3],i=Math.sin(e),e=Math.cos(e);n[0]=a*e-o*i,n[1]=r*e+t*i,n[2]=o*e+a*i,n[3]=t*e-r*i}},{key:"rotateZ",value:function(e,t){var n=t.elements,i=this.elements;e*=.5;var a=i[0],r=i[1],o=i[2],t=i[3],i=Math.sin(e),e=Math.cos(e);n[0]=a*e+r*i,n[1]=r*e-a*i,n[2]=o*e+t*i,n[3]=t*e-o*i}},{key:"getYawPitchRoll",value:function(e){sl.transformQuat(sl.ForwardRH,this,r.TEMPVector31),sl.transformQuat(sl.Up,this,r.TEMPVector32);var t=r.TEMPVector32.elements;r.angleTo(sl.ZERO,r.TEMPVector31,r.TEMPVector33);var n=r.TEMPVector33.elements;n[0]==Math.PI/2?(n[1]=r.arcTanAngle(t[2],t[0]),n[2]=0):n[0]==-Math.PI/2?(n[1]=r.arcTanAngle(-t[2],-t[0]),n[2]=0):(ki.createRotationY(-n[1],r.TEMPMatrix0),ki.createRotationX(-n[0],r.TEMPMatrix1),sl.transformCoordinate(r.TEMPVector32,r.TEMPMatrix0,r.TEMPVector32),sl.transformCoordinate(r.TEMPVector32,r.TEMPMatrix1,r.TEMPVector32),n[2]=r.arcTanAngle(t[1],-t[0])),n[1]<=-Math.PI&&(n[1]=Math.PI),n[2]<=-Math.PI&&(n[2]=Math.PI),n[1]>=Math.PI&&n[2]>=Math.PI&&(n[1]=0,n[2]=0,n[0]=Math.PI-n[0]);e=e.elements;e[0]=n[1],e[1]=n[0],e[2]=n[2]}},{key:"invert",value:function(e){var t=e.elements,n=this.elements,i=n[0],a=n[1],r=n[2],e=n[3],n=i*i+a*a+r*r+e*e,n=n?1/n:0;t[0]=-i*n,t[1]=-a*n,t[2]=-r*n,t[3]=e*n}},{key:"identity",value:function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=1}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.elements[0]=e[t+0],this.elements[1]=e[t+1],this.elements[2]=e[t+2],this.elements[3]=e[t+3]}},{key:"cloneTo",value:function(e){var t,n=this.elements,i=e.elements;if(n!==i)for(t=0;t<4;++t)i[t]=n[t]}},{key:"clone",value:function(){var e=new r;return this.cloneTo(e),e}},{key:"equals",value:function(e){var t=this.elements,e=e.elements;return fn.nearEqual(t[0],e[0])&&fn.nearEqual(t[1],e[1])&&fn.nearEqual(t[2],e[2])&&fn.nearEqual(t[3],e[3])}},{key:"lengthSquared",value:function(){var e=this.elements[0],t=this.elements[1],n=this.elements[2],i=this.elements[3];return e*e+t*t+n*n+i*i}},{key:"x",get:function(){return this.elements[0]},set:function(e){this.elements[0]=e}},{key:"y",get:function(){return this.elements[1]},set:function(e){this.elements[1]=e}},{key:"z",get:function(){return this.elements[2]},set:function(e){this.elements[2]=e}},{key:"w",get:function(){return this.elements[3]},set:function(e){this.elements[3]=e}}],[{key:"_dotArray",value:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}},{key:"_normalizeArray",value:function(e,t){var n=e[0],i=e[1],a=e[2],r=e[3],e=n*n+i*i+a*a+r*r;0<e&&(e=1/Math.sqrt(e),t[0]=n*e,t[1]=i*e,t[2]=a*e,t[3]=r*e)}},{key:"_lerpArray",value:function(e,t,n,i){var a=1-n;0<=r._dotArray(e,t)?(i[0]=a*e[0]+n*t[0],i[1]=a*e[1]+n*t[1],i[2]=a*e[2]+n*t[2],i[3]=a*e[3]+n*t[3]):(i[0]=a*e[0]-n*t[0],i[1]=a*e[1]-n*t[1],i[2]=a*e[2]-n*t[2],i[3]=a*e[3]-n*t[3]),r._normalizeArray(i,i)}},{key:"createFromYawPitchRoll",value:function(e,t,n,i){var a=.5*n,r=.5*t,o=.5*e,n=Math.sin(a),t=Math.cos(a),e=Math.sin(r),a=Math.cos(r),r=Math.sin(o),o=Math.cos(o),i=i.elements;i[0]=o*e*t+r*a*n,i[1]=r*a*t-o*e*n,i[2]=o*a*n-r*e*t,i[3]=o*a*t+r*e*n}},{key:"multiply",value:function(e,t,n){var i=e.elements,a=t.elements,r=n.elements,o=i[0],s=i[1],l=i[2],h=i[3],u=a[0],d=a[1],c=a[2],e=a[3],t=s*c-l*d,n=l*u-o*c,i=o*d-s*u,a=o*u+s*d+l*c;r[0]=o*e+u*h+t,r[1]=s*e+d*h+n,r[2]=l*e+c*h+i,r[3]=h*e-a}},{key:"arcTanAngle",value:function(e,t){return 0==e?1==t?Math.PI/2:-Math.PI/2:0<e?Math.atan(t/e):e<0?0<t?Math.atan(t/e)+Math.PI:Math.atan(t/e)-Math.PI:0}},{key:"angleTo",value:function(e,t,n){sl.subtract(t,e,r.TEMPVector30),sl.normalize(r.TEMPVector30,r.TEMPVector30),n.elements[0]=Math.asin(r.TEMPVector30.y),n.elements[1]=r.arcTanAngle(-r.TEMPVector30.z,-r.TEMPVector30.x)}},{key:"createFromAxisAngle",value:function(e,t,n){var i=n.elements,n=e.elements;t*=.5;e=Math.sin(t);i[0]=e*n[0],i[1]=e*n[1],i[2]=e*n[2],i[3]=Math.cos(t)}},{key:"createFromMatrix3x3",value:function(e,t){var n,i=t.elements,a=e.elements,r=a[0]+a[4]+a[8];0<r?(n=Math.sqrt(r+1),i[3]=.5*n,n=.5/n,i[0]=(a[5]-a[7])*n,i[1]=(a[6]-a[2])*n,i[2]=(a[1]-a[3])*n):(t=0,a[4]>a[0]&&(t=1),e=((t=a[8]>a[3*t+t]?2:t)+1)%3,r=(t+2)%3,n=Math.sqrt(a[3*t+t]-a[3*e+e]-a[3*r+r]+1),i[t]=.5*n,n=.5/n,i[3]=(a[3*e+r]-a[3*r+e])*n,i[e]=(a[3*e+t]+a[3*t+e])*n,i[r]=(a[3*r+t]+a[3*t+r])*n)}},{key:"createFromMatrix4x4",value:function(e,t){var n,i,a=e.elements,e=t.elements,t=a[0]+a[5]+a[10];0<t?(n=Math.sqrt(t+1),e[3]=.5*n,n=.5/n,e[0]=(a[6]-a[9])*n,e[1]=(a[8]-a[2])*n,e[2]=(a[1]-a[4])*n):a[0]>=a[5]&&a[0]>=a[10]?(i=.5/(n=Math.sqrt(1+a[0]-a[5]-a[10])),e[0]=.5*n,e[1]=(a[1]+a[4])*i,e[2]=(a[2]+a[8])*i,e[3]=(a[6]-a[9])*i):a[5]>a[10]?(i=.5/(n=Math.sqrt(1+a[5]-a[0]-a[10])),e[0]=(a[4]+a[1])*i,e[1]=.5*n,e[2]=(a[9]+a[6])*i,e[3]=(a[8]-a[2])*i):(i=.5/(n=Math.sqrt(1+a[10]-a[0]-a[5])),e[0]=(a[8]+a[2])*i,e[1]=(a[9]+a[6])*i,e[2]=.5*n,e[3]=(a[1]-a[4])*i)}},{key:"slerp",value:function(e,t,n,i){var a,r=e.elements,o=t.elements,s=i.elements,l=r[0],h=r[1],u=r[2],d=r[3],c=o[0],e=o[1],t=o[2],i=o[3],r=l*c+h*e+u*t+d*i;return r<0&&(r=-r,c=-c,e=-e,t=-t,i=-i),n=1e-6<1-r?(o=Math.acos(r),r=Math.sin(o),a=Math.sin((1-n)*o)/r,Math.sin(n*o)/r):(a=1-n,n),s[0]=a*l+n*c,s[1]=a*h+n*e,s[2]=a*u+n*t,s[3]=a*d+n*i,s}},{key:"lerp",value:function(e,t,n,i){r._lerpArray(e.elements,t.elements,n,i.elements)}},{key:"add",value:function(e,t,n){n=n.elements,e=e.elements,t=t.elements;n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3]}},{key:"dot",value:function(e,t){return r._dotArray(e.elements,t.elements)}},{key:"rotationLookAt",value:function(e,t,n){r.lookAt(sl.ZERO,e,t,n)}},{key:"lookAt",value:function(e,t,n,i){mi.lookAt(e,t,n,r._tempMatrix3x3),r.rotationMatrix(r._tempMatrix3x3,i)}},{key:"invert",value:function(e,t){var n=e.elements,t=t.elements,e=e.lengthSquared();fn.isZero(e)||(e=1/e,t[0]=-n[0]*e,t[1]=-n[1]*e,t[2]=-n[2]*e,t[3]=n[3]*e)}},{key:"rotationMatrix",value:function(e,t){var n,i,a=e.elements,r=a[0],o=a[1],s=a[2],l=a[3],h=a[4],u=a[5],d=a[6],c=a[7],e=a[8],a=t.elements,t=r+h+e;0<t?(n=Math.sqrt(t+1),a[3]=.5*n,n=.5/n,a[0]=(u-c)*n,a[1]=(d-s)*n,a[2]=(o-l)*n):h<=r&&e<=r?(i=.5/(n=Math.sqrt(1+r-h-e)),a[0]=.5*n,a[1]=(o+l)*i,a[2]=(s+d)*i,a[3]=(u-c)*i):e<h?(i=.5/(n=Math.sqrt(1+h-r-e)),a[0]=(l+o)*i,a[1]=.5*n,a[2]=(c+u)*i,a[3]=(d-s)*i):(i=.5/(n=Math.sqrt(1+e-r-h)),a[0]=(d+s)*i,a[1]=(c+u)*i,a[2]=.5*n,a[3]=(o-l)*i)}}]),r}();ll.TEMPVector30=new sl,ll.TEMPVector31=new sl,ll.TEMPVector32=new sl,ll.TEMPVector33=new sl,ll.TEMPMatrix0=new ki,ll.TEMPMatrix1=new ki,ll._tempMatrix3x3=new mi,ll.DEFAULT=new ll,ll.NAN=new ll(NaN,NaN,NaN,NaN);var hl=function(){function I(){S(this,I)}return C(I,null,[{key:"READ_DATA",value:function(){I._DATA.offset=I._reader.getUint32(),I._DATA.size=I._reader.getUint32()}},{key:"READ_BLOCK",value:function(){for(var e=I._BLOCK.count=I._reader.getUint16(),t=I._BLOCK.blockStarts=[],n=I._BLOCK.blockLengths=[],i=0;i<e;i++)t.push(I._reader.getUint32()),n.push(I._reader.getUint32())}},{key:"READ_STRINGS",value:function(){var e=I._reader.getUint32(),t=I._reader.getUint16(),n=I._reader.pos;I._reader.pos=e+I._DATA.offset;for(var i=0;i<t;i++)I._strings[i]=I._reader.readUTFString();I._reader.pos=n}},{key:"parse",value:function(e,t){I._animationClip=e;(I._reader=t).__getBuffer();I.READ_DATA(),I.READ_BLOCK(),I.READ_STRINGS();for(var n=0,i=I._BLOCK.count;n<i;n++){var a=t.getUint16(),r=I._strings[a],o=I["READ_"+r];if(null==o)throw new Error("model file err,no this function:"+a+" "+r);o.call(null)}}},{key:"READ_ANIMATIONS",value:function(){var e,t,n=I._reader,i=(n.__getBuffer(),[]),a=n.getUint16();for(i.length=a,d=0;d<a;d++)i[d]=n.getFloat32();var r=I._animationClip;r.name=I._strings[n.getUint16()];var o=r._duration=n.getFloat32();r.islooping=!!n.getByte(),r._frameRate=n.getInt16();var s=n.getInt16(),l=r._nodes;l.count=s;for(var h=r._nodesMap={},u=r._nodesDic={},d=0;d<s;d++){t=new el,l.setNodeByIndex(d,t),t._indexInList=d;var c=t.type=n.getUint8(),_=n.getUint16();for(t._setOwnerPathCount(_),e=0;e<_;e++)t._setOwnerPathByIndex(e,I._strings[n.getUint16()]);var f=t._joinOwnerPath("/"),g=h[f];g||(h[f]=g=[]),g.push(t),t.propertyOwner=I._strings[n.getUint16()];var y=n.getUint16();for(t._setPropertyCount(y),e=0;e<y;e++)t._setPropertyByIndex(e,I._strings[n.getUint16()]);f=f+"."+t.propertyOwner+"."+t._joinProperty(".");(u[f]=t).fullPath=f;var v=n.getUint16();switch(t._setKeyframeCount(v),c){case 0:break;case 1:case 3:case 4:t.data=new(yt.supportWebGLPlusAnimation?sl:vn);break;case 2:t.data=new(yt.supportWebGLPlusAnimation?ll:xi);break;default:throw"AnimationClipParser03:unknown type."}for(e=0;e<v;e++)switch(c){case 0:var p=new il;t._setKeyframeByIndex(e,p),p.time=i[n.getUint16()],p.inTangent=n.getFloat32(),p.outTangent=n.getFloat32(),p.value=n.getFloat32();break;case 1:case 3:case 4:p=new ol;if(t._setKeyframeByIndex(e,p),p.time=i[n.getUint16()],yt.supportWebGLPlusAnimation){for(var m=p.data=new Float32Array(9),w=0;w<3;w++)m[w]=n.getFloat32();for(w=0;w<3;w++)m[3+w]=n.getFloat32();for(w=0;w<3;w++)m[6+w]=n.getFloat32()}else{var x=p.inTangent,k=p.outTangent,T=p.value;x.x=n.getFloat32(),x.y=n.getFloat32(),x.z=n.getFloat32(),k.x=n.getFloat32(),k.y=n.getFloat32(),k.z=n.getFloat32(),T.x=n.getFloat32(),T.y=n.getFloat32(),T.z=n.getFloat32()}break;case 2:x=new al;if(t._setKeyframeByIndex(e,x),x.time=i[n.getUint16()],yt.supportWebGLPlusAnimation){for(m=x.data=new Float32Array(12),w=0;w<4;w++)m[w]=n.getFloat32();for(w=0;w<4;w++)m[4+w]=n.getFloat32();for(w=0;w<4;w++)m[8+w]=n.getFloat32()}else{k=x.inTangent,T=x.outTangent,x=x.value;k.x=n.getFloat32(),k.y=n.getFloat32(),k.z=n.getFloat32(),k.w=n.getFloat32(),T.x=n.getFloat32(),T.y=n.getFloat32(),T.z=n.getFloat32(),T.w=n.getFloat32(),x.x=n.getFloat32(),x.y=n.getFloat32(),x.z=n.getFloat32(),x.w=n.getFloat32()}break;default:throw"AnimationClipParser03:unknown type."}}var E=n.getUint16();for(d=0;d<E;d++){var M,b=new tl;b.time=Math.min(o,n.getFloat32()),b.eventName=I._strings[n.getUint16()];var S=n.getUint16();for(0<S&&(b.params=M=[]),e=0;e<S;e++)switch(n.getByte()){case 0:M.push(!!n.getByte());break;case 1:M.push(n.getInt32());break;case 2:M.push(n.getFloat32());break;case 3:M.push(I._strings[n.getUint16()]);break;default:throw new Error("unknown type.")}r.addEvent(b)}}}]),I}();hl._strings=[],hl._BLOCK={count:0},hl._DATA={offset:0,size:0};var ul=function(){function D(){S(this,D)}return C(D,null,[{key:"READ_DATA",value:function(){D._DATA.offset=D._reader.getUint32(),D._DATA.size=D._reader.getUint32()}},{key:"READ_BLOCK",value:function(){for(var e=D._BLOCK.count=D._reader.getUint16(),t=D._BLOCK.blockStarts=[],n=D._BLOCK.blockLengths=[],i=0;i<e;i++)t.push(D._reader.getUint32()),n.push(D._reader.getUint32())}},{key:"READ_STRINGS",value:function(){var e=D._reader.getUint32(),t=D._reader.getUint16(),n=D._reader.pos;D._reader.pos=e+D._DATA.offset;for(var i=0;i<t;i++)D._strings[i]=D._reader.readUTFString();D._reader.pos=n}},{key:"parse",value:function(e,t,n){D._animationClip=e,D._reader=t,D._version=n,D.READ_DATA(),D.READ_BLOCK(),D.READ_STRINGS();for(var i=0,a=D._BLOCK.count;i<a;i++){var r=t.getUint16(),o=D._strings[r],s=D["READ_"+o];if(null==s)throw new Error("model file err,no this function:"+r+" "+o);s.call(null)}D._version=null,D._reader=null,D._animationClip=null}},{key:"READ_ANIMATIONS",value:function(){var e,t,n=D._reader,i=(n.__getBuffer(),[]),a=n.getUint16();for(i.length=a,d=0;d<a;d++)i[d]=n.getFloat32();var r=D._animationClip;r.name=D._strings[n.getUint16()];var o=r._duration=n.getFloat32();r.islooping=!!n.getByte(),r._frameRate=n.getInt16();var s=n.getInt16(),l=r._nodes;l.count=s;for(var h=r._nodesMap={},u=r._nodesDic={},d=0;d<s;d++){t=new el,l.setNodeByIndex(d,t),t._indexInList=d;var c=t.type=n.getUint8(),_=n.getUint16();for(t._setOwnerPathCount(_),e=0;e<_;e++)t._setOwnerPathByIndex(e,D._strings[n.getUint16()]);var f=t._joinOwnerPath("/"),g=h[f];g||(h[f]=g=[]),g.push(t),t.propertyOwner=D._strings[n.getUint16()];var y=n.getUint16();for(t._setPropertyCount(y),e=0;e<y;e++)t._setPropertyByIndex(e,D._strings[n.getUint16()]);f=f+"."+t.propertyOwner+"."+t._joinProperty(".");(u[f]=t).fullPath=f;var v=n.getUint16();switch(t._setKeyframeCount(v),c){case 0:break;case 1:case 3:case 4:t.data=new(yt.supportWebGLPlusAnimation?sl:vn);break;case 2:t.data=new(yt.supportWebGLPlusAnimation?ll:xi);break;default:throw"AnimationClipParser04:unknown type."}switch(D._version){case"LAYAANIMATION:04":for(e=0;e<v;e++)switch(c){case 0:var p=new il;t._setKeyframeByIndex(e,p),p.time=i[n.getUint16()],p.inTangent=n.getFloat32(),p.outTangent=n.getFloat32(),p.value=n.getFloat32();break;case 1:case 3:case 4:var m=new ol;if(t._setKeyframeByIndex(e,m),m.time=i[n.getUint16()],yt.supportWebGLPlusAnimation){for(var w=m.data=new Float32Array(9),x=0;x<3;x++)w[x]=n.getFloat32();for(x=0;x<3;x++)w[3+x]=n.getFloat32();for(x=0;x<3;x++)w[6+x]=n.getFloat32()}else{var k=m.inTangent,T=m.outTangent,E=m.value;k.x=n.getFloat32(),k.y=n.getFloat32(),k.z=n.getFloat32(),T.x=n.getFloat32(),T.y=n.getFloat32(),T.z=n.getFloat32(),E.x=n.getFloat32(),E.y=n.getFloat32(),E.z=n.getFloat32()}break;case 2:var M=new al;if(t._setKeyframeByIndex(e,M),M.time=i[n.getUint16()],yt.supportWebGLPlusAnimation){for(w=M.data=new Float32Array(12),x=0;x<4;x++)w[x]=n.getFloat32();for(x=0;x<4;x++)w[4+x]=n.getFloat32();for(x=0;x<4;x++)w[8+x]=n.getFloat32()}else{var b=M.inTangent,S=M.outTangent,I=M.value;b.x=n.getFloat32(),b.y=n.getFloat32(),b.z=n.getFloat32(),b.w=n.getFloat32(),S.x=n.getFloat32(),S.y=n.getFloat32(),S.z=n.getFloat32(),S.w=n.getFloat32(),I.x=n.getFloat32(),I.y=n.getFloat32(),I.z=n.getFloat32(),I.w=n.getFloat32()}break;default:throw"AnimationClipParser04:unknown type."}break;case"LAYAANIMATION:COMPRESSION_04":for(e=0;e<v;e++)switch(c){case 0:p=new il,t._setKeyframeByIndex(e,p),p.time=i[n.getUint16()],p.inTangent=fo.convertToNumber(n.getUint16()),p.outTangent=fo.convertToNumber(n.getUint16()),p.value=fo.convertToNumber(n.getUint16());break;case 1:case 3:case 4:if(m=new ol,t._setKeyframeByIndex(e,m),m.time=i[n.getUint16()],yt.supportWebGLPlusAnimation){for(w=m.data=new Float32Array(9),x=0;x<3;x++)w[x]=fo.convertToNumber(n.getUint16());for(x=0;x<3;x++)w[3+x]=fo.convertToNumber(n.getUint16());for(x=0;x<3;x++)w[6+x]=fo.convertToNumber(n.getUint16())}else k=m.inTangent,T=m.outTangent,E=m.value,k.x=fo.convertToNumber(n.getUint16()),k.y=fo.convertToNumber(n.getUint16()),k.z=fo.convertToNumber(n.getUint16()),T.x=fo.convertToNumber(n.getUint16()),T.y=fo.convertToNumber(n.getUint16()),T.z=fo.convertToNumber(n.getUint16()),E.x=fo.convertToNumber(n.getUint16()),E.y=fo.convertToNumber(n.getUint16()),E.z=fo.convertToNumber(n.getUint16());break;case 2:if(M=new al,t._setKeyframeByIndex(e,M),M.time=i[n.getUint16()],yt.supportWebGLPlusAnimation){for(w=M.data=new Float32Array(12),x=0;x<4;x++)w[x]=fo.convertToNumber(n.getUint16());for(x=0;x<4;x++)w[4+x]=fo.convertToNumber(n.getUint16());for(x=0;x<4;x++)w[8+x]=fo.convertToNumber(n.getUint16())}else b=M.inTangent,S=M.outTangent,I=M.value,b.x=fo.convertToNumber(n.getUint16()),b.y=fo.convertToNumber(n.getUint16()),b.z=fo.convertToNumber(n.getUint16()),b.w=fo.convertToNumber(n.getUint16()),S.x=fo.convertToNumber(n.getUint16()),S.y=fo.convertToNumber(n.getUint16()),S.z=fo.convertToNumber(n.getUint16()),S.w=fo.convertToNumber(n.getUint16()),I.x=fo.convertToNumber(n.getUint16()),I.y=fo.convertToNumber(n.getUint16()),I.z=fo.convertToNumber(n.getUint16()),I.w=fo.convertToNumber(n.getUint16());break;default:throw"AnimationClipParser04:unknown type."}}}var N=n.getUint16();for(d=0;d<N;d++){var R,C=new tl;C.time=Math.min(o,n.getFloat32()),C.eventName=D._strings[n.getUint16()];var A=n.getUint16();for(0<A&&(C.params=R=[]),e=0;e<A;e++)switch(n.getByte()){case 0:R.push(!!n.getByte());break;case 1:R.push(n.getInt32());break;case 2:R.push(n.getFloat32());break;case 3:R.push(D._strings[n.getUint16()]);break;default:throw new Error("unknown type.")}r.addEvent(C)}}}]),D}();ul._strings=[],ul._BLOCK={count:0},ul._DATA={offset:0,size:0};var dl=function(){function e(){S(this,e),this._nodes=[]}return C(e,[{key:"getNodeByIndex",value:function(e){return this._nodes[e]}},{key:"setNodeByIndex",value:function(e,t){this._nodes[e]=t}},{key:"count",get:function(){return this._nodes.length},set:function(e){this._nodes.length=e}}]),e}();window.conch&&window.conchKeyframeNodeList&&(dl=window.conchKeyframeNodeList),window.qq&&window.qq.webglPlus&&(dl=window.qq.webglPlus.conchKeyframeNodeList);var cl=function(){T(w,V);var t=b(w);function w(){var e;return S(this,w),(e=t.call(this))._nodes=new dl,e._animationEvents=[],e}return C(w,[{key:"duration",value:function(){return this._duration}},{key:"_hermiteInterpolate",value:function(e,t,n,i){var a=e.outTangent,r=t.inTangent;if(Number.isFinite(a)&&Number.isFinite(r)){var o=n*n,s=o*n,l=s-2*o+n,h=s-o,n=-2*s+3*o;return(2*s-3*o+1)*e.value+l*a*i+h*r*i+n*t.value}return e.value}},{key:"_hermiteInterpolateVector3",value:function(e,t,n,i,a){var r=e.value,o=e.outTangent,s=t.value,l=t.inTangent,h=n*n,u=h*n,d=2*u-3*h+1,e=u-2*h+n,t=u-h,n=-2*u+3*h,u=o.x,h=l.x;Number.isFinite(u)&&Number.isFinite(h)?a.x=d*r.x+e*u*i+t*h*i+n*s.x:a.x=r.x,u=o.y,h=l.y,Number.isFinite(u)&&Number.isFinite(h)?a.y=d*r.y+e*u*i+t*h*i+n*s.y:a.y=r.y,u=o.z,h=l.z,Number.isFinite(u)&&Number.isFinite(h)?a.z=d*r.z+e*u*i+t*h*i+n*s.z:a.z=r.z}},{key:"_hermiteInterpolateQuaternion",value:function(e,t,n,i,a){var r=e.value,o=e.outTangent,s=t.value,l=t.inTangent,h=n*n,u=h*n,d=2*u-3*h+1,e=u-2*h+n,t=u-h,n=-2*u+3*h,u=o.x,h=l.x;Number.isFinite(u)&&Number.isFinite(h)?a.x=d*r.x+e*u*i+t*h*i+n*s.x:a.x=r.x,u=o.y,h=l.y,Number.isFinite(u)&&Number.isFinite(h)?a.y=d*r.y+e*u*i+t*h*i+n*s.y:a.y=r.y,u=o.z,h=l.z,Number.isFinite(u)&&Number.isFinite(h)?a.z=d*r.z+e*u*i+t*h*i+n*s.z:a.z=r.z,u=o.w,h=l.w,Number.isFinite(u)&&Number.isFinite(h)?a.w=d*r.w+e*u*i+t*h*i+n*s.w:a.w=r.w}},{key:"_evaluateClipDatasRealTime",value:function(e,t,n,i,a){for(var r=0,o=e.count;r<o;r++){var s,l=e.getNodeByIndex(r),h=l.type,u=l._keyFrames,d=u.length,c=n[r];if(a)for(-1!==c&&t<u[c].time&&(c=-1,n[r]=c),s=c+1;s<d&&!(u[s].time>t);)c++,s++,n[r]=c;else for((s=c+1)!==d&&t>u[s].time&&(c=d-1,n[r]=c),s=c+1;-1<c&&!(u[c].time<t);)c--,s--,n[r]=c;var _,f=s===d;switch(h){case 0:-1!==c?(_=u[c],f?l.data=_.value:(v=0!=(p=(m=u[s]).time-_.time)?(t-_.time)/p:0,l.data=this._hermiteInterpolate(_,m,v,p))):l.data=u[0].value,i&&(l.data-=u[0].value);break;case 1:case 4:var g,y=l.data;this._evaluateFrameNodeVector3DatasRealTime(u,c,f,t,y),i&&(g=u[0].value,y.x-=g.x,y.y-=g.y,y.z-=g.z);break;case 2:var v,p,m=l.data;this._evaluateFrameNodeQuaternionDatasRealTime(u,c,f,t,m),i&&(v=w._tempQuaternion0,p=u[0].value,ia.quaternionConjugate(p,v),xi.multiply(v,m,m));break;case 3:y=l.data,this._evaluateFrameNodeVector3DatasRealTime(u,c,f,t,y),i&&(g=u[0].value,y.x/=g.x,y.y/=g.y,y.z/=g.z);break;default:throw"AnimationClip:unknown node type."}}}},{key:"_evaluateClipDatasRealTimeForNative",value:function(e,t,n,i){P.instance.evaluateClipDatasRealTime(e._nativeObj,t,n,i)}},{key:"_evaluateFrameNodeVector3DatasRealTime",value:function(e,t,n,i,a){var r,o;-1!==t?(r=e[t],n?(o=r.value,a.x=o.x,a.y=o.y,a.z=o.z):(n=e[t+1],o=r.time,o=0!=(t=n.time-o)?(i-o)/t:0,this._hermiteInterpolateVector3(r,n,o,t,a))):(e=e[0].value,a.x=e.x,a.y=e.y,a.z=e.z)}},{key:"_evaluateFrameNodeQuaternionDatasRealTime",value:function(e,t,n,i,a){var r,o;-1!==t?(r=e[t],n?(o=r.value,a.x=o.x,a.y=o.y,a.z=o.z,a.w=o.w):(n=e[t+1],o=r.time,o=0!=(t=n.time-o)?(i-o)/t:0,this._hermiteInterpolateQuaternion(r,n,o,t,a))):(e=e[0].value,a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w)}},{key:"_binarySearchEventIndex",value:function(e){for(var t,n=0,i=this._animationEvents.length-1;n<=i;){t=Math.floor((n+i)/2);var a=this._animationEvents[t].time;if(a==e)return t;e<a?i=t-1:n=t+1}return n}},{key:"addEvent",value:function(e){var t=this._binarySearchEventIndex(e.time);this._animationEvents.splice(t,0,e)}},{key:"_disposeResource",value:function(){this._nodes=null,this._nodesMap=null}}],[{key:"_parse",value:function(e){var t=new w,n=new nn(e),i=n.readUTFString();switch(i){case"LAYAANIMATION:03":hl.parse(t,n);break;case"LAYAANIMATION:04":case"LAYAANIMATION:COMPRESSION_04":ul.parse(t,n,i);break;default:throw"unknown animationClip version."}return t}},{key:"load",value:function(e,t){M.loader.create(e,t,null,w.ANIMATIONCLIP)}}]),w}();cl.ANIMATIONCLIP="ANIMATIONCLIP",cl._tempQuaternion0=new xi;var _l=function e(){S(this,e),this.source=null,this.destination=null,this.camera=null,this.compositeShaderData=null,this.command=null,this.deferredReleaseTextures=[]},fl=function(){function s(){S(this,s),this._compositeShader=ca.find("PostProcessComposite"),this._compositeShaderData=new va,this._context=null,this._effects=[],this._context=new _l,this._context.compositeShaderData=this._compositeShaderData}return C(s,[{key:"_init",value:function(e,t){this._context.camera=e,this._context.command=t}},{key:"_render",value:function(){var e=va._SET_RUNTIME_VALUE_MODE_REFERENCE_;M.Render.supportWebGLPlusRendering&&va.setRuntimeValueMode(!1);var t=this._context.camera,n=Va.createFromPool(qa.clientWidth,qa.clientHeight,t._getRenderTextureFormat(),Y.DEPTHSTENCIL_NONE),i=t._renderTexture;this._context.command.clear(),this._context.source=n,this._context.destination=i,this._context.compositeShaderData.clearDefine(),this._context.command.blitScreenTriangle(i,n),this._context.compositeShaderData.setTexture(s.SHADERVALUE_AUTOEXPOSURETEX,X.whiteTexture);for(var a=0,r=this._effects.length;a<r;a++)this._effects[a].render(this._context);this._compositeShaderData.addDefine(s.SHADERDEFINE_FINALPASS);t=t.renderTarget,t=t||null;this._context.destination=t,this._context.command.blitScreenTriangle(this._context.source,t,this._compositeShader,this._compositeShaderData),Va.recoverToPool(n);for(var o=this._context.deferredReleaseTextures,a=0,r=o.length;a<r;a++)Va.recoverToPool(o[a]);o.length=0,M.Render.supportWebGLPlusRendering&&va.setRuntimeValueMode(e)}},{key:"addEffect",value:function(e){this._effects.push(e)}},{key:"removeEffect",value:function(e){e=this._effects.indexOf(e);-1!==e&&this._effects.splice(e,1)}}],[{key:"__init__",value:function(){s.SHADERDEFINE_BLOOM_LOW=ca.getDefineByName("BLOOM_LOW"),s.SHADERDEFINE_BLOOM=ca.getDefineByName("BLOOM"),s.SHADERDEFINE_FINALPASS=ca.getDefineByName("FINALPASS")}}]),s}();fl.SHADERVALUE_MAINTEX=ca.propertyNameToID("u_MainTex"),fl.SHADERVALUE_BLOOMTEX=ca.propertyNameToID("u_BloomTex"),fl.SHADERVALUE_AUTOEXPOSURETEX=ca.propertyNameToID("u_AutoExposureTex"),fl.SHADERVALUE_BLOOM_DIRTTEX=ca.propertyNameToID("u_Bloom_DirtTex"),fl.SHADERVALUE_BLOOMTEX_TEXELSIZE=ca.propertyNameToID("u_BloomTex_TexelSize"),fl.SHADERVALUE_BLOOM_DIRTTILEOFFSET=ca.propertyNameToID("u_Bloom_DirtTileOffset"),fl.SHADERVALUE_BLOOM_SETTINGS=ca.propertyNameToID("u_Bloom_Settings"),fl.SHADERVALUE_BLOOM_COLOR=ca.propertyNameToID("u_Bloom_Color");var gl=function(){T(s,d);var o=b(s);function s(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return S(this,s),(t=o.call(this))._owner=e,t._children=[],t._localMatrix=new Float32Array(16),yt.supportWebGLPlusAnimation?(t._localPosition=new sl(0,0,0,n),t._localRotation=new ll(0,0,0,1,i),t._localScale=new sl(0,0,0,a),t._worldMatrix=r):(t._localPosition=new vn,t._localRotation=new xi,t._localScale=new vn,t._worldMatrix=new Float32Array(16)),t._localQuaternionUpdate=!1,t._locaEulerlUpdate=!1,t._localUpdate=!1,t._worldUpdate=!0,t}return C(s,[{key:"_getlocalMatrix",value:function(){return this._localUpdate&&(ia._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix}},{key:"_onWorldTransform",value:function(){if(!this._worldUpdate){this._worldUpdate=!0,this.event(Je.TRANSFORM_CHANGED);for(var e=0,t=this._children.length;e<t;e++)this._children[e]._onWorldTransform()}}},{key:"getWorldMatrix",value:function(){var e;return!yt.supportWebGLPlusAnimation&&this._worldUpdate&&(null!=this._parent?ia.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix):((e=this._worldMatrix)[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1),this._worldUpdate=!1),yt.supportWebGLPlusAnimation&&this._worldUpdate&&(this._worldUpdate=!1),this._worldMatrix}},{key:"setParent",value:function(e){var t,n;this._parent!==e&&(this._parent&&(n=(t=this._parent._children).indexOf(this),t.splice(n,1)),e&&(e._children.push(this),e&&this._onWorldTransform()),this._parent=e)}},{key:"localPosition",get:function(){return this._localPosition},set:function(e){this._localPosition=e,this._localUpdate=!0,this._onWorldTransform()}},{key:"localRotation",get:function(){var e;return this._localQuaternionUpdate&&(e=this._localRotationEuler,xi.createFromYawPitchRoll(e.y/s._angleToRandin,e.x/s._angleToRandin,e.z/s._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1),this._localRotation},set:function(e){this._localRotation=e,this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform()}},{key:"localScale",get:function(){return this._localScale},set:function(e){this._localScale=e,this._localUpdate=!0,this._onWorldTransform()}},{key:"localRotationEuler",get:function(){var e,t;return this._locaEulerlUpdate&&(this._localRotation.getYawPitchRoll(s._tempVector3),e=s._tempVector3,(t=this._localRotationEuler).x=e.y*s._angleToRandin,t.y=e.x*s._angleToRandin,t.z=e.z*s._angleToRandin,this._locaEulerlUpdate=!1),this._localRotationEuler},set:function(e){this._localRotationEuler=e,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,this._onWorldTransform()}}]),s}();gl._tempVector3=new vn,gl._angleToRandin=180/Math.PI;var yl=function(){function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;S(this,l),this._children=[],this.transform=new gl(this,e,t,n,i)}return C(l,[{key:"addChild",value:function(e){e._parent=this,e.transform.setParent(this.transform),this._children.push(e)}},{key:"removeChild",value:function(e){e=this._children.indexOf(e);-1!==e&&this._children.splice(e,1)}},{key:"getChildByName",value:function(e){for(var t=0,n=this._children.length;t<n;t++){var i=this._children[t];if(i.name===e)return i}return null}},{key:"getChildByIndex",value:function(e){return this._children[e]}},{key:"getChildCount",value:function(){return this._children.length}},{key:"cloneTo",value:function(e){var t=e;t.name=this.name;for(var n=0,i=this._children.length;n<i;n++){var a=this._children[n],r=a.clone();t.addChild(r);var o=a.transform,s=r.transform,l=s.localPosition,a=s.localRotation,r=s.localScale;o.localPosition.cloneTo(l),o.localRotation.cloneTo(a),o.localScale.cloneTo(r),s.localPosition=l,s.localRotation=a,s.localScale=r}}},{key:"clone",value:function(){var e=new l;return this.cloneTo(e),e}},{key:"_cloneNative",value:function(e,t,n,i,a,r,o){var s=o._nativeCurCloneCount;a[s]=r;r=new l(new Float32Array(e.buffer,3*s*4,3),new Float32Array(t.buffer,4*s*4,4),new Float32Array(n.buffer,3*s*4,3),new Float32Array(i.buffer,16*s*4,16));return r._worldMatrixIndex=s,this._cloneToNative(r,e,t,n,i,a,s,o),r}},{key:"_cloneToNative",value:function(e,t,n,i,a,r,o,s){var l=e;l.name=this.name;for(var h=0,u=this._children.length;h<u;h++){var d=this._children[h];s._nativeCurCloneCount++;var c=d._cloneNative(t,n,i,a,r,o,s);l.addChild(c);var _=d.transform,f=c.transform,g=f.localPosition,d=f.localRotation,c=f.localScale;_.localPosition.cloneTo(g),_.localRotation.cloneTo(d),_.localScale.cloneTo(c),f.localPosition=g,f.localRotation=d,f.localScale=c}}}]),l}(),vl=function(){T(n,V);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._nativeNodeCount=0,e._nativeCurCloneCount=0,e}return C(n,[{key:"_initCloneToAnimator",value:function(e,t){for(var n=0,i=(t._avatarNodeMap[e.name]=e).getChildCount();n<i;n++)this._initCloneToAnimator(e.getChildByIndex(n),t)}},{key:"_parseNode",value:function(e,t){var n=e.props.name;t.name=n;var i=e.props,a=t.transform,r=a.localPosition,o=a.localRotation,n=a.localScale;r.fromArray(i.translate),o.fromArray(i.rotation),n.fromArray(i.scale),a.localPosition=r,a.localRotation=o,a.localScale=n;for(var s=e.child,l=0,h=s.length;l<h;l++){var u=s[l],d=new yl(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16));t.addChild(d),yt.supportWebGLPlusAnimation&&this._nativeNodeCount++,this._parseNode(u,d)}}},{key:"_cloneDatasToAnimator",value:function(e){var t=this._rootNode.clone(),n=this._rootNode.transform,i=t.transform,a=i.localPosition,r=i.localRotation,o=i.localScale;n.localPosition.cloneTo(a),n.localRotation.cloneTo(r),n.localScale.cloneTo(o),i.localPosition=a,i.localRotation=r,i.localScale=o,e._avatarNodeMap={},this._initCloneToAnimator(t,e)}},{key:"cloneTo",value:function(e){var t=e,e=this._rootNode.clone();t._rootNode=e}},{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"_cloneDatasToAnimatorNative",value:function(e){var t=new Float32Array(3*this._nativeNodeCount),n=new Float32Array(4*this._nativeNodeCount),i=new Float32Array(3*this._nativeNodeCount),a=new Float32Array(16*this._nativeNodeCount),r=new Int16Array(this._nativeNodeCount);e._animationNodeLocalPositions=t,e._animationNodeLocalRotations=n,e._animationNodeLocalScales=i,e._animationNodeWorldMatrixs=a,e._animationNodeParentIndices=r,this._nativeCurCloneCount=0;var o=this._rootNode._cloneNative(t,n,i,a,r,-1,this),t=this._rootNode.transform,n=o.transform,i=n.localPosition,a=n.localRotation,r=n.localScale;t.localPosition.cloneTo(i),t.localRotation.cloneTo(a),t.localScale.cloneTo(r),n.localPosition=i,n.localRotation=a,n.localScale=r,e._avatarNodeMap={},this._initCloneToAnimator(o,e)}}],[{key:"_parse",value:function(e){var t=new n;return t._rootNode=new yl(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16)),yt.supportWebGLPlusAnimation&&t._nativeNodeCount++,!e.version||(e=e.rootNode)&&t._parseNode(e,t._rootNode),t}},{key:"load",value:function(e,t){M.loader.create(e,t,null,n.AVATAR)}}]),n}();vl.AVATAR="AVATAR";var pl=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("Effect"),e._color=new yn(1,1,1,1),e._shaderValues.setVector(n.TINTCOLOR,new yn(1,1,1,1)),e.renderMode=n.RENDERMODE_ADDTIVE,e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"_TintColorR",get:function(){return this._color.x},set:function(e){this._color.x=e,this.color=this._color}},{key:"_TintColorG",get:function(){return this._color.y},set:function(e){this._color.y=e,this.color=this._color}},{key:"_TintColorB",get:function(){return this._color.z},set:function(e){this._color.z=e,this.color=this._color}},{key:"_TintColorA",get:function(){return this._color.w},set:function(e){this._color.w=e,this.color=this._color}},{key:"_MainTex_STX",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.x=e,this.tilingOffset=t}},{key:"_MainTex_STY",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.y=e,this.tilingOffset=t}},{key:"_MainTex_STZ",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.z=e,this.tilingOffset=t}},{key:"_MainTex_STW",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.w=e,this.tilingOffset=t}},{key:"renderMode",set:function(e){switch(e){case n.RENDERMODE_ADDTIVE:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_NONE,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.addDefine(n.SHADERDEFINE_ADDTIVEFOG);break;case n.RENDERMODE_ALPHABLENDED:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_NONE,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.removeDefine(n.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("MeshEffectMaterial : renderMode value error.")}}},{key:"colorR",get:function(){return this._TintColorR},set:function(e){this._TintColorR=e}},{key:"colorG",get:function(){return this._TintColorG},set:function(e){this._TintColorG=e}},{key:"colorB",get:function(){return this._TintColorB},set:function(e){this._TintColorB=e}},{key:"colorA",get:function(){return this._TintColorA},set:function(e){this._TintColorA=e}},{key:"color",get:function(){return this._shaderValues.getVector(n.TINTCOLOR)},set:function(e){this._shaderValues.setVector(n.TINTCOLOR,e)}},{key:"texture",get:function(){return this._shaderValues.getTexture(n.MAINTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_MAINTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(n.MAINTEXTURE,e)}},{key:"tilingOffsetX",get:function(){return this._MainTex_STX},set:function(e){this._MainTex_STX=e}},{key:"tilingOffsetY",get:function(){return this._MainTex_STY},set:function(e){this._MainTex_STY=e}},{key:"tilingOffsetZ",get:function(){return this._MainTex_STZ},set:function(e){this._MainTex_STZ=e}},{key:"tilingOffsetW",get:function(){return this._MainTex_STW},set:function(e){this._MainTex_STW=e}},{key:"tilingOffset",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET)},set:function(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(n.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(n.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,e)}},{key:"depthWrite",set:function(e){this._shaderValues.setBool(n.DEPTH_WRITE,e)},get:function(){return this._shaderValues.getBool(n.DEPTH_WRITE)}},{key:"cull",set:function(e){this._shaderValues.setInt(n.CULL,e)},get:function(){return this._shaderValues.getInt(n.CULL)}},{key:"blend",set:function(e){this._shaderValues.setInt(n.BLEND,e)},get:function(){return this._shaderValues.getInt(n.BLEND)}},{key:"blendSrc",set:function(e){this._shaderValues.setInt(n.BLEND_SRC,e)},get:function(){return this._shaderValues.getInt(n.BLEND_SRC)}},{key:"blendDst",set:function(e){this._shaderValues.setInt(n.BLEND_DST,e)},get:function(){return this._shaderValues.getInt(n.BLEND_DST)}},{key:"depthTest",set:function(e){this._shaderValues.setInt(n.DEPTH_TEST,e)},get:function(){return this._shaderValues.getInt(n.DEPTH_TEST)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_MAINTEXTURE=ca.getDefineByName("MAINTEXTURE"),n.SHADERDEFINE_TILINGOFFSET=ca.getDefineByName("TILINGOFFSET"),n.SHADERDEFINE_ADDTIVEFOG=ca.getDefineByName("ADDTIVEFOG")}}]),n}();pl.RENDERMODE_ADDTIVE=0,pl.RENDERMODE_ALPHABLENDED=1,pl.MAINTEXTURE=ca.propertyNameToID("u_AlbedoTexture"),pl.TINTCOLOR=ca.propertyNameToID("u_AlbedoColor"),pl.TILINGOFFSET=ca.propertyNameToID("u_TilingOffset"),pl.CULL=ca.propertyNameToID("s_Cull"),pl.BLEND=ca.propertyNameToID("s_Blend"),pl.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),pl.BLEND_DST=ca.propertyNameToID("s_BlendDst"),pl.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),pl.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite");var ml=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._enableLighting=!0,e.setShaderName("ExtendTerrain"),e.renderMode=n.RENDERMODE_OPAQUE,e}return C(n,[{key:"_setDetailNum",value:function(e){switch(e){case 1:this._shaderValues.addDefine(n.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM4),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._shaderValues.addDefine(n.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM4),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._shaderValues.addDefine(n.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM4),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._shaderValues.addDefine(n.SHADERDEFINE_DETAIL_NUM4),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._shaderValues.addDefine(n.SHADERDEFINE_DETAIL_NUM5),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(n.SHADERDEFINE_DETAIL_NUM4)}}},{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"splatAlphaTexture",get:function(){return this._shaderValues.getTexture(n.SPLATALPHATEXTURE)},set:function(e){this._shaderValues.setTexture(n.SPLATALPHATEXTURE,e)}},{key:"diffuseTexture1",set:function(e){this._shaderValues.setTexture(n.DIFFUSETEXTURE1,e),this._setDetailNum(1)}},{key:"diffuseTexture2",get:function(){return this._shaderValues.getTexture(n.DIFFUSETEXTURE2)},set:function(e){this._shaderValues.setTexture(n.DIFFUSETEXTURE2,e),this._setDetailNum(2)}},{key:"diffuseTexture3",get:function(){return this._shaderValues.getTexture(n.DIFFUSETEXTURE3)},set:function(e){this._shaderValues.setTexture(n.DIFFUSETEXTURE3,e),this._setDetailNum(3)}},{key:"diffuseTexture4",get:function(){return this._shaderValues.getTexture(n.DIFFUSETEXTURE4)},set:function(e){this._shaderValues.setTexture(n.DIFFUSETEXTURE4,e),this._setDetailNum(4)}},{key:"diffuseTexture5",get:function(){return this._shaderValues.getTexture(n.DIFFUSETEXTURE5)},set:function(e){this._shaderValues.setTexture(n.DIFFUSETEXTURE5,e),this._setDetailNum(5)}},{key:"diffuseScaleOffset1",set:function(e){this._shaderValues.setVector(n.DIFFUSESCALEOFFSET1,e)}},{key:"diffuseScaleOffset2",set:function(e){this._shaderValues.setVector(n.DIFFUSESCALEOFFSET2,e)}},{key:"diffuseScaleOffset3",set:function(e){this._shaderValues.setVector(n.DIFFUSESCALEOFFSET3,e)}},{key:"diffuseScaleOffset4",set:function(e){this._shaderValues.setVector(n.DIFFUSESCALEOFFSET4,e)}},{key:"diffuseScaleOffset5",set:function(e){this._shaderValues.setVector(n.DIFFUSESCALEOFFSET5,e)}},{key:"enableLighting",get:function(){return this._enableLighting},set:function(e){this._enableLighting!==e&&(e?(this._disablePublicDefineDatas.remove(nr.SHADERDEFINE_POINTLIGHT),this._disablePublicDefineDatas.remove(nr.SHADERDEFINE_SPOTLIGHT),this._disablePublicDefineDatas.remove(nr.SHADERDEFINE_DIRECTIONLIGHT)):(this._disablePublicDefineDatas.add(nr.SHADERDEFINE_POINTLIGHT),this._disablePublicDefineDatas.add(nr.SHADERDEFINE_SPOTLIGHT),this._disablePublicDefineDatas.add(nr.SHADERDEFINE_DIRECTIONLIGHT)),this._enableLighting=e)}},{key:"renderMode",set:function(e){switch(e){case n.RENDERMODE_OPAQUE:this.renderQueue=hr.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS;break;case n.RENDERMODE_TRANSPARENT:this.renderQueue=hr.RENDERQUEUE_OPAQUE,this.depthWrite=!1,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LEQUAL;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}}},{key:"depthWrite",set:function(e){this._shaderValues.setBool(n.DEPTH_WRITE,e)},get:function(){return this._shaderValues.getBool(n.DEPTH_WRITE)}},{key:"cull",set:function(e){this._shaderValues.setInt(n.CULL,e)},get:function(){return this._shaderValues.getInt(n.CULL)}},{key:"blend",set:function(e){this._shaderValues.setInt(n.BLEND,e)},get:function(){return this._shaderValues.getInt(n.BLEND)}},{key:"blendSrc",set:function(e){this._shaderValues.setInt(n.BLEND_SRC,e)},get:function(){return this._shaderValues.getInt(n.BLEND_SRC)}},{key:"blendDst",set:function(e){this._shaderValues.setInt(n.BLEND_DST,e)},get:function(){return this._shaderValues.getInt(n.BLEND_DST)}},{key:"depthTest",set:function(e){this._shaderValues.setInt(n.DEPTH_TEST,e)},get:function(){return this._shaderValues.getInt(n.DEPTH_TEST)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_DETAIL_NUM1=ca.getDefineByName("ExtendTerrain_DETAIL_NUM1"),n.SHADERDEFINE_DETAIL_NUM2=ca.getDefineByName("ExtendTerrain_DETAIL_NUM2"),n.SHADERDEFINE_DETAIL_NUM3=ca.getDefineByName("ExtendTerrain_DETAIL_NUM3"),n.SHADERDEFINE_DETAIL_NUM4=ca.getDefineByName("ExtendTerrain_DETAIL_NUM4"),n.SHADERDEFINE_DETAIL_NUM5=ca.getDefineByName("ExtendTerrain_DETAIL_NUM5")}}]),n}();ml.RENDERMODE_OPAQUE=1,ml.RENDERMODE_TRANSPARENT=2,ml.SPLATALPHATEXTURE=ca.propertyNameToID("u_SplatAlphaTexture"),ml.DIFFUSETEXTURE1=ca.propertyNameToID("u_DiffuseTexture1"),ml.DIFFUSETEXTURE2=ca.propertyNameToID("u_DiffuseTexture2"),ml.DIFFUSETEXTURE3=ca.propertyNameToID("u_DiffuseTexture3"),ml.DIFFUSETEXTURE4=ca.propertyNameToID("u_DiffuseTexture4"),ml.DIFFUSETEXTURE5=ca.propertyNameToID("u_DiffuseTexture5"),ml.DIFFUSESCALEOFFSET1=ca.propertyNameToID("u_DiffuseScaleOffset1"),ml.DIFFUSESCALEOFFSET2=ca.propertyNameToID("u_DiffuseScaleOffset2"),ml.DIFFUSESCALEOFFSET3=ca.propertyNameToID("u_DiffuseScaleOffset3"),ml.DIFFUSESCALEOFFSET4=ca.propertyNameToID("u_DiffuseScaleOffset4"),ml.DIFFUSESCALEOFFSET5=ca.propertyNameToID("u_DiffuseScaleOffset5"),ml.CULL=ca.propertyNameToID("s_Cull"),ml.BLEND=ca.propertyNameToID("s_Blend"),ml.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),ml.BLEND_DST=ca.propertyNameToID("s_BlendDst"),ml.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),ml.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite");var wl=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("PBRSpecular"),e._albedoColor=new yn(1,1,1,1),e._shaderValues.setVector(n.ALBEDOCOLOR,new yn(1,1,1,1)),e._emissionColor=new yn(0,0,0,0),e._shaderValues.setVector(n.EMISSIONCOLOR,new yn(0,0,0,0)),e._specularColor=new yn(.2,.2,.2,.2),e._shaderValues.setVector(n.SPECULARCOLOR,new yn(.2,.2,.2,.2)),e._shaderValues.setNumber(n.SMOOTHNESS,.5),e._shaderValues.setNumber(n.SMOOTHNESSSCALE,1),e._shaderValues.setNumber(n.SMOOTHNESSSOURCE,0),e._shaderValues.setNumber(n.OCCLUSIONSTRENGTH,1),e._shaderValues.setNumber(n.NORMALSCALE,1),e._shaderValues.setNumber(n.PARALLAXSCALE,.001),e._shaderValues.setBool(n.ENABLEEMISSION,!1),e._shaderValues.setNumber(hr.ALPHATESTVALUE,.5),e.renderMode=n.RENDERMODE_OPAQUE,e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"cloneTo",value:function(e){G(z(n.prototype),"cloneTo",this).call(this,e);this._albedoColor.cloneTo(e._albedoColor),this._specularColor.cloneTo(e._specularColor),this._emissionColor.cloneTo(e._emissionColor)}},{key:"_ColorR",get:function(){return this._albedoColor.x},set:function(e){this._albedoColor.x=e,this.albedoColor=this._albedoColor}},{key:"_ColorG",get:function(){return this._albedoColor.y},set:function(e){this._albedoColor.y=e,this.albedoColor=this._albedoColor}},{key:"_ColorB",get:function(){return this._albedoColor.z},set:function(e){this._albedoColor.z=e,this.albedoColor=this._albedoColor}},{key:"_ColorA",get:function(){return this._albedoColor.w},set:function(e){this._albedoColor.w=e,this.albedoColor=this._albedoColor}},{key:"_SpecColorR",get:function(){return this._specularColor.x},set:function(e){this._specularColor.x=e,this.specularColor=this._specularColor}},{key:"_SpecColorG",get:function(){return this._specularColor.y},set:function(e){this._specularColor.y=e,this.specularColor=this._specularColor}},{key:"_SpecColorB",get:function(){return this._specularColor.z},set:function(e){this._specularColor.z=e,this.specularColor=this._specularColor}},{key:"_SpecColorA",get:function(){return this._specularColor.w},set:function(e){this._specularColor.w=e,this.specularColor=this._specularColor}},{key:"_Glossiness",get:function(){return this._shaderValues.getNumber(n.SMOOTHNESS)},set:function(e){this._shaderValues.setNumber(n.SMOOTHNESS,e)}},{key:"_GlossMapScale",get:function(){return this._shaderValues.getNumber(n.SMOOTHNESSSCALE)},set:function(e){this._shaderValues.setNumber(n.SMOOTHNESSSCALE,e)}},{key:"_BumpScale",get:function(){return this._shaderValues.getNumber(n.NORMALSCALE)},set:function(e){this._shaderValues.setNumber(n.NORMALSCALE,e)}},{key:"_Parallax",get:function(){return this._shaderValues.getNumber(n.PARALLAXSCALE)},set:function(e){this._shaderValues.setNumber(n.PARALLAXSCALE,e)}},{key:"_OcclusionStrength",get:function(){return this._shaderValues.getNumber(n.OCCLUSIONSTRENGTH)},set:function(e){this._shaderValues.setNumber(n.OCCLUSIONSTRENGTH,e)}},{key:"_EmissionColorR",get:function(){return this._emissionColor.x},set:function(e){this._emissionColor.x=e,this.emissionColor=this._emissionColor}},{key:"_EmissionColorG",get:function(){return this._emissionColor.y},set:function(e){this._emissionColor.y=e,this.emissionColor=this._emissionColor}},{key:"_EmissionColorB",get:function(){return this._emissionColor.z},set:function(e){this._emissionColor.z=e,this.emissionColor=this._emissionColor}},{key:"_EmissionColorA",get:function(){return this._emissionColor.w},set:function(e){this._emissionColor.w=e,this.emissionColor=this._emissionColor}},{key:"_MainTex_STX",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.x=e,this.tilingOffset=t}},{key:"_MainTex_STY",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.y=e,this.tilingOffset=t}},{key:"_MainTex_STZ",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.z=e,this.tilingOffset=t}},{key:"_MainTex_STW",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.w=e,this.tilingOffset=t}},{key:"_Cutoff",get:function(){return this.alphaTestValue},set:function(e){this.alphaTestValue=e}},{key:"albedoColorR",get:function(){return this._ColorR},set:function(e){this._ColorR=e}},{key:"albedoColorG",get:function(){return this._ColorG},set:function(e){this._ColorG=e}},{key:"albedoColorB",get:function(){return this._ColorB},set:function(e){this._ColorB=e}},{key:"albedoColorA",get:function(){return this._ColorA},set:function(e){this._ColorA=e}},{key:"albedoColor",get:function(){return this._albedoColor},set:function(e){this._albedoColor=e,this._shaderValues.setVector(n.ALBEDOCOLOR,e)}},{key:"albedoTexture",get:function(){return this._shaderValues.getTexture(n.ALBEDOTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_ALBEDOTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(n.ALBEDOTEXTURE,e)}},{key:"normalTexture",get:function(){return this._shaderValues.getTexture(n.NORMALTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_NORMALTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(n.NORMALTEXTURE,e)}},{key:"normalTextureScale",get:function(){return this._BumpScale},set:function(e){this._BumpScale=e}},{key:"parallaxTexture",get:function(){return this._shaderValues.getTexture(n.PARALLAXTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_PARALLAXTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_PARALLAXTEXTURE),this._shaderValues.setTexture(n.PARALLAXTEXTURE,e)}},{key:"parallaxTextureScale",get:function(){return this._Parallax},set:function(e){this._Parallax=Math.max(.005,Math.min(.08,e))}},{key:"occlusionTexture",get:function(){return this._shaderValues.getTexture(n.OCCLUSIONTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_OCCLUSIONTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_OCCLUSIONTEXTURE),this._shaderValues.setTexture(n.OCCLUSIONTEXTURE,e)}},{key:"occlusionTextureStrength",get:function(){return this._OcclusionStrength},set:function(e){this._OcclusionStrength=Math.max(0,Math.min(1,e))}},{key:"specularTexture",get:function(){return this._shaderValues.getTexture(n.SPECULARTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_SPECULARTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_SPECULARTEXTURE),this._shaderValues.setTexture(n.SPECULARTEXTURE,e)}},{key:"specularColorR",get:function(){return this._SpecColorR},set:function(e){this._SpecColorR=e}},{key:"specularColorG",get:function(){return this._SpecColorG},set:function(e){this._SpecColorG=e}},{key:"specularColorB",get:function(){return this._SpecColorB},set:function(e){this._SpecColorB=e}},{key:"specularColorA",get:function(){return this._SpecColorA},set:function(e){this._SpecColorA=e}},{key:"specularColor",get:function(){return this._shaderValues.getVector(n.SPECULARCOLOR)},set:function(e){this._shaderValues.setVector(n.SPECULARCOLOR,e)}},{key:"smoothness",get:function(){return this._Glossiness},set:function(e){this._Glossiness=Math.max(0,Math.min(1,e))}},{key:"smoothnessTextureScale",get:function(){return this._GlossMapScale},set:function(e){this._GlossMapScale=Math.max(0,Math.min(1,e))}},{key:"smoothnessSource",get:function(){return this._shaderValues.getInt(n.SMOOTHNESSSOURCE)},set:function(e){e?(this._shaderValues.addDefine(n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._shaderValues.setInt(n.SMOOTHNESSSOURCE,1)):(this._shaderValues.removeDefine(n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._shaderValues.setInt(n.SMOOTHNESSSOURCE,0))}},{key:"enableEmission",get:function(){return this._shaderValues.getBool(n.ENABLEEMISSION)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_EMISSION):this._shaderValues.removeDefine(n.SHADERDEFINE_EMISSION),this._shaderValues.setBool(n.ENABLEEMISSION,e)}},{key:"emissionColor",get:function(){return this._shaderValues.getVector(n.EMISSIONCOLOR)},set:function(e){this._shaderValues.setVector(n.EMISSIONCOLOR,e)}},{key:"emissionTexture",get:function(){return this._shaderValues.getTexture(n.EMISSIONTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_EMISSIONTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_EMISSIONTEXTURE),this._shaderValues.setTexture(n.EMISSIONTEXTURE,e)}},{key:"enableReflection",get:function(){return this._shaderValues.getBool(n.ENABLEREFLECT)},set:function(e){this._shaderValues.setBool(n.ENABLEREFLECT,!0),e?this._disablePublicDefineDatas.remove(nr.SHADERDEFINE_REFLECTMAP):this._disablePublicDefineDatas.add(nr.SHADERDEFINE_REFLECTMAP)}},{key:"tilingOffsetX",get:function(){return this._MainTex_STX},set:function(e){this._MainTex_STX=e}},{key:"tilingOffsetY",get:function(){return this._MainTex_STY},set:function(e){this._MainTex_STY=e}},{key:"tilingOffsetZ",get:function(){return this._MainTex_STZ},set:function(e){this._MainTex_STZ=e}},{key:"tilingOffsetW",get:function(){return this._MainTex_STW},set:function(e){this._MainTex_STW=e}},{key:"tilingOffset",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET)},set:function(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(n.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(n.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,e)}},{key:"renderMode",set:function(e){switch(e){case n.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=hr.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.removeDefine(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case n.RENDERMODE_CUTOUT:this.renderQueue=hr.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.removeDefine(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case n.RENDERMODE_FADE:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.removeDefine(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case n.RENDERMODE_TRANSPARENT:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_ONE,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.addDefine(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;default:throw new Error("PBRSpecularMaterial : renderMode value error.")}}},{key:"depthWrite",get:function(){return this._shaderValues.getBool(n.DEPTH_WRITE)},set:function(e){this._shaderValues.setBool(n.DEPTH_WRITE,e)}},{key:"cull",get:function(){return this._shaderValues.getInt(n.CULL)},set:function(e){this._shaderValues.setInt(n.CULL,e)}},{key:"blend",get:function(){return this._shaderValues.getInt(n.BLEND)},set:function(e){this._shaderValues.setInt(n.BLEND,e)}},{key:"blendSrc",get:function(){return this._shaderValues.getInt(n.BLEND_SRC)},set:function(e){this._shaderValues.setInt(n.BLEND_SRC,e)}},{key:"blendDst",get:function(){return this._shaderValues.getInt(n.BLEND_DST)},set:function(e){this._shaderValues.setInt(n.BLEND_DST,e)}},{key:"depthTest",get:function(){return this._shaderValues.getInt(n.DEPTH_TEST)},set:function(e){this._shaderValues.setInt(n.DEPTH_TEST,e)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_ALBEDOTEXTURE=ca.getDefineByName("ALBEDOTEXTURE"),n.SHADERDEFINE_SPECULARTEXTURE=ca.getDefineByName("SPECULARTEXTURE"),n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=ca.getDefineByName("SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA"),n.SHADERDEFINE_NORMALTEXTURE=ca.getDefineByName("NORMALTEXTURE"),n.SHADERDEFINE_PARALLAXTEXTURE=ca.getDefineByName("PARALLAXTEXTURE"),n.SHADERDEFINE_OCCLUSIONTEXTURE=ca.getDefineByName("OCCLUSIONTEXTURE"),n.SHADERDEFINE_EMISSION=ca.getDefineByName("EMISSION"),n.SHADERDEFINE_EMISSIONTEXTURE=ca.getDefineByName("EMISSIONTEXTURE"),n.SHADERDEFINE_TILINGOFFSET=ca.getDefineByName("TILINGOFFSET"),n.SHADERDEFINE_ALPHAPREMULTIPLY=ca.getDefineByName("ALPHAPREMULTIPLY")}}]),n}();wl.SmoothnessSource_SpecularTexture_Alpha=0,wl.SmoothnessSource_AlbedoTexture_Alpha=1,wl.RENDERMODE_OPAQUE=0,wl.RENDERMODE_CUTOUT=1,wl.RENDERMODE_FADE=2,wl.RENDERMODE_TRANSPARENT=3,wl.ALBEDOTEXTURE=ca.propertyNameToID("u_AlbedoTexture"),wl.SPECULARTEXTURE=ca.propertyNameToID("u_SpecularTexture"),wl.NORMALTEXTURE=ca.propertyNameToID("u_NormalTexture"),wl.PARALLAXTEXTURE=ca.propertyNameToID("u_ParallaxTexture"),wl.OCCLUSIONTEXTURE=ca.propertyNameToID("u_OcclusionTexture"),wl.EMISSIONTEXTURE=ca.propertyNameToID("u_EmissionTexture"),wl.ALBEDOCOLOR=ca.propertyNameToID("u_AlbedoColor"),wl.SPECULARCOLOR=ca.propertyNameToID("u_SpecularColor"),wl.EMISSIONCOLOR=ca.propertyNameToID("u_EmissionColor"),wl.SMOOTHNESS=ca.propertyNameToID("u_smoothness"),wl.SMOOTHNESSSCALE=ca.propertyNameToID("u_smoothnessScale"),wl.SMOOTHNESSSOURCE=-1,wl.OCCLUSIONSTRENGTH=ca.propertyNameToID("u_occlusionStrength"),wl.NORMALSCALE=ca.propertyNameToID("u_normalScale"),wl.PARALLAXSCALE=ca.propertyNameToID("u_parallaxScale"),wl.ENABLEEMISSION=-1,wl.ENABLEREFLECT=-1,wl.TILINGOFFSET=ca.propertyNameToID("u_TilingOffset"),wl.CULL=ca.propertyNameToID("s_Cull"),wl.BLEND=ca.propertyNameToID("s_Blend"),wl.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),wl.BLEND_DST=ca.propertyNameToID("s_BlendDst"),wl.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),wl.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite");var xl=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("PBRStandard"),e._albedoColor=new yn(1,1,1,1),e._shaderValues.setVector(n.ALBEDOCOLOR,new yn(1,1,1,1)),e._emissionColor=new yn(0,0,0,0),e._shaderValues.setVector(n.EMISSIONCOLOR,new yn(0,0,0,0)),e._shaderValues.setNumber(n.METALLIC,0),e._shaderValues.setNumber(n.SMOOTHNESS,.5),e._shaderValues.setNumber(n.SMOOTHNESSSCALE,1),e._shaderValues.setNumber(n.SMOOTHNESSSOURCE,0),e._shaderValues.setNumber(n.OCCLUSIONSTRENGTH,1),e._shaderValues.setNumber(n.NORMALSCALE,1),e._shaderValues.setNumber(n.PARALLAXSCALE,.001),e._shaderValues.setBool(n.ENABLEEMISSION,!1),e._shaderValues.setBool(n.ENABLEREFLECT,!0),e._shaderValues.setNumber(hr.ALPHATESTVALUE,.5),e._disablePublicDefineDatas.remove(nr.SHADERDEFINE_REFLECTMAP),e.renderMode=n.RENDERMODE_OPAQUE,e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"cloneTo",value:function(e){G(z(n.prototype),"cloneTo",this).call(this,e);this._albedoColor.cloneTo(e._albedoColor),this._emissionColor.cloneTo(e._emissionColor)}},{key:"_ColorR",get:function(){return this._albedoColor.x},set:function(e){this._albedoColor.x=e,this.albedoColor=this._albedoColor}},{key:"_ColorG",get:function(){return this._albedoColor.y},set:function(e){this._albedoColor.y=e,this.albedoColor=this._albedoColor}},{key:"_ColorB",get:function(){return this._albedoColor.z},set:function(e){this._albedoColor.z=e,this.albedoColor=this._albedoColor}},{key:"_ColorA",get:function(){return this._albedoColor.w},set:function(e){this._albedoColor.w=e,this.albedoColor=this._albedoColor}},{key:"_Metallic",get:function(){return this._shaderValues.getNumber(n.METALLIC)},set:function(e){this._shaderValues.setNumber(n.METALLIC,e)}},{key:"_Glossiness",get:function(){return this._shaderValues.getNumber(n.SMOOTHNESS)},set:function(e){this._shaderValues.setNumber(n.SMOOTHNESS,e)}},{key:"_GlossMapScale",get:function(){return this._shaderValues.getNumber(n.SMOOTHNESSSCALE)},set:function(e){this._shaderValues.setNumber(n.SMOOTHNESSSCALE,e)}},{key:"_BumpScale",get:function(){return this._shaderValues.getNumber(n.NORMALSCALE)},set:function(e){this._shaderValues.setNumber(n.NORMALSCALE,e)}},{key:"_Parallax",get:function(){return this._shaderValues.getNumber(n.PARALLAXSCALE)},set:function(e){this._shaderValues.setNumber(n.PARALLAXSCALE,e)}},{key:"_OcclusionStrength",get:function(){return this._shaderValues.getNumber(n.OCCLUSIONSTRENGTH)},set:function(e){this._shaderValues.setNumber(n.OCCLUSIONSTRENGTH,e)}},{key:"_EmissionColorR",get:function(){return this._emissionColor.x},set:function(e){this._emissionColor.x=e,this.emissionColor=this._emissionColor}},{key:"_EmissionColorG",get:function(){return this._emissionColor.y},set:function(e){this._emissionColor.y=e,this.emissionColor=this._emissionColor}},{key:"_EmissionColorB",get:function(){return this._emissionColor.z},set:function(e){this._emissionColor.z=e,this.emissionColor=this._emissionColor}},{key:"_EmissionColorA",get:function(){return this._emissionColor.w},set:function(e){this._emissionColor.w=e,this.emissionColor=this._emissionColor}},{key:"_MainTex_STX",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.x=e,this.tilingOffset=t}},{key:"_MainTex_STY",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.y=e,this.tilingOffset=t}},{key:"_MainTex_STZ",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.z=e,this.tilingOffset=t}},{key:"_MainTex_STW",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.w=e,this.tilingOffset=t}},{key:"_Cutoff",get:function(){return this.alphaTestValue},set:function(e){this.alphaTestValue=e}},{key:"albedoColorR",get:function(){return this._ColorR},set:function(e){this._ColorR=e}},{key:"albedoColorG",get:function(){return this._ColorG},set:function(e){this._ColorG=e}},{key:"albedoColorB",get:function(){return this._ColorB},set:function(e){this._ColorB=e}},{key:"albedoColorA",get:function(){return this._ColorA},set:function(e){this._ColorA=e}},{key:"albedoColor",get:function(){return this._albedoColor},set:function(e){this._albedoColor=e,this._shaderValues.setVector(n.ALBEDOCOLOR,e)}},{key:"albedoTexture",get:function(){return this._shaderValues.getTexture(n.ALBEDOTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_ALBEDOTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(n.ALBEDOTEXTURE,e)}},{key:"normalTexture",get:function(){return this._shaderValues.getTexture(n.NORMALTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_NORMALTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(n.NORMALTEXTURE,e)}},{key:"normalTextureScale",get:function(){return this._BumpScale},set:function(e){this._BumpScale=e}},{key:"parallaxTexture",get:function(){return this._shaderValues.getTexture(n.PARALLAXTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_PARALLAXTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_PARALLAXTEXTURE),this._shaderValues.setTexture(n.PARALLAXTEXTURE,e)}},{key:"parallaxTextureScale",get:function(){return this._Parallax},set:function(e){this._Parallax=Math.max(.005,Math.min(.08,e))}},{key:"occlusionTexture",get:function(){return this._shaderValues.getTexture(n.OCCLUSIONTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_OCCLUSIONTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_OCCLUSIONTEXTURE),this._shaderValues.setTexture(n.OCCLUSIONTEXTURE,e)}},{key:"occlusionTextureStrength",get:function(){return this._OcclusionStrength},set:function(e){this._OcclusionStrength=Math.max(0,Math.min(1,e))}},{key:"metallicGlossTexture",get:function(){return this._shaderValues.getTexture(n.METALLICGLOSSTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_METALLICGLOSSTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_METALLICGLOSSTEXTURE),this._shaderValues.setTexture(n.METALLICGLOSSTEXTURE,e)}},{key:"metallic",get:function(){return this._Metallic},set:function(e){this._Metallic=Math.max(0,Math.min(1,e))}},{key:"smoothness",get:function(){return this._Glossiness},set:function(e){this._Glossiness=Math.max(0,Math.min(1,e))}},{key:"smoothnessTextureScale",get:function(){return this._GlossMapScale},set:function(e){this._GlossMapScale=Math.max(0,Math.min(1,e))}},{key:"smoothnessSource",get:function(){return this._shaderValues.getInt(n.SMOOTHNESSSOURCE)},set:function(e){e?(this._shaderValues.addDefine(n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._shaderValues.setInt(n.SMOOTHNESSSOURCE,1)):(this._shaderValues.removeDefine(n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._shaderValues.setInt(n.SMOOTHNESSSOURCE,0))}},{key:"enableEmission",get:function(){return this._shaderValues.getBool(n.ENABLEEMISSION)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_EMISSION):this._shaderValues.removeDefine(n.SHADERDEFINE_EMISSION),this._shaderValues.setBool(n.ENABLEEMISSION,e)}},{key:"emissionColorR",get:function(){return this._EmissionColorR},set:function(e){this._EmissionColorR=e}},{key:"emissionColorG",get:function(){return this._EmissionColorG},set:function(e){this._EmissionColorG=e}},{key:"emissionColorB",get:function(){return this._EmissionColorB},set:function(e){this._EmissionColorB=e}},{key:"emissionColorA",get:function(){return this._EmissionColorA},set:function(e){this._EmissionColorA=e}},{key:"emissionColor",get:function(){return this._shaderValues.getVector(n.EMISSIONCOLOR)},set:function(e){this._shaderValues.setVector(n.EMISSIONCOLOR,e)}},{key:"emissionTexture",get:function(){return this._shaderValues.getTexture(n.EMISSIONTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_EMISSIONTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_EMISSIONTEXTURE),this._shaderValues.setTexture(n.EMISSIONTEXTURE,e)}},{key:"enableReflection",get:function(){return this._shaderValues.getBool(n.ENABLEREFLECT)},set:function(e){this._shaderValues.setBool(n.ENABLEREFLECT,!0),e?this._disablePublicDefineDatas.remove(nr.SHADERDEFINE_REFLECTMAP):this._disablePublicDefineDatas.add(nr.SHADERDEFINE_REFLECTMAP)}},{key:"tilingOffsetX",get:function(){return this._MainTex_STX},set:function(e){this._MainTex_STX=e}},{key:"tilingOffsetY",get:function(){return this._MainTex_STY},set:function(e){this._MainTex_STY=e}},{key:"tilingOffsetZ",get:function(){return this._MainTex_STZ},set:function(e){this._MainTex_STZ=e}},{key:"tilingOffsetW",get:function(){return this._MainTex_STW},set:function(e){this._MainTex_STW=e}},{key:"tilingOffset",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET)},set:function(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(n.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(n.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,e)}},{key:"renderMode",set:function(e){switch(e){case n.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=hr.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.removeDefine(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case n.RENDERMODE_CUTOUT:this.renderQueue=hr.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.removeDefine(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case n.RENDERMODE_FADE:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.removeDefine(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case n.RENDERMODE_TRANSPARENT:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_ONE,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.addDefine(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;default:throw new Error("PBRSpecularMaterial : renderMode value error.")}}},{key:"depthWrite",get:function(){return this._shaderValues.getBool(n.DEPTH_WRITE)},set:function(e){this._shaderValues.setBool(n.DEPTH_WRITE,e)}},{key:"cull",get:function(){return this._shaderValues.getInt(n.CULL)},set:function(e){this._shaderValues.setInt(n.CULL,e)}},{key:"blend",get:function(){return this._shaderValues.getInt(n.BLEND)},set:function(e){this._shaderValues.setInt(n.BLEND,e)}},{key:"blendSrc",get:function(){return this._shaderValues.getInt(n.BLEND_SRC)},set:function(e){this._shaderValues.setInt(n.BLEND_SRC,e)}},{key:"blendDst",get:function(){return this._shaderValues.getInt(n.BLEND_DST)},set:function(e){this._shaderValues.setInt(n.BLEND_DST,e)}},{key:"depthTest",get:function(){return this._shaderValues.getInt(n.DEPTH_TEST)},set:function(e){this._shaderValues.setInt(n.DEPTH_TEST,e)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_ALBEDOTEXTURE=ca.getDefineByName("ALBEDOTEXTURE"),n.SHADERDEFINE_METALLICGLOSSTEXTURE=ca.getDefineByName("METALLICGLOSSTEXTURE"),n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=ca.getDefineByName("SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA"),n.SHADERDEFINE_NORMALTEXTURE=ca.getDefineByName("NORMALTEXTURE"),n.SHADERDEFINE_PARALLAXTEXTURE=ca.getDefineByName("PARALLAXTEXTURE"),n.SHADERDEFINE_OCCLUSIONTEXTURE=ca.getDefineByName("OCCLUSIONTEXTURE"),n.SHADERDEFINE_EMISSION=ca.getDefineByName("EMISSION"),n.SHADERDEFINE_EMISSIONTEXTURE=ca.getDefineByName("EMISSIONTEXTURE"),n.SHADERDEFINE_REFLECTMAP=ca.getDefineByName("REFLECTMAP"),n.SHADERDEFINE_TILINGOFFSET=ca.getDefineByName("TILINGOFFSET"),n.SHADERDEFINE_ALPHAPREMULTIPLY=ca.getDefineByName("ALPHAPREMULTIPLY")}}]),n}();xl.SmoothnessSource_MetallicGlossTexture_Alpha=0,xl.SmoothnessSource_AlbedoTexture_Alpha=1,xl.RENDERMODE_OPAQUE=0,xl.RENDERMODE_CUTOUT=1,xl.RENDERMODE_FADE=2,xl.RENDERMODE_TRANSPARENT=3,xl.ALBEDOTEXTURE=ca.propertyNameToID("u_AlbedoTexture"),xl.METALLICGLOSSTEXTURE=ca.propertyNameToID("u_MetallicGlossTexture"),xl.NORMALTEXTURE=ca.propertyNameToID("u_NormalTexture"),xl.PARALLAXTEXTURE=ca.propertyNameToID("u_ParallaxTexture"),xl.OCCLUSIONTEXTURE=ca.propertyNameToID("u_OcclusionTexture"),xl.EMISSIONTEXTURE=ca.propertyNameToID("u_EmissionTexture"),xl.ALBEDOCOLOR=ca.propertyNameToID("u_AlbedoColor"),xl.EMISSIONCOLOR=ca.propertyNameToID("u_EmissionColor"),xl.METALLIC=ca.propertyNameToID("u_metallic"),xl.SMOOTHNESS=ca.propertyNameToID("u_smoothness"),xl.SMOOTHNESSSCALE=ca.propertyNameToID("u_smoothnessScale"),xl.SMOOTHNESSSOURCE=-1,xl.OCCLUSIONSTRENGTH=ca.propertyNameToID("u_occlusionStrength"),xl.NORMALSCALE=ca.propertyNameToID("u_normalScale"),xl.PARALLAXSCALE=ca.propertyNameToID("u_parallaxScale"),xl.ENABLEEMISSION=-1,xl.ENABLEREFLECT=-1,xl.TILINGOFFSET=ca.propertyNameToID("u_TilingOffset"),xl.CULL=ca.propertyNameToID("s_Cull"),xl.BLEND=ca.propertyNameToID("s_Blend"),xl.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),xl.BLEND_DST=ca.propertyNameToID("s_BlendDst"),xl.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),xl.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite");var kl=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("SkyBox"),e.tintColor=new yn(.5,.5,.5,.5),e.exposure=1,e.rotation=0,e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"tintColor",get:function(){return this._shaderValues.getVector(n.TINTCOLOR)},set:function(e){this._shaderValues.setVector(n.TINTCOLOR,e)}},{key:"exposure",get:function(){return this._shaderValues.getNumber(n.EXPOSURE)},set:function(e){this._shaderValues.setNumber(n.EXPOSURE,e)}},{key:"rotation",get:function(){return this._shaderValues.getNumber(n.ROTATION)},set:function(e){this._shaderValues.setNumber(n.ROTATION,e)}},{key:"textureCube",get:function(){return this._shaderValues.getTexture(n.TEXTURECUBE)},set:function(e){this._shaderValues.setTexture(n.TEXTURECUBE,e)}}],[{key:"__initDefine__",value:function(){}}]),n}();kl.TINTCOLOR=ca.propertyNameToID("u_TintColor"),kl.EXPOSURE=ca.propertyNameToID("u_Exposure"),kl.ROTATION=ca.propertyNameToID("u_Rotation"),kl.TEXTURECUBE=ca.propertyNameToID("u_CubeTexture");var Tl=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("SkyBoxProcedural"),e.sunDisk=n.SUN_HIGH_QUALITY,e.sunSize=.04,e.sunSizeConvergence=5,e.atmosphereThickness=1,e.skyTint=new yn(.5,.5,.5,1),e.groundTint=new yn(.369,.349,.341,1),e.exposure=1.3,e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"sunDisk",get:function(){return this._sunDisk},set:function(e){switch(e){case n.SUN_HIGH_QUALITY:this._shaderValues.removeDefine(n.SHADERDEFINE_SUN_SIMPLE),this._shaderValues.addDefine(n.SHADERDEFINE_SUN_HIGH_QUALITY);break;case n.SUN_SIMPLE:this._shaderValues.removeDefine(n.SHADERDEFINE_SUN_HIGH_QUALITY),this._shaderValues.addDefine(n.SHADERDEFINE_SUN_SIMPLE);break;case n.SUN_NODE:this._shaderValues.removeDefine(n.SHADERDEFINE_SUN_HIGH_QUALITY),this._shaderValues.removeDefine(n.SHADERDEFINE_SUN_SIMPLE);break;default:throw"SkyBoxProceduralMaterial: unknown sun value."}this._sunDisk=e}},{key:"sunSize",get:function(){return this._shaderValues.getNumber(n.SUNSIZE)},set:function(e){e=Math.min(Math.max(0,e),1),this._shaderValues.setNumber(n.SUNSIZE,e)}},{key:"sunSizeConvergence",get:function(){return this._shaderValues.getNumber(n.SUNSIZECONVERGENCE)},set:function(e){e=Math.min(Math.max(0,e),20),this._shaderValues.setNumber(n.SUNSIZECONVERGENCE,e)}},{key:"atmosphereThickness",get:function(){return this._shaderValues.getNumber(n.ATMOSPHERETHICKNESS)},set:function(e){e=Math.min(Math.max(0,e),5),this._shaderValues.setNumber(n.ATMOSPHERETHICKNESS,e)}},{key:"skyTint",get:function(){return this._shaderValues.getVector(n.SKYTINT)},set:function(e){this._shaderValues.setVector(n.SKYTINT,e)}},{key:"groundTint",get:function(){return this._shaderValues.getVector(n.GROUNDTINT)},set:function(e){this._shaderValues.setVector(n.GROUNDTINT,e)}},{key:"exposure",get:function(){return this._shaderValues.getNumber(n.EXPOSURE)},set:function(e){e=Math.min(Math.max(0,e),8),this._shaderValues.setNumber(n.EXPOSURE,e)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_SUN_HIGH_QUALITY=ca.getDefineByName("SUN_HIGH_QUALITY"),n.SHADERDEFINE_SUN_SIMPLE=ca.getDefineByName("SUN_SIMPLE")}}]),n}();Tl.SUN_NODE=0,Tl.SUN_SIMPLE=1,Tl.SUN_HIGH_QUALITY=2,Tl.SUNSIZE=ca.propertyNameToID("u_SunSize"),Tl.SUNSIZECONVERGENCE=ca.propertyNameToID("u_SunSizeConvergence"),Tl.ATMOSPHERETHICKNESS=ca.propertyNameToID("u_AtmosphereThickness"),Tl.SKYTINT=ca.propertyNameToID("u_SkyTint"),Tl.GROUNDTINT=ca.propertyNameToID("u_GroundTint"),Tl.EXPOSURE=ca.propertyNameToID("u_Exposure");var El=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._albedoColor=new yn(1,1,1,1),e._albedoIntensity=1,e._enableVertexColor=!1,e.setShaderName("Unlit"),e._shaderValues.setVector(n.ALBEDOCOLOR,new yn(1,1,1,1)),e.renderMode=n.RENDERMODE_OPAQUE,e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"_ColorR",get:function(){return this._albedoColor.x},set:function(e){this._albedoColor.x=e,this.albedoColor=this._albedoColor}},{key:"_ColorG",get:function(){return this._albedoColor.y},set:function(e){this._albedoColor.y=e,this.albedoColor=this._albedoColor}},{key:"_ColorB",get:function(){return this._albedoColor.z},set:function(e){this._albedoColor.z=e,this.albedoColor=this._albedoColor}},{key:"_ColorA",get:function(){return this._albedoColor.w},set:function(e){this._albedoColor.w=e,this.albedoColor=this._albedoColor}},{key:"_AlbedoIntensity",get:function(){return this._albedoIntensity},set:function(e){var t;this._albedoIntensity!==e&&(t=this._shaderValues.getVector(n.ALBEDOCOLOR),yn.scale(this._albedoColor,e,t),this._albedoIntensity=e,this._shaderValues.setVector(n.ALBEDOCOLOR,t))}},{key:"_MainTex_STX",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.x=e,this.tilingOffset=t}},{key:"_MainTex_STY",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.y=e,this.tilingOffset=t}},{key:"_MainTex_STZ",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.z=e,this.tilingOffset=t}},{key:"_MainTex_STW",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.w=e,this.tilingOffset=t}},{key:"_Cutoff",get:function(){return this.alphaTestValue},set:function(e){this.alphaTestValue=e}},{key:"albedoColorR",get:function(){return this._ColorR},set:function(e){this._ColorR=e}},{key:"albedoColorG",get:function(){return this._ColorG},set:function(e){this._ColorG=e}},{key:"albedoColorB",get:function(){return this._ColorB},set:function(e){this._ColorB=e}},{key:"albedoColorA",get:function(){return this._ColorA},set:function(e){this._ColorA=e}},{key:"albedoColor",get:function(){return this._albedoColor},set:function(e){var t=this._shaderValues.getVector(n.ALBEDOCOLOR);yn.scale(e,this._albedoIntensity,t),this._albedoColor=e,this._shaderValues.setVector(n.ALBEDOCOLOR,t)}},{key:"albedoIntensity",get:function(){return this._albedoIntensity},set:function(e){this._AlbedoIntensity=e}},{key:"albedoTexture",get:function(){return this._shaderValues.getTexture(n.ALBEDOTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_ALBEDOTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(n.ALBEDOTEXTURE,e)}},{key:"tilingOffsetX",get:function(){return this._MainTex_STX},set:function(e){this._MainTex_STX=e}},{key:"tilingOffsetY",get:function(){return this._MainTex_STY},set:function(e){this._MainTex_STY=e}},{key:"tilingOffsetZ",get:function(){return this._MainTex_STZ},set:function(e){this._MainTex_STZ=e}},{key:"tilingOffsetW",get:function(){return this._MainTex_STW},set:function(e){this._MainTex_STW=e}},{key:"tilingOffset",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET)},set:function(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(n.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(n.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,e)}},{key:"enableVertexColor",get:function(){return this._enableVertexColor},set:function(e){(this._enableVertexColor=e)?this._shaderValues.addDefine(n.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(n.SHADERDEFINE_ENABLEVERTEXCOLOR)}},{key:"renderMode",set:function(e){switch(e){case n.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=hr.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS;break;case n.RENDERMODE_CUTOUT:this.renderQueue=hr.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_DISABLE,this.depthTest=ur.DEPTHTEST_LESS;break;case n.RENDERMODE_TRANSPARENT:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_BACK,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LESS;break;default:throw new Error("UnlitMaterial : renderMode value error.")}}},{key:"depthWrite",get:function(){return this._shaderValues.getBool(n.DEPTH_WRITE)},set:function(e){this._shaderValues.setBool(n.DEPTH_WRITE,e)}},{key:"cull",get:function(){return this._shaderValues.getInt(n.CULL)},set:function(e){this._shaderValues.setInt(n.CULL,e)}},{key:"blend",get:function(){return this._shaderValues.getInt(n.BLEND)},set:function(e){this._shaderValues.setInt(n.BLEND,e)}},{key:"blendSrc",get:function(){return this._shaderValues.getInt(n.BLEND_SRC)},set:function(e){this._shaderValues.setInt(n.BLEND_SRC,e)}},{key:"blendDst",get:function(){return this._shaderValues.getInt(n.BLEND_DST)},set:function(e){this._shaderValues.setInt(n.BLEND_DST,e)}},{key:"depthTest",get:function(){return this._shaderValues.getInt(n.DEPTH_TEST)},set:function(e){this._shaderValues.setInt(n.DEPTH_TEST,e)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_ALBEDOTEXTURE=ca.getDefineByName("ALBEDOTEXTURE"),n.SHADERDEFINE_TILINGOFFSET=ca.getDefineByName("TILINGOFFSET"),n.SHADERDEFINE_ENABLEVERTEXCOLOR=ca.getDefineByName("ENABLEVERTEXCOLOR")}}]),n}();El.RENDERMODE_OPAQUE=0,El.RENDERMODE_CUTOUT=1,El.RENDERMODE_TRANSPARENT=2,El.RENDERMODE_ADDTIVE=3,El.ALBEDOTEXTURE=ca.propertyNameToID("u_AlbedoTexture"),El.ALBEDOCOLOR=ca.propertyNameToID("u_AlbedoColor"),El.TILINGOFFSET=ca.propertyNameToID("u_TilingOffset"),El.CULL=ca.propertyNameToID("s_Cull"),El.BLEND=ca.propertyNameToID("s_Blend"),El.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),El.BLEND_DST=ca.propertyNameToID("s_BlendDst"),El.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),El.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite");var Ml=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("WaterPrimary"),e._shaderValues.setVector(n.HORIZONCOLOR,new yn(.172,.463,.435,0)),e._shaderValues.setNumber(n.WAVESCALE,.15),e._shaderValues.setVector(n.WAVESPEED,new yn(19,9,-16,-7)),e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"horizonColor",get:function(){return this._shaderValues.getVector(n.HORIZONCOLOR)},set:function(e){this._shaderValues.setVector(n.HORIZONCOLOR,e)}},{key:"mainTexture",get:function(){return this._shaderValues.getTexture(n.MAINTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_MAINTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(n.MAINTEXTURE,e)}},{key:"normalTexture",get:function(){return this._shaderValues.getTexture(n.NORMALTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_NORMALTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(n.NORMALTEXTURE,e)}},{key:"waveScale",get:function(){return this._shaderValues.getNumber(n.WAVESCALE)},set:function(e){this._shaderValues.setNumber(n.WAVESCALE,e)}},{key:"waveSpeed",get:function(){return this._shaderValues.getVector(n.WAVESPEED)},set:function(e){this._shaderValues.setVector(n.WAVESPEED,e)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_MAINTEXTURE=ca.getDefineByName("MAINTEXTURE"),n.SHADERDEFINE_NORMALTEXTURE=ca.getDefineByName("NORMALTEXTURE")}}]),n}();function bl(){S(this,bl)}Ml.HORIZONCOLOR=ca.propertyNameToID("u_HorizonColor"),Ml.MAINTEXTURE=ca.propertyNameToID("u_MainTexture"),Ml.NORMALTEXTURE=ca.propertyNameToID("u_NormalTexture"),Ml.WAVESCALE=ca.propertyNameToID("u_WaveScale"),Ml.WAVESPEED=ca.propertyNameToID("u_WaveSpeed"),bl.Blend=0,bl.Fixed=1;var Sl=function(){function n(e,t){S(this,n),this._mode=0,this._maxColorRGBKeysCount=0,this._maxColorAlphaKeysCount=0,this._colorRGBKeysCount=0,this._colorAlphaKeysCount=0,this._alphaElements=null,this._rgbElements=null,this._maxColorRGBKeysCount=e,this._maxColorAlphaKeysCount=t,this._rgbElements=new Float32Array(4*e),this._alphaElements=new Float32Array(2*t)}return C(n,[{key:"addColorRGB",value:function(e,t){var n;this._colorRGBKeysCount<this._maxColorRGBKeysCount?(n=4*this._colorRGBKeysCount,this._rgbElements[n]=e,this._rgbElements[1+n]=t.r,this._rgbElements[2+n]=t.g,this._rgbElements[3+n]=t.b,this._colorRGBKeysCount++):console.warn("Gradient:warning:data count must lessEqual than "+this._maxColorRGBKeysCount)}},{key:"addColorAlpha",value:function(e,t){var n;this._colorAlphaKeysCount<this._maxColorAlphaKeysCount?(n=2*this._colorAlphaKeysCount,this._alphaElements[n]=e,this._alphaElements[1+n]=t,this._colorAlphaKeysCount++):console.warn("Gradient:warning:data count must lessEqual than "+this._maxColorAlphaKeysCount)}},{key:"updateColorRGB",value:function(e,t,n){e<this._colorRGBKeysCount?(e=4*e,this._rgbElements[e]=t,this._rgbElements[1+e]=n.r,this._rgbElements[2+e]=n.g,this._rgbElements[3+e]=n.b):console.warn("Gradient:warning:index must lessEqual than colorRGBKeysCount:"+this._colorRGBKeysCount)}},{key:"updateColorAlpha",value:function(e,t,n){e<this._colorAlphaKeysCount?(e=2*e,this._alphaElements[e]=t,this._alphaElements[1+e]=n):console.warn("Gradient:warning:index must lessEqual than colorAlphaKeysCount:"+this._colorAlphaKeysCount)}},{key:"evaluateColorRGB",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e=Math.min(Math.max(e,0),1);var a=this._rgbElements,r=n;if(i)for(var o=r;0<=o;o--){var s=4*o;if(e===(c=a[s]))return t.r=a[s+1],t.g=a[s+2],t.b=a[s+3],r;switch(this._mode){case bl.Blend:if(c<e){if((d=a[s+4])<e)throw"Gradient:wrong startSearchIndex.";var l=d-c,h=d-e,u=e-c;return t.r=(h*a[s+1]+u*a[s+5])/l,t.g=(h*a[s+2]+u*a[s+6])/l,t.b=(h*a[s+3]+u*a[s+7])/l,r}r--;continue;case bl.Fixed:if(c<e){if(e>a[s+4])throw"Gradient:wrong startSearchIndex.";return t.r=a[s+5],t.g=a[s+6],t.b=a[s+7],r}r--;continue;default:throw"Gradient:unknown mode."}}else for(var d,c,o=0,_=this._rgbElements.length;o<_;o++){if(e===(d=a[s=4*o]))return t.r=a[s+1],t.g=a[s+2],t.b=a[s+3],r;switch(this._mode){case bl.Blend:if(e<d){if(e<(c=a[s-4]))throw"Gradient:wrong startSearchIndex.";l=d-c,h=d-e,u=e-c;return t.r=(h*a[s-3]+u*a[s+1])/l,t.g=(h*a[s-2]+u*a[s+2])/l,t.b=(h*a[s-1]+u*a[s+3])/l,r}r++;continue;case bl.Fixed:if(e<d){if(e<a[s-4])throw"Gradient:wrong startSearchIndex.";return t.r=a[s+1],t.g=a[s+2],t.b=a[s+3],r}r++;continue;default:throw"Gradient:unknown mode."}}return r}},{key:"evaluateColorAlpha",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e=Math.min(Math.max(e,0),1);var a=this._alphaElements,r=n;if(i)for(var o=r;0<=o;o--){if(e===(c=a[u=2*o]))return t.a=a[u+1],r;switch(this._mode){case bl.Blend:if(c<e){if((d=a[u+2])<e)throw"Gradient:wrong startSearchIndex.";var s=d-c,l=d-e,h=e-c;return t.a=(l*a[u+1]+h*a[u+3])/s,r}r--;continue;case bl.Fixed:if(c<e){if(e>a[u+2])throw"Gradient:wrong startSearchIndex.";return t.a=a[u+3],r}r--;continue;default:throw"Gradient:unknown mode."}}else for(var u,d,c,o=r,_=this._alphaElements.length;o<_;o++){if(e===(d=a[u=2*o]))return t.a=a[u+1],r;switch(this._mode){case bl.Blend:if(e<d){if(e<(c=a[u-2]))throw"Gradient:wrong startSearchIndex.";s=d-c,l=d-e,h=e-c;return t.a=(l*a[u-1]+h*a[u+1])/s,r}r++;continue;case bl.Fixed:if(e<d){if(e<a[u-2])throw"Gradient:wrong startSearchIndex.";return t.a=a[u+1],r}r++;continue;default:throw"Gradient:unknown mode."}}return r}},{key:"cloneTo",value:function(e){e._colorAlphaKeysCount=this._colorAlphaKeysCount;for(var t=e._alphaElements,n=0,i=this._alphaElements.length;n<i;n++)t[n]=this._alphaElements[n];e._colorRGBKeysCount=this._colorRGBKeysCount;var a=e._rgbElements;for(n=0,i=this._rgbElements.length;n<i;n++)a[n]=this._rgbElements[n]}},{key:"clone",value:function(){var e=new n(this._maxColorRGBKeysCount,this._maxColorAlphaKeysCount);return this.cloneTo(e),e}},{key:"mode",get:function(){return this._mode},set:function(e){this._mode=e}},{key:"colorRGBKeysCount",get:function(){return this._colorRGBKeysCount}},{key:"colorAlphaKeysCount",get:function(){return this._colorAlphaKeysCount}},{key:"maxColorRGBKeysCount",get:function(){return this._maxColorRGBKeysCount}},{key:"maxColorAlphaKeysCount",get:function(){return this._maxColorAlphaKeysCount}}]),n}(),Il=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("PARTICLESHURIKEN"),e._color=new yn(1,1,1,1),e.renderMode=n.RENDERMODE_ALPHABLENDED,e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"_TintColorR",get:function(){return this._color.x},set:function(e){this._color.x=e,this.color=this._color}},{key:"_TintColorG",get:function(){return this._color.y},set:function(e){this._color.y=e,this.color=this._color}},{key:"_TintColorB",get:function(){return this._color.z},set:function(e){this._color.z=e,this.color=this._color}},{key:"_TintColorA",get:function(){return this._color.w},set:function(e){this._color.w=e,this.color=this._color}},{key:"_MainTex_STX",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.x=e,this.tilingOffset=t}},{key:"_MainTex_STY",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.y=e,this.tilingOffset=t}},{key:"_MainTex_STZ",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.z=e,this.tilingOffset=t}},{key:"_MainTex_STW",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.w=e,this.tilingOffset=t}},{key:"renderMode",set:function(e){switch(e){case n.RENDERMODE_ADDTIVE:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.depthWrite=!1,this.cull=ur.CULL_NONE,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE,this.alphaTest=!1,this._shaderValues.addDefine(n.SHADERDEFINE_ADDTIVEFOG);break;case n.RENDERMODE_ALPHABLENDED:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.depthWrite=!1,this.cull=ur.CULL_NONE,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this._shaderValues.removeDefine(n.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("ShurikenParticleMaterial : renderMode value error.")}}},{key:"colorR",get:function(){return this._TintColorR},set:function(e){this._TintColorR=e}},{key:"colorG",get:function(){return this._TintColorG},set:function(e){this._TintColorG=e}},{key:"colorB",get:function(){return this._TintColorB},set:function(e){this._TintColorB=e}},{key:"colorA",get:function(){return this._TintColorA},set:function(e){this._TintColorA=e}},{key:"color",get:function(){return this._shaderValues.getVector(n.TINTCOLOR)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_TINTCOLOR):this._shaderValues.removeDefine(n.SHADERDEFINE_TINTCOLOR),this._shaderValues.setVector(n.TINTCOLOR,e)}},{key:"tilingOffsetX",get:function(){return this._MainTex_STX},set:function(e){this._MainTex_STX=e}},{key:"tilingOffsetY",get:function(){return this._MainTex_STY},set:function(e){this._MainTex_STY=e}},{key:"tilingOffsetZ",get:function(){return this._MainTex_STZ},set:function(e){this._MainTex_STZ=e}},{key:"tilingOffsetW",get:function(){return this._MainTex_STW},set:function(e){this._MainTex_STW=e}},{key:"tilingOffset",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET)},set:function(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(n.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(n.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,e)}},{key:"texture",get:function(){return this._shaderValues.getTexture(n.DIFFUSETEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_DIFFUSEMAP):this._shaderValues.removeDefine(n.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(n.DIFFUSETEXTURE,e)}},{key:"depthWrite",get:function(){return this._shaderValues.getBool(n.DEPTH_WRITE)},set:function(e){this._shaderValues.setBool(n.DEPTH_WRITE,e)}},{key:"cull",get:function(){return this._shaderValues.getInt(n.CULL)},set:function(e){this._shaderValues.setInt(n.CULL,e)}},{key:"blend",get:function(){return this._shaderValues.getInt(n.BLEND)},set:function(e){this._shaderValues.setInt(n.BLEND,e)}},{key:"blendSrc",get:function(){return this._shaderValues.getInt(n.BLEND_SRC)},set:function(e){this._shaderValues.setInt(n.BLEND_SRC,e)}},{key:"blendDst",get:function(){return this._shaderValues.getInt(n.BLEND_DST)},set:function(e){this._shaderValues.setInt(n.BLEND_DST,e)}},{key:"depthTest",get:function(){return this._shaderValues.getInt(n.DEPTH_TEST)},set:function(e){this._shaderValues.setInt(n.DEPTH_TEST,e)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_DIFFUSEMAP=ca.getDefineByName("DIFFUSEMAP"),n.SHADERDEFINE_TINTCOLOR=ca.getDefineByName("TINTCOLOR"),n.SHADERDEFINE_ADDTIVEFOG=ca.getDefineByName("ADDTIVEFOG"),n.SHADERDEFINE_TILINGOFFSET=ca.getDefineByName("TILINGOFFSET")}}]),n}();function Nl(){S(this,Nl)}function Rl(){S(this,Rl)}Il.RENDERMODE_ALPHABLENDED=0,Il.RENDERMODE_ADDTIVE=1,Il.DIFFUSETEXTURE=ca.propertyNameToID("u_texture"),Il.TINTCOLOR=ca.propertyNameToID("u_Tintcolor"),Il.TILINGOFFSET=ca.propertyNameToID("u_TilingOffset"),Il.CULL=ca.propertyNameToID("s_Cull"),Il.BLEND=ca.propertyNameToID("s_Blend"),Il.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),Il.BLEND_DST=ca.propertyNameToID("s_BlendDst"),Il.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),Il.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite"),Nl.WORLDPOSITION=ca.propertyNameToID("u_WorldPosition"),Nl.WORLDROTATION=ca.propertyNameToID("u_WorldRotation"),Nl.POSITIONSCALE=ca.propertyNameToID("u_PositionScale"),Nl.SIZESCALE=ca.propertyNameToID("u_SizeScale"),Nl.SCALINGMODE=ca.propertyNameToID("u_ScalingMode"),Nl.GRAVITY=ca.propertyNameToID("u_Gravity"),Nl.THREEDSTARTROTATION=ca.propertyNameToID("u_ThreeDStartRotation"),Nl.STRETCHEDBILLBOARDLENGTHSCALE=ca.propertyNameToID("u_StretchedBillboardLengthScale"),Nl.STRETCHEDBILLBOARDSPEEDSCALE=ca.propertyNameToID("u_StretchedBillboardSpeedScale"),Nl.SIMULATIONSPACE=ca.propertyNameToID("u_SimulationSpace"),Nl.CURRENTTIME=ca.propertyNameToID("u_CurrentTime"),Nl.VOLVELOCITYCONST=ca.propertyNameToID("u_VOLVelocityConst"),Nl.VOLVELOCITYGRADIENTX=ca.propertyNameToID("u_VOLVelocityGradientX"),Nl.VOLVELOCITYGRADIENTY=ca.propertyNameToID("u_VOLVelocityGradientY"),Nl.VOLVELOCITYGRADIENTZ=ca.propertyNameToID("u_VOLVelocityGradientZ"),Nl.VOLVELOCITYCONSTMAX=ca.propertyNameToID("u_VOLVelocityConstMax"),Nl.VOLVELOCITYGRADIENTXMAX=ca.propertyNameToID("u_VOLVelocityGradientMaxX"),Nl.VOLVELOCITYGRADIENTYMAX=ca.propertyNameToID("u_VOLVelocityGradientMaxY"),Nl.VOLVELOCITYGRADIENTZMAX=ca.propertyNameToID("u_VOLVelocityGradientMaxZ"),Nl.VOLSPACETYPE=ca.propertyNameToID("u_VOLSpaceType"),Nl.COLOROVERLIFEGRADIENTALPHAS=ca.propertyNameToID("u_ColorOverLifeGradientAlphas"),Nl.COLOROVERLIFEGRADIENTCOLORS=ca.propertyNameToID("u_ColorOverLifeGradientColors"),Nl.MAXCOLOROVERLIFEGRADIENTALPHAS=ca.propertyNameToID("u_MaxColorOverLifeGradientAlphas"),Nl.MAXCOLOROVERLIFEGRADIENTCOLORS=ca.propertyNameToID("u_MaxColorOverLifeGradientColors"),Nl.SOLSIZEGRADIENT=ca.propertyNameToID("u_SOLSizeGradient"),Nl.SOLSIZEGRADIENTX=ca.propertyNameToID("u_SOLSizeGradientX"),Nl.SOLSIZEGRADIENTY=ca.propertyNameToID("u_SOLSizeGradientY"),Nl.SOLSizeGradientZ=ca.propertyNameToID("u_SOLSizeGradientZ"),Nl.SOLSizeGradientMax=ca.propertyNameToID("u_SOLSizeGradientMax"),Nl.SOLSIZEGRADIENTXMAX=ca.propertyNameToID("u_SOLSizeGradientMaxX"),Nl.SOLSIZEGRADIENTYMAX=ca.propertyNameToID("u_SOLSizeGradientMaxY"),Nl.SOLSizeGradientZMAX=ca.propertyNameToID("u_SOLSizeGradientMaxZ"),Nl.ROLANGULARVELOCITYCONST=ca.propertyNameToID("u_ROLAngularVelocityConst"),Nl.ROLANGULARVELOCITYCONSTSEPRARATE=ca.propertyNameToID("u_ROLAngularVelocityConstSeprarate"),Nl.ROLANGULARVELOCITYGRADIENT=ca.propertyNameToID("u_ROLAngularVelocityGradient"),Nl.ROLANGULARVELOCITYGRADIENTX=ca.propertyNameToID("u_ROLAngularVelocityGradientX"),Nl.ROLANGULARVELOCITYGRADIENTY=ca.propertyNameToID("u_ROLAngularVelocityGradientY"),Nl.ROLANGULARVELOCITYGRADIENTZ=ca.propertyNameToID("u_ROLAngularVelocityGradientZ"),Nl.ROLANGULARVELOCITYCONSTMAX=ca.propertyNameToID("u_ROLAngularVelocityConstMax"),Nl.ROLANGULARVELOCITYCONSTMAXSEPRARATE=ca.propertyNameToID("u_ROLAngularVelocityConstMaxSeprarate"),Nl.ROLANGULARVELOCITYGRADIENTMAX=ca.propertyNameToID("u_ROLAngularVelocityGradientMax"),Nl.ROLANGULARVELOCITYGRADIENTXMAX=ca.propertyNameToID("u_ROLAngularVelocityGradientMaxX"),Nl.ROLANGULARVELOCITYGRADIENTYMAX=ca.propertyNameToID("u_ROLAngularVelocityGradientMaxY"),Nl.ROLANGULARVELOCITYGRADIENTZMAX=ca.propertyNameToID("u_ROLAngularVelocityGradientMaxZ"),Nl.ROLANGULARVELOCITYGRADIENTWMAX=ca.propertyNameToID("u_ROLAngularVelocityGradientMaxW"),Nl.TEXTURESHEETANIMATIONCYCLES=ca.propertyNameToID("u_TSACycles"),Nl.TEXTURESHEETANIMATIONSUBUVLENGTH=ca.propertyNameToID("u_TSASubUVLength"),Nl.TEXTURESHEETANIMATIONGRADIENTUVS=ca.propertyNameToID("u_TSAGradientUVs"),Nl.TEXTURESHEETANIMATIONGRADIENTMAXUVS=ca.propertyNameToID("u_TSAMaxGradientUVs");var Cl=function(){T(n,fr);var t=b(n);function n(e){return S(this,n),(e=t.call(this,e))._finalGravity=new vn,e._tempRotationMatrix=new ki,e._renderMode=0,e._mesh=null,e.stretchedBillboardCameraSpeedScale=0,e.stretchedBillboardSpeedScale=0,e.stretchedBillboardLengthScale=0,e._defaultBoundBox=new cr(new vn,new vn),e._renderMode=-1,e.stretchedBillboardCameraSpeedScale=0,e.stretchedBillboardSpeedScale=0,e.stretchedBillboardLengthScale=1,e._supportOctree=!1,e}return C(n,[{key:"_calculateBoundingBox",value:function(){var e=this._bounds.getMin();e.x=-Number.MAX_VALUE,e.y=-Number.MAX_VALUE,e.z=-Number.MAX_VALUE,this._bounds.setMin(e);var t,n=this._bounds.getMax();n.x=Number.MAX_VALUE,n.y=Number.MAX_VALUE,n.z=Number.MAX_VALUE,this._bounds.setMax(n),yt.supportWebGLPlusCulling&&(e=this._bounds.getMin(),n=this._bounds.getMax(),(t=ba._cullingBuffer)[this._cullingBufferIndex+1]=e.x,t[this._cullingBufferIndex+2]=e.y,t[this._cullingBufferIndex+3]=e.z,t[this._cullingBufferIndex+4]=n.x,t[this._cullingBufferIndex+5]=n.y,t[this._cullingBufferIndex+6]=n.z)}},{key:"_needRender",value:function(e,t){return!e||!!e.intersects(this.bounds._getBoundBox())&&!!this._owner.particleSystem.isAlive}},{key:"_renderUpdate",value:function(e,t){var n=this._owner.particleSystem,i=this._shaderValues,a=this._owner.transform;switch(n.simulationSpace){case 0:break;case 1:i.setVector3(Nl.WORLDPOSITION,a.position),i.setQuaternion(Nl.WORLDROTATION,a.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(n.scaleMode){case 0:var r=a.getWorldLossyScale();i.setVector3(Nl.POSITIONSCALE,r),i.setVector3(Nl.SIZESCALE,r);break;case 1:r=a.localScale;i.setVector3(Nl.POSITIONSCALE,r),i.setVector3(Nl.SIZESCALE,r);break;case 2:i.setVector3(Nl.POSITIONSCALE,a.getWorldLossyScale()),i.setVector3(Nl.SIZESCALE,vn._ONE)}vn.scale(Mr.gravity,n.gravityModifier,this._finalGravity),i.setVector3(Nl.GRAVITY,this._finalGravity),i.setInt(Nl.SIMULATIONSPACE,n.simulationSpace),i.setBool(Nl.THREEDSTARTROTATION,n.threeDStartRotation),i.setInt(Nl.SCALINGMODE,n.scaleMode),i.setNumber(Nl.STRETCHEDBILLBOARDLENGTHSCALE,this.stretchedBillboardLengthScale),i.setNumber(Nl.STRETCHEDBILLBOARDSPEEDSCALE,this.stretchedBillboardSpeedScale),i.setNumber(Nl.CURRENTTIME,n._currentTime)}},{key:"_destroy",value:function(){G(z(n.prototype),"_destroy",this).call(this),this._mesh&&(this._mesh._removeReference(),this._mesh=null)}},{key:"renderMode",get:function(){return this._renderMode},set:function(e){if(this._renderMode!==e){var t=this._shaderValues;switch(this._renderMode){case 0:t.removeDefine(Nl.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:t.removeDefine(Nl.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:t.removeDefine(Nl.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:t.removeDefine(Nl.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:t.removeDefine(Nl.SHADERDEFINE_RENDERMODE_MESH)}switch(this._renderMode=e){case 0:t.addDefine(Nl.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:t.addDefine(Nl.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:t.addDefine(Nl.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:t.addDefine(Nl.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:t.addDefine(Nl.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}this._owner.particleSystem._initBufferDatas()}}},{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh&&this._mesh._removeReference(),(this._mesh=e)&&e._addReference(),this._owner.particleSystem._initBufferDatas())}},{key:"bounds",get:function(){return this._boundsChange&&(this._calculateBoundingBox(),this._boundsChange=!1),this._bounds}}]),n}();Rl.PARTICLE_CORNERTEXTURECOORDINATE0=0,Rl.PARTICLE_POSITION0=1,Rl.PARTICLE_COLOR0=2,Rl.PARTICLE_TEXTURECOORDINATE0=3,Rl.PARTICLE_SHAPEPOSITIONSTARTLIFETIME=4,Rl.PARTICLE_DIRECTIONTIME=5,Rl.PARTICLE_STARTCOLOR0=6,Rl.PARTICLE_ENDCOLOR0=7,Rl.PARTICLE_STARTSIZE=8,Rl.PARTICLE_STARTROTATION=9,Rl.PARTICLE_STARTSPEED=10,Rl.PARTICLE_RANDOM0=11,Rl.PARTICLE_RANDOM1=12,Rl.PARTICLE_SIMULATIONWORLDPOSTION=13,Rl.PARTICLE_SIMULATIONWORLDROTATION=14;var Al=function(){T(y,Rl);var g=b(y);function y(e,t,n,i,a,r,o,s,l,h,u,d,c,_){var f;return S(this,y),(f=g.call(this))._cornerTextureCoordinate=e,f._positionStartLifeTime=t,f._velocity=n,f._startColor=i,f._startSize=a,f._startRotation0=r,f._startRotation1=o,f._startRotation2=s,f._startLifeTime=l,f._time=h,f._startSpeed=u,f._randoms0=f.random0,f._randoms1=f.random1,f._simulationWorldPostion=_,f}return C(y,[{key:"cornerTextureCoordinate",get:function(){return this._cornerTextureCoordinate}},{key:"positionStartLifeTime",get:function(){return this._positionStartLifeTime}},{key:"velocity",get:function(){return this._velocity}},{key:"startColor",get:function(){return this._startColor}},{key:"startSize",get:function(){return this._startSize}},{key:"startRotation0",get:function(){return this._startRotation0}},{key:"startRotation1",get:function(){return this._startRotation1}},{key:"startRotation2",get:function(){return this._startRotation2}},{key:"startLifeTime",get:function(){return this._startLifeTime}},{key:"time",get:function(){return this._time}},{key:"startSpeed",get:function(){return this._startSpeed}},{key:"random0",get:function(){return this._randoms0}},{key:"random1",get:function(){return this._randoms1}},{key:"simulationWorldPostion",get:function(){return this._simulationWorldPostion}}],[{key:"__init__",value:function(){y._vertexDeclaration=new pa(152,[new ma(0,ya.Vector4,Rl.PARTICLE_CORNERTEXTURECOORDINATE0),new ma(16,ya.Vector4,Rl.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),new ma(32,ya.Vector4,Rl.PARTICLE_DIRECTIONTIME),new ma(48,ya.Vector4,Rl.PARTICLE_STARTCOLOR0),new ma(64,ya.Vector3,Rl.PARTICLE_STARTSIZE),new ma(76,ya.Vector3,Rl.PARTICLE_STARTROTATION),new ma(88,ya.Single,Rl.PARTICLE_STARTSPEED),new ma(92,ya.Vector4,Rl.PARTICLE_RANDOM0),new ma(108,ya.Vector4,Rl.PARTICLE_RANDOM1),new ma(124,ya.Vector3,Rl.PARTICLE_SIMULATIONWORLDPOSTION),new ma(136,ya.Vector4,Rl.PARTICLE_SIMULATIONWORLDROTATION)])}},{key:"vertexDeclaration",get:function(){return y._vertexDeclaration}}]),y}(),Dl=function(){T(y,Rl);var g=b(y);function y(e,t,n,i,a,r,o,s,l,h,u,d,c,_){var f;return S(this,y),(f=g.call(this))._cornerTextureCoordinate=e,f._positionStartLifeTime=t,f._velocity=n,f._startColor=i,f._startSize=a,f._startRotation0=r,f._startRotation1=o,f._startRotation2=s,f._startLifeTime=l,f._time=h,f._startSpeed=u,f._randoms0=f.random0,f._randoms1=f.random1,f._simulationWorldPostion=_,f}return C(y,[{key:"cornerTextureCoordinate",get:function(){return this._cornerTextureCoordinate}},{key:"position",get:function(){return this._positionStartLifeTime}},{key:"velocity",get:function(){return this._velocity}},{key:"startColor",get:function(){return this._startColor}},{key:"startSize",get:function(){return this._startSize}},{key:"startRotation0",get:function(){return this._startRotation0}},{key:"startRotation1",get:function(){return this._startRotation1}},{key:"startRotation2",get:function(){return this._startRotation2}},{key:"startLifeTime",get:function(){return this._startLifeTime}},{key:"time",get:function(){return this._time}},{key:"startSpeed",get:function(){return this._startSpeed}},{key:"random0",get:function(){return this._randoms0}},{key:"random1",get:function(){return this._randoms1}},{key:"simulationWorldPostion",get:function(){return this._simulationWorldPostion}}],[{key:"__init__",value:function(){y._vertexDeclaration=new pa(172,[new ma(0,ya.Vector3,Rl.PARTICLE_POSITION0),new ma(12,ya.Vector4,Rl.PARTICLE_COLOR0),new ma(28,ya.Vector2,Rl.PARTICLE_TEXTURECOORDINATE0),new ma(36,ya.Vector4,Rl.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),new ma(52,ya.Vector4,Rl.PARTICLE_DIRECTIONTIME),new ma(68,ya.Vector4,Rl.PARTICLE_STARTCOLOR0),new ma(84,ya.Vector3,Rl.PARTICLE_STARTSIZE),new ma(96,ya.Vector3,Rl.PARTICLE_STARTROTATION),new ma(108,ya.Single,Rl.PARTICLE_STARTSPEED),new ma(112,ya.Vector4,Rl.PARTICLE_RANDOM0),new ma(128,ya.Vector4,Rl.PARTICLE_RANDOM1),new ma(144,ya.Vector3,Rl.PARTICLE_SIMULATIONWORLDPOSTION),new ma(156,ya.Vector4,Rl.PARTICLE_SIMULATIONWORLDROTATION)])}},{key:"vertexDeclaration",get:function(){return y._vertexDeclaration}}]),y}(),Ll=function(){function u(e,t){S(this,u),this.center=e,this.radius=t}return C(u,[{key:"toDefault",value:function(){this.center.toDefault(),this.radius=0}},{key:"intersectsRayDistance",value:function(e){return Pa.intersectsRayAndSphereRD(e,this)}},{key:"intersectsRayPoint",value:function(e,t){return Pa.intersectsRayAndSphereRP(e,this,t)}},{key:"cloneTo",value:function(e){this.center.cloneTo(e.center),e.radius=this.radius}},{key:"clone",value:function(){var e=new u(new vn,0);return this.cloneTo(e),e}}],[{key:"createFromSubPoints",value:function(e,t,n,i){if(null==e)throw new Error("points");if(t<0||t>=e.length)throw new Error("start"+t+"Must be in the range [0, "+(e.length-1)+"]");if(n<0||t+n>e.length)throw new Error("count"+n+"Must be in the range <= "+e.length+"}");var a=t+n,r=u._tempVector3;r.x=0,r.y=0,r.z=0;for(var o=t;o<a;++o)vn.add(e[o],r,r);var s=i.center;vn.scale(r,1/n,s);for(var l=0,o=t;o<a;++o){var h=vn.distanceSquared(s,e[o]);l<h&&(l=h)}i.radius=Math.sqrt(l)}},{key:"createfromPoints",value:function(e,t){if(null==e)throw new Error("points");u.createFromSubPoints(e,0,e.length,t)}}]),u}();Ll._tempVector3=new vn;var Ol=function(){function t(e){S(this,t),this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=e,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}return C(t,[{key:"getUint",value:function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^(this._temp[0]^this._temp[0]>>>8),this.seeds[3]}},{key:"getFloat",value:function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)}},{key:"getSignedFloat",value:function(){return 2*this.getFloat()-1}},{key:"seed",get:function(){return this.seeds[0]},set:function(e){this.seeds[0]=e,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}}],[{key:"getFloatFromInt",value:function(e){return 1/8388607*(8388607&e)}},{key:"getByteFromInt",value:function(e){return(8388607&e)>>>15}}]),t}(),Pl=function(){function t(){S(this,t),this._destroyed=!1,this.emissionRate=10,this._bursts=[]}return C(t,[{key:"destroy",value:function(){this._bursts=null,this._destroyed=!0}},{key:"getBurstsCount",value:function(){return this._bursts.length}},{key:"getBurstByIndex",value:function(e){return this._bursts[e]}},{key:"addBurst",value:function(e){var t=this._bursts.length;if(0<t)for(var n=0;n<t;n++)this._bursts[n].time>e.time&&this._bursts.splice(n,0,e);this._bursts.push(e)}},{key:"removeBurst",value:function(e){e=this._bursts.indexOf(e);-1!==e&&this._bursts.splice(e,1)}},{key:"removeBurstByIndex",value:function(e){this._bursts.splice(e,1)}},{key:"clearBurst",value:function(){this._bursts.length=0}},{key:"cloneTo",value:function(e){var e=e,t=e._bursts;t.length=this._bursts.length;for(var n=0,i=this._bursts.length;n<i;n++){var a=t[n];a?this._bursts[n].cloneTo(a):t[n]=this._bursts[n].clone()}e._emissionRate=this._emissionRate,e.enbale=this.enbale}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}},{key:"emissionRate",set:function(e){if(e<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=e},get:function(){return this._emissionRate}},{key:"destroyed",get:function(){return this._destroyed}}]),t}(),Fl=function(){function t(){S(this,t),this._currentLength=0,this._elements=new Float32Array(8)}return C(t,[{key:"add",value:function(e,t){this._currentLength<8?(6===this._currentLength&&1!==e&&(e=1,console.log("GradientDataNumber warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=e,this._elements[this._currentLength++]=t):console.log("GradientDataNumber warning:data count must lessEqual than 4")}},{key:"getKeyByIndex",value:function(e){return this._elements[2*e]}},{key:"getValueByIndex",value:function(e){return this._elements[2*e+1]}},{key:"getAverageValue",value:function(){for(var e=0,t=this._currentLength-2;e<t;e+=2){this._elements[e+1];this._elements[e+3],this._elements[e+2],this._elements[e]}return 0}},{key:"cloneTo",value:function(e){e._currentLength=this._currentLength;for(var t=e._elements,n=0,i=this._elements.length;n<i;n++)t[n]=this._elements[n]}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}},{key:"gradientCount",get:function(){return this._currentLength/2}}]),t}(),Bl=function(){function R(){S(this,R)}return C(R,null,[{key:"_getStartLifetimeFromGradient",value:function(e,t){for(var n=1,i=e.gradientCount;n<i;n++){var a=e.getKeyByIndex(n);if(t<=a){var r=e.getKeyByIndex(n-1),r=(t-r)/(a-r);return kn.lerp(e.getValueByIndex(n-1),e.getValueByIndex(n),r)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")}},{key:"_randomInvertRoationArray",value:function(e,t,n,i,a){var r;i?(i.seed=a[6],r=i.getFloat(),a[6]=i.seed):r=Math.random(),r<n?(t.x=-e.x,t.y=-e.y,t.z=-e.z):(t.x=e.x,t.y=e.y,t.z=e.z)}},{key:"_randomInvertRoation",value:function(e,t,n,i){var a;return n?(n.seed=i[6],a=n.getFloat(),i[6]=n.seed):a=Math.random(),e=a<t?-e:e}},{key:"create",value:function(e,t,n){var i=e.autoRandomSeed,a=e._rand,r=e._randomSeeds;switch(e.startColorType){case 0:var o=e.startColorConstant;R.startColor.x=o.x,R.startColor.y=o.y,R.startColor.z=o.z,R.startColor.w=o.w;break;case 2:i?yn.lerp(e.startColorConstantMin,e.startColorConstantMax,Math.random(),R.startColor):(a.seed=r[3],yn.lerp(e.startColorConstantMin,e.startColorConstantMax,a.getFloat(),R.startColor),r[3]=a.seed)}var s=e.colorOverLifetime;if(s&&s.enbale){var l,h=s.color;switch(h.type){case 0:R.startColor.x=R.startColor.x*h.constant.x,R.startColor.y=R.startColor.y*h.constant.y,R.startColor.z=R.startColor.z*h.constant.z,R.startColor.w=R.startColor.w*h.constant.w;break;case 2:i?l=Math.random():(a.seed=r[10],l=a.getFloat(),r[10]=a.seed);var u=h.constantMin,d=h.constantMax;R.startColor.x=R.startColor.x*kn.lerp(u.x,d.x,l),R.startColor.y=R.startColor.y*kn.lerp(u.y,d.y,l),R.startColor.z=R.startColor.z*kn.lerp(u.z,d.z,l),R.startColor.w=R.startColor.w*kn.lerp(u.w,d.w,l)}}var c,_,f=R.startSize;switch(e.startSizeType){case 0:e.threeDStartSize?(_=e.startSizeConstantSeparate,f[0]=_.x,f[1]=_.y,f[2]=_.z):f[0]=f[1]=f[2]=e.startSizeConstant;break;case 2:e.threeDStartSize?(c=e.startSizeConstantMinSeparate,_=e.startSizeConstantMaxSeparate,i?(f[0]=kn.lerp(c.x,_.x,Math.random()),f[1]=kn.lerp(c.y,_.y,Math.random()),f[2]=kn.lerp(c.z,_.z,Math.random())):(a.seed=r[4],f[0]=kn.lerp(c.x,_.x,a.getFloat()),f[1]=kn.lerp(c.y,_.y,a.getFloat()),f[2]=kn.lerp(c.z,_.z,a.getFloat()),r[4]=a.seed)):i?f[0]=f[1]=f[2]=kn.lerp(e.startSizeConstantMin,e.startSizeConstantMax,Math.random()):(a.seed=r[4],f[0]=f[1]=f[2]=kn.lerp(e.startSizeConstantMin,e.startSizeConstantMax,a.getFloat()),r[4]=a.seed)}s=e.sizeOverLifetime;s&&s.enbale&&1===s.size.type&&((k=s.size).separateAxes?i?(f[0]=f[0]*kn.lerp(k.constantMinSeparate.x,k.constantMaxSeparate.x,Math.random()),f[1]=f[1]*kn.lerp(k.constantMinSeparate.y,k.constantMaxSeparate.y,Math.random()),f[2]=f[2]*kn.lerp(k.constantMinSeparate.z,k.constantMaxSeparate.z,Math.random())):(a.seed=r[11],f[0]=f[0]*kn.lerp(k.constantMinSeparate.x,k.constantMaxSeparate.x,a.getFloat()),f[1]=f[1]*kn.lerp(k.constantMinSeparate.y,k.constantMaxSeparate.y,a.getFloat()),f[2]=f[2]*kn.lerp(k.constantMinSeparate.z,k.constantMaxSeparate.z,a.getFloat()),r[11]=a.seed):(i?M=kn.lerp(k.constantMin,k.constantMax,Math.random()):(a.seed=r[11],M=kn.lerp(k.constantMin,k.constantMax,a.getFloat()),r[11]=a.seed),f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M));var g,y,v,p=t.renderMode;if(1!==p)switch(e.startRotationType){case 0:e.threeDStartRotation?(y=e.startRotationConstantSeparate,R._randomInvertRoationArray(y,v=R._tempVector30,e.randomizeRotationDirection,i?null:a,r),R.startRotation[0]=v.x,R.startRotation[1]=v.y,R.startRotation[2]=4!==p?-v.z:v.z):(R.startRotation[0]=R._randomInvertRoation(e.startRotationConstant,e.randomizeRotationDirection,i?null:a,r),R.startRotation[1]=0,R.startRotation[2]=0);break;case 2:e.threeDStartRotation?(g=e.startRotationConstantMinSeparate,y=e.startRotationConstantMaxSeparate,v=R._tempVector30,i?(v.x=kn.lerp(g.x,y.x,Math.random()),v.y=kn.lerp(g.y,y.y,Math.random()),v.z=kn.lerp(g.z,y.z,Math.random())):(a.seed=r[5],v.x=kn.lerp(g.x,y.x,a.getFloat()),v.y=kn.lerp(g.y,y.y,a.getFloat()),v.z=kn.lerp(g.z,y.z,a.getFloat()),r[5]=a.seed),R._randomInvertRoationArray(v,v,e.randomizeRotationDirection,i?null:a,r),R.startRotation[0]=v.x,R.startRotation[1]=v.y,R.startRotation[2]=4!==p?-v.z:v.z):i?R.startRotation[0]=R._randomInvertRoation(kn.lerp(e.startRotationConstantMin,e.startRotationConstantMax,Math.random()),e.randomizeRotationDirection,i?null:a,r):(a.seed=r[5],R.startRotation[0]=R._randomInvertRoation(kn.lerp(e.startRotationConstantMin,e.startRotationConstantMax,a.getFloat()),e.randomizeRotationDirection,i?null:a,r),r[5]=a.seed)}switch(e.startLifetimeType){case 0:R.startLifeTime=e.startLifetimeConstant;break;case 1:R.startLifeTime=R._getStartLifetimeFromGradient(e.startLifeTimeGradient,e.emissionTime);break;case 2:i?R.startLifeTime=kn.lerp(e.startLifetimeConstantMin,e.startLifetimeConstantMax,Math.random()):(a.seed=r[7],R.startLifeTime=kn.lerp(e.startLifetimeConstantMin,e.startLifetimeConstantMax,a.getFloat()),r[7]=a.seed);break;case 3:var m=e.emissionTime;i?R.startLifeTime=kn.lerp(R._getStartLifetimeFromGradient(e.startLifeTimeGradientMin,m),R._getStartLifetimeFromGradient(e.startLifeTimeGradientMax,m),Math.random()):(a.seed=r[7],R.startLifeTime=kn.lerp(R._getStartLifetimeFromGradient(e.startLifeTimeGradientMin,m),R._getStartLifetimeFromGradient(e.startLifeTimeGradientMax,m),a.getFloat()),r[7]=a.seed)}var w=e.textureSheetAnimation;if(w&&w.enable){var x,k=w.tiles,T=k.x,E=k.y,M=1/T,t=1/E,b=w.startFrame;switch(b.type){case 0:x=b.constant;break;case 1:i?x=kn.lerp(b.constantMin,b.constantMax,Math.random()):(a.seed=r[14],x=kn.lerp(b.constantMin,b.constantMax,a.getFloat()),r[14]=a.seed)}var S=w.frame,I=w.cycles;switch(S.type){case 0:x+=S.constant*I;break;case 2:i?x+=kn.lerp(S.constantMin,S.constantMax,Math.random())*I:(a.seed=r[15],x+=kn.lerp(S.constantMin,S.constantMax,a.getFloat())*I,r[15]=a.seed)}var N=0;switch(w.type){case 0:N=Math.floor(x/T);break;case 1:w.randomRow?i?N=Math.floor(Math.random()*E):(a.seed=r[13],N=Math.floor(a.getFloat()*E),r[13]=a.seed):N=w.rowIndex}k=Math.floor(x%T);R.startUVInfo[0]=M,R.startUVInfo[1]=t,R.startUVInfo[2]=k*M,R.startUVInfo[3]=N*t}else R.startUVInfo[0]=1,R.startUVInfo[1]=1,R.startUVInfo[2]=0,R.startUVInfo[3]=0}}]),R}();Bl._tempVector30=new vn,Bl.startColor=new yn,Bl.startSize=new Float32Array(3),Bl.startRotation=new Float32Array(3),Bl.startUVInfo=new Float32Array(4);var Vl=function(){T(U,Ia);var n=b(U);function U(e){var t;return S(this,U),(t=n.call(this))._tempRotationMatrix=new ki,t._boundingSphere=null,t._boundingBox=null,t._boundingBoxCorners=null,t._owner=null,t._ownerRender=null,t._vertices=null,t._floatCountPerVertex=0,t._startLifeTimeIndex=0,t._timeIndex=0,t._simulateUpdate=!1,t._firstActiveElement=0,t._firstNewElement=0,t._firstFreeElement=0,t._firstRetiredElement=0,t._drawCounter=0,t._bufferMaxParticles=0,t._emission=null,t._shape=null,t._isEmitting=!1,t._isPlaying=!1,t._isPaused=!1,t._playStartDelay=0,t._frameRateTime=0,t._emissionTime=0,t._totalDelayTime=0,t._burstsIndex=0,t._velocityOverLifetime=null,t._colorOverLifetime=null,t._sizeOverLifetime=null,t._rotationOverLifetime=null,t._textureSheetAnimation=null,t._startLifetimeType=0,t._startLifetimeConstant=0,t._startLifeTimeGradient=null,t._startLifetimeConstantMin=0,t._startLifetimeConstantMax=0,t._startLifeTimeGradientMin=null,t._startLifeTimeGradientMax=null,t._maxStartLifetime=0,t._uvLength=new gn,t._vertexStride=0,t._indexStride=0,t._vertexBuffer=null,t._indexBuffer=null,t._bufferState=new Ga,t._currentTime=0,t._startUpdateLoopCount=0,t._rand=null,t._randomSeeds=null,t.duration=0,t.looping=!1,t.prewarm=!1,t.startDelayType=0,t.startDelay=0,t.startDelayMin=0,t.startDelayMax=0,t.startSpeedType=0,t.startSpeedConstant=0,t.startSpeedConstantMin=0,t.startSpeedConstantMax=0,t.threeDStartSize=!1,t.startSizeType=0,t.startSizeConstant=0,t.startSizeConstantSeparate=null,t.startSizeConstantMin=0,t.startSizeConstantMax=0,t.startSizeConstantMinSeparate=null,t.startSizeConstantMaxSeparate=null,t.threeDStartRotation=!1,t.startRotationType=0,t.startRotationConstant=0,t.startRotationConstantSeparate=null,t.startRotationConstantMin=0,t.startRotationConstantMax=0,t.startRotationConstantMinSeparate=null,t.startRotationConstantMaxSeparate=null,t.randomizeRotationDirection=0,t.startColorType=0,t.startColorConstant=null,t.startColorConstantMin=null,t.startColorConstantMax=null,t.gravityModifier=0,t.simulationSpace=0,t.simulationSpeed=1,t.scaleMode=0,t.playOnAwake=!1,t.randomSeed=null,t.autoRandomSeed=!1,t.isPerformanceMode=!1,t._firstActiveElement=0,t._firstNewElement=0,t._firstFreeElement=0,t._firstRetiredElement=0,t._owner=e,t._ownerRender=e.particleRenderer,t._boundingBoxCorners=[],t._boundingSphere=new Ll(new vn,Number.MAX_VALUE),t._boundingBox=new cr(new vn(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new vn(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),t._currentTime=0,t._isEmitting=!1,t._isPlaying=!1,t._isPaused=!1,t._burstsIndex=0,t._frameRateTime=0,t._emissionTime=0,t._totalDelayTime=0,t._simulateUpdate=!1,t._bufferMaxParticles=1,t.duration=5,t.looping=!0,t.prewarm=!1,t.startDelayType=0,t.startDelay=0,t.startDelayMin=0,t.startDelayMax=0,t._startLifetimeType=0,t._startLifetimeConstant=5,t._startLifeTimeGradient=new Fl,t._startLifetimeConstantMin=0,t._startLifetimeConstantMax=5,t._startLifeTimeGradientMin=new Fl,t._startLifeTimeGradientMax=new Fl,t._maxStartLifetime=5,t.startSpeedType=0,t.startSpeedConstant=5,t.startSpeedConstantMin=0,t.startSpeedConstantMax=5,t.threeDStartSize=!1,t.startSizeType=0,t.startSizeConstant=1,t.startSizeConstantSeparate=new vn(1,1,1),t.startSizeConstantMin=0,t.startSizeConstantMax=1,t.startSizeConstantMinSeparate=new vn(0,0,0),t.startSizeConstantMaxSeparate=new vn(1,1,1),t.threeDStartRotation=!1,t.startRotationType=0,t.startRotationConstant=0,t.startRotationConstantSeparate=new vn(0,0,0),t.startRotationConstantMin=0,t.startRotationConstantMax=0,t.startRotationConstantMinSeparate=new vn(0,0,0),t.startRotationConstantMaxSeparate=new vn(0,0,0),t.randomizeRotationDirection=0,t.startColorType=0,t.startColorConstant=new yn(1,1,1,1),t.startColorConstantMin=new yn(1,1,1,1),t.startColorConstantMax=new yn(1,1,1,1),t.gravityModifier=0,t.simulationSpace=1,t.scaleMode=0,t.playOnAwake=!0,t._rand=new Ol(0),t.autoRandomSeed=!0,t.randomSeed=new Uint32Array(1),t._randomSeeds=new Uint32Array(U._RANDOMOFFSET.length),t.isPerformanceMode=!0,t._emission=new Pl,t._emission.enbale=!0,t}return C(U,[{key:"_getVertexBuffer",value:function(){return 0===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)?this._vertexBuffer:null}},{key:"_getIndexBuffer",value:function(){return this._indexBuffer}},{key:"_generateBoundingSphere",value:function(){var e=this._boundingSphere.center;e.x=0,e.y=0,e.z=0,this._boundingSphere.radius=Number.MAX_VALUE}},{key:"_generateBoundingBox",value:function(){var e,t,n,i,a,r,o,s=this._owner.particleRenderer,l=this._boundingBox.min,h=this._boundingBox.max;switch(this.startLifetimeType){case 0:e=this.startLifetimeConstant;break;case 1:e=-Number.MAX_VALUE;for(var u=u,d=0,c=u.gradientCount;d<c;d++)e=Math.max(e,u.getValueByIndex(d));break;case 2:e=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:e=-Number.MAX_VALUE;var _=_;for(d=0,c=_.gradientCount;d<c;d++)e=Math.max(e,_.getValueByIndex(d));var f=f;for(d=0,c=f.gradientCount;d<c;d++)e=Math.max(e,f.getValueByIndex(d))}switch(this.startSpeedType){case 0:t=n=this.startSpeedConstant;break;case 1:break;case 2:t=this.startLifetimeConstantMin,n=this.startLifetimeConstantMax}this._shape&&this._shape.enable||(i=a=vn._ZERO,r=vn._ZERO,o=vn._UnitZ);var g,y=new vn(r.x*t,r.y*t,r.z*t),v=new vn(o.x*n,o.y*n,o.z*n);if(this._velocityOverLifetime&&this._velocityOverLifetime.enbale){var p=this._velocityOverLifetime.velocity;switch(p.type){case 0:p.constant;break;case 1:new vn(p.gradientX.getAverageValue(),p.gradientY.getAverageValue(),p.gradientZ.getAverageValue());break;case 2:p.constantMin,p.constantMax;break;case 3:new vn(p.gradientXMin.getAverageValue(),p.gradientYMin.getAverageValue(),p.gradientZMin.getAverageValue()),new vn(p.gradientXMax.getAverageValue(),p.gradientYMax.getAverageValue(),p.gradientZMax.getAverageValue())}}var m,w,x,k,T=this._owner.transform,E=T.position,M=U._tempVector39,b=s.renderMode;switch(this.scaleMode){case 0:var S=T.getWorldLossyScale(),I=S;M.x=S.x,M.y=S.z,M.z=S.y,1===b&&(g=S);break;case 1:S=T.localScale;I=S,M.x=S.x,M.y=S.z,M.z=S.y,1===b&&(g=S);break;case 2:I=T.getWorldLossyScale(),(M.x=M.y=M.z=1)===b&&(g=vn._ONE)}switch(this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(m=new vn(y.x*e,y.y*e,y.z*e),w=new vn(v.x*e,v.y*e,v.z*e),2!=this.scaleMode?(vn.add(i,m,l),vn.multiply(I,l,l),vn.add(a,w,h),vn.multiply(I,h,h)):(vn.multiply(I,i,l),vn.add(l,m,l),vn.multiply(I,a,h),vn.add(h,w,h))),this.simulationSpace){case 0:break;case 1:vn.add(l,E,l),vn.add(h,E,h)}switch(this.startSizeType){case 0:this.threeDStartSize?(k=Math.max((void 0).x,(void 0).y),1===b&&(x=(void 0).y)):(k=this.startSizeConstant,1===b&&(x=this.startSizeConstant));break;case 1:break;case 2:this.threeDStartSize?(k=Math.max((void 0).x,(void 0).y),1===b&&(x=(void 0).y)):(k=this.startSizeConstantMax,1===b&&(x=this.startSizeConstantMax))}this._sizeOverLifetime&&this._sizeOverLifetime.enbale&&(this._sizeOverLifetime.size,k*=this._sizeOverLifetime.size.getMaxSizeInGradient());var N,R=U._tempVector30;switch(b){case 0:V=k*U.halfKSqrtOf2,vn.scale(M,k,R),vn.subtract(l,R,l),vn.add(h,R,h);break;case 1:var C=U._tempVector31,A=U._tempVector32,D=U._tempVector33,L=U._tempVector34;this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(vn.multiply(g,v,A),vn.multiply(g,y,D));var O=x*s.stretchedBillboardLengthScale,P=vn.scalarLength(A)*s.stretchedBillboardSpeedScale+O,F=vn.scalarLength(D)*s.stretchedBillboardSpeedScale+O,B=U._tempVector35,O=U._tempVector36;vn.normalize(A,B),vn.scale(B,P,L),vn.subtract(w,L,L),vn.normalize(D,O),vn.scale(O,F,C),vn.add(m,C,C),V=k*U.halfKSqrtOf2,vn.scale(M,V,R);var F=U._tempVector37,V=U._tempVector38;vn.scale(B,.5,F),vn.scale(O,.5,V),vn.multiply(F,M,F),vn.multiply(V,M,V),vn.add(l,V,l),vn.min(l,L,l),vn.subtract(l,R,l),vn.subtract(h,F,h),vn.max(h,C,h),vn.add(h,R,h);break;case 2:N=.5*(k*=Math.cos(.7853981633974483)),R.x=M.x*N,R.y=M.z*N,vn.subtract(l,R,l),vn.add(h,R,h);break;case 3:N=.5*(k*=Math.cos(.7853981633974483)),vn.scale(M,N,R),vn.subtract(l,R,l),vn.add(h,R,h)}this._boundingBox.getCorners(this._boundingBoxCorners)}},{key:"_updateEmission",value:function(){var e;this.isAlive&&(this._simulateUpdate?this._simulateUpdate=!1:(e=this._startUpdateLoopCount===J.loopCount||this._isPaused?0:this._owner._scene.timer._delta/1e3,e=Math.min(U._maxElapsedTime,e*this.simulationSpeed),this._updateParticles(e)))}},{key:"_updateParticles",value:function(e){4===this._ownerRender.renderMode&&!this._ownerRender.mesh||(this._currentTime+=e,this._retireActiveParticles(),this._freeRetiredParticles(),this._totalDelayTime+=e,this._totalDelayTime<this._playStartDelay||this._emission.enbale&&this._isEmitting&&!this._isPaused&&this._advanceTime(e,this._currentTime))}},{key:"_updateParticlesSimulationRestart",value:function(e){this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._burstsIndex=0,this._frameRateTime=e,this._emissionTime=0,this._totalDelayTime=0,(this._currentTime=e)<this._playStartDelay?this._totalDelayTime=e:this._emission.enbale&&this._advanceTime(e,e)}},{key:"_retireActiveParticles",value:function(){for(;this._firstActiveElement!=this._firstNewElement;){var e=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride,t=e+this._timeIndex;if(1e-4+(this._currentTime-this._vertices[t])<this._vertices[e+this._startLifeTimeIndex])break;this._vertices[t]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this._bufferMaxParticles&&(this._firstActiveElement=0)}}},{key:"_freeRetiredParticles",value:function(){for(;this._firstRetiredElement!=this._firstActiveElement;){var e=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];if(this.isPerformanceMode&&e<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this._bufferMaxParticles&&(this._firstRetiredElement=0)}}},{key:"_burst",value:function(e,t){for(var n=0,i=this._emission._bursts,a=i.length;this._burstsIndex<a;this._burstsIndex++){var r,o=i[this._burstsIndex],s=o.time;if(!(e<=s&&s<t))break;this.autoRandomSeed?r=kn.lerp(o.minCount,o.maxCount,Math.random()):(this._rand.seed=this._randomSeeds[0],r=kn.lerp(o.minCount,o.maxCount,this._rand.getFloat()),this._randomSeeds[0]=this._rand.seed),n+=r}return n}},{key:"_advanceTime",value:function(e,t){var n,i=this._emissionTime;this._emissionTime+=e;var a=0;if(this._emissionTime>this.duration){if(!this.looping){for(a=Math.min(this.maxParticles-this.aliveParticleCount,a),n=0;n<a;n++)this.emit(t);return this._isPlaying=!1,void this.stop()}a+=this._burst(i,this._emissionTime),this._emissionTime-=this.duration,this._burstsIndex=0,a+=this._burst(0,this._emissionTime)}else a+=this._burst(i,this._emissionTime);for(a=Math.min(this.maxParticles-this.aliveParticleCount,a),n=0;n<a;n++)this.emit(t);i=this.emission.emissionRate;if(0<i){var r=1/i;for(this._frameRateTime+=r,this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;this._frameRateTime<=t&&this.emit(this._frameRateTime);)this._frameRateTime+=r;this._frameRateTime=Math.floor(t/r)*r}}},{key:"_initBufferDatas",value:function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy());var e=P.instance,t=this._ownerRender,n=t.renderMode;if(-1!==n&&0<this.maxParticles){var i,a,r,o,s,l=0,h=0,u=t.mesh;if(4===n){if(u){s=Dl.vertexDeclaration,this._floatCountPerVertex=s.vertexStride/4,this._startLifeTimeIndex=12,this._timeIndex=16,this._vertexStride=u._vertexCount;t=this._bufferMaxParticles*this._vertexStride,n=t%65535;if(1<Math.floor(t/65535)+1)throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.");l=s.vertexStride*n,this._vertexBuffer=new Na(l,e.DYNAMIC_DRAW),this._vertexBuffer.vertexDeclaration=s,this._vertices=new Float32Array(this._floatCountPerVertex*n),this._indexStride=u._indexBuffer.indexCount;var d=u._indexBuffer.getData(),u=this._bufferMaxParticles*this._indexStride;for(this._indexBuffer=new Xa(Xa.INDEXTYPE_USHORT,u,e.STATIC_DRAW),i=new Uint16Array(u),h=l+2*u,a=r=0;a<this._bufferMaxParticles;a++)for(var c=a*this._vertexStride,_=0,f=d.length;_<f;_++)i[r++]=c+d[_];this._indexBuffer.setData(i),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()}}else{for(s=Al.vertexDeclaration,this._floatCountPerVertex=s.vertexStride/4,this._startLifeTimeIndex=7,this._timeIndex=11,this._vertexStride=4,l=s.vertexStride*this._bufferMaxParticles*this._vertexStride,this._vertexBuffer=new Na(l,e.DYNAMIC_DRAW),this._vertexBuffer.vertexDeclaration=s,this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride),a=0;a<this._bufferMaxParticles;a++)o=a*this._floatCountPerVertex*this._vertexStride,this._vertices[o]=-.5,this._vertices[1+o]=-.5,this._vertices[2+o]=0,this._vertices[3+o]=1,o+=this._floatCountPerVertex,this._vertices[o]=.5,this._vertices[o+1]=-.5,this._vertices[o+2]=1,this._vertices[o+3]=1,o+=this._floatCountPerVertex,this._vertices[o]=.5,this._vertices[o+1]=.5,this._vertices[o+2]=1,this._vertices[o+3]=0,o+=this._floatCountPerVertex,this._vertices[o]=-.5,this._vertices[o+1]=.5,this._vertices[o+2]=0,this._vertices[o+3]=0;for(this._indexStride=6,this._indexBuffer=new Xa(Xa.INDEXTYPE_USHORT,6*this._bufferMaxParticles,e.STATIC_DRAW),i=new Uint16Array(6*this._bufferMaxParticles),a=0;a<this._bufferMaxParticles;a++){r=6*a;var g=a*this._vertexStride,y=2+g;i[r++]=g,i[r++]=y,i[r++]=1+g,i[r++]=g,i[r++]=3+g,i[r++]=y}this._indexBuffer.setData(i),h=l+6*this._bufferMaxParticles*2,this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()}V._addMemory(h,h)}}},{key:"destroy",value:function(){G(z(U.prototype),"destroy",this).call(this);var e=this._vertexBuffer._byteLength+2*this._indexBuffer.indexCount;V._addMemory(-e,-e),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._emission.destroy(),this._bufferState=null,this._vertexBuffer=null,this._indexBuffer=null,this._owner=null,this._vertices=null,this._indexBuffer=null,this._emission=null,this._shape=null,this.startLifeTimeGradient=null,this.startLifeTimeGradientMin=null,this.startLifeTimeGradientMax=null,this.startSizeConstantSeparate=null,this.startSizeConstantMinSeparate=null,this.startSizeConstantMaxSeparate=null,this.startRotationConstantSeparate=null,this.startRotationConstantMinSeparate=null,this.startRotationConstantMaxSeparate=null,this.startColorConstant=null,this.startColorConstantMin=null,this.startColorConstantMax=null,this._velocityOverLifetime=null,this._colorOverLifetime=null,this._sizeOverLifetime=null,this._rotationOverLifetime=null,this._textureSheetAnimation=null}},{key:"emit",value:function(e){var t=U._tempPosition,n=U._tempDirection;return this._shape&&this._shape.enable?this.autoRandomSeed?this._shape.generatePositionAndDirection(t,n):this._shape.generatePositionAndDirection(t,n,this._rand,this._randomSeeds):(t.x=t.y=t.z=0,n.x=n.y=0,n.z=1),this.addParticle(t,n,e)}},{key:"addParticle",value:function(e,t,n){vn.normalize(t,t);var i=this._firstFreeElement+1;if((i=i>=this._bufferMaxParticles?0:i)===this._firstRetiredElement)return!1;var a,r,o,s,l,h,u,d,c,_,f=this._owner.transform;if(Bl.create(this,this._ownerRender,f),this._currentTime-n>=Bl.startLifeTime)return!0;switch(0==this.simulationSpace&&(a=f.position,r=f.rotation),this.startSpeedType){case 0:o=this.startSpeedConstant;break;case 2:this.autoRandomSeed?o=kn.lerp(this.startSpeedConstantMin,this.startSpeedConstantMax,Math.random()):(this._rand.seed=this._randomSeeds[8],o=kn.lerp(this.startSpeedConstantMin,this.startSpeedConstantMax,this._rand.getFloat()),this._randomSeeds[8]=this._rand.seed)}var g=this._velocityOverLifetime&&this._velocityOverLifetime.enbale;g&&(2===(I=this._velocityOverLifetime.velocity.type)||3===I)?this.autoRandomSeed?(s=Math.random(),l=Math.random(),h=Math.random()):(this._rand.seed=this._randomSeeds[9],s=this._rand.getFloat(),l=this._rand.getFloat(),h=this._rand.getFloat(),this._randomSeeds[9]=this._rand.seed):g=!1;var y=this._colorOverLifetime&&this._colorOverLifetime.enbale;y&&3===this._colorOverLifetime.color.type?this.autoRandomSeed?u=Math.random():(this._rand.seed=this._randomSeeds[10],u=this._rand.getFloat(),this._randomSeeds[10]=this._rand.seed):y=!1;var v=this._sizeOverLifetime&&this._sizeOverLifetime.enbale;v&&3===this._sizeOverLifetime.size.type?this.autoRandomSeed?d=Math.random():(this._rand.seed=this._randomSeeds[11],d=this._rand.getFloat(),this._randomSeeds[11]=this._rand.seed):v=!1;var p=this._rotationOverLifetime&&this._rotationOverLifetime.enbale;p&&(2===(T=this._rotationOverLifetime.angularVelocity.type)||3===T)?this.autoRandomSeed?c=Math.random():(this._rand.seed=this._randomSeeds[12],c=this._rand.getFloat(),this._randomSeeds[12]=this._rand.seed):p=!1;var m=this._textureSheetAnimation&&this._textureSheetAnimation.enable;m&&3===this._textureSheetAnimation.frame.type?this.autoRandomSeed?_=Math.random():(this._rand.seed=this._randomSeeds[15],_=this._rand.getFloat(),this._randomSeeds[15]=this._rand.seed):m=!1;var w,x,k,T,E,M,b,S,I=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride,N=Bl.startUVInfo[0],R=Bl.startUVInfo[1],C=Bl.startUVInfo[2],A=Bl.startUVInfo[3],D=this._ownerRender;4===D.renderMode?(w=(T=D.mesh._vertexBuffer).getFloat32Data(),x=(S=T.vertexDeclaration).getVertexElementByUsage(wa.MESH_POSITION0)._offset/4,k=(T=S.getVertexElementByUsage(wa.MESH_COLOR0))?T._offset/4:-1,E=(T=S.getVertexElementByUsage(wa.MESH_TEXTURECOORDINATE0))?T._offset/4:-1,M=S.vertexStride/4,b=0):(this._vertices[2+I]=C,this._vertices[3+I]=A+R,S=I+this._floatCountPerVertex,this._vertices[S+2]=C+N,this._vertices[S+3]=A+R,S=S+this._floatCountPerVertex,this._vertices[S+2]=C+N,this._vertices[S+3]=A,S=S+this._floatCountPerVertex,this._vertices[S+2]=C,this._vertices[S+3]=A);for(var L,O,P,F=I,B=I+this._floatCountPerVertex*this._vertexStride;F<B;F+=this._floatCountPerVertex)switch(4===D.renderMode?(L=F,P=(O=M*b++)+x,this._vertices[L++]=w[P++],this._vertices[L++]=w[P++],this._vertices[L++]=w[P],-1===k?(this._vertices[L++]=1,this._vertices[L++]=1,this._vertices[L++]=1,this._vertices[L++]=1):(P=O+k,this._vertices[L++]=w[P++],this._vertices[L++]=w[P++],this._vertices[L++]=w[P++],this._vertices[L++]=w[P]),-1===E?(this._vertices[L++]=0,this._vertices[L++]=0):(P=O+E,this._vertices[L++]=C+w[P++]*N,this._vertices[L++]=A+w[P]*R)):L=F+4,this._vertices[L++]=e.x,this._vertices[L++]=e.y,this._vertices[L++]=e.z,this._vertices[L++]=Bl.startLifeTime,this._vertices[L++]=t.x,this._vertices[L++]=t.y,this._vertices[L++]=t.z,this._vertices[L++]=n,this._vertices[L++]=Bl.startColor.x,this._vertices[L++]=Bl.startColor.y,this._vertices[L++]=Bl.startColor.z,this._vertices[L++]=Bl.startColor.w,this._vertices[L++]=Bl.startSize[0],this._vertices[L++]=Bl.startSize[1],this._vertices[L++]=Bl.startSize[2],this._vertices[L++]=Bl.startRotation[0],this._vertices[L++]=Bl.startRotation[1],this._vertices[L++]=Bl.startRotation[2],this._vertices[L++]=o,y&&(this._vertices[L+1]=u),v&&(this._vertices[L+2]=d),p&&(this._vertices[L+3]=c),m&&(this._vertices[L+4]=_),g&&(this._vertices[L+5]=s,this._vertices[L+6]=l,this._vertices[L+7]=h),this.simulationSpace){case 0:L+=8,this._vertices[L++]=a.x,this._vertices[L++]=a.y,this._vertices[L++]=a.z,this._vertices[L++]=r.x,this._vertices[L++]=r.y,this._vertices[L++]=r.z,this._vertices[L++]=r.w;break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}return this._firstFreeElement=i,!0}},{key:"addNewParticlesToVertexBuffer",value:function(){var e,t=this._vertexStride*this._floatCountPerVertex*4;this._firstNewElement<this._firstFreeElement?(e=this._firstNewElement*t,this._vertexBuffer.setData(this._vertices.buffer,e,e,(this._firstFreeElement-this._firstNewElement)*t)):(e=this._firstNewElement*t,this._vertexBuffer.setData(this._vertices.buffer,e,e,(this._bufferMaxParticles-this._firstNewElement)*t),0<this._firstFreeElement&&this._vertexBuffer.setData(this._vertices.buffer,0,0,this._firstFreeElement*t)),this._firstNewElement=this._firstFreeElement}},{key:"_getType",value:function(){return U._type}},{key:"_prepareRender",value:function(e){return this._updateEmission(),this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement}},{key:"_render",value:function(e){var t;this._bufferState.bind();var n=P.instance;this._firstActiveElement<this._firstFreeElement?(t=(this._firstFreeElement-this._firstActiveElement)*this._indexStride,n.drawElements(n.TRIANGLES,t,n.UNSIGNED_SHORT,2*this._firstActiveElement*this._indexStride),J.trianglesFaces+=t/3,J.renderBatches++):(t=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride,n.drawElements(n.TRIANGLES,t,n.UNSIGNED_SHORT,2*this._firstActiveElement*this._indexStride),J.trianglesFaces+=t/3,J.renderBatches++,0<this._firstFreeElement&&(t=this._firstFreeElement*this._indexStride,n.drawElements(n.TRIANGLES,t,n.UNSIGNED_SHORT,0),J.trianglesFaces+=t/3,J.renderBatches++))}},{key:"play",value:function(){if(this._burstsIndex=0,this._isEmitting=!0,this._isPlaying=!0,this._isPaused=!1,this._emissionTime=0,this._totalDelayTime=0,!this.autoRandomSeed)for(var e=0,t=this._randomSeeds.length;e<t;e++)this._randomSeeds[e]=this.randomSeed[0]+U._RANDOMOFFSET[e];switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:this.autoRandomSeed?this._playStartDelay=kn.lerp(this.startDelayMin,this.startDelayMax,Math.random()):(this._rand.seed=this._randomSeeds[2],this._playStartDelay=kn.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat()),this._randomSeeds[2]=this._rand.seed);break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay,this._startUpdateLoopCount=J.loopCount}},{key:"pause",value:function(){this._isPaused=!0}},{key:"simulate",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._simulateUpdate=!0,t?this._updateParticlesSimulationRestart(e):(this._isPaused=!1,this._updateParticles(e)),this.pause()}},{key:"stop",value:function(){this._burstsIndex=0,this._isEmitting=!1,this._emissionTime=0}},{key:"cloneTo",value:function(e){e.duration=this.duration,e.looping=this.looping,e.prewarm=this.prewarm,e.startDelayType=this.startDelayType,e.startDelay=this.startDelay,e.startDelayMin=this.startDelayMin,e.startDelayMax=this.startDelayMax,e._maxStartLifetime=this._maxStartLifetime,e.startLifetimeType=this.startLifetimeType,e.startLifetimeConstant=this.startLifetimeConstant,this.startLifeTimeGradient.cloneTo(e.startLifeTimeGradient),e.startLifetimeConstantMin=this.startLifetimeConstantMin,e.startLifetimeConstantMax=this.startLifetimeConstantMax,this.startLifeTimeGradientMin.cloneTo(e.startLifeTimeGradientMin),this.startLifeTimeGradientMax.cloneTo(e.startLifeTimeGradientMax),e.startSpeedType=this.startSpeedType,e.startSpeedConstant=this.startSpeedConstant,e.startSpeedConstantMin=this.startSpeedConstantMin,e.startSpeedConstantMax=this.startSpeedConstantMax,e.threeDStartSize=this.threeDStartSize,e.startSizeType=this.startSizeType,e.startSizeConstant=this.startSizeConstant,this.startSizeConstantSeparate.cloneTo(e.startSizeConstantSeparate),e.startSizeConstantMin=this.startSizeConstantMin,e.startSizeConstantMax=this.startSizeConstantMax,this.startSizeConstantMinSeparate.cloneTo(e.startSizeConstantMinSeparate),this.startSizeConstantMaxSeparate.cloneTo(e.startSizeConstantMaxSeparate),e.threeDStartRotation=this.threeDStartRotation,e.startRotationType=this.startRotationType,e.startRotationConstant=this.startRotationConstant,this.startRotationConstantSeparate.cloneTo(e.startRotationConstantSeparate),e.startRotationConstantMin=this.startRotationConstantMin,e.startRotationConstantMax=this.startRotationConstantMax,this.startRotationConstantMinSeparate.cloneTo(e.startRotationConstantMinSeparate),this.startRotationConstantMaxSeparate.cloneTo(e.startRotationConstantMaxSeparate),e.randomizeRotationDirection=this.randomizeRotationDirection,e.startColorType=this.startColorType,this.startColorConstant.cloneTo(e.startColorConstant),this.startColorConstantMin.cloneTo(e.startColorConstantMin),this.startColorConstantMax.cloneTo(e.startColorConstantMax),e.gravityModifier=this.gravityModifier,e.simulationSpace=this.simulationSpace,e.scaleMode=this.scaleMode,e.playOnAwake=this.playOnAwake,e.autoRandomSeed=this.autoRandomSeed,e.randomSeed[0]=this.randomSeed[0],e.maxParticles=this.maxParticles,this._emission&&(e._emission=this._emission.clone()),this.shape&&(e.shape=this.shape.clone()),this.velocityOverLifetime&&(e.velocityOverLifetime=this.velocityOverLifetime.clone()),this.colorOverLifetime&&(e.colorOverLifetime=this.colorOverLifetime.clone()),this.sizeOverLifetime&&(e.sizeOverLifetime=this.sizeOverLifetime.clone()),this.rotationOverLifetime&&(e.rotationOverLifetime=this.rotationOverLifetime.clone()),this.textureSheetAnimation&&(e.textureSheetAnimation=this.textureSheetAnimation.clone()),e.isPerformanceMode=this.isPerformanceMode,e._isEmitting=this._isEmitting,e._isPlaying=this._isPlaying,e._isPaused=this._isPaused,e._playStartDelay=this._playStartDelay,e._frameRateTime=this._frameRateTime,e._emissionTime=this._emissionTime,e._totalDelayTime=this._totalDelayTime,e._burstsIndex=this._burstsIndex}},{key:"clone",value:function(){var e=new U(null);return this.cloneTo(e),e}},{key:"maxParticles",get:function(){return this._bufferMaxParticles-1},set:function(e){e+=1;e!==this._bufferMaxParticles&&(this._bufferMaxParticles=e,this._initBufferDatas())}},{key:"emission",get:function(){return this._emission}},{key:"aliveParticleCount",get:function(){return this._firstNewElement>=this._firstRetiredElement?this._firstNewElement-this._firstRetiredElement:this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}},{key:"emissionTime",get:function(){return this._emissionTime>this.duration?this.duration:this._emissionTime}},{key:"shape",get:function(){return this._shape},set:function(e){this._shape!==e&&(e&&e.enable?this._owner._render._shaderValues.addDefine(Nl.SHADERDEFINE_SHAPE):this._owner._render._shaderValues.removeDefine(Nl.SHADERDEFINE_SHAPE),this._shape=e)}},{key:"isAlive",get:function(){return!!(this._isPlaying||0<this.aliveParticleCount)}},{key:"isEmitting",get:function(){return this._isEmitting}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"startLifetimeType",get:function(){return this._startLifetimeType},set:function(e){switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;for(var t=t,n=0,i=t.gradientCount;n<i;n++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(n));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var a=a;for(n=0,i=a.gradientCount;n<i;n++)this._maxStartLifetime=Math.max(this._maxStartLifetime,a.getValueByIndex(n));var r=r;for(n=0,i=r.gradientCount;n<i;n++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(n))}this._startLifetimeType=e}},{key:"startLifetimeConstant",get:function(){return this._startLifetimeConstant},set:function(e){0===this._startLifetimeType&&(this._maxStartLifetime=e),this._startLifetimeConstant=e}},{key:"startLifeTimeGradient",get:function(){return this._startLifeTimeGradient},set:function(e){if(1===this._startLifetimeType){this._maxStartLifetime=-Number.MAX_VALUE;for(var t=0,n=e.gradientCount;t<n;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,e.getValueByIndex(t))}this._startLifeTimeGradient=e}},{key:"startLifetimeConstantMin",get:function(){return this._startLifetimeConstantMin},set:function(e){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(e,this._startLifetimeConstantMax)),this._startLifetimeConstantMin=e}},{key:"startLifetimeConstantMax",get:function(){return this._startLifetimeConstantMax},set:function(e){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,e)),this._startLifetimeConstantMax=e}},{key:"startLifeTimeGradientMin",get:function(){return this._startLifeTimeGradientMin},set:function(e){if(3===this._startLifetimeType){var t,n;for(this._maxStartLifetime=-Number.MAX_VALUE,t=0,n=e.gradientCount;t<n;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,e.getValueByIndex(t));for(t=0,n=this._startLifeTimeGradientMax.gradientCount;t<n;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(t))}this._startLifeTimeGradientMin=e}},{key:"startLifeTimeGradientMax",get:function(){return this._startLifeTimeGradientMax},set:function(e){if(3===this._startLifetimeType){var t,n;for(this._maxStartLifetime=-Number.MAX_VALUE,t=0,n=this._startLifeTimeGradientMin.gradientCount;t<n;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(t));for(t=0,n=e.gradientCount;t<n;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,e.getValueByIndex(t))}this._startLifeTimeGradientMax=e}},{key:"velocityOverLifetime",get:function(){return this._velocityOverLifetime},set:function(e){var t=this._owner._render._shaderValues;if(e){var n=e.velocity,i=n.type;if(e.enbale)switch(i){case 0:t.addDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:t.addDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:t.addDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:t.addDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}else t.removeDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),t.removeDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),t.removeDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),t.removeDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);switch(i){case 0:t.setVector3(Nl.VOLVELOCITYCONST,n.constant);break;case 1:t.setBuffer(Nl.VOLVELOCITYGRADIENTX,n.gradientX._elements),t.setBuffer(Nl.VOLVELOCITYGRADIENTY,n.gradientY._elements),t.setBuffer(Nl.VOLVELOCITYGRADIENTZ,n.gradientZ._elements);break;case 2:t.setVector3(Nl.VOLVELOCITYCONST,n.constantMin),t.setVector3(Nl.VOLVELOCITYCONSTMAX,n.constantMax);break;case 3:t.setBuffer(Nl.VOLVELOCITYGRADIENTX,n.gradientXMin._elements),t.setBuffer(Nl.VOLVELOCITYGRADIENTXMAX,n.gradientXMax._elements),t.setBuffer(Nl.VOLVELOCITYGRADIENTY,n.gradientYMin._elements),t.setBuffer(Nl.VOLVELOCITYGRADIENTYMAX,n.gradientYMax._elements),t.setBuffer(Nl.VOLVELOCITYGRADIENTZ,n.gradientZMin._elements),t.setBuffer(Nl.VOLVELOCITYGRADIENTZMAX,n.gradientZMax._elements)}t.setInt(Nl.VOLSPACETYPE,e.space)}else t.removeDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),t.removeDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),t.removeDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),t.removeDefine(Nl.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);this._velocityOverLifetime=e}},{key:"colorOverLifetime",get:function(){return this._colorOverLifetime},set:function(e){var t=this._owner._render._shaderValues;if(e){var n=e.color;if(e.enbale)switch(n.type){case 1:t.addDefine(Nl.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:t.addDefine(Nl.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}else t.removeDefine(Nl.SHADERDEFINE_COLOROVERLIFETIME),t.removeDefine(Nl.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);switch(n.type){case 1:var i=n.gradient;t.setBuffer(Nl.COLOROVERLIFEGRADIENTALPHAS,i._alphaElements),t.setBuffer(Nl.COLOROVERLIFEGRADIENTCOLORS,i._rgbElements);break;case 3:var a=n.gradientMin,r=n.gradientMax;t.setBuffer(Nl.COLOROVERLIFEGRADIENTALPHAS,a._alphaElements),t.setBuffer(Nl.COLOROVERLIFEGRADIENTCOLORS,a._rgbElements),t.setBuffer(Nl.MAXCOLOROVERLIFEGRADIENTALPHAS,r._alphaElements),t.setBuffer(Nl.MAXCOLOROVERLIFEGRADIENTCOLORS,r._rgbElements)}}else t.removeDefine(Nl.SHADERDEFINE_COLOROVERLIFETIME),t.removeDefine(Nl.SHADERDEFINE_RANDOMCOLOROVERLIFETIME),t.setBuffer(Nl.COLOROVERLIFEGRADIENTALPHAS,i._alphaElements),t.setBuffer(Nl.COLOROVERLIFEGRADIENTCOLORS,i._rgbElements),t.setBuffer(Nl.COLOROVERLIFEGRADIENTALPHAS,a._alphaElements),t.setBuffer(Nl.COLOROVERLIFEGRADIENTCOLORS,a._rgbElements),t.setBuffer(Nl.MAXCOLOROVERLIFEGRADIENTALPHAS,r._alphaElements),t.setBuffer(Nl.MAXCOLOROVERLIFEGRADIENTCOLORS,r._rgbElements);this._colorOverLifetime=e}},{key:"sizeOverLifetime",get:function(){return this._sizeOverLifetime},set:function(e){var t=this._owner._render._shaderValues;if(e){var n=e.size,i=n.separateAxes,a=n.type;if(e.enbale)switch(a){case 0:i?t.addDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE):t.addDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:i?t.addDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE):t.addDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES)}else t.removeDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMECURVE),t.removeDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),t.removeDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),t.removeDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);switch(a){case 0:i?(t.setBuffer(Nl.SOLSIZEGRADIENTX,n.gradientX._elements),t.setBuffer(Nl.SOLSIZEGRADIENTY,n.gradientY._elements),t.setBuffer(Nl.SOLSizeGradientZ,n.gradientZ._elements)):t.setBuffer(Nl.SOLSIZEGRADIENT,n.gradient._elements);break;case 2:i?(t.setBuffer(Nl.SOLSIZEGRADIENTX,n.gradientXMin._elements),t.setBuffer(Nl.SOLSIZEGRADIENTXMAX,n.gradientXMax._elements),t.setBuffer(Nl.SOLSIZEGRADIENTY,n.gradientYMin._elements),t.setBuffer(Nl.SOLSIZEGRADIENTYMAX,n.gradientYMax._elements),t.setBuffer(Nl.SOLSizeGradientZ,n.gradientZMin._elements),t.setBuffer(Nl.SOLSizeGradientZMAX,n.gradientZMax._elements)):(t.setBuffer(Nl.SOLSIZEGRADIENT,n.gradientMin._elements),t.setBuffer(Nl.SOLSizeGradientMax,n.gradientMax._elements))}}else t.removeDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMECURVE),t.removeDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),t.removeDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),t.removeDefine(Nl.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);this._sizeOverLifetime=e}},{key:"rotationOverLifetime",get:function(){return this._rotationOverLifetime},set:function(e){var t=this._owner._render._shaderValues;if(e){var n=e.angularVelocity;if(!n)return;var i=n.separateAxes,a=n.type;if(e.enbale)switch(i?t.addDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE):t.addDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIME),a){case 0:t.addDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:t.addDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:t.addDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:t.addDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}else t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIME),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);switch(a){case 0:i?t.setVector3(Nl.ROLANGULARVELOCITYCONSTSEPRARATE,n.constantSeparate):t.setNumber(Nl.ROLANGULARVELOCITYCONST,n.constant);break;case 1:i?(t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTX,n.gradientX._elements),t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTY,n.gradientY._elements),t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTZ,n.gradientZ._elements)):t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENT,n.gradient._elements);break;case 2:i?(t.setVector3(Nl.ROLANGULARVELOCITYCONSTSEPRARATE,n.constantMinSeparate),t.setVector3(Nl.ROLANGULARVELOCITYCONSTMAXSEPRARATE,n.constantMaxSeparate)):(t.setNumber(Nl.ROLANGULARVELOCITYCONST,n.constantMin),t.setNumber(Nl.ROLANGULARVELOCITYCONSTMAX,n.constantMax));break;case 3:i?(t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTX,n.gradientXMin._elements),t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTXMAX,n.gradientXMax._elements),t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTY,n.gradientYMin._elements),t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTYMAX,n.gradientYMax._elements),t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTZ,n.gradientZMin._elements),t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTZMAX,n.gradientZMax._elements)):(t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENT,n.gradientMin._elements),t.setBuffer(Nl.ROLANGULARVELOCITYGRADIENTMAX,n.gradientMax._elements))}}else t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIME),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),t.removeDefine(Nl.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);this._rotationOverLifetime=e}},{key:"textureSheetAnimation",get:function(){return this._textureSheetAnimation},set:function(e){var t=this._owner._render._shaderValues;if(e){var n,i,a=e.frame,r=a.type;if(e.enable)switch(r){case 1:t.addDefine(Nl.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:t.addDefine(Nl.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}else t.removeDefine(Nl.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),t.removeDefine(Nl.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);switch(1!==r&&3!==r||(t.setNumber(Nl.TEXTURESHEETANIMATIONCYCLES,e.cycles),n=e.tiles,(i=this._uvLength).x=1/n.x,i.y=1/n.y,t.setVector2(Nl.TEXTURESHEETANIMATIONSUBUVLENGTH,this._uvLength)),r){case 1:t.setBuffer(Nl.TEXTURESHEETANIMATIONGRADIENTUVS,a.frameOverTimeData._elements);break;case 3:t.setBuffer(Nl.TEXTURESHEETANIMATIONGRADIENTUVS,a.frameOverTimeDataMin._elements),t.setBuffer(Nl.TEXTURESHEETANIMATIONGRADIENTMAXUVS,a.frameOverTimeDataMax._elements)}}else t.removeDefine(Nl.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),t.removeDefine(Nl.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);this._textureSheetAnimation=e}}]),U}();Vl._RANDOMOFFSET=new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447]),Vl.halfKSqrtOf2=.71,Vl._maxElapsedTime=1/3,Vl._tempVector30=new vn,Vl._tempVector31=new vn,Vl._tempVector32=new vn,Vl._tempVector33=new vn,Vl._tempVector34=new vn,Vl._tempVector35=new vn,Vl._tempVector36=new vn,Vl._tempVector37=new vn,Vl._tempVector38=new vn,Vl._tempVector39=new vn,Vl._tempPosition=new vn,Vl._tempDirection=new vn,Vl._type=Ia._typeCounter++;var Ul=function(){function i(e,t,n){S(this,i),this._time=e,this._minCount=t,this._maxCount=n}return C(i,[{key:"cloneTo",value:function(e){e._time=this._time,e._minCount=this._minCount,e._maxCount=this._maxCount}},{key:"clone",value:function(){var e=new i(this._time,this._minCount,this._maxCount);return this.cloneTo(e),e}},{key:"time",get:function(){return this._time}},{key:"minCount",get:function(){return this._minCount}},{key:"maxCount",get:function(){return this._maxCount}}]),i}(),zl=function(){function i(){S(this,i),this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}return C(i,[{key:"cloneTo",value:function(e){e._type=this._type,this._constant.cloneTo(e._constant),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradient.cloneTo(e._gradient),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax)}},{key:"clone",value:function(){var e=new i;return this.cloneTo(e),e}},{key:"type",get:function(){return this._type}},{key:"constant",get:function(){return this._constant}},{key:"constantMin",get:function(){return this._constantMin}},{key:"constantMax",get:function(){return this._constantMax}},{key:"gradient",get:function(){return this._gradient}},{key:"gradientMin",get:function(){return this._gradientMin}},{key:"gradientMax",get:function(){return this._gradientMax}}],[{key:"createByConstant",value:function(e){var t=new i;return t._type=0,t._constant=e,t}},{key:"createByGradient",value:function(e){var t=new i;return t._type=1,t._gradient=e,t}},{key:"createByRandomTwoConstant",value:function(e,t){var n=new i;return n._type=2,n._constantMin=e,n._constantMax=t,n}},{key:"createByRandomTwoGradient",value:function(e,t){var n=new i;return n._type=3,n._gradientMin=e,n._gradientMax=t,n}}]),i}(),Gl=function(){function n(e){S(this,n),this._color=e}return C(n,[{key:"cloneTo",value:function(e){this._color.cloneTo(e._color),e.enbale=this.enbale}},{key:"clone",value:function(){var e;switch(this._color.type){case 0:e=zl.createByConstant(this._color.constant.clone());break;case 1:e=zl.createByGradient(this._color.gradient.clone());break;case 2:e=zl.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:e=zl.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var t=new n(e);return t.enbale=this.enbale,t}},{key:"color",get:function(){return this._color}}]),n}(),Xl=function(){function i(){S(this,i),this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}return C(i,[{key:"cloneTo",value:function(e){e._type=this._type,e._constant=this._constant,this._overTime&&this._overTime.cloneTo(e._overTime),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._overTimeMin&&this._overTimeMin.cloneTo(e._overTimeMin),this._overTimeMax&&this._overTimeMax.cloneTo(e._overTimeMax)}},{key:"clone",value:function(){var e=new i;return this.cloneTo(e),e}},{key:"type",get:function(){return this._type}},{key:"constant",get:function(){return this._constant}},{key:"frameOverTimeData",get:function(){return this._overTime}},{key:"constantMin",get:function(){return this._constantMin}},{key:"constantMax",get:function(){return this._constantMax}},{key:"frameOverTimeDataMin",get:function(){return this._overTimeMin}},{key:"frameOverTimeDataMax",get:function(){return this._overTimeMax}}],[{key:"createByConstant",value:function(e){var t=new i;return t._type=0,t._constant=e,t}},{key:"createByOverTime",value:function(e){var t=new i;return t._type=1,t._overTime=e,t}},{key:"createByRandomTwoConstant",value:function(e,t){var n=new i;return n._type=2,n._constantMin=e,n._constantMax=t,n}},{key:"createByRandomTwoOverTime",value:function(e,t){var n=new i;return n._type=3,n._overTimeMin=e,n._overTimeMax=t,n}}]),i}(),Hl=function(){function h(){S(this,h),this._type=0,this._separateAxes=!1,this._constant=0,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=0,this._constantMax=0,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}return C(h,[{key:"cloneTo",value:function(e){e._type=this._type,e._separateAxes=this._separateAxes,e._constant=this._constant,this._constantSeparate.cloneTo(e._constantSeparate),this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)}},{key:"clone",value:function(){var e=new h;return this.cloneTo(e),e}},{key:"type",get:function(){return this._type}},{key:"separateAxes",get:function(){return this._separateAxes}},{key:"constant",get:function(){return this._constant}},{key:"constantSeparate",get:function(){return this._constantSeparate}},{key:"gradient",get:function(){return this._gradient}},{key:"gradientX",get:function(){return this._gradientX}},{key:"gradientY",get:function(){return this._gradientY}},{key:"gradientZ",get:function(){return this._gradientZ}},{key:"gradientW",get:function(){return this._gradientW}},{key:"constantMin",get:function(){return this._constantMin}},{key:"constantMax",get:function(){return this._constantMax}},{key:"constantMinSeparate",get:function(){return this._constantMinSeparate}},{key:"constantMaxSeparate",get:function(){return this._constantMaxSeparate}},{key:"gradientMin",get:function(){return this._gradientMin}},{key:"gradientMax",get:function(){return this._gradientMax}},{key:"gradientXMin",get:function(){return this._gradientXMin}},{key:"gradientXMax",get:function(){return this._gradientXMax}},{key:"gradientYMin",get:function(){return this._gradientYMin}},{key:"gradientYMax",get:function(){return this._gradientYMax}},{key:"gradientZMin",get:function(){return this._gradientZMin}},{key:"gradientZMax",get:function(){return this._gradientZMax}},{key:"gradientWMin",get:function(){return this._gradientWMin}},{key:"gradientWMax",get:function(){return this._gradientWMax}}],[{key:"createByConstant",value:function(e){var t=new h;return t._type=0,t._separateAxes=!1,t._constant=e,t}},{key:"createByConstantSeparate",value:function(e){var t=new h;return t._type=0,t._separateAxes=!0,t._constantSeparate=e,t}},{key:"createByGradient",value:function(e){var t=new h;return t._type=1,t._separateAxes=!1,t._gradient=e,t}},{key:"createByGradientSeparate",value:function(e,t,n){var i=new h;return i._type=1,i._separateAxes=!0,i._gradientX=e,i._gradientY=t,i._gradientZ=n,i}},{key:"createByRandomTwoConstant",value:function(e,t){var n=new h;return n._type=2,n._separateAxes=!1,n._constantMin=e,n._constantMax=t,n}},{key:"createByRandomTwoConstantSeparate",value:function(e,t){var n=new h;return n._type=2,n._separateAxes=!0,n._constantMinSeparate=e,n._constantMaxSeparate=t,n}},{key:"createByRandomTwoGradient",value:function(e,t){var n=new h;return n._type=3,n._separateAxes=!1,n._gradientMin=e,n._gradientMax=t,n}},{key:"createByRandomTwoGradientSeparate",value:function(e,t,n,i,a,r,o,s){var l=new h;return l._type=3,l._separateAxes=!0,l._gradientXMin=e,l._gradientXMax=t,l._gradientYMin=n,l._gradientYMax=i,l._gradientZMin=a,l._gradientZMax=r,l._gradientWMin=o,l._gradientWMax=s,l}}]),h}(),Yl=function(){function t(){S(this,t),this._currentLength=0,this._elements=new Float32Array(8)}return C(t,[{key:"add",value:function(e,t){this._currentLength<8?(6===this._currentLength&&1!==e&&(e=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=e,this._elements[this._currentLength++]=t):console.log("Warning:data count must lessEqual than 4")}},{key:"cloneTo",value:function(e){e._currentLength=this._currentLength;for(var t=e._elements,n=0,i=this._elements.length;n<i;n++)t[n]=this._elements[n]}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}},{key:"gradientCount",get:function(){return this._currentLength/2}}]),t}(),Wl=function(){function s(){S(this,s),this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=0,this._constantMax=0,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}return C(s,[{key:"getMaxSizeInGradient",value:function(){var e,t,n=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(e=0,t=this._gradientX.gradientCount;e<t;e++)n=Math.max(n,this._gradientX.getValueByIndex(e));for(e=0,t=this._gradientY.gradientCount;e<t;e++)n=Math.max(n,this._gradientY.getValueByIndex(e))}else for(e=0,t=this._gradient.gradientCount;e<t;e++)n=Math.max(n,this._gradient.getValueByIndex(e));break;case 1:n=this._separateAxes?(n=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),n=Math.max(n,this._constantMinSeparate.y),Math.max(n,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(e=0,t=this._gradientXMin.gradientCount;e<t;e++)n=Math.max(n,this._gradientXMin.getValueByIndex(e));for(e=0,t=this._gradientXMax.gradientCount;e<t;e++)n=Math.max(n,this._gradientXMax.getValueByIndex(e));for(e=0,t=this._gradientYMin.gradientCount;e<t;e++)n=Math.max(n,this._gradientYMin.getValueByIndex(e));for(e=0,t=this._gradientZMax.gradientCount;e<t;e++)n=Math.max(n,this._gradientZMax.getValueByIndex(e))}else{for(e=0,t=this._gradientMin.gradientCount;e<t;e++)n=Math.max(n,this._gradientMin.getValueByIndex(e));for(e=0,t=this._gradientMax.gradientCount;e<t;e++)n=Math.max(n,this._gradientMax.getValueByIndex(e))}}return n}},{key:"cloneTo",value:function(e){e._type=this._type,e._separateAxes=this._separateAxes,this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)}},{key:"clone",value:function(){var e=new s;return this.cloneTo(e),e}},{key:"type",get:function(){return this._type}},{key:"separateAxes",get:function(){return this._separateAxes}},{key:"gradient",get:function(){return this._gradient}},{key:"gradientX",get:function(){return this._gradientX}},{key:"gradientY",get:function(){return this._gradientY}},{key:"gradientZ",get:function(){return this._gradientZ}},{key:"constantMin",get:function(){return this._constantMin}},{key:"constantMax",get:function(){return this._constantMax}},{key:"constantMinSeparate",get:function(){return this._constantMinSeparate}},{key:"constantMaxSeparate",get:function(){return this._constantMaxSeparate}},{key:"gradientMin",get:function(){return this._gradientMin}},{key:"gradientMax",get:function(){return this._gradientMax}},{key:"gradientXMin",get:function(){return this._gradientXMin}},{key:"gradientXMax",get:function(){return this._gradientXMax}},{key:"gradientYMin",get:function(){return this._gradientYMin}},{key:"gradientYMax",get:function(){return this._gradientYMax}},{key:"gradientZMin",get:function(){return this._gradientZMin}},{key:"gradientZMax",get:function(){return this._gradientZMax}}],[{key:"createByGradient",value:function(e){var t=new s;return t._type=0,t._separateAxes=!1,t._gradient=e,t}},{key:"createByGradientSeparate",value:function(e,t,n){var i=new s;return i._type=0,i._separateAxes=!0,i._gradientX=e,i._gradientY=t,i._gradientZ=n,i}},{key:"createByRandomTwoConstant",value:function(e,t){var n=new s;return n._type=1,n._separateAxes=!1,n._constantMin=e,n._constantMax=t,n}},{key:"createByRandomTwoConstantSeparate",value:function(e,t){var n=new s;return n._type=1,n._separateAxes=!0,n._constantMinSeparate=e,n._constantMaxSeparate=t,n}},{key:"createByRandomTwoGradient",value:function(e,t){var n=new s;return n._type=2,n._separateAxes=!1,n._gradientMin=e,n._gradientMax=t,n}},{key:"createByRandomTwoGradientSeparate",value:function(e,t,n,i,a,r){var o=new s;return o._type=2,o._separateAxes=!0,o._gradientXMin=e,o._gradientXMax=t,o._gradientYMin=n,o._gradientYMax=i,o._gradientZMin=a,o._gradientZMax=r,o}}]),s}(),jl=function(){function s(){S(this,s),this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}return C(s,[{key:"cloneTo",value:function(e){e._type=this._type,this._constant.cloneTo(e._constant),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)}},{key:"clone",value:function(){var e=new s;return this.cloneTo(e),e}},{key:"type",get:function(){return this._type}},{key:"constant",get:function(){return this._constant}},{key:"gradientX",get:function(){return this._gradientX}},{key:"gradientY",get:function(){return this._gradientY}},{key:"gradientZ",get:function(){return this._gradientZ}},{key:"constantMin",get:function(){return this._constantMin}},{key:"constantMax",get:function(){return this._constantMax}},{key:"gradientXMin",get:function(){return this._gradientXMin}},{key:"gradientXMax",get:function(){return this._gradientXMax}},{key:"gradientYMin",get:function(){return this._gradientYMin}},{key:"gradientYMax",get:function(){return this._gradientYMax}},{key:"gradientZMin",get:function(){return this._gradientZMin}},{key:"gradientZMax",get:function(){return this._gradientZMax}}],[{key:"createByConstant",value:function(e){var t=new s;return t._type=0,t._constant=e,t}},{key:"createByGradient",value:function(e,t,n){var i=new s;return i._type=1,i._gradientX=e,i._gradientY=t,i._gradientZ=n,i}},{key:"createByRandomTwoConstant",value:function(e,t){var n=new s;return n._type=2,n._constantMin=e,n._constantMax=t,n}},{key:"createByRandomTwoGradient",value:function(e,t,n,i,a,r){var o=new s;return o._type=3,o._gradientXMin=e,o._gradientXMax=t,o._gradientYMin=n,o._gradientYMax=i,o._gradientZMin=a,o._gradientZMax=r,o}}]),s}(),ql=function(){function n(e){S(this,n),this._angularVelocity=e}return C(n,[{key:"cloneTo",value:function(e){this._angularVelocity.cloneTo(e._angularVelocity),e.enbale=this.enbale}},{key:"clone",value:function(){var e;switch(this._angularVelocity.type){case 0:e=this._angularVelocity.separateAxes?Hl.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):Hl.createByConstant(this._angularVelocity.constant);break;case 1:e=this._angularVelocity.separateAxes?Hl.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone()):Hl.createByGradient(this._angularVelocity.gradient.clone());break;case 2:e=this._angularVelocity.separateAxes?Hl.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):Hl.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:e=this._angularVelocity.separateAxes?Hl.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):Hl.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var t=new n(e);return t.enbale=this.enbale,t}},{key:"angularVelocity",get:function(){return this._angularVelocity}}]),n}(),Zl=function(){function t(){S(this,t)}return C(t,[{key:"_getShapeBoundBox",value:function(e){throw new Error("BaseShape: must override it.")}},{key:"_getSpeedBoundBox",value:function(e){throw new Error("BaseShape: must override it.")}},{key:"generatePositionAndDirection",value:function(e,t){throw new Error("BaseShape: must override it.")}},{key:"_calculateProceduralBounds",value:function(e,t,n){this._getShapeBoundBox(e);var i=e.min,a=e.max;vn.multiply(i,t,i),vn.multiply(a,t,a);var r=new cr(new vn,new vn);this.randomDirection?(r.min=new vn(-1,-1,-1),r.max=new vn(1,1,1)):this._getSpeedBoundBox(r);var o=new cr(new vn,new vn),s=o.min,i=o.max;vn.scale(r.min,n.y,s),vn.scale(r.max,n.y,i),vn.add(e.min,s,s),vn.add(e.max,i,i),vn.min(e.min,s,e.min),vn.max(e.max,s,e.max);t=new cr(new vn,new vn),a=t.min,o=t.max;vn.scale(r.min,n.x,a),vn.scale(r.max,n.x,o),vn.min(t.min,o,s),vn.max(t.min,o,i),vn.min(e.min,s,e.min),vn.max(e.max,s,e.max)}},{key:"cloneTo",value:function(e){e.enable=this.enable}},{key:"clone",value:function(){var e=new t;return this.cloneTo(e),e}}]),t}(),Kl=function(){function i(){S(this,i)}return C(i,null,[{key:"_randomPointUnitArcCircle",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=n?n.getFloat()*e:Math.random()*e;t.x=Math.cos(e),t.y=Math.sin(e)}},{key:"_randomPointInsideUnitArcCircle",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;i._randomPointUnitArcCircle(e,t,n),n=n?Math.pow(n.getFloat(),.5):Math.pow(Math.random(),.5),t.x=t.x*n,t.y=t.y*n}},{key:"_randomPointUnitCircle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=t?t.getFloat()*Math.PI*2:Math.random()*Math.PI*2;e.x=Math.cos(t),e.y=Math.sin(t)}},{key:"_randomPointInsideUnitCircle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;i._randomPointUnitCircle(e),t=t?Math.pow(t.getFloat(),.5):Math.pow(Math.random(),.5),e.x=e.x*t,e.y=e.y*t}},{key:"_randomPointUnitSphere",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=t?(n=e.z=2*t.getFloat()-1,t.getFloat()*Math.PI*2):(n=e.z=2*Math.random()-1,Math.random()*Math.PI*2),n=Math.sqrt(1-n*n);e.x=n*Math.cos(t),e.y=n*Math.sin(t)}},{key:"_randomPointInsideUnitSphere",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;i._randomPointUnitSphere(e),t=t?Math.pow(t.getFloat(),1/3):Math.pow(Math.random(),1/3),e.x=e.x*t,e.y=e.y*t,e.z=e.z*t}},{key:"_randomPointInsideHalfUnitBox",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;t?(e.x=t.getFloat()-.5,e.y=t.getFloat()-.5,e.z=t.getFloat()-.5):(e.x=Math.random()-.5,e.y=Math.random()-.5,e.z=Math.random()-.5)}}]),i}(),Ql=function(){T(n,Zl);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).x=1,e.y=1,e.z=1,e.randomDirection=!1,e}return C(n,[{key:"_getShapeBoundBox",value:function(e){var t=e.min;t.x=.5*-this.x,t.y=.5*-this.y,t.z=.5*-this.z;e=e.max;e.x=.5*this.x,e.y=.5*this.y,e.z=.5*this.z}},{key:"_getSpeedBoundBox",value:function(e){var t=e.min;t.x=0,t.y=0,t.z=0;e=e.max;e.x=0,e.y=1,e.z=0}},{key:"generatePositionAndDirection",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;n?(n.seed=i[16],Kl._randomPointInsideHalfUnitBox(e,n),i[16]=n.seed):Kl._randomPointInsideHalfUnitBox(e),e.x=this.x*e.x,e.y=this.y*e.y,e.z=this.z*e.z,this.randomDirection?n?(n.seed=i[17],Kl._randomPointUnitSphere(t,n),i[17]=n.seed):Kl._randomPointUnitSphere(t):(t.x=0,t.y=0,t.z=1)}},{key:"cloneTo",value:function(e){G(z(n.prototype),"cloneTo",this).call(this,e);e.x=this.x,e.y=this.y,e.z=this.z,e.randomDirection=this.randomDirection}},{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}}]),n}(),Jl=function(){T(r,Zl);var t=b(r);function r(){var e;return S(this,r),(e=t.call(this)).radius=1,e.arc=2*Math.PI,e.emitFromEdge=!1,e.randomDirection=!1,e}return C(r,[{key:"_getShapeBoundBox",value:function(e){var t=e.min;t.x=t.z=-this.radius,t.y=0;e=e.max;e.x=e.z=this.radius,e.y=0}},{key:"_getSpeedBoundBox",value:function(e){var t=e.min;t.x=t.y=-1,t.z=0;e=e.max;e.x=e.y=1,e.z=0}},{key:"generatePositionAndDirection",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=r._tempPositionPoint;n?(n.seed=i[16],this.emitFromEdge?Kl._randomPointUnitArcCircle(this.arc,r._tempPositionPoint,n):Kl._randomPointInsideUnitArcCircle(this.arc,r._tempPositionPoint,n),i[16]=n.seed):this.emitFromEdge?Kl._randomPointUnitArcCircle(this.arc,r._tempPositionPoint):Kl._randomPointInsideUnitArcCircle(this.arc,r._tempPositionPoint),e.x=-a.x,e.y=a.y,e.z=0,vn.scale(e,this.radius,e),this.randomDirection?n?(n.seed=i[17],Kl._randomPointUnitSphere(t,n),i[17]=n.seed):Kl._randomPointUnitSphere(t):e.cloneTo(t)}},{key:"cloneTo",value:function(e){G(z(r.prototype),"cloneTo",this).call(this,e);e.radius=this.radius,e.arc=this.arc,e.emitFromEdge=this.emitFromEdge,e.randomDirection=this.randomDirection}},{key:"clone",value:function(){var e=new r;return this.cloneTo(e),e}}]),r}();Jl._tempPositionPoint=new gn;var $l=function(){T(u,Zl);var t=b(u);function u(){var e;return S(this,u),(e=t.call(this)).angle=25/180*Math.PI,e.radius=1,e.length=5,e.emitType=0,e.randomDirection=!1,e}return C(u,[{key:"_getShapeBoundBox",value:function(e){var t=this.radius+this.length*Math.sin(this.angle),n=this.length*Math.cos(this.angle),i=e.min;i.x=i.y=-t,i.z=0;e=e.max;e.x=e.y=t,e.z=n}},{key:"_getSpeedBoundBox",value:function(e){var t=Math.sin(this.angle),n=e.min;n.x=n.y=-t,n.z=0;e=e.max;e.x=e.y=t,e.z=1}},{key:"generatePositionAndDirection",value:function(e,t){var n,i,a,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,s=u._tempPositionPoint,l=Math.cos(this.angle),h=Math.sin(this.angle);switch(this.emitType){case 0:r?(r.seed=o[16],Kl._randomPointInsideUnitCircle(u._tempPositionPoint,r),o[16]=r.seed):Kl._randomPointInsideUnitCircle(u._tempPositionPoint),n=s.x,i=s.y,e.x=n*this.radius,e.y=i*this.radius,e.z=0,this.randomDirection?(r?(r.seed=o[17],Kl._randomPointInsideUnitCircle(u._tempDirectionPoint,r),o[17]=r.seed):Kl._randomPointInsideUnitCircle(u._tempDirectionPoint),a=u._tempDirectionPoint,t.x=a.x*h,t.y=a.y*h):(t.x=n*h,t.y=i*h),t.z=l;break;case 1:r?(r.seed=o[16],Kl._randomPointUnitCircle(u._tempPositionPoint,r),o[16]=r.seed):Kl._randomPointUnitCircle(u._tempPositionPoint),n=s.x,i=s.y,e.x=n*this.radius,e.y=i*this.radius,e.z=0,this.randomDirection?(r?(r.seed=o[17],Kl._randomPointInsideUnitCircle(u._tempDirectionPoint,r),o[17]=r.seed):Kl._randomPointInsideUnitCircle(u._tempDirectionPoint),a=u._tempDirectionPoint,t.x=a.x*h,t.y=a.y*h):(t.x=n*h,t.y=i*h),t.z=l;break;case 2:r?(r.seed=o[16],Kl._randomPointInsideUnitCircle(u._tempPositionPoint,r)):Kl._randomPointInsideUnitCircle(u._tempPositionPoint),n=s.x,i=s.y,e.x=n*this.radius,e.y=i*this.radius,e.z=0,t.x=n*h,t.y=i*h,t.z=l,vn.normalize(t,t),r?(vn.scale(t,this.length*r.getFloat(),t),o[16]=r.seed):vn.scale(t,this.length*Math.random(),t),vn.add(e,t,e),this.randomDirection&&(r?(r.seed=o[17],Kl._randomPointUnitSphere(t,r),o[17]=r.seed):Kl._randomPointUnitSphere(t));break;case 3:r?(r.seed=o[16],Kl._randomPointUnitCircle(u._tempPositionPoint,r)):Kl._randomPointUnitCircle(u._tempPositionPoint),n=s.x,i=s.y,e.x=n*this.radius,e.y=i*this.radius,e.z=0,t.x=n*h,t.y=i*h,t.z=l,vn.normalize(t,t),r?(vn.scale(t,this.length*r.getFloat(),t),o[16]=r.seed):vn.scale(t,this.length*Math.random(),t),vn.add(e,t,e),this.randomDirection&&(r?(r.seed=o[17],Kl._randomPointUnitSphere(t,r),o[17]=r.seed):Kl._randomPointUnitSphere(t));break;default:throw new Error("ConeShape:emitType is invalid.")}}},{key:"cloneTo",value:function(e){G(z(u.prototype),"cloneTo",this).call(this,e);e.angle=this.angle,e.radius=this.radius,e.length=this.length,e.emitType=this.emitType,e.randomDirection=this.randomDirection}},{key:"clone",value:function(){var e=new u;return this.cloneTo(e),e}}]),u}();$l._tempPositionPoint=new gn,$l._tempDirectionPoint=new gn;var eh,th=function(){T(n,Zl);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).radius=1,e.emitFromShell=!1,e.randomDirection=!1,e}return C(n,[{key:"_getShapeBoundBox",value:function(e){var t=e.min;t.x=t.y=t.z=-this.radius;e=e.max;e.x=e.y=this.radius,e.z=0}},{key:"_getSpeedBoundBox",value:function(e){var t=e.min;t.x=t.y=-1,t.z=0;e=e.max;e.x=e.y=e.z=1}},{key:"generatePositionAndDirection",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;n?(n.seed=i[16],this.emitFromShell?Kl._randomPointUnitSphere(e,n):Kl._randomPointInsideUnitSphere(e,n),i[16]=n.seed):this.emitFromShell?Kl._randomPointUnitSphere(e):Kl._randomPointInsideUnitSphere(e),vn.scale(e,this.radius,e);var a=e.z;a<0&&(e.z=-1*a),this.randomDirection?n?(n.seed=i[17],Kl._randomPointUnitSphere(t,n),i[17]=n.seed):Kl._randomPointUnitSphere(t):e.cloneTo(t)}},{key:"cloneTo",value:function(e){G(z(n.prototype),"cloneTo",this).call(this,e);e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection}},{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}}]),n}(),nh=function(){T(n,Zl);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).radius=1,e.emitFromShell=!1,e.randomDirection=!1,e}return C(n,[{key:"_getShapeBoundBox",value:function(e){var t=e.min;t.x=t.y=t.z=-this.radius;e=e.max;e.x=e.y=e.z=this.radius}},{key:"_getSpeedBoundBox",value:function(e){var t=e.min;t.x=t.y=t.z=-1;e=e.max;e.x=e.y=e.z=1}},{key:"generatePositionAndDirection",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;n?(n.seed=i[16],this.emitFromShell?Kl._randomPointUnitSphere(e,n):Kl._randomPointInsideUnitSphere(e,n),i[16]=n.seed):this.emitFromShell?Kl._randomPointUnitSphere(e):Kl._randomPointInsideUnitSphere(e),vn.scale(e,this.radius,e),this.randomDirection?n?(n.seed=i[17],Kl._randomPointUnitSphere(t,n),i[17]=n.seed):Kl._randomPointUnitSphere(t):e.cloneTo(t)}},{key:"cloneTo",value:function(e){G(z(n.prototype),"cloneTo",this).call(this,e);e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection}},{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}}]),n}(),ih=function(){function n(e){S(this,n),this._size=e}return C(n,[{key:"cloneTo",value:function(e){this._size.cloneTo(e._size),e.enbale=this.enbale}},{key:"clone",value:function(){var e;switch(this._size.type){case 0:e=this._size.separateAxes?Wl.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):Wl.createByGradient(this._size.gradient.clone());break;case 1:e=this._size.separateAxes?Wl.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):Wl.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:e=this._size.separateAxes?Wl.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):Wl.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var t=new n(e);return t.enbale=this.enbale,t}},{key:"size",get:function(){return this._size}}]),n}(),ah=function(){function i(){S(this,i),this._type=0,this._constant=0,this._constantMin=0,this._constantMax=0}return C(i,[{key:"cloneTo",value:function(e){e._type=this._type,e._constant=this._constant,e._constantMin=this._constantMin,e._constantMax=this._constantMax}},{key:"clone",value:function(){var e=new i;return this.cloneTo(e),e}},{key:"type",get:function(){return this._type}},{key:"constant",get:function(){return this._constant}},{key:"constantMin",get:function(){return this._constantMin}},{key:"constantMax",get:function(){return this._constantMax}}],[{key:"createByConstant",value:function(e){var t=new i;return t._type=0,t._constant=e,t}},{key:"createByRandomTwoConstant",value:function(e,t){var n=new i;return n._type=1,n._constantMin=e,n._constantMax=t,n}}]),i}(),rh=function(){function i(e,t){S(this,i),this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new gn(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=e,this._startFrame=t}return C(i,[{key:"cloneTo",value:function(e){this.tiles.cloneTo(e.tiles),e.type=this.type,e.randomRow=this.randomRow,e.rowIndex=this.rowIndex,e.cycles=this.cycles,e.enableUVChannels=this.enableUVChannels,e.enable=this.enable,this._frame.cloneTo(e._frame),this._startFrame.cloneTo(e._startFrame)}},{key:"clone",value:function(){var e,t;switch(this._frame.type){case 0:e=Xl.createByConstant(this._frame.constant);break;case 1:e=Xl.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:e=Xl.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:e=Xl.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:t=ah.createByConstant(this._startFrame.constant);break;case 1:t=ah.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var n=new i(e,t);return this.cloneTo(n),n}},{key:"frame",get:function(){return this._frame}},{key:"startFrame",get:function(){return this._startFrame}}]),i}(),oh=function(){function n(e){S(this,n),this.enbale=!1,this.space=0,this._velocity=e}return C(n,[{key:"cloneTo",value:function(e){this._velocity.cloneTo(e._velocity),e.enbale=this.enbale,e.space=this.space}},{key:"clone",value:function(){var e;switch(this._velocity.type){case 0:e=jl.createByConstant(this._velocity.constant.clone());break;case 1:e=jl.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:e=jl.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:e=jl.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var t=new n(e);return t.enbale=this.enbale,t.space=this.space,t}},{key:"velocity",get:function(){return this._velocity}}]),n}(),sh=function(){T(V,ga);var n=b(V);function V(){var e;S(this,V),(e=n.call(this,null))._render=new Cl(u(e)),e._particleSystem=new Vl(u(e));var t=e._render._renderElements[0]=new ar;return t.setTransform(e._transform),t.render=e._render,t.setGeometry(e._particleSystem),t.material=Il.defaultMaterial,e}return C(V,[{key:"_initParticleVelocity",value:function(e){for(var t=new Fl,n=e.velocitys,i=0,a=n.length;i<a;i++){var r=n[i];t.add(r.key,r.value)}return t}},{key:"_initParticleColor",value:function(e){for(var t=new Sl(4,4),n=e.alphas,i=0,a=n.length;i<a;i++){var r=n[i];3===i&&1!==r.key&&(r.key=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),t.addColorAlpha(r.key,r.value)}var o=e.rgbs;for(i=0,a=o.length;i<a;i++){var s=o[i],l=s.value;3===i&&1!==s.key&&(s.key=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),t.addColorRGB(s.key,new Ta(l[0],l[1],l[2],1))}return t}},{key:"_initParticleSize",value:function(e){for(var t=new Fl,n=e.sizes,i=0,a=n.length;i<a;i++){var r=n[i];t.add(r.key,r.value)}return t}},{key:"_initParticleRotation",value:function(e){for(var t=new Fl,n=e.angularVelocitys,i=0,a=n.length;i<a;i++){var r=n[i];t.add(r.key,r.value/180*Math.PI)}return t}},{key:"_initParticleFrame",value:function(e){for(var t=new Yl,n=e.frames,i=0,a=n.length;i<a;i++){var r=n[i];t.add(r.key,r.value)}return t}},{key:"_parse",value:function(e,t){G(z(V.prototype),"_parse",this).call(this,e,t);var n,i,a=Math.PI/180,r=this.particleRenderer,t=e.material;t&&(o=on.getRes(t.path)),r.sharedMaterial=o;t=e.meshPath;t&&(r.mesh=on.getRes(t)),r.renderMode=e.renderMode,r.stretchedBillboardCameraSpeedScale=e.stretchedBillboardCameraSpeedScale,r.stretchedBillboardSpeedScale=e.stretchedBillboardSpeedScale,r.stretchedBillboardLengthScale=e.stretchedBillboardLengthScale,r.sortingFudge=e.sortingFudge||0;var o=this.particleSystem;o.isPerformanceMode=e.isPerformanceMode,o.duration=e.duration,o.looping=e.looping,o.prewarm=e.prewarm,o.startDelayType=e.startDelayType,o.startDelay=e.startDelay,o.startDelayMin=e.startDelayMin,o.startDelayMax=e.startDelayMax,o.startLifetimeType=e.startLifetimeType,o.startLifetimeConstant=e.startLifetimeConstant,o.startLifeTimeGradient=V._initStartLife(e.startLifetimeGradient),o.startLifetimeConstantMin=e.startLifetimeConstantMin,o.startLifetimeConstantMax=e.startLifetimeConstantMax,o.startLifeTimeGradientMin=V._initStartLife(e.startLifetimeGradientMin),o.startLifeTimeGradientMax=V._initStartLife(e.startLifetimeGradientMax),o.startSpeedType=e.startSpeedType,o.startSpeedConstant=e.startSpeedConstant,o.startSpeedConstantMin=e.startSpeedConstantMin,o.startSpeedConstantMax=e.startSpeedConstantMax,o.threeDStartSize=e.threeDStartSize,o.startSizeType=e.startSizeType,o.startSizeConstant=e.startSizeConstant;t=e.startSizeConstantSeparate,r=o.startSizeConstantSeparate;r.x=t[0],r.y=t[1],r.z=t[2],o.startSizeConstantMin=e.startSizeConstantMin,o.startSizeConstantMax=e.startSizeConstantMax;r=e.startSizeConstantMinSeparate,t=o.startSizeConstantMinSeparate;t.x=r[0],t.y=r[1],t.z=r[2];t=e.startSizeConstantMaxSeparate,r=o.startSizeConstantMaxSeparate;r.x=t[0],r.y=t[1],r.z=t[2],o.threeDStartRotation=e.threeDStartRotation,o.startRotationType=e.startRotationType,o.startRotationConstant=e.startRotationConstant*a;r=e.startRotationConstantSeparate,t=o.startRotationConstantSeparate;t.x=r[0]*a,t.y=r[1]*a,t.z=r[2]*a,o.startRotationConstantMin=e.startRotationConstantMin*a,o.startRotationConstantMax=e.startRotationConstantMax*a;t=e.startRotationConstantMinSeparate,r=o.startRotationConstantMinSeparate;r.x=t[0]*a,r.y=t[1]*a,r.z=t[2]*a;r=e.startRotationConstantMaxSeparate,t=o.startRotationConstantMaxSeparate;t.x=r[0]*a,t.y=r[1]*a,t.z=r[2]*a,o.randomizeRotationDirection=e.randomizeRotationDirection,o.startColorType=e.startColorType;t=e.startColorConstant,r=o.startColorConstant;r.x=t[0],r.y=t[1],r.z=t[2],r.w=t[3];r=e.startColorConstantMin,t=o.startColorConstantMin;t.x=r[0],t.y=r[1],t.z=r[2],t.w=r[3];t=e.startColorConstantMax,r=o.startColorConstantMax;r.x=t[0],r.y=t[1],r.z=t[2],r.w=t[3],o.gravityModifier=e.gravityModifier,o.simulationSpace=e.simulationSpace,void 0!==e.simulationSpeed&&(o.simulationSpeed=e.simulationSpeed),o.scaleMode=e.scaleMode,o.playOnAwake=e.playOnAwake,o.maxParticles=e.maxParticles;t=e.autoRandomSeed;null!=t&&(o.autoRandomSeed=t);t=e.randomSeed;null!=t&&(o.randomSeed[0]=t);var t=e.emission,s=o.emission;if(t){s.emissionRate=t.emissionRate;var l=t.bursts;if(l)for(n=0,i=l.length;n<i;n++){var h=l[n];s.addBurst(new Ul(h.time,h.min,h.max))}s.enbale=t.enable}else s.enbale=!1;var u,d,c=e.shape;if(c){switch(c.shapeType){case 0:var _,f=_=new nh;_.radius=c.sphereRadius,_.emitFromShell=c.sphereEmitFromShell,_.randomDirection=c.sphereRandomDirection;break;case 1:f=_=new th,_.radius=c.hemiSphereRadius,_.emitFromShell=c.hemiSphereEmitFromShell,_.randomDirection=c.hemiSphereRandomDirection;break;case 2:f=u=new $l,u.angle=c.coneAngle*a,u.radius=c.coneRadius,u.length=c.coneLength,u.emitType=c.coneEmitType,u.randomDirection=c.coneRandomDirection;break;case 3:f=u=new Ql,u.x=c.boxX,u.y=c.boxY,u.z=c.boxZ,u.randomDirection=c.boxRandomDirection;break;case 7:f=d=new Jl,d.radius=c.circleRadius,d.arc=c.circleArc*a,d.emitFromEdge=c.circleEmitFromEdge,d.randomDirection=c.circleRandomDirection;break;default:f=d=new Jl,d.radius=c.circleRadius,d.arc=c.circleArc*a,d.emitFromEdge=c.circleEmitFromEdge,d.randomDirection=c.circleRandomDirection}f.enable=c.enable,o.shape=f}t=e.velocityOverLifetime;if(t){var g=t.velocity;switch(g.type){case 0:var y=g.constant,v=jl.createByConstant(new vn(y[0],y[1],y[2]));break;case 1:v=jl.createByGradient(this._initParticleVelocity(g.gradientX),this._initParticleVelocity(g.gradientY),this._initParticleVelocity(g.gradientZ));break;case 2:var p=g.constantMin,y=g.constantMax;v=jl.createByRandomTwoConstant(new vn(p[0],p[1],p[2]),new vn(y[0],y[1],y[2]));break;case 3:v=jl.createByRandomTwoGradient(this._initParticleVelocity(g.gradientXMin),this._initParticleVelocity(g.gradientXMax),this._initParticleVelocity(g.gradientYMin),this._initParticleVelocity(g.gradientYMax),this._initParticleVelocity(g.gradientZMin),this._initParticleVelocity(g.gradientZMax))}var m=new oh(v);m.space=t.space,m.enbale=t.enable,o.velocityOverLifetime=m}m=e.colorOverLifetime;if(m){var w=m.color;switch(w.type){case 0:var x=w.constant,k=zl.createByConstant(new yn(x[0],x[1],x[2],x[3]));break;case 1:k=zl.createByGradient(this._initParticleColor(w.gradient));break;case 2:var T=w.constantMin,x=w.constantMax;k=zl.createByRandomTwoConstant(new yn(T[0],T[1],T[2],T[3]),new yn(x[0],x[1],x[2],x[3]));break;case 3:k=zl.createByRandomTwoGradient(this._initParticleColor(w.gradientMin),this._initParticleColor(w.gradientMax))}var E=new Gl(k);E.enbale=m.enable,o.colorOverLifetime=E}E=e.sizeOverLifetime;if(E){var M,b,S,I=E.size;switch(I.type){case 0:S=I.separateAxes?Wl.createByGradientSeparate(this._initParticleSize(I.gradientX),this._initParticleSize(I.gradientY),this._initParticleSize(I.gradientZ)):Wl.createByGradient(this._initParticleSize(I.gradient));break;case 1:S=I.separateAxes?(M=I.constantMinSeparate,b=I.constantMaxSeparate,Wl.createByRandomTwoConstantSeparate(new vn(M[0],M[1],M[2]),new vn(b[0],b[1],b[2]))):Wl.createByRandomTwoConstant(I.constantMin,I.constantMax);break;case 2:S=I.separateAxes?Wl.createByRandomTwoGradientSeparate(this._initParticleSize(I.gradientXMin),this._initParticleSize(I.gradientYMin),this._initParticleSize(I.gradientZMin),this._initParticleSize(I.gradientXMax),this._initParticleSize(I.gradientYMax),this._initParticleSize(I.gradientZMax)):Wl.createByRandomTwoGradient(this._initParticleSize(I.gradientMin),this._initParticleSize(I.gradientMax))}var N=new ih(S);N.enbale=E.enable,o.sizeOverLifetime=N}N=e.rotationOverLifetime;if(N){var R,C,A,D=N.angularVelocity;switch(D.type){case 0:R=D.separateAxes?(A=D.constantSeparate,Hl.createByConstantSeparate(new vn(A[0]*a,A[1]*a,A[2]*a))):Hl.createByConstant(D.constant*a);break;case 1:R=D.separateAxes?Hl.createByGradientSeparate(this._initParticleRotation(D.gradientX),this._initParticleRotation(D.gradientY),this._initParticleRotation(D.gradientZ)):Hl.createByGradient(this._initParticleRotation(D.gradient));break;case 2:R=D.separateAxes?(C=D.constantMinSeparate,A=D.constantMaxSeparate,Hl.createByRandomTwoConstantSeparate(new vn(C[0]*a,C[1]*a,C[2]*a),new vn(A[0]*a,A[1]*a,A[2]*a))):Hl.createByRandomTwoConstant(D.constantMin*a,D.constantMax*a);break;case 3:D.separateAxes||(R=Hl.createByRandomTwoGradient(this._initParticleRotation(D.gradientMin),this._initParticleRotation(D.gradientMax)))}var L=new ql(R);L.enbale=N.enable,o.rotationOverLifetime=L}N=e.textureSheetAnimation;if(N){var O,P=N.frame;switch(P.type){case 0:O=Xl.createByConstant(P.constant);break;case 1:O=Xl.createByOverTime(this._initParticleFrame(P.overTime));break;case 2:O=Xl.createByRandomTwoConstant(P.constantMin,P.constantMax);break;case 3:O=Xl.createByRandomTwoOverTime(this._initParticleFrame(P.overTimeMin),this._initParticleFrame(P.overTimeMax))}var F,B=N.startFrame;switch(B.type){case 0:F=ah.createByConstant(B.constant);break;case 1:F=ah.createByRandomTwoConstant(B.constantMin,B.constantMax)}L=new rh(O,F);L.enable=N.enable;e=N.tiles;L.tiles=new gn(e[0],e[1]),L.type=N.type,L.randomRow=N.randomRow;e=N.rowIndex;void 0!==e&&(L.rowIndex=e),L.cycles=N.cycles,o.textureSheetAnimation=L}}},{key:"_activeHierarchy",value:function(e){G(z(V.prototype),"_activeHierarchy",this).call(this,e),this.particleSystem.playOnAwake&&this.particleSystem.play()}},{key:"_inActiveHierarchy",value:function(e){G(z(V.prototype),"_inActiveHierarchy",this).call(this,e),this.particleSystem.isAlive&&this.particleSystem.simulate(0,!0)}},{key:"_cloneTo",value:function(e,t,n){var i=e,a=i._particleSystem;this._particleSystem.cloneTo(a);a=i._render,i=this._render;a.sharedMaterials=i.sharedMaterials,a.enable=i.enable,a.renderMode=i.renderMode,a.mesh=i.mesh,a.stretchedBillboardCameraSpeedScale=i.stretchedBillboardCameraSpeedScale,a.stretchedBillboardSpeedScale=i.stretchedBillboardSpeedScale,a.stretchedBillboardLengthScale=i.stretchedBillboardLengthScale,a.sortingFudge=i.sortingFudge,G(z(V.prototype),"_cloneTo",this).call(this,e,t,n)}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.destroyed||(G(z(V.prototype),"destroy",this).call(this,e),this._particleSystem.destroy(),this._particleSystem=null)}},{key:"_create",value:function(){return new V}},{key:"particleSystem",get:function(){return this._particleSystem}},{key:"particleRenderer",get:function(){return this._render}}],[{key:"__init__",value:function(){Nl.SHADERDEFINE_RENDERMODE_BILLBOARD=ca.getDefineByName("SPHERHBILLBOARD"),Nl.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=ca.getDefineByName("STRETCHEDBILLBOARD"),Nl.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=ca.getDefineByName("HORIZONTALBILLBOARD"),Nl.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=ca.getDefineByName("VERTICALBILLBOARD"),Nl.SHADERDEFINE_COLOROVERLIFETIME=ca.getDefineByName("COLOROVERLIFETIME"),Nl.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=ca.getDefineByName("RANDOMCOLOROVERLIFETIME"),Nl.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=ca.getDefineByName("VELOCITYOVERLIFETIMECONSTANT"),Nl.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=ca.getDefineByName("VELOCITYOVERLIFETIMECURVE"),Nl.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=ca.getDefineByName("VELOCITYOVERLIFETIMERANDOMCONSTANT"),Nl.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=ca.getDefineByName("VELOCITYOVERLIFETIMERANDOMCURVE"),Nl.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=ca.getDefineByName("TEXTURESHEETANIMATIONCURVE"),Nl.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=ca.getDefineByName("TEXTURESHEETANIMATIONRANDOMCURVE"),Nl.SHADERDEFINE_ROTATIONOVERLIFETIME=ca.getDefineByName("ROTATIONOVERLIFETIME"),Nl.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=ca.getDefineByName("ROTATIONOVERLIFETIMESEPERATE"),Nl.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=ca.getDefineByName("ROTATIONOVERLIFETIMECONSTANT"),Nl.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=ca.getDefineByName("ROTATIONOVERLIFETIMECURVE"),Nl.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=ca.getDefineByName("ROTATIONOVERLIFETIMERANDOMCONSTANTS"),Nl.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=ca.getDefineByName("ROTATIONOVERLIFETIMERANDOMCURVES"),Nl.SHADERDEFINE_SIZEOVERLIFETIMECURVE=ca.getDefineByName("SIZEOVERLIFETIMECURVE"),Nl.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=ca.getDefineByName("SIZEOVERLIFETIMECURVESEPERATE"),Nl.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=ca.getDefineByName("SIZEOVERLIFETIMERANDOMCURVES"),Nl.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=ca.getDefineByName("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),Nl.SHADERDEFINE_RENDERMODE_MESH=ca.getDefineByName("RENDERMODE_MESH"),Nl.SHADERDEFINE_SHAPE=ca.getDefineByName("SHAPE")}},{key:"_initStartLife",value:function(e){for(var t=new Fl,n=e.startLifetimes,i=0,a=n.length;i<a;i++){var r=n[i];t.add(r.key,r.value)}return t}}]),V}(),lh=function(){T(n,hr);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).setShaderName("Trail"),e._color=new yn(1,1,1,1),e._shaderValues.setVector(n.TINTCOLOR,new yn(1,1,1,1)),e.renderMode=n.RENDERMODE_ALPHABLENDED,e}return C(n,[{key:"clone",value:function(){var e=new n;return this.cloneTo(e),e}},{key:"_TintColorR",get:function(){return this._color.x},set:function(e){this._color.x=e,this.color=this._color}},{key:"_TintColorG",get:function(){return this._color.y},set:function(e){this._color.y=e,this.color=this._color}},{key:"_TintColorB",get:function(){return this._color.z},set:function(e){this._color.z=e,this.color=this._color}},{key:"_TintColorA",get:function(){return this._color.w},set:function(e){this._color.w=e,this.color=this._color}},{key:"_MainTex_STX",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.x=e,this.tilingOffset=t}},{key:"_MainTex_STY",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.y=e,this.tilingOffset=t}},{key:"_MainTex_STZ",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.z=e,this.tilingOffset=t}},{key:"_MainTex_STW",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},set:function(e){var t=this._shaderValues.getVector(n.TILINGOFFSET);t.w=e,this.tilingOffset=t}},{key:"renderMode",set:function(e){switch(e){case n.RENDERMODE_ADDTIVE:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_NONE,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.addDefine(n.SHADERDEFINE_ADDTIVEFOG);break;case n.RENDERMODE_ALPHABLENDED:this.renderQueue=hr.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ur.CULL_NONE,this.blend=ur.BLEND_ENABLE_ALL,this.blendSrc=ur.BLENDPARAM_SRC_ALPHA,this.blendDst=ur.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ur.DEPTHTEST_LESS,this._shaderValues.removeDefine(n.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("TrailMaterial : renderMode value error.")}}},{key:"colorR",get:function(){return this._TintColorR},set:function(e){this._TintColorR=e}},{key:"colorG",get:function(){return this._TintColorG},set:function(e){this._TintColorG=e}},{key:"colorB",get:function(){return this._TintColorB},set:function(e){this._TintColorB=e}},{key:"colorA",get:function(){return this._TintColorA},set:function(e){this._TintColorA=e}},{key:"color",get:function(){return this._shaderValues.getVector(n.TINTCOLOR)},set:function(e){this._shaderValues.setVector(n.TINTCOLOR,e)}},{key:"texture",get:function(){return this._shaderValues.getTexture(n.MAINTEXTURE)},set:function(e){e?this._shaderValues.addDefine(n.SHADERDEFINE_MAINTEXTURE):this._shaderValues.removeDefine(n.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(n.MAINTEXTURE,e)}},{key:"tilingOffsetX",get:function(){return this._MainTex_STX},set:function(e){this._MainTex_STX=e}},{key:"tilingOffsetY",get:function(){return this._MainTex_STY},set:function(e){this._MainTex_STY=e}},{key:"tilingOffsetZ",get:function(){return this._MainTex_STZ},set:function(e){this._MainTex_STZ=e}},{key:"tilingOffsetW",get:function(){return this._MainTex_STW},set:function(e){this._MainTex_STW=e}},{key:"tilingOffset",get:function(){return this._shaderValues.getVector(n.TILINGOFFSET)},set:function(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(n.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(n.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,e)}},{key:"depthWrite",set:function(e){this._shaderValues.setBool(n.DEPTH_WRITE,e)},get:function(){return this._shaderValues.getBool(n.DEPTH_WRITE)}},{key:"cull",set:function(e){this._shaderValues.setInt(n.CULL,e)},get:function(){return this._shaderValues.getInt(n.CULL)}},{key:"blend",set:function(e){this._shaderValues.setInt(n.BLEND,e)},get:function(){return this._shaderValues.getInt(n.BLEND)}},{key:"blendSrc",set:function(e){this._shaderValues.setInt(n.BLEND_SRC,e)},get:function(){return this._shaderValues.getInt(n.BLEND_SRC)}},{key:"blendDst",set:function(e){this._shaderValues.setInt(n.BLEND_DST,e)},get:function(){return this._shaderValues.getInt(n.BLEND_DST)}},{key:"depthTest",set:function(e){this._shaderValues.setInt(n.DEPTH_TEST,e)},get:function(){return this._shaderValues.getInt(n.DEPTH_TEST)}}],[{key:"__initDefine__",value:function(){n.SHADERDEFINE_MAINTEXTURE=ca.getDefineByName("MAINTEXTURE"),n.SHADERDEFINE_TILINGOFFSET=ca.getDefineByName("TILINGOFFSET"),n.SHADERDEFINE_ADDTIVEFOG=ca.getDefineByName("ADDTIVEFOG")}}]),n}();function hh(){S(this,hh)}lh.RENDERMODE_ALPHABLENDED=0,lh.RENDERMODE_ADDTIVE=1,lh.MAINTEXTURE=ca.propertyNameToID("u_MainTexture"),lh.TINTCOLOR=ca.propertyNameToID("u_MainColor"),lh.TILINGOFFSET=ca.propertyNameToID("u_TilingOffset"),lh.CULL=ca.propertyNameToID("s_Cull"),lh.BLEND=ca.propertyNameToID("s_Blend"),lh.BLEND_SRC=ca.propertyNameToID("s_BlendSrc"),lh.BLEND_DST=ca.propertyNameToID("s_BlendDst"),lh.DEPTH_TEST=ca.propertyNameToID("s_DepthTest"),lh.DEPTH_WRITE=ca.propertyNameToID("s_DepthWrite"),hh.Stretch=0,hh.Tile=1,(rl=eh=eh||{})[rl.View=0]="View",rl[rl.TransformZ=1]="TransformZ";var uh=function(){function e(){S(this,e)}return C(e,[{key:"vertexDeclaration",get:function(){return e._vertexDeclaration1}}],[{key:"__init__",value:function(){e._vertexDeclaration1=new pa(32,[new ma(0,ya.Vector3,e.TRAIL_POSITION0),new ma(12,ya.Vector3,e.TRAIL_OFFSETVECTOR),new ma(24,ya.Single,e.TRAIL_TIME0),new ma(28,ya.Single,e.TRAIL_TEXTURECOORDINATE0Y)]),e._vertexDeclaration2=new pa(20,[new ma(0,ya.Single,e.TRAIL_TEXTURECOORDINATE0X),new ma(4,ya.Color,e.TRAIL_COLOR)])}},{key:"vertexDeclaration1",get:function(){return e._vertexDeclaration1}},{key:"vertexDeclaration2",get:function(){return e._vertexDeclaration2}}]),e}();uh.TRAIL_POSITION0=0,uh.TRAIL_OFFSETVECTOR=1,uh.TRAIL_TIME0=2,uh.TRAIL_TEXTURECOORDINATE0Y=3,uh.TRAIL_TEXTURECOORDINATE0X=4,uh.TRAIL_COLOR=5;var dh=function(){T(v,Ia);var a=b(v);function v(e){var t;S(this,v),(t=a.call(this))._floatCountPerVertices1=8,t._floatCountPerVertices2=5,t._increaseSegementCount=16,t._activeIndex=0,t._endIndex=0,t._needAddFirstVertex=!1,t._isTempEndVertex=!1,t._vertices1=null,t._vertices2=null,t._lastFixedVertexPosition=new vn,t._bufferState=new Ga,t.tmpColor=new Ta,t._disappearBoundsMode=!1,t._owner=e,t._segementCount=t._increaseSegementCount,t._resizeData(t._segementCount,t._bufferState);var n=t._owner._owner.trailRenderer.bounds,i=n.getMin(),e=n.getMax();return i.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n.setMin(i),n.setMax(e),yt.supportWebGLPlusCulling&&t._calculateBoundingBoxForNative(),t}return C(v,[{key:"_resizeData",value:function(e,t){this._subBirthTime=new Float32Array(e),this._subDistance=new Float64Array(e);var n=P.instance,i=2*e,a=uh.vertexDeclaration1,r=uh.vertexDeclaration2,o=[],s=i*a.vertexStride,l=i*r.vertexStride,e=s+l;this._vertices1=new Float32Array(i*this._floatCountPerVertices1),this._vertices2=new Float32Array(i*this._floatCountPerVertices2),this._vertexBuffer1=new Na(s,n.STATIC_DRAW,!1),this._vertexBuffer1.vertexDeclaration=a,this._vertexBuffer2=new Na(l,n.DYNAMIC_DRAW,!1),this._vertexBuffer2.vertexDeclaration=r,o.push(this._vertexBuffer1),o.push(this._vertexBuffer2),t.bind(),t.applyVertexBuffers(o),t.unBind(),V._addMemory(e,e)}},{key:"_resetData",value:function(){var e=this._endIndex-this._activeIndex,t=new Float32Array(this._vertices1.buffer,2*this._floatCountPerVertices1*this._activeIndex*4,2*this._floatCountPerVertices1*e),n=new Float32Array(this._vertices2.buffer,2*this._floatCountPerVertices2*this._activeIndex*4,2*this._floatCountPerVertices2*e),i=new Float64Array(this._subDistance.buffer,8*this._activeIndex,e),a=new Float32Array(this._subBirthTime.buffer,4*this._activeIndex,e);e===this._segementCount&&(this._vertexBuffer1.destroy(),this._vertexBuffer2.destroy(),this._segementCount+=this._increaseSegementCount,this._resizeData(this._segementCount,this._bufferState)),this._vertices1.set(t,0),this._vertices2.set(n,0),this._subDistance.set(i,0),this._subBirthTime.set(a,0),this._endIndex=e,this._activeIndex=0,this._vertexBuffer1.setData(this._vertices1.buffer,0,2*this._floatCountPerVertices1*this._activeIndex*4,2*this._floatCountPerVertices1*e*4),this._vertexBuffer2.setData(this._vertices2.buffer,0,2*this._floatCountPerVertices2*this._activeIndex*4,2*this._floatCountPerVertices2*e*4)}},{key:"_updateTrail",value:function(e,t,n){vn.equals(t,n)||(this._endIndex-this._activeIndex==0?this._addTrailByFirstPosition(e,n):this._addTrailByNextPosition(e,n))}},{key:"_addTrailByFirstPosition",value:function(e,t){this._endIndex===this._segementCount&&this._resetData(),this._subDistance[this._endIndex]=0,this._subBirthTime[this._endIndex]=this._owner._curtime,this._endIndex++,t.cloneTo(this._lastFixedVertexPosition),this._needAddFirstVertex=!0}},{key:"_addTrailByNextPosition",value:function(e,t){var n=v._tempVector30,i=v._tempVector31;switch(this._owner.alignment){case eh.View:var a=e.viewMatrix;vn.transformCoordinate(t,a,v._tempVector33),vn.transformCoordinate(this._lastFixedVertexPosition,a,v._tempVector34),vn.subtract(v._tempVector33,v._tempVector34,n),vn.cross(v._tempVector33,n,i);break;case eh.TransformZ:vn.subtract(t,this._lastFixedVertexPosition,n);a=v._tempVector32;this._owner._owner.transform.localMatrix.getForward(a),vn.cross(n,a,i)}vn.normalize(i,i),vn.scale(i,this._owner.widthMultiplier/2,i);var r,o,s=vn.scalarLength(n);this._needAddFirstVertex&&(this._updateVerticesByPositionData(t,i,this._endIndex-1),this._needAddFirstVertex=!1),s-this._owner.minVertexDistance>=fn.zeroTolerance?(this._isTempEndVertex?(r=this._endIndex-1,o=s-this._subDistance[r],this._updateVerticesByPosition(t,i,s,r),this._owner._totalLength+=o):(this._endIndex===this._segementCount&&this._resetData(),this._updateVerticesByPosition(t,i,s,this._endIndex),this._owner._totalLength+=s,this._endIndex++),t.cloneTo(this._lastFixedVertexPosition),this._isTempEndVertex=!1):(this._isTempEndVertex?(r=this._endIndex-1,o=s-this._subDistance[r],this._updateVerticesByPosition(t,i,s,r),this._owner._totalLength+=o):(this._endIndex===this._segementCount&&this._resetData(),this._updateVerticesByPosition(t,i,s,this._endIndex),this._owner._totalLength+=s,this._endIndex++),this._isTempEndVertex=!0)}},{key:"_updateVerticesByPositionData",value:function(e,t,n){var i=2*this._floatCountPerVertices1*n,a=this._owner._curtime;this._vertices1[i]=e.x,this._vertices1[1+i]=e.y,this._vertices1[2+i]=e.z,this._vertices1[3+i]=-t.x,this._vertices1[4+i]=-t.y,this._vertices1[5+i]=-t.z,this._vertices1[6+i]=a,this._vertices1[7+i]=1,this._vertices1[8+i]=e.x,this._vertices1[9+i]=e.y,this._vertices1[10+i]=e.z,this._vertices1[11+i]=t.x,this._vertices1[12+i]=t.y,this._vertices1[13+i]=t.z,this._vertices1[14+i]=a,this._vertices1[15+i]=0;var r=this._owner._owner.trailRenderer.bounds,o=r.getMin(),s=r.getMax(),l=v._tempVector35,n=v._tempVector36,a=v._tempVector32;vn.add(e,t,l),vn.subtract(e,t,n),vn.min(n,l,a),vn.min(o,a,o),r.setMin(o),vn.max(l,n,a),vn.max(s,a,s),r.setMax(s),yt.supportWebGLPlusCulling&&this._calculateBoundingBoxForNative();s=2*this._floatCountPerVertices1;this._vertexBuffer1.setData(this._vertices1.buffer,4*i,4*i,4*s)}},{key:"_updateVerticesByPosition",value:function(e,t,n,i){this._updateVerticesByPositionData(e,t,i),this._subDistance[i]=n,this._subBirthTime[i]=this._owner._curtime}},{key:"_updateVertexBufferUV",value:function(){var e,t;this._disappearBoundsMode&&(e=(y=this._owner._owner.trailRenderer.bounds).getMin(),t=y.getMax(),e.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),yt.supportWebGLPlusCulling&&this._calculateBoundingBoxForNative());for(var n,i,a=this._endIndex,r=0,o=this._owner.colorGradient,s=o.colorAlphaKeysCount-1,l=o.colorRGBKeysCount-1,h=this._owner._totalLength,u=2*this._floatCountPerVertices2,d=this._activeIndex;d<a;d++){d!==this._activeIndex&&(r+=this._subDistance[d]),this._owner.textureMode==hh.Stretch?i=n=1-r/h:(i=1-r/h,n=1-(h-r)),l=o.evaluateColorRGB(i,this.tmpColor,l,!0),s=o.evaluateColorAlpha(i,this.tmpColor,s,!0);var c,_,f,g=d*u;this._vertices2[0+g]=n,this._vertices2[1+g]=this.tmpColor.r,this._vertices2[2+g]=this.tmpColor.g,this._vertices2[3+g]=this.tmpColor.b,this._vertices2[4+g]=this.tmpColor.a,this._vertices2[5+g]=n,this._vertices2[6+g]=this.tmpColor.r,this._vertices2[7+g]=this.tmpColor.g,this._vertices2[8+g]=this.tmpColor.b,this._vertices2[9+g]=this.tmpColor.a,this._disappearBoundsMode&&(c=2*this._floatCountPerVertices1*d,_=v._tempVector33,f=v._tempVector34,(g=v._tempVector32).setValue(this._vertices1[0+c],this._vertices1[1+c],this._vertices1[2+c]),_.setValue(this._vertices1[3+c],this._vertices1[4+c],this._vertices1[5+c]),vn.add(g,_,f),vn.min(f,e,e),vn.max(f,t,t),vn.subtract(g,_,f),vn.min(f,e,e),vn.max(f,t,t))}this._disappearBoundsMode&&(y.setMin(e),y.setMax(t),this._disappearBoundsMode=!1,yt.supportWebGLPlusCulling&&this._calculateBoundingBoxForNative());var y=this._activeIndex*u;this._vertexBuffer2.setData(this._vertices2.buffer,4*y,4*y,4*(a*u-y))}},{key:"_updateDisappear",value:function(){for(var e=this._endIndex,t=this._activeIndex;t<e&&this._owner._curtime-this._subBirthTime[t]>=this._owner.time+fn.zeroTolerance;t++){var n=t+1;n!==e&&(this._owner._totalLength-=this._subDistance[n]),this._isTempEndVertex&&n===e-1&&(this._floatCountPerVertices1,(n=this._lastFixedVertexPosition).x=this._vertices1[0],n.y=this._vertices1[1],n.z=this._vertices1[2],this._isTempEndVertex=!1),this._activeIndex++,this._disappearBoundsMode=!0}}},{key:"_getType",value:function(){return v._type}},{key:"_prepareRender",value:function(e){return 1<this._endIndex-this._activeIndex}},{key:"_render",value:function(e){this._bufferState.bind();var t=P.instance,n=2*this._activeIndex,i=2*this._endIndex-n;t.drawArrays(t.TRIANGLE_STRIP,n,i),J.renderBatches++,J.trianglesFaces+=i-2}},{key:"destroy",value:function(){G(z(v.prototype),"destroy",this).call(this);var e=this._vertexBuffer1._byteLength+this._vertexBuffer2._byteLength;V._addMemory(-e,-e),this._bufferState.destroy(),this._vertexBuffer1.destroy(),this._vertexBuffer2.destroy(),this._bufferState=null,this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._subBirthTime=null,this._subDistance=null,this._lastFixedVertexPosition=null,this._disappearBoundsMode=!1}},{key:"_calculateBoundingBoxForNative",value:function(){var e=this._owner._owner.trailRenderer,t=e.bounds,n=t.getMin(),i=t.getMax(),t=ba._cullingBuffer;t[e._cullingBufferIndex+1]=n.x,t[e._cullingBufferIndex+2]=n.y,t[e._cullingBufferIndex+3]=n.z,t[e._cullingBufferIndex+4]=i.x,t[e._cullingBufferIndex+5]=i.y,t[e._cullingBufferIndex+6]=i.z}}]),v}();dh.ALIGNMENT_VIEW=0,dh.ALIGNMENT_TRANSFORM_Z=1,dh._tempVector30=new vn,dh._tempVector31=new vn,dh._tempVector32=new vn,dh._tempVector33=new vn,dh._tempVector34=new vn,dh._tempVector35=new vn,dh._tempVector36=new vn,dh._type=Ia._typeCounter++;var ch=function(){function r(e){S(this,r),this._totalLength=0,this._lastPosition=new vn,this._curtime=0,this.alignment=r.ALIGNMENT_VIEW,this._owner=e,this._initDefaultData(),this.addRenderElement()}return C(r,[{key:"addRenderElement",value:function(){var e=this._owner._render,t=e._renderElements,n=(n=e.sharedMaterials[0])||lh.defaultMaterial,i=new ar;i.setTransform(this._owner._transform),i.render=e,i.material=n,this._trialGeometry=new dh(this),i.setGeometry(this._trialGeometry),t.push(i)}},{key:"_update",value:function(e){var t=this._owner._render;this._curtime+=e.scene.timer._delta/1e3,t._shaderValues.setNumber(r.CURTIME,this._curtime);var n=this._owner.transform.position,t=t._renderElements[0]._geometry;t._updateDisappear(),t._updateTrail(e.camera,this._lastPosition,n),t._updateVertexBufferUV(),n.cloneTo(this._lastPosition)}},{key:"_initDefaultData",value:function(){this.time=5,this.minVertexDistance=.1,this.widthMultiplier=1,this.textureMode=hh.Stretch;var e=[],t=new il;t.time=0,t.inTangent=0,t.outTangent=0,t.value=1,e.push(t);t=new il;t.time=1,t.inTangent=0,t.outTangent=0,t.value=1,e.push(t),this.widthCurve=e;e=new Sl(2,2);e.mode=bl.Blend,e.addColorRGB(0,Ta.WHITE),e.addColorRGB(1,Ta.WHITE),e.addColorAlpha(0,1),e.addColorAlpha(1,1),this.colorGradient=e}},{key:"destroy",value:function(){this._trialGeometry.destroy(),this._trialGeometry=null,this._widthCurve=null,this._colorGradient=null}},{key:"time",get:function(){return this._time},set:function(e){this._time=e,this._owner._render._shaderValues.setNumber(r.LIFETIME,e)}},{key:"minVertexDistance",get:function(){return this._minVertexDistance},set:function(e){this._minVertexDistance=e}},{key:"widthMultiplier",get:function(){return this._widthMultiplier},set:function(e){this._widthMultiplier=e}},{key:"widthCurve",get:function(){return this._widthCurve},set:function(e){this._widthCurve=e;for(var t=new Float32Array(4*e.length),n=0,i=0,a=e.length;i<a;i++)t[n++]=e[i].time,t[n++]=e[i].inTangent,t[n++]=e[i].outTangent,t[n++]=e[i].value;this._owner._render._shaderValues.setBuffer(r.WIDTHCURVE,t),this._owner._render._shaderValues.setInt(r.WIDTHCURVEKEYLENGTH,e.length)}},{key:"colorGradient",get:function(){return this._colorGradient},set:function(e){this._colorGradient=e}},{key:"textureMode",get:function(){return this._textureMode},set:function(e){this._textureMode=e}}]),r}();ch.CURTIME=ca.propertyNameToID("u_CurTime"),ch.LIFETIME=ca.propertyNameToID("u_LifeTime"),ch.WIDTHCURVE=ca.propertyNameToID("u_WidthCurve"),ch.WIDTHCURVEKEYLENGTH=ca.propertyNameToID("u_WidthCurveKeyLength"),ch.ALIGNMENT_VIEW=0,ch.ALIGNMENT_TRANSFORM_Z=1;var _h=function(){T(n,fr);var t=b(n);function n(e){return S(this,n),(e=t.call(this,e))._projectionViewWorldMatrix=new ki,e}return C(n,[{key:"_calculateBoundingBox",value:function(){}},{key:"_needRender",value:function(e,t){return this._owner.trailFilter._update(t),!e||e.intersects(this.bounds._getBoundBox())}},{key:"_updateForNative",value:function(e){this._owner.trailFilter._update(e)}},{key:"_renderUpdate",value:function(e,t){G(z(n.prototype),"_renderUpdate",this).call(this,e,t)}},{key:"_renderUpdateWithCamera",value:function(e,t){e=e.projectionViewMatrix;t?(ki.multiply(e,t.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(fa.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(fa.MVPMATRIX,e)}}]),n}(),fh=function(){T(y,ga);var t=b(y);function y(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return S(this,y),(e=t.call(this,e))._render=new _h(u(e)),e._geometryFilter=new ch(u(e)),e}return C(y,[{key:"_parse",value:function(e,t){G(z(y.prototype),"_parse",this).call(this,e,t);var n=this._render,t=this._geometryFilter,i=e.materials;if(i){var a=n.sharedMaterials,r=i.length;for(a.length=r,l=0;l<r;l++)a[l]=on.getRes(i[l].path);n.sharedMaterials=a}t.time=e.time,t.minVertexDistance=e.minVertexDistance,t.widthMultiplier=e.widthMultiplier,t.textureMode=e.textureMode,null!=e.alignment&&(t.alignment=e.alignment);for(var o=[],s=e.widthCurve,l=0,h=s.length;l<h;l++){var u=new il;u.time=s[l].time,u.inTangent=s[l].inTangent,u.outTangent=s[l].outTangent,u.value=s[l].value,o.push(u)}t.widthCurve=o;var e=e.colorGradient,d=e.colorKeys,c=e.alphaKeys,_=new Sl(d.length,c.length);for(_.mode=e.mode,l=0,h=d.length;l<h;l++){var f=d[l];_.addColorRGB(f.time,new Ta(f.value[0],f.value[1],f.value[2],1))}for(l=0,h=c.length;l<h;l++){var g=c[l];_.addColorAlpha(g.time,g.value)}t.colorGradient=_}},{key:"_onActive",value:function(){G(z(y.prototype),"_onActive",this).call(this),this._transform.position.cloneTo(this._geometryFilter._lastPosition)}},{key:"_cloneTo",value:function(e,t,n){G(z(y.prototype),"_cloneTo",this).call(this,e,t,n);t=e,n=t.trailFilter;n.time=this.trailFilter.time,n.minVertexDistance=this.trailFilter.minVertexDistance,n.widthMultiplier=this.trailFilter.widthMultiplier,n.textureMode=this.trailFilter.textureMode;for(var i=this.trailFilter.widthCurve,a=[],r=0,o=i.length;r<o;r++){var s=new il;i[r].cloneTo(s),a.push(s)}n.widthCurve=a;e=new Sl(this.trailFilter.colorGradient.maxColorRGBKeysCount,this.trailFilter.colorGradient.maxColorAlphaKeysCount);this.trailFilter.colorGradient.cloneTo(e),n.colorGradient=e,t.trailRenderer.sharedMaterial=this.trailRenderer.sharedMaterial}},{key:"destroy",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.destroyed||(G(z(y.prototype),"destroy",this).call(this,e),this._geometryFilter.destroy(),this._geometryFilter=null)}},{key:"_create",value:function(){return new y}},{key:"trailFilter",get:function(){return this._geometryFilter}},{key:"trailRenderer",get:function(){return this._render}}],[{key:"__init__",value:function(){}}]),y}(),gh=function(){function a(e,t,n,i){S(this,a),this._position=e,this._normal=t,this._textureCoord0=n,this._textureCoord1=i}return C(a,[{key:"position",get:function(){return this._position}},{key:"normal",get:function(){return this._normal}},{key:"textureCoord0",get:function(){return this._textureCoord0}},{key:"textureCoord1",get:function(){return this._textureCoord1}},{key:"vertexDeclaration",get:function(){return a._vertexDeclaration}}],[{key:"__init__",value:function(){a._vertexDeclaration=new pa(40,[new ma(0,ya.Vector3,a.TERRAIN_POSITION0),new ma(12,ya.Vector3,a.TERRAIN_NORMAL0),new ma(24,ya.Vector2,a.TERRAIN_TEXTURECOORDINATE0),new ma(32,ya.Vector2,a.TERRAIN_TEXTURECOORDINATE1)])}},{key:"vertexDeclaration",get:function(){return a._vertexDeclaration}}]),a}();gh.TERRAIN_POSITION0=0,gh.TERRAIN_NORMAL0=1,gh.TERRAIN_TEXTURECOORDINATE0=2,gh.TERRAIN_TEXTURECOORDINATE1=3;var yh=function(){T(r,Vr);var a=b(r);function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Mr.COLLISIONFILTERGROUP_DEFAULTFILTER,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Mr.COLLISIONFILTERGROUP_ALLFILTER;return S(this,r),(i=a.call(this,n,i))._upAxis=new vn(0,1,0),i._maxSlope=45,i._jumpSpeed=10,i._fallSpeed=55,i._gravity=new vn(0,3*-9.8,0),i._nativeKinematicCharacter=null,i._stepHeight=e,t&&(i._upAxis=t),i}return C(r,[{key:"_constructCharacter",value:function(){var e=Rr._physics3D;this._nativeKinematicCharacter&&e.destroy(this._nativeKinematicCharacter);var t=r._nativeTempVector30;t.setValue(this._upAxis.x,this._upAxis.y,this._upAxis.z),this._nativeKinematicCharacter=new e.btKinematicCharacterController(this._nativeColliderObject,this._colliderShape._nativeShape,this._stepHeight,t),this.fallSpeed=this._fallSpeed,this.maxSlope=this._maxSlope,this.jumpSpeed=this._jumpSpeed,this.gravity=this._gravity}},{key:"_onShapeChange",value:function(e){G(z(r.prototype),"_onShapeChange",this).call(this,e),this._constructCharacter()}},{key:"_onAdded",value:function(){var e=new Rr._physics3D.btPairCachingGhostObject;e.setUserIndex(this.id),e.setCollisionFlags(Vr.COLLISIONFLAGS_CHARACTER_OBJECT),this._nativeColliderObject=e,this._colliderShape&&this._constructCharacter(),G(z(r.prototype),"_onAdded",this).call(this)}},{key:"_addToSimulation",value:function(){this._simulation._characters.push(this),this._simulation._addCharacter(this,this._collisionGroup,this._canCollideWith)}},{key:"_removeFromSimulation",value:function(){this._simulation._removeCharacter(this);var e=this._simulation._characters;e.splice(e.indexOf(this),1)}},{key:"_cloneTo",value:function(e){G(z(r.prototype),"_cloneTo",this).call(this,e);e.stepHeight=this._stepHeight,e.upAxis=this._upAxis,e.maxSlope=this._maxSlope,e.jumpSpeed=this._jumpSpeed,e.fallSpeed=this._fallSpeed,e.gravity=this._gravity}},{key:"_onDestroy",value:function(){Rr._physics3D.destroy(this._nativeKinematicCharacter),G(z(r.prototype),"_onDestroy",this).call(this),this._nativeKinematicCharacter=null}},{key:"move",value:function(e){var t=r._nativeVector30;t.setValue(-e.x,e.y,e.z),this._nativeKinematicCharacter.setWalkDirection(t)}},{key:"jump",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;t?(e=r._nativeVector30,ia._convertToBulletVec3(t,e,!0),this._nativeKinematicCharacter.jump(e)):this._nativeKinematicCharacter.jump()}},{key:"fallSpeed",get:function(){return this._fallSpeed},set:function(e){this._fallSpeed=e,this._nativeKinematicCharacter.setFallSpeed(e)}},{key:"jumpSpeed",get:function(){return this._jumpSpeed},set:function(e){this._jumpSpeed=e,this._nativeKinematicCharacter.setJumpSpeed(e)}},{key:"gravity",get:function(){return this._gravity},set:function(e){this._gravity=e;var t=r._nativeTempVector30;t.setValue(-e.x,e.y,e.z),this._nativeKinematicCharacter.setGravity(t)}},{key:"maxSlope",get:function(){return this._maxSlope},set:function(e){this._maxSlope=e,this._nativeKinematicCharacter.setMaxSlope(e/180*Math.PI)}},{key:"isGrounded",get:function(){return this._nativeKinematicCharacter.onGround()}},{key:"stepHeight",get:function(){return this._stepHeight},set:function(e){this._stepHeight=e,this._constructCharacter()}},{key:"upAxis",get:function(){return this._upAxis},set:function(e){this._upAxis=e,this._constructCharacter()}}],[{key:"__init__",value:function(){r._nativeTempVector30=new Rr._physics3D.btVector3(0,0,0)}}]),r}();yh.UPAXIS_X=0,yh.UPAXIS_Y=1,yh.UPAXIS_Z=2;var vh=function(){T(i,Vr);var n=b(i);function i(e,t){return S(this,i),(t=n.call(this,e,t))._isTrigger=!1,t}return C(i,[{key:"_onAdded",value:function(){G(z(i.prototype),"_onAdded",this).call(this),this.isTrigger=this._isTrigger}},{key:"_cloneTo",value:function(e){G(z(i.prototype),"_cloneTo",this).call(this,e),e.isTrigger=this._isTrigger}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(e){var t;this._isTrigger=e,this._nativeColliderObject&&(t=this._nativeColliderObject.getCollisionFlags(),e?0==(t&Vr.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&this._nativeColliderObject.setCollisionFlags(t|Vr.COLLISIONFLAGS_NO_CONTACT_RESPONSE):0!=(t&Vr.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&this._nativeColliderObject.setCollisionFlags(t^Vr.COLLISIONFLAGS_NO_CONTACT_RESPONSE))}}]),i}(),ph=function(){T(i,vh);var n=b(i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Mr.COLLISIONFILTERGROUP_DEFAULTFILTER,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Mr.COLLISIONFILTERGROUP_ALLFILTER;return S(this,i),(t=n.call(this,e,t))._enableProcessCollisions=!1,t}return C(i,[{key:"_addToSimulation",value:function(){this._simulation._addPhysicsCollider(this,this._collisionGroup,this._canCollideWith)}},{key:"_removeFromSimulation",value:function(){this._simulation._removePhysicsCollider(this)}},{key:"_onTransformChanged",value:function(e){(e&=_a.TRANSFORM_WORLDPOSITION|_a.TRANSFORM_WORLDQUATERNION|_a.TRANSFORM_WORLDSCALE)&&(this._transformFlag|=e,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))}},{key:"_parse",value:function(e){null!=e.friction&&(this.friction=e.friction),null!=e.rollingFriction&&(this.rollingFriction=e.rollingFriction),null!=e.restitution&&(this.restitution=e.restitution),null!=e.isTrigger&&(this.isTrigger=e.isTrigger),G(z(i.prototype),"_parse",this).call(this,e),this._parseShape(e.shapes)}},{key:"_onAdded",value:function(){var e=new Rr._physics3D.btCollisionObject;e.setUserIndex(this.id),e.forceActivationState(Vr.ACTIVATIONSTATE_DISABLE_SIMULATION);var t=e.getCollisionFlags();this.owner.isStatic?(0<(t&Vr.COLLISIONFLAGS_KINEMATIC_OBJECT)&&(t^=Vr.COLLISIONFLAGS_KINEMATIC_OBJECT),t|=Vr.COLLISIONFLAGS_STATIC_OBJECT):(0<(t&Vr.COLLISIONFLAGS_STATIC_OBJECT)&&(t^=Vr.COLLISIONFLAGS_STATIC_OBJECT),t|=Vr.COLLISIONFLAGS_KINEMATIC_OBJECT),e.setCollisionFlags(t),this._nativeColliderObject=e,G(z(i.prototype),"_onAdded",this).call(this)}}]),i}(),mh=function(){T(a,vh);var n=b(a);function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Mr.COLLISIONFILTERGROUP_DEFAULTFILTER,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Mr.COLLISIONFILTERGROUP_ALLFILTER;return S(this,a),(t=n.call(this,e,t))._isKinematic=!1,t._mass=1,t._gravity=new vn(0,-10,0),t._angularDamping=0,t._linearDamping=0,t._overrideGravity=!1,t._totalTorque=new vn(0,0,0),t._totalForce=new vn(0,0,0),t._linearVelocity=new vn,t._angularVelocity=new vn,t._linearFactor=new vn(1,1,1),t._angularFactor=new vn(1,1,1),t._detectCollisions=!0,t}return C(a,[{key:"_updateMass",value:function(e){this._nativeColliderObject&&this._colliderShape&&(this._colliderShape._nativeShape.calculateLocalInertia(e,a._nativeInertia),this._nativeColliderObject.setMassProps(e,a._nativeInertia),this._nativeColliderObject.updateInertiaTensor())}},{key:"_delegateMotionStateGetWorldTransform",value:function(e){}},{key:"_delegateMotionStateSetWorldTransform",value:function(e){var t=this._rigidbody;t._simulation._updatedRigidbodies++;var n=Rr._physics3D,n=n.wrapPointer(e,n.btTransform);t._updateTransformComponent(n)}},{key:"_delegateMotionStateGetWorldTransformNative",value:function(e,t){}},{key:"_delegateMotionStateSetWorldTransformNative",value:function(e,t){var n=e;n._simulation._updatedRigidbodies++;e=Rr._physics3D,e=e.wrapPointer(t,e.btTransform);n._updateTransformComponent(e)}},{key:"_onScaleChange",value:function(e){G(z(a.prototype),"_onScaleChange",this).call(this,e),this._updateMass(this._isKinematic?0:this._mass)}},{key:"_delegateMotionStateClear",value:function(){this._rigidbody=null}},{key:"_onAdded",value:function(){var e=Rr._physics3D,t=new e.LayaMotionState;null!=window.conch&&e.LayaMotionState.prototype.setRigidbody?(t.setRigidbody(this),t.setNativeGetWorldTransform(this._delegateMotionStateGetWorldTransformNative),t.setNativeSetWorldTransform(this._delegateMotionStateSetWorldTransformNative)):(t.getWorldTransform=this._delegateMotionStateGetWorldTransform,t.setWorldTransform=this._delegateMotionStateSetWorldTransform),t.clear=this._delegateMotionStateClear,(t._rigidbody=this)._nativeMotionState=t;var n=new e.btRigidBodyConstructionInfo(0,t,null,a._nativeVector3Zero),t=new e.btRigidBody(n);t.setUserIndex(this.id),this._nativeColliderObject=t,G(z(a.prototype),"_onAdded",this).call(this),this.mass=this._mass,this.linearFactor=this._linearFactor,this.angularFactor=this._angularFactor,this.linearDamping=this._linearDamping,this.angularDamping=this._angularDamping,this.overrideGravity=this._overrideGravity,this.gravity=this._gravity,this.isKinematic=this._isKinematic,e.destroy(n)}},{key:"_onShapeChange",value:function(e){G(z(a.prototype),"_onShapeChange",this).call(this,e),this._isKinematic?this._updateMass(0):(this._nativeColliderObject.setCenterOfMassTransform(this._nativeColliderObject.getWorldTransform()),this._updateMass(this._mass))}},{key:"_parse",value:function(e){null!=e.friction&&(this.friction=e.friction),null!=e.rollingFriction&&(this.rollingFriction=e.rollingFriction),null!=e.restitution&&(this.restitution=e.restitution),null!=e.isTrigger&&(this.isTrigger=e.isTrigger),null!=e.mass&&(this.mass=e.mass),null!=e.isKinematic&&(this.isKinematic=e.isKinematic),null!=e.linearDamping&&(this.linearDamping=e.linearDamping),null!=e.angularDamping&&(this.angularDamping=e.angularDamping),null!=e.overrideGravity&&(this.overrideGravity=e.overrideGravity),e.gravity&&(this.gravity.fromArray(e.gravity),this.gravity=this.gravity),G(z(a.prototype),"_parse",this).call(this,e),this._parseShape(e.shapes)}},{key:"_onDestroy",value:function(){var e=Rr._physics3D;this._nativeMotionState.clear(),e.destroy(this._nativeMotionState),G(z(a.prototype),"_onDestroy",this).call(this),this._nativeMotionState=null,this._gravity=null,this._totalTorque=null,this._linearVelocity=null,this._angularVelocity=null,this._linearFactor=null,this._angularFactor=null}},{key:"_addToSimulation",value:function(){this._simulation._addRigidBody(this,this._collisionGroup,this._detectCollisions?this._canCollideWith:0)}},{key:"_removeFromSimulation",value:function(){this._simulation._removeRigidBody(this)}},{key:"_cloneTo",value:function(e){G(z(a.prototype),"_cloneTo",this).call(this,e);e.isKinematic=this._isKinematic,e.mass=this._mass,e.gravity=this._gravity,e.angularDamping=this._angularDamping,e.linearDamping=this._linearDamping,e.overrideGravity=this._overrideGravity,e.linearVelocity=this._linearVelocity,e.angularVelocity=this._angularVelocity,e.linearFactor=this._linearFactor,e.angularFactor=this._angularFactor,e.detectCollisions=this._detectCollisions}},{key:"applyForce",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null==this._nativeColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var n=a._nativeTempVector30;n.setValue(-e.x,e.y,e.z),t?((e=a._nativeTempVector31).setValue(-t.x,t.y,t.z),this._nativeColliderObject.applyForce(n,e)):this._nativeColliderObject.applyCentralForce(n)}},{key:"applyTorque",value:function(e){if(null==this._nativeColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var t=a._nativeTempVector30;t.setValue(-e.x,e.y,e.z),this._nativeColliderObject.applyTorque(t)}},{key:"applyImpulse",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null==this._nativeColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";a._nativeImpulse.setValue(-e.x,e.y,e.z),t?(a._nativeImpulseOffset.setValue(-t.x,t.y,t.z),this._nativeColliderObject.applyImpulse(a._nativeImpulse,a._nativeImpulseOffset)):this._nativeColliderObject.applyCentralImpulse(a._nativeImpulse)}},{key:"applyTorqueImpulse",value:function(e){if(null==this._nativeColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var t=a._nativeTempVector30;t.setValue(-e.x,e.y,e.z),this._nativeColliderObject.applyTorqueImpulse(t)}},{key:"wakeUp",value:function(){this._nativeColliderObject&&this._nativeColliderObject.activate(!1)}},{key:"clearForces",value:function(){var e=this._nativeColliderObject;if(null==e)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";e.clearForces();var t=a._nativeVector3Zero;e.setInterpolationLinearVelocity(t),e.setLinearVelocity(t),e.setInterpolationAngularVelocity(t),e.setAngularVelocity(t)}},{key:"mass",get:function(){return this._mass},set:function(e){e=Math.max(e,1e-7),this._mass=e,this._isKinematic||this._updateMass(e)}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(e){this._isKinematic=e;var t=!!(this._simulation&&this._enabled&&this._colliderShape);t&&this._removeFromSimulation();var n=this._nativeColliderObject,i=n.getCollisionFlags();e?(i|=Vr.COLLISIONFLAGS_KINEMATIC_OBJECT,n.setCollisionFlags(i),this._nativeColliderObject.forceActivationState(Vr.ACTIVATIONSTATE_DISABLE_DEACTIVATION),this._enableProcessCollisions=!1,this._updateMass(0)):(0<(i&Vr.COLLISIONFLAGS_KINEMATIC_OBJECT)&&(i^=Vr.COLLISIONFLAGS_KINEMATIC_OBJECT),n.setCollisionFlags(i),this._nativeColliderObject.setActivationState(Vr.ACTIVATIONSTATE_ACTIVE_TAG),this._enableProcessCollisions=!0,this._updateMass(this._mass));i=a._nativeVector3Zero;n.setInterpolationLinearVelocity(i),n.setLinearVelocity(i),n.setInterpolationAngularVelocity(i),n.setAngularVelocity(i),t&&this._addToSimulation()}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(e){this._linearDamping=e,this._nativeColliderObject&&this._nativeColliderObject.setDamping(e,this._angularDamping)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(e){this._angularDamping=e,this._nativeColliderObject&&this._nativeColliderObject.setDamping(this._linearDamping,e)}},{key:"overrideGravity",get:function(){return this._overrideGravity},set:function(e){var t;this._overrideGravity=e,this._nativeColliderObject&&(t=this._nativeColliderObject.getFlags(),e?0==(t&a._BT_DISABLE_WORLD_GRAVITY)&&this._nativeColliderObject.setFlags(t|a._BT_DISABLE_WORLD_GRAVITY):0<(t&a._BT_DISABLE_WORLD_GRAVITY)&&this._nativeColliderObject.setFlags(t^a._BT_DISABLE_WORLD_GRAVITY))}},{key:"gravity",get:function(){return this._gravity},set:function(e){this._gravity=e,a._nativeGravity.setValue(-e.x,e.y,e.z),this._nativeColliderObject.setGravity(a._nativeGravity)}},{key:"totalForce",get:function(){if(this._nativeColliderObject){var e=this._nativeColliderObject.getTotalForce();return ia._convertToLayaVec3(e,this._totalForce,!0),this._totalForce}return null}},{key:"linearFactor",get:function(){return this._nativeColliderObject?this._linearFactor:null},set:function(e){var t;this._linearFactor=e,this._nativeColliderObject&&(t=a._nativeTempVector30,ia._convertToBulletVec3(e,t,!1),this._nativeColliderObject.setLinearFactor(t))}},{key:"linearVelocity",get:function(){return this._nativeColliderObject&&ia._convertToLayaVec3(this._nativeColliderObject.getLinearVelocity(),this._linearVelocity,!0),this._linearVelocity},set:function(e){var t;this._linearVelocity=e,this._nativeColliderObject&&(t=a._nativeTempVector30,ia._convertToBulletVec3(e,t,!0),this.isSleeping&&this.wakeUp(),this._nativeColliderObject.setLinearVelocity(t))}},{key:"angularFactor",get:function(){return this._nativeColliderObject?this._angularFactor:null},set:function(e){var t;this._angularFactor=e,this._nativeColliderObject&&(t=a._nativeTempVector30,ia._convertToBulletVec3(e,t,!1),this._nativeColliderObject.setAngularFactor(t))}},{key:"angularVelocity",get:function(){return this._nativeColliderObject&&ia._convertToLayaVec3(this._nativeColliderObject.getAngularVelocity(),this._angularVelocity,!0),this._angularVelocity},set:function(e){var t;this._angularVelocity=e,this._nativeColliderObject&&(t=a._nativeTempVector30,ia._convertToBulletVec3(e,t,!0),this.isSleeping&&this.wakeUp(),this._nativeColliderObject.setAngularVelocity(t))}},{key:"totalTorque",get:function(){if(this._nativeColliderObject){var e=this._nativeColliderObject.getTotalTorque();return ia._convertToLayaVec3(e,this._totalTorque,!0),this._totalTorque}return null}},{key:"detectCollisions",get:function(){return this._detectCollisions},set:function(e){this._detectCollisions!==e&&(this._detectCollisions=e,this._colliderShape&&this._enabled&&this._simulation&&(this._simulation._removeRigidBody(this),this._simulation._addRigidBody(this,this._collisionGroup,e?this._canCollideWith:0)))}},{key:"isSleeping",get:function(){return!!this._nativeColliderObject&&this._nativeColliderObject.getActivationState()===Vr.ACTIVATIONSTATE_ISLAND_SLEEPING}},{key:"sleepLinearVelocity",get:function(){return this._nativeColliderObject.getLinearSleepingThreshold()},set:function(e){this._nativeColliderObject.setSleepingThresholds(e,this._nativeColliderObject.getAngularSleepingThreshold())}},{key:"sleepAngularVelocity",get:function(){return this._nativeColliderObject.getAngularSleepingThreshold()},set:function(e){this._nativeColliderObject.setSleepingThresholds(this._nativeColliderObject.getLinearSleepingThreshold(),e)}}],[{key:"__init__",value:function(){a._nativeTempVector30=new Rr._physics3D.btVector3(0,0,0),a._nativeTempVector31=new Rr._physics3D.btVector3(0,0,0),a._nativeVector3Zero=new Rr._physics3D.btVector3(0,0,0),a._nativeInertia=new Rr._physics3D.btVector3(0,0,0),a._nativeImpulse=new Rr._physics3D.btVector3(0,0,0),a._nativeImpulseOffset=new Rr._physics3D.btVector3(0,0,0),a._nativeGravity=new Rr._physics3D.btVector3(0,0,0)}}]),a}();mh.TYPE_STATIC=0,mh.TYPE_DYNAMIC=1,mh.TYPE_KINEMATIC=2,mh._BT_DISABLE_WORLD_GRAVITY=1,mh._BT_ENABLE_GYROPSCOPIC_FORCE=2;var wh=function(){T(a,Cr);var i=b(a);function a(e,t){var n;return S(this,a),(n=i.call(this))._normal=e,n._offset=t,n._type=Cr.SHAPETYPES_STATICPLANE,a._nativeNormal.setValue(-e.x,e.y,e.z),n._nativeShape=new Rr._physics3D.btStaticPlaneShape(a._nativeNormal,t),n}return C(a,[{key:"clone",value:function(){var e=new a(this._normal,this._offset);return this.cloneTo(e),e}}],[{key:"__init__",value:function(){a._nativeNormal=new Rr._physics3D.btVector3(0,0,0)}}]),a}(),xh=function(){T(o,U);var r=b(o);function o(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f.R8G8B8,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];S(this,o),(t=r.call(this,n,i))._glTextureType=P.instance.TEXTURE_CUBE_MAP,t._width=e,t._height=e;i=P.instance;if(t._setWarpMode(i.TEXTURE_WRAP_S,t._wrapModeU),t._setWarpMode(i.TEXTURE_WRAP_T,t._wrapModeV),t._setFilterMode(t._filterMode),t._setAnisotropy(t._anisoLevel),t._mipmap){t._mipmapCount=Math.ceil(Math.log2(e));for(var a=0;a<t._mipmapCount;a++)t._setPixels([],a,Math.max(e>>a,1),Math.max(e>>a,1));t._setGPUMemory(e*e*4*(1+1/3)*6)}else t._mipmapCount=1,t._setGPUMemory(e*e*4*6);return t}return C(o,[{key:"_setPixels",value:function(e,t,n,i){var a=P.instance,r=this._getGLFormat();y.bindTexture(a,this._glTextureType,this._glTexture),this.format===f.R8G8B8?(a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[0]),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[1]),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[2]),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[3]),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[4]),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[5]),a.pixelStorei(a.UNPACK_ALIGNMENT,4)):(a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[0]),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[1]),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[2]),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[3]),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[4]),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,t,r,n,i,0,r,a.UNSIGNED_BYTE,e[5]))}},{key:"setSixSideImageSources",value:function(e){for(var t,n,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=0;a<6;a++){var r=e[a];if(!r)return void console.log("TextureCube: image Source can't be null.");var o=r.width,r=r.height;if(0<a&&t!==o)return void console.log("TextureCube: each side image's width and height must same.");if((t=o)!==(n=r))return void console.log("TextureCube: each side image's width and height must same.")}this._width=t,this._height=n;var s=P.instance;y.bindTexture(s,this._glTextureType,this._glTexture);var l=this._getGLFormat();if(yt.isConchApp){if(1==i)for(var h=0;h<6;h++)e[h].setPremultiplyAlpha(i);s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Z,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e[0]),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e[1]),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e[2]),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_X,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e[3]),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Y,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e[4]),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e[5])}else i&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Z,0,l,l,s.UNSIGNED_BYTE,e[0]),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,l,l,s.UNSIGNED_BYTE,e[1]),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X,0,l,l,s.UNSIGNED_BYTE,e[2]),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_X,0,l,l,s.UNSIGNED_BYTE,e[3]),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Y,0,l,l,s.UNSIGNED_BYTE,e[4]),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,l,l,s.UNSIGNED_BYTE,e[5]),i&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);this._mipmap&&this._isPot(t)&&this._isPot(n)?(s.generateMipmap(this._glTextureType),this._setGPUMemory(t*n*4*(1+1/3)*6)):this._setGPUMemory(t*n*4*6),this._setWarpMode(s.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(s.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._readyed=!0,this._activeResource()}},{key:"setSixSidePixels",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!e)throw new Error("TextureCube:pixels can't be null.");var n=Math.max(this._width>>t,1),i=Math.max(this._height>>t,1),a=n*i*this._getFormatByteCount();if(e[0].length<a)throw"TextureCube:pixels length should at least "+a+".";this._setPixels(e,t,n,i),0===t&&(t=P.instance,this._setWarpMode(t.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(t.TEXTURE_WRAP_T,this._wrapModeV)),this._readyed=!0,this._activeResource()}},{key:"_recoverResource",value:function(){}},{key:"defaulteTexture",get:function(){return o.grayTexture}}],[{key:"__init__",value:function(){var e=new Uint8Array(3);e[0]=128,e[1]=128,e[2]=128,(o.grayTexture=new o(1,f.R8G8B8,!1)).setSixSidePixels([e,e,e,e,e,e]),o.grayTexture.lock=!0}},{key:"_parse",value:function(e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,t=t?new o(0,t[0],t[1]):new o(0);return t.setSixSideImageSources(e),t}},{key:"load",value:function(e,t){M.loader.create(e,t,null,o.TEXTURECUBE)}}]),o}();xh.TEXTURECUBE="TEXTURECUBE";var kh='#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}',Th=function(){function e(){S(this,e)}return C(e,null,[{key:"__init__",value:function(){ca.SHADERDEFINE_HIGHPRECISION=ca.getDefineByName("HIGHPRECISION"),ca.SHADERDEFINE_LEGACYSINGALLIGHTING=ca.getDefineByName("LEGACYSINGLELIGHTING"),ca.addInclude("Lighting.glsl","struct DirectionLight {\n\tvec3 color;\n\tvec3 direction;\n};\n\nstruct PointLight {\n\tvec3 color;\n\tvec3 position;\n\tfloat range;\n};\n\nstruct SpotLight {\n\tvec3 color;\n\tvec3 position;\n\tfloat range;\n\tvec3 direction;\n\tfloat spot;\n};\n\n\n\nconst int c_ClusterBufferWidth = CLUSTER_X_COUNT*CLUSTER_Y_COUNT;\nconst int c_ClusterBufferHeight = CLUSTER_Z_COUNT*(1+int(ceil(float(MAX_LIGHT_COUNT_PER_CLUSTER)/4.0)));\nconst int c_ClusterBufferFloatWidth = c_ClusterBufferWidth*4;\n\nivec4 getClusterInfo(sampler2D clusterBuffer,mat4 viewMatrix,vec4 viewport,vec3 position,vec4 fragCoord,vec4 projectParams)\n{\n\tvec3 viewPos = vec3(viewMatrix*vec4(position, 1.0)); //position in viewspace\n\n\tint clusterXIndex = int(floor(fragCoord.x/ (float(viewport.z)/float(CLUSTER_X_COUNT))));\n    int clusterYIndex = int(floor((viewport.w * (projectParams.z <0.0? 0.0 : 1.0) - fragCoord.y * projectParams.z)/ (float(viewport.w)/float(CLUSTER_Y_COUNT))));//Maybe Flipped ProjectMatrix\n\tfloat zSliceParam =float(CLUSTER_Z_COUNT)/log2(projectParams.y / projectParams.x);\n \tint clusterZIndex = int(floor(log2(-viewPos.z) * zSliceParam- log2(projectParams.x) * zSliceParam));//projectParams x:cameraNear y:cameraFar\n\n\tvec2 uv= vec2((float(clusterXIndex + clusterYIndex * CLUSTER_X_COUNT)+0.5)/float(c_ClusterBufferWidth),\n\t\t\t\t(float(clusterZIndex)+0.5)/float(c_ClusterBufferHeight));\n\tvec4 clusterPixel=texture2D(clusterBuffer, uv);\n\treturn ivec4(clusterPixel);//X:Point Count Y:Spot Count Z、W:Light Offset\n}\n\n\nint getLightIndex(sampler2D clusterBuffer,int offset,int index) \n{\n\tint totalOffset=offset+index;\n\tint row=totalOffset/c_ClusterBufferFloatWidth;\n\tint lastRowFloat=totalOffset-row*c_ClusterBufferFloatWidth;\n\tint col=lastRowFloat/4;\n\tvec2 uv=vec2((float(col)+0.5)/float(c_ClusterBufferWidth),\n\t\t\t\t(float(row)+0.5)/float(c_ClusterBufferHeight));\n\tvec4 texel = texture2D(clusterBuffer, uv);\n    int pixelComponent = lastRowFloat-col*4;\n    if (pixelComponent == 0) \n      return int(texel.x);\n    else if (pixelComponent == 1) \n      return int(texel.y);\n    else if (pixelComponent == 2) \n      return int(texel.z);\n    else if (pixelComponent == 3) \n      return int(texel.w);\n}\n\nDirectionLight getDirectionLight(sampler2D lightBuffer,int index) \n{\n    DirectionLight light;\n    float v = (float(index)+0.5)/ float(MAX_LIGHT_COUNT);\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\n\tlight.color=p1.rgb;\n    light.direction = p2.rgb;\n    return light;\n}\n\nPointLight getPointLight(sampler2D lightBuffer,sampler2D clusterBuffer,ivec4 clusterInfo,int index) \n{\n    PointLight light;\n\tint pointIndex=getLightIndex(clusterBuffer,clusterInfo.z*c_ClusterBufferFloatWidth+clusterInfo.w,index);\n    float v = (float(pointIndex)+0.5)/ float(MAX_LIGHT_COUNT);\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\n\tlight.color=p1.rgb;\n\tlight.range = p1.a;\n    light.position = p2.rgb;\n    return light;\n}\n\nSpotLight getSpotLight(sampler2D lightBuffer,sampler2D clusterBuffer,ivec4 clusterInfo,int index) \n{\n    SpotLight light;\n\tint spoIndex=getLightIndex(clusterBuffer,clusterInfo.z*c_ClusterBufferFloatWidth+clusterInfo.w,clusterInfo.x+index);\n    float v = (float(spoIndex)+0.5)/ float(MAX_LIGHT_COUNT);\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\n\tvec4 p3 = texture2D(lightBuffer, vec2(0.625,v));\n    light.color = p1.rgb;\n\tlight.range=p1.a;\n    light.position = p2.rgb;\n\tlight.spot = p2.a;\n\tlight.direction = p3.rgb;\n    return light;\n}\n\n\n\n// Laya中使用衰减纹理\nfloat LayaAttenuation(in vec3 L,in float invLightRadius) {\n\tfloat fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\n\tfRatio *= fRatio;\n\treturn 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\n}\n\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\nfloat BasicAttenuation(in vec3 L,in float invLightRadius) {\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius));\n\treturn attenuation * attenuation;\n}\n\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius) {\n\tfloat attenuationFactor = 30.0;\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\n\tattenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\n\t// Second we move down the function therewith it reaches zero at abscissa 1:\n\tattenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\n\tattenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\n\t// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\n\tattenuation /= 1.0 - attenuationFactor;\n\treturn attenuation;\n}\n\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor) {\n\tmediump vec3 h = normalize(viewDir-lightVec);\n\tlowp float ln = max (0.0, dot (-lightVec,normal));\n\tfloat nh = max (0.0, dot (h,normal));\n\tdiffuseColor=lightColor * ln;\n\tspecularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\n}\n\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec=normalize(light.direction);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,lightVec,diffuseColor,specularColor);\n}\n\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec =  pos-light.position;\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,lightVec/length(lightVec),diffuseColor,specularColor);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec =  pos-light.position;\n\tvec3 normalLightVec=lightVec/length(lightVec);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,normalLightVec,diffuseColor,specularColor);\n\tvec2 cosAngles=cos(vec2(light.spot,light.spot*0.5)*0.5);//ConeAttenuation\n\tfloat dl=dot(normalize(light.direction),normalLightVec);\n\tdl*=smoothstep(cosAngles[0],cosAngles[1],dl);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range)*dl;\n\tdiffuseColor *=attenuate;\n\tspecularColor *=attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal) {\n\tvec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\nvec3 NormalSampleToWorldSpace1(vec4 normalMapSample, vec3 tangent, vec3 binormal, vec3 unitNormal) {\n\tvec3 normalT;\n\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tvec3 N = normalize(unitNormal);\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN * normalize(normalT);\n\n\treturn bumpedNormal;\n}\n\nvec3 DecodeLightmap(vec4 color) {\n\treturn color.rgb*color.a*5.0;\n}\n\nvec2 TransformUV(vec2 texcoord,vec4 tilingOffset) {\n\tvec2 transTexcoord=vec2(texcoord.x,texcoord.y-1.0)*tilingOffset.xy+vec2(tilingOffset.z,-tilingOffset.w);\n\ttransTexcoord.y+=1.0;\n\treturn transTexcoord;\n}\n\nvec4 remapGLPositionZ(vec4 position) {\n\tposition.z=position.z * 2.0 - position.w;\n\treturn position;\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\n"),ca.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),ca.addInclude("BRDF.glsl","struct LayaGI\n{\n\tvec3 diffuse;\n\tvec3 specular;\n};\n\nvec4 LayaAirBRDF(in vec3 diffuseColor, in vec3 specularColor, in float oneMinusReflectivity, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n\tvec3 halfDir = SafeNormalize(viewDir - lightDir);\n\t\n\tfloat nv = abs(dot(normal, viewDir));\n\t\n\tfloat nl = clamp(dot(normal,   -lightDir),  0.0, 1.0);\n\tfloat nh = clamp(dot(normal,     halfDir),  0.0, 1.0);\n\tfloat lv = clamp(dot(lightDir,   viewDir),  0.0, 1.0);\n\tfloat lh = clamp(dot(lightDir,  -halfDir),  0.0, 1.0);\n\t\n\tfloat diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\t\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\t\n\t//#if UNITY_BRDF_GGX\n\t // GGX with roughtness to 0 would mean no specular at all, using max(roughness, 0.002) here to match HDrenderloop roughtness remapping.\n\troughness = max(roughness,0.014);\n\tfloat V = SmithJointGGXVisibilityTerm(nl, nv, roughness);\n\tfloat D = GGXTerm(nh, roughness);\n\t\n\tfloat specularTerm = V * D * PI;\n\t\n\tspecularTerm = sqrt(max(0.0001, specularTerm));\n\tspecularTerm = max(0.0, specularTerm * nl);\n\t\n\tfloat surfaceReduction = 1.0 - 0.28 * roughness * perceptualRoughness;\n\tfloat grazingTerm = clamp(smoothness + (1.0 - oneMinusReflectivity), 0.0, 1.0);\n\t\n\tvec4 color;\n\tcolor.rgb = diffuseColor * (gi.diffuse+lightColor * diffuseTerm) \n\t\t\t  + specularTerm * lightColor * FresnelTerm (specularColor, lh);\n\t\t\t  //+ surfaceReduction * gi.specular * FresnelLerp(specularColor, vec3(grazingTerm), nv);\n\t\n\treturn color;\n}\nvec4 LayaAirStandardReflect(in vec4 albedoColor,in float metallic,in float smoothness,in LayaGI gi)\n{\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat alpha;\n\tfloat oneMinusReflectivity;\n\tdiffuseColor = DiffuseAndSpecularFromMetallic (albedoColor.rgb, metallic, specularColor, oneMinusReflectivity);\n\tdiffuseColor = LayaPreMultiplyAlpha(diffuseColor, albedoColor.a, oneMinusReflectivity, alpha);\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat surfaceReduction = 1.0 - 0.28 * roughness * perceptualRoughness;\n\tvec4 color;\n\tcolor.rgb = surfaceReduction * gi.specular;\n\tcolor.a = alpha;\n\treturn color;\n\n}\n\nvec4 LayaAirSpecularReflect(in vec4 albedoColor,in vec3 specularColor,in float smoothness,in LayaGI gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 diffuseColor;\n\tfloat alpha;\n\t\n\tdiffuseColor = EnergyConservationBetweenDiffuseAndSpecular (albedoColor.rgb, specularColor, oneMinusReflectivity);\n\t\n\tdiffuseColor = LayaPreMultiplyAlpha(diffuseColor, albedoColor.a, oneMinusReflectivity, alpha);\n\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat surfaceReduction = 1.0 - 0.28 * roughness * perceptualRoughness;\n\tvec4 color;\n\tcolor.rgb = surfaceReduction * gi.specular;\n\tcolor.a = alpha;\n\treturn color;\n}"),ca.addInclude("PBRUtils.glsl","\nvec3 UnpackScaleNormal(in vec2 uv0)\n{\n\t#ifdef NORMALTEXTURE\n\t\tvec3 normalT;\n\t\tvec4 normalMapSample = texture2D(u_NormalTexture, uv0);\n\t\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\t\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\t\tnormalT.xy *= u_normalScale;\n\t\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\t\t\n\t\tvec3 T = normalize(v_Tangent);\n\t\tvec3 B = normalize(v_Binormal);\n\t\tvec3 N = normalize(v_Normal);\n\t\tmat3 TBN = mat3(T, B, N);\n\t\t\n\t\tvec3 bumpedNormal = TBN * normalize(normalT);\n\t\treturn bumpedNormal;\n\t#else\n\t\treturn normalize(v_Normal);\n\t#endif\n}\n\nvec4 DielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\n\nfloat PI = 3.14159265359;\n\nvec3 FresnelTerm (in vec3 F0, in float cosA)\n{\n\treturn F0 + (vec3(1.0) - F0) * pow(1.0 - cosA, 5.0);\n}\n\nvec3 FresnelLerp (in vec3 F0, in vec3 F90, float cosA)\n{\n    float t = pow(1.0 - cosA, 5.0);\n    return mix(F0, F90, t);\n}\n\nfloat PerceptualRoughnessToRoughness(in float perceptualRoughness)\n{\n\treturn perceptualRoughness * perceptualRoughness;\n}\n\nfloat PerceptualRoughnessToSpecularPower(in float perceptualRoughness)\n{\n\tfloat m = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat sq = max(0.0001, m * m);\n\tfloat n = (2.0 / sq) - 2.0;\n\tn = max(n, 0.0001);\n\treturn n;\n}\n\nfloat RoughnessToPerceptualRoughness(in float roughness)\n{\n\treturn sqrt(roughness);\n}\n\nfloat SmoothnessToRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness) * (1.0 - smoothness);\n}\n\nfloat SmoothnessToPerceptualRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness);\n}\n\nvec3 SafeNormalize(in vec3 inVec)\n{\n\tfloat dp3 = max(0.001,dot(inVec,inVec));\n\treturn inVec * (1.0 / sqrt(dp3));\n}\n\nfloat DisneyDiffuse(in float NdotV, in float NdotL, in float LdotH, in float perceptualRoughness)\n{\n\tfloat fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n\tfloat lightScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotL,5.0));\n\tfloat viewScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotV,5.0));\n\n\treturn lightScatter * viewScatter;\n}\n\nfloat SmithJointGGXVisibilityTerm (float NdotL, float NdotV, float roughness)\n{\n\tfloat a = roughness;\n\tfloat lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n\tfloat lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\n\treturn 0.5 / (lambdaV + lambdaL + 0.00001);\n}\n\nfloat GGXTerm (float NdotH, float roughness)\n{\n\tfloat a2 = roughness * roughness;\n\tfloat d = (NdotH * a2 - NdotH) * NdotH + 1.0;\n\treturn 0.31830988618 * a2 / (d * d + 0.0000001);\n}\n\nfloat OneMinusReflectivityFromMetallic(in float metallic)\n{\n\tfloat oneMinusDielectricSpec = DielectricSpecularColor.a;\n\treturn oneMinusDielectricSpec - metallic * oneMinusDielectricSpec;\n}\n\nfloat SpecularStrength(vec3 specular)\n{\n    //(SHADER_TARGET < 30)return specular.r; \n    return max (max (specular.r, specular.g), specular.b);\n}\n\nvec3 DiffuseAndSpecularFromMetallic(in vec3 diffuseColor, in float metallic, out vec3 specularColor, out float oneMinusReflectivity)\n{\n\tspecularColor = mix(DielectricSpecularColor.rgb, diffuseColor, metallic);\n\toneMinusReflectivity = OneMinusReflectivityFromMetallic(metallic);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec3 EnergyConservationBetweenDiffuseAndSpecular(in vec3 diffuseColor, in vec3 specularColor, out float oneMinusReflectivity)\n{\n\toneMinusReflectivity = 1.0 - SpecularStrength(specularColor);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec4 Occlusion(in vec2 uv0){\n\t#ifdef OCCLUSIONTEXTURE\n\t\tvec4 occlusionTextureColor = texture2D(u_OcclusionTexture, uv0);\n\t\tfloat occ = occlusionTextureColor.g;\n\t\tfloat oneMinusT = 1.0 - u_occlusionStrength;\n\t\tfloat lerpOneTo = oneMinusT + occ * u_occlusionStrength;\n\t\treturn occlusionTextureColor * lerpOneTo;\n\t#else\n\t\treturn vec4(1.0);\n\t#endif\n}\n\nvec2 ParallaxOffset(in vec3 viewDir){\n\t#ifdef PARALLAXTEXTURE\n\t\tfloat h = texture2D(u_ParallaxTexture, v_Texcoord0).g;\n\t\th = h * u_parallaxScale - u_parallaxScale / 2.0;\n\t\tvec3 v = viewDir;\n\t\tv.z += 0.42;\n\t\tvec2 offset = h * (v.xy / v.z);\n\t\treturn v_Texcoord0 + offset;\n\t#else\n\t\treturn v_Texcoord0;\n\t#endif\n}\n\nvec3 ReflectCubeMap(in vec3 viewDir, in vec3 normal){\n\t#ifdef REFLECTMAP\n\t\tvec3 incident = -viewDir;\n\t\tvec3 reflectionVector = reflect(incident, normal);\n\t\tvec3 reflectionColor = textureCube(u_ReflectTexture, vec3(-reflectionVector.x, reflectionVector.yz)).rgb;\n\t\treturn reflectionColor * u_ReflectIntensity;\n\t#else\n\t\treturn vec3(0.0);\n\t#endif\n}\n\n\n\nvec3 LayaPreMultiplyAlpha(vec3 diffColor, float alpha, float oneMinusReflectivity, out float outModifiedAlpha)\n{\n\t#ifdef ALPHAPREMULTIPLY\n\t\tdiffColor *= alpha;\n\t\toutModifiedAlpha = 1.0 - oneMinusReflectivity + alpha * oneMinusReflectivity;\n\t#else\n\t\toutModifiedAlpha = alpha;\n\t#endif\n\treturn diffColor;\n}\n\n"),ca.addInclude("PBRStandardLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRStandardLight(in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat alpha;\n\t\n\tdiffuseColor = DiffuseAndSpecularFromMetallic (albedoColor.rgb, metallic, specularColor, oneMinusReflectivity);\n\t\n\tdiffuseColor = LayaPreMultiplyAlpha(diffuseColor, albedoColor.a, oneMinusReflectivity, alpha);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\tcolor.a = alpha;\n\treturn color;\n}\n\nvec4 PBRStandardDiectionLight (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in LayaGI gi)\n{\n\tvec3 lightVec = normalize(light.direction);\n\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.color, gi);\n}\n#ifdef POINTLIGHT\nvec4 PBRStandardPointLight (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in PointLight light, in vec3 pos, in LayaGI gi)\n{\n\tvec3 lightVec = pos-light.position;\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range);\n\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.color, gi) * attenuate;\n}\n#endif\nvec4 PBRStandardSpotLight (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in SpotLight light, in vec3 pos, in LayaGI gi)\n{\n\tvec3 lightVec =  pos - light.position;\n\tvec3 normalLightVec = normalize(lightVec);\n\tvec2 cosAngles = cos(vec2(light.spot, light.spot*0.5) * 0.5);//ConeAttenuation\n\tfloat dl = dot(normalize(light.direction), normalLightVec);\n\tdl *= smoothstep(cosAngles[0], cosAngles[1], dl);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range) * dl;\n\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.color, gi) * attenuate;\n\t\n}\n\n//vec4 PBRStandardSpotLight1 (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in SpotLight light, in vec3 pos, in LayaGI gi)\n//{\n//\tvec4 lightCoord = u_SpotLightMatrix * vec4(pos, 1.0);\n//\t\n//\tfloat distance = dot(lightCoord, lightCoord);\n//\tfloat attenuate = (lightCoord.z < 0.0) ? texture2D(u_RangeTexture, vec2(distance)).w : 0.0;\n//\t//float attenuate = (lightCoord.z < 0.0) ? texture2D(u_AngleTexture, vec2(lightCoord.x / lightCoord.w + 0.5, lightCoord.y / lightCoord.w + 0.5)).r * texture2D(u_RangeTexture, vec2(distance)).w : 0.0;\n//\t//vec2 _uv = vec2(pos.x * 180.0/(2.0 * pos.z) + 0.5, pos.y * 180.0/(2.0 * pos.z) + 0.5);\n//\tvec3 lightVec = normalize(pos - light.position);\n//\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.color, gi) * attenuate;\n//}\n\nvec2 MetallicGloss(in float albedoTextureAlpha, in vec2 uv0)\n{\n\tvec2 mg;\n\t\n\t#ifdef METALLICGLOSSTEXTURE\n\t\tvec4 metallicGlossTextureColor = texture2D(u_MetallicGlossTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tmg.r = metallicGlossTextureColor.r;\n\t\t\tmg.g = albedoTextureAlpha;\n\t\t#else\n\t\t    mg = metallicGlossTextureColor.ra;\n\t\t#endif\n\t\tmg.g *= u_smoothnessScale;\n\t#else\n\t\tmg.r = u_metallic;\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tmg.g = albedoTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tmg.g = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n\treturn mg;\n}\n\n'),ca.addInclude("PBRSpecularLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRSpecularLight(in vec4 albedoColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 diffuseColor;\n\tfloat alpha;\n\t\n\tdiffuseColor = EnergyConservationBetweenDiffuseAndSpecular (albedoColor.rgb, specularColor, oneMinusReflectivity);\n\t\n\tdiffuseColor = LayaPreMultiplyAlpha(diffuseColor, albedoColor.a, oneMinusReflectivity, alpha);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\tcolor.a = alpha;\n\treturn color;\n}\n\nvec4 PBRSpecularDiectionLight (in vec4 albedoColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in LayaGI gi)\n{\n\tvec3 lightVec = normalize(light.direction);\n\treturn PBRSpecularLight(albedoColor, specularColor, smoothness, normal, viewDir, lightVec, light.color, gi);\n}\n#ifdef POINTLIGHT\nvec4 PBRSpecularPointLight (in vec4 albedoColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in PointLight light, in vec3 pos, in LayaGI gi)\n{\n\tvec3 lightVec = pos-light.position;\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range);\n\treturn PBRSpecularLight(albedoColor, specularColor, smoothness, normal, viewDir, lightVec, light.color, gi) * attenuate;\n}\n#endif\nvec4 PBRSpecularSpotLight (in vec4 albedoColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in SpotLight light, in vec3 pos, in LayaGI gi)\n{\n\tvec3 lightVec =  pos - light.position;\n\tvec3 normalLightVec = normalize(lightVec);\n\tvec2 cosAngles = cos(vec2(light.spot, light.spot*0.5) * 0.5);//ConeAttenuation\n\tfloat dl = dot(normalize(light.direction), normalLightVec);\n\tdl *= smoothstep(cosAngles[0], cosAngles[1], dl);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range) * dl;\n\treturn PBRSpecularLight(albedoColor, specularColor, smoothness, normal, viewDir, lightVec, light.color, gi) * attenuate;\n}\n\n//vec4 PBRStandardSpotLight1 (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in SpotLight light, in vec3 pos, in LayaGI gi)\n//{\n//\tvec4 lightCoord = u_SpotLightMatrix * vec4(pos, 1.0);\n//\t\n//\tfloat distance = dot(lightCoord, lightCoord);\n//\tfloat attenuate = (lightCoord.z < 0.0) ? texture2D(u_RangeTexture, vec2(distance)).w : 0.0;\n//\t//float attenuate = (lightCoord.z < 0.0) ? texture2D(u_AngleTexture, vec2(lightCoord.x / lightCoord.w + 0.5, lightCoord.y / lightCoord.w + 0.5)).r * texture2D(u_RangeTexture, vec2(distance)).w : 0.0;\n//\t//vec2 _uv = vec2(pos.x * 180.0/(2.0 * pos.z) + 0.5, pos.y * 180.0/(2.0 * pos.z) + 0.5);\n//\tvec3 lightVec = normalize(pos - light.cosition);\n//\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.color, gi) * attenuate;\n//}\n\nvec4 SpecularGloss(float albedoTextureAlpha, in vec2 uv0)\n{\n    vec4 sg;\n\t\n\t#ifdef SPECULARTEXTURE\n\t\tvec4 specularTextureColor = texture2D(u_SpecularTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tsg.rgb = specularTextureColor.rgb;\n\t\t\tsg.a = albedoTextureAlpha;\n\t\t#else\n\t\t\tsg = specularTextureColor;\n\t\t#endif\n\t\tsg.a *= u_smoothnessScale;\n\t#else\n\t\tsg.rgb = u_SpecularColor.rgb;\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tsg.a = albedoTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tsg.a = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n    return sg;\n}\n\n'),ca.addInclude("Colors.glsl",'#include "StdLib.glsl";\n\n#define EPSILON 1.0e-4\n\n// Quadratic color thresholding\n// curve = (threshold - knee, knee * 2, 0.25 / knee)\nmediump vec4 quadraticThreshold(mediump vec4 color, mediump float threshold, mediump vec3 curve) {\n\t// Pixel brightness\n\tmediump float br = max3(color.r, color.g, color.b);\n\n\t// Under-threshold part: quadratic curve\n\tmediump float rq = clamp(br - curve.x, 0.0, curve.y);\n\trq = curve.z * rq * rq;\n\n\t// Combine and apply the brightness response curve.\n\tcolor *= max(rq, br - threshold) / max(br, EPSILON);\n\n\treturn color;\n}\n\n\n\n//\n// sRGB transfer functions\n// Fast path ref: http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1\n//\nmediump vec3 sRGBToLinear(mediump vec3 c) {\n\t#ifdef USE_VERY_FAST_SRGB\n\t\treturn c * c;\n\t#elif defined(USE_FAST_SRGB)\n\t\treturn c * (c * (c * 0.305306011 + 0.682171111) + 0.012522878);\n\t#else\n\t\tmediump vec3 linearRGBLo = c / 12.92;\n\t\tmediump vec3 power=vec3(2.4, 2.4, 2.4);\n\t\tmediump vec3 linearRGBHi = positivePow((c + 0.055) / 1.055, power);\n\t\tmediump vec3 linearRGB =vec3((c.r<=0.04045) ? linearRGBLo.r : linearRGBHi.r,(c.g<=0.04045) ? linearRGBLo.g : linearRGBHi.g,(c.b<=0.04045) ? linearRGBLo.b : linearRGBHi.b);\n\t\treturn linearRGB;\n\t#endif\n}\n\nmediump vec4 sRGBToLinear(mediump vec4 c){\n    return vec4(sRGBToLinear(c.rgb), c.a);\n}\n\n\n\nmediump vec3 linearToSRGB(mediump vec3 c) {\n\t#ifdef USE_VERY_FAST_SRGB\n\t\treturn sqrt(c);\n\t#elif defined(USE_FAST_SRGB)\n\t\treturn max(1.055 * PositivePow(c, 0.416666667) - 0.055, 0.0);\n\t#else\n\t\tmediump vec3 sRGBLo = c * 12.92;\n\t\tmediump vec3 power=vec3(1.0 / 2.4, 1.0 / 2.4, 1.0 / 2.4);\n\t\tmediump vec3 sRGBHi = (positivePow(c, power) * 1.055) - 0.055;\n\t\tmediump vec3 sRGB =vec3((c.r<=0.0031308) ? sRGBLo.r : sRGBHi.r,(c.g<=0.0031308) ? sRGBLo.g : sRGBHi.g,(c.b<=0.0031308) ? sRGBLo.b : sRGBHi.b);\n\t\treturn sRGB;\n\t#endif\n}\n\nmediump vec4 linearToSRGB(mediump vec4 c){\n    return vec4(linearToSRGB(c.rgb), c.a);\n}'),ca.addInclude("Sampling.glsl","// Better, temporally stable box filtering\n// [Jimenez14] http://goo.gl/eomGso\n// . . . . . . .\n// . A . B . C .\n// . . D . E . .\n// . F . G . H .\n// . . I . J . .\n// . K . L . M .\n// . . . . . . .\nmediump vec4 downsampleBox13Tap(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    mediump vec4 A = texture2D(tex, uv + texelSize * vec2(-1.0, -1.0));\n    mediump vec4 B = texture2D(tex, uv + texelSize * vec2( 0.0, -1.0));\n    mediump vec4 C = texture2D(tex, uv + texelSize * vec2( 1.0, -1.0));\n    mediump vec4 D = texture2D(tex, uv + texelSize * vec2(-0.5, -0.5));\n    mediump vec4 E = texture2D(tex, uv + texelSize * vec2( 0.5, -0.5));\n    mediump vec4 F = texture2D(tex, uv + texelSize * vec2(-1.0,  0.0));\n    mediump vec4 G = texture2D(tex, uv);\n    mediump vec4 H = texture2D(tex, uv + texelSize * vec2( 1.0,  0.0));\n    mediump vec4 I = texture2D(tex, uv + texelSize * vec2(-0.5,  0.5));\n    mediump vec4 J = texture2D(tex, uv + texelSize * vec2( 0.5,  0.5));\n    mediump vec4 K = texture2D(tex, uv + texelSize * vec2(-1.0,  1.0));\n    mediump vec4 L = texture2D(tex, uv + texelSize * vec2( 0.0,  1.0));\n    mediump vec4 M = texture2D(tex, uv + texelSize * vec2( 1.0,  1.0));\n\n\tmediump vec2 scale= vec2(0.5, 0.125);\n    mediump vec2 div = (1.0 / 4.0) * scale;\n\n    mediump vec4 o = (D + E + I + J) * div.x;\n    o += (A + B + G + F) * div.y;\n    o += (B + C + H + G) * div.y;\n    o += (F + G + L + K) * div.y;\n    o += (G + H + M + L) * div.y;\n\n    return o;\n}\n\n// Standard box filtering\nmediump vec4 downsampleBox4Tap(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\n\n    mediump vec4 s =  texture2D(tex, uv + d.xy);\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.xw);\n    s += texture2D(tex, uv + d.zw);\n\n    return s * (1.0 / 4.0);\n}\n\n// 9-tap bilinear upsampler (tent filter)\n// . . . . . . .\n// . 1 . 2 . 1 .\n// . . . . . . .\n// . 2 . 4 . 2 .\n// . . . . . . .\n// . 1 . 2 . 1 .\n// . . . . . . .\nmediump vec4 upsampleTent(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\n{\n    vec4 d = texelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0) * sampleScale;\n\n    mediump vec4 s =  texture2D(tex, uv - d.xy);\n    s += texture2D(tex, uv - d.wy) * 2.0;\n    s += texture2D(tex, uv - d.zy);\n\n    s += texture2D(tex, uv + d.zw) * 2.0;\n    s += texture2D(tex, uv) * 4.0;\n    s += texture2D(tex,\tuv + d.xw) * 2.0;\n\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.wy) * 2.0;\n    s += texture2D(tex, uv + d.xy);\n\n    return s * (1.0 / 16.0);\n}\n\n// Standard box filtering\nmediump vec4 upsampleBox(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0) * 0.5 * sampleScale;\n\n    mediump vec4 s =  texture2D(tex, uv + d.xy);\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.xw);\n    s += texture2D(tex, uv + d.zw);\n\n    return s * (1.0 / 4.0);\n}"),ca.addInclude("StdLib.glsl","#define HALF_MAX       65504.0 // (2 - 2^-10) * 2^15\n\n#define FLT_EPSILON    1.192092896e-07 // Smallest positive number, such that 1.0 + FLT_EPSILON != 1.0\n\nmediump vec4 safeHDR(mediump vec4 c)\n{\n    return min(c, HALF_MAX);\n}\n\nfloat max3(float a, float b, float c)\n{\n    return max(max(a, b), c);\n}\n\nvec3 positivePow(vec3 base, vec3 power)\n{\n    return pow(max(abs(base), vec3(FLT_EPSILON, FLT_EPSILON, FLT_EPSILON)), power);\n}");var e={a_Position:wa.MESH_POSITION0,a_Color:wa.MESH_COLOR0,a_Normal:wa.MESH_NORMAL0,a_Texcoord0:wa.MESH_TEXTURECOORDINATE0,a_Texcoord1:wa.MESH_TEXTURECOORDINATE1,a_BoneWeights:wa.MESH_BLENDWEIGHT0,a_BoneIndices:wa.MESH_BLENDINDICES0,a_Tangent0:wa.MESH_TANGENT0,a_MvpMatrix:wa.MESH_MVPMATRIX_ROW0,a_WorldMat:wa.MESH_WORLDMATRIX_ROW0},t={u_Bones:ca.PERIOD_CUSTOM,u_DiffuseTexture:ca.PERIOD_MATERIAL,u_SpecularTexture:ca.PERIOD_MATERIAL,u_NormalTexture:ca.PERIOD_MATERIAL,u_AlphaTestValue:ca.PERIOD_MATERIAL,u_DiffuseColor:ca.PERIOD_MATERIAL,u_MaterialSpecular:ca.PERIOD_MATERIAL,u_Shininess:ca.PERIOD_MATERIAL,u_TilingOffset:ca.PERIOD_MATERIAL,u_WorldMat:ca.PERIOD_SPRITE,u_MvpMatrix:ca.PERIOD_SPRITE,u_LightmapScaleOffset:ca.PERIOD_SPRITE,u_LightMap:ca.PERIOD_SPRITE,u_CameraPos:ca.PERIOD_CAMERA,u_Viewport:ca.PERIOD_CAMERA,u_ProjectionParams:ca.PERIOD_CAMERA,u_View:ca.PERIOD_CAMERA,u_ReflectTexture:ca.PERIOD_SCENE,u_ReflectIntensity:ca.PERIOD_SCENE,u_FogStart:ca.PERIOD_SCENE,u_FogRange:ca.PERIOD_SCENE,u_FogColor:ca.PERIOD_SCENE,u_DirationLightCount:ca.PERIOD_SCENE,u_LightBuffer:ca.PERIOD_SCENE,u_LightClusterBuffer:ca.PERIOD_SCENE,u_AmbientColor:ca.PERIOD_SCENE,u_shadowMap1:ca.PERIOD_SCENE,u_shadowMap2:ca.PERIOD_SCENE,u_shadowMap3:ca.PERIOD_SCENE,u_shadowPSSMDistance:ca.PERIOD_SCENE,u_lightShadowVP:ca.PERIOD_SCENE,u_shadowPCFoffset:ca.PERIOD_SCENE,"u_DirectionLight.color":ca.PERIOD_SCENE,"u_DirectionLight.direction":ca.PERIOD_SCENE,"u_PointLight.position":ca.PERIOD_SCENE,"u_PointLight.range":ca.PERIOD_SCENE,"u_PointLight.color":ca.PERIOD_SCENE,"u_SpotLight.position":ca.PERIOD_SCENE,"u_SpotLight.direction":ca.PERIOD_SCENE,"u_SpotLight.range":ca.PERIOD_SCENE,"u_SpotLight.spot":ca.PERIOD_SCENE,"u_SpotLight.color":ca.PERIOD_SCENE},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("BLINNPHONG",null,null,!0),a=new ms(e,t);i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t#ifdef GPU_INSTANCE\n\t\tattribute mat4 a_WorldMat;\n\t#else\n\t\tuniform mat4 u_WorldMat;\n\t#endif\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t\tmat4 worldMat;\n\t\t#ifdef GPU_INSTANCE\n\t\t\tworldMat = a_WorldMat;\n\t\t#else\n\t\t\tworldMat = u_WorldMat;\n\t\t#endif\n\t#endif\n\t\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tmat3 worldInvMat;\n\t\t#ifdef BONE\n\t\t\tworldInvMat=inverse(mat3(worldMat*skinTransform));\n\t\t#else\n\t\t\tworldInvMat=inverse(mat3(worldMat));\n\t\t#endif  \n\t\tv_Normal=a_Normal*worldInvMat;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=a_Tangent0.xyz*worldInvMat;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t\tv_PositionWorld=(worldMat*position).xyz;\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t\t#else\n\t\t\tv_Texcoord0=a_Texcoord0;\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_ViewDir; \n\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tuniform DirectionLight u_DirectionLight;\n\t\t#endif\n\t\t#ifdef POINTLIGHT\n\t\t\tuniform PointLight u_PointLight;\n\t\t#endif\n\t\t#ifdef SPOTLIGHT\n\t\t\tuniform SpotLight u_SpotLight;\n\t\t#endif\n\t#else\n\t\tuniform mat4 u_View;\n\t\tuniform vec4 u_ProjectionParams;\n\t\tuniform vec4 u_Viewport;\n\t\tuniform int u_DirationLightCount;\n\t\tuniform sampler2D u_LightBuffer;\n\t\tuniform sampler2D u_LightClusterBuffer;\n\t#endif\n\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n\t#ifdef NORMALMAP \n\t\tuniform sampler2D u_NormalTexture;\n\t\tvarying vec3 v_Tangent;\n\t\tvarying vec3 v_Binormal;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\nuniform vec3 u_AmbientColor;\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec3 globalDiffuse=u_AmbientColor;\n\t#ifdef LIGHTMAP\t\n\t\tglobalDiffuse += DecodeLightmap(texture2D(u_LightMap, v_LightMapUV));\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t#endif\n\t\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t\n\tvec3 diffuse = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\t\n\t\t#ifdef POINTLIGHT\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\n\t\t#ifdef SPOTLIGHT\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\t#else\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t{\n\t\t\t\tif(i >= u_DirationLightCount)\n\t\t\t\t\tbreak;\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\n\t\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,directionLight,dif,spe);\n\t\t\t\tdiffuse+=dif;\n\t\t\t\tspecular+=spe;\n\t\t\t}\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\n\t\t\t#ifdef POINTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,pointLight,dif,spe);\n\t\t\t\t\tdiffuse+=dif;\n\t\t\t\t\tspecular+=spe;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\t#ifdef SPOTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,spotLight,dif,spe);\n\t\t\t\t\tdiffuse+=dif;\n\t\t\t\t\tspecular+=spe;\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3(u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2(u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1(u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse*shadowValue),mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',n),e={a_Position:wa.MESH_POSITION0,a_Color:wa.MESH_COLOR0},t={u_MvpMatrix:ca.PERIOD_SPRITE,u_Color:ca.PERIOD_MATERIAL},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("LineShader"),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nuniform vec4 u_Color;\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n\tv_Color=a_Color*u_Color;\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',"#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nuniform vec4 u_Color;\n\nvoid main()\n{\n  gl_FragColor = v_Color * u_Color; \n}\n\n",n),e={a_Position:wa.MESH_POSITION0,a_Normal:wa.MESH_NORMAL0,a_Tangent0:wa.MESH_TANGENT0,a_Texcoord0:wa.MESH_TEXTURECOORDINATE0,a_BoneWeights:wa.MESH_BLENDWEIGHT0,a_BoneIndices:wa.MESH_BLENDINDICES0,a_MvpMatrix:wa.MESH_MVPMATRIX_ROW0,a_WorldMat:wa.MESH_WORLDMATRIX_ROW0},t={u_Bones:ca.PERIOD_CUSTOM,u_MvpMatrix:ca.PERIOD_SPRITE,u_WorldMat:ca.PERIOD_SPRITE,u_CameraPos:ca.PERIOD_CAMERA,u_View:ca.PERIOD_CAMERA,u_ProjectionParams:ca.PERIOD_CAMERA,u_Viewport:ca.PERIOD_CAMERA,u_AlphaTestValue:ca.PERIOD_MATERIAL,u_AlbedoColor:ca.PERIOD_MATERIAL,u_EmissionColor:ca.PERIOD_MATERIAL,u_AlbedoTexture:ca.PERIOD_MATERIAL,u_NormalTexture:ca.PERIOD_MATERIAL,u_ParallaxTexture:ca.PERIOD_MATERIAL,u_MetallicGlossTexture:ca.PERIOD_MATERIAL,u_OcclusionTexture:ca.PERIOD_MATERIAL,u_EmissionTexture:ca.PERIOD_MATERIAL,u_metallic:ca.PERIOD_MATERIAL,u_smoothness:ca.PERIOD_MATERIAL,u_smoothnessScale:ca.PERIOD_MATERIAL,u_occlusionStrength:ca.PERIOD_MATERIAL,u_normalScale:ca.PERIOD_MATERIAL,u_parallaxScale:ca.PERIOD_MATERIAL,u_TilingOffset:ca.PERIOD_MATERIAL,u_ReflectTexture:ca.PERIOD_SCENE,u_ReflectIntensity:ca.PERIOD_SCENE,u_AmbientColor:ca.PERIOD_SCENE,u_shadowMap1:ca.PERIOD_SCENE,u_shadowMap2:ca.PERIOD_SCENE,u_shadowMap3:ca.PERIOD_SCENE,u_shadowPSSMDistance:ca.PERIOD_SCENE,u_lightShadowVP:ca.PERIOD_SCENE,u_shadowPCFoffset:ca.PERIOD_SCENE,u_FogStart:ca.PERIOD_SCENE,u_FogRange:ca.PERIOD_SCENE,u_FogColor:ca.PERIOD_SCENE,u_DirationLightCount:ca.PERIOD_SCENE,u_LightBuffer:ca.PERIOD_SCENE,u_LightClusterBuffer:ca.PERIOD_SCENE,"u_DirectionLight.direction":ca.PERIOD_SCENE,"u_DirectionLight.color":ca.PERIOD_SCENE,"u_PointLight.position":ca.PERIOD_SCENE,"u_PointLight.range":ca.PERIOD_SCENE,"u_PointLight.color":ca.PERIOD_SCENE,"u_SpotLight.position":ca.PERIOD_SCENE,"u_SpotLight.direction":ca.PERIOD_SCENE,"u_SpotLight.range":ca.PERIOD_SCENE,"u_SpotLight.spot":ca.PERIOD_SCENE,"u_SpotLight.color":ca.PERIOD_SCENE},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("PBRStandard",null,null,!0),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_WorldMat;\n#endif\n\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)||defined(REFLECTMAP)\n\t\tmat4 worldMat;\n\t\t#ifdef GPU_INSTANCE\n\t\t\tworldMat = a_WorldMat;\n\t\t#else\n\t\t\tworldMat = u_WorldMat;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldInvMat;\n\t\t#ifdef BONE\n\t\t\tworldInvMat=inverse(mat3(worldMat*skinTransform));\n\t\t#else\n\t\t\tworldInvMat=inverse(mat3(worldMat));\n\t\t#endif  \n\t\tv_Normal=a_Normal*worldInvMat;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))\n\t\t\tv_Tangent=a_Tangent0.xyz*worldInvMat;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\t\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)||defined(REFLECTMAP)\n\t\tv_PositionWorld=(worldMat*position).xyz;\n\t#endif\n\t\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\nuniform vec3 u_AmbientColor;\nuniform vec4 u_AlbedoColor;\n\n#ifdef ALBEDOTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n#endif\n#ifdef METALLICGLOSSTEXTURE\n\tuniform sampler2D u_MetallicGlossTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform float u_ReflectIntensity;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n\n\n\n#include "Lighting.glsl";\n#include "PBRStandardLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\n#ifdef LEGACYSINGLELIGHTING\n\t#ifdef DIRECTIONLIGHT\n\t\tuniform DirectionLight u_DirectionLight;\n\t#endif\n\t#ifdef POINTLIGHT\n\t\tuniform PointLight u_PointLight;\n\t#endif\n\t#ifdef SPOTLIGHT\n\t\tuniform SpotLight u_SpotLight;\n\t#endif\n#else\n\t\tuniform mat4 u_View;\n\t\tuniform vec4 u_ProjectionParams;\n\t\tuniform vec4 u_Viewport;\n\t\tuniform int u_DirationLightCount;\n\t\tuniform sampler2D u_LightBuffer;\n\t\tuniform sampler2D u_LightClusterBuffer;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_AlbedoTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec2 mg;\n\tvec4 albedoColor;\n\t#ifdef ALBEDOTEXTURE\n\t\tvec4 abledoTextureColor = texture2D(u_AlbedoTexture, uv0);\n\t\talbedoColor = abledoTextureColor * u_AlbedoColor;\n\t\tmg = MetallicGloss(abledoTextureColor.a, uv0);\n\t#else\n\t\talbedoColor = u_AlbedoColor;\n\t\tmg = MetallicGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(albedoColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tvec3 normal = UnpackScaleNormal(uv0);\n  \n\tLayaGI gi;\n\tgi.diffuse = u_AmbientColor * Occlusion(uv0).rgb;\n\tgi.specular = ReflectCubeMap(viewDir, normal);\n  \n\tvec4 color = vec4(0.0);\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tcolor += PBRStandardDiectionLight(albedoColor, mg.r, mg.g, normal, viewDir, u_DirectionLight, gi);\n\t\t#endif\n\t\n\t\t#ifdef POINTLIGHT\n\t\t\tcolor.a = 0.0;\n\t\t\tcolor += PBRStandardPointLight(albedoColor, mg.r, mg.g, normal, viewDir, u_PointLight, v_PositionWorld, gi);\n\t\t#endif\n\t\t\n\t\t#ifdef SPOTLIGHT\n\t\t\tcolor.a = 0.0;\n\t\t\tcolor += PBRStandardSpotLight(albedoColor, mg.r, mg.g, normal, viewDir, u_SpotLight, v_PositionWorld, gi);\n\t\t#endif\n\t#else\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t{\n\t\t\t\tif(i >= u_DirationLightCount)\n\t\t\t\t\tbreak;\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\n\t\t\t\tcolor.a = 0.0;\n\t\t\t\tcolor += PBRStandardDiectionLight(albedoColor, mg.r, mg.g, normal, viewDir, directionLight, gi);\n\t\t\t}\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\n\t\t\t#ifdef POINTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tcolor.a = 0.0;\n\t\t\t\t\tcolor += PBRStandardPointLight(albedoColor, mg.r, mg.g, normal, viewDir, pointLight, v_PositionWorld, gi);\n\t\t\t\t}\n\t\t\t#endif\n\t\t\t#ifdef SPOTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tcolor.a = 0.0;\n\t\t\t\t\tcolor += PBRStandardSpotLight(albedoColor, mg.r, mg.g, normal, viewDir, spotLight, v_PositionWorld, gi);\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef REFLECTMAP\n\t \tcolor += LayaAirStandardReflect(albedoColor,mg.r,mg.g,gi);\n\t#endif\n\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}',n),e={a_Position:wa.MESH_POSITION0,a_Normal:wa.MESH_NORMAL0,a_Tangent0:wa.MESH_TANGENT0,a_Texcoord0:wa.MESH_TEXTURECOORDINATE0,a_BoneWeights:wa.MESH_BLENDWEIGHT0,a_BoneIndices:wa.MESH_BLENDINDICES0,a_MvpMatrix:wa.MESH_MVPMATRIX_ROW0,a_WorldMat:wa.MESH_WORLDMATRIX_ROW0},t={u_Bones:ca.PERIOD_CUSTOM,u_MvpMatrix:ca.PERIOD_SPRITE,u_WorldMat:ca.PERIOD_SPRITE,u_CameraPos:ca.PERIOD_CAMERA,u_View:ca.PERIOD_CAMERA,u_ProjectionParams:ca.PERIOD_CAMERA,u_Viewport:ca.PERIOD_CAMERA,u_AlphaTestValue:ca.PERIOD_MATERIAL,u_AlbedoColor:ca.PERIOD_MATERIAL,u_SpecularColor:ca.PERIOD_MATERIAL,u_EmissionColor:ca.PERIOD_MATERIAL,u_AlbedoTexture:ca.PERIOD_MATERIAL,u_NormalTexture:ca.PERIOD_MATERIAL,u_ParallaxTexture:ca.PERIOD_MATERIAL,u_SpecularTexture:ca.PERIOD_MATERIAL,u_OcclusionTexture:ca.PERIOD_MATERIAL,u_EmissionTexture:ca.PERIOD_MATERIAL,u_smoothness:ca.PERIOD_MATERIAL,u_smoothnessScale:ca.PERIOD_MATERIAL,u_occlusionStrength:ca.PERIOD_MATERIAL,u_normalScale:ca.PERIOD_MATERIAL,u_parallaxScale:ca.PERIOD_MATERIAL,u_TilingOffset:ca.PERIOD_MATERIAL,u_ReflectTexture:ca.PERIOD_SCENE,u_ReflectIntensity:ca.PERIOD_SCENE,u_AmbientColor:ca.PERIOD_SCENE,u_shadowMap1:ca.PERIOD_SCENE,u_shadowMap2:ca.PERIOD_SCENE,u_shadowMap3:ca.PERIOD_SCENE,u_shadowPSSMDistance:ca.PERIOD_SCENE,u_lightShadowVP:ca.PERIOD_SCENE,u_shadowPCFoffset:ca.PERIOD_SCENE,u_FogStart:ca.PERIOD_SCENE,u_FogRange:ca.PERIOD_SCENE,u_FogColor:ca.PERIOD_SCENE,u_DirationLightCount:ca.PERIOD_SCENE,u_LightBuffer:ca.PERIOD_SCENE,u_LightClusterBuffer:ca.PERIOD_SCENE,"u_DirectionLight.direction":ca.PERIOD_SCENE,"u_DirectionLight.color":ca.PERIOD_SCENE,"u_PointLight.position":ca.PERIOD_SCENE,"u_PointLight.range":ca.PERIOD_SCENE,"u_PointLight.color":ca.PERIOD_SCENE,"u_SpotLight.position":ca.PERIOD_SCENE,"u_SpotLight.direction":ca.PERIOD_SCENE,"u_SpotLight.range":ca.PERIOD_SCENE,"u_SpotLight.spot":ca.PERIOD_SCENE,"u_SpotLight.color":ca.PERIOD_SCENE},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("PBRSpecular",null,null,!0),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_WorldMat;\n#endif\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)||defined(REFLECTMAP)\n\t\tmat4 worldMat;\n\t\t#ifdef GPU_INSTANCE\n\t\t\tworldMat = a_WorldMat;\n\t\t#else\n\t\t\tworldMat = u_WorldMat;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldInvMat;\n\t\t#ifdef BONE\n\t\t\tworldInvMat=inverse(mat3(worldMat*skinTransform));\n\t\t#else\n\t\t\tworldInvMat=inverse(mat3(worldMat));\n\t\t#endif  \n\t\tv_Normal=a_Normal*worldInvMat;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))\n\t\t\tv_Tangent=a_Tangent0.xyz*worldInvMat;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\t\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)||defined(REFLECTMAP)\n\t\tv_PositionWorld=(worldMat*position).xyz;\n\t#endif\n\t\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\nuniform vec3 u_AmbientColor;\nuniform vec4 u_AlbedoColor;\nuniform vec4 u_SpecularColor;\n\n#ifdef ALBEDOTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n#endif\n#ifdef SPECULARTEXTURE\n\tuniform sampler2D u_SpecularTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform float u_ReflectIntensity;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n\n\n#include "Lighting.glsl";\n#include "PBRSpecularLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\n#ifdef LEGACYSINGLELIGHTING\n\t#ifdef DIRECTIONLIGHT\n\t\tuniform DirectionLight u_DirectionLight;\n\t#endif\n\t#ifdef POINTLIGHT\n\t\tuniform PointLight u_PointLight;\n\t#endif\n\t#ifdef SPOTLIGHT\n\t\tuniform SpotLight u_SpotLight;\n\t#endif\n#else\n\t\tuniform mat4 u_View;\n\t\tuniform vec4 u_ProjectionParams;\n\t\tuniform vec4 u_Viewport;\n\t\tuniform int u_DirationLightCount;\n\t\tuniform sampler2D u_LightBuffer;\n\t\tuniform sampler2D u_LightClusterBuffer;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_AlbedoTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec4 sg;\n\tvec4 albedoColor;\n\t#ifdef ALBEDOTEXTURE\n\t\tvec4 albedoTextureColor = texture2D(u_AlbedoTexture, uv0);\n\t\talbedoColor = albedoTextureColor * u_AlbedoColor;\n\t\tsg = SpecularGloss(albedoTextureColor.a, uv0);\n\t#else\n\t\talbedoColor = u_AlbedoColor;\n\t\tsg = SpecularGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(albedoColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\tvec3 normal = UnpackScaleNormal(uv0);\n\t\n\tLayaGI gi;\n\tgi.diffuse = u_AmbientColor * Occlusion(uv0).rgb;\n\tgi.specular = ReflectCubeMap(viewDir, normal);\n\t\n\t//float a = (sg.r+sg.g+sg.b) / 3.0;\n  \n\tvec4 color = vec4(0.0);\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tcolor += PBRSpecularDiectionLight(albedoColor, sg.rgb, sg.a, normal, viewDir, u_DirectionLight, gi);\n\t\t#endif\n\t\n\t\t#ifdef POINTLIGHT\n\t\t\tcolor.a = 0.0;\n\t\t\tcolor += PBRSpecularPointLight(albedoColor, sg.rgb, sg.a, normal, viewDir, u_PointLight, v_PositionWorld, gi);\n\t\t#endif\n\t\t\n\t\t#ifdef SPOTLIGHT\n\t\t\tcolor.a = 0.0;\n\t\t\tcolor += PBRSpecularSpotLight(albedoColor, sg.rgb, sg.a, normal, viewDir, u_SpotLight, v_PositionWorld, gi);\n\t\t#endif\n\t#else\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t{\n\t\t\t\tif(i >= u_DirationLightCount)\n\t\t\t\t\tbreak;\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\n\t\t\t\tcolor.a = 0.0;\n\t\t\t\tcolor +=PBRSpecularDiectionLight(albedoColor, sg.rgb, sg.a, normal, viewDir, directionLight, gi);\n\t\t\t}\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\n\t\t\t#ifdef POINTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tcolor.a = 0.0;\n\t\t\t\t\tcolor +=PBRSpecularPointLight(albedoColor, sg.rgb, sg.a, normal, viewDir, pointLight, v_PositionWorld, gi);\n\t\t\t\t}\n\t\t\t#endif\n\t\t\t#ifdef SPOTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tcolor.a = 0.0;\n\t\t\t\t\tcolor += PBRSpecularSpotLight(albedoColor, sg.rgb, sg.a, normal, viewDir, spotLight, v_PositionWorld, gi);\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\t\n\t#ifdef REFLECTMAP\n\t \tcolor += LayaAirSpecularReflect(albedoColor,sg.rgb,sg.a,gi);\n\t#endif\n\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',n),e={a_Position:wa.MESH_POSITION0,a_Color:wa.MESH_COLOR0,a_Texcoord0:wa.MESH_TEXTURECOORDINATE0,a_BoneWeights:wa.MESH_BLENDWEIGHT0,a_BoneIndices:wa.MESH_BLENDINDICES0,a_MvpMatrix:wa.MESH_MVPMATRIX_ROW0},t={u_Bones:ca.PERIOD_CUSTOM,u_AlbedoTexture:ca.PERIOD_MATERIAL,u_AlbedoColor:ca.PERIOD_MATERIAL,u_TilingOffset:ca.PERIOD_MATERIAL,u_AlphaTestValue:ca.PERIOD_MATERIAL,u_MvpMatrix:ca.PERIOD_SPRITE,u_FogStart:ca.PERIOD_SCENE,u_FogRange:ca.PERIOD_SCENE,u_FogColor:ca.PERIOD_SCENE},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("Unlit",null,null,!0),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\n\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\nattribute vec4 a_Color;\nvarying vec4 v_Color;\nvarying vec2 v_Texcoord0;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main() {\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color = a_Color;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',"#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef ALBEDOTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n\tvarying vec2 v_Texcoord0;\n#endif\n\nuniform vec4 u_AlbedoColor;\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\nvoid main()\n{\n\tvec4 color =  u_AlbedoColor;\n\t#ifdef ALBEDOTEXTURE\n\t\tcolor *= texture2D(u_AlbedoTexture, v_Texcoord0);\n\t#endif\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tcolor *= v_Color;\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(color.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tgl_FragColor = color;\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t\t#endif\n\t#endif\n\t\n}\n\n",n),e={a_Position:wa.MESH_POSITION0,a_Texcoord0:wa.MESH_TEXTURECOORDINATE0,a_BoneWeights:wa.MESH_BLENDWEIGHT0,a_BoneIndices:wa.MESH_BLENDINDICES0,a_MvpMatrix:wa.MESH_MVPMATRIX_ROW0},t={u_Bones:ca.PERIOD_CUSTOM,u_AlbedoTexture:ca.PERIOD_MATERIAL,u_AlbedoColor:ca.PERIOD_MATERIAL,u_TilingOffset:ca.PERIOD_MATERIAL,u_AlphaTestValue:ca.PERIOD_MATERIAL,u_MvpMatrix:ca.PERIOD_SPRITE,u_FogStart:ca.PERIOD_SCENE,u_FogRange:ca.PERIOD_SCENE,u_FogColor:ca.PERIOD_SCENE},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("Effect",null,null,!0),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\nvarying vec2 v_Texcoord0;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\t\n\t#ifdef COLOR\n\t\tv_Color = a_Color;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',"#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\nvarying vec2 v_Texcoord0;\n\n#ifdef MAINTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n#endif\n\nuniform vec4 u_AlbedoColor;\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\nvoid main()\n{\n\tvec4 color =  2.0 * u_AlbedoColor;\n\t#ifdef COLOR\n\t\tcolor *= v_Color;\n\t#endif\n\t#ifdef MAINTEXTURE\n\t\tcolor *= texture2D(u_AlbedoTexture, v_Texcoord0);\n\t#endif\n\t\n\tgl_FragColor = color;\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t\t#endif\n\t#endif\n}\n\n",n),e={a_CornerTextureCoordinate:Rl.PARTICLE_CORNERTEXTURECOORDINATE0,a_MeshPosition:Rl.PARTICLE_POSITION0,a_MeshColor:Rl.PARTICLE_COLOR0,a_MeshTextureCoordinate:Rl.PARTICLE_TEXTURECOORDINATE0,a_ShapePositionStartLifeTime:Rl.PARTICLE_SHAPEPOSITIONSTARTLIFETIME,a_DirectionTime:Rl.PARTICLE_DIRECTIONTIME,a_StartColor:Rl.PARTICLE_STARTCOLOR0,a_EndColor:Rl.PARTICLE_ENDCOLOR0,a_StartSize:Rl.PARTICLE_STARTSIZE,a_StartRotation0:Rl.PARTICLE_STARTROTATION,a_StartSpeed:Rl.PARTICLE_STARTSPEED,a_Random0:Rl.PARTICLE_RANDOM0,a_Random1:Rl.PARTICLE_RANDOM1,a_SimulationWorldPostion:Rl.PARTICLE_SIMULATIONWORLDPOSTION,a_SimulationWorldRotation:Rl.PARTICLE_SIMULATIONWORLDROTATION},t={u_Tintcolor:ca.PERIOD_MATERIAL,u_TilingOffset:ca.PERIOD_MATERIAL,u_texture:ca.PERIOD_MATERIAL,u_WorldPosition:ca.PERIOD_SPRITE,u_WorldRotation:ca.PERIOD_SPRITE,u_PositionScale:ca.PERIOD_SPRITE,u_SizeScale:ca.PERIOD_SPRITE,u_ScalingMode:ca.PERIOD_SPRITE,u_Gravity:ca.PERIOD_SPRITE,u_ThreeDStartRotation:ca.PERIOD_SPRITE,u_StretchedBillboardLengthScale:ca.PERIOD_SPRITE,u_StretchedBillboardSpeedScale:ca.PERIOD_SPRITE,u_SimulationSpace:ca.PERIOD_SPRITE,u_CurrentTime:ca.PERIOD_SPRITE,u_ColorOverLifeGradientAlphas:ca.PERIOD_SPRITE,u_ColorOverLifeGradientColors:ca.PERIOD_SPRITE,u_MaxColorOverLifeGradientAlphas:ca.PERIOD_SPRITE,u_MaxColorOverLifeGradientColors:ca.PERIOD_SPRITE,u_VOLVelocityConst:ca.PERIOD_SPRITE,u_VOLVelocityGradientX:ca.PERIOD_SPRITE,u_VOLVelocityGradientY:ca.PERIOD_SPRITE,u_VOLVelocityGradientZ:ca.PERIOD_SPRITE,u_VOLVelocityConstMax:ca.PERIOD_SPRITE,u_VOLVelocityGradientMaxX:ca.PERIOD_SPRITE,u_VOLVelocityGradientMaxY:ca.PERIOD_SPRITE,u_VOLVelocityGradientMaxZ:ca.PERIOD_SPRITE,u_VOLSpaceType:ca.PERIOD_SPRITE,u_SOLSizeGradient:ca.PERIOD_SPRITE,u_SOLSizeGradientX:ca.PERIOD_SPRITE,u_SOLSizeGradientY:ca.PERIOD_SPRITE,u_SOLSizeGradientZ:ca.PERIOD_SPRITE,u_SOLSizeGradientMax:ca.PERIOD_SPRITE,u_SOLSizeGradientMaxX:ca.PERIOD_SPRITE,u_SOLSizeGradientMaxY:ca.PERIOD_SPRITE,u_SOLSizeGradientMaxZ:ca.PERIOD_SPRITE,u_ROLAngularVelocityConst:ca.PERIOD_SPRITE,u_ROLAngularVelocityConstSeprarate:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradient:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradientX:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradientY:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradientZ:ca.PERIOD_SPRITE,u_ROLAngularVelocityConstMax:ca.PERIOD_SPRITE,u_ROLAngularVelocityConstMaxSeprarate:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradientMax:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxX:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxY:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxZ:ca.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxW:ca.PERIOD_SPRITE,u_TSACycles:ca.PERIOD_SPRITE,u_TSASubUVLength:ca.PERIOD_SPRITE,u_TSAGradientUVs:ca.PERIOD_SPRITE,u_TSAMaxGradientUVs:ca.PERIOD_SPRITE,u_CameraPos:ca.PERIOD_CAMERA,u_CameraDirection:ca.PERIOD_CAMERA,u_CameraUp:ca.PERIOD_CAMERA,u_View:ca.PERIOD_CAMERA,u_Projection:ca.PERIOD_CAMERA,u_FogStart:ca.PERIOD_SCENE,u_FogRange:ca.PERIOD_SCENE,u_FogColor:ca.PERIOD_SCENE},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("PARTICLESHURIKEN"),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\n#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPos;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t\t\tfinalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   \tfinalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0)\n\t{ \n\t\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t\t#endif \n\t\tvec3 gravityVelocity=u_Gravity*age;\n\t\t\n\t\tvec4 worldRotation;\n\t\tif(u_SimulationSpace==0)\n\t\t\tworldRotation=a_SimulationWorldRotation;\n\t\telse\n\t\t\tworldRotation=u_WorldRotation;\n\t\t\n\t\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n\t\n\t\n\t\t#ifdef SPHERHBILLBOARD\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\t\t\tvec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n\t\t\tvec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\tvec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tfloat c = cos(rot);\n\t\t\t\t\tfloat s = sin(rot);\n\t\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\t\tcorner=rotation*corner;\n\t\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t\t}\n\t\t\t#else\n\t\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\t\tcorner=rotation*corner;\n\t\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t\n\t\t#ifdef STRETCHEDBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\t\tvec3 velocity;\n\t\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\t\tif(u_VOLSpaceType==0)\n\t\t\tvelocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t\t\telse\n\t\t\tvelocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n\t\t#else\n\t\t\tvelocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n\t\t#endif\t\n\t\t\tvec3 cameraUpVector = normalize(velocity);\n\t\t\tvec3 direction = normalize(center-u_CameraPos);\n\t\t\tvec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\t\n\t\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\t\n\t\t\tvec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\t\n\t\t\tconst mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t\t\tcorner=rotaionZHalfPI*corner;\n\t\t\tcorner.y=corner.y-abs(corner.y);\n\t\t\t\n\t\t\tfloat speed=length(velocity);//TODO:\n\t\t\tcenter +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n\t\t#endif\n\t\n\t\t#ifdef HORIZONTALBILLBOARD\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\t\t\tconst vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t\t\tconst vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\t\n\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\tfloat c = cos(rot);\n\t\t\tfloat s = sin(rot);\n\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\tcorner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\tcenter +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n\t\t#endif\n\t\n\t\t#ifdef VERTICALBILLBOARD\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\t\t\tconst vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n\t\t\tvec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\t\n\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\tfloat c = cos(rot);\n\t\t\tfloat s = sin(rot);\n\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\tcorner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\tcenter +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n\t\t#endif\n\t\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tvec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,-a_StartRotation0.x), age,normalizedAge);\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t\t#endif\t\t\n\t\t\t\t}\n\t\t\t#else\n\t\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t#endif\n\t\t\tv_MeshColor=a_MeshColor;\n\t\t#endif\n\t\n\t\tgl_Position=u_Projection*u_View*vec4(center,1.0);\n\t\tv_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t\t#ifdef DIFFUSEMAP\n\t\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t\t#endif\n\t\t\t#ifdef RENDERMODE_MESH\n\t\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t\t#endif\n\t\t\t\n\t\t\t#ifdef TILINGOFFSET\n\t\t\t\tv_TextureCoordinate=TransformUV(v_TextureCoordinate,u_TilingOffset);\n\t\t\t#endif\n\t\t#endif\n   \t}\n   \telse\n\t{\n\t\tgl_Position=vec4(2.0,2.0,2.0,1.0);//Discard use out of X(-1,1),Y(-1,1),Z(0,1)\n\t}\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\n',"#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}",n),e={a_Position:wa.MESH_POSITION0},t={u_TintColor:ca.PERIOD_MATERIAL,u_Exposure:ca.PERIOD_MATERIAL,u_Rotation:ca.PERIOD_MATERIAL,u_CubeTexture:ca.PERIOD_MATERIAL,u_ViewProjection:ca.PERIOD_CAMERA},i=ca.add("SkyBox"),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nuniform mat4 u_ViewProjection;\nuniform float u_Rotation;\nvarying vec3 v_Texcoord;\n\n\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\n{\n\tfloat angle = degrees * 3.141593 / 180.0;\n\tfloat sina=sin(angle);\n\tfloat cosa=cos(angle);\n\tmat2 m = mat2(cosa, -sina, sina, cosa);\n\treturn vec4(m*vertex.xz, vertex.yw).xzyw;\n}\n\t\t\nvoid main()\n{\n\tvec4 position=rotateAroundYInDegrees(a_Position,u_Rotation);\n\tgl_Position = u_ViewProjection*position;\n\tv_Texcoord=vec3(-a_Position.x,a_Position.yz);//转换坐标系\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n',"#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec3 v_Texcoord;\n\nuniform samplerCube u_CubeTexture;\nuniform float u_Exposure;\nuniform vec4 u_TintColor;\n\n\nvoid main()\n{\t\n\tvec3 color=textureCube(u_CubeTexture, v_Texcoord).rgb*u_TintColor.rgb*u_Exposure*2.0;\n\tgl_FragColor=vec4(color,1.0);\n}\n\n"),e={a_Position:wa.MESH_POSITION0},t={u_SunSize:ca.PERIOD_MATERIAL,u_SunSizeConvergence:ca.PERIOD_MATERIAL,u_AtmosphereThickness:ca.PERIOD_MATERIAL,u_SkyTint:ca.PERIOD_MATERIAL,u_GroundTint:ca.PERIOD_MATERIAL,u_Exposure:ca.PERIOD_MATERIAL,u_ViewProjection:ca.PERIOD_CAMERA,"u_SunLight.direction":ca.PERIOD_SCENE,"u_SunLight.color":ca.PERIOD_SCENE},i=ca.add("SkyBoxProcedural"),a=new ms(e,t),i.addSubShader(a),a.addShaderPass("#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include \"Lighting.glsl\";\n\n#define OUTER_RADIUS 1.025\n#define RAYLEIGH (mix(0.0, 0.0025, pow(u_AtmosphereThickness,2.5)))// Rayleigh constant Rayleigh为夜空光和极光亮度单位\n#define MIE 0.0010             // Mie constant 米氏散射\n#define SUN_BRIGHTNESS 20.0    // Sun brightness\n#define MAX_SCATTER 50.0 // Maximum scattering value, to prevent math overflows on Adrenos\n\nconst float SKY_GROUND_THRESHOLD = 0.02;\nconst float outerRadius = OUTER_RADIUS;\nconst float outerRadius2 = OUTER_RADIUS*OUTER_RADIUS;\nconst float innerRadius = 1.0;\nconst float innerRadius2 = 1.0;\nconst float cameraHeight = 0.0001;\n\nconst float HDSundiskIntensityFactor = 15.0;\nconst float simpleSundiskIntensityFactor = 27.0;\n\nconst float sunScale = 400.0 * SUN_BRIGHTNESS;\nconst float kmESun = MIE * SUN_BRIGHTNESS;\nconst float km4PI = MIE * 4.0 * 3.14159265;\nconst float scale = 1.0 / (OUTER_RADIUS - 1.0);\nconst float scaleDepth = 0.25;\nconst float scaleOverScaleDepth = (1.0 / (OUTER_RADIUS - 1.0)) / 0.25;\nconst float samples = 2.0; // THIS IS UNROLLED MANUALLY, DON'T TOUCH\n\n// RGB wavelengths        .35 (.62=158), .43 (.68=174), .525 (.75=190)\nconst vec3 c_DefaultScatteringWavelength = vec3(0.65, 0.57, 0.475);//默认散射波长\nconst vec3 c_VariableRangeForScatteringWavelength = vec3(0.15, 0.15, 0.15);//散射播放的可变范围\n\nattribute vec4 a_Position;\n\nuniform mat4 u_ViewProjection;\nuniform vec3 u_SkyTint;\nuniform vec3 u_GroundTint;\nuniform float u_Exposure;\nuniform float u_AtmosphereThickness;\nuniform DirectionLight u_SunLight;\n\nvarying vec3 v_GroundColor;\nvarying vec3 v_SkyColor;\n\n#ifdef SUN_HIGH_QUALITY\n\tvarying vec3 v_Vertex;\n#elif defined(SUN_SIMPLE)\n\tvarying vec3 v_RayDir;\n#else\n\tvarying float v_SkyGroundFactor;\n#endif\n\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\tvarying vec3 v_SunColor;\n#endif\n\n// Calculates the Rayleigh phase function\nfloat getRayleighPhase(vec3 light, vec3 ray) \n{\n\tfloat eyeCos = dot(light, ray);\n\treturn 0.75 + 0.75*eyeCos*eyeCos;\n}\n\nfloat scaleAngle(float inCos)\n{\n\tfloat x = 1.0 - inCos;\n\treturn 0.25 * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\n\nvoid main () {\n\tgl_Position = u_ViewProjection*a_Position;\n\n\tvec3 skyTintInGammaSpace = u_SkyTint;//支持非GAMMA空间后要调整\n\tvec3 scatteringWavelength = mix(c_DefaultScatteringWavelength-c_VariableRangeForScatteringWavelength,c_DefaultScatteringWavelength+c_VariableRangeForScatteringWavelength,vec3(1.0) - skyTintInGammaSpace); // using Tint in sRGB+ gamma allows for more visually linear interpolation and to keep (0.5) at (128, gray in sRGB) point\n\tvec3 invWavelength = 1.0 / pow(scatteringWavelength, vec3(4.0));\n\n\tfloat krESun = RAYLEIGH * SUN_BRIGHTNESS;\n\tfloat kr4PI = RAYLEIGH * 4.0 * 3.14159265;\n\n\tvec3 cameraPos = vec3(0.0,innerRadius + cameraHeight,0.0); // The camera's current position\n\n\t// Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n\tvec3 eyeRay = normalize(a_Position.xyz);\n\n\tfloat far = 0.0;\n\tvec3 cIn, cOut;\n\tif (eyeRay.y >= 0.0) {// Sky\n\t\t// Calculate the length of the \"atmosphere\"\n\t\tfar = sqrt(outerRadius2 + innerRadius2 * eyeRay.y * eyeRay.y - innerRadius2) - innerRadius * eyeRay.y;\n\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\n\t\tfloat height = innerRadius + cameraHeight;\n\t\tfloat depth = exp(scaleOverScaleDepth * -cameraHeight);\n\t\tfloat startAngle = dot(eyeRay, cameraPos) / height;\n\t\tfloat startOffset = depth*scaleAngle(startAngle);\n\n\t\t// Initialize the scattering loop variables\n\t\tfloat sampleLength = far / samples;\n\t\tfloat scaledLength = sampleLength * scale;\n\t\tvec3 sampleRay = eyeRay * sampleLength;\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\n\n\t\tvec3 frontColor = vec3(0.0);\n\t\t//unrolling this manually to avoid some platform for loop slow\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat lightAngle = dot(-u_SunLight.direction, samplePoint) / height;\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat lightAngle = dot(-u_SunLight.direction, samplePoint) / height;\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\n\t\t// Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n\t\tcIn = frontColor * (invWavelength * krESun);\n\t\tcOut = frontColor * kmESun;\n\t} else {// Ground\n\t\tfar = (-cameraHeight) / (min(-0.001, eyeRay.y));\n\t\tvec3 pos = cameraPos + far * eyeRay;\n\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\n\t\tfloat depth = exp((-cameraHeight) * (1.0/scaleDepth));\n\t\tfloat cameraAngle = dot(-eyeRay, pos);\n\t\tfloat lightAngle = dot(-u_SunLight.direction, pos);\n\t\tfloat cameraScale = scaleAngle(cameraAngle);\n\t\tfloat lightScale = scaleAngle(lightAngle);\n\t\tfloat cameraOffset = depth*cameraScale;\n\t\tfloat temp = lightScale + cameraScale;\n\n\t\t// Initialize the scattering loop variables\n\t\tfloat sampleLength = far / samples;\n\t\tfloat scaledLength = sampleLength * scale;\n\t\tvec3 sampleRay = eyeRay * sampleLength;\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\n\n\t\t// Now loop through the sample rays\n\t\tvec3 frontColor = vec3(0.0, 0.0, 0.0);\n\t\tvec3 attenuate;\n\n\t\t// Loop removed because we kept hitting SM2.0 temp variable limits. Doesn't affect the image too much.\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat scatter = depth*temp - cameraOffset;\n\t\t\tattenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\n\t\tcIn = frontColor * (invWavelength * krESun + kmESun);\n\t\tcOut = clamp(attenuate, 0.0, 1.0);\n\t}\n\n\t#ifdef SUN_HIGH_QUALITY\n\t\tv_Vertex = -a_Position.xyz;\n\t#elif defined(SUN_SIMPLE) \n\t\tv_RayDir = -eyeRay;\n\t#else\n\t\tv_SkyGroundFactor = -eyeRay.y / SKY_GROUND_THRESHOLD;\n\t#endif\n\n\t// if we want to calculate color in vprog:\n\t// in case of linear: multiply by _Exposure in here (even in case of lerp it will be common multiplier, so we can skip mul in fshader)\n\tv_GroundColor = u_Exposure * (cIn + u_GroundTint*u_GroundTint * cOut);//u_GroundColor*u_GroundColor is gamma space convert to linear space\n\tv_SkyColor    = u_Exposure * (cIn * getRayleighPhase(-u_SunLight.direction, -eyeRay));\n\n\t\n\t// The sun should have a stable intensity in its course in the sky. Moreover it should match the highlight of a purely specular material.\n\t// This matching was done using the Unity3D standard shader BRDF1 on the 5/31/2017\n\t// Finally we want the sun to be always bright even in LDR thus the normalization of the lightColor for low intensity.\n\tfloat lightColorIntensity = clamp(length(u_SunLight.color), 0.25, 1.0);\n\n\t#ifdef SUN_HIGH_QUALITY \n\t\tv_SunColor = HDSundiskIntensityFactor * clamp(cOut,0.0,1.0) * u_SunLight.color / lightColorIntensity;\n\t#elif defined(SUN_SIMPLE) \n\t\tv_SunColor = simpleSundiskIntensityFactor * clamp(cOut * sunScale,0.0,1.0) * u_SunLight.color / lightColorIntensity;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n",'#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nconst float MIE_G = -0.990;\nconst float MIE_G2 = 0.9801;\nconst float SKY_GROUND_THRESHOLD = 0.02;\n\nuniform float u_SunSize;\nuniform float u_SunSizeConvergence;\nuniform DirectionLight u_SunLight;\n\n\nvarying vec3 v_GroundColor;\nvarying vec3 v_SkyColor;\n\n\n#ifdef SUN_HIGH_QUALITY\n\tvarying vec3 v_Vertex;\n#elif defined(SUN_SIMPLE)\n\tvarying vec3 v_RayDir;\n#else\n\tvarying float v_SkyGroundFactor;\n#endif\n\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\tvarying vec3 v_SunColor;\n#endif\n\n// Calculates the Mie phase function\nfloat getMiePhase(float eyeCos, float eyeCos2) {\n\tfloat temp = 1.0 + MIE_G2 - 2.0 * MIE_G * eyeCos;\n\ttemp = pow(temp, pow(u_SunSize,0.65) * 10.0);\n\ttemp = max(temp,1.0e-4); // prevent division by zero, esp. in half precision\n\ttemp = 1.5 * ((1.0 - MIE_G2) / (2.0 + MIE_G2)) * (1.0 + eyeCos2) / temp;\n\treturn temp;\n}\n\n// Calculates the sun shape\nfloat calcSunAttenuation(vec3 lightPos, vec3 ray) {\n\t#ifdef SUN_HIGH_QUALITY\n\t\tfloat focusedEyeCos = pow(clamp(dot(lightPos, ray),0.0,1.0), u_SunSizeConvergence);\n\t\treturn getMiePhase(-focusedEyeCos, focusedEyeCos * focusedEyeCos);\n\t#else //SUN_SIMPLE\n\t\tvec3 delta = lightPos - ray;\n\t\tfloat dist = length(delta);\n\t\tfloat spot = 1.0 - smoothstep(0.0, u_SunSize, dist);\n\t\treturn spot * spot;\n\t#endif\n}\n\nvoid main() {\n\t// if y > 1 [eyeRay.y < -SKY_GROUND_THRESHOLD] - ground\n\t// if y >= 0 and < 1 [eyeRay.y <= 0 and > -SKY_GROUND_THRESHOLD] - horizon\n\t// if y < 0 [eyeRay.y > 0] - sky\n\tvec3 col = vec3(0.0, 0.0, 0.0);\n\n\t#ifdef SUN_HIGH_QUALITY\n\t\tvec3 ray = normalize(v_Vertex);\n\t\tfloat y = ray.y / SKY_GROUND_THRESHOLD;\n\t#elif defined(SUN_SIMPLE) \n\t\tvec3 ray = v_RayDir;\n\t\tfloat y = ray.y / SKY_GROUND_THRESHOLD;\t\n\t#else\n\t\tfloat y = v_SkyGroundFactor;\n\t#endif\n\n\t// if we did precalculate color in vprog: just do lerp between them\n\tcol = mix(v_SkyColor, v_GroundColor, clamp(y,0.0,1.0));\n\n\t#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\t\tif (y < 0.0)\n\t\t\tcol += v_SunColor * calcSunAttenuation(-u_SunLight.direction, -ray);\n\t#endif\n\n\tcol = sqrt(col);//linear space convert to gamma space\n\tgl_FragColor=vec4(col,1.0);\n}\n\n'),e={a_Position:wa.MESH_POSITION0,a_Normal:wa.MESH_NORMAL0,a_Texcoord0:wa.MESH_TEXTURECOORDINATE0},t={u_MvpMatrix:ca.PERIOD_SPRITE,u_WorldMat:ca.PERIOD_SPRITE,u_CameraPos:ca.PERIOD_CAMERA,u_LightmapScaleOffset:ca.PERIOD_SPRITE,u_LightMap:ca.PERIOD_SPRITE,u_SplatAlphaTexture:ca.PERIOD_MATERIAL,u_DiffuseTexture1:ca.PERIOD_MATERIAL,u_DiffuseTexture2:ca.PERIOD_MATERIAL,u_DiffuseTexture3:ca.PERIOD_MATERIAL,u_DiffuseTexture4:ca.PERIOD_MATERIAL,u_DiffuseTexture5:ca.PERIOD_MATERIAL,u_DiffuseScaleOffset1:ca.PERIOD_MATERIAL,u_DiffuseScaleOffset2:ca.PERIOD_MATERIAL,u_DiffuseScaleOffset3:ca.PERIOD_MATERIAL,u_DiffuseScaleOffset4:ca.PERIOD_MATERIAL,u_DiffuseScaleOffset5:ca.PERIOD_MATERIAL,u_FogStart:ca.PERIOD_SCENE,u_FogRange:ca.PERIOD_SCENE,u_FogColor:ca.PERIOD_SCENE,"u_DirectionLight.Direction":ca.PERIOD_SCENE,"u_DirectionLight.Color":ca.PERIOD_SCENE,"u_PointLight.Position":ca.PERIOD_SCENE,"u_PointLight.Range":ca.PERIOD_SCENE,"u_PointLight.Attenuation":ca.PERIOD_SCENE,"u_PointLight.Color":ca.PERIOD_SCENE,"u_SpotLight.Position":ca.PERIOD_SCENE,"u_SpotLight.Direction":ca.PERIOD_SCENE,"u_SpotLight.Range":ca.PERIOD_SCENE,"u_SpotLight.Spot":ca.PERIOD_SCENE,"u_SpotLight.Color":ca.PERIOD_SCENE,u_AmbientColor:ca.PERIOD_SCENE,u_shadowMap1:ca.PERIOD_SCENE,u_shadowMap2:ca.PERIOD_SCENE,u_shadowMap3:ca.PERIOD_SCENE,u_shadowPSSMDistance:ca.PERIOD_SCENE,u_lightShadowVP:ca.PERIOD_SCENE,u_shadowPCFoffset:ca.PERIOD_SCENE},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("ExtendTerrain"),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform vec4 u_LightmapScaleOffset;\n#endif\n\n#ifdef RECEIVESHADOW\n\tvarying float v_posViewZ;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n#endif\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n  \n\tv_Texcoord0 = a_Texcoord0;\n  \n\t#ifdef LIGHTMAP\n\t\tv_LightMapUV = vec2(a_Texcoord0.x, 1.0 - a_Texcoord0.y) * u_LightmapScaleOffset.xy + u_LightmapScaleOffset.zw;\n\t\tv_LightMapUV.y = 1.0 - v_LightMapUV.y;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_Normal = a_Normal;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\nuniform vec3 u_AmbientColor;\n\nuniform sampler2D u_SplatAlphaTexture;\n\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform sampler2D u_DiffuseTexture5;\n\nuniform vec4 u_DiffuseScaleOffset1;\nuniform vec4 u_DiffuseScaleOffset2;\nuniform vec4 u_DiffuseScaleOffset3;\nuniform vec4 u_DiffuseScaleOffset4;\nuniform vec4 u_DiffuseScaleOffset5;\n\nvarying vec2 v_Texcoord0;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n\tvec4 splatAlpha = vec4(1.0);\n\t#ifdef ExtendTerrain_DETAIL_NUM1\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r;\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM2\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM3\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM4\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM5\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tvec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\n\t#endif\n\t\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = v_Normal;\n\tvec3 dif, spe;\n#endif\n\nvec3 diffuse = vec3(0.0);\nvec3 specular= vec3(0.0);\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tLayaAirBlinnPhongDiectionLight(vec3(0.0), 1.0, normal, vec3(1.0), toEye,u_DirectionLight, dif, spe);\n\tdiffuse+=dif;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tLayaAirBlinnPhongPointLight(v_PositionWorld, vec3(0.0), 1.0, normal, vec3(1.0), toEye, u_PointLight, dif, spe);\n\tdiffuse+=dif;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tLayaAirBlinnPhongSpotLight(v_PositionWorld, vec3(0.0), 1.0, normal, vec3(1.0), toEye, u_SpotLight, dif, spe);\n\tdiffuse+=dif;\n\tspecular+=spe;\n#endif\n\nvec3 globalDiffuse = u_AmbientColor;\n#ifdef LIGHTMAP\n\tglobalDiffuse += DecodeLightmap(texture2D(u_LightMap, v_LightMapUV));\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n\tgl_FragColor = vec4(gl_FragColor.rgb * (globalDiffuse + diffuse) * shadowValue, gl_FragColor.a);\n#else\n\tgl_FragColor = vec4(gl_FragColor.rgb * (globalDiffuse + diffuse), gl_FragColor.a);\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor.rgb += specular * shadowValue;\n\t#else\n\t\tgl_FragColor.rgb += specular;\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n\n\n\n\n',n),e={a_Position:uh.TRAIL_POSITION0,a_OffsetVector:uh.TRAIL_OFFSETVECTOR,a_Texcoord0X:uh.TRAIL_TEXTURECOORDINATE0X,a_Texcoord0Y:uh.TRAIL_TEXTURECOORDINATE0Y,a_BirthTime:uh.TRAIL_TIME0,a_Color:uh.TRAIL_COLOR},t={u_MvpMatrix:ca.PERIOD_SPRITE,u_View:ca.PERIOD_CAMERA,u_Projection:ca.PERIOD_CAMERA,u_TilingOffset:ca.PERIOD_MATERIAL,u_MainTexture:ca.PERIOD_MATERIAL,u_MainColor:ca.PERIOD_MATERIAL,u_CurTime:ca.PERIOD_SPRITE,u_LifeTime:ca.PERIOD_SPRITE,u_WidthCurve:ca.PERIOD_SPRITE,u_WidthCurveKeyLength:ca.PERIOD_SPRITE,u_GradientColorkey:ca.PERIOD_SPRITE,u_GradientAlphakey:ca.PERIOD_SPRITE},n={s_Cull:ca.RENDER_STATE_CULL,s_Blend:ca.RENDER_STATE_BLEND,s_BlendSrc:ca.RENDER_STATE_BLEND_SRC,s_BlendDst:ca.RENDER_STATE_BLEND_DST,s_DepthTest:ca.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ca.RENDER_STATE_DEPTH_WRITE},i=ca.add("Trail"),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec3 a_Position;\nattribute vec3 a_OffsetVector;\nattribute vec4 a_Color;\nattribute float a_Texcoord0X;\nattribute float a_Texcoord0Y;\nattribute float a_BirthTime;\n\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\nuniform vec4 u_TilingOffset;\n\nuniform float u_CurTime;\nuniform float u_LifeTime;\nuniform vec4 u_WidthCurve[10];\nuniform int u_WidthCurveKeyLength;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\n{\n\tfloat t2 = t * t;\n\tfloat t3 = t2 * t;\n\tfloat a = 2.0 * t3 - 3.0 * t2 + 1.0;\n\tfloat b = t3 - 2.0 * t2 + t;\n\tfloat c = t3 - t2;\n\tfloat d = -2.0 * t3 + 3.0 * t2;\n\treturn a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\n}\n\nfloat getCurWidth(in float normalizeTime)\n{\n\tfloat width;\n\tif(normalizeTime == 0.0){\n\t\twidth=u_WidthCurve[0].w;\n\t}\n\telse if(normalizeTime >= 1.0){\n\t\twidth=u_WidthCurve[u_WidthCurveKeyLength - 1].w;\n\t}\n\telse{\n\t\tfor(int i = 0; i < 10; i ++ )\n\t\t{\n\t\t\tif(normalizeTime == u_WidthCurve[i].x){\n\t\t\t\twidth=u_WidthCurve[i].w;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tvec4 lastFrame = u_WidthCurve[i];\n\t\t\tvec4 nextFrame = u_WidthCurve[i + 1];\n\t\t\tif(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\n\t\t\t{\n\t\t\t\tfloat duration = nextFrame.x - lastFrame.x;\n\t\t\t\tfloat t = (normalizeTime - lastFrame.x) / duration;\n\t\t\t\tfloat outTangent = lastFrame.z;\n\t\t\t\tfloat inTangent = nextFrame.y;\n\t\t\t\tfloat value1 = lastFrame.w;\n\t\t\t\tfloat value2 = nextFrame.w;\n\t\t\t\twidth=hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn width;\n}\t\n\nvoid main()\n{\n\tfloat normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, 1.0 - a_Texcoord0Y) * u_TilingOffset.xy + u_TilingOffset.zw;\n\t#else\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\n\t#endif\n\t\n\tv_Color = a_Color;\n\t\n\tgl_Position = u_Projection * u_View * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n',"#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTexture;\nuniform vec4 u_MainColor;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nvoid main()\n{\n\tvec4 color = 2.0 * u_MainColor * v_Color;\n\t#ifdef MAINTEXTURE\n\t\tvec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\n\t\tcolor *= mainTextureColor;\n\t#endif\n\tgl_FragColor = color;\n}\n\n     ",n),e={a_Position:wa.MESH_POSITION0,a_Normal:wa.MESH_NORMAL0,a_Tangent0:wa.MESH_TANGENT0},t={u_MvpMatrix:ca.PERIOD_SPRITE,u_WorldMat:ca.PERIOD_SPRITE,u_CameraPos:ca.PERIOD_CAMERA,u_Time:ca.PERIOD_SCENE,u_MainTexture:ca.PERIOD_MATERIAL,u_NormalTexture:ca.PERIOD_MATERIAL,u_HorizonColor:ca.PERIOD_MATERIAL,u_WaveScale:ca.PERIOD_MATERIAL,u_WaveSpeed:ca.PERIOD_MATERIAL},i=ca.add("WaterPrimary"),a=new ms(e,t),i.addSubShader(a),a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\nuniform float u_WaveScale;\nuniform vec4 u_WaveSpeed;\nuniform float u_Time;\n\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\nvoid main()\n{\n\tvec4 positionWorld = u_WorldMat * a_Position;\n\tvec4 position = u_MvpMatrix * a_Position;\n\t\n\tvec4 temp = vec4(positionWorld.x, positionWorld.z, positionWorld.x, positionWorld.z) * u_WaveScale + u_WaveSpeed * u_WaveScale * u_Time;\n\t\n\tv_Texcoord0 = temp.xy * vec2(0.4, 0.45);\n\tv_Texcoord1 = temp.wz;\n\t\n\tmat3 worldMat = mat3(u_WorldMat);\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n\t\n\tv_ViewDir = u_CameraPos - positionWorld.xyz;\n\tgl_Position = position;\n\tgl_Position=remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#ifdef MAINTEXTURE\n\tuniform sampler2D u_MainTexture;\n#endif\n\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n#endif\n\nuniform vec4 u_HorizonColor;\n\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n#include "Lighting.glsl"\n\nvoid main()\n{\n\tvec4 bumpColor1 = texture2D(u_NormalTexture, v_Texcoord0);\n\tvec4 bumpColor2 = texture2D(u_NormalTexture, v_Texcoord1);\n\t\n\tvec3 normal1 = NormalSampleToWorldSpace1(bumpColor1, v_Tangent, v_Binormal, v_Normal);\n\tvec3 normal2 = NormalSampleToWorldSpace1(bumpColor2, v_Tangent, v_Binormal, v_Normal);\n\t\n\tvec3 normal = normalize((normal1 + normal2) * 0.5);\n\tvec3 viewDir = normalize(v_ViewDir);\n\tfloat fresnel = dot(viewDir, normal);\n\t\n\tvec4 waterColor = texture2D(u_MainTexture, vec2(fresnel, fresnel));\n\t\n\tvec4 color;\n\tcolor.rgb = mix(waterColor.rgb, u_HorizonColor.rgb, vec3(waterColor.a));\n\tcolor.a = u_HorizonColor.a;\n\t\n\tgl_FragColor = color;\n}\n\n'),e={a_PositionTexcoord:wa.MESH_POSITION0},t={u_MainTex:ca.PERIOD_MATERIAL},i=ca.add("BlitScreen"),a=new ms(e,t),i.addSubShader(a);var r=a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}',"#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTex;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_FragColor = texture2D(u_MainTex, v_Texcoord0);\n}\n\n"),n=r.renderState;n.depthTest=ur.DEPTHTEST_ALWAYS,n.depthWrite=!1,n.cull=ur.CULL_NONE,n.blend=ur.BLEND_DISABLE,e={a_PositionTexcoord:wa.MESH_POSITION0},t={u_MainTex:ca.PERIOD_MATERIAL,u_BloomTex:ca.PERIOD_MATERIAL,u_AutoExposureTex:ca.PERIOD_MATERIAL,u_MainTex_TexelSize:ca.PERIOD_MATERIAL,u_SampleScale:ca.PERIOD_MATERIAL,u_Threshold:ca.PERIOD_MATERIAL,u_Params:ca.PERIOD_MATERIAL},i=ca.add("PostProcessBloom"),a=new ms(e,t),i.addSubShader(a),(n=a.addShaderPass(kh,'#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_AutoExposureTex;\nuniform vec4 u_MainTex_TexelSize;\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\nuniform vec4 u_Params; // x: clamp, yzw: unused\n\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\n\tcolor *= autoExposure;\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\n\treturn color;\n}\n\nvoid fragPrefilter13() {\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\n}\n\nvoid main() {\n\tfragPrefilter13();\n}').renderState).depthTest=ur.DEPTHTEST_ALWAYS,n.depthWrite=!1,n.cull=ur.CULL_NONE,n.blend=ur.BLEND_DISABLE,a=new ms(e,t),i.addSubShader(a),(n=a.addShaderPass(kh,'#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_AutoExposureTex;\nuniform vec4 u_MainTex_TexelSize;\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\nuniform vec4 u_Params; // x: clamp, yzw: unused\n\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\n\tcolor *= autoExposure;\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\n\treturn color;\n}\n\nvoid fragPrefilter4() {\n\tmediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\n}\n\nvoid main() {\n\tfragPrefilter4();\n}').renderState).depthTest=ur.DEPTHTEST_ALWAYS,n.depthWrite=!1,n.cull=ur.CULL_NONE,n.blend=ur.BLEND_DISABLE,a=new ms(e,t),i.addSubShader(a),(n=a.addShaderPass(kh,'#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform vec4 u_MainTex_TexelSize;\n\nvoid fragDownsample13() {\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = color;\n}\n\nvoid main() {\n\tfragDownsample13();\n}').renderState).depthTest=ur.DEPTHTEST_ALWAYS,n.depthWrite=!1,n.cull=ur.CULL_NONE,n.blend=ur.BLEND_DISABLE,a=new ms(e,t),i.addSubShader(a),(n=a.addShaderPass(kh,'#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform vec4 u_MainTex_TexelSize;\n\nvoid fragDownsample4() {\n\tmediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = color;\n}\n\nvoid main() {\n\tfragDownsample4();\n}').renderState).depthTest=ur.DEPTHTEST_ALWAYS,n.depthWrite=!1,n.cull=ur.CULL_NONE,n.blend=ur.BLEND_DISABLE,a=new ms(e,t),i.addSubShader(a),(n=a.addShaderPass(kh,'#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform vec4 u_MainTex_TexelSize;\nuniform float u_SampleScale;\n\nmediump vec4 combine(mediump vec4 bloom, vec2 uv) {\n\tmediump vec4 color = texture2D(u_BloomTex, uv);\n\treturn bloom + color;\n}\n\nvoid fragUpsampleTent() {\n\tmediump vec4 bloom = upsampleTent(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\n\tgl_FragColor = combine(bloom, v_Texcoord0);\n}\n\nvoid main() {\n\tfragUpsampleTent();\n}').renderState).depthTest=ur.DEPTHTEST_ALWAYS,n.depthWrite=!1,n.cull=ur.CULL_NONE,n.blend=ur.BLEND_DISABLE,a=new ms(e,t),i.addSubShader(a),(n=a.addShaderPass(kh,'#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform vec4 u_MainTex_TexelSize;\nuniform float u_SampleScale;\n\nmediump vec4 combine(mediump vec4 bloom, vec2 uv) {\n\tmediump vec4 color = texture2D(u_BloomTex, uv);\n\treturn bloom + color;\n}\n\nvoid fragUpsampleBox() {\n\tmediump vec4 bloom = upsampleBox(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\n\tgl_FragColor = combine(bloom, v_Texcoord0);\n}\n\nvoid main() {\n\tfragUpsampleBox();\n}').renderState).depthTest=ur.DEPTHTEST_ALWAYS,n.depthWrite=!1,n.cull=ur.CULL_NONE,n.blend=ur.BLEND_DISABLE,e={a_PositionTexcoord:wa.MESH_POSITION0},t={u_MainTex:ca.PERIOD_MATERIAL,u_BloomTex:ca.PERIOD_MATERIAL,u_AutoExposureTex:ca.PERIOD_MATERIAL,u_Bloom_DirtTileOffset:ca.PERIOD_MATERIAL,u_Bloom_DirtTex:ca.PERIOD_MATERIAL,u_BloomTex_TexelSize:ca.PERIOD_MATERIAL,u_Bloom_Settings:ca.PERIOD_MATERIAL,u_Bloom_Color:ca.PERIOD_MATERIAL},i=ca.add("PostProcessComposite"),a=new ms(e,t),i.addSubShader(a),(n=a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform sampler2D u_AutoExposureTex;\nuniform sampler2D u_Bloom_DirtTex;\nuniform vec4 u_BloomTex_TexelSize;\nuniform vec4 u_Bloom_DirtTileOffset; // xy: tiling, zw: offset\nuniform mediump vec3 u_Bloom_Settings;// x: sampleScale, y: intensity, z: dirt intensity\nuniform mediump vec3 u_Bloom_Color;\n\nvoid main() {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, v_Texcoord0).r;\n\tmediump vec4 color=vec4(0.0);\n\tcolor = texture2D(u_MainTex, v_Texcoord0);\n\t\n\tcolor = sRGBToLinear(color);\n\tcolor.rgb *= autoExposure;\n\t\n\t#if defined(BLOOM)||defined(BLOOM_LOW)\n\t\t#ifdef BLOOM\n\t\t\tmediump vec4 bloom = upsampleTent(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\n\t\t#else\n\t\t\tmediump vec4 bloom = upsampleBox(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\n\t\t#endif\n\n\t\t// UVs should be Distort(uv * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw)\n\t\t// but considering we use a cover-style scale on the dirt texture the difference\n\t\t// isn\'t massive so we chose to save a few ALUs here instead in case lens distortion\n\t\t// is active\n\t\tmediump vec4 dirt =vec4(texture2D(u_Bloom_DirtTex, v_Texcoord0 * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw).rgb, 0.0);\n\n\t\t// Additive bloom (artist friendly)\n\t\tbloom *= u_Bloom_Settings.y;\n\t\tdirt *= u_Bloom_Settings.z;\n\t\tmediump vec4 bloomColor=vec4(u_Bloom_Color, 1.0);\n\t\tcolor += bloom * bloomColor;\n\t\tcolor += dirt * bloom;\n\t#endif\n\t\n\tmediump vec4 finalColor = color;\n\tfinalColor = linearToSRGB(finalColor);\n\t//finalColor.rgb = Dither(finalColor.rgb, v_Texcoord0);//TODO:抖动\n\tgl_FragColor = finalColor;\n}').renderState).depthTest=ur.DEPTHTEST_ALWAYS,n.depthWrite=!1,n.cull=ur.CULL_NONE,n.blend=ur.BLEND_DISABLE}}]),e}(),Eh=function(){function d(){var e;for(S(this,d),this._spiltDistance=[],this._currentPSSM=-1,this._shadowMapCount=3,this._maxDistance=200,this._ratioOfDistance=1/this._shadowMapCount,this._globalParallelLightDir=new vn(0,-1,0),this._statesDirty=!0,this._shadowMapTextureSize=1024,this._scene=null,this._boundingSphere=new Array(d.MAX_PSSM_COUNT+1),this._boundingBox=new Array(d.MAX_PSSM_COUNT+1),this._frustumPos=new Array(4*(d.MAX_PSSM_COUNT+1)),this._uniformDistance=new Array(d.MAX_PSSM_COUNT+1),this._logDistance=new Array(d.MAX_PSSM_COUNT+1),this._dimension=new Array(d.MAX_PSSM_COUNT+1),this._PCFType=0,this._tempLookAt3=new vn,this._tempLookAt4=new yn,this._tempValue=new yn,this._tempPos=new vn,this._tempLightUp=new vn,this._tempMin=new yn,this._tempMax=new yn,this._tempMatrix44=new ki,this._splitFrustumCulling=new Fa(ki.DEFAULT),this._tempScaleMatrix44=new ki,this._shadowPCFOffset=new gn(1/1024,1/1024),this._shaderValueDistance=new yn,this._shaderValueLightVP=null,this.cameras=[],this._shaderValueVPs=[],e=0;e<this._spiltDistance.length;e++)this._spiltDistance[e]=0;for(e=0;e<this._dimension.length;e++)this._dimension[e]=new gn;for(e=0;e<this._frustumPos.length;e++)this._frustumPos[e]=new vn;for(e=0;e<this._boundingBox.length;e++)this._boundingBox[e]=new cr(new vn,new vn);for(e=0;e<this._boundingSphere.length;e++)this._boundingSphere[e]=new Ll(new vn,0);ki.createScaling(new vn(.5,.5,1),this._tempScaleMatrix44),this._tempScaleMatrix44.elements[12]=.5,this._tempScaleMatrix44.elements[13]=.5}return C(d,[{key:"setInfo",value:function(e,t,n,i,a,r){d.MAX_PSSM_COUNT<a&&(this._shadowMapCount=d.MAX_PSSM_COUNT),this._scene=e,this._maxDistance=t,this.shadowMapCount=a,this._globalParallelLightDir=n,this._ratioOfDistance=1/this._shadowMapCount;for(var o=0;o<this._spiltDistance.length;o++)this._spiltDistance[o]=0;this._shadowMapTextureSize=i,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this.setPCFType(r),this._statesDirty=!0}},{key:"setPCFType",value:function(e){this._PCFType=e;var t=this._scene._shaderValues;switch(this._PCFType){case 0:t.addDefine(nr.SHADERDEFINE_SHADOW_PCF_NO),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF1),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF2),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF3);break;case 1:t.addDefine(nr.SHADERDEFINE_SHADOW_PCF1),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF_NO),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF2),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF3);break;case 2:t.addDefine(nr.SHADERDEFINE_SHADOW_PCF2),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF_NO),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF1),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF3);break;case 3:t.addDefine(nr.SHADERDEFINE_SHADOW_PCF3),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF_NO),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF1),t.removeDefine(nr.SHADERDEFINE_SHADOW_PCF2)}}},{key:"getPCFType",value:function(){return this._PCFType}},{key:"setFarDistance",value:function(e){this._maxDistance!=e&&(this._maxDistance=e,this._statesDirty=!0)}},{key:"getFarDistance",value:function(){return this._maxDistance}},{key:"_beginSampler",value:function(e,t){if(e<0||e>this._shadowMapCount)throw new Error("ParallelSplitShadowMap: beginSample invalid index");this._currentPSSM=e,this._update(t)}},{key:"endSampler",value:function(e){this._currentPSSM=-1}},{key:"_calcAllLightCameraInfo",value:function(e){if(1===this._shadowMapCount)this._beginSampler(0,e),this.endSampler(e);else for(var t=0,n=this._shadowMapCount+1;t<n;t++)this._beginSampler(t,e),this.endSampler(e)}},{key:"_recalculate",value:function(e,t,n){this._calcSplitDistance(e),this._calcBoundingBox(t,n),this._rebuildRenderInfo()}},{key:"_update",value:function(e){var t=e.nearPlane,n=e.fieldOfView,i=e.aspectRatio;!this._statesDirty&&this.lastNearPlane===t&&this.lastFieldOfView===n&&this.lastAspectRatio===i||(this._recalculate(t,n,i),this._uploadShaderValue(),this._statesDirty=!1,this.lastNearPlane=t,this.lastFieldOfView=n,this.lastAspectRatio=i),this._calcLightViewProject(e)}},{key:"_uploadShaderValue",value:function(){var e=this._scene._shaderValues;switch(this._shadowMapCount){case 1:e.addDefine(nr.SHADERDEFINE_SHADOW_PSSM1),e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM2),e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM3);break;case 2:e.addDefine(nr.SHADERDEFINE_SHADOW_PSSM2),e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM1),e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM3);break;case 3:e.addDefine(nr.SHADERDEFINE_SHADOW_PSSM3),e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM1),e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM2)}switch(e.setVector(wi.Scene3D.SHADOWDISTANCE,this._shaderValueDistance),e.setBuffer(wi.Scene3D.SHADOWLIGHTVIEWPROJECT,this._shaderValueLightVP),e.setVector2(wi.Scene3D.SHADOWMAPPCFOFFSET,this._shadowPCFOffset),this._shadowMapCount){case 3:e.setTexture(wi.Scene3D.SHADOWMAPTEXTURE1,this.cameras[1].renderTarget),e.setTexture(wi.Scene3D.SHADOWMAPTEXTURE2,this.cameras[2].renderTarget),e.setTexture(wi.Scene3D.SHADOWMAPTEXTURE3,this.cameras[3].renderTarget);break;case 2:e.setTexture(wi.Scene3D.SHADOWMAPTEXTURE1,this.cameras[1].renderTarget),e.setTexture(wi.Scene3D.SHADOWMAPTEXTURE2,this.cameras[2].renderTarget);break;case 1:e.setTexture(wi.Scene3D.SHADOWMAPTEXTURE1,this.cameras[1].renderTarget)}}},{key:"_calcSplitDistance",value:function(e){for(var t=this._maxDistance,n=1/this._shadowMapCount,i=0;i<=this._shadowMapCount;i++)this._uniformDistance[i]=e+(t-e)*i*n;var a=t/e;for(i=0;i<=this._shadowMapCount;i++){var r=Math.pow(a,i*n);this._logDistance[i]=e*r}for(i=0;i<=this._shadowMapCount;i++)this._spiltDistance[i]=this._uniformDistance[i]*this._ratioOfDistance+this._logDistance[i]*(1-this._ratioOfDistance);this._shaderValueDistance.x=null!=this._spiltDistance[1]&&this._spiltDistance[1],this._shaderValueDistance.y=null!=this._spiltDistance[2]&&this._spiltDistance[2],this._shaderValueDistance.z=null!=this._spiltDistance[3]&&this._spiltDistance[3],this._shaderValueDistance.w=null!=this._spiltDistance[4]&&this._spiltDistance[4]}},{key:"_calcBoundingBox",value:function(e,t){for(var n,i,a,r,o,s,l,e=3.1415926*e/180,h=Math.tan(e/2),u=0;u<=this._shadowMapCount;u++){i=(n=(a=this._spiltDistance[u])*h)*t;var d=this._frustumPos[4*u+0];d.x=-i,d.y=-n,d.z=-a,(d=this._frustumPos[4*u+1]).x=i,d.y=-n,d.z=-a,(d=this._frustumPos[4*u+2]).x=-i,d.y=n,d.z=-a,(d=this._frustumPos[4*u+3]).x=i,d.y=n,d.z=-a,(d=this._dimension[u]).x=i,d.y=n}for(u=1;u<=this._shadowMapCount;u++)r=this._dimension[u],(o=this._boundingBox[u].min).x=-r.x,o.y=-r.y,o.z=-this._spiltDistance[u],(s=this._boundingBox[u].max).x=r.x,s.y=r.y,s.z=-this._spiltDistance[u-1],(l=this._boundingSphere[u].center).x=.5*(o.x+s.x),l.y=.5*(o.y+s.y),l.z=.5*(o.z+s.z),this._boundingSphere[u].radius=.5*Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2)+Math.pow(s.z-o.z,2));o=this._boundingBox[0].min,r=this._dimension[this._shadowMapCount],o.x=-r.x,o.y=-r.y,o.z=-this._spiltDistance[this._shadowMapCount],(s=this._boundingBox[0].max).x=r.x,s.y=r.y,s.z=-this._spiltDistance[0],(l=this._boundingSphere[0].center).x=.5*(o.x+s.x),l.y=.5*(o.y+s.y),l.z=.5*(o.z+s.z),this._boundingSphere[0].radius=.5*Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2)+Math.pow(s.z-o.z,2))}},{key:"calcSplitFrustum",value:function(e){0<this._currentPSSM?ki.createPerspective(3.1416*e.fieldOfView/180,e.aspectRatio,this._spiltDistance[this._currentPSSM-1],this._spiltDistance[this._currentPSSM],this._tempMatrix44):ki.createPerspective(3.1416*e.fieldOfView/180,e.aspectRatio,this._spiltDistance[0],this._spiltDistance[this._shadowMapCount],this._tempMatrix44),ki.multiply(this._tempMatrix44,e.viewMatrix,this._tempMatrix44),this._splitFrustumCulling.matrix=this._tempMatrix44}},{key:"_rebuildRenderInfo",value:function(){var e,t=this._shadowMapCount+1;for(this.cameras.length=t,e=0;e<t;e++){this.cameras[e]||((n=new ir).name="lightCamera"+e,n.clearColor=new yn(1,1,1,1),this.cameras[e]=n);var n=this.cameras[e].renderTarget;null!=n&&n.width==this._shadowMapTextureSize&&n.height==this._shadowMapTextureSize||(n&&n.destroy(),(n=new Va(this._shadowMapTextureSize,this._shadowMapTextureSize,H.R8G8B8A8,Y.DEPTH_16)).filterMode=U.FILTERMODE_POINT,this.cameras[e].renderTarget=n)}}},{key:"_calcLightViewProject",value:function(e){var t=this._boundingSphere[this._currentPSSM],n=e.transform.worldMatrix;t.radius;t.center.cloneTo(this._tempLookAt3),vn.transformV3ToV4(this._tempLookAt3,n,this._tempLookAt4);var i=this._tempLookAt3,a=this._tempLookAt4;i.x=a.x,i.y=a.y,i.z=a.z;a=this._tempLightUp;e.transform.worldMatrix.getForward(d._tempVector30);e=d._tempVector30;a.x=e.x,a.y=1,a.z=e.z,vn.normalize(this._tempLightUp,this._tempLightUp),vn.scale(this._globalParallelLightDir,4*t.radius,this._tempPos),vn.subtract(this._tempLookAt3,this._tempPos,this._tempPos);e=this.cameras[this._currentPSSM];e.transform.position=this._tempPos,e.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1);var r=this._tempMax,o=this._tempMin;r.x=r.y=r.z=-1e5,r.w=1,o.x=o.y=o.z=1e5,o.w=1,ki.multiply(e.viewMatrix,n,this._tempMatrix44);var s=this._tempValue,l=[];l.length=8,this._boundingBox[this._currentPSSM].getCorners(l);for(var h=0;h<8;h++){var u=l[h];s.x=u.x,s.y=u.y,s.z=u.z,s.w=1,yn.transformByM4x4(this._tempValue,this._tempMatrix44,this._tempValue),o.x=(s.x<o.x?s:o).x,o.y=(s.y<o.y?s:o).y,o.z=(s.z<o.z?s:o).z,r.x=(s.x>r.x?s:r).x,r.y=(s.y>r.y?s:r).y,r.z=(s.z>r.z?s:r).z}yn.add(this._tempMax,this._tempMin,this._tempValue),s.x*=.5,s.y*=.5,s.z*=.5,s.w=1,yn.transformByM4x4(this._tempValue,e.transform.worldMatrix,this._tempValue);t=Math.abs(-this._tempMax.z),n=t>this._maxDistance?t:this._maxDistance;vn.scale(this._globalParallelLightDir,n,this._tempPos);t=this._tempPos;t.x=s.x-t.x,t.y=s.y-t.y,t.z=s.z-t.z,e.transform.position=this._tempPos,e.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1),ki.createOrthoOffCenter(o.x,r.x,o.y,r.y,1,n+.5*(r.z-o.z),e.projectionMatrix);e=e.projectionViewMatrix;d.multiplyMatrixOutFloat32Array(this._tempScaleMatrix44,e,this._shaderValueVPs[this._currentPSSM]),this._scene._shaderValues.setBuffer(wi.Scene3D.SHADOWLIGHTVIEWPROJECT,this._shaderValueLightVP)}},{key:"setShadowMapTextureSize",value:function(e){e!==this._shadowMapTextureSize&&(this._shadowMapTextureSize=e,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this._statesDirty=!0)}},{key:"disposeAllRenderTarget",value:function(){for(var e=0,t=this._shadowMapCount+1;e<t;e++)this.cameras[e].renderTarget&&(this.cameras[e].renderTarget.destroy(),this.cameras[e].renderTarget=null)}},{key:"shadowMapCount",set:function(e){if(e=(e=0<e?e:1)<=d.MAX_PSSM_COUNT?e:d.MAX_PSSM_COUNT,this._shadowMapCount!=e){this._shadowMapCount=e,this._ratioOfDistance=1/this._shadowMapCount,this._statesDirty=!0,this._shaderValueLightVP=new Float32Array(16*e),this._shaderValueVPs.length=e;for(var t=0;t<e;t++)this._shaderValueVPs[t]=new Float32Array(this._shaderValueLightVP.buffer,64*t)}},get:function(){return this._shadowMapCount}}],[{key:"multiplyMatrixOutFloat32Array",value:function(e,t,n){for(var i,a,r,o,s=e.elements,l=t.elements,h=0;h<4;h++)i=s[h],a=s[h+4],r=s[h+8],o=s[h+12],n[h]=i*l[0]+a*l[1]+r*l[2]+o*l[3],n[h+4]=i*l[4]+a*l[5]+r*l[6]+o*l[7],n[h+8]=i*l[8]+a*l[9]+r*l[10]+o*l[11],n[h+12]=i*l[12]+a*l[13]+r*l[14]+o*l[15]}}]),d}();Eh.MAX_PSSM_COUNT=3,Eh._tempVector30=new vn;var Mh=function(){T(n,fa);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._isAlternate=!1,e._intensity=1,e._intensityColor=new vn,e.color=new vn(1,1,1),e._shadow=!1,e._shadowFarPlane=8,e._shadowMapSize=512,e._shadowMapCount=1,e._shadowMapPCFType=0,e._lightmapBakedType=n.LIGHTMAPBAKEDTYPE_REALTIME,e}return C(n,[{key:"_parse",value:function(e,t){G(z(n.prototype),"_parse",this).call(this,e,t);t=e.color;this.color.fromArray(t),this.intensity=e.intensity,this.lightmapBakedType=e.lightmapBakedType}},{key:"_addToScene",value:function(){var e=this._scene,t=ha._config.maxLightCount;e._lightCount<t?(e._lightCount++,this._addToLightQueue(),this._isAlternate=!0):(e._alternateLights.add(this),this._isAlternate=!1,console.warn("LightSprite:light count has large than maxLightCount,the latest added light will be ignore."))}},{key:"_removeFromScene",value:function(){var e,t=this._scene;this._isAlternate?t._alternateLights.remove(this):(t._lightCount--,this._removeFromLightQueue(),0<t._alternateLights._length&&((e=t._alternateLights.shift())._addToLightQueue(),e._isAlternate=!1,t._lightCount++))}},{key:"_addToLightQueue",value:function(){}},{key:"_removeFromLightQueue",value:function(){}},{key:"_onActive",value:function(){G(z(n.prototype),"_onActive",this).call(this),this.lightmapBakedType!==n.LIGHTMAPBAKEDTYPE_BAKED&&this._addToScene()}},{key:"_onInActive",value:function(){G(z(n.prototype),"_onInActive",this).call(this),this.lightmapBakedType!==n.LIGHTMAPBAKEDTYPE_BAKED&&this._removeFromScene()}},{key:"_create",value:function(){return new n}},{key:"intensity",get:function(){return this._intensity},set:function(e){this._intensity=e}},{key:"shadow",get:function(){return this._shadow},set:function(e){throw new Error("LightSprite: must override it.")}},{key:"shadowDistance",get:function(){return this._shadowFarPlane},set:function(e){this._shadowFarPlane=e,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setFarDistance(e)}},{key:"shadowResolution",get:function(){return this._shadowMapSize},set:function(e){this._shadowMapSize=e,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setShadowMapTextureSize(e)}},{key:"shadowPSSMCount",get:function(){return this._shadowMapCount},set:function(e){this._shadowMapCount=e,this._parallelSplitShadowMap&&(this._parallelSplitShadowMap.shadowMapCount=e)}},{key:"shadowPCFType",get:function(){return this._shadowMapPCFType},set:function(e){this._shadowMapPCFType=e,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setPCFType(e)}},{key:"lightmapBakedType",get:function(){return this._lightmapBakedType},set:function(e){this._lightmapBakedType!==e&&(this._lightmapBakedType=e,this.activeInHierarchy&&(e!==n.LIGHTMAPBAKEDTYPE_BAKED?this._addToScene():this._removeFromScene()))}},{key:"diffuseColor",get:function(){return console.log("LightSprite: discard property,please use color property instead."),this.color},set:function(e){console.log("LightSprite: discard property,please use color property instead."),this.color=e}}]),n}();Mh.LIGHTMAPBAKEDTYPE_REALTIME=0,Mh.LIGHTMAPBAKEDTYPE_MIXED=1,Mh.LIGHTMAPBAKEDTYPE_BAKED=2;var bh=function(){T(n,Mh);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._direction=new vn,e}return C(n,[{key:"_initShadow",value:function(){var e,t;this._shadow?(this._parallelSplitShadowMap=new Eh,this.scene.parallelSplitShadowMaps.push(this._parallelSplitShadowMap),this.transform.worldMatrix.getForward(this._direction),vn.normalize(this._direction,this._direction),this._parallelSplitShadowMap.setInfo(this.scene,this._shadowFarPlane,this._direction,this._shadowMapSize,this._shadowMapCount,this._shadowMapPCFType)):(e=this._scene._shaderValues,(t=this.scene.parallelSplitShadowMaps).splice(t.indexOf(this._parallelSplitShadowMap),1),this._parallelSplitShadowMap.disposeAllRenderTarget(),this._parallelSplitShadowMap=null,e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM1),e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM2),e.removeDefine(nr.SHADERDEFINE_SHADOW_PSSM3))}},{key:"_addToLightQueue",value:function(){this._scene._directionLights.add(this)}},{key:"_removeFromLightQueue",value:function(){this._scene._directionLights.remove(this)}},{key:"shadow",set:function(e){this._shadow!==e&&(this._shadow=e,this.scene&&this._initShadow())}}]),n}(),Sh=function(){T(n,Mh);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._range=6,e}return C(n,[{key:"_addToLightQueue",value:function(){this._scene._pointLights.add(this)}},{key:"_removeFromLightQueue",value:function(){this._scene._pointLights.remove(this)}},{key:"_parse",value:function(e,t){G(z(n.prototype),"_parse",this).call(this,e,t),this.range=e.range}},{key:"range",get:function(){return this._range},set:function(e){this._range=e}}]),n}(),Ih=function(){T(n,Mh);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this))._spotAngle=30,e._range=10,e._direction=new vn,e}return C(n,[{key:"_addToLightQueue",value:function(){this._scene._spotLights.add(this)}},{key:"_removeFromLightQueue",value:function(){this._scene._spotLights.remove(this)}},{key:"_parse",value:function(e,t){G(z(n.prototype),"_parse",this).call(this,e,t),this.range=e.range,this.spotAngle=e.spotAngle}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(e){this._spotAngle=Math.max(Math.min(e,179),0)}},{key:"range",get:function(){return this._range},set:function(e){this._range=e}}]),n}(),Nh=function(){function c(){S(this,c)}return C(c,null,[{key:"_createSprite3DInstance",value:function(e,t,n){var i;switch(e.type){case"Scene3D":i=new io;break;case"Sprite3D":i=new fa;break;case"MeshSprite3D":i=new pr,n&&e.props.isStatic&&n.push(i);break;case"SkinnedMeshSprite3D":i=new uo;break;case"ShuriKenParticle3D":i=new sh;break;case"Camera":i=new ir;break;case"DirectionLight":i=new bh;break;case"PointLight":i=new Sh;break;case"SpotLight":i=new Ih;break;case"TrailSprite3D":i=new fh;break;case"LineSprite3D":i=new mo;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var a=e.child;if(a)for(var r=0,o=a.length;r<o;r++){var s=c._createSprite3DInstance(a[r],t,n);i.addChild(s)}return t[e.instanceID]=i}},{key:"_createComponentInstance",value:function(e,t){var n=t[e.instanceID];n._parse(e.props,t);var i=e.child;if(i)for(var a=0,r=i.length;a<r;a++)c._createComponentInstance(i[a],t);var o=e.components;if(o)for(var s=0,l=o.length;s<l;s++){var h=o[s],u=Dt.getRegClass(h.type);u?n.addComponent(u)._parse(h):console.warn("Unkown component type.")}}},{key:"_createNodeByJson02",value:function(e,t){var n={},t=c._createSprite3DInstance(e,n,t);return c._createComponentInstance(e,n),t}},{key:"_parse",value:function(e){var t=e.data,n=[],t="LAYAHIERARCHY:02"===e.version?c._createNodeByJson02(t,n):c._createNodeByJson(t,n);return Ma.combine(t,n),t}},{key:"_parseScene",value:function(e){var t=e.data,n=[],t="LAYASCENE3D:02"===e.version?c._createNodeByJson02(t,n):c._createNodeByJson(t,n);return Ma.combine(null,n),t}},{key:"_createNodeByJson",value:function(e,t){var n;switch(e.type){case"Scene3D":n=new io;break;case"Sprite3D":n=new fa;break;case"MeshSprite3D":n=new pr,t&&e.props.isStatic&&t.push(n);break;case"SkinnedMeshSprite3D":n=new uo;break;case"ShuriKenParticle3D":n=new sh;break;case"Camera":n=new ir;break;case"DirectionLight":n=new bh;break;case"PointLight":n=new Sh;break;case"SpotLight":n=new Ih;break;case"TrailSprite3D":n=new fh;case"LineSprite3D":n=new mo;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var i=e.child;if(i)for(var a=0,r=i.length;a<r;a++){var o=c._createNodeByJson(i[a],t);n.addChild(o)}var s=e.components;if(s)for(var l=0,h=s.length;l<h;l++){var u=s[l],d=Dt.getRegClass(u.type);d?n.addComponent(d)._parse(u):console.warn("Unkown component type.")}return n._parse(e.props,null),n}}]),c}(),Rh=function(){function a(e,t,n,i){S(this,a),this._idata=[]}return C(a,[{key:"getArrayData",value:function(){return this._idata}},{key:"getPtrID",value:function(){return 0}},{key:"beginEncoding",value:function(){}},{key:"endEncoding",value:function(){}},{key:"clearEncoding",value:function(){this._idata.length=0}},{key:"getCount",value:function(){return this._idata.length}},{key:"add_ShaderValue",value:function(e){this._idata.push(e)}},{key:"addShaderUniform",value:function(e){this.add_ShaderValue(e)}}]),a}(),Ch=function(){function A(){S(this,A)}return C(A,null,[{key:"_cancelLoadByUrl",value:function(e){zn.loader.cancelLoadByUrl(e),A._innerFirstLevelLoaderManager.cancelLoadByUrl(e),A._innerSecondLevelLoaderManager.cancelLoadByUrl(e),A._innerThirdLevelLoaderManager.cancelLoadByUrl(e),A._innerFourthLevelLoaderManager.cancelLoadByUrl(e)}},{key:"_changeWebGLSize",value:function(e,t){dt.onStageResize(e,t),qa.clientWidth=e,qa.clientHeight=t}},{key:"__init__",value:function(e,t,n){ye.isAntialias=n.isAntialias,ye.isAlpha=n.isAlpha,ye.premultipliedAlpha=n.premultipliedAlpha,ye.isStencil=n.isStencil,dt.enable()?(Yt.changeWebGLSize=A._changeWebGLSize,yt.is3DMode=!0,zn.init(e,t),yt.supportWebGLPlusRendering||(P.instance=y.mainContext,P.instance.createCommandEncoder=function(){return new Rh(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:128,1<arguments.length&&void 0!==arguments[1]?arguments[1]:64,2<arguments.length&&void 0!==arguments[2]&&arguments[2])}),n._multiLighting=n.enbaleMultiLight&&za.supportTextureFormat(f.R32G32B32A32),wi.Scene3D=io,wi.MeshRenderStaticBatchManager=lr,wi.MeshRenderDynamicBatchManager=vr,wi.SubMeshDynamicBatch=yr,wi.Laya3D=A,wi.Matrix4x4=ki,A.enableNative3D(),ya.__init__(),wa.__init__(),Al.__init__(),Dl.__init__(),Xr.__init__(),uh.__init__(),gh.__init__(),Zr.__init__(),Ra.__init__(),yr.__init__(),Rr._physics3D=window.Physics3D,Rr._physics3D&&(wh.__init__(),Cr.__init__(),Lr.__init__(),Vr.__init__(),Ur.__init__(),Ar.__init__(),Pr.__init__(),yh.__init__(),mh.__init__()),Th.__init__(),vo.__init__(),po.__init__(),fa.__init__(),ga.__init__(),pr.__init__(),uo.__init__(),sh.__init__(),fh.__init__(),fl.__init__(),io.__init__(),lr.__init__(),hr.__initDefine__(),dr.__initDefine__(),xl.__initDefine__(),wl.__initDefine__(),Tl.__initDefine__(),El.__initDefine__(),lh.__initDefine__(),pl.__initDefine__(),Ml.__initDefine__(),Il.__initDefine__(),ml.__initDefine__(),qr.__initDefine__(),kl.__initDefine__(),Qa.__init__(),Dt.regClass("Laya.EffectMaterial",pl),Dt.regClass("Laya.UnlitMaterial",El),Dt.regClass("Laya.BlinnPhongMaterial",dr),Dt.regClass("Laya.SkyProceduralMaterial",Tl),Dt.regClass("Laya.PBRStandardMaterial",xl),Dt.regClass("Laya.PBRSpecularMaterial",wl),Dt.regClass("Laya.SkyBoxMaterial",kl),Dt.regClass("Laya.WaterPrimaryMaterial",Ml),Dt.regClass("Laya.ExtendTerrainMaterial",ml),Dt.regClass("Laya.ShurikenParticleMaterial",Il),Dt.regClass("Laya.TrailMaterial",lh),Dt.regClass("Laya.PhysicsCollider",ph),Dt.regClass("Laya.Rigidbody3D",mh),Dt.regClass("Laya.CharacterController",yh),Dt.regClass("Laya.Animator",la),Dt.regClass("PhysicsCollider",ph),Dt.regClass("CharacterController",yh),Dt.regClass("Animator",la),Dt.regClass("Rigidbody3D",mh),qr.defaultMaterial=new qr,dr.defaultMaterial=new dr,pl.defaultMaterial=new pl,xl.defaultMaterial=new xl,wl.defaultMaterial=new wl,El.defaultMaterial=new El,Il.defaultMaterial=new Il,lh.defaultMaterial=new lh,Tl.defaultMaterial=new Tl,kl.defaultMaterial=new kl,Ml.defaultMaterial=new Ml,qr.defaultMaterial.lock=!0,dr.defaultMaterial.lock=!0,pl.defaultMaterial.lock=!0,xl.defaultMaterial.lock=!0,wl.defaultMaterial.lock=!0,El.defaultMaterial.lock=!0,Il.defaultMaterial.lock=!0,lh.defaultMaterial.lock=!0,Tl.defaultMaterial.lock=!0,kl.defaultMaterial.lock=!0,Ml.defaultMaterial.lock=!0,X.__init__(),xh.__init__(),Ya.__init__(),Hr.__init__(),Za.__init__(),Ka.__init__(),ba.__init__(),fo.__init__(),(n=ln.createMap).lh=[A.HIERARCHY,Nh._parse],n.ls=[A.HIERARCHY,Nh._parseScene],n.lm=[A.MESH,vo._parse],n.lmat=[A.MATERIAL,hr._parse],n.ltc=[A.TEXTURECUBE,xh._parse],n.jpg=[A.TEXTURE2D,X._parse],n.jpeg=[A.TEXTURE2D,X._parse],n.bmp=[A.TEXTURE2D,X._parse],n.gif=[A.TEXTURE2D,X._parse],n.png=[A.TEXTURE2D,X._parse],n.dds=[A.TEXTURE2D,X._parse],n.ktx=[A.TEXTURE2D,X._parse],n.pvr=[A.TEXTURE2D,X._parse],n.lani=[A.ANIMATIONCLIP,cl._parse],n.lav=[A.AVATAR,vl._parse],(n=on.parserMap)[A.HIERARCHY]=A._loadHierarchy,n[A.MESH]=A._loadMesh,n[A.MATERIAL]=A._loadMaterial,n[A.TEXTURECUBE]=A._loadTextureCube,n[A.TEXTURE2D]=A._loadTexture2D,n[A.ANIMATIONCLIP]=A._loadAnimationClip,n[A.AVATAR]=A._loadAvatar,A._innerFirstLevelLoaderManager.on(Je.ERROR,null,A._eventLoadManagerError),A._innerSecondLevelLoaderManager.on(Je.ERROR,null,A._eventLoadManagerError),A._innerThirdLevelLoaderManager.on(Je.ERROR,null,A._eventLoadManagerError),A._innerFourthLevelLoaderManager.on(Je.ERROR,null,A._eventLoadManagerError)):alert("Laya3D init error,must support webGL!")}},{key:"enableNative3D",value:function(){var e=va,t=vs,n=ho,i=vl,a=ba;yt.supportWebGLPlusRendering&&(e.prototype._initData=e.prototype._initDataForNative,e.prototype.setBool=e.prototype.setBoolForNative,e.prototype.getBool=e.prototype.getBoolForNative,e.prototype.setInt=e.prototype.setIntForNative,e.prototype.getInt=e.prototype.getIntForNative,e.prototype.setNumber=e.prototype.setNumberForNative,e.prototype.getNumber=e.prototype.getNumberForNative,e.prototype.setVector=e.prototype.setVectorForNative,e.prototype.getVector=e.prototype.getVectorForNative,e.prototype.setVector2=e.prototype.setVector2ForNative,e.prototype.getVector2=e.prototype.getVector2ForNative,e.prototype.setVector3=e.prototype.setVector3ForNative,e.prototype.getVector3=e.prototype.getVector3ForNative,e.prototype.setQuaternion=e.prototype.setQuaternionForNative,e.prototype.getQuaternion=e.prototype.getQuaternionForNative,e.prototype.setMatrix4x4=e.prototype.setMatrix4x4ForNative,e.prototype.getMatrix4x4=e.prototype.getMatrix4x4ForNative,e.prototype.setBuffer=e.prototype.setBufferForNative,e.prototype.getBuffer=e.prototype.getBufferForNative,e.prototype.setTexture=e.prototype.setTextureForNative,e.prototype.getTexture=e.prototype.getTextureForNative,e.prototype.setAttribute=e.prototype.setAttributeForNative,e.prototype.getAttribute=e.prototype.getAttributeForNative,e.prototype.cloneTo=e.prototype.cloneToForNative,e.prototype.getData=e.prototype.getDataForNative,t.prototype._uniformMatrix2fv=t.prototype._uniformMatrix2fvForNative,t.prototype._uniformMatrix3fv=t.prototype._uniformMatrix3fvForNative,t.prototype._uniformMatrix4fv=t.prototype._uniformMatrix4fvForNative,ys.uploadShaderUniforms=ys.uploadShaderUniformsForNative),yt.supportWebGLPlusCulling&&(a.renderObjectCulling=ba.renderObjectCullingNative),yt.supportWebGLPlusAnimation&&(i.prototype._cloneDatasToAnimator=i.prototype._cloneDatasToAnimatorNative,cl.prototype._evaluateClipDatasRealTime=cl.prototype._evaluateClipDatasRealTimeForNative,n.prototype._computeSkinnedData=n.prototype._computeSkinnedDataForNative),yt.isConchApp&&(dt.shaderHighPrecision=!1,(n=P.instance).getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision?dt.shaderHighPrecision=!0:dt.shaderHighPrecision=!1)}},{key:"formatRelativePath",value:function(e,t){e+=t;if("."===t.charAt(0)){for(var n,i=e.split("/"),a=0,r=i.length;a<r;a++)".."!=i[a]||0<(n=a-1)&&".."!==i[n]&&(i.splice(n,2),a-=2);e=i.join("/")}return e}},{key:"_endLoad",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(n)for(var i=0,a=n.length;i<a;i++){var r=on.getRes(n[i]);r&&r._removeReference()}e.endLoad(t)}},{key:"_eventLoadManagerError",value:function(e){zn.loader.event(Je.ERROR,e)}},{key:"_addHierarchyInnerUrls",value:function(e,t,n,i,a,r){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:null,a=A.formatRelativePath(i,a);return n&&(a+=n),e.push({url:a,type:r,constructParams:o,propertyParams:s}),t.push(a),a}},{key:"_getSprite3DHierarchyInnerUrls",value:function(e,t,n,i,a,r,o,s){var l=e.props;switch(e.type){case"Scene3D":for(var h=l.lightmaps,u=0,d=h.length;u<d;u++){var c=h[u];c.path=A._addHierarchyInnerUrls(a,r,o,s,c.path,A.TEXTURE2D,c.constructParams,c.propertyParams)}var _=l.reflectionTexture;_&&(l.reflectionTexture=A._addHierarchyInnerUrls(i,r,o,s,_,A.TEXTURECUBE)),!l.sky||(f=l.sky.material)&&(f.path=A._addHierarchyInnerUrls(n,r,o,s,f.path,A.MATERIAL));break;case"Camera":var f=l.skyboxMaterial;f&&(f.path=A._addHierarchyInnerUrls(n,r,o,s,f.path,A.MATERIAL));break;case"TrailSprite3D":case"LineSprite3D":case"MeshSprite3D":case"SkinnedMeshSprite3D":var g=l.meshPath;g&&(l.meshPath=A._addHierarchyInnerUrls(t,r,o,s,g,A.MESH));var y=l.materials;if(y)for(u=0,d=y.length;u<d;u++)y[u].path=A._addHierarchyInnerUrls(n,r,o,s,y[u].path,A.MATERIAL);break;case"ShuriKenParticle3D":g=l.meshPath;g&&(l.meshPath=A._addHierarchyInnerUrls(t,r,o,s,g,A.MESH)),l.material.path=A._addHierarchyInnerUrls(n,r,o,s,l.material.path,A.MATERIAL);break;case"Terrain":A._addHierarchyInnerUrls(a,r,o,s,l.dataPath,A.TERRAINRES)}var v=e.components;if(v)for(var p=0,m=v.length;p<m;p++){var w=v[p];switch(w.type){case"Animator":w.avatarPath;var x=w.avatar;x&&(x.path=A._addHierarchyInnerUrls(a,r,o,s,x.path,A.AVATAR));var k=w.clipPaths;if(k)for(u=0,d=k.length;u<d;u++)k[u]=A._addHierarchyInnerUrls(a,r,o,s,k[u],A.ANIMATIONCLIP);else{var T=w.layers;for(u=0;u<T.length;u++)for(var E=T[u].states,M=0,b=E.length;M<b;M++){var S=E[M].clipPath;S&&(E[M].clipPath=A._addHierarchyInnerUrls(a,r,o,s,S,A.ANIMATIONCLIP))}}break;case"PhysicsCollider":case"Rigidbody3D":case"CharacterController":var I=w.shapes;for(u=0;u<I.length;u++){var N,R=I[u];"MeshColliderShape"!==R.type||(N=R.mesh)&&(R.mesh=A._addHierarchyInnerUrls(t,r,o,s,N,A.MESH))}}}var C=e.child;for(u=0,d=C.length;u<d;u++)A._getSprite3DHierarchyInnerUrls(C[u],t,n,i,a,r,o,s)}},{key:"_loadHierarchy",value:function(e){e.on(Je.LOADED,null,A._onHierarchylhLoaded,[e]),e.load(e.url,on.JSON,!1,null,!0)}},{key:"_onHierarchylhLoaded",value:function(e,t){var n=e.url,i=ia.getURLVerion(n),a=B.getPath(n),r=[],o=[],s=[],l=[],h=[];A._getSprite3DHierarchyInnerUrls(t.data,r,o,s,l,h,i,a);var u,n=r.length+o.length+l.length,i=n+1,a=1/i;A._onProcessChange(e,0,a,1),0<l.length?(u=n/i,i=F.create(null,A._onProcessChange,[e,a,u],!1),A._innerFourthLevelLoaderManager._create(l,!1,F.create(null,A._onHierarchyInnerForthLevResouLoaded,[e,i,t,h,r,o,s,a+u*l.length,u]),i,null,null,null,1,!0)):A._onHierarchyInnerForthLevResouLoaded(e,null,t,h,r,o,s,a,u)}},{key:"_onHierarchyInnerForthLevResouLoaded",value:function(e,t,n,i,a,r,o,s,l){var h;t&&t.recover(),0<o.length?(h=F.create(null,A._onProcessChange,[e,s,l],!1),A._innerThirdLevelLoaderManager._create(o,!1,F.create(null,A._onHierarchyInnerThirdLevResouLoaded,[e,h,n,i,a,r,s+l*r.length,l]),t,null,null,null,1,!0)):A._onHierarchyInnerThirdLevResouLoaded(e,null,n,i,a,r,s,l)}},{key:"_onHierarchyInnerThirdLevResouLoaded",value:function(e,t,n,i,a,r,o,s){var l;t&&t.recover(),0<r.length?(l=F.create(null,A._onProcessChange,[e,o,s],!1),A._innerSecondLevelLoaderManager._create(r,!1,F.create(null,A._onHierarchyInnerSecondLevResouLoaded,[e,l,n,i,a,o+s*r.length,s]),t,null,null,null,1,!0)):A._onHierarchyInnerSecondLevResouLoaded(e,null,n,i,a,o,s)}},{key:"_onHierarchyInnerSecondLevResouLoaded",value:function(e,t,n,i,a,r,o){t&&t.recover(),0<a.length?(o=F.create(null,A._onProcessChange,[e,r,o],!1),A._innerFirstLevelLoaderManager._create(a,!1,F.create(null,A._onHierarchyInnerFirstLevResouLoaded,[e,o,n,i]),t,null,null,null,1,!0)):A._onHierarchyInnerFirstLevResouLoaded(e,null,n,i)}},{key:"_onHierarchyInnerFirstLevResouLoaded",value:function(e,t,n,i){t&&t.recover(),e._cache=e._createCache;n="Scene3D"===n.data.type?Nh._parseScene(n,e._propertyParams,e._constructParams):Nh._parse(n,e._propertyParams,e._constructParams);A._endLoad(e,n,i)}},{key:"_loadMesh",value:function(e){e.on(Je.LOADED,null,A._onMeshLmLoaded,[e]),e.load(e.url,on.BUFFER,!1,null,!0)}},{key:"_onMeshLmLoaded",value:function(e,t){e._cache=e._createCache;t=vo._parse(t,e._propertyParams,e._constructParams);A._endLoad(e,t)}},{key:"_loadMaterial",value:function(e){e.on(Je.LOADED,null,A._onMaterilLmatLoaded,[e]),e.load(e.url,on.JSON,!1,null,!0)}},{key:"_onMaterilLmatLoaded",value:function(e,t){var n=e.url,i=ia.getURLVerion(n),a=B.getPath(n),r=[],o=[];t.customProps;switch(t.version){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":var s,l,h=t.props.textures;if(h)for(s=0,l=h.length;s<l;s++){var u=h[s],d=u.path;d&&(d=A.formatRelativePath(a,d),i&&(d+=i),r.push({url:d,constructParams:u.constructParams,propertyParams:u.propertyParams}),o.push(d),u.path=d)}break;default:throw new Error("Laya3D:unkonwn version.")}var c=r.length,_=c+1,n=1/_;A._onProcessChange(e,0,n,1),0<c?(_=F.create(null,A._onProcessChange,[e,n,c/_],!1),A._innerFourthLevelLoaderManager._create(r,!1,F.create(null,A._onMateialTexturesLoaded,[e,_,t,o]),_,null,null,null,1,!0)):A._onMateialTexturesLoaded(e,null,t,null)}},{key:"_onMateialTexturesLoaded",value:function(e,t,n,i){e._cache=e._createCache;n=hr._parse(n,e._propertyParams,e._constructParams);A._endLoad(e,n,i),t&&t.recover()}},{key:"_loadAvatar",value:function(t){t.on(Je.LOADED,null,function(e){t._cache=t._createCache;e=vl._parse(e,t._propertyParams,t._constructParams);A._endLoad(t,e)}),t.load(t.url,on.JSON,!1,null,!0)}},{key:"_loadAnimationClip",value:function(t){t.on(Je.LOADED,null,function(e){t._cache=t._createCache;e=cl._parse(e,t._propertyParams,t._constructParams);A._endLoad(t,e)}),t.load(t.url,on.BUFFER,!1,null,!0)}},{key:"_loadTexture2D",value:function(t){var e,n=t.url,i=n.lastIndexOf(".")+1,a=n.indexOf("?"),a=-1==a?n.length:a;switch(n.substr(i,a-i)){case"jpg":case"jpeg":case"bmp":case"gif":case"png":e="nativeimage";break;case"dds":case"ktx":case"pvr":e=on.BUFFER}t.on(Je.LOADED,null,function(e){t._cache=t._createCache;e=X._parse(e,t._propertyParams,t._constructParams);A._endLoad(t,e)}),t.load(t.url,e,!1,null,!0)}},{key:"_loadTextureCube",value:function(e){e.on(Je.LOADED,null,A._onTextureCubeLtcLoaded,[e]),e.load(e.url,on.JSON,!1,null,!0)}},{key:"_onTextureCubeLtcLoaded",value:function(e,t){var n=B.getPath(e.url),n=[A.formatRelativePath(n,t.front),A.formatRelativePath(n,t.back),A.formatRelativePath(n,t.left),A.formatRelativePath(n,t.right),A.formatRelativePath(n,t.up),A.formatRelativePath(n,t.down)];A._onProcessChange(e,0,1/7,1);t=F.create(null,A._onProcessChange,[e,1/7,6/7],!1);A._innerFourthLevelLoaderManager.load(n,F.create(null,A._onTextureCubeImagesLoaded,[e,n,t]),t,"nativeimage")}},{key:"_onTextureCubeImagesLoaded",value:function(e,t,n){for(var i=new Array(6),a=0;a<6;a++)i[a]=on.getRes(t[a]);e._cache=e._createCache;var r=xh._parse(i,e._propertyParams,e._constructParams);for(n.recover(),a=0;a<6;a++)on.clearRes(t[a]);A._endLoad(e,r)}},{key:"_onProcessChange",value:function(e,t,n,i){(i=t+i*n)<1&&e.event(Je.PROGRESS,i)}},{key:"init",value:function(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;A._isInit||(A._isInit=!0,i&&i.cloneTo(ha._config),i=ha._config,ba.debugFrustumCulling=i.debugFrustumCulling,A._editerEnvironment=i._editerEnvironment,io.octreeCulling=i.octreeCulling,io.octreeInitialSize=i.octreeInitialSize,io.octreeInitialCenter=i.octreeInitialCenter,io.octreeMinNodeSize=i.octreeMinNodeSize,io.octreeLooseness=i.octreeLooseness,null==(n=window.Physics3D)?(Rr._enbalePhysics=!1,A.__init__(e,t,i),a&&a.run()):(Rr._enbalePhysics=!0,n(1024*i.defaultPhysicsMemory*1024).then(function(){A.__init__(e,t,i),a&&a.run()})))}},{key:"enbalePhysics",get:function(){return Rr._enbalePhysics}}]),A}();function Ah(){S(this,Ah),this.placeholder=0}function Dh(){S(this,Dh),this.fishServerIds=new Array,this.fishHps=new Array}Ch.HIERARCHY="HIERARCHY",Ch.MESH="MESH",Ch.MATERIAL="MATERIAL",Ch.TEXTURE2D="TEXTURE2D",Ch.TEXTURECUBE="TEXTURECUBE",Ch.ANIMATIONCLIP="ANIMATIONCLIP",Ch.AVATAR="AVATAR",Ch.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA",Ch.TERRAINRES="TERRAIN",Ch._innerFirstLevelLoaderManager=new ln,Ch._innerSecondLevelLoaderManager=new ln,Ch._innerThirdLevelLoaderManager=new ln,Ch._innerFourthLevelLoaderManager=new ln,Ch._isInit=!1,Ch._editerEnvironment=!1,Ch.physicsSettings=new Gr,window.Laya3D=Ch;var Lh,Oh=function(){function e(){S(this,e)}return C(e,[{key:"autoDestroyLoadingViewWhenLoadComplete",value:function(){return!0}}]),e}(),Ph=function(){T(t,Oh);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"createView",value:function(){if(!this.view)return this.view=new(this.getViewCtor()),this.view}}]),t}(),Fh=function(){T(t,Oh);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}(),Bh=function(){function e(){S(this,e)}return C(e,[{key:"setDefaultLoadingView",value:function(e){this.defaultLoadingScene=e}},{key:"setSceneEvent",value:function(e){this.event=e}},{key:"load",value:function(e,t,n,i){var a=this;es.closeAll(),this.event.offAll(),this.currentScene&&(this.currentScene.destroy(),this.currentScene.view.destroy());var r=new e;0==r.getResource().length?this.onAllCompleted(r,t,i):(this.loadingScene=new(n||this.defaultLoadingScene),this.loadSceneResource(this.loadingScene,null,new F(this,function(){a.loadingScene.createView(),a.loadingScene.view.size(zn.stage.width,zn.stage.height),a.loadingScene.init(),a.loadingScene.view.zOrder=100,a.loadingLayer.addChild(a.loadingScene.view),a.loadSceneResource(r,t,new F(a,a.onAllCompleted,[r,t,i]),new F(a.loadingScene,a.loadingScene.onProgress))})))}},{key:"loadSceneResource",value:function(n,i,a,r){function e(e){var t;s&&(s=!1,zn.loader.clearUnLoaded(),(t=new Cn).once(2e3,o,function(){o.loadSceneResource(n,i,a,r),t.clearAll(o)}))}var o=this,s=!0;zn.loader.on(Je.ERROR,this,e),zn.loader.create(n.getResource(),F.create(this,function(){zn.loader.off(Je.ERROR,o,e),s&&a.run()}),r)}},{key:"onCompletedOne",value:function(e,t){var n;"lom"==ae.getFileExtension(e)&&(e=(n=new DataView(t)).getUint32(n.byteLength-4),n=n.buffer.slice(n.byteLength-4-e,n.byteLength-4),n=new nn(n),at.window.merge=at.window.merge||[],at.window.merge.push({type:"binary",config:JSON.parse(n.getUTFBytes()),data:t}))}},{key:"onAllCompleted",value:function(e,t,n){e.createView(),this.sceneLayer.addChild(e.view),e.view.size(zn.stage.width,zn.stage.height),e.args=t,e.init(),n instanceof F&&n.run(),e.autoDestroyLoadingViewWhenLoadComplete()&&this.destroyLoadingScene(),this.currentScene=e}},{key:"setLoadingSceneInfo",value:function(e){this.loadingScene&&this.loadingScene.view&&this.loadingScene.setInfo(e)}},{key:"destroyLoadingScene",value:function(){this.loadingScene&&this.loadingScene.view&&(this.loadingScene.view.destroy(),this.loadingScene.destroy(),this.loadingScene=null)}},{key:"resetLayers",value:function(){this.currentScene&&(this.currentScene.view.destroy(),this.currentScene.destroy()),this.root||(this.root=new Bt,zn.stage.addChild(this.root)),this.sceneLayer&&(this.sceneLayer.removeSelf(),this.sceneLayer.destroy(!0),this.sceneLayer=null),this.sceneLayer=new Bt,this.root.addChild(this.sceneLayer),this.loadingLayer&&(this.loadingLayer.removeSelf(),this.loadingLayer.destroy(!0),this.loadingLayer=null),this.loadingLayer=new Bt,this.loadingLayer.zOrder=9999,Gn.addChild(this.loadingLayer)}}],[{key:"I",get:function(){return this.instance||(this.instance=new e,this.instance.resetLayers(),zn.loader.on("complete_one",this.instance,this.instance.onCompletedOne)),this.instance}}]),e}(),Vh=function(){function t(e){S(this,t),this.nCurveLength=-1,null==e?(this.points_vec=[],this.points_vec.push(vn._ZERO)):e.length<=0?this.points_vec.push(vn._ZERO):this.points_vec=e,this.getLength(),this.checkCircle()}return C(t,[{key:"checkCircle",value:function(){var e,t;this.isCircle=!1,3<this.points_vec.length&&(e=this.points_vec[0],t=this.points_vec[this.points_vec.length-1],e.x==t.x&&e.y==t.y&&e.z==t.z&&(this.isCircle=!0))}},{key:"getPosition",value:function(e,t){2<arguments.length&&void 0!==arguments[2]&&!arguments[2]||(e=Ti.clamp(e,0,1));try{var n=this.points_vec.length-3;if(n<=0)return void(t=this.points_vec[0]);var i=Math.min(Math.floor(e*n),n-1),a=this.points_vec[i],r=this.points_vec[i+1],o=this.points_vec[i+2],s=this.points_vec[i+3];this.isCircle&&(0==i&&(a=this.points_vec[n]),i+1==n&&(s=this.points_vec[2]));var l=e*n-i,h=l*l,u=h*l,d=.5*l,c=.5*h,n=h+h,i=.5*u,l=h-i-d,h=u+i-c-n+1,d=-u-i+n+d,c=i-c;t.x=l*a.x+h*r.x+d*o.x+c*s.x,t.y=l*a.y+h*r.y+d*o.y+c*s.y,t.z=l*a.z+h*r.z+d*o.z+c*s.z}catch(e){vn._ZERO.cloneTo(t)}this.transform&&vn.transformCoordinate(t,this.transform.worldMatrix,t)}},{key:"getLength",value:function(){if(0<=this.nCurveLength)return this.nCurveLength;if(null==this.points_vec||this.points_vec.length<3)return this.nCurveLength=0,this.nCurveLength;this.nCurveLength=0;for(var e=1;e<this.points_vec.length-2;e++){if(null==this.points_vec[e]||null==this.points_vec[e+1])return;this.nCurveLength+=vn.distance(this.points_vec[e],this.points_vec[e+1])}return this.nCurveLength}},{key:"getForwardNormal",value:function(e,t,n,i){var a,r=this.getLength();r<=0||(n/=r,a=Ti.temp1Vector3,this.getPosition(e+n,a),vn.subtract(a,t,a),vn.normalize(a,a),r=Ti.temp2Vector3,this.getPosition(e-n,r),vn.subtract(t,r,r),vn.normalize(r,r),vn.lerp(a,r,.5,i),vn.normalize(i,i))}},{key:"getForwardAngle",value:function(e,t){var n=this.getLength(),i=Ti.temp0Vector3,a=Ti.temp1Vector3,r=Ti.temp2Vector3;return this.getPosition(e+t+t/n,i),this.getPosition(e-t-t/n,a),vn.subtract(i,a,r),vn.normalize(r,r),-(180*Math.atan2(r.y,-r.x)/Math.PI)}}]),t}(),Uh=function(){function e(){S(this,e)}return C(e,[{key:"clone",value:function(){return new e}}]),e}(),zh=function(){T(n,Uh);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).position=0,e.roll=0,e.rotateVector3=new vn,e}return C(n,[{key:"clone",value:function(){var e=new n;return e.curve=this.curve,e.targetScale=this.targetScale,e.autoLookDirection=this.autoLookDirection,e.target=this.target,e.firstRun=!0,e}},{key:"UpdateTransform",value:function(){var e;null!=this.curve&&null!=this.target&&(e=Ti.temp0Vector3,this.curve.getPosition(this.position,e,!0),this.autoLookDirection&&(this.rotateVector3.z=-this.rotateVector3.z,this.target.getTransform().rotate(this.rotateVector3,!0,!1),this.rotateVector3.z=this.curve.getForwardAngle(this.position,.01),this.target.getTransform().rotate(this.rotateVector3,!0,!1)),this.target.getTransform().position=e,this.target&&this.target.afterUpdateTransform(e,this.targetScale))}},{key:"SetPositionOnCurve",value:function(e){this.position=e,this.UpdateTransform()}},{key:"SetRoll",value:function(e){this.roll=e,this.UpdateTransform()}},{key:"SetCurve",value:function(e){this.curve=e,this.UpdateTransform()}},{key:"SetTarget",value:function(e){this.target=e,this.UpdateTransform()}}]),n}();function Gh(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;S(this,Gh),this.time=e,this.value=t,this.inTangent=n,this.outTangent=i}(Gr=Lh=Lh||{})[Gr.Action=0]="Action",Gr[Gr.DirectVarAccess=1]="DirectVarAccess",Gr[Gr.Disable=2]="Disable";var Xh,Hh=function(){function t(e){S(this,t),this.targetName="",this.startTime=0,this.length=1,this.updateEvent="",this.updateMode=Lh.Action,this.callback=null,this.loopClip=!1,this.activeCalculateOnly=!1,this.cutscene=e}return C(t,[{key:"bindCallback",value:function(){null!=this.targetAction&&(this.callback=this.targetAction[this.updateEvent])}},{key:"setValue",value:function(e){null!=this.callback&&this.callback.call(this.targetAction,e)}},{key:"setTarget",value:function(e){var t,n;this.target=e,null!=this.targetAction&&this.targetAction instanceof zh&&((t=this.targetAction).SetTarget(e),null!=t.targetScale&&(n=t.target.getTransform().scale,e=Ti.temp0Vector3,vn.multiply(t.targetScale,n,e),t.target.getTransform().scale=e),null==this.lastValue&&(this.lastValue=this.startTime),this.setValue(this.lastValue))}},{key:"onTargetDestroy",value:function(){this.cutscene.removeCurveClip(this)}},{key:"getValue",value:function(e){e=this.animCurve.Evaluate(e);return this.loopClip&&1<e&&(e-=Math.floor(e)),e}}]),t}(),Yh=function(){function t(){S(this,t),this.name="event clip",this.startTime=0,this.targetFunction="",this.paramVariationIndex=0}return C(t,[{key:"clone",value:function(){var e=new t;return e.name=this.name,e.startTime=this.startTime,e.targetFunction=this.targetFunction,e.paramVariationIndex=this.paramVariationIndex,e.params=this.params,e}},{key:"trigger",value:function(){var e=[],t=c(this.params);try{for(t.s();!(n=t.n()).done;)var n=n.value,e=e.concat(n)}catch(e){t.e(e)}finally{t.f()}this.target[this.targetFunction]&&this.target[this.targetFunction].apply(this.target,e)}}]),t}(),Wh=function(){function a(){S(this,a),this.cutsceneName="Cutscene01",this.loop=!1,this.loopCount=0,this.resetOnStop=!1,this.resetPlayCountOnStop=!0,this.offsetTime=0,this.speedMagnification=1,this.timer=0,this.startTime=0,this.playing=!1,this.playReverse=!1,this.totalPlays=0,this.fTotalTime=-1,this.isFinish=!1,this.curves=[],this.events=[],this.finishedEvents=[]}return C(a,[{key:"clone",value:function(){var e=new a;e.cutsceneName=this.cutsceneName,e.loop=this.loop,e.loopCount=this.loopCount,e.resetOnStop=this.resetOnStop,e.resetPlayCountOnStop=this.resetPlayCountOnStop,e.offsetTime=this.offsetTime,e.speedMagnification=this.speedMagnification,e.timer=this.timer,e.startTime=this.startTime,e.playing=this.playing,e.playReverse=this.playReverse,e.totalPlays=this.totalPlays,e.fTotalTime=this.fTotalTime,e.isFinish=this.isFinish;for(var t=0;t<this.curves.length;t++){var n=e.addCurveClip();n.target=this.curves[t].target,n.targetName=this.curves[t].targetName,n.targetAction=this.curves[t].targetAction.clone(),n.startTime=this.curves[t].startTime,n.length=this.curves[t].length,n.updateEvent=this.curves[t].updateEvent,n.updateMode=this.curves[t].updateMode,n.animCurve=this.curves[t].animCurve,n.loopClip=this.curves[t].loopClip,n.activeCalculateOnly=this.curves[t].activeCalculateOnly,n.bindCallback()}e.events=[];for(var i=0;i<this.events.length;i++)e.events.push(this.events[i].clone());return e}},{key:"clear",value:function(){this.curves=[],this.events=[],this.finishedEvents=[]}},{key:"Start",value:function(){this.updateCutscene(0,!1)}},{key:"getTotalTime",value:function(){if(0<=this.fTotalTime)return this.fTotalTime;for(var e=this.fTotalTime=0;e<this.curves.length;e++){var t=this.curves[e];this.fTotalTime<t.startTime+t.length&&(this.fTotalTime=t.startTime+t.length)}return this.fTotalTime}},{key:"resetSpeed",value:function(){this.speedMagnification=1}},{key:"setSpeed",value:function(e){this.speedMagnification=e}},{key:"getSpeed",value:function(){return this.speedMagnification}},{key:"Update",value:function(){var e;this.timer+=Gn.timer.delta*this.speedMagnification*.001,this.playing&&(e=this.getTotalTime(),this.timer>this.startTime+e?(this.resetSpeed(),this.playReverse?(this.updateCutscene(0,!0),this.stop()):(this.updateCutscene(this.timer-this.startTime,!0),this.playing=!1,this.isFinish=!0,this.loop&&(this.loopCount<=0||this.totalPlays<this.loopCount)?(this.play(),this.startTime+=Gn.timer.delta/1e3):this.stop())):this.playReverse?this.updateCutscene(e-(this.timer-this.startTime),!0):this.updateCutscene(this.timer-this.startTime,!0))}},{key:"updateCutscene",value:function(e,t){var n=this.getTotalTime();if(!(e<0||n<e)){for(var i=0;i<this.curves.length;i++){var a=this.curves[i],r=!1,o=e-a.startTime;0<=o&&o<a.length&&(r=!0);var s,o=a.getValue(o);if(r||!a.activeCalculateOnly)if(a.updateMode==Lh.Action)(null==a.lastValue||(s=o-a.lastValue)<-Ti.EPSILON||s>Ti.EPSILON)&&(a.setValue(o),a.lastValue=o);else if(a.updateMode==Lh.Disable)continue}if(1==t&&0<this.events.length)for(var l=this.getCurrentEvents(e),i=0;i<l.length;i++){var h=l[i];h.target?h.trigger():console.warn("Warning: Tried to play event "+h.name+" that has no target set."),this.finishedEvents.push(h)}}}},{key:"play",value:function(){this.playing||(this.startTime=this.timer-this.offsetTime,this.playing=!0,this.playReverse=!1,this.finishedEvents=[],this.totalPlays++)}},{key:"continue",value:function(e){this.startTime+=e,this.playing=!0,this.playReverse=!1,this.finishedEvents=[]}},{key:"stop",value:function(){this.playing=!1,this.playReverse=!1,this.finishedEvents=[],this.resetPlayCountOnStop&&(this.totalPlays=0),this.resetOnStop&&this.updateCutscene(0,!1)}},{key:"resetToBeginning",value:function(){this.timer=0,this.startTime=0,this.playing=!1,this.isFinish=!1,this.resetSpeed(),this.Start(),this.play()}},{key:"getCurrentEvents",value:function(e){var t=[];if(this.playReverse)for(n=0;n<this.events.length;n++)e<=this.events[n].startTime&&-1==this.finishedEvents.indexOf(this.events[n])&&t.push(this.events[n]);else for(var n=0;n<this.events.length;n++)e>=this.events[n].startTime&&-1==this.finishedEvents.indexOf(this.events[n])&&t.push(this.events[n]);return t}},{key:"addCurveClip",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,t=new Hh(this);return e<0||e>=this.curves.length?this.curves.push(t):this.curves.splice(e,0,t),t}},{key:"insertCurveClip",value:function(e,t){return e=Math.max(Math.min(e,this.curves.length),0),this.curves.splice(e,0,t),t}},{key:"removeCurveClip",value:function(e){e=this.curves.indexOf(e);0<=e&&this.curves.splice(e,1)}},{key:"addEvent",value:function(){var e=new Yh;return this.events.push(e),e}},{key:"deleteEvent",value:function(e){e=this.events.indexOf(e);0<=e&&this.events.splice(e,1)}},{key:"setEventTarget",value:function(e){var t,n=c(this.events);try{for(n.s();!(t=n.n()).done;)t.value.target=e}catch(e){n.e(e)}finally{n.f()}}}],[{key:"isInArray",value:function(e,t){return 0<=e.indexOf(t)}}]),a}();(Gr=Xh=Xh||{})[Gr.Default=0]="Default",Gr[Gr.Once=1]="Once",Gr[Gr.Loop=2]="Loop",Gr[Gr.PingPong=4]="PingPong",Gr[Gr.ClampForever=8]="ClampForever";var jh=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;S(this,r),this.Init(e)}return C(r,[{key:"Cleanup",value:function(){}},{key:"Evaluate",value:function(e){if(null==this.keys||0==this.keys.length)return 0;if(this.keys.length<2)return this.keys[0].value;var t=0,n=this.keys.length-1,i=this.keys[t].time,a=this.keys[n].time;if(a<=e){if(this.postWrapMode==Xh.Loop)e=Ti.repeatSE(e,i,a);else{if(this.postWrapMode!=Xh.PingPong)return this.keys[n].value;e=Ti.pingPongSE(e,i,a)}if(e==i)return this.keys[t].value;if(e==a)return this.keys[n].value}else if(e<=i){if(this.preWrapMode==Xh.Loop)e=Ti.repeatSE(e,i,a);else{if(this.preWrapMode!=Xh.PingPong)return this.keys[t].value;Ti.pingPongSE(e,i,a)}if(e==i)return this.keys[t].value;if(e==a)return this.keys[n].value}for(var r=n,o=0;o<this.keys.length;o++)if(this.keys[o].time>=e){r=o;break}if(0<r){t=r-1,n=r;var s=this.keys[n].time-this.keys[t].time,l=(e-this.keys[t].time)/s,h=l*l,u=h*l,d=this.keys[t].value,i=this.keys[n].value,a=3*h-2*u,u=u-h;return(1-a)*d+(u+l-h)*(this.keys[t].outTangent*s)+a*i+u*(this.keys[n].inTangent*s)}return this.keys[0].value}},{key:"AddKey",value:function(e,t){return this.AddKeyFrame(new Gh(e,t))}},{key:"AddKeyFrame",value:function(e){return this.keys.push(e),this.sort(),e}},{key:"Init",value:function(e){this.keys=null==e?[]:e,this.sort()}},{key:"bsearchWithoutRecursion",value:function(e){for(var t,n=0,i=this.keys.length-1;n<=i;){if(t=Math.floor((n+i)/2),e==this.keys[t].time)return t;e>this.keys[t].time?n=t+1:e<this.keys[t].time&&(i=t-1)}return-1}},{key:"sort",value:function(){for(var e,t,n=1;n<this.keys.length;n++)for(e=n;0!=e&&this.keys[e].time<this.keys[e-1].time;)t=this.keys[e],this.keys[e]=this.keys[e-1],this.keys[e-1]=t,e--}}],[{key:"Linear",value:function(e,t,n,i){var a=(i-t)/(n-e);return new r([new Gh(e,t,0,a),new Gh(n,i,a,0)])}},{key:"EaseInOut",value:function(e,t,n,i){return new r([new Gh(e,t,0,0),new Gh(n,i,0,0)])}}]),r}(),qh=function(){T(i,Mi);var n=b(i);function i(e){var t;return S(this,i),(t=n.call(this)).model=e,t}return C(i,[{key:"getTransform",value:function(){return this.model?this.model.transform:null}},{key:"afterUpdateTransform",value:function(e,t){}},{key:"pathOver",value:function(){this.model=this.model}}]),i}(),Zh=function(){function n(e,t){S(this,n),this.curves=e,this.cutscenes=t}return C(n,[{key:"clone",value:function(){for(var e=[],t=0;t<this.cutscenes.length;t++)e.push(this.cutscenes[t].clone());return new n(this.curves,e)}},{key:"clear",value:function(){for(var e=0;e<this.cutscenes.length;e++)this.cutscenes[e].clear();this.cutscenes=[]}},{key:"update",value:function(){for(var e=0;e<this.cutscenes.length;e++){var t=this.cutscenes[e];if(t.Update(),!t.loop&&t.isFinish){var n=c(t.curves);try{for(n.s();!(i=n.n()).done;){var i=i.value;i.target&&i.target.pathOver()}}catch(e){n.e(e)}finally{n.f()}this.cutscenes.splice(e,1),e--}}}},{key:"getCutsceneCount",value:function(){return this.cutscenes.length}},{key:"getCutscene",value:function(e){return this.cutscenes[e]}},{key:"isPathFinish",value:function(){return this.cutscenes.length<=0}},{key:"setEventTarget",value:function(e){var t,n=c(this.cutscenes);try{for(n.s();!(t=n.n()).done;)t.value.setEventTarget(e)}catch(e){n.e(e)}finally{n.f()}}}]),n}(),Kh=function(){T(n,qn);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).fishPathes=[],e}return C(n,[{key:"addFishPath",value:function(e){this.fishPathes.push(e)}},{key:"onUpdate",value:function(){this.owner.timer.callLater(this,this.update)}},{key:"update",value:function(){for(var e=0;e<this.fishPathes.length;e++){var t=this.fishPathes[e];t.update(),t.isPathFinish()&&(this.fishPathes.splice(e,1),e--)}}},{key:"clear",value:function(){for(var e=0;e<this.fishPathes.length;e++)this.fishPathes[e].clear();this.fishPathes=[]}}],[{key:"load",value:function(){this.loadFishPathes(),this.loadFishArray()}},{key:"loadFishPathes",value:function(){null==this.mapFishPath&&(this.mapFishPath={},this.loadPath(this.resourceFishPath,this.mapFishPath,this.listFishPath))}},{key:"loadFishArray",value:function(){null==this.mapFishArray&&(this.mapFishArray={},this.loadPath(this.resourceFishArray,this.mapFishArray,this.listFishArray))}},{key:"loadPath",value:function(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=zn.loader.getRes(e);for(n in a){var r=a[n],o=r.curves,r=r.cutscenes,o=this.loadCurves(o),r=this.loadCutscene(r,o),r=new Zh(o,r);t[n]=r,i.push(r)}}},{key:"createPathByName",value:function(e){return null!=this.mapFishPath[e]?this.mapFishPath[e].clone():null}},{key:"createPathByIndex",value:function(e){return e=Ti.clamp(e,0,this.listFishPath.length),this.listFishPath[e].clone()}},{key:"createArrayByName",value:function(e){return null!=this.mapFishArray[e]?this.mapFishArray[e].clone():null}},{key:"createArrayByIndex",value:function(e){return e=Ti.clamp(e,0,this.listFishArray.length),this.listFishArray[e].clone()}},{key:"getPathCount",value:function(){return this.listFishPath.length}},{key:"getArrayCount",value:function(){return this.listFishArray.length}},{key:"loadCurves",value:function(e){var t,n={};for(t in e){for(var i=e[t],a=[],r=0;r<i.length;r++)a.push(new vn(i[r][0],i[r][1],i[r][2]));var o=new Vh(a);n[t]=o}return n}},{key:"loadCutscene",value:function(e,t){for(var n=[],i=0;i<e.length;i++){var a=new Wh;n.push(a);var r=e[i];a.cutsceneName=r.name,a.loop=r.loop,a.loopCount=r.loopCount,a.resetOnStop=r.resetOnStop,a.resetPlayCountOnStop=r.resetPlayCountOnStop,a.offsetTime=r.offsetTime,a.speedMagnification=r.speedMagnification;for(var o=r.clips,s=0;s<o.length;s++){var l=o[s],h=a.addCurveClip();h.startTime=l.startTime,h.length=l.length,h.updateEvent=l.updateEvent,h.loopClip=l.loopClip,h.activeCalculateOnly=l.activeCalculateOnly;var u=l.targetAction;h.targetName=l.targetName;var d=l.target;"Action_FollowCurve"==u&&((c=new zh).curve=t[d.curve],c.roll=d.roll,c.autoLookDirection=d.autoLookDirection,u=d.targetScale,c.targetScale=new vn(u[0],u[1],u[2]),h.targetAction=c),h.bindCallback();var c=l.animCurve,l=(c.key,c.key),l=new jh(l);l.preWrapMode=c.preWrapMode,l.postWrapMode=c.postWrapMode,h.animCurve=l;var _=d.targetCurve;if(_){var f=new fa,d=new qh(f);h.setTarget(d);for(var g=0;g<_.length;g++){var y=t[_[g]];y&&(y.transform=f.transform)}}}var v=r.events;if(null!=v)for(var p=0;p<v.length;p++){var m=v[p],w=a.addEvent();w.name=m.name,w.startTime=m.startTime,w.targetFunction=m.targetFunction,w.params=m.param}}return n}}]),n}();Kh.resourceFishPath="res/fishdld/fish_path.json",Kh.listFishPath=[],Kh.resourceFishArray="res/fishdld/fish_array_path.json",Kh.listFishArray=[];var Qh=function(){T(t,Vs);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}(),Jh=function(){T(n,Vs);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).rate=[10,20,40,70,100],e}return C(n,[{key:"init",value:function(e){G(z(n.prototype),"init",this).call(this,e),this.stage=-1==this.rate.indexOf(this.hp)?0:this.rate.indexOf(this.hp)}},{key:"resetModel",value:function(){G(z(n.prototype),"resetModel",this).call(this),this.stage=0}},{key:"die",value:function(e,t){this.stage<2?(Cs.I.showCoin(this,t),Cs.I.showMiniExplode(this),this.stage++):this.stage<4?(Cs.I.showCoin(this,t),Cs.I.showCoinBoom3DEffect(this.model.transform.position),this.stage++):G(z(n.prototype),"die",this).call(this,e,t)}},{key:"afterUpdateTransform",value:function(e,t){G(z(n.prototype),"afterUpdateTransform",this).call(this,e,t),vn.scale(this.model.transform.scale,1+.2*this.stage,this.model.transform.scale),this.model.transform.scale=this.model.transform.scale,this.shadow.transform.scale=this.model.transform.scale}}]),n}(),$h=function(){T(o,Vs);var e=b(o);function o(){return S(this,o),e.apply(this,arguments)}return C(o,[{key:"init",value:function(e){G(z(o.prototype),"init",this).call(this,e),this.ani.setSpeed(.5),this.ani.offAllCaller(this),this.ani.once(Je.COMPLETE,this,this.pathOver)}},{key:"die",value:function(e,t){var n=this;G(z(o.prototype),"setDie",this).call(this),this.ani.stop();var i,a=this.fishColliderArr.length-1,r=c(this.fishColliderArr);try{for(r.s();!(i=r.n()).done;)!function(){var e=i.value;n.timer.once(180*a,n,function(){n.fishScene.playCameraShakeLoop(),Cs.I.showCoinBoom3DEffect(e.collider.transform.position),t.isSelf&&is.playSound("F4BY_ExplosionPoint3.wav")}),a--}()}catch(e){r.e(e)}finally{r.f()}this.timer.once(180*this.fishColliderArr.length,this,function(){n.fishScene.stopCameraShakeLoop(),n.showDragonDieUI(t),n.destroy()})}},{key:"showDragonDieUI",value:function(e){var t=g.getItem("fish_die_30UI"),n=(t=t||new ts.fishdld.animation.fish_die_30UI).getChildByName("nb").getChildAt(0);n.font="coin_number.fnt",n.text=this.money.toString(),t.main.play(0,!1),this.fishScene.fight.view.ui_effect_layer.addChild(t),e.isSelf?(t.scale(1.3,1.3),t.pos(Gn.width/2,Gn.height/2)):(t.x=e.coinLabelGlobalPosition.x-1,t.y=1<e.member.position?e.coinLabelGlobalPosition.y+100:e.coinLabelGlobalPosition.y-100,t.scale(.7,.7)),t.timer.once(35/24*1e3,this,this.tweenNumber,[n],!1),t.timer.once(70/24*1e3,this,this.tweenNumber,[n],!1),t.timer.once(4500,this,this.tweenNumber,[n],!1),t.timer.once(0,this,this.playSound,[e,"F4BY_DragonEffect1.wav"],!1),t.timer.once(2e3,this,this.playSound,[e,"F4BY_DragonEffect2.wav"],!1),t.timer.once(83/24*1e3,this,this.playSound,[e,"F4BY_DragonEffect2.wav"],!1),t.timer.once(5e3,this,this.playSound,[e,"F4BY_DragonEffect2.wav"],!1),t.timer.once(160/24*1e3,this,this.hide,[t,e],!1)}},{key:"tweenNumber",value:function(e){Ci.tweenNumber(e,0,this.money/3,500)}},{key:"playSound",value:function(e,t){e.isSelf&&is.playSound(t)}},{key:"hide",value:function(e,t){var n=t.coinLabelGlobalPosition.distance(e.x,e.y);(new As).curveTweenDo(e,new L(e.x,e.y),t.coinLabelGlobalPosition,n,0),pn.to(e,{scaleX:0,scaleY:0},n,null,F.create(this,function(){e.removeSelf(),g.recover("fish_die_30UI",e)}))}}]),o}(),eu=function(){T(t,Vs);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"die",value:function(e,t){this.setDie(),this.playDieAndDestroy(),this.fishScene.playCameraShake(),Cs.I.showCoinBoom3DEffect(this.model.transform.position),this.showGoldenCicadaDieUI(t)}},{key:"showGoldenCicadaDieUI",value:function(t){var n=this,i=g.getItem("fish_die_29UI"),e=(i=i||new ts.fishdld.animation.fish_die_29UI).getChildByName("nb").getChildAt(0);e.font="coin_number.fnt",e.text=this.money.toString(),i.ani2.play(0,!1),this.fishScene.fight.view.ui_effect_layer.addChild(i),t.isSelf?(i.scale(1.3,1.3),i.pos(Gn.width/2,Gn.height/2)):(i.x=t.coinLabelGlobalPosition.x-1,i.y=1<t.member.position?t.coinLabelGlobalPosition.y+100:t.coinLabelGlobalPosition.y-100,i.scale(.7,.7)),i.ani2.timerOnce(4e3,this,function(){var e=t.coinLabelGlobalPosition.distance(i.x,i.y);(new As).curveTweenDo(i,new L(i.x,i.y),t.coinLabelGlobalPosition,e,0),pn.to(i,{scaleX:0,scaleY:0},e,null,F.create(n,function(){i.removeSelf(),g.recover("fish_die_29UI",i)}))})}}]),t}(),tu=function(){T(i,Vs);var e=b(i);function i(){return S(this,i),e.apply(this,arguments)}return C(i,[{key:"die",value:function(e,t){var n=this;G(z(i.prototype),"die",this).call(this,e,t),this.lh=Ns.COIN_BREAK_OUT_EFFECT,this.user=t,zn.loader.create(this.lh,F.create(this,function(){for(var e=Ti.randInt(4,9),t=0;t<e;t++)Gn.timer.once(1500*t,n,function(){n.show3dEffect(),n.showUIEffect()})}))}},{key:"show3dEffect",value:function(){var e=wo.getItemWithType(this.lh,fa),t=e.getChildAt(0).particleSystem;2==this.user.member.position||3==this.user.member.position?(Ti.temp0Vector3.setValue(180,0,0),e.transform.rotate(Ti.temp0Vector3,!0,!1),t.gravityModifier=-Math.abs(t.gravityModifier)):t.gravityModifier=Math.abs(t.gravityModifier),Ti.temp0Vector3.setValue(this.user.globalPosition.x,this.user.globalPosition.y,-40),Ti.sceenPointToWorld(this.user.fight.fishScene.camera,Ti.temp0Vector3,e.transform.position),e.transform.position=e.transform.position,this.user.fight.fishScene.view.addChild(e),wo.recycle(e,this.lh,!1,2e3)}},{key:"showUIEffect",value:function(){var e=wo.getItemWithType("fishdld/fight/mainui/coin_break_out.png",pi);e.anchorX=e.anchorY=.5,e.scale(0,0),e.pos(this.user.globalPosition.x,this.user.globalPosition.y);var t=2==this.user.member.position||3==this.user.member.position?200:-200;pn.to(e,{scaleX:1,scaleY:1,y:e.y+t},300),pn.to(e,{scaleX:0,scaleY:0,y:this.user.globalPosition.y},300,null,F.create(wo,wo.recycle,[e]),1e3),this.user.fight.view.fight_layer.addChild(e)}}]),i}(),nu=function(){T(a,Vs);var e=b(a);function a(){return S(this,a),e.apply(this,arguments)}return C(a,[{key:"die",value:function(e,t){if(G(z(a.prototype),"die",this).call(this,e,t),e==Ps.BulletHit){this.showBubble();var n=c(this.fishScene.fishes);try{for(n.s();!(i=n.n()).done;){var i=i.value;i.lifeState==os.EnterScreen&&(this.showLineRender(i),i.showBubble())}}catch(e){n.e(e)}finally{n.f()}}}}]),a}(),iu=function(){T(o,Vs);var e=b(o);function o(){return S(this,o),e.apply(this,arguments)}return C(o,[{key:"init",value:function(e){G(z(o.prototype),"init",this).call(this,e),this.ani.setSpeed(.5)}},{key:"hit",value:function(e){this.alreadyPlayHitSound||this.ani.setTrigger("special"),G(z(o.prototype),"hit",this).call(this,e)}},{key:"die",value:function(e,t){var n=this;G(z(o.prototype),"setDie",this).call(this),this.ani.stop();var i,a=this.fishColliderArr.length-1,r=c(this.fishColliderArr);try{for(r.s();!(i=r.n()).done;)!function(){var e=i.value;n.timer.once(180*a,n,function(){n.fishScene.playCameraShakeLoop(),Cs.I.showCoinBoom3DEffect(e.collider.transform.position),t.isSelf&&is.playSound("F4BY_ExplosionPoint2.wav")}),a--}()}catch(e){r.e(e)}finally{r.f()}this.timer.once(180*this.fishColliderArr.length,this,function(){n.fishScene.stopCameraShakeLoop(),n.showDeepSeaWhalesDieUI(t),n.destroy()})}},{key:"showDeepSeaWhalesDieUI",value:function(t){var n=this,i=g.getItem("fish_die_29UI");(i=i||new ts.fishdld.animation.fish_die_29UI).getChildByName("fish_icon").skin=Ns.getFishIcon(this.define.fishid);var e=i.getChildByName("nb").getChildAt(0);e.font="coin_number.fnt",e.text=this.money.toString(),i.ani2.play(0,!1),this.fishScene.fight.view.ui_effect_layer.addChild(i),t.isSelf?(i.scale(1.3,1.3),i.pos(Gn.width/2,Gn.height/2)):(i.x=t.coinLabelGlobalPosition.x-1,i.y=1<t.member.position?t.coinLabelGlobalPosition.y+100:t.coinLabelGlobalPosition.y-100,i.scale(.7,.7)),i.ani2.timerOnce(4e3,this,function(){var e=t.coinLabelGlobalPosition.distance(i.x,i.y);(new As).curveTweenDo(i,new L(i.x,i.y),t.coinLabelGlobalPosition,e,0),pn.to(i,{scaleX:0,scaleY:0},e,null,F.create(n,function(){i.removeSelf(),g.recover("fish_die_29UI",i)}))})}}]),o}(),au=function(){T(r,Fh);var t=b(r);function r(){var e;return S(this,r),(e=t.call(this)).fishes=new Array,e.enterScreenFishes=new Array,e.aa=!1,r.instance=u(e),e}return C(r,[{key:"init",value:function(){this.initScene(),this.bindEvent(),this.adjustUI(),Si.event.on(Je.RESIZE,this,this.adjustUI)}},{key:"initScene",value:function(){this.view=wo.getItemWithType(Ns.SCENE_RES,io),this.camera=Ms.getChildByName(this.view,"Main Camera");var e=zn.loader.getRes(Ns.SCENE_ANIMATOR_CONF).find(function(e){return"Main Camera"==e.id});this.cameraAni=new Ss(this.camera,e),this.cameraAni.init(),this.changeSceneBackground(0),Bh.I.sceneLayer.addChild(this.view),this.fishPathManager=this.camera.addComponent(Kh),Kh.load()}},{key:"bindEvent",value:function(){Si.event.on(di.FishSyncNormalFishesResp,this,this.onFishSyncNormalFishes),Si.event.on(di.FishSyncGroupFishesResp,this,this.onFishSyncGroupFishesResp),Si.event.on(di.FishCleanResp,this,this.onFishClearResp),Si.event.on(di.FishNewFish,this,this.onNewFish),Si.event.on(di.FishExplodeResp,this,this.onFishExplodeResp),Si.event.on(di.FishCatchSweepResultResp,this,this.onCatchSweepResp),Si.event.on(di.FishNewfishCall,this,this.onNewFishCall)}},{key:"onNewFish",value:function(e){var t;-1!=e.fishType?(t=new Dh).isArray=!1:(t=new Dh).isArray=!0,t.routeId=e.routeId,t.fishServerIds=e.fishList,t.fishHps=e.fishBlood,this.addRoute([t])}},{key:"onNewFishCall",value:function(e){var t=new Dh;t.isArray=!1,t.routeId=e.fish_path,t.fishServerIds=e.fish_ids,t.fishHps=e.fish_bloods,t.leftTime=e.times,this.addRoute([t],!0)}},{key:"onFishSyncGroupFishesResp",value:function(e){var t;0!=e.fishGroupId&&(this.removeAllFish(),(t=new Dh).isArray=!0,t.routeId=e.fishGroupId,t.fishServerIds=e.fishId,t.fishHps=e.fishBlood,t.leftTime=e.time,this.addRoute([t]))}},{key:"onFishSyncNormalFishes",value:function(e){this.removeAllFish();var n,i=new Array,t=c(e.info);try{for(t.s();!(n=t.n()).done;)!function(){var t=n.value,e=i.find(function(e){if(e.routeId==t.shoalid&&e.leftTime==t.left_time)return!0});e?(e.fishServerIds.push(t.fish_id),e.fishHps.push(t.hp)):((e=new Dh).isArray=!1,e.routeId=t.shoalid,e.leftTime=t.left_time,e.fishServerIds.push(t.fish_id),e.fishHps.push(t.hp),i.push(e))}()}catch(e){t.e(e)}finally{t.f()}this.addRoute(i),zi.I.noticeRequestOtherUserStatus()}},{key:"addRoute",value:function(e,s){var n,l=this,t=c(e);try{for(t.s();!(n=t.n()).done;){var i=function(){var r=n.value;Si.DEBUG;var i=r.isArray?Kh.createArrayByName(r.routeId.toString()):Kh.createPathByName(r.routeId.toString());if(!i)return console.warn("can't find route ",r.routeId),"continue";l.fishPathManager.addFishPath(i);for(var o=0,e=0;e<i.getCutsceneCount();e++){var t=function(e){var a=i.getCutscene(e);0<r.leftTime?(a.continue(-(a.getTotalTime()-r.leftTime)),s&&a.setSpeed(0)):a.play();for(var t=0;t<a.curves.length;t++){var n=function(e){if(o>=r.fishServerIds.length)return{v:{v:{v:void 0}}};if(r.fishHps[o]<=0)return"continue";var n=a.curves[e],i=parseInt(n.targetName);return null==i||NaN==i||i<1||i==Bs.Dragon&&0<r.leftTime?"continue":void l.getFishInPool(i,F.create(l,function(e,t){t?(l.fishes.push(t),t.uniqueId=r.fishServerIds[e],t.hp=r.fishHps[e],n.setTarget(t),t.setCurveClip(n),a.setEventTarget(t),s&&t.onCallup(F.create(l,function(){0==a.getSpeed()&&a.setSpeed(1)}))):console.warn("can't load fishid:"+i)},[o++]))}(t);if("continue"!==n&&"object"===h(n))return n.v}}(e);if("object"===h(t))return t.v}}();if("continue"!==i&&"object"===h(i))return i.v}}catch(e){t.e(e)}finally{t.f()}}},{key:"onFishExplodeResp",value:function(e){var t=this.fight.getUser(e.uid);if(t&&(t.updateUserMoney(e.score),0!=e.fishes.length))for(var n,i=e.fishes,a=0;a<i.length;a++)0!=i[a].score&&((n=this.getFishByUniqueId(i[a].fishId))&&(n.money=i[a].score,n.die(Ps.BulletHit,t)))}},{key:"onCatchSweepResp",value:function(e){var t=e.fishes,n=this.fight.getUser(e.uid);if(n){n.updateUserMoney(e.uScore);var i=this.getFishByUniqueId(e.boomFishId);if(i){n.isSelf&&is.playSound("F4BY_LightLink.wav");for(var a,r=0;r<t.length;r++)0!=t[r].score&&((a=this.getFishByUniqueId(t[r].fishId))&&(a!=i&&i.showLineRender(a),a.showBubble(),0<t[r].score&&(a.uniqueId==i.uniqueId?(a.money=e.totalScore,a.die(Ps.BulletHit,n)):(a.money=t[r].score,a.die(Ps.Electric,n)))))}}}},{key:"onFishClearResp",value:function(e){if(1==e.style){var t,n=c(this.fishPathManager.fishPathes);try{for(n.s();!(t=n.n()).done;){var i,a=c(t.value.cutscenes);try{for(a.s();!(i=a.n()).done;)i.value.setSpeed(15)}catch(e){a.e(e)}finally{a.f()}}}catch(e){n.e(e)}finally{n.f()}Cs.I.showFishArrayComing(),this.changeSceneBackground(5e3)}}},{key:"getFishInPool",value:function(t,n){var i=this,e=wo.getItem(r.FishPoolSign+t);if(e)return e.init(this),void n.runWith(e);var a=zn.loader.getRes(Ns.FISH_DEFINE_CONF).find(function(e){if(e.fishid==t)return!0});if(null!=a){switch(t){case Bs.Puffer:e=new Jh;break;case Bs.Dragon:e=new $h;break;case Bs.ElectricCrab:case Bs.FreeCrab:case Bs.RocketCrab:e=new Us;break;case Bs.GoldenCicada:e=new eu;break;case Bs.DeepSeaWhales:e=new iu;break;case Bs.Octopus:e=new tu;break;case Bs.Electric:e=new nu;break;default:e=new Qh}e.load(a,F.create(this,function(e){e.init(i),n.runWith(e)}))}else n.run()}},{key:"getFishByUniqueId",value:function(t){return this.fishes.find(function(e){return e.uniqueId==t})}},{key:"removeFish",value:function(t){this.fishes.remove(function(e){return e.uniqueId==t.uniqueId}),this.enterScreenFishes.remove(function(e){return e.uniqueId==t.uniqueId})}},{key:"recycleFish",value:function(e){wo.recover(r.FishPoolSign+e.define.fishid,e)}},{key:"removeAllFish",value:function(){this.fishPathManager.clear();var e,t=c(this.fishes.concat());try{for(t.s();!(e=t.n()).done;)e.value.destroy()}catch(e){t.e(e)}finally{t.f()}this.fishes=[]}},{key:"changeSceneBackground",value:function(r){var t,n,o=this;this.isChangingBg||(this.isChangingBg=!0,t=function(e,t,n){var i,a;at.onIOS?e.timer.once(5e3,o,function(){n.run()}):(i=t?0:.5,a=t?.5:0,e.getChildByName("front").meshRenderer.material.albedoColorA=i,pn.to(e.getChildByName("front").meshRenderer.material,{albedoColorA:a},r),i=t?0:1,a=t?1:0,e.getChildByName("back").meshRenderer.material.albedoColorA=i,pn.to(e.getChildByName("back").meshRenderer.material,{albedoColorA:a},r,null,n))},n=function(){if(!o.sceneBg)return Ns.getSceneBackground(Ti.randInt(1,4));for(;;){var e=Ns.getSceneBackground(Ti.randInt(1,4));if(o.sceneBg.name!=e)return e}}(),zn.loader.create(n,F.create(this,function(e){o.sceneBg&&t(o.sceneBg,!1,F.create(o,function(e){e.removeSelf()},[o.sceneBg])),o.sceneBg=e,o.sceneBg.name=n,t(e,!0,F.create(o,function(){o.isChangingBg=!1})),o.view.addChild(e),o.adjustUI()})),0<r&&zn.loader.create(Ns.SWITCH_SCENE_WATER_EFFECT,F.create(this,function(){is.playSound("F4BY_Wave.wav");var e=wo.getItemWithType(Ns.SWITCH_SCENE_WATER_EFFECT,fa);o.view.addChild(e);var t=new vn(10,0,0),n=new vn(-15,0,0);e.transform.position=t,pn.to(e.transform,{position:n},r,null,F.create(o,function(){wo.recycle(e,Ns.SWITCH_SCENE_WATER_EFFECT)}))})))}},{key:"playCameraShake",value:function(){this.cameraAni.setTrigger("shake")}},{key:"playCameraShakeLoop",value:function(){this.cameraAni.setValue("shake_loop",!0)}},{key:"stopCameraShakeLoop",value:function(){this.cameraAni.setValue("shake_loop",!1)}},{key:"adjustUI",value:function(){this.sceneBg&&(this.sceneBg.transform.scale.x=this.camera.aspectRatio/($s.width/$s.height),this.sceneBg.transform.scale=this.sceneBg.transform.scale)}},{key:"getResource",value:function(){return[new cs(Ns.SCENE_RES),new cs(Ns.FISH_DEFINE_CONF),new cs(Ns.FISH_ANIMATOR_CONF),new cs(Ns.SCENE_ANIMATOR_CONF),new cs(Ns.ROCKET_TRAIL_EFFECT),new cs(Kh.resourceFishPath),new cs(Kh.resourceFishArray)].concat(ws.res)}},{key:"destroy",value:function(){}}]),r}();au.FishPoolSign="FishPoolSign_FishId_";var ru=function(){T(n,ts.fishdld.fight.FishPreviewDialogUI);var e=b(n);function n(){return S(this,n),e.apply(this,arguments)}return C(n,[{key:"showFish",value:function(e){var t=this;Si.defaultLoadingView.show(),zn.loader.load("fishdld/fight/dialog.atlas",F.create(this,function(){t.alreadyInit||t.init(),t.alreadyInit=!0,t.setFish(e),G(z(n.prototype),"popup",t).call(t),Si.defaultLoadingView.hide()}))}},{key:"init",value:function(){var e=this;this.popupEffect=this.closeEffect=null,this.stage.on(Je.MOUSE_DOWN,this,function(){e.isMouseDown=!0}),this.stage.on(Je.MOUSE_UP,this,function(){e.isMouseDown=!1}),this.stage.on(Je.MOUSE_MOVE,this,this.onMoseMove),Si.event.on(Je.RESIZE,this,this.adJustUI),this.scene3d=new io,this.fish_point.addChild(this.scene3d),this.camera=new ir(0,.1,1e3),this.scene3d.addChild(this.camera),this.camera.transform.translate(new vn(0,-.2,50)),this.camera.orthographic=!0,this.camera.orthographicVerticalSize=4.5,this.camera.clearFlag=ja.CLEARFLAG_DEPTHONLY}},{key:"setFish",value:function(t){var n=this,e=zn.loader.getRes(Ns.FISH_DEFINE_CONF);this.define=e.find(function(e){return e.fishid==t}),this.fish_name.text=this.define.name,this.kind.text=1==this.define.kind?"（普通）":"（特殊）",this.rate.text=this.define.rate_desc,this.desc.text=this.define.desc,au.instance.getFishInPool(t,F.create(this,function(e){e.resetModel(),e.model.transform.rotate(new vn(90,180,0),!0,!1),e.model.transform.scale=new vn(n.define.preview_scale,n.define.preview_scale,n.define.preview_scale),e.model.transform.position=new vn(n.define.preview_pos[0],n.define.preview_pos[1],n.define.preview_pos[2]),n.fish=e,n.scene3d.addChild(e.model),n.adJustUI()}))}},{key:"onMoseMove",value:function(){this.isMouseDown&&this.fish&&this.define.fishid!=Bs.Dragon&&(this.curMouseX&&(Ti.temp0Vector3.setValue(0,0,this.curMouseX-this.stage.mouseX),this.fish.model.transform.rotate(Ti.temp0Vector3,!0,!1)),this.curMouseX=this.stage.mouseX)}},{key:"adJustUI",value:function(){var e;this.fish&&this.camera.aspectRatio<14/9&&(e=this.camera.aspectRatio/(14/9),Ti.temp0Vector3.setValue(this.define.preview_scale*e,this.define.preview_scale*e,this.define.preview_scale*e),this.fish.model.transform.scale=Ti.temp0Vector3)}},{key:"close",value:function(){G(z(n.prototype),"close",this).call(this),this.fish.model.removeSelf(),this.fish.destroy(),this.fish=null}}],[{key:"I",get:function(){return n._instance=!n._instance?new n:n._instance}}]),n}(),ou=function(){T(i,ts.fishdld.fight.HelpDialogUI);var e=b(i);function i(){return S(this,i),e.apply(this,arguments)}return C(i,[{key:"popup",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];Si.defaultLoadingView.show(),zn.loader.load("fishdld/fight/dialog.atlas",F.create(this,function(){e.alreadyInit||e.init(),e.alreadyInit=!0,G(z(i.prototype),"popup",e).call(e,t,n),Si.defaultLoadingView.hide()}))}},{key:"init",value:function(){this.initList(),this.initBtn(),this.selectTab(0)}},{key:"initList",value:function(){this.normal_fish_list.array=[],this.big_fish_list.array=[],this.special_fish_list.array=[];var t=c(zn.loader.getRes(Ns.FISH_DEFINE_CONF));try{for(t.s();!(n=t.n()).done;){var e=n.value,n={fishid:e.fishid,icon:Ns.getFishIcon(e.fishid),fish_name:e.name,rate:e.rate_desc};e.kind==Zs.Normal?this.normal_fish_list.array.push(n):e.kind==Zs.Large?this.big_fish_list.array.push(n):e.kind==Zs.Special&&this.special_fish_list.array.push(n)}}catch(e){t.e(e)}finally{t.f()}this.normal_fish_list.renderHandler=this.createRenderHandler(),this.big_fish_list.renderHandler=this.createRenderHandler(),this.special_fish_list.renderHandler=this.createRenderHandler()}},{key:"initBtn",value:function(){for(var e=0;e<3;e++)this.getChildByName("tab_"+e).on(Je.CLICK,this,this.selectTab,[e])}},{key:"selectTab",value:function(e){for(var t=0;t<3;t++)this.getChildByName("tab_"+t).index=t==e?1:0,this.getChildByName("panel_"+t).visible=t==e}},{key:"createRenderHandler",value:function(){var t=this;return new F(this,function(e){e.on(Je.CLICK,t,function(){ru.I.showFish(e.dataSource.fishid)})},null,!1)}}],[{key:"I",get:function(){return i._instance=!i._instance?new i:i._instance}}]),i}(),su=function(){T(i,ts.fishdld.fight.BigPrizeRecordDialogUI);var e=b(i);function i(){return S(this,i),e.apply(this,arguments)}return C(i,[{key:"popup",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];Si.defaultLoadingView.show(),zn.loader.load("fishdld/fight/dialog.atlas",F.create(this,function(){e.alreadyInit||e.init(),e.alreadyInit=!0,G(z(i.prototype),"popup",e).call(e,t,n),zi.I.send(new di.GetFishGameAwardInfoReq),Si.event.on(di.GetFishGameAwardInfoResp,e,e.onGetFishGameAwardInfoResp)}))}},{key:"init",value:function(){this.tab_all.on(Je.CLICK,this,this.onClickTab,[this.tab_all]),this.tab_my.on(Je.CLICK,this,this.onClickTab,[this.tab_my]),this.all_list.vScrollBarSkin=this.my_list.vScrollBarSkin="",this.all_list.elasticEnabled=this.my_list.elasticEnabled=!0,this.all_list.renderHandler=this.my_list.renderHandler=F.create(this,function(e,t){e.getChildByName("bg").visible=t%2==1},null,!1)}},{key:"onGetFishGameAwardInfoResp",value:function(e){this.all_list.array=e.infos,this.all_list.repeatY=this.all_list.array.length,this.my_list.array=[];var t=c(e.infos);try{for(t.s();!(n=t.n()).done;){var n=n.value;n.uid==Si.data.account.userid&&this.my_list.array.push(n)}}catch(e){t.e(e)}finally{t.f()}this.my_list.repeatY=this.my_list.array.length,Si.defaultLoadingView.hide()}},{key:"onClickTab",value:function(e){e==this.tab_all?(this.tab_all.index=1,this.tab_my.index=0,this.all_list.visible=!0,this.my_list.visible=!1,this.no_record.visible=!1):(this.tab_all.index=0,this.tab_my.index=1,this.all_list.visible=!1,0==this.my_list.array.length?(this.my_list.visible=!1,this.no_record.visible=!0):(this.my_list.visible=!0,this.no_record.visible=!1))}}],[{key:"I",get:function(){return i._instance=!i._instance?new i:i._instance}}]),i}(),lu=function(){T(i,ts.fishdld.fight.SettingDialogUI);var e=b(i);function i(){return S(this,i),e.apply(this,arguments)}return C(i,[{key:"popup",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];Si.defaultLoadingView.show(),zn.loader.load("fishdld/fight/dialog.atlas",F.create(this,function(){e.alreadyInit||e.init(),e.alreadyInit=!0,G(z(i.prototype),"popup",e).call(e,t,n),Si.defaultLoadingView.hide()}))}},{key:"init",value:function(){var e=this;this.effect_btn.on(Je.CLICK,this,function(){e.effect_btn.index=0==e.effect_btn.index?1:0,is.soundVolume=e.effect_btn.index}),this.music_btn.on(Je.CLICK,this,function(){e.music_btn.index=0==e.music_btn.index?1:0,is.musicVolume=e.music_btn.index})}}],[{key:"I",get:function(){return i._instance=!i._instance?new i:i._instance}}]),i}(),hu=function(){T(n,ts.fishdld.fight.LotteryDialogUI);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).angles=[0,60,120,180,240,300],e.step2Pos=[[287,151],[570,151],[853,151],[287,453],[570,453],[853,453]],e}return C(n,[{key:"pop",value:function(e){this.alreadyInit||(this.shells=this._children,Si.event.on(di.FreePoolLotteryDrawResp,this,this.onFreePoolLotteryDrawResp),this.alreadyInit=!0),this.freePrizeDialog=e,this.prizePool=this.freePrizeDialog.resp.award_config[this.freePrizeDialog.selectedLevel].infos,G(z(n.prototype),"popup",this).call(this,!1,!1),this.resetAllShellStatus(),this.step1()}},{key:"step1",value:function(){function n(){a+=i.timer.delta;for(var e,t=0;t<i.shells.length;t++)1e3<=a?(i.shells[t].x=i.width/2,i.shells[t].y=i.height/2):(e=(1e3-a)/1e3,i.angles[t]+=i.timer.delta/5,i.shells[t].x=i.width/2+300*e*Math.cos(i.angles[t]/180*Math.PI),i.shells[t].y=i.height/2+300*e*Math.sin(i.angles[t]/180*Math.PI));1e3<=a&&(i.timer.clear(i,n),i.timer.once(200,i,i.step2))}var i=this,a=0;this.timer.frameLoop(1,this,n),is.playSound("F4BY_FreeLotteryRotate.wav")}},{key:"step2",value:function(){for(var t=this,e=0;e<this.shells.length;e++)this.timer.once(100*e,this,function(e){pn.to(t.shells[e],{x:t.step2Pos[e][0],y:t.step2Pos[e][1]},100),is.playSound("F4BY_FreeLotteryMove.wav")},[e]);this.timer.once(1e3,this,this.step3)}},{key:"step3",value:function(){for(var t=this,e=0;e<this.shells.length;e++)this.shells[e].once(Je.CLICK,this,function(e){t.selectedSell=t.shells[e],t.offAllShellClickEvent();e=new di.FreePoolLotteryDrawReq;e.award_type=t.freePrizeDialog.selectedLevel+1,zi.I.send(e),Si.defaultLoadingView.show()},[e])}},{key:"onFreePoolLotteryDrawResp",value:function(t){t.uid==Si.data.account.userid&&(Si.defaultLoadingView.hide(),this.freePrizeDialog.updateProgressValue(t.player_money),this.prize=this.prizePool.find(function(e){return e.award_id==t.award_result[1]}),is.playSound("F4BY_FreeLotteryOpen.wav"),this.selectedSell.prize_icon.skin="fishdld/fight/dialog/prize_"+this.prize.award_type+".png",this.selectedSell.prize_name.text=this.prize.award_num+(this.prize.award_type==du.Coin?"金币":"召唤卷"),this.selectedSell.ani1.play(0,!1),this.selectedSell.ani2.play(0,!1),this.selectedSell.ani1.once(Je.COMPLETE,this,this.step4),this.prize.award_type==du.Ticket?gu.instance.addCallTicketNum(this.prize.award_num):gu.instance.getSelfUser().addMoney(this.prize.award_num))}},{key:"step4",value:function(){var t=this,n=this.prize,e=this.prizePool.filter(function(e){return e.award_id!=n.award_id}).concat();e.sort(function(){return.5<Math.random()?1:-1});for(var i,a=0;a<this.shells.length;a++)this.shells[a]!=this.selectedSell&&(i=e.pop(),this.shells[a].prize_icon.skin="fishdld/fight/dialog/prize_"+i.award_type+".png",this.shells[a].prize_name.text=i.award_num+(i.award_type==du.Coin?"金币":"召唤卷"),this.shells[a].ani1.play(0,!1));this.timer.once(1500,this,function(){for(var e=0;e<t.shells.length;e++)t.shells[e]!=t.selectedSell?pn.to(t.shells[e],{alpha:0},500):pn.to(t.shells[e],{x:t.width/2,y:t.height/2},500)}),this.timer.once(3e3,this,function(){var e=new L;e.copy(gu.instance.getSelfUser().coinGlobalPosition),t.globalToLocal(e),pn.to(t.selectedSell,{x:e.x,y:e.y,scaleX:0,scaleY:0},300,null,F.create(t,t.close))})}},{key:"offAllShellClickEvent",value:function(){for(var e=0;e<this.shells.length;e++)this.shells[e].offAll(Je.CLICK)}},{key:"resetAllShellStatus",value:function(){for(var e=0;e<this.shells.length;e++)this.shells[e].scale(1.7,1.7),this.shells[e].alpha=1,this.shells[e].ani1.gotoAndStop(0),this.shells[e].ani2.gotoAndStop(0)}}],[{key:"I",get:function(){return n._instance=!n._instance?new n:n._instance}}]),n}(),uu=function(){T(i,ts.fishdld.fight.FreePrizeDialogUI);var t=b(i);function i(){var e;return S(this,i),(e=t.apply(this,arguments)).levelNames=["普通抽奖","青铜抽奖","白银抽奖","黄金抽奖"],e.helpDialog=new ts.fishdld.fight.FreePrizeHelpDialogUI,e}return C(i,[{key:"popup",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];Si.defaultLoadingView.show(),zn.loader.load("fishdld/fight/dialog.atlas",F.create(this,function(){e.alreadyInit||e.init(),e.alreadyInit=!0,G(z(i.prototype),"popup",e).call(e,t,n),is.playSound("F4BY_FreeLotteryChange.wav"),e.bindEvent(),e.setAllShellVisible(!1)}))}},{key:"bindEvent",value:function(){Si.event.offAllCaller(this),Si.event.on(di.GetFreePoolAwardInfoResp,this,this.onGetFreePoolAwardInfoResp),Si.event.on(di.ChangeFreePoolSwitchResp,this,this.onChangeFreePoolSwitchResp),Si.event.on(di.UpdateFreePoolPlayerMoneyResp,this,this.onUpdateFreePoolPlayerMoneyResp),zi.I.send(new di.GetFreePoolAwardInfoReq)}},{key:"init",value:function(){var t=this;this.switch.on(Je.CLICK,this,function(){var e=new di.ChangeFreePoolSwitchReq;e.free_pool_switch=0==t.switch.index?1:0,zi.I.send(e)}),this.lottery_btn.on(Je.CLICK,this,this.onClickLotteryBtn),this.help_btn.on(Je.CLICK,this,function(){t.helpDialog.popup()});for(var e=0;e<6;e++)this.levels.getChildAt(e).off(Je.CLICK,this,this.selectLevel),this.levels.getChildAt(e).on(Je.CLICK,this,this.selectLevel,[e])}},{key:"setAllShellVisible",value:function(e){for(var t=0;t<6;t++){var n=this.shell_box.getChildAt(t);n.visible=e,n.ani1.gotoAndStop(0)}}},{key:"selectLevel",value:function(n){var i=this;this.selectedLevel=n,this.updateProgressValue(),this.setAllShellVisible(!0);for(var e=0;e<6;e++)this.levels.getChildAt(e).index=n==e?1:0,this.timer.once(50*e,this,function(e){var t=i.shell_box.getChildAt(e),e=i.resp.award_config[n].infos[e];t.prize_icon.skin="fishdld/fight/dialog/prize_"+e.award_type+".png",t.prize_name.text=e.award_num+(1==e.award_type?"金币":"召唤卷"),t.ani1.play(0,!1)},[e])}},{key:"onGetFreePoolAwardInfoResp",value:function(e){this.cur_prize.text=Ci.toThousands(e.player_money),this.switch.index=e.free_pool_switch,this.resp=e,this.timer.once(300,this,this.selectLevel,[this.selectedLevel||0]),Si.defaultLoadingView.hide()}},{key:"onChangeFreePoolSwitchResp",value:function(e){this.switch.index=e.free_pool_switch}},{key:"onUpdateFreePoolPlayerMoneyResp",value:function(e){this.resp.player_money=e.player_money,this.updateProgressValue()}},{key:"onClickLotteryBtn",value:function(){var e=this;if((n=this.resp.award_config[this.selectedLevel].money-this.resp.player_money)<=0)if(this.selectedLevel==this.levelNames.length-1)hu.I.pop(this);else{for(var t=this.selectedLevel+1;t<this.levelNames.length;t++){var n,i=this.resp.award_config[t];if(0<(n=this.resp.award_config[t].money-this.resp.player_money))return void js.I.showInfo("您距离"+this.levelNames[i.type-1]+"还差"+n+"金币\n您确定继续抽奖吗？",F.create(this,function(){hu.I.pop(e)}))}hu.I.pop(this)}else js.I.showInfo("还需 "+n+" 金币才能抽奖哦")}},{key:"updateProgressValue",value:function(e){this.resp.player_money=e||this.resp.player_money,this.progress_value.text=this.resp.player_money+"/"+this.resp.award_config[this.selectedLevel].money;e=this.resp.player_money/this.resp.award_config[this.selectedLevel].money;1<e?e=1:0==e&&(e=1e-7),this.progress_bar.width=220*e}}],[{key:"I",get:function(){return i._instance=!i._instance?new i:i._instance}}]),i}(),du=function e(){S(this,e)};du.Coin=1,du.Ticket=2;var cu=function(){function i(){S(this,i)}return C(i,null,[{key:"getBody",value:function(e,t){for(var n in i)if(i[n].error==e)return i[n].body[t];return"未知错误"}}]),i}();cu.LoginFailedNomoney={error:20107,body:["金币不足"]},cu.JoinFailedGaming={error:20108,body:["牌桌正在游戏中"]},cu.JoinFailedMaxClient={error:20109,body:["牌桌达到最大人数"]},cu.LoginFailedFull={error:20110,body:[""]},cu.JoinFailedPosition={error:20111,body:["该座位有人"]},cu.LoginFailedTimeout={error:20112,body:["登录超时"]},cu.LoginFailedAuth={error:20113,body:["账号密码错误"]},cu.LoginFailedInactive={error:20114,body:["账号未激活"]},cu.LoginFailedSuperuser={error:20115,body:["管理员无法进入游戏"]},cu.LoginFailedNousemoney={error:20116,body:[""]},cu.LoginFailedClosed={error:20117,body:["房间已关闭"]},cu.LoginFailedGuest={error:20118,body:["游客登录失败,请升级为正式用户!"]},cu.LoginFailedNotexist={error:20119,body:["账号不存在"]},cu.LoginFromSomewhere={error:20120,body:["帐号在其他地方登录"]},cu.LoginFailedOtherroom={error:20121,body:["账号正在其他房间"]},cu.LoginFailedLowlv={error:20122,body:[""]},cu.LoginFailedIp={error:20123,body:["您的IP被限制"]},cu.LoginFailedX={error:20124,body:["未知的错误(错误号: 13)"]},cu.LoginFailedAssetsover={error:20125,body:["资产过多请移步高一级房间"]},cu.Loadmoney={error:20126,body:[""]},cu.LoadmoneyFail={error:20127,body:["读取金币失败"]},cu.LoginFailedMaxloseday={error:20128,body:["您今天的输赢累计已经超过输赢限制，请明天再次游戏"]},cu.LoginFailedMaxlosegame={error:20129,body:["您本次的输赢已经超过限制！"]},cu.LoginFailedLeaving={error:20130,body:["进入房间登录失败:结算未完成！"]},cu.SitFailed={error:20131,body:["消息格式不正确！","牌桌创建失败！","本桌已有相同ip！","已坐满！","已在游戏中！","密码不正确或者钱不够！","还未退出！"]};var _u,fu=function(){T(t,Ah);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}(),gu=function(){T(n,Ph);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).timer=new Cn,e.noticeQueue=new Array,e.isShowNotice=!1,e.currentHundredsOfMillionsMoney=0,e.fishScene=new au,e.fishScene.fight=u(e),n.instance=u(e),e}return C(n,[{key:"init",value:function(){this.initFunctionBtn(),this.initScene(),this.bindEvent(),this.loopTestNotice(),Cs.I.init(this),zi.I.loginGame(this.args.room),Si.defaultLoadingView.show("分配房间中...",F.create(this,this.closeBrowser)),is.playMusic("F4BY_BG.mp3")}},{key:"initScene",value:function(){this.fishScene.init(),this.view.zOrder=100,this.adjustUI(),Si.event.on(Je.RESIZE,this,this.adjustUI)}},{key:"bindEvent",value:function(){Si.event.on(Ii.SocketClose,this,this.onSocketClose),Si.event.once(di.GameLoginFailResp,this,this.gameLoginFailResp),Si.event.on(di.GameEnterResp,this,this.onGameEnterResp),Si.event.on(di.FishNpcControlResp,this,this.onNpcControllerResp),Si.event.on(di.UserEnterResp,this,this.onUserEnterResp),Si.event.on(di.UserLeaveResp,this,this.onUserLeaveResp),Si.event.on(di.GetHundredsOfMillionsInfoResp,this,this.onGetHundredsOfMillionsInfoResp),Si.event.on(di.HundredsOfMillionsAwardInfoResp,this,this.onHundredsOfMillionsAwardInfoResp),Si.event.on(di.GetCallTicketNumResp,this,this.onGetCallTicketNumResp),Si.event.on(di.UseCallTicketResp,this,this.onUseCallTicketResp)}},{key:"onGameEnterResp",value:function(e){if(this.gameEnterResp=e,this.isReconect){this.isReconect=!1;for(var t=0;t<4;t++)this.getUserByPosition(t).leaveGame()}this.alreadyInitBtn||(this.initOperationBtn(),this.initShootEvent(),this.alreadyInitBtn=!0),this.initUsers(e.memberinfos),zi.I.send(new di.FishSyncGroupFishesReq),zi.I.send(new di.FishSyncNormalFishesReq),zi.I.send(new di.GetCallTicketNumReq),this.waitingExitGame||Si.defaultLoadingView.hide(),this.initHundredsOfMillionsInfo()}},{key:"initHundredsOfMillionsInfo",value:function(){this.timer.clear(this,this.updateHundredsOfMillionsMoney),this.timer.loop(5e3,this,this.updateHundredsOfMillionsMoney),this.getHundredsOfMillionsInfo(),this.timer.clear(this,this.getHundredsOfMillionsInfo),this.timer.loop(2e4,this,this.getHundredsOfMillionsInfo)}},{key:"getHundredsOfMillionsInfo",value:function(){zi.I.send(new di.GetHundredsOfMillionsInfoReq)}},{key:"onGetHundredsOfMillionsInfoResp",value:function(e){this.updateHundredsOfMillionsMoney(e.num)}},{key:"updateHundredsOfMillionsMoney",value:function(e){void 0===e&&(e=this.currentHundredsOfMillionsMoney+5+45*Math.random()),Ci.tweenNumber(this.view.ywhj_label,this.currentHundredsOfMillionsMoney,e,1e3,50,2),this.currentHundredsOfMillionsMoney=e}},{key:"onHundredsOfMillionsAwardInfoResp",value:function(n){var i,a,e;n.uid==Si.data.account.userid&&((i=(i=g.getItem("get_ywhj_effect"))||new ts.fishdld.animation.get_ywhj_effectUI).closeDialogOnSide=!1,i.money.font="coin_number.fnt",i.popup(),i.ani1.play(0,!1),i.ani1.once(Je.COMPLETE,i,i.close),a=0,e=function(){var e=n.money/3*a,t=n.money/3*(a+1);Ci.tweenNumber(i.money,e,t,500),a++},i.timer.once(62/24*1e3,this,e,null,!1),i.timer.once(4125,this,e,null,!1),i.timer.once(136/24*1e3,this,e,null,!1),this.getSelfUser().addMoney(n.money))}},{key:"onGetCallTicketNumResp",value:function(e){this.view.callup_num.text=e.call_ticket_num.toString()}},{key:"addCallTicketNum",value:function(e){this.view.callup_num.text=(Number(this.view.callup_num.text)+e).toString()}},{key:"onUseCallTicketResp",value:function(e){this.view.callup_num.text=e.call_ticket_num.toString()}},{key:"initFunctionBtn",value:function(){var e=this;this.view.show_group_btn.on(Je.CLICK,this,function(){e.view.show_group_btn.visible=!1,e.view.hide_group_btn.visible=!0,pn.to(e.view.right_box,{x:-295},200)}),this.view.hide_group_btn.on(Je.CLICK,this,function(){e.view.show_group_btn.visible=!0,e.view.hide_group_btn.visible=!1,pn.to(e.view.right_box,{x:65},300)}),this.view.help_btn.on(Je.CLICK,this,function(){ou.I.popup()}),this.view.big_prize_btn.on(Je.CLICK,this,function(){su.I.popup()}),this.view.setting_btn.on(Je.CLICK,this,function(){lu.I.popup()}),this.view.free_prize_btn.on(Je.CLICK,this,function(){uu.I.popup()}),this.view.callup_btn.on(Je.CLICK,this,function(){Number(e.view.callup_num.text)?zi.I.send(new di.UseCallTicketReq):js.I.showInfo("您的召唤卷不足")}),this.view.exit_btn.on(Je.CLICK,this,function(){e.exitGame()})}},{key:"initOperationBtn",value:function(){this.view.speed_btn.on(Je.CLICK,this,this.onClickSpeedBtn),this.view.auto_fire_btn.on(Je.CLICK,this,this.onClickAutoFireBtn),this.view.lock_big_btn.on(Je.CLICK,this,this.onClickLockFishKindBtn,[Zs.Large]),this.view.lock_special_btn.on(Je.CLICK,this,this.onClickLockFishKindBtn,[Zs.Special]),this.view.lock_cancel_btn.on(Je.CLICK,this,this.onClickLockCancelBtn)}},{key:"onClickSpeedBtn",value:function(){this.getSelfUser().gun&&this.getSelfUser().gun.canUserChangeFireSpeed&&(this.getSelfUser().status.fireSpeed=-1,zi.I.noticeSpeedChange(this.getSelfUser().member.uid,this.getSelfUser().status.fireSpeed))}},{key:"onClickAutoFireBtn",value:function(){this.getSelfUser().status.isAutoFire=!this.getSelfUser().status.isAutoFire}},{key:"onClickLockFishKindBtn",value:function(e){var t=this.getSelfUser().status;t.lockKind=e,zi.I.noticeClickLockFishKindBtn(this.getSelfUser().member.uid,t.lockKind)}},{key:"onClickLockCancelBtn",value:function(){this.getSelfUser().status.lockKind=null,this.view.lock_cancel_btn.disabled=!0}},{key:"initShootEvent",value:function(){var t=this;this.view.fight_layer.on(Je.MOUSE_DOWN,this,function(){var e=t.getSelfUser();e.mousePoint.x=Gn.mouseX,e.mousePoint.y=Gn.mouseY,e.gun.onMouseDown(),zi.I.noticeMouseAction(e.member.uid,Vi.MouseDown,e.mousePoint.x,e.mousePoint.y)}),this.view.fight_layer.on(Je.MOUSE_UP,this,function(){var e=t.getSelfUser();e.mousePoint.x=Gn.mouseX,e.mousePoint.y=Gn.mouseY,e.gun.onMouseUp(),zi.I.noticeMouseAction(e.member.uid,Vi.MouseUp,e.mousePoint.x,e.mousePoint.y)}),this.view.fight_layer.on(Je.MOUSE_MOVE,this,function(){var e=t.getSelfUser();e.mousePoint.x=Gn.mouseX,e.mousePoint.y=Gn.mouseY,e.gun.onMouseMove(),e.status.isMouseDown&&zi.I.noticeMouseAction(e.member.uid,Vi.MouseMove,e.mousePoint.x,e.mousePoint.y)})}},{key:"initUsers",value:function(e){this.users=[];var t=e.find(function(e){return e.uid==Si.data.account.userid});if(2==t.position||3==t.position){this.isMirror=!0;var n=c(e);try{for(n.s();!(i=n.n()).done;){var i=i.value;0==i.position?i.position=3:1==i.position?i.position=2:2==i.position?i.position=1:3==i.position&&(i.position=0)}}catch(e){n.e(e)}finally{n.f()}}else this.isMirror=!1;var a=c(e);try{for(a.s();!(o=a.n()).done;){var r=o.value,o=this.view.user_layer.getChildByName("seat_"+r.position).getComponent(Js);o.setData(this,r),o.isSelf&&(this.myUserStatus?((this.myUserStatus.user=o).status=this.myUserStatus,o.gun.serverRotation=this.myUserStatus.gunRotation):o.status.fireSpeed=2),this.users.push(o)}}catch(e){a.e(e)}finally{a.f()}}},{key:"onUserEnterResp",value:function(e){var t=e.memberinfo[0];this.getUser(t.uid)&&this.getUser(t.uid).leaveGame(),this.isMirror&&(0==t.position?t.position=3:1==t.position?t.position=2:2==t.position?t.position=1:3==t.position&&(t.position=0));e=this.view.user_layer.getChildByName("seat_"+t.position).getComponent(Js);e.setData(this,t),this.users.push(e)}},{key:"onUserLeaveResp",value:function(e){e.uid==Si.data.account.userid?this.closeBrowser():(e=this.getUser(e.uid))&&e.leaveGame()}},{key:"onNpcControllerResp",value:function(e){this.isMaster=1==e.is_control}},{key:"loopTestNotice",value:function(){var e=["【捕鱼大乱斗】：人品大爆发！玩家AAA触发了亿万豪奖，获得XX,XXX,XXX金币。","【捕鱼大乱斗】：嗨起来！玩家AAA在免费奖池中启动了白银抽奖，抽取到XXX，快来参加抽奖吧。","【捕鱼大乱斗】：爽翻！玩家AAA捕获奇遇蟹，进入免费游戏，获得XX,XXX,XXX金币。","【捕鱼大乱斗】穿云火箭一出，谁与争锋？！恭喜玩家AAA发射一枚穿云火箭，获得X,XXX,XXX金币。","【捕鱼大乱斗】我就是深海霸王！玩家AAA大吼一声，发射一枚电磁炮，获得XX,XXX,XXX金币。","【捕鱼大乱斗】我就是深海霸王！玩家AAA大吼一声，发射一枚电磁炮，获得XX,XXX,XXX金币。","【捕鱼大乱斗】抓到大鱼啦！恭喜玩家AAA击杀{章鱼}，获得XX,XXX,XXX金币。"];this.onNewNotice(e[Ti.randInt(0,e.length)])}},{key:"onNewNotice",value:function(e){this.noticeQueue.push(e),this.nextNotice()}},{key:"nextNotice",value:function(){this.isShowNotice||0<=this.noticeQueue.length&&(this.isShowNotice=!0,this.playNoticeAnimation(this.noticeQueue.shift()))}},{key:"playNoticeAnimation",value:function(e){var t=this,n=new To;n.y=5,this.view.notice_panel.addChild(n);var i=this.createNoticeLabel(e,"#ffa873"),a=15*i.width,e=-(this.view.notice_panel.width+i.width);n.addChild(i),n.x=this.view.notice_panel.width,pn.to(n,{x:e},a,null,F.create(this,function(){t.isShowNotice=!1,i.removeSelf(),g.recover("notice_label",i),n.destroy(!0)})),this.timer.once(a-4e3,this,function(){t.isShowNotice=!1,t.loopTestNotice()})}},{key:"createNoticeLabel",value:function(e,t){var n=g.getItem("notice_label");return(n=n||new mr).x=0,n.text=e,n.color=t,n.fontSize=20,n.autoSize=!0,n}},{key:"adjustUI",value:function(){this.view.size(Gn.width,Gn.height),this.adjustWeapon()}},{key:"adjustWeapon",value:function(){for(var e=0;e<this.view.user_layer.numChildren;e++)this.view.user_layer.getChildAt(e).x=0==e||3==e?Gn.width/6:Gn.width/6*5}},{key:"getUser",value:function(t){return this.users?this.users.find(function(e){return e.member.uid==t}):null}},{key:"getUserByPosition",value:function(e){return this.view.user_layer.getChildByName("seat_"+e).getComponent(Js)}},{key:"getSelfUser",value:function(){return this.getUser(Si.data.account.userid)}},{key:"onSocketClose",value:function(e){var t=this;e==di.name&&(this.waitingExitGame||(Si.defaultLoadingView.show("网络连接中，请稍后"),this.timer.clear(this,this.updateHundredsOfMillionsMoney),this.timer.clear(this,this.getHundredsOfMillionsInfo)),this.isReconect||(this.isReconect=!0,this.getSelfUser()&&(this.myUserStatus=this.getSelfUser().status.clone()),this.AllUserOffLine()),this.timer.once(2e3,this,function(){zi.I.loginGame(t.args.room)}))}},{key:"gameLoginFailResp",value:function(e){var t="";switch(e.error){case cu.LoginFailedNousemoney.error:t=0<e.infos.length?"您当前正在"+e.infos[0]+"中,请稍后再进！":"身上携带的钱不够进入当前房间，请取钱或者充值";break;case cu.LoginFailedLowlv.error:t="账号级别达到"+e.body+"才能进入游戏!";break;case cu.LoginFailedX.error:return void this.closeBrowser();default:void 0!==e.body&&e.body,t=cu.getBody(e.error,e.body)}Si.defaultLoadingView.hide(),js.I.showInfo(t,F.create(this,this.closeBrowser))}},{key:"exitGame",value:function(){this.waitingExitGame=!0,Si.defaultLoadingView.show("正在退出游戏..."),zi.I.send(new di.GameQuitReq),this.timer.loop(3e3,this,function(){zi.I.send(new di.GameQuitReq)})}},{key:"closeBrowser",value:function(){zi.I.gameSocket.close(),at.window.parent.postMessage("closeFrame","*")}},{key:"AllUserOffLine",value:function(){if(this.users){var e,t=c(this.users);try{for(t.s();!(e=t.n()).done;)e.value.offLine()}catch(e){t.e(e)}finally{t.f()}}}},{key:"getViewCtor",value:function(){return ts.fishdld.fight.FightSceneUI}},{key:"getResource",value:function(){return[new cs("fishdld/fight/mainui.atlas"),new cs("fishdld/animation/anigun.atlas"),new cs("fishdld/animation/aniui.atlas")].concat(this.fishScene.getResource())}},{key:"destroy",value:function(){}}]),n}(),yu=function(){T(t,Ph);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"init",value:function(){Si.event.once(Si.EventType.LoginComplete,this,this.onLoginComplete),Si.data.account?this.onLoginComplete():(zi.I.loginLobby(),Si.event.on(Ii.SocketClose,this,this.onSocketClose))}},{key:"onLoginComplete",value:function(){var i=this;Si.data.rooms&&(this.view.room_list.visible=!0,this.view.room_list.array=Si.data.rooms,this.view.room_list.renderHandler=new F(this,function(e,t){var n=e.dataSource;e.getChildByName("name").text=n.title+"\n倍率："+n.cannon_rate[0]+"~"+n.cannon_rate[1],e.on(Je.CLICK,i,i.onSelectRoom,[t])}),this.onSelectRoom(0))}},{key:"onSelectRoom",value:function(e){var t=Si.data.rooms[e],e=new fu;e.room=t,Bh.I.load(gu,e)}},{key:"onSocketClose",value:function(e){e==Oi.name&&this.view.timer.once(2e3,this,function(){zi.I.loginLobby()})}},{key:"getViewCtor",value:function(){return ts.fishdld.lobby.LobbySceneUI}},{key:"getResource",value:function(){return[]}},{key:"destroy",value:function(){}}]),t}(),vu=function(){T(t,Oh);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return C(t,[{key:"createView",value:function(){if(!this.view)return this.view=new(this.getViewCtor()),this.view.on(Je.CLICK,this,function(){}),this.view}}]),t}(),pu=function(){T(n,vu);var t=b(n);function n(){var e;return S(this,n),(e=t.apply(this,arguments)).timer=new Cn,e}return C(n,[{key:"getViewCtor",value:function(){return ts.fishdld.loading.LoadingSceneUI}},{key:"onProgress",value:function(e){this.setProgress(e),this.view.txt.text="加载中"+(100*e).toFixed(2)+"%"}},{key:"onComplete",value:function(){this.view.txt.text="加载完毕，正在解析..."}},{key:"getResource",value:function(){return[new cs("fishdld/loading.atlas")]}},{key:"init",value:function(){this.coins=this.view.coin_box._children.concat(),this.playWaterAnimation(),this.playPufferAnimation(),this.adjustUI(),Si.event.on(Je.RESIZE,this,this.adjustUI,null,!1)}},{key:"playWaterAnimation",value:function(){var e=this;this.view.water_mask.width=0;var t=1;this.timer.frameLoop(6,this,function(){15<t&&(t=1),e.view.water.skin="fishdld/loading/shuibowen_"+t+".png",e.view.bubble.skin="fishdld/loading/paopao_"+t+".png",t++})}},{key:"playPufferAnimation",value:function(){var e=this,t=this.view.puffer.x=0;this.timer.frameLoop(6,this,function(){6<t&&(t=0),e.view.puffer.skin="fishdld/loading/puffer_"+t+".png",t++})}},{key:"adjustUI",value:function(){this.view.bg.size(Gn.width,Gn.height),this.view.size(Gn.width,Gn.height)}},{key:"setInfo",value:function(e){this.view.txt.text=e}},{key:"setProgress",value:function(e){this.view.puffer.x=895*e,this.view.puffer.scale(1+e,1+e),this.view.water_mask.width=895*e;for(var t=0;t<this.coins.length;t++)this.view.water_mask.width>this.coins[t].x&&(pn.to(this.coins[t],{y:this.coins[t].y-50},500),pn.to(this.coins[t],{alpha:0},500),this.coins.splice(t,1),t--,is.playSound("F4BY_LoadingCoin.wav"))}},{key:"destroy",value:function(){this.timer.clearAll(this),Si.event.off(Je.RESIZE,this,this.adjustUI)}}]),n}();(Gr=_u=_u||{})[Gr.None=0]="None",Gr[Gr.Landscape=1]="Landscape",Gr[Gr.Portrait=2]="Portrait";var mu=function(){function n(){S(this,n),this._debug=!1,this._touchStatus=!1,this._portraitHeight=75,this._landscapeHeight=45,this._hasMove=!1,this._isGameOnly=!1,this._container=document.getElementById("layaContainer")}return C(n,[{key:"create",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];document.getElementById("maskDiv")||(this._isGameOnly=e,this._maskDiv=document.createElement("div"),at.onMobile&&(this._maskDiv.innerHTML='<br /><img src="html_res/full_screen_arrow.png" /><br />向上滑动可全屏游戏<br /><br />如果浏览器不支持滑动全屏<br />请点击屏幕直接进入',this._maskDiv.setAttribute("style","position:absolute; text-align:center; font-size:20px; color:#ffffff; left:0px; top:0px; background:rgba(0, 0, 0, 0.5);cursor: pointer;"),this._maskDiv.setAttribute("id","maskDiv"),document.body.appendChild(this._maskDiv),this.showMaskDiv(!1),this.onResizeHandle(),Gn.on(Je.RESIZE,this,this.onResizeHandle),document.addEventListener("scroll",this.onScroll,!1),document.addEventListener("gesturestart",function(e){e.preventDefault()}),window.addEventListener("resize",function(){n.instance.doResize(),n.instance.swipeFix()})),document.body.style.overflow="hidden")}},{key:"destroy",value:function(){this.removeTouchEvent()}},{key:"doResize",value:function(){window.scrollTo(0,0),this._container.style.height=window.innerHeight+"px",this._container.style.width=window.innerWidth+"px"}},{key:"addTouchEvent",value:function(){document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMoves,!1),document.addEventListener("touchend",this.onTouchEnd,!1),document.addEventListener("click",this.onClick,!1)}},{key:"removeTouchEvent",value:function(){document.removeEventListener("touchstart",this.onTouchStart,!1),document.removeEventListener("touchmove",this.onTouchMoves,!1),document.removeEventListener("touchend",this.onTouchEnd,!1),document.removeEventListener("click",this.onClick,!1)}},{key:"onTouchStart",value:function(e){n.instance._hasMove=!1,n.instance._touchStatus=!0,1<e.touches.length&&(e.stopPropagation(),e.preventDefault())}},{key:"onTouchMoves",value:function(e){n.instance._hasMove=!0,n.instance._touchStatus=!0,1<e.touches.length&&(e.stopPropagation(),e.preventDefault())}},{key:"onTouchEnd",value:function(){n.instance._touchStatus=!1}},{key:"onClick",value:function(){n.instance._hasMove||(n.instance.fullscreenEnabled(document)?n.instance.launchFullScreen(document.documentElement):n.instance.showMaskDiv(!1))}},{key:"onScroll",value:function(){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;n.instance._container.style.top=e+"px",setTimeout(function(){n.instance.delayScroll()},50)}},{key:"delayScroll",value:function(){clearTimeout(n.DELAYSCROLLSETTIMEOUT),n.DELAYSCROLLSETTIMEOUT=setTimeout(function(){n.instance.scrollView()},150)}},{key:"scrollView",value:function(){var e=window.document;window.scrollTo(0,0);var t=setInterval(function(){e.body&&(clearInterval(t),setTimeout(function(){window.scrollTo(0,0),n.instance.swipeFix()},10))},15)}},{key:"onResizeHandle",value:function(){at.onMobile&&this.swipeFix()}},{key:"swipeFix",value:function(){this.isFullscreen?this.showMaskDiv(!1):this.showMaskDiv(!0)}},{key:"launchFullScreen",value:function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},{key:"fullscreenEnabled",value:function(e){return e.fullscreenEnabled||e.mozFullScreenEnabled||e.webkitFullscreenEnabled||e.msFullscreenEnabled||!1}},{key:"getIsGameOnly",value:function(e){return e}},{key:"showMaskDiv",value:function(e){e=this.getIsGameOnly(e),this._maskDiv.style.visibility=e?"visible":"hidden",e?(this.addTouchEvent(),e=this.screenMode()===_u.Portrait?this.screenHeight:this.screenWidth,this._maskDiv.style.width=this.clientWidth+"px",this._maskDiv.style.height=e+1e3+"px"):this.removeTouchEvent()}},{key:"screenMode",value:function(){return this.clientWidth>=this.clientHeight?_u.Landscape:_u.Portrait}},{key:"isFullscreen",get:function(){var e=this.screenMode()===_u.Portrait?this.screenHeight:this.screenWidth,t=this.screenMode()===_u.Portrait?this._portraitHeight:this._landscapeHeight;return window.innerHeight>e-t}},{key:"screenHeight",get:function(){return window.screen.width>window.screen.height?window.screen.width:window.screen.height}},{key:"screenWidth",get:function(){return window.screen.width<window.screen.height?window.screen.width:window.screen.height}},{key:"clientHeight",get:function(){return document.documentElement.clientHeight||document.body.clientHeight}},{key:"clientWidth",get:function(){return document.documentElement.clientWidth||document.body.clientWidth}}],[{key:"instance",get:function(){return null==this._inst&&(this._inst=new n),this._inst}}]),n}(),wu=function(){T(t,Qo);var e=b(t);function t(){return S(this,t),e.apply(this,arguments)}return t}(),xu=function(){T(i,wu);var n=b(i);function i(){var e;S(this,i),(e=n.call(this)).bg=new Bt,e.bg.alpha=.5,e.bg.on(Je.CLICK,u(e),function(){}),e.bg.graphics.drawRect(0,0,9999,9999,"#000"),e.addChild(e.bg),e.box=new To,e.box.size(193,193),e.addChild(e.box);var t=new pi("fishdld/loading/loading_bg.png");t.centerX=t.centerY=0,e.box.addChild(t),e.close_btn=new pi("fishdld/loading/btn_close.png"),e.addChild(e.close_btn),e.loading=new pi("fishdld/loading/loading.png"),e.loading.anchorX=e.loading.anchorY=.5,e.box.addChild(e.loading);t=new pi("fishdld/loading/loading_logo.png");return t.centerX=t.centerY=0,e.box.addChild(t),e.label=new mr,e.label.color="#fff",e.label.fontSize=25,e.label.width=1136,e.label.align="center",e.addChild(e.label),e.visible=!1,e.alpha=0,Bh.I.loadingLayer.addChild(u(e)),e.adjustUI(),Si.event.onForever(Je.RESIZE,u(e),e.adjustUI),e}return C(i,[{key:"show",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length?arguments[1]:void 0;this.label.text=t,this.visible||(this.visible=!0,pn.to(this,{alpha:1},300),this.timer.frameLoop(1,this,function(){e.loading.rotation+=3.75/(1e3/60)*e.timer.delta}),this.close_btn.visible=n instanceof F,this.close_btn.offAllCaller(this),n instanceof F&&this.close_btn.on(Je.CLICK,this,function(){n.run()}))}},{key:"hide",value:function(){this.visible&&(this.visible=!1,pn.to(this,{alpha:0},300),this.timer.clearAll(this))}},{key:"adjustUI",value:function(){this.close_btn.centerX=80,this.close_btn.centerY=-110,this.loading.centerX=this.loading.centerY=0,this.label.centerX=0,this.label.centerY=58,this.box.centerX=0,this.box.centerY=-53,this.size(Gn.width,Gn.height)}}]),i}(),ku=function(){T(n,wu);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).loadingIndex=1,e.bg=new Bt,e.bg.alpha=.5,e.bg.on(Je.CLICK,u(e),function(){}),e.bg.graphics.drawRect(0,0,9999,9999,"#000"),e.addChild(e.bg),e.close_btn=new pi("fishdld/loading/btn_close.png"),e.addChild(e.close_btn),e.loading=new pi("fishdld/loading/bb_loading_1.png"),e.loading.anchorX=e.loading.anchorY=.5,e.loading.centerX=0,e.loading.centerY=-30,e.addChild(e.loading),e.label=new mr,e.label.color="#fff",e.label.fontSize=25,e.label.width=1136,e.label.align="center",e.addChild(e.label),e.visible=!1,e.alpha=0,Bh.I.loadingLayer.addChild(u(e)),e.adjustUI(),Si.event.onForever(Je.RESIZE,u(e),e.adjustUI),e}return C(n,[{key:"show",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length?arguments[1]:void 0;this.visible||(this.label.text=t,this.visible=!0,pn.to(this,{alpha:1},300),this.timer.loop(200,this,function(){e.loadingIndex++,3<e.loadingIndex&&(e.loadingIndex=1),e.loading.skin="fishdld/loading/bb_loading_"+e.loadingIndex+".png"}),this.close_btn.visible=n instanceof F,this.close_btn.offAllCaller(this),n instanceof F&&this.close_btn.on(Je.CLICK,this,function(){n.run()}))}},{key:"hide",value:function(){this.visible&&(this.visible=!1,pn.to(this,{alpha:0},300),this.timer.clearAll(this))}},{key:"adjustUI",value:function(){this.loading.centerX=0,this.loading.centerY=-30,this.label.centerX=0,this.label.centerY=58,this.close_btn.centerX=80,this.close_btn.centerY=-100,this.size(Gn.width,Gn.height)}}]),n}(),Tu=function(){T(n,wu);var t=b(n);function n(){var e;return S(this,n),(e=t.call(this)).loadingIndex=1,e.bg=new Bt,e.bg.alpha=.5,e.bg.on(Je.CLICK,u(e),function(){}),e.bg.graphics.drawRect(0,0,9999,9999,"#000"),e.addChild(e.bg),e.close_btn=new pi("fishdld/loading/btn_close.png"),e.addChild(e.close_btn),e.loading=new pi("fishdld/loading/lg_loading_1.png"),e.loading.anchorX=e.loading.anchorY=.5,e.loading.centerX=0,e.loading.centerY=-30,e.addChild(e.loading),e.label=new mr,e.label.color="#fff",e.label.fontSize=25,e.label.width=1136,e.label.align="center",e.addChild(e.label),e.visible=!1,e.alpha=0,Bh.I.loadingLayer.addChild(u(e)),e.adjustUI(),Si.event.onForever(Je.RESIZE,u(e),e.adjustUI),e}return C(n,[{key:"show",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length?arguments[1]:void 0;this.visible||(this.label.text=t,this.visible=!0,pn.to(this,{alpha:1},300),this.timer.loop(200,this,function(){e.loadingIndex++,3<e.loadingIndex&&(e.loadingIndex=1),e.loading.skin="fishdld/loading/lg_loading_"+e.loadingIndex+".png"}),this.close_btn.visible=n instanceof F,this.close_btn.offAllCaller(this),n instanceof F&&this.close_btn.on(Je.CLICK,this,function(){n.run()}))}},{key:"hide",value:function(){this.visible&&(this.visible=!1,pn.to(this,{alpha:0},300),this.timer.clearAll(this))}},{key:"adjustUI",value:function(){this.loading.centerX=0,this.loading.centerY=-30,this.label.centerX=0,this.label.centerY=58,this.close_btn.centerX=80,this.close_btn.centerY=-100,this.size(Gn.width,Gn.height)}}]),n}();new(function(){function e(){S(this,e),this.referenceClass=[Ch],window.Laya3D?window.Laya3D.init($s.width,$s.height):zn.init($s.width,$s.height,dt),zn.DebugPanel&&zn.DebugPanel.enable(),zn.stage.scaleMode=$s.scaleMode,zn.stage.screenMode=$s.screenMode,zn.stage.alignV=$s.alignV,zn.stage.alignH=$s.alignH,ye.animationInterval=1e3/24,at.onPC&&(zn.stage.useRetinalCanvas=!0),is.init(),zn.URL.customFormat=function(e){return at.window.manifest&&at.window.manifest[e]||e},this.adjustUI(),at.window.addEventListener("resize",this.adjustUI.bind(this)),at.window.addEventListener("orientationchange",this.adjustUI.bind(this)),Si.DEBUG=at.window.DEBUG,Si.DEBUG&&J.show(),sn.enable("fileconfig.json",F.create(this,this.onConfigLoaded))}return C(e,[{key:"onConfigLoaded",value:function(){var e;Bh.I.setSceneEvent(Si.event),Bh.I.setDefaultLoadingView(pu),at.window.isInIframe?(Si.data.account=this.getAccountFromEgret(),"bb"==Si.data.account.platform||"bb_test"==Si.data.account.platform?Si.defaultLoadingView=new ku:"lg"==Si.data.account.platform||"lg_test"==Si.data.account.platform?Si.defaultLoadingView=new Tu:Si.defaultLoadingView=new xu,(e=new fu).room=this.getRoomFromEgret(),Bh.I.load(gu,e)):(Si.defaultLoadingView=new xu,mu.instance.create(),Bh.I.load(yu))}},{key:"getAccountFromEgret",value:function(){return new Li(at.window.user)}},{key:"getRoomFromEgret",value:function(){var e=new Oi.RoomInfo;return e.websocket=at.window.user.websocket,e.fixed_seat=at.window.user.isFixSeat,e.dbname=at.window.user.dbname,e.min_money=at.window.user.minmoney,e.room_id=at.window.user.roomid,e}},{key:"adjustUI",value:function(){at.clientWidth/at.clientHeight>$s.width/$s.height?Gn.scaleMode="fixedheight":zn.stage.scaleMode="fixedwidth",zn.timer.once(1,this,function(){Si.event.event(Je.RESIZE)})}}]),e}())}();
